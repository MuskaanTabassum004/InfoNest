var Vm=Object.defineProperty;var qm=(r,e,t)=>e in r?Vm(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var Me=(r,e,t)=>qm(r,typeof e!="symbol"?e+"":e,t);import{r as b,a as Qu,b as ze,c as Km,g as Gm}from"./vendor-C733eHZ9.js";import{u as zn,N as $e,L as le,a as Tt,O as zc,b as Zu,c as Pl,H as Ym,R as Jm,d as me}from"./router-C60JbbFz.js";import{g as Xm,i as Qm,a as Zm,b as eg,c as tg,d as rg,s as Mo,e as ue,f as It,h as bs,j as sg,k as ng,u as ig,l as eh,G as og,m as ag,n as We,q as xe,o as pe,w as Oe,p as vt,r as kn,t as Ee,v as Do,x as Wn,y as Rt,T as Le,z as Hn,A as Si,B as lg,C as th,D as Sr,E as Wc,F as cg,H as dg,I as ug,J as Ll}from"./firebase-CemElZ1T.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function t(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(n){if(n.ep)return;n.ep=!0;const i=t(n);fetch(n.href,i)}})();var rh={exports:{}},To={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hg=b,fg=Symbol.for("react.element"),pg=Symbol.for("react.fragment"),mg=Object.prototype.hasOwnProperty,gg=hg.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,xg={key:!0,ref:!0,__self:!0,__source:!0};function sh(r,e,t){var s,n={},i=null,o=null;t!==void 0&&(i=""+t),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(o=e.ref);for(s in e)mg.call(e,s)&&!xg.hasOwnProperty(s)&&(n[s]=e[s]);if(r&&r.defaultProps)for(s in e=r.defaultProps,e)n[s]===void 0&&(n[s]=e[s]);return{$$typeof:fg,type:r,key:i,ref:o,props:n,_owner:gg.current}}To.Fragment=pg;To.jsx=sh;To.jsxs=sh;rh.exports=To;var a=rh.exports,nh,Hc=Qu;nh=Hc.createRoot,Hc.hydrateRoot;let yg={data:""},bg=r=>typeof window=="object"?((r?r.querySelector("#_goober"):window._goober)||Object.assign((r||document.head).appendChild(document.createElement("style")),{innerHTML:" ",id:"_goober"})).firstChild:r||yg,wg=/(?:([\u0080-\uFFFF\w-%@]+) *:? *([^{;]+?);|([^;}{]*?) *{)|(}\s*)/g,vg=/\/\*[^]*?\*\/|  +/g,Vc=/\n+/g,gr=(r,e)=>{let t="",s="",n="";for(let i in r){let o=r[i];i[0]=="@"?i[1]=="i"?t=i+" "+o+";":s+=i[1]=="f"?gr(o,i):i+"{"+gr(o,i[1]=="k"?"":e)+"}":typeof o=="object"?s+=gr(o,e?e.replace(/([^,])+/g,l=>i.replace(/([^,]*:\S+\([^)]*\))|([^,])+/g,c=>/&/.test(c)?c.replace(/&/g,l):l?l+" "+c:c)):i):o!=null&&(i=/^--/.test(i)?i:i.replace(/[A-Z]/g,"-$&").toLowerCase(),n+=gr.p?gr.p(i,o):i+":"+o+";")}return t+(e&&n?e+"{"+n+"}":n)+s},Jt={},ih=r=>{if(typeof r=="object"){let e="";for(let t in r)e+=t+ih(r[t]);return e}return r},Ng=(r,e,t,s,n)=>{let i=ih(r),o=Jt[i]||(Jt[i]=(c=>{let d=0,u=11;for(;d<c.length;)u=101*u+c.charCodeAt(d++)>>>0;return"go"+u})(i));if(!Jt[o]){let c=i!==r?r:(d=>{let u,h,f=[{}];for(;u=wg.exec(d.replace(vg,""));)u[4]?f.shift():u[3]?(h=u[3].replace(Vc," ").trim(),f.unshift(f[0][h]=f[0][h]||{})):f[0][u[1]]=u[2].replace(Vc," ").trim();return f[0]})(r);Jt[o]=gr(n?{["@keyframes "+o]:c}:c,t?"":"."+o)}let l=t&&Jt.g?Jt.g:null;return t&&(Jt.g=Jt[o]),((c,d,u,h)=>{h?d.data=d.data.replace(h,c):d.data.indexOf(c)===-1&&(d.data=u?c+d.data:d.data+c)})(Jt[o],e,s,l),o},jg=(r,e,t)=>r.reduce((s,n,i)=>{let o=e[i];if(o&&o.call){let l=o(t),c=l&&l.props&&l.props.className||/^go/.test(l)&&l;o=c?"."+c:l&&typeof l=="object"?l.props?"":gr(l,""):l===!1?"":l}return s+n+(o??"")},"");function Oo(r){let e=this||{},t=r.call?r(e.p):r;return Ng(t.unshift?t.raw?jg(t,[].slice.call(arguments,1),e.p):t.reduce((s,n)=>Object.assign(s,n&&n.call?n(e.p):n),{}):t,bg(e.target),e.g,e.o,e.k)}let oh,Ba,Ua;Oo.bind({g:1});let or=Oo.bind({k:1});function kg(r,e,t,s){gr.p=e,oh=r,Ba=t,Ua=s}function Ir(r,e){let t=this||{};return function(){let s=arguments;function n(i,o){let l=Object.assign({},i),c=l.className||n.className;t.p=Object.assign({theme:Ba&&Ba()},l),t.o=/ *go\d+/.test(c),l.className=Oo.apply(t,s)+(c?" "+c:"");let d=r;return r[0]&&(d=l.as||r,delete l.as),Ua&&d[0]&&Ua(l),oh(d,l)}return n}}var Sg=r=>typeof r=="function",Ei=(r,e)=>Sg(r)?r(e):r,Eg=(()=>{let r=0;return()=>(++r).toString()})(),ah=(()=>{let r;return()=>{if(r===void 0&&typeof window<"u"){let e=matchMedia("(prefers-reduced-motion: reduce)");r=!e||e.matches}return r}})(),Ag=20,lh=(r,e)=>{switch(e.type){case 0:return{...r,toasts:[e.toast,...r.toasts].slice(0,Ag)};case 1:return{...r,toasts:r.toasts.map(i=>i.id===e.toast.id?{...i,...e.toast}:i)};case 2:let{toast:t}=e;return lh(r,{type:r.toasts.find(i=>i.id===t.id)?1:0,toast:t});case 3:let{toastId:s}=e;return{...r,toasts:r.toasts.map(i=>i.id===s||s===void 0?{...i,dismissed:!0,visible:!1}:i)};case 4:return e.toastId===void 0?{...r,toasts:[]}:{...r,toasts:r.toasts.filter(i=>i.id!==e.toastId)};case 5:return{...r,pausedAt:e.time};case 6:let n=e.time-(r.pausedAt||0);return{...r,pausedAt:void 0,toasts:r.toasts.map(i=>({...i,pauseDuration:i.pauseDuration+n}))}}},pi=[],Qr={toasts:[],pausedAt:void 0},ws=r=>{Qr=lh(Qr,r),pi.forEach(e=>{e(Qr)})},Cg={blank:4e3,error:4e3,success:2e3,loading:1/0,custom:4e3},Mg=(r={})=>{let[e,t]=b.useState(Qr),s=b.useRef(Qr);b.useEffect(()=>(s.current!==Qr&&t(Qr),pi.push(t),()=>{let i=pi.indexOf(t);i>-1&&pi.splice(i,1)}),[]);let n=e.toasts.map(i=>{var o,l,c;return{...r,...r[i.type],...i,removeDelay:i.removeDelay||((o=r[i.type])==null?void 0:o.removeDelay)||(r==null?void 0:r.removeDelay),duration:i.duration||((l=r[i.type])==null?void 0:l.duration)||(r==null?void 0:r.duration)||Cg[i.type],style:{...r.style,...(c=r[i.type])==null?void 0:c.style,...i.style}}});return{...e,toasts:n}},Dg=(r,e="blank",t)=>({createdAt:Date.now(),visible:!0,dismissed:!1,type:e,ariaProps:{role:"status","aria-live":"polite"},message:r,pauseDuration:0,...t,id:(t==null?void 0:t.id)||Eg()}),Vn=r=>(e,t)=>{let s=Dg(e,r,t);return ws({type:2,toast:s}),s.id},Ne=(r,e)=>Vn("blank")(r,e);Ne.error=Vn("error");Ne.success=Vn("success");Ne.loading=Vn("loading");Ne.custom=Vn("custom");Ne.dismiss=r=>{ws({type:3,toastId:r})};Ne.remove=r=>ws({type:4,toastId:r});Ne.promise=(r,e,t)=>{let s=Ne.loading(e.loading,{...t,...t==null?void 0:t.loading});return typeof r=="function"&&(r=r()),r.then(n=>{let i=e.success?Ei(e.success,n):void 0;return i?Ne.success(i,{id:s,...t,...t==null?void 0:t.success}):Ne.dismiss(s),n}).catch(n=>{let i=e.error?Ei(e.error,n):void 0;i?Ne.error(i,{id:s,...t,...t==null?void 0:t.error}):Ne.dismiss(s)}),r};var Tg=(r,e)=>{ws({type:1,toast:{id:r,height:e}})},Og=()=>{ws({type:5,time:Date.now()})},hn=new Map,Rg=1e3,Ig=(r,e=Rg)=>{if(hn.has(r))return;let t=setTimeout(()=>{hn.delete(r),ws({type:4,toastId:r})},e);hn.set(r,t)},Pg=r=>{let{toasts:e,pausedAt:t}=Mg(r);b.useEffect(()=>{if(t)return;let i=Date.now(),o=e.map(l=>{if(l.duration===1/0)return;let c=(l.duration||0)+l.pauseDuration-(i-l.createdAt);if(c<0){l.visible&&Ne.dismiss(l.id);return}return setTimeout(()=>Ne.dismiss(l.id),c)});return()=>{o.forEach(l=>l&&clearTimeout(l))}},[e,t]);let s=b.useCallback(()=>{t&&ws({type:6,time:Date.now()})},[t]),n=b.useCallback((i,o)=>{let{reverseOrder:l=!1,gutter:c=8,defaultPosition:d}=o||{},u=e.filter(p=>(p.position||d)===(i.position||d)&&p.height),h=u.findIndex(p=>p.id===i.id),f=u.filter((p,m)=>m<h&&p.visible).length;return u.filter(p=>p.visible).slice(...l?[f+1]:[0,f]).reduce((p,m)=>p+(m.height||0)+c,0)},[e]);return b.useEffect(()=>{e.forEach(i=>{if(i.dismissed)Ig(i.id,i.removeDelay);else{let o=hn.get(i.id);o&&(clearTimeout(o),hn.delete(i.id))}})},[e]),{toasts:e,handlers:{updateHeight:Tg,startPause:Og,endPause:s,calculateOffset:n}}},Lg=or`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
 transform: scale(1) rotate(45deg);
  opacity: 1;
}`,$g=or`
from {
  transform: scale(0);
  opacity: 0;
}
to {
  transform: scale(1);
  opacity: 1;
}`,_g=or`
from {
  transform: scale(0) rotate(90deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(90deg);
	opacity: 1;
}`,Fg=Ir("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${r=>r.primary||"#ff4b4b"};
  position: relative;
  transform: rotate(45deg);

  animation: ${Lg} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;

  &:after,
  &:before {
    content: '';
    animation: ${$g} 0.15s ease-out forwards;
    animation-delay: 150ms;
    position: absolute;
    border-radius: 3px;
    opacity: 0;
    background: ${r=>r.secondary||"#fff"};
    bottom: 9px;
    left: 4px;
    height: 2px;
    width: 12px;
  }

  &:before {
    animation: ${_g} 0.15s ease-out forwards;
    animation-delay: 180ms;
    transform: rotate(90deg);
  }
`,Bg=or`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
`,Ug=Ir("div")`
  width: 12px;
  height: 12px;
  box-sizing: border-box;
  border: 2px solid;
  border-radius: 100%;
  border-color: ${r=>r.secondary||"#e0e0e0"};
  border-right-color: ${r=>r.primary||"#616161"};
  animation: ${Bg} 1s linear infinite;
`,zg=or`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(45deg);
	opacity: 1;
}`,Wg=or`
0% {
	height: 0;
	width: 0;
	opacity: 0;
}
40% {
  height: 0;
	width: 6px;
	opacity: 1;
}
100% {
  opacity: 1;
  height: 10px;
}`,Hg=Ir("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${r=>r.primary||"#61d345"};
  position: relative;
  transform: rotate(45deg);

  animation: ${zg} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;
  &:after {
    content: '';
    box-sizing: border-box;
    animation: ${Wg} 0.2s ease-out forwards;
    opacity: 0;
    animation-delay: 200ms;
    position: absolute;
    border-right: 2px solid;
    border-bottom: 2px solid;
    border-color: ${r=>r.secondary||"#fff"};
    bottom: 6px;
    left: 6px;
    height: 10px;
    width: 6px;
  }
`,Vg=Ir("div")`
  position: absolute;
`,qg=Ir("div")`
  position: relative;
  display: flex;
  justify-content: center;
  align-items: center;
  min-width: 20px;
  min-height: 20px;
`,Kg=or`
from {
  transform: scale(0.6);
  opacity: 0.4;
}
to {
  transform: scale(1);
  opacity: 1;
}`,Gg=Ir("div")`
  position: relative;
  transform: scale(0.6);
  opacity: 0.4;
  min-width: 20px;
  animation: ${Kg} 0.3s 0.12s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
`,Yg=({toast:r})=>{let{icon:e,type:t,iconTheme:s}=r;return e!==void 0?typeof e=="string"?b.createElement(Gg,null,e):e:t==="blank"?null:b.createElement(qg,null,b.createElement(Ug,{...s}),t!=="loading"&&b.createElement(Vg,null,t==="error"?b.createElement(Fg,{...s}):b.createElement(Hg,{...s})))},Jg=r=>`
0% {transform: translate3d(0,${r*-200}%,0) scale(.6); opacity:.5;}
100% {transform: translate3d(0,0,0) scale(1); opacity:1;}
`,Xg=r=>`
0% {transform: translate3d(0,0,-1px) scale(1); opacity:1;}
100% {transform: translate3d(0,${r*-150}%,-1px) scale(.6); opacity:0;}
`,Qg="0%{opacity:0;} 100%{opacity:1;}",Zg="0%{opacity:1;} 100%{opacity:0;}",e0=Ir("div")`
  display: flex;
  align-items: center;
  background: #fff;
  color: #363636;
  line-height: 1.3;
  will-change: transform;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1), 0 3px 3px rgba(0, 0, 0, 0.05);
  max-width: 350px;
  pointer-events: auto;
  padding: 8px 10px;
  border-radius: 8px;
`,t0=Ir("div")`
  display: flex;
  justify-content: center;
  margin: 4px 10px;
  color: inherit;
  flex: 1 1 auto;
  white-space: pre-line;
`,r0=(r,e)=>{let t=r.includes("top")?1:-1,[s,n]=ah()?[Qg,Zg]:[Jg(t),Xg(t)];return{animation:e?`${or(s)} 0.35s cubic-bezier(.21,1.02,.73,1) forwards`:`${or(n)} 0.4s forwards cubic-bezier(.06,.71,.55,1)`}},s0=b.memo(({toast:r,position:e,style:t,children:s})=>{let n=r.height?r0(r.position||e||"top-center",r.visible):{opacity:0},i=b.createElement(Yg,{toast:r}),o=b.createElement(t0,{...r.ariaProps},Ei(r.message,r));return b.createElement(e0,{className:r.className,style:{...n,...t,...r.style}},typeof s=="function"?s({icon:i,message:o}):b.createElement(b.Fragment,null,i,o))});kg(b.createElement);var n0=({id:r,className:e,style:t,onHeightUpdate:s,children:n})=>{let i=b.useCallback(o=>{if(o){let l=()=>{let c=o.getBoundingClientRect().height;s(r,c)};l(),new MutationObserver(l).observe(o,{subtree:!0,childList:!0,characterData:!0})}},[r,s]);return b.createElement("div",{ref:i,className:e,style:t},n)},i0=(r,e)=>{let t=r.includes("top"),s=t?{top:0}:{bottom:0},n=r.includes("center")?{justifyContent:"center"}:r.includes("right")?{justifyContent:"flex-end"}:{};return{left:0,right:0,display:"flex",position:"absolute",transition:ah()?void 0:"all 230ms cubic-bezier(.21,1.02,.73,1)",transform:`translateY(${e*(t?1:-1)}px)`,...s,...n}},o0=Oo`
  z-index: 9999;
  > * {
    pointer-events: auto;
  }
`,Jn=16,a0=({reverseOrder:r,position:e="top-center",toastOptions:t,gutter:s,children:n,containerStyle:i,containerClassName:o})=>{let{toasts:l,handlers:c}=Pg(t);return b.createElement("div",{id:"_rht_toaster",style:{position:"fixed",zIndex:9999,top:Jn,left:Jn,right:Jn,bottom:Jn,pointerEvents:"none",...i},className:o,onMouseEnter:c.startPause,onMouseLeave:c.endPause},l.map(d=>{let u=d.position||e,h=c.calculateOffset(d,{reverseOrder:r,gutter:s,defaultPosition:e}),f=i0(u,h);return b.createElement(n0,{id:d.id,key:d.id,onHeightUpdate:c.updateHeight,className:d.visible?o0:"",style:f},d.type==="custom"?Ei(d.message,d):n?n(d):b.createElement(s0,{toast:d,position:u}))}))},K=Ne;const l0={apiKey:"AIzaSyBktW6-GVYs7_Qqskwj1I_RO0KBsYiSGtU",authDomain:"infonest-m0707.firebaseapp.com",projectId:"infonest-m0707",storageBucket:"infonest-m0707.firebasestorage.app",messagingSenderId:"351328466797",appId:"1:351328466797:web:e4295d17db2451128b8c64",measurementId:"G-DYCBMWR5EG"},$l=Xm().length===0?Qm(l0):Zm(),ke=eg($l),X=tg($l),Xs=rg($l);typeof window<"u"&&ke.useDeviceLanguage();const c0=r=>(r==null?void 0:r.code)==="permission-denied"?(console.warn("Firestore permission denied - user may have logged out"),!0):(console.error("Firestore error:",r),!1);if(typeof window<"u"){window.addEventListener("unhandledrejection",e=>{var t,s;(((t=e.reason)==null?void 0:t.code)==="permission-denied"||(s=e.reason)!=null&&s.message&&e.reason.message.includes("permission-denied"))&&(c0(e.reason),e.preventDefault())});const r=console.error;console.error=(...e)=>{const t=e.join(" ");t.includes("permission-denied")&&t.includes("Firestore")||r.apply(console,e)}}const Xn=Object.freeze(Object.defineProperty({__proto__:null,auth:ke,firestore:X,storage:Xs},Symbol.toStringTag,{value:"Module"})),d0="modulepreload",u0=function(r){return"/InfoNest/"+r},qc={},Fe=function(e,t,s){let n=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),l=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));n=Promise.allSettled(t.map(c=>{if(c=u0(c),c in qc)return;qc[c]=!0;const d=c.endsWith(".css"),u=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${u}`))return;const h=document.createElement("link");if(h.rel=d?"stylesheet":d0,d||(h.as="script"),h.crossOrigin="",h.href=c,l&&h.setAttribute("nonce",l),document.head.appendChild(h),d)return new Promise((f,p)=>{h.addEventListener("load",f),h.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${c}`)))})}))}function i(o){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=o,window.dispatchEvent(l),!l.defaultPrevented)throw o}return n.then(o=>{for(const l of o||[])l.status==="rejected"&&i(l.reason);return e().catch(i)})},Gr=class Gr{constructor(){Me(this,"cache",new Map);Me(this,"CACHE_DURATION",30*60*1e3);Me(this,"STORAGE_KEY","infonest_auth_cache")}static getInstance(){return Gr.instance||(Gr.instance=new Gr),Gr.instance}generatePermissions(e){const{role:t}=e,s={canCreateArticles:!1,canManageUsers:!1,canEditAnyArticle:!1,canAccessAdmin:!1,canAccessInfoWriter:!1,canDeleteOwnArticles:!1,canDeleteInfowriterArticles:!1,canReadPublishedArticles:!0,canReadOwnArticles:!0,canReadAllArticles:!1,allowedRoutes:["/","/dashboard","/profile"],dashboardRoute:"/dashboard"};switch(t){case"admin":return{...s,canCreateArticles:!0,canManageUsers:!0,canEditAnyArticle:!1,canAccessAdmin:!0,canAccessInfoWriter:!0,canDeleteOwnArticles:!0,canDeleteInfowriterArticles:!0,canReadAllArticles:!0,allowedRoutes:[...s.allowedRoutes,"/admin","/admin/writer-requests","/admin/active-writers","/admin/removed-writers","/admin/system","/personal-dashboard","/article/new","/article/edit/:id","/article/:id","/my-articles","/search","/writer-request","/saved-articles"]};case"infowriter":return{...s,canCreateArticles:!0,canAccessInfoWriter:!0,canDeleteOwnArticles:!0,canDeleteInfowriterArticles:!1,allowedRoutes:[...s.allowedRoutes,"/article/new","/article/edit/:id","/article/:id","/my-articles","/search","/writer-request","/saved-articles"]};case"user":default:return{...s,allowedRoutes:[...s.allowedRoutes,"/article/:id","/writer-request","/saved-articles"]}}}cacheUserSession(e){const t=Date.now(),s=this.generatePermissions(e),n={userProfile:e,permissions:s,lastUpdated:t,expiresAt:t+this.CACHE_DURATION};return this.cache.set(e.uid,n),this.persistToStorage(e.uid,n),n}getCachedSession(e){let t=this.cache.get(e);return t||(t=this.loadFromStorage(e),t&&this.cache.set(e,t)),t&&Date.now()<t.expiresAt?t:(t&&this.clearUserSession(e),null)}hasRoutePermission(e,t){const s=this.getCachedSession(e);return s?s.permissions.allowedRoutes.some(n=>{if(n.includes(":")){const i=n.replace(/:[^/]+/g,"[^/]+");return new RegExp(`^${i}$`).test(t)}return t===n||t.startsWith(n+"/")}):!1}clearUserSession(e){this.cache.delete(e),localStorage.removeItem(`${this.STORAGE_KEY}_${e}`)}clearAllSessions(){this.cache.clear();try{Object.keys(localStorage).forEach(e=>{(e.startsWith(this.STORAGE_KEY)||e.startsWith("infonest_"))&&localStorage.removeItem(e)}),Object.keys(sessionStorage).forEach(e=>{(e.startsWith(this.STORAGE_KEY)||e.startsWith("infonest_"))&&sessionStorage.removeItem(e)})}catch(e){console.warn("Failed to clear storage:",e)}}persistToStorage(e,t){var s,n;try{localStorage.setItem(`${this.STORAGE_KEY}_${e}`,JSON.stringify({...t,userProfile:{...t.userProfile,createdAt:(s=t.userProfile.createdAt)==null?void 0:s.getTime(),updatedAt:(n=t.userProfile.updatedAt)==null?void 0:n.getTime()}}))}catch(i){console.warn("Failed to persist auth cache:",i)}}loadFromStorage(e){try{const t=localStorage.getItem(`${this.STORAGE_KEY}_${e}`);if(!t)return null;const s=JSON.parse(t);return{...s,userProfile:{...s.userProfile,createdAt:s.userProfile.createdAt?new Date(s.userProfile.createdAt):void 0,updatedAt:s.userProfile.updatedAt?new Date(s.userProfile.updatedAt):void 0}}}catch{return null}}};Me(Gr,"instance");let za=Gr;const ur=za.getInstance(),h0=async(r,e,t)=>{try{const s=await ng(ke,r,e);t&&await ig(s.user,{displayName:t});const i=`${window.location.origin}/#/verify-email`;return await eh(s.user,{url:i,handleCodeInApp:!1}),{user:s.user,email:r,displayName:t}}catch(s){if(console.error("Signup error:",s),ke.currentUser)try{await ke.currentUser.delete()}catch(n){console.error("Failed to cleanup failed user creation:",n)}throw s}},f0=async r=>{var s;if(!r.emailVerified){try{await Mo(ke)}catch(n){console.error("Failed to sign out unverified user:",n)}return}const e=ue(X,"users",r.uid);if(!(await It(e)).exists()){const n={uid:r.uid,email:r.email,role:"user",displayName:r.displayName||((s=r.email)==null?void 0:s.split("@")[0])||"",createdAt:new Date,updatedAt:new Date,requestedWriterAccess:!1,emailVerified:!0};await bs(e,{...n,createdAt:new Date,updatedAt:new Date})}},p0=async(r,e)=>{const t=await sg(ke,r,e);if(await t.user.reload(),t.user.emailVerified||(await new Promise(s=>setTimeout(s,1e3)),await t.user.reload()),!t.user.emailVerified)throw await Mo(ke),new Error("Please verify your email address before signing in. Check your inbox for the verification link.");return t},ch=async()=>{ur.clearAllSessions();try{localStorage.clear(),sessionStorage.clear()}catch(r){console.warn("Failed to clear storage:",r)}document.cookie.split(";").forEach(r=>{const e=r.indexOf("="),t=e>-1?r.substr(0,e):r;document.cookie=t+"=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/"}),await Mo(ke),await new Promise(r=>setTimeout(r,100))},m0=async r=>{const e=ue(X,"users",r);await We(e,{role:"infowriter",requestedWriterAccess:!1,updatedAt:new Date});try{const{createInfoWriterApprovalNotification:t}=await Fe(async()=>{const{createInfoWriterApprovalNotification:s}=await Promise.resolve().then(()=>Ro);return{createInfoWriterApprovalNotification:s}},void 0);await t(r)}catch(t){console.error("Error creating InfoWriter approval notification:",t)}},g0=async(r,e,t)=>{console.log(`🗑️ Starting comprehensive InfoWriter privilege removal for: ${r}`);try{const{hardDeleteArticle:s,cleanupArticleRelatedData:n}=await Fe(async()=>{const{hardDeleteArticle:f,cleanupArticleRelatedData:p}=await Promise.resolve().then(()=>Ql);return{hardDeleteArticle:f,cleanupArticleRelatedData:p}},void 0),{deleteUserFolder:i}=await Fe(async()=>{const{deleteUserFolder:f}=await Promise.resolve().then(()=>qa);return{deleteUserFolder:f}},void 0),{createNotification:o}=await Fe(async()=>{const{createNotification:f}=await Promise.resolve().then(()=>Ro);return{createNotification:f}},void 0);let l=0;console.log(`📄 Fetching ALL articles by user: ${r}`);const c=xe(pe(X,"articles"),Oe("authorId","==",r)),d=await vt(c);if(console.log(`📊 Found ${d.docs.length} articles to delete (all statuses: published, unpublished, draft, archive)`),!d.empty){const f=d.docs.map(async p=>{try{const m=p.id,g=p.data();console.log(`🗑️ Deleting article: ${g.title} (${m}) - Status: ${g.status}`),await s(m),l++,console.log(`✅ Successfully deleted article: ${m} (${g.status})`)}catch(m){console.error(`❌ Failed to delete article: ${p.id}`,m)}});await Promise.all(f),console.log(`✅ Completed article deletion: ${l} articles deleted (all statuses)`)}try{console.log(`🗑️ Deleting user storage folder: articles/${r}/`),await i(r),console.log("✅ Successfully deleted user storage folder")}catch(f){console.error("⚠️ Failed to delete user storage folder:",f)}console.log("👤 Updating user role from infowriter to user");const u=ue(X,"users",r);await We(u,{role:"user",previousRoles:[r],privilegesRemovedAt:kn(),privilegesRemovedBy:e,adminNote:t.trim(),articleCountAtRemoval:l,updatedAt:new Date}),console.log("✅ User role updated successfully");const h=`Your InfoWriter privileges have been removed by an administrator. Reason: ${t.trim()}. ${l>0?`All ${l} of your articles (published, unpublished, drafts, and archived) have been permanently removed from the database and storage.`:"You had no articles to remove."} Contact support if you have questions.`;return await o(r,"writer_privileges_removed","InfoWriter Privileges Removed",h),console.log("✅ Notification sent to user"),console.log("🎉 InfoWriter privilege removal completed successfully"),{deletedArticlesCount:l}}catch(s){throw console.error("❌ Error during InfoWriter privilege removal:",s),s}},x0=async()=>{const r=new og,e=await ag(ke,r),t=ue(X,"users",e.user.uid);if(!(await It(t)).exists()){const n={uid:e.user.uid,email:e.user.email,role:"user",displayName:e.user.displayName||"",emailVerified:!0,createdAt:new Date,updatedAt:new Date,requestedWriterAccess:!1};await bs(t,{...n,createdAt:new Date,updatedAt:new Date}),console.log("✅ Google user profile created")}return e},ve=()=>{const[r,e]=b.useState(null),[t,s]=b.useState(null),[n,i]=b.useState(null),[o,l]=b.useState(!0),[c,d]=b.useState(!1),u=async()=>{var j,w,v;if(ke.currentUser){d(!0);try{await ke.currentUser.reload();const D=ke.currentUser,C=ue(X,"users",D.uid),P=await It(C);if(P.exists()){const O=P.data();s({uid:D.uid,email:D.email||"",displayName:O.displayName||D.displayName||((j=D.email)==null?void 0:j.split("@")[0])||"",role:O.role||"user",emailVerified:D.emailVerified,profilePicture:O.profilePicture||"",bio:O.bio||"",socialLinks:O.socialLinks||{},createdAt:(w=O.createdAt)==null?void 0:w.toDate(),updatedAt:(v=O.updatedAt)==null?void 0:v.toDate(),requestedWriterAccess:O.requestedWriterAccess})}}catch(D){console.error("Failed to refresh profile:",D)}finally{d(!1)}}},h=b.useCallback(async j=>{if(j.emailVerified){d(!0);try{const w=ur.getCachedSession(j.uid);if(w&&Date.now()-w.lastUpdated<5*60*1e3){s(w.userProfile),i(w.permissions),d(!1);return}const v=ue(X,"users",j.uid);Ee(v,D=>{var C,P,O;if(D.exists()){const W=D.data(),H={uid:j.uid,email:j.email||"",displayName:W.displayName||j.displayName||((C=j.email)==null?void 0:C.split("@")[0])||"",role:W.role||"user",emailVerified:j.emailVerified,profilePicture:W.profilePicture||"",bio:W.bio||"",socialLinks:W.socialLinks||{},createdAt:(P=W.createdAt)==null?void 0:P.toDate(),updatedAt:(O=W.updatedAt)==null?void 0:O.toDate(),requestedWriterAccess:W.requestedWriterAccess},I=ur.cacheUserSession(H);s(H),i(I.permissions),d(!1)}else s(null),i(null),d(!1)},D=>{if(D.code==="permission-denied"){s(null),i(null),d(!1);return}console.error("Error in profile snapshot:",D),s(null),i(null),d(!1)})}catch(w){console.error("Error loading user profile:",w),s(null),i(null),d(!1)}}},[]);b.useEffect(()=>{const j=Do(ke,async w=>{if(l(!0),e(w),w){try{await w.reload()}catch{}if(w.emailVerified)try{await f0(w),await h(w)}catch(v){v.code==="permission-denied"?(s(null),i(null),ur.clearAllSessions()):console.error("Error creating/loading user profile:",v)}else s(null),i(null),ur.clearAllSessions()}else{e(null),s(null),i(null),ur.clearAllSessions();try{localStorage.removeItem("infonest_auth_cache"),Object.keys(localStorage).forEach(v=>{v.startsWith("infonest_")&&localStorage.removeItem(v)})}catch(v){console.warn("Failed to clear auth storage:",v)}}l(!1)});return()=>j()},[]),b.useEffect(()=>{if(!r||!r.emailVerified)return;const j=ue(X,"users",r.uid),w=Ee(j,v=>{var D,C,P;if(v.exists()){const O=v.data(),W={uid:r.uid,email:r.email||"",displayName:O.displayName||r.displayName||((D=r.email)==null?void 0:D.split("@")[0])||"",role:O.role||"user",emailVerified:r.emailVerified,profilePicture:O.profilePicture||"",bio:O.bio||"",socialLinks:O.socialLinks||{},createdAt:(C=O.createdAt)==null?void 0:C.toDate(),updatedAt:(P=O.updatedAt)==null?void 0:P.toDate(),requestedWriterAccess:O.requestedWriterAccess};s(W),W&&ur.cacheUserSession(W)}},v=>{if(v.code==="permission-denied"){console.warn("Permission denied for user profile subscription - user may not be authenticated or verified");return}console.error("Error in user profile subscription:",v)});return()=>w()},[r]);const f=b.useCallback(j=>(t==null?void 0:t.role)===j,[t]),p=b.useCallback(j=>t?j.includes(t.role):!1,[t]),m=b.useMemo(()=>(n==null?void 0:n.canCreateArticles)||!1,[n]),g=b.useMemo(()=>(n==null?void 0:n.canManageUsers)||!1,[n]),y=b.useCallback((j,w)=>!t||w==="archive"?!1:t.uid===j,[t]),x=b.useCallback((j,w)=>!t||!n?!1:t.uid===j?n.canDeleteOwnArticles:t.role==="admin"?n.canDeleteInfowriterArticles:!1,[t,n]),N=b.useCallback((j,w)=>j==="published"?!0:j==="archive"?t?t.uid===w||t.role==="admin":!1:t?t.uid===w:!1,[t]),A=b.useCallback(j=>r?ur.hasRoutePermission(r.uid,j):!1,[r]),S=b.useCallback(()=>(n==null?void 0:n.dashboardRoute)||"/dashboard",[n]),k=j=>(t==null?void 0:t.role)===j,R=j=>{if(!t)return!1;const w={user:1,infowriter:2,admin:3},v=w[t.role],D=w[j];return v>=D};return{user:r,userProfile:t,permissions:n,isAuthenticated:!!r&&!!t,emailVerified:(r==null?void 0:r.emailVerified)||!1,loading:o||c,profileLoading:c,isAdmin:(t==null?void 0:t.role)==="admin",isInfoWriter:(t==null?void 0:t.role)==="infowriter"||(t==null?void 0:t.role)==="admin",isUser:(t==null?void 0:t.role)==="user",hasRole:f,hasAnyRole:p,canCreateArticles:m,canManageUsers:g,canEditArticle:y,canDeleteArticle:x,canReadArticle:N,hasRoutePermission:A,getDashboardRoute:S,refreshProfile:u,isUserRole:k,hasMinimumRole:R}},_l=async(r,e,t,s,n)=>{try{const i=ue(pe(X,"notifications")),o={userId:r,type:e,title:t,message:s,isRead:!1,createdAt:Le.fromDate(new Date)};n!==void 0&&(o.metadata=n),await bs(i,o)}catch(i){throw console.error("Error creating notification:",i),new Error("Failed to create notification")}},Ai=async(r,e="user")=>{await _l(r,"role_approval","InfoWriter Request Approved!","Your InfoWriter request has been approved! You can now create and manage articles.",{previousRole:e,newRole:"infowriter"})},dh=async(r,e)=>{const t=e?`Your InfoWriter request has been rejected. Reason: ${e}. You can submit a new request after addressing the feedback.`:"Your InfoWriter request has been rejected. You can submit a new request in the future.";await _l(r,"role_approval","InfoWriter Request Update",t,{previousRole:"user",newRole:"user",status:"rejected",adminNote:e||void 0})},y0=async(r,e,t,s="user")=>{e==="approved"?await Ai(r,s):await dh(r,t)},uh=(r,e)=>{const t=xe(pe(X,"notifications"),Oe("userId","==",r),Wn("createdAt","desc"));return Ee(t,s=>{const n=s.docs.map(i=>{var l;const o=i.data();return{id:i.id,...o,createdAt:o.createdAt.toDate(),readAt:(l=o.readAt)==null?void 0:l.toDate()}});e(n)},s=>{if(s.code==="permission-denied"){console.warn("Permission denied for notifications subscription - user may not be authenticated or verified"),e([]);return}console.error("Error in notifications subscription:",s),e([])})},hh=async r=>{try{const e=ue(X,"notifications",r);await We(e,{isRead:!0,readAt:Le.now()})}catch(e){throw console.error("Error marking notification as read:",e),new Error("Failed to mark notification as read")}},fh=async r=>{try{const e=xe(pe(X,"notifications"),Oe("userId","==",r),Oe("isRead","==",!1)),s=(await vt(e)).docs.map(n=>We(n.ref,{isRead:!0,readAt:Le.now()}));await Promise.all(s)}catch(e){throw console.error("Error marking all notifications as read:",e),new Error("Failed to mark all notifications as read")}},ph=async r=>{try{const e=ue(X,"notifications",r);await Rt(e)}catch(e){throw console.error("Error deleting notification:",e),new Error("Failed to delete notification")}},mh=r=>r.filter(e=>!e.isRead).length,Ro=Object.freeze(Object.defineProperty({__proto__:null,createInfoWriterApprovalNotification:Ai,createInfoWriterRejectionNotification:dh,createInfoWriterStatusNotification:y0,createNotification:_l,deleteNotification:ph,getUnreadNotificationCount:mh,markAllNotificationsAsRead:fh,markNotificationAsRead:hh,subscribeToUserNotifications:uh},Symbol.toStringTag,{value:"Module"})),gh=b.createContext(void 0),b0=({children:r})=>{const{userProfile:e}=ve(),[t,s]=b.useState([]),[n,i]=b.useState(!0),[o,l]=b.useState(new Set);b.useEffect(()=>{if(!(e!=null&&e.uid)){s([]),i(!1),l(new Set);return}return i(!0),uh(e.uid,g=>{i(!1);const y=g.filter(x=>!x.isRead&&x.type==="role_approval"&&!o.has(x.id));y.length>0&&"Notification"in window&&(Notification.permission==="granted"?(y.forEach(x=>{new Notification(x.title,{body:x.message,icon:"/InfoNest/ChatGPT Image Jul 22, 2025, 11_54_47 AM.png",tag:x.id})}),l(x=>{const N=new Set(x);return y.forEach(A=>N.add(A.id)),N})):Notification.permission!=="denied"&&Notification.requestPermission().then(x=>{x==="granted"&&(y.forEach(N=>{new Notification(N.title,{body:N.message,icon:"/InfoNest/ChatGPT Image Jul 22, 2025, 11_54_47 AM.png",tag:N.id})}),l(N=>{const A=new Set(N);return y.forEach(S=>A.add(S.id)),A}))})),s(g)})},[e==null?void 0:e.uid]);const c=async m=>{try{await hh(m)}catch(g){console.error("Error marking notification as read:",g)}},d=async()=>{if(e!=null&&e.uid)try{await fh(e.uid)}catch(m){console.error("Error marking all notifications as read:",m)}},u=async m=>{try{await ph(m)}catch(g){console.error("Error deleting notification:",g)}},h=()=>{},f=mh(t),p={notifications:t,unreadCount:f,loading:n,markAsRead:c,markAllAsRead:d,deleteNotification:u,refreshNotifications:h};return a.jsx(gh.Provider,{value:p,children:r})},xh=b.createContext(void 0),w0=({children:r})=>{const[e,t]=b.useState(new Map),[s,n]=b.useState(new Map),i=u=>e.get(u)||null,o=u=>{if(s.has(u))return;const h=ue(X,"users",u),f=Ee(h,p=>{var m,g;if(p.exists()){const y=p.data(),x={uid:u,email:y.email||"",displayName:y.displayName||"",role:y.role||"user",emailVerified:y.emailVerified||!1,profilePicture:y.profilePicture||"",createdAt:(m=y.createdAt)==null?void 0:m.toDate(),updatedAt:(g=y.updatedAt)==null?void 0:g.toDate(),requestedWriterAccess:y.requestedWriterAccess||!1};t(N=>{const A=new Map(N);return A.set(u,x),A})}else t(y=>{const x=new Map(y);return x.delete(u),x})},p=>{if(p.code==="permission-denied"){t(m=>{const g=new Map(m);return g.delete(u),g}),n(m=>{const g=new Map(m);return g.delete(u),g});return}console.error(`Error subscribing to profile ${u}:`,p)});n(p=>{const m=new Map(p);return m.set(u,f),m})},l=u=>{const h=s.get(u);h&&(h(),n(f=>{const p=new Map(f);return p.delete(u),p}))},c=()=>{s.forEach(u=>{try{u()}catch(h){console.warn("Error unsubscribing from profile:",h)}}),n(new Map),t(new Map)};b.useEffect(()=>Do(ke,h=>{h||c()}),[]),b.useEffect(()=>()=>{s.forEach(u=>u())},[]);const d={profiles:e,getProfile:i,subscribeToProfile:o,unsubscribeFromProfile:l,clearAllProfiles:c};return a.jsx(xh.Provider,{value:d,children:r})},v0=()=>{const r=b.useContext(xh);if(r===void 0)throw new Error("useProfileContext must be used within a ProfileProvider");return r},N0=r=>{const{profiles:e,subscribeToProfile:t}=v0(),[s,n]=b.useState(null);return b.useEffect(()=>{if(!r){n(null);return}t(r)},[r,t]),b.useEffect(()=>{if(!r){n(null);return}const i=e.get(r)||null;n(i)},[e,r]),s};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var j0={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const k0=r=>r.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),G=(r,e)=>{const t=b.forwardRef(({color:s="currentColor",size:n=24,strokeWidth:i=2,absoluteStrokeWidth:o,className:l="",children:c,...d},u)=>b.createElement("svg",{ref:u,...j0,width:n,height:n,stroke:s,strokeWidth:o?Number(i)*24/Number(n):i,className:["lucide",`lucide-${k0(r)}`,l].join(" "),...d},[...e.map(([h,f])=>b.createElement(h,f)),...Array.isArray(c)?c:[c]]));return t.displayName=`${r}`,t};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const St=G("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ci=G("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const S0=G("AlignCenter",[["line",{x1:"21",x2:"3",y1:"6",y2:"6",key:"1fp77t"}],["line",{x1:"17",x2:"7",y1:"12",y2:"12",key:"rsh8ii"}],["line",{x1:"19",x2:"5",y1:"18",y2:"18",key:"1t0tuv"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lt=G("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mi=G("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kc=G("Award",[["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}],["path",{d:"M15.477 12.89 17 22l-5-3-5 3 1.523-9.11",key:"em7aur"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E0=G("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qn=G("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const A0=G("Bold",[["path",{d:"M14 12a4 4 0 0 0 0-8H6v8",key:"v2sylx"}],["path",{d:"M15 20a4 4 0 0 0 0-8H6v8Z",key:"1ef5ya"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zt=G("BookOpen",[["path",{d:"M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z",key:"vv98re"}],["path",{d:"M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z",key:"1cyq3y"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gc=G("BookmarkCheck",[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2Z",key:"169p4p"}],["path",{d:"m9 10 2 2 4-4",key:"1gnqz4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const C0=G("BookmarkX",[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2Z",key:"169p4p"}],["path",{d:"m14.5 7.5-5 5",key:"3lb6iw"}],["path",{d:"m9.5 7.5 5 5",key:"ko136h"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const br=G("Bookmark",[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z",key:"1fy3hk"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Us=G("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const M0=G("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D0=G("CheckCheck",[["path",{d:"M18 6 7 17l-5-5",key:"116fxf"}],["path",{d:"m22 10-7.5 7.5L13 16",key:"ke71qq"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sr=G("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fl=G("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Io=G("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const T0=G("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jt=G("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O0=G("Code",[["polyline",{points:"16 18 22 12 16 6",key:"z7tu5w"}],["polyline",{points:"8 6 2 12 8 18",key:"1eg1df"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R0=G("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gi=G("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const I0=G("Expand",[["path",{d:"m21 21-6-6m6 6v-4.8m0 4.8h-4.8",key:"1c15vz"}],["path",{d:"M3 16.2V21m0 0h4.8M3 21l6-6",key:"1fsnz2"}],["path",{d:"M21 7.8V3m0 0h-4.8M21 3l-6 6",key:"hawz9i"}],["path",{d:"M3 7.8V3m0 0h4.8M3 3l6 6",key:"u9ee12"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P0=G("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zs=G("EyeOff",[["path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24",key:"1jxqfv"}],["path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68",key:"9wicm4"}],["path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61",key:"1jreej"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const us=G("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L0=G("Facebook",[["path",{d:"M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z",key:"1jg4f8"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gt=G("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yh=G("File",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $0=G("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mi=G("Folder",[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _0=G("Fullscreen",[["path",{d:"M3 7V5a2 2 0 0 1 2-2h2",key:"aa7l1z"}],["path",{d:"M17 3h2a2 2 0 0 1 2 2v2",key:"4qcy5o"}],["path",{d:"M21 17v2a2 2 0 0 1-2 2h-2",key:"6vwrx8"}],["path",{d:"M7 21H5a2 2 0 0 1-2-2v-2",key:"ioqczr"}],["rect",{width:"10",height:"8",x:"7",y:"8",rx:"1",key:"vys8me"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bh=G("Github",[["path",{d:"M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4",key:"tonef"}],["path",{d:"M9 18c-4.51 2-5-2-7-2",key:"9comsn"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wh=G("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F0=G("GraduationCap",[["path",{d:"M21.42 10.922a1 1 0 0 0-.019-1.838L12.83 5.18a2 2 0 0 0-1.66 0L2.6 9.08a1 1 0 0 0 0 1.832l8.57 3.908a2 2 0 0 0 1.66 0z",key:"j76jl0"}],["path",{d:"M22 10v6",key:"1lu8f3"}],["path",{d:"M6 12.5V16a6 3 0 0 0 12 0v-3.5",key:"1r8lef"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vh=G("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bl=G("Home",[["path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"y5dka4"}],["polyline",{points:"9 22 9 12 15 12 15 22",key:"e2us08"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _s=G("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yc=G("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B0=G("Italic",[["line",{x1:"19",x2:"10",y1:"4",y2:"4",key:"15jd3p"}],["line",{x1:"14",x2:"5",y1:"20",y2:"20",key:"bu0au3"}],["line",{x1:"15",x2:"9",y1:"4",y2:"20",key:"uljnxc"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U0=G("Link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ul=G("Linkedin",[["path",{d:"M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z",key:"c2jq9f"}],["rect",{width:"4",height:"12",x:"2",y:"9",key:"mk3on5"}],["circle",{cx:"4",cy:"4",r:"2",key:"bt5ra8"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z0=G("ListOrdered",[["line",{x1:"10",x2:"21",y1:"6",y2:"6",key:"76qw6h"}],["line",{x1:"10",x2:"21",y1:"12",y2:"12",key:"16nom4"}],["line",{x1:"10",x2:"21",y1:"18",y2:"18",key:"u3jurt"}],["path",{d:"M4 6h1v4",key:"cnovpq"}],["path",{d:"M4 10h2",key:"16xx2s"}],["path",{d:"M6 18H4c0-1 2-2 2-3s-1-1.5-2-1",key:"m9a95d"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W0=G("List",[["line",{x1:"8",x2:"21",y1:"6",y2:"6",key:"7ey8pc"}],["line",{x1:"8",x2:"21",y1:"12",y2:"12",key:"rjfblc"}],["line",{x1:"8",x2:"21",y1:"18",y2:"18",key:"c3b1m8"}],["line",{x1:"3",x2:"3.01",y1:"6",y2:"6",key:"1g7gq3"}],["line",{x1:"3",x2:"3.01",y1:"12",y2:"12",key:"1pjlvk"}],["line",{x1:"3",x2:"3.01",y1:"18",y2:"18",key:"28t2mc"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qe=G("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hr=G("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H0=G("LogIn",[["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}],["polyline",{points:"10 17 15 12 10 7",key:"1ail0h"}],["line",{x1:"15",x2:"3",y1:"12",y2:"12",key:"v6grx8"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zl=G("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wt=G("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V0=G("Maximize2",[["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["polyline",{points:"9 21 3 21 3 15",key:"1avn1i"}],["line",{x1:"21",x2:"14",y1:"3",y2:"10",key:"ota7mn"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Po=G("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nh=G("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q0=G("Minimize2",[["polyline",{points:"4 14 10 14 10 20",key:"11kfnr"}],["polyline",{points:"20 10 14 10 14 4",key:"rlmsce"}],["line",{x1:"14",x2:"21",y1:"10",y2:"3",key:"o5lafz"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jh=G("MoreVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K0=G("Palette",[["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z",key:"12rzf8"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jc=G("Paperclip",[["path",{d:"m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l8.57-8.57A4 4 0 1 1 18 8.84l-8.59 8.57a2 2 0 0 1-2.83-2.83l8.49-8.48",key:"1u3ebp"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Di=G("Pause",[["rect",{width:"4",height:"16",x:"6",y:"4",key:"iffhe4"}],["rect",{width:"4",height:"16",x:"14",y:"4",key:"sjin7j"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G0=G("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z",key:"ymcmye"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wl=G("PenTool",[["path",{d:"m12 19 7-7 3 3-7 7-3-3z",key:"rklqx2"}],["path",{d:"m18 13-1.5-7.5L2 2l3.5 14.5L13 18l5-5z",key:"1et58u"}],["path",{d:"m2 2 7.586 7.586",key:"etlp93"}],["circle",{cx:"11",cy:"11",r:"2",key:"xmgehs"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kh=G("Play",[["polygon",{points:"5 3 19 12 5 21 5 3",key:"191637"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wa=G("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y0=G("Quote",[["path",{d:"M3 21c3 0 7-1 7-8V5c0-1.25-.756-2.017-2-2H4c-1.25 0-2 .75-2 1.972V11c0 1.25.75 2 2 2 1 0 1 0 1 1v1c0 1-1 2-2 2s-1 .008-1 1.031V20c0 1 0 1 1 1z",key:"4rm80e"}],["path",{d:"M15 21c3 0 7-1 7-8V5c0-1.25-.757-2.017-2-2h-4c-1.25 0-2 .75-2 1.972V11c0 1.25.75 2 2 2h.75c0 2.25.25 4-2.75 4v3c0 1 0 1 1 1z",key:"10za9r"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J0=G("Redo",[["path",{d:"M21 7v6h-6",key:"3ptur4"}],["path",{d:"M3 17a9 9 0 0 1 9-9 9 9 0 0 1 6 2.3l3 2.7",key:"1kgawr"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X0=G("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lo=G("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sh=G("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ti=G("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sn=G("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q0=G("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Er=G("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hl=G("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a2.121 2.121 0 1 1 3 3L12 15l-4 1 1-4Z",key:"1lpok0"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z0=G("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hs=G("Tag",[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Or=G("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vl=G("Twitter",[["path",{d:"M22 4s-.7 2.1-2 3.4c1.6 10-9.4 17.3-18 11.6 2.2.1 4.4-.6 6-2C3 15.5.5 9.6 3 5c2.2 2.6 5.6 4.1 9 4-.9-4.2 4-6.6 7-3.8 1.1 0 3-1.2 3-1.2z",key:"pff0z6"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ex=G("Undo",[["path",{d:"M3 7v6h6",key:"1v2h90"}],["path",{d:"M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13",key:"1r6uu6"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rt=G("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ha=G("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tx=G("UserCog",[["circle",{cx:"18",cy:"15",r:"3",key:"gjjjvw"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M10 15H6a4 4 0 0 0-4 4v2",key:"1nfge6"}],["path",{d:"m21.7 16.4-.9-.3",key:"12j9ji"}],["path",{d:"m15.2 13.9-.9-.3",key:"1fdjdi"}],["path",{d:"m16.6 18.7.3-.9",key:"heedtr"}],["path",{d:"m19.1 12.2.3-.9",key:"1af3ki"}],["path",{d:"m19.6 18.7-.4-1",key:"1x9vze"}],["path",{d:"m16.8 12.3-.4-1",key:"vqeiwj"}],["path",{d:"m14.3 16.6 1-.4",key:"1qlj63"}],["path",{d:"m20.7 13.8 1-.4",key:"1v5t8k"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sa=G("UserMinus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Va=G("UserX",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _e=G("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Eh=G("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fn=G("WifiOff",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}],["path",{d:"M5 12.859a10 10 0 0 1 5.17-2.69",key:"1dl1wf"}],["path",{d:"M19 12.859a10 10 0 0 0-2.007-1.523",key:"4k23kn"}],["path",{d:"M2 8.82a15 15 0 0 1 4.177-2.643",key:"1grhjp"}],["path",{d:"M22 8.82a15 15 0 0 0-11.288-3.764",key:"z3jwby"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ah=G("Wifi",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xi=G("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const et=G("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ql=G("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]),Ps=({children:r,requiredRole:e,requiredRoles:t,fallbackPath:s="/dashboard",showError:n=!0})=>{const{userProfile:i,loading:o,isAuthenticated:l,hasRole:c,hasAnyRole:d,hasRoutePermission:u}=ve(),h=zn(),f=b.useMemo(()=>i?e?c(e):t?d(t):!0:!1,[i,e,t,c,d]),p=b.useMemo(()=>i?u(h.pathname):!1,[u,h.pathname,i]);if(o)return a.jsx("div",{className:"flex items-center justify-center min-h-64",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"animate-spin h-8 w-8 border-2 border-blue-500 border-t-transparent rounded-full mx-auto mb-4"}),a.jsx("p",{className:"text-gray-600",children:"Verifying permissions..."})]})});if(!l)return a.jsx($e,{to:"/auth",state:{from:h},replace:!0});if(!i)return a.jsx("div",{className:"flex items-center justify-center min-h-64",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"animate-spin h-8 w-8 border-2 border-blue-500 border-t-transparent rounded-full mx-auto mb-4"}),a.jsx("p",{className:"text-gray-600",children:"Loading user profile..."})]})});if(!f||!p){if(n){const m=e||(t==null?void 0:t.join(" or "));h.pathname.includes("/article/")&&(t!=null&&t.includes("user"))||K.error(`You need ${m} privileges to access this page`)}return a.jsx($e,{to:s,replace:!0})}return a.jsx(a.Fragment,{children:r})},na=({children:r})=>a.jsx(Ps,{requiredRole:"admin",children:r}),rn=({children:r})=>a.jsx(Ps,{requiredRoles:["user","infowriter","admin"],children:r}),rx=({role:r})=>{const t=(n=>{switch(n){case"admin":return{color:"bg-red-100 text-red-700 border-red-200",icon:Er,label:"Admin"};case"infowriter":return{color:"bg-blue-100 text-blue-700 border-blue-200",icon:Er,label:"InfoWriter"};default:return{color:"bg-gray-100 text-gray-700 border-gray-200",icon:Er,label:"User"}}})(r),s=t.icon;return a.jsxs("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium border ${t.color}`,children:[a.jsx(s,{className:"h-3 w-3 mr-1"}),t.label]})},Ch=["image/jpeg","image/jpg","image/png","image/gif","image/webp"],sx=["application/pdf","text/plain","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"],nx=[...Ch,...sx],ix=10*1024*1024,$o=r=>nx.includes(r.type)?r.size>ix?{isValid:!1,error:"File size too large. Maximum size is 10MB."}:{isValid:!0}:{isValid:!1,error:"File type not supported. Please upload images (JPEG, PNG, GIF, WebP) or documents (PDF, TXT, DOC, DOCX)."},Mh=(r,e,t,s)=>{const n=Date.now(),o=r.replace(/[<>:"/\\|?*]/g,"_").replace(/\s+/g,"_").replace(/_{2,}/g,"_").replace(/^_+|_+$/g,"").split("."),l=o.pop()||"",d=`${o.join(".")||"file"}_${n}.${l}`;if(s==="articles"){if(!t)throw new Error("Article ID is required for article file uploads. Please save the article first to get an ID.");return`${e}/${t}/${d}`}else return`${e}/${d}`},Kl=async(r,e,t="articles",s,n)=>{const i=$o(r);if(!i.isValid)throw console.error("File validation failed:",i.error),new Error(i.error);const o=Mh(r.name,e,n,t),l=`${t}/${o}`,c=Hn(Xs,l);try{const d=await lg(c,r);return{url:await th(d.ref),path:l,name:o.split("/").pop()||r.name,originalName:r.name,size:r.size,type:r.type}}catch(d){throw console.error("Upload failed:",d),d.code==="storage/unauthorized"?new Error("Permission denied. Please check your authentication and storage rules."):d.code==="storage/canceled"?new Error("Upload was canceled."):d.code==="storage/unknown"?new Error("Unknown error occurred. Please check your internet connection and try again."):d.code==="storage/invalid-format"?new Error("Invalid file format. Please check the file type."):d.code==="storage/object-not-found"?new Error("Storage location not found. Please contact support."):new Error(`Upload failed: ${d.message||"Unknown error"}`)}},Gl=async r=>{try{const e=Hn(Xs,r);await Si(e)}catch(e){if(console.error("Error deleting file:",e),(e==null?void 0:e.code)==="storage/object-not-found")return;throw new Error(`Failed to delete file: ${(e==null?void 0:e.message)||"Unknown error"}`)}},Yl=r=>Ch.includes(r),Jl=r=>{if(!r||typeof r!="string")return null;try{if(r.includes("firebasestorage.googleapis.com")){const t=new URL(r).pathname.match(/\/o\/(.+?)\?/);if(t)return decodeURIComponent(t[1])}return r.startsWith("gs://")?r.replace(/^gs:\/\/[^\/]+\//,""):null}catch(e){return console.error("Error extracting file path from URL:",r,e),null}},Dh=async(r,e)=>{console.log(`🗑️ Starting article folder deletion: articles/${r}/${e}`);try{const{listAll:t}=await Fe(async()=>{const{listAll:o}=await import("./firebase-CemElZ1T.js").then(l=>l.L);return{listAll:o}},[]),s=`articles/${r}/${e}`,n=Hn(Xs,s);console.log(`📁 Listing files in folder: ${s}`);const i=await t(n);if(console.log(`📁 Found ${i.items.length} files in folder: ${s}`),i.items.length>0){console.log(`🗑️ Deleting ${i.items.length} files from folder: ${s}`);const o=i.items.map(async(u,h)=>{try{return console.log(`🗑️ Deleting file ${h+1}/${i.items.length}: ${u.fullPath}`),await Si(u),console.log(`✅ Successfully deleted file: ${u.fullPath}`),{success:!0,path:u.fullPath}}catch(f){return console.error(`❌ Failed to delete file: ${u.fullPath}`,f),{success:!1,path:u.fullPath,error:f.message}}}),l=await Promise.all(o),c=l.filter(u=>u.success).length,d=l.filter(u=>!u.success).length;if(console.log(`📊 File deletion summary for ${s}: ${c} successful, ${d} failed`),d>0){const u=l.filter(h=>!h.success);throw console.error(`❌ Failed to delete ${d} files:`,u),new Error(`Failed to delete ${d} out of ${i.items.length} files`)}console.log(`✅ Successfully deleted all ${c} files from folder: ${s}`)}else console.log(`📁 Article folder is empty or doesn't exist: ${s}`);try{const o=await t(n);if(o.items.length>0)throw console.error(`❌ Folder still contains ${o.items.length} files after deletion: ${s}`),new Error(`Folder cleanup incomplete: ${o.items.length} files remain`);console.log(`✅ Verified folder is empty: ${s}`)}catch(o){(o==null?void 0:o.code)==="storage/object-not-found"?console.log(`✅ Folder no longer exists (expected): ${s}`):console.error(`⚠️ Could not verify folder deletion: ${s}`,o)}console.log(`✅ Article folder deletion completed: ${s}`)}catch(t){if(console.error(`❌ Error deleting article folder: articles/${r}/${e}`,t),(t==null?void 0:t.code)==="storage/object-not-found"){console.log(`📁 Article folder already deleted: articles/${r}/${e}`);return}throw new Error(`Failed to delete article folder: ${(t==null?void 0:t.message)||"Unknown error"}`)}},ox=async r=>{console.log(`🗑️ Starting user folder deletion: articles/${r}/`);try{const{listAll:e}=await Fe(async()=>{const{listAll:d}=await import("./firebase-CemElZ1T.js").then(u=>u.L);return{listAll:d}},[]),t=`articles/${r}`,s=Hn(Xs,t);console.log(`📁 Listing all content in user folder: ${t}`);const n=await e(s),i=n.items.length,o=n.prefixes.length;console.log(`📁 Found ${i} files and ${o} subfolders in user folder: ${t}`);let l=0,c=0;if(i>0){console.log(`🗑️ Deleting ${i} files from user folder: ${t}`);const d=n.items.map(async(u,h)=>{try{console.log(`🗑️ Deleting file ${h+1}/${i}: ${u.fullPath}`),await Si(u),console.log(`✅ Successfully deleted file: ${u.fullPath}`),l++}catch(f){console.error(`❌ Failed to delete file: ${u.fullPath}`,f),c++}});await Promise.all(d)}if(o>0){console.log(`🗑️ Deleting ${o} subfolders from user folder: ${t}`);const d=n.prefixes.map(async(u,h)=>{try{const f=u.fullPath;console.log(`🗑️ Deleting subfolder ${h+1}/${o}: ${f}`);const p=await e(u);if(p.items.length>0){const m=p.items.map(async g=>{try{await Si(g),console.log(`✅ Deleted subfolder file: ${g.fullPath}`),l++}catch(y){console.error(`❌ Failed to delete subfolder file: ${g.fullPath}`,y),c++}});await Promise.all(m)}console.log(`✅ Successfully processed subfolder: ${f}`)}catch(f){console.error(`❌ Failed to process subfolder: ${u.fullPath}`,f)}});await Promise.all(d)}console.log(`📊 User folder deletion summary: ${l} files deleted, ${c} files failed`),c>0&&console.warn(`⚠️ Some files could not be deleted: ${c} failures`);try{const d=await e(s);d.items.length>0||d.prefixes.length>0?console.warn(`⚠️ User folder still contains content after deletion: ${d.items.length} files, ${d.prefixes.length} folders`):console.log(`✅ Verified user folder is empty: ${t}`)}catch(d){(d==null?void 0:d.code)==="storage/object-not-found"?console.log(`✅ User folder no longer exists (expected): ${t}`):console.error(`⚠️ Could not verify user folder deletion: ${t}`,d)}console.log(`✅ User folder deletion completed: ${t}`)}catch(e){if(console.error(`❌ Error deleting user folder: articles/${r}`,e),(e==null?void 0:e.code)==="storage/object-not-found"){console.log(`📁 User folder already deleted: articles/${r}`);return}throw new Error(`Failed to delete user folder: ${(e==null?void 0:e.message)||"Unknown error"}`)}},qa=Object.freeze(Object.defineProperty({__proto__:null,deleteArticleFolder:Dh,deleteFile:Gl,deleteUserFolder:ox,extractFilePathFromUrl:Jl,generateFileName:Mh,isImageFile:Yl,uploadFile:Kl,validateFile:$o},Symbol.toStringTag,{value:"Module"})),Th=r=>r.toLowerCase().replace(/[^a-z0-9 -]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").trim(),Oh=async r=>{try{const e=ue(pe(X,"articles")),t=Th(r.title),s={...r,id:e.id,slug:t,createdAt:new Date,updatedAt:new Date,likes:0,likedBy:[]},n={...s,createdAt:Le.fromDate(s.createdAt),updatedAt:Le.fromDate(s.updatedAt)};return s.publishedAt?n.publishedAt=Le.fromDate(s.publishedAt):n.publishedAt=null,await bs(e,n),e.id}catch(e){throw console.error("Error in createArticle:",e),e}},_o=async(r,e)=>{const t=ue(X,"articles",r),s=await It(t);if(!s.exists())throw new Error("Article not found");const n=s.data(),i={updatedAt:Le.fromDate(new Date),slug:e.title?Th(e.title):n.slug};if(Object.keys(e).forEach(o=>{e[o]!==void 0&&(i[o]=e[o])}),e.status==="published"&&n.status!=="published"){const o=new Date;i.publishedAt=Le.fromDate(o),i.updatedAt=Le.fromDate(o)}else e.publishedAt?i.publishedAt=Le.fromDate(e.publishedAt):e.publishedAt===null&&(i.publishedAt=null);await We(t,i)},Rh=async r=>{console.log(`🗑️ Starting article deletion: ${r}`);try{const e=ue(X,"articles",r);console.log(`📄 Fetching article document: ${r}`);const t=await It(e);if(t.exists()){const s=t.data(),n=s.authorId;if(console.log(`📄 Article found - Author: ${n}, Title: ${s.title}`),console.log(`🗑️ Deleting article document from Firestore: ${r}`),await Rt(e),console.log(`✅ Article document deleted from Firestore: ${r}`),(await It(e)).exists())throw new Error(`❌ Article document still exists after deletion: ${r}`);if(console.log(`✅ Verified article document deletion: ${r}`),n)try{console.log(`🗑️ Starting folder cleanup: articles/${n}/${r}`),await Dh(n,r),console.log(`✅ Deleted article folder: articles/${n}/${r}`)}catch(o){console.error(`⚠️ Failed to delete article folder: articles/${n}/${r}`,o),console.log("⚠️ Article folder deletion failed, but article document was removed from database")}console.log(`✅ Article deletion completed successfully: ${r}`)}else{console.log(`📄 Article document not found: ${r}`);try{await Rt(e),console.log(`✅ Deleted empty article reference: ${r}`)}catch(s){console.error(`⚠️ Failed to delete article reference: ${r}`,s)}}}catch(e){throw console.error(`❌ Error during article deletion: ${r}`,e),e}},yi=async r=>{const e=Date.now();console.log(`🗑️ Starting comprehensive deletion of article: ${r}`);try{const t=Date.now();await Ih(r);const s=Date.now()-t;console.log(`✅ Related data cleanup completed in ${s}ms`);const n=Date.now();await Rh(r);const i=Date.now()-n;console.log(`✅ Article deletion completed in ${i}ms`);const o=Date.now()-e;console.log(`✅ Successfully deleted article and all related data: ${r} (Total time: ${o}ms)`)}catch(t){const s=Date.now()-e;throw console.error(`❌ Error during comprehensive article deletion: ${r} (Failed after ${s}ms)`,t),t}},Ih=async r=>{const e=Date.now();console.log(`🧹 Cleaning up related data for article: ${r}`);const t=[];t.push((async()=>{try{console.log(`🔍 Searching for saved article references for: ${r}`);const n=xe(pe(X,"savedArticles"),Oe("articleId","==",r)),i=await vt(n);if(i.empty)console.log(`📝 No saved article references found for: ${r}`);else{console.log(`🗑️ Found ${i.docs.length} saved article references to delete`);const o=i.docs.map(c=>c.data().userId||"unknown");console.log(`👥 Users who had this article saved: ${o.join(", ")}`);const l=i.docs.map(async c=>{try{await Rt(c.ref),console.log(`✅ Removed saved article reference: ${c.id}`)}catch(d){console.error(`❌ Failed to delete saved article reference: ${c.id}`,d)}});await Promise.all(l),console.log(`✅ Successfully deleted ${i.docs.length} saved article references`)}}catch(n){console.error("⚠️ Failed to clean up saved articles:",n)}})()),t.push((async()=>{try{const n=xe(pe(X,"shareEvents"),Oe("articleId","==",r)),i=await vt(n);if(!i.empty){const o=i.docs.map(l=>Rt(l.ref));await Promise.all(o),console.log(`✅ Deleted ${i.docs.length} share events`)}}catch(n){console.error("⚠️ Failed to clean up share events:",n)}})()),t.push((async()=>{try{const n=pe(X,"articles",r,"comments"),i=await vt(n);if(!i.empty){const o=[];for(const l of i.docs){const c=pe(l.ref,"replies"),d=await vt(c);d.empty||d.docs.forEach(u=>{o.push(Rt(u.ref))}),o.push(Rt(l.ref))}await Promise.all(o),console.log(`✅ Deleted ${i.docs.length} comments and their replies`)}}catch(n){console.error("⚠️ Failed to clean up comments:",n)}})()),await Promise.all(t);const s=Date.now()-e;console.log(`✅ Completed cleanup of related data for article: ${r} (Time: ${s}ms)`)},Ph=async(r,e,t,s,n,i)=>{console.log(`🗑️ deleteArticleByRole called: articleId=${r}, userRole=${e}, userId=${t}, authorId=${s}, authorRole=${n}`);let o=null;try{const l=ue(X,"articles",r),c=await It(l);c.exists()?(o=c.data(),console.log(`📄 Article data retrieved: ${o.title}`)):console.log(`⚠️ Article document not found: ${r}`)}catch(l){console.error("Error fetching article data for notification:",l)}if(t===s){console.log("👤 Self-deletion detected - performing hard delete without notification"),await yi(r);return}if(e==="admin"&&t!==s){if(console.log("👨‍💼 Admin deleting other user's article - performing hard delete with notification"),await yi(r),o&&n==="infowriter")try{console.log(`📧 Sending deletion notification to InfoWriter: ${s}`);const{createArticleDeletionNotification:l}=await Fe(async()=>{const{createArticleDeletionNotification:c}=await Promise.resolve().then(()=>Ro);return{createArticleDeletionNotification:c}},void 0);await l(s,o.title||"Untitled Article",i),console.log("✅ Deletion notification sent successfully")}catch(l){console.error("Error sending article deletion notification:",l)}else console.log("📝 No notification sent - author is not InfoWriter or no article data");return}if(e==="admin"){console.log("👨‍💼 Admin deleting own article - performing hard delete without notification"),await yi(r);return}throw new Error("Unauthorized deletion attempt")},Lh=async()=>{var r,e;console.log("🔧 Starting article date fix process...");try{const t=xe(pe(X,"articles")),s=await vt(t);let n=0,i=s.docs.length;console.log(`📊 Found ${i} articles to check`);for(const o of s.docs){const l=o.data(),c=o.id,d=(r=l.publishedAt)==null?void 0:r.toDate(),u=(e=l.updatedAt)==null?void 0:e.toDate();if(d&&u&&d>u){console.log(`🔧 Fixing dates for article: ${l.title} (${c})`),console.log(`   Before: publishedAt=${d.toISOString()}, updatedAt=${u.toISOString()}`);const h=u,f=d;await We(ue(X,"articles",c),{publishedAt:Le.fromDate(h),updatedAt:Le.fromDate(f)}),console.log(`   After:  publishedAt=${h.toISOString()}, updatedAt=${f.toISOString()}`),n++}}console.log(`✅ Date fix completed: ${n} articles fixed out of ${i} total`)}catch(t){throw console.error("❌ Error fixing article dates:",t),t}};typeof window<"u"&&(window.fixArticleDates=Lh);const Fo=async r=>{var s;const e=ue(X,"articles",r),t=await It(e);if(t.exists()){const n=t.data();return{...n,createdAt:n.createdAt.toDate(),updatedAt:n.updatedAt.toDate(),publishedAt:(s=n.publishedAt)==null?void 0:s.toDate()}}return null},Xl=async(r={})=>{let e=xe(pe(X,"articles"));const t=[];r.status&&t.push(["status","==",r.status]),r.authorId&&t.push(["authorId","==",r.authorId]),r.categories&&r.categories.length>0&&t.push(["categories","array-contains-any",r.categories]),t.forEach(([i,o,l])=>{e=xe(e,Oe(i,o,l))}),r.authorId||r.status?r.limit&&(e=xe(e,Wc(r.limit*2))):(e=xe(e,Wn("updatedAt","desc")),r.limit&&(e=xe(e,Wc(r.limit))));let n=(await vt(e)).docs.map(i=>{var l,c,d;const o=i.data();return{...o,createdAt:((l=o.createdAt)==null?void 0:l.toDate())||new Date,updatedAt:((c=o.updatedAt)==null?void 0:c.toDate())||new Date,publishedAt:(d=o.publishedAt)==null?void 0:d.toDate()}});return(r.authorId||r.status)&&(n=n.sort((i,o)=>o.updatedAt.getTime()-i.updatedAt.getTime()),r.limit&&(n=n.slice(0,r.limit))),n},$h=async()=>Xl({status:"published"}),_h=async r=>Xl({authorId:r}),Fh=async(r,e,t)=>{try{console.log(`📤 Recording share event: ${e} for article ${r}, user: ${t||"anonymous"}`);const s={articleId:r,userId:t||null,shareMethod:e,sharedAt:Le.now(),userAgent:typeof navigator<"u"?navigator.userAgent:"Unknown"};console.log("📤 Share event data:",s);const n=ue(pe(X,"shareEvents"));await bs(n,s),console.log(`✅ Share event recorded successfully with ID: ${n.id}`);try{const i=ue(X,"articles",r);await We(i,{shareCount:Sr(1)}),console.log("✅ Article share count updated")}catch(i){console.error("⚠️ Failed to update share count (share event still recorded):",i)}}catch(s){throw console.error("❌ Failed to record share event:",s),console.error("❌ Error details:",{code:s==null?void 0:s.code,message:s==null?void 0:s.message,articleId:r,shareMethod:e,userId:t}),s}},Bh=(r,e)=>{const t=`https://twitter.com/intent/tweet?url=${encodeURIComponent(r)}&text=${encodeURIComponent(e)}`;window.open(t,"_blank","width=600,height=400")},Uh=r=>{const e=`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(r)}`;window.open(e,"_blank","width=600,height=400")},zh=(r,e)=>{const t=`https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(r)}&title=${encodeURIComponent(e)}`;window.open(t,"_blank","width=600,height=400")},Wh=(r,e)=>{const t=encodeURIComponent(`Check out this article: ${e}`),s=encodeURIComponent(`I thought you might find this article interesting:

${e}

${r}`);window.location.href=`mailto:?subject=${t}&body=${s}`},Hh=async r=>{try{return await navigator.clipboard.writeText(r),!0}catch{const t=document.createElement("textarea");t.value=r,document.body.appendChild(t),t.select();const s=document.execCommand("copy");return document.body.removeChild(t),s}},Ql=Object.freeze(Object.defineProperty({__proto__:null,cleanupArticleRelatedData:Ih,copyToClipboard:Hh,createArticle:Oh,deleteArticle:Rh,deleteArticleByRole:Ph,fixArticleDates:Lh,getArticle:Fo,getArticles:Xl,getPublishedArticles:$h,getUserArticles:_h,hardDeleteArticle:yi,recordShareEvent:Fh,shareToFacebook:Uh,shareToLinkedIn:zh,shareToTwitter:Bh,shareViaEmail:Wh,updateArticle:_o},Symbol.toStringTag,{value:"Module"}));function Oi(r){"@babel/helpers - typeof";return Oi=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Oi(r)}function fs(r){if(r===null||r===!0||r===!1)return NaN;var e=Number(r);return isNaN(e)?e:e<0?Math.ceil(e):Math.floor(e)}function Te(r,e){if(e.length<r)throw new TypeError(r+" argument"+(r>1?"s":"")+" required, but only "+e.length+" present")}function Ce(r){Te(1,arguments);var e=Object.prototype.toString.call(r);return r instanceof Date||Oi(r)==="object"&&e==="[object Date]"?new Date(r.getTime()):typeof r=="number"||e==="[object Number]"?new Date(r):((typeof r=="string"||e==="[object String]")&&typeof console<"u"&&(console.warn("Starting with v2.0.0-beta.1 date-fns doesn't accept strings as date arguments. Please use `parseISO` to parse strings. See: https://github.com/date-fns/date-fns/blob/master/docs/upgradeGuide.md#string-arguments"),console.warn(new Error().stack)),new Date(NaN))}function ax(r,e){Te(2,arguments);var t=Ce(r).getTime(),s=fs(e);return new Date(t+s)}var lx={};function qn(){return lx}function Ka(r){var e=new Date(Date.UTC(r.getFullYear(),r.getMonth(),r.getDate(),r.getHours(),r.getMinutes(),r.getSeconds(),r.getMilliseconds()));return e.setUTCFullYear(r.getFullYear()),r.getTime()-e.getTime()}function bi(r,e){Te(2,arguments);var t=Ce(r),s=Ce(e),n=t.getTime()-s.getTime();return n<0?-1:n>0?1:n}function cx(r){return Te(1,arguments),r instanceof Date||Oi(r)==="object"&&Object.prototype.toString.call(r)==="[object Date]"}function dx(r){if(Te(1,arguments),!cx(r)&&typeof r!="number")return!1;var e=Ce(r);return!isNaN(Number(e))}function ux(r,e){Te(2,arguments);var t=Ce(r),s=Ce(e),n=t.getFullYear()-s.getFullYear(),i=t.getMonth()-s.getMonth();return n*12+i}function hx(r,e){return Te(2,arguments),Ce(r).getTime()-Ce(e).getTime()}var fx={ceil:Math.ceil,round:Math.round,floor:Math.floor,trunc:function(e){return e<0?Math.ceil(e):Math.floor(e)}},px="trunc";function mx(r){return fx[px]}function gx(r){Te(1,arguments);var e=Ce(r);return e.setHours(23,59,59,999),e}function xx(r){Te(1,arguments);var e=Ce(r),t=e.getMonth();return e.setFullYear(e.getFullYear(),t+1,0),e.setHours(23,59,59,999),e}function yx(r){Te(1,arguments);var e=Ce(r);return gx(e).getTime()===xx(e).getTime()}function bx(r,e){Te(2,arguments);var t=Ce(r),s=Ce(e),n=bi(t,s),i=Math.abs(ux(t,s)),o;if(i<1)o=0;else{t.getMonth()===1&&t.getDate()>27&&t.setDate(30),t.setMonth(t.getMonth()-n*i);var l=bi(t,s)===-n;yx(Ce(r))&&i===1&&bi(r,s)===1&&(l=!1),o=n*(i-Number(l))}return o===0?0:o}function wx(r,e,t){Te(2,arguments);var s=hx(r,e)/1e3;return mx()(s)}function vx(r,e){Te(2,arguments);var t=fs(e);return ax(r,-t)}var Nx=864e5;function jx(r){Te(1,arguments);var e=Ce(r),t=e.getTime();e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0);var s=e.getTime(),n=t-s;return Math.floor(n/Nx)+1}function Ri(r){Te(1,arguments);var e=1,t=Ce(r),s=t.getUTCDay(),n=(s<e?7:0)+s-e;return t.setUTCDate(t.getUTCDate()-n),t.setUTCHours(0,0,0,0),t}function Vh(r){Te(1,arguments);var e=Ce(r),t=e.getUTCFullYear(),s=new Date(0);s.setUTCFullYear(t+1,0,4),s.setUTCHours(0,0,0,0);var n=Ri(s),i=new Date(0);i.setUTCFullYear(t,0,4),i.setUTCHours(0,0,0,0);var o=Ri(i);return e.getTime()>=n.getTime()?t+1:e.getTime()>=o.getTime()?t:t-1}function kx(r){Te(1,arguments);var e=Vh(r),t=new Date(0);t.setUTCFullYear(e,0,4),t.setUTCHours(0,0,0,0);var s=Ri(t);return s}var Sx=6048e5;function Ex(r){Te(1,arguments);var e=Ce(r),t=Ri(e).getTime()-kx(e).getTime();return Math.round(t/Sx)+1}function Ii(r,e){var t,s,n,i,o,l,c,d;Te(1,arguments);var u=qn(),h=fs((t=(s=(n=(i=e==null?void 0:e.weekStartsOn)!==null&&i!==void 0?i:e==null||(o=e.locale)===null||o===void 0||(l=o.options)===null||l===void 0?void 0:l.weekStartsOn)!==null&&n!==void 0?n:u.weekStartsOn)!==null&&s!==void 0?s:(c=u.locale)===null||c===void 0||(d=c.options)===null||d===void 0?void 0:d.weekStartsOn)!==null&&t!==void 0?t:0);if(!(h>=0&&h<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var f=Ce(r),p=f.getUTCDay(),m=(p<h?7:0)+p-h;return f.setUTCDate(f.getUTCDate()-m),f.setUTCHours(0,0,0,0),f}function qh(r,e){var t,s,n,i,o,l,c,d;Te(1,arguments);var u=Ce(r),h=u.getUTCFullYear(),f=qn(),p=fs((t=(s=(n=(i=e==null?void 0:e.firstWeekContainsDate)!==null&&i!==void 0?i:e==null||(o=e.locale)===null||o===void 0||(l=o.options)===null||l===void 0?void 0:l.firstWeekContainsDate)!==null&&n!==void 0?n:f.firstWeekContainsDate)!==null&&s!==void 0?s:(c=f.locale)===null||c===void 0||(d=c.options)===null||d===void 0?void 0:d.firstWeekContainsDate)!==null&&t!==void 0?t:1);if(!(p>=1&&p<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var m=new Date(0);m.setUTCFullYear(h+1,0,p),m.setUTCHours(0,0,0,0);var g=Ii(m,e),y=new Date(0);y.setUTCFullYear(h,0,p),y.setUTCHours(0,0,0,0);var x=Ii(y,e);return u.getTime()>=g.getTime()?h+1:u.getTime()>=x.getTime()?h:h-1}function Ax(r,e){var t,s,n,i,o,l,c,d;Te(1,arguments);var u=qn(),h=fs((t=(s=(n=(i=e==null?void 0:e.firstWeekContainsDate)!==null&&i!==void 0?i:e==null||(o=e.locale)===null||o===void 0||(l=o.options)===null||l===void 0?void 0:l.firstWeekContainsDate)!==null&&n!==void 0?n:u.firstWeekContainsDate)!==null&&s!==void 0?s:(c=u.locale)===null||c===void 0||(d=c.options)===null||d===void 0?void 0:d.firstWeekContainsDate)!==null&&t!==void 0?t:1),f=qh(r,e),p=new Date(0);p.setUTCFullYear(f,0,h),p.setUTCHours(0,0,0,0);var m=Ii(p,e);return m}var Cx=6048e5;function Mx(r,e){Te(1,arguments);var t=Ce(r),s=Ii(t,e).getTime()-Ax(t,e).getTime();return Math.round(s/Cx)+1}function Se(r,e){for(var t=r<0?"-":"",s=Math.abs(r).toString();s.length<e;)s="0"+s;return t+s}var cr={y:function(e,t){var s=e.getUTCFullYear(),n=s>0?s:1-s;return Se(t==="yy"?n%100:n,t.length)},M:function(e,t){var s=e.getUTCMonth();return t==="M"?String(s+1):Se(s+1,2)},d:function(e,t){return Se(e.getUTCDate(),t.length)},a:function(e,t){var s=e.getUTCHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return s.toUpperCase();case"aaa":return s;case"aaaaa":return s[0];case"aaaa":default:return s==="am"?"a.m.":"p.m."}},h:function(e,t){return Se(e.getUTCHours()%12||12,t.length)},H:function(e,t){return Se(e.getUTCHours(),t.length)},m:function(e,t){return Se(e.getUTCMinutes(),t.length)},s:function(e,t){return Se(e.getUTCSeconds(),t.length)},S:function(e,t){var s=t.length,n=e.getUTCMilliseconds(),i=Math.floor(n*Math.pow(10,s-3));return Se(i,t.length)}},As={midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},Dx={G:function(e,t,s){var n=e.getUTCFullYear()>0?1:0;switch(t){case"G":case"GG":case"GGG":return s.era(n,{width:"abbreviated"});case"GGGGG":return s.era(n,{width:"narrow"});case"GGGG":default:return s.era(n,{width:"wide"})}},y:function(e,t,s){if(t==="yo"){var n=e.getUTCFullYear(),i=n>0?n:1-n;return s.ordinalNumber(i,{unit:"year"})}return cr.y(e,t)},Y:function(e,t,s,n){var i=qh(e,n),o=i>0?i:1-i;if(t==="YY"){var l=o%100;return Se(l,2)}return t==="Yo"?s.ordinalNumber(o,{unit:"year"}):Se(o,t.length)},R:function(e,t){var s=Vh(e);return Se(s,t.length)},u:function(e,t){var s=e.getUTCFullYear();return Se(s,t.length)},Q:function(e,t,s){var n=Math.ceil((e.getUTCMonth()+1)/3);switch(t){case"Q":return String(n);case"QQ":return Se(n,2);case"Qo":return s.ordinalNumber(n,{unit:"quarter"});case"QQQ":return s.quarter(n,{width:"abbreviated",context:"formatting"});case"QQQQQ":return s.quarter(n,{width:"narrow",context:"formatting"});case"QQQQ":default:return s.quarter(n,{width:"wide",context:"formatting"})}},q:function(e,t,s){var n=Math.ceil((e.getUTCMonth()+1)/3);switch(t){case"q":return String(n);case"qq":return Se(n,2);case"qo":return s.ordinalNumber(n,{unit:"quarter"});case"qqq":return s.quarter(n,{width:"abbreviated",context:"standalone"});case"qqqqq":return s.quarter(n,{width:"narrow",context:"standalone"});case"qqqq":default:return s.quarter(n,{width:"wide",context:"standalone"})}},M:function(e,t,s){var n=e.getUTCMonth();switch(t){case"M":case"MM":return cr.M(e,t);case"Mo":return s.ordinalNumber(n+1,{unit:"month"});case"MMM":return s.month(n,{width:"abbreviated",context:"formatting"});case"MMMMM":return s.month(n,{width:"narrow",context:"formatting"});case"MMMM":default:return s.month(n,{width:"wide",context:"formatting"})}},L:function(e,t,s){var n=e.getUTCMonth();switch(t){case"L":return String(n+1);case"LL":return Se(n+1,2);case"Lo":return s.ordinalNumber(n+1,{unit:"month"});case"LLL":return s.month(n,{width:"abbreviated",context:"standalone"});case"LLLLL":return s.month(n,{width:"narrow",context:"standalone"});case"LLLL":default:return s.month(n,{width:"wide",context:"standalone"})}},w:function(e,t,s,n){var i=Mx(e,n);return t==="wo"?s.ordinalNumber(i,{unit:"week"}):Se(i,t.length)},I:function(e,t,s){var n=Ex(e);return t==="Io"?s.ordinalNumber(n,{unit:"week"}):Se(n,t.length)},d:function(e,t,s){return t==="do"?s.ordinalNumber(e.getUTCDate(),{unit:"date"}):cr.d(e,t)},D:function(e,t,s){var n=jx(e);return t==="Do"?s.ordinalNumber(n,{unit:"dayOfYear"}):Se(n,t.length)},E:function(e,t,s){var n=e.getUTCDay();switch(t){case"E":case"EE":case"EEE":return s.day(n,{width:"abbreviated",context:"formatting"});case"EEEEE":return s.day(n,{width:"narrow",context:"formatting"});case"EEEEEE":return s.day(n,{width:"short",context:"formatting"});case"EEEE":default:return s.day(n,{width:"wide",context:"formatting"})}},e:function(e,t,s,n){var i=e.getUTCDay(),o=(i-n.weekStartsOn+8)%7||7;switch(t){case"e":return String(o);case"ee":return Se(o,2);case"eo":return s.ordinalNumber(o,{unit:"day"});case"eee":return s.day(i,{width:"abbreviated",context:"formatting"});case"eeeee":return s.day(i,{width:"narrow",context:"formatting"});case"eeeeee":return s.day(i,{width:"short",context:"formatting"});case"eeee":default:return s.day(i,{width:"wide",context:"formatting"})}},c:function(e,t,s,n){var i=e.getUTCDay(),o=(i-n.weekStartsOn+8)%7||7;switch(t){case"c":return String(o);case"cc":return Se(o,t.length);case"co":return s.ordinalNumber(o,{unit:"day"});case"ccc":return s.day(i,{width:"abbreviated",context:"standalone"});case"ccccc":return s.day(i,{width:"narrow",context:"standalone"});case"cccccc":return s.day(i,{width:"short",context:"standalone"});case"cccc":default:return s.day(i,{width:"wide",context:"standalone"})}},i:function(e,t,s){var n=e.getUTCDay(),i=n===0?7:n;switch(t){case"i":return String(i);case"ii":return Se(i,t.length);case"io":return s.ordinalNumber(i,{unit:"day"});case"iii":return s.day(n,{width:"abbreviated",context:"formatting"});case"iiiii":return s.day(n,{width:"narrow",context:"formatting"});case"iiiiii":return s.day(n,{width:"short",context:"formatting"});case"iiii":default:return s.day(n,{width:"wide",context:"formatting"})}},a:function(e,t,s){var n=e.getUTCHours(),i=n/12>=1?"pm":"am";switch(t){case"a":case"aa":return s.dayPeriod(i,{width:"abbreviated",context:"formatting"});case"aaa":return s.dayPeriod(i,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return s.dayPeriod(i,{width:"narrow",context:"formatting"});case"aaaa":default:return s.dayPeriod(i,{width:"wide",context:"formatting"})}},b:function(e,t,s){var n=e.getUTCHours(),i;switch(n===12?i=As.noon:n===0?i=As.midnight:i=n/12>=1?"pm":"am",t){case"b":case"bb":return s.dayPeriod(i,{width:"abbreviated",context:"formatting"});case"bbb":return s.dayPeriod(i,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return s.dayPeriod(i,{width:"narrow",context:"formatting"});case"bbbb":default:return s.dayPeriod(i,{width:"wide",context:"formatting"})}},B:function(e,t,s){var n=e.getUTCHours(),i;switch(n>=17?i=As.evening:n>=12?i=As.afternoon:n>=4?i=As.morning:i=As.night,t){case"B":case"BB":case"BBB":return s.dayPeriod(i,{width:"abbreviated",context:"formatting"});case"BBBBB":return s.dayPeriod(i,{width:"narrow",context:"formatting"});case"BBBB":default:return s.dayPeriod(i,{width:"wide",context:"formatting"})}},h:function(e,t,s){if(t==="ho"){var n=e.getUTCHours()%12;return n===0&&(n=12),s.ordinalNumber(n,{unit:"hour"})}return cr.h(e,t)},H:function(e,t,s){return t==="Ho"?s.ordinalNumber(e.getUTCHours(),{unit:"hour"}):cr.H(e,t)},K:function(e,t,s){var n=e.getUTCHours()%12;return t==="Ko"?s.ordinalNumber(n,{unit:"hour"}):Se(n,t.length)},k:function(e,t,s){var n=e.getUTCHours();return n===0&&(n=24),t==="ko"?s.ordinalNumber(n,{unit:"hour"}):Se(n,t.length)},m:function(e,t,s){return t==="mo"?s.ordinalNumber(e.getUTCMinutes(),{unit:"minute"}):cr.m(e,t)},s:function(e,t,s){return t==="so"?s.ordinalNumber(e.getUTCSeconds(),{unit:"second"}):cr.s(e,t)},S:function(e,t){return cr.S(e,t)},X:function(e,t,s,n){var i=n._originalDate||e,o=i.getTimezoneOffset();if(o===0)return"Z";switch(t){case"X":return Qc(o);case"XXXX":case"XX":return Wr(o);case"XXXXX":case"XXX":default:return Wr(o,":")}},x:function(e,t,s,n){var i=n._originalDate||e,o=i.getTimezoneOffset();switch(t){case"x":return Qc(o);case"xxxx":case"xx":return Wr(o);case"xxxxx":case"xxx":default:return Wr(o,":")}},O:function(e,t,s,n){var i=n._originalDate||e,o=i.getTimezoneOffset();switch(t){case"O":case"OO":case"OOO":return"GMT"+Xc(o,":");case"OOOO":default:return"GMT"+Wr(o,":")}},z:function(e,t,s,n){var i=n._originalDate||e,o=i.getTimezoneOffset();switch(t){case"z":case"zz":case"zzz":return"GMT"+Xc(o,":");case"zzzz":default:return"GMT"+Wr(o,":")}},t:function(e,t,s,n){var i=n._originalDate||e,o=Math.floor(i.getTime()/1e3);return Se(o,t.length)},T:function(e,t,s,n){var i=n._originalDate||e,o=i.getTime();return Se(o,t.length)}};function Xc(r,e){var t=r>0?"-":"+",s=Math.abs(r),n=Math.floor(s/60),i=s%60;if(i===0)return t+String(n);var o=e;return t+String(n)+o+Se(i,2)}function Qc(r,e){if(r%60===0){var t=r>0?"-":"+";return t+Se(Math.abs(r)/60,2)}return Wr(r,e)}function Wr(r,e){var t=e||"",s=r>0?"-":"+",n=Math.abs(r),i=Se(Math.floor(n/60),2),o=Se(n%60,2);return s+i+t+o}var Zc=function(e,t){switch(e){case"P":return t.date({width:"short"});case"PP":return t.date({width:"medium"});case"PPP":return t.date({width:"long"});case"PPPP":default:return t.date({width:"full"})}},Kh=function(e,t){switch(e){case"p":return t.time({width:"short"});case"pp":return t.time({width:"medium"});case"ppp":return t.time({width:"long"});case"pppp":default:return t.time({width:"full"})}},Tx=function(e,t){var s=e.match(/(P+)(p+)?/)||[],n=s[1],i=s[2];if(!i)return Zc(e,t);var o;switch(n){case"P":o=t.dateTime({width:"short"});break;case"PP":o=t.dateTime({width:"medium"});break;case"PPP":o=t.dateTime({width:"long"});break;case"PPPP":default:o=t.dateTime({width:"full"});break}return o.replace("{{date}}",Zc(n,t)).replace("{{time}}",Kh(i,t))},Ox={p:Kh,P:Tx},Rx=["D","DD"],Ix=["YY","YYYY"];function Px(r){return Rx.indexOf(r)!==-1}function Lx(r){return Ix.indexOf(r)!==-1}function ed(r,e,t){if(r==="YYYY")throw new RangeError("Use `yyyy` instead of `YYYY` (in `".concat(e,"`) for formatting years to the input `").concat(t,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if(r==="YY")throw new RangeError("Use `yy` instead of `YY` (in `".concat(e,"`) for formatting years to the input `").concat(t,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if(r==="D")throw new RangeError("Use `d` instead of `D` (in `".concat(e,"`) for formatting days of the month to the input `").concat(t,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if(r==="DD")throw new RangeError("Use `dd` instead of `DD` (in `".concat(e,"`) for formatting days of the month to the input `").concat(t,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"))}var $x={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},_x=function(e,t,s){var n,i=$x[e];return typeof i=="string"?n=i:t===1?n=i.one:n=i.other.replace("{{count}}",t.toString()),s!=null&&s.addSuffix?s.comparison&&s.comparison>0?"in "+n:n+" ago":n};function ia(r){return function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=e.width?String(e.width):r.defaultWidth,s=r.formats[t]||r.formats[r.defaultWidth];return s}}var Fx={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},Bx={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},Ux={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},zx={date:ia({formats:Fx,defaultWidth:"full"}),time:ia({formats:Bx,defaultWidth:"full"}),dateTime:ia({formats:Ux,defaultWidth:"full"})},Wx={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},Hx=function(e,t,s,n){return Wx[e]};function sn(r){return function(e,t){var s=t!=null&&t.context?String(t.context):"standalone",n;if(s==="formatting"&&r.formattingValues){var i=r.defaultFormattingWidth||r.defaultWidth,o=t!=null&&t.width?String(t.width):i;n=r.formattingValues[o]||r.formattingValues[i]}else{var l=r.defaultWidth,c=t!=null&&t.width?String(t.width):r.defaultWidth;n=r.values[c]||r.values[l]}var d=r.argumentCallback?r.argumentCallback(e):e;return n[d]}}var Vx={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},qx={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},Kx={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},Gx={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},Yx={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},Jx={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},Xx=function(e,t){var s=Number(e),n=s%100;if(n>20||n<10)switch(n%10){case 1:return s+"st";case 2:return s+"nd";case 3:return s+"rd"}return s+"th"},Qx={ordinalNumber:Xx,era:sn({values:Vx,defaultWidth:"wide"}),quarter:sn({values:qx,defaultWidth:"wide",argumentCallback:function(e){return e-1}}),month:sn({values:Kx,defaultWidth:"wide"}),day:sn({values:Gx,defaultWidth:"wide"}),dayPeriod:sn({values:Yx,defaultWidth:"wide",formattingValues:Jx,defaultFormattingWidth:"wide"})};function nn(r){return function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=t.width,n=s&&r.matchPatterns[s]||r.matchPatterns[r.defaultMatchWidth],i=e.match(n);if(!i)return null;var o=i[0],l=s&&r.parsePatterns[s]||r.parsePatterns[r.defaultParseWidth],c=Array.isArray(l)?ey(l,function(h){return h.test(o)}):Zx(l,function(h){return h.test(o)}),d;d=r.valueCallback?r.valueCallback(c):c,d=t.valueCallback?t.valueCallback(d):d;var u=e.slice(o.length);return{value:d,rest:u}}}function Zx(r,e){for(var t in r)if(r.hasOwnProperty(t)&&e(r[t]))return t}function ey(r,e){for(var t=0;t<r.length;t++)if(e(r[t]))return t}function ty(r){return function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=e.match(r.matchPattern);if(!s)return null;var n=s[0],i=e.match(r.parsePattern);if(!i)return null;var o=r.valueCallback?r.valueCallback(i[0]):i[0];o=t.valueCallback?t.valueCallback(o):o;var l=e.slice(n.length);return{value:o,rest:l}}}var ry=/^(\d+)(th|st|nd|rd)?/i,sy=/\d+/i,ny={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},iy={any:[/^b/i,/^(a|c)/i]},oy={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},ay={any:[/1/i,/2/i,/3/i,/4/i]},ly={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},cy={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},dy={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},uy={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},hy={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},fy={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},py={ordinalNumber:ty({matchPattern:ry,parsePattern:sy,valueCallback:function(e){return parseInt(e,10)}}),era:nn({matchPatterns:ny,defaultMatchWidth:"wide",parsePatterns:iy,defaultParseWidth:"any"}),quarter:nn({matchPatterns:oy,defaultMatchWidth:"wide",parsePatterns:ay,defaultParseWidth:"any",valueCallback:function(e){return e+1}}),month:nn({matchPatterns:ly,defaultMatchWidth:"wide",parsePatterns:cy,defaultParseWidth:"any"}),day:nn({matchPatterns:dy,defaultMatchWidth:"wide",parsePatterns:uy,defaultParseWidth:"any"}),dayPeriod:nn({matchPatterns:hy,defaultMatchWidth:"any",parsePatterns:fy,defaultParseWidth:"any"})},Gh={code:"en-US",formatDistance:_x,formatLong:zx,formatRelative:Hx,localize:Qx,match:py,options:{weekStartsOn:0,firstWeekContainsDate:1}},my=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,gy=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,xy=/^'([^]*?)'?$/,yy=/''/g,by=/[a-zA-Z]/;function Pi(r,e,t){var s,n,i,o,l,c,d,u,h,f,p,m,g,y;Te(2,arguments);var x=String(e),N=qn(),A=(s=(n=void 0)!==null&&n!==void 0?n:N.locale)!==null&&s!==void 0?s:Gh,S=fs((i=(o=(l=(c=void 0)!==null&&c!==void 0?c:void 0)!==null&&l!==void 0?l:N.firstWeekContainsDate)!==null&&o!==void 0?o:(d=N.locale)===null||d===void 0||(u=d.options)===null||u===void 0?void 0:u.firstWeekContainsDate)!==null&&i!==void 0?i:1);if(!(S>=1&&S<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var k=fs((h=(f=(p=(m=void 0)!==null&&m!==void 0?m:void 0)!==null&&p!==void 0?p:N.weekStartsOn)!==null&&f!==void 0?f:(g=N.locale)===null||g===void 0||(y=g.options)===null||y===void 0?void 0:y.weekStartsOn)!==null&&h!==void 0?h:0);if(!(k>=0&&k<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");if(!A.localize)throw new RangeError("locale must contain localize property");if(!A.formatLong)throw new RangeError("locale must contain formatLong property");var R=Ce(r);if(!dx(R))throw new RangeError("Invalid time value");var j=Ka(R),w=vx(R,j),v={firstWeekContainsDate:S,weekStartsOn:k,locale:A,_originalDate:R},D=x.match(gy).map(function(C){var P=C[0];if(P==="p"||P==="P"){var O=Ox[P];return O(C,A.formatLong)}return C}).join("").match(my).map(function(C){if(C==="''")return"'";var P=C[0];if(P==="'")return wy(C);var O=Dx[P];if(O)return Lx(C)&&ed(C,e,String(r)),Px(C)&&ed(C,e,String(r)),O(w,C,A.localize,v);if(P.match(by))throw new RangeError("Format string contains an unescaped latin alphabet character `"+P+"`");return C}).join("");return D}function wy(r){var e=r.match(xy);return e?e[1].replace(yy,"'"):r}function Yh(r,e){if(r==null)throw new TypeError("assign requires that input parameter not be null or undefined");for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(r[t]=e[t]);return r}function vy(r){return Yh({},r)}var td=1440,Ny=2520,oa=43200,jy=86400;function ky(r,e,t){var s,n;Te(2,arguments);var i=qn(),o=(s=(n=t==null?void 0:t.locale)!==null&&n!==void 0?n:i.locale)!==null&&s!==void 0?s:Gh;if(!o.formatDistance)throw new RangeError("locale must contain formatDistance property");var l=bi(r,e);if(isNaN(l))throw new RangeError("Invalid time value");var c=Yh(vy(t),{addSuffix:!!(t!=null&&t.addSuffix),comparison:l}),d,u;l>0?(d=Ce(e),u=Ce(r)):(d=Ce(r),u=Ce(e));var h=wx(u,d),f=(Ka(u)-Ka(d))/1e3,p=Math.round((h-f)/60),m;if(p<2)return t!=null&&t.includeSeconds?h<5?o.formatDistance("lessThanXSeconds",5,c):h<10?o.formatDistance("lessThanXSeconds",10,c):h<20?o.formatDistance("lessThanXSeconds",20,c):h<40?o.formatDistance("halfAMinute",0,c):h<60?o.formatDistance("lessThanXMinutes",1,c):o.formatDistance("xMinutes",1,c):p===0?o.formatDistance("lessThanXMinutes",1,c):o.formatDistance("xMinutes",p,c);if(p<45)return o.formatDistance("xMinutes",p,c);if(p<90)return o.formatDistance("aboutXHours",1,c);if(p<td){var g=Math.round(p/60);return o.formatDistance("aboutXHours",g,c)}else{if(p<Ny)return o.formatDistance("xDays",1,c);if(p<oa){var y=Math.round(p/td);return o.formatDistance("xDays",y,c)}else if(p<jy)return m=Math.round(p/oa),o.formatDistance("aboutXMonths",m,c)}if(m=bx(u,d),m<12){var x=Math.round(p/oa);return o.formatDistance("xMonths",x,c)}else{var N=m%12,A=Math.floor(m/12);return N<3?o.formatDistance("aboutXYears",A,c):N<9?o.formatDistance("overXYears",A,c):o.formatDistance("almostXYears",A+1,c)}}function Ht(r,e){return Te(1,arguments),ky(r,Date.now(),e)}function ar(r){return Array.isArray?Array.isArray(r):Qh(r)==="[object Array]"}function Sy(r){if(typeof r=="string")return r;let e=r+"";return e=="0"&&1/r==-1/0?"-0":e}function Ey(r){return r==null?"":Sy(r)}function Bt(r){return typeof r=="string"}function Jh(r){return typeof r=="number"}function Ay(r){return r===!0||r===!1||Cy(r)&&Qh(r)=="[object Boolean]"}function Xh(r){return typeof r=="object"}function Cy(r){return Xh(r)&&r!==null}function bt(r){return r!=null}function aa(r){return!r.trim().length}function Qh(r){return r==null?r===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(r)}const My="Incorrect 'index' type",Dy=r=>`Invalid value for key ${r}`,Ty=r=>`Pattern length exceeds max of ${r}.`,Oy=r=>`Missing ${r} property in key`,Ry=r=>`Property 'weight' in key '${r}' must be a positive integer`,rd=Object.prototype.hasOwnProperty;class Iy{constructor(e){this._keys=[],this._keyMap={};let t=0;e.forEach(s=>{let n=Zh(s);this._keys.push(n),this._keyMap[n.id]=n,t+=n.weight}),this._keys.forEach(s=>{s.weight/=t})}get(e){return this._keyMap[e]}keys(){return this._keys}toJSON(){return JSON.stringify(this._keys)}}function Zh(r){let e=null,t=null,s=null,n=1,i=null;if(Bt(r)||ar(r))s=r,e=sd(r),t=Ga(r);else{if(!rd.call(r,"name"))throw new Error(Oy("name"));const o=r.name;if(s=o,rd.call(r,"weight")&&(n=r.weight,n<=0))throw new Error(Ry(o));e=sd(o),t=Ga(o),i=r.getFn}return{path:e,id:t,weight:n,src:s,getFn:i}}function sd(r){return ar(r)?r:r.split(".")}function Ga(r){return ar(r)?r.join("."):r}function Py(r,e){let t=[],s=!1;const n=(i,o,l)=>{if(bt(i))if(!o[l])t.push(i);else{let c=o[l];const d=i[c];if(!bt(d))return;if(l===o.length-1&&(Bt(d)||Jh(d)||Ay(d)))t.push(Ey(d));else if(ar(d)){s=!0;for(let u=0,h=d.length;u<h;u+=1)n(d[u],o,l+1)}else o.length&&n(d,o,l+1)}};return n(r,Bt(e)?e.split("."):e,0),s?t:t[0]}const Ly={includeMatches:!1,findAllMatches:!1,minMatchCharLength:1},$y={isCaseSensitive:!1,ignoreDiacritics:!1,includeScore:!1,keys:[],shouldSort:!0,sortFn:(r,e)=>r.score===e.score?r.idx<e.idx?-1:1:r.score<e.score?-1:1},_y={location:0,threshold:.6,distance:100},Fy={useExtendedSearch:!1,getFn:Py,ignoreLocation:!1,ignoreFieldNorm:!1,fieldNormWeight:1};var ae={...$y,...Ly,..._y,...Fy};const By=/[^ ]+/g;function Uy(r=1,e=3){const t=new Map,s=Math.pow(10,e);return{get(n){const i=n.match(By).length;if(t.has(i))return t.get(i);const o=1/Math.pow(i,.5*r),l=parseFloat(Math.round(o*s)/s);return t.set(i,l),l},clear(){t.clear()}}}class Zl{constructor({getFn:e=ae.getFn,fieldNormWeight:t=ae.fieldNormWeight}={}){this.norm=Uy(t,3),this.getFn=e,this.isCreated=!1,this.setIndexRecords()}setSources(e=[]){this.docs=e}setIndexRecords(e=[]){this.records=e}setKeys(e=[]){this.keys=e,this._keysMap={},e.forEach((t,s)=>{this._keysMap[t.id]=s})}create(){this.isCreated||!this.docs.length||(this.isCreated=!0,Bt(this.docs[0])?this.docs.forEach((e,t)=>{this._addString(e,t)}):this.docs.forEach((e,t)=>{this._addObject(e,t)}),this.norm.clear())}add(e){const t=this.size();Bt(e)?this._addString(e,t):this._addObject(e,t)}removeAt(e){this.records.splice(e,1);for(let t=e,s=this.size();t<s;t+=1)this.records[t].i-=1}getValueForItemAtKeyId(e,t){return e[this._keysMap[t]]}size(){return this.records.length}_addString(e,t){if(!bt(e)||aa(e))return;let s={v:e,i:t,n:this.norm.get(e)};this.records.push(s)}_addObject(e,t){let s={i:t,$:{}};this.keys.forEach((n,i)=>{let o=n.getFn?n.getFn(e):this.getFn(e,n.path);if(bt(o)){if(ar(o)){let l=[];const c=[{nestedArrIndex:-1,value:o}];for(;c.length;){const{nestedArrIndex:d,value:u}=c.pop();if(bt(u))if(Bt(u)&&!aa(u)){let h={v:u,i:d,n:this.norm.get(u)};l.push(h)}else ar(u)&&u.forEach((h,f)=>{c.push({nestedArrIndex:f,value:h})})}s.$[i]=l}else if(Bt(o)&&!aa(o)){let l={v:o,n:this.norm.get(o)};s.$[i]=l}}}),this.records.push(s)}toJSON(){return{keys:this.keys,records:this.records}}}function ef(r,e,{getFn:t=ae.getFn,fieldNormWeight:s=ae.fieldNormWeight}={}){const n=new Zl({getFn:t,fieldNormWeight:s});return n.setKeys(r.map(Zh)),n.setSources(e),n.create(),n}function zy(r,{getFn:e=ae.getFn,fieldNormWeight:t=ae.fieldNormWeight}={}){const{keys:s,records:n}=r,i=new Zl({getFn:e,fieldNormWeight:t});return i.setKeys(s),i.setIndexRecords(n),i}function Zn(r,{errors:e=0,currentLocation:t=0,expectedLocation:s=0,distance:n=ae.distance,ignoreLocation:i=ae.ignoreLocation}={}){const o=e/r.length;if(i)return o;const l=Math.abs(s-t);return n?o+l/n:l?1:o}function Wy(r=[],e=ae.minMatchCharLength){let t=[],s=-1,n=-1,i=0;for(let o=r.length;i<o;i+=1){let l=r[i];l&&s===-1?s=i:!l&&s!==-1&&(n=i-1,n-s+1>=e&&t.push([s,n]),s=-1)}return r[i-1]&&i-s>=e&&t.push([s,i-1]),t}const Vr=32;function Hy(r,e,t,{location:s=ae.location,distance:n=ae.distance,threshold:i=ae.threshold,findAllMatches:o=ae.findAllMatches,minMatchCharLength:l=ae.minMatchCharLength,includeMatches:c=ae.includeMatches,ignoreLocation:d=ae.ignoreLocation}={}){if(e.length>Vr)throw new Error(Ty(Vr));const u=e.length,h=r.length,f=Math.max(0,Math.min(s,h));let p=i,m=f;const g=l>1||c,y=g?Array(h):[];let x;for(;(x=r.indexOf(e,m))>-1;){let j=Zn(e,{currentLocation:x,expectedLocation:f,distance:n,ignoreLocation:d});if(p=Math.min(j,p),m=x+u,g){let w=0;for(;w<u;)y[x+w]=1,w+=1}}m=-1;let N=[],A=1,S=u+h;const k=1<<u-1;for(let j=0;j<u;j+=1){let w=0,v=S;for(;w<v;)Zn(e,{errors:j,currentLocation:f+v,expectedLocation:f,distance:n,ignoreLocation:d})<=p?w=v:S=v,v=Math.floor((S-w)/2+w);S=v;let D=Math.max(1,f-v+1),C=o?h:Math.min(f+v,h)+u,P=Array(C+2);P[C+1]=(1<<j)-1;for(let W=C;W>=D;W-=1){let H=W-1,I=t[r.charAt(H)];if(g&&(y[H]=+!!I),P[W]=(P[W+1]<<1|1)&I,j&&(P[W]|=(N[W+1]|N[W])<<1|1|N[W+1]),P[W]&k&&(A=Zn(e,{errors:j,currentLocation:H,expectedLocation:f,distance:n,ignoreLocation:d}),A<=p)){if(p=A,m=H,m<=f)break;D=Math.max(1,2*f-m)}}if(Zn(e,{errors:j+1,currentLocation:f,expectedLocation:f,distance:n,ignoreLocation:d})>p)break;N=P}const R={isMatch:m>=0,score:Math.max(.001,A)};if(g){const j=Wy(y,l);j.length?c&&(R.indices=j):R.isMatch=!1}return R}function Vy(r){let e={};for(let t=0,s=r.length;t<s;t+=1){const n=r.charAt(t);e[n]=(e[n]||0)|1<<s-t-1}return e}const Li=String.prototype.normalize?r=>r.normalize("NFD").replace(/[\u0300-\u036F\u0483-\u0489\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u0711\u0730-\u074A\u07A6-\u07B0\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D3-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u09FE\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A70\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0AFA-\u0AFF\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B62\u0B63\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0C00-\u0C04\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0D00-\u0D03\u0D3B\u0D3C\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D82\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0EB1\u0EB4-\u0EB9\u0EBB\u0EBC\u0EC8-\u0ECD\u0F18\u0F19\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F\u109A-\u109D\u135D-\u135F\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u180B-\u180D\u1885\u1886\u18A9\u1920-\u192B\u1930-\u193B\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F\u1AB0-\u1ABE\u1B00-\u1B04\u1B34-\u1B44\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BE6-\u1BF3\u1C24-\u1C37\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF2-\u1CF4\u1CF7-\u1CF9\u1DC0-\u1DF9\u1DFB-\u1DFF\u20D0-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA66F-\uA672\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA880\uA881\uA8B4-\uA8C5\uA8E0-\uA8F1\uA8FF\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9E5\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F]/g,""):r=>r;class tf{constructor(e,{location:t=ae.location,threshold:s=ae.threshold,distance:n=ae.distance,includeMatches:i=ae.includeMatches,findAllMatches:o=ae.findAllMatches,minMatchCharLength:l=ae.minMatchCharLength,isCaseSensitive:c=ae.isCaseSensitive,ignoreDiacritics:d=ae.ignoreDiacritics,ignoreLocation:u=ae.ignoreLocation}={}){if(this.options={location:t,threshold:s,distance:n,includeMatches:i,findAllMatches:o,minMatchCharLength:l,isCaseSensitive:c,ignoreDiacritics:d,ignoreLocation:u},e=c?e:e.toLowerCase(),e=d?Li(e):e,this.pattern=e,this.chunks=[],!this.pattern.length)return;const h=(p,m)=>{this.chunks.push({pattern:p,alphabet:Vy(p),startIndex:m})},f=this.pattern.length;if(f>Vr){let p=0;const m=f%Vr,g=f-m;for(;p<g;)h(this.pattern.substr(p,Vr),p),p+=Vr;if(m){const y=f-Vr;h(this.pattern.substr(y),y)}}else h(this.pattern,0)}searchIn(e){const{isCaseSensitive:t,ignoreDiacritics:s,includeMatches:n}=this.options;if(e=t?e:e.toLowerCase(),e=s?Li(e):e,this.pattern===e){let g={isMatch:!0,score:0};return n&&(g.indices=[[0,e.length-1]]),g}const{location:i,distance:o,threshold:l,findAllMatches:c,minMatchCharLength:d,ignoreLocation:u}=this.options;let h=[],f=0,p=!1;this.chunks.forEach(({pattern:g,alphabet:y,startIndex:x})=>{const{isMatch:N,score:A,indices:S}=Hy(e,g,y,{location:i+x,distance:o,threshold:l,findAllMatches:c,minMatchCharLength:d,includeMatches:n,ignoreLocation:u});N&&(p=!0),f+=A,N&&S&&(h=[...h,...S])});let m={isMatch:p,score:p?f/this.chunks.length:1};return p&&n&&(m.indices=h),m}}class Pr{constructor(e){this.pattern=e}static isMultiMatch(e){return nd(e,this.multiRegex)}static isSingleMatch(e){return nd(e,this.singleRegex)}search(){}}function nd(r,e){const t=r.match(e);return t?t[1]:null}class qy extends Pr{constructor(e){super(e)}static get type(){return"exact"}static get multiRegex(){return/^="(.*)"$/}static get singleRegex(){return/^=(.*)$/}search(e){const t=e===this.pattern;return{isMatch:t,score:t?0:1,indices:[0,this.pattern.length-1]}}}class Ky extends Pr{constructor(e){super(e)}static get type(){return"inverse-exact"}static get multiRegex(){return/^!"(.*)"$/}static get singleRegex(){return/^!(.*)$/}search(e){const s=e.indexOf(this.pattern)===-1;return{isMatch:s,score:s?0:1,indices:[0,e.length-1]}}}class Gy extends Pr{constructor(e){super(e)}static get type(){return"prefix-exact"}static get multiRegex(){return/^\^"(.*)"$/}static get singleRegex(){return/^\^(.*)$/}search(e){const t=e.startsWith(this.pattern);return{isMatch:t,score:t?0:1,indices:[0,this.pattern.length-1]}}}class Yy extends Pr{constructor(e){super(e)}static get type(){return"inverse-prefix-exact"}static get multiRegex(){return/^!\^"(.*)"$/}static get singleRegex(){return/^!\^(.*)$/}search(e){const t=!e.startsWith(this.pattern);return{isMatch:t,score:t?0:1,indices:[0,e.length-1]}}}class Jy extends Pr{constructor(e){super(e)}static get type(){return"suffix-exact"}static get multiRegex(){return/^"(.*)"\$$/}static get singleRegex(){return/^(.*)\$$/}search(e){const t=e.endsWith(this.pattern);return{isMatch:t,score:t?0:1,indices:[e.length-this.pattern.length,e.length-1]}}}class Xy extends Pr{constructor(e){super(e)}static get type(){return"inverse-suffix-exact"}static get multiRegex(){return/^!"(.*)"\$$/}static get singleRegex(){return/^!(.*)\$$/}search(e){const t=!e.endsWith(this.pattern);return{isMatch:t,score:t?0:1,indices:[0,e.length-1]}}}class rf extends Pr{constructor(e,{location:t=ae.location,threshold:s=ae.threshold,distance:n=ae.distance,includeMatches:i=ae.includeMatches,findAllMatches:o=ae.findAllMatches,minMatchCharLength:l=ae.minMatchCharLength,isCaseSensitive:c=ae.isCaseSensitive,ignoreDiacritics:d=ae.ignoreDiacritics,ignoreLocation:u=ae.ignoreLocation}={}){super(e),this._bitapSearch=new tf(e,{location:t,threshold:s,distance:n,includeMatches:i,findAllMatches:o,minMatchCharLength:l,isCaseSensitive:c,ignoreDiacritics:d,ignoreLocation:u})}static get type(){return"fuzzy"}static get multiRegex(){return/^"(.*)"$/}static get singleRegex(){return/^(.*)$/}search(e){return this._bitapSearch.searchIn(e)}}class sf extends Pr{constructor(e){super(e)}static get type(){return"include"}static get multiRegex(){return/^'"(.*)"$/}static get singleRegex(){return/^'(.*)$/}search(e){let t=0,s;const n=[],i=this.pattern.length;for(;(s=e.indexOf(this.pattern,t))>-1;)t=s+i,n.push([s,t-1]);const o=!!n.length;return{isMatch:o,score:o?0:1,indices:n}}}const Ya=[qy,sf,Gy,Yy,Xy,Jy,Ky,rf],id=Ya.length,Qy=/ +(?=(?:[^\"]*\"[^\"]*\")*[^\"]*$)/,Zy="|";function eb(r,e={}){return r.split(Zy).map(t=>{let s=t.trim().split(Qy).filter(i=>i&&!!i.trim()),n=[];for(let i=0,o=s.length;i<o;i+=1){const l=s[i];let c=!1,d=-1;for(;!c&&++d<id;){const u=Ya[d];let h=u.isMultiMatch(l);h&&(n.push(new u(h,e)),c=!0)}if(!c)for(d=-1;++d<id;){const u=Ya[d];let h=u.isSingleMatch(l);if(h){n.push(new u(h,e));break}}}return n})}const tb=new Set([rf.type,sf.type]);class rb{constructor(e,{isCaseSensitive:t=ae.isCaseSensitive,ignoreDiacritics:s=ae.ignoreDiacritics,includeMatches:n=ae.includeMatches,minMatchCharLength:i=ae.minMatchCharLength,ignoreLocation:o=ae.ignoreLocation,findAllMatches:l=ae.findAllMatches,location:c=ae.location,threshold:d=ae.threshold,distance:u=ae.distance}={}){this.query=null,this.options={isCaseSensitive:t,ignoreDiacritics:s,includeMatches:n,minMatchCharLength:i,findAllMatches:l,ignoreLocation:o,location:c,threshold:d,distance:u},e=t?e:e.toLowerCase(),e=s?Li(e):e,this.pattern=e,this.query=eb(this.pattern,this.options)}static condition(e,t){return t.useExtendedSearch}searchIn(e){const t=this.query;if(!t)return{isMatch:!1,score:1};const{includeMatches:s,isCaseSensitive:n,ignoreDiacritics:i}=this.options;e=n?e:e.toLowerCase(),e=i?Li(e):e;let o=0,l=[],c=0;for(let d=0,u=t.length;d<u;d+=1){const h=t[d];l.length=0,o=0;for(let f=0,p=h.length;f<p;f+=1){const m=h[f],{isMatch:g,indices:y,score:x}=m.search(e);if(g){if(o+=1,c+=x,s){const N=m.constructor.type;tb.has(N)?l=[...l,...y]:l.push(y)}}else{c=0,o=0,l.length=0;break}}if(o){let f={isMatch:!0,score:c/o};return s&&(f.indices=l),f}}return{isMatch:!1,score:1}}}const Ja=[];function sb(...r){Ja.push(...r)}function Xa(r,e){for(let t=0,s=Ja.length;t<s;t+=1){let n=Ja[t];if(n.condition(r,e))return new n(r,e)}return new tf(r,e)}const $i={AND:"$and",OR:"$or"},Qa={PATH:"$path",PATTERN:"$val"},Za=r=>!!(r[$i.AND]||r[$i.OR]),nb=r=>!!r[Qa.PATH],ib=r=>!ar(r)&&Xh(r)&&!Za(r),od=r=>({[$i.AND]:Object.keys(r).map(e=>({[e]:r[e]}))});function nf(r,e,{auto:t=!0}={}){const s=n=>{let i=Object.keys(n);const o=nb(n);if(!o&&i.length>1&&!Za(n))return s(od(n));if(ib(n)){const c=o?n[Qa.PATH]:i[0],d=o?n[Qa.PATTERN]:n[c];if(!Bt(d))throw new Error(Dy(c));const u={keyId:Ga(c),pattern:d};return t&&(u.searcher=Xa(d,e)),u}let l={children:[],operator:i[0]};return i.forEach(c=>{const d=n[c];ar(d)&&d.forEach(u=>{l.children.push(s(u))})}),l};return Za(r)||(r=od(r)),s(r)}function ob(r,{ignoreFieldNorm:e=ae.ignoreFieldNorm}){r.forEach(t=>{let s=1;t.matches.forEach(({key:n,norm:i,score:o})=>{const l=n?n.weight:null;s*=Math.pow(o===0&&l?Number.EPSILON:o,(l||1)*(e?1:i))}),t.score=s})}function ab(r,e){const t=r.matches;e.matches=[],bt(t)&&t.forEach(s=>{if(!bt(s.indices)||!s.indices.length)return;const{indices:n,value:i}=s;let o={indices:n,value:i};s.key&&(o.key=s.key.src),s.idx>-1&&(o.refIndex=s.idx),e.matches.push(o)})}function lb(r,e){e.score=r.score}function cb(r,e,{includeMatches:t=ae.includeMatches,includeScore:s=ae.includeScore}={}){const n=[];return t&&n.push(ab),s&&n.push(lb),r.map(i=>{const{idx:o}=i,l={item:e[o],refIndex:o};return n.length&&n.forEach(c=>{c(i,l)}),l})}class Qs{constructor(e,t={},s){this.options={...ae,...t},this.options.useExtendedSearch,this._keyStore=new Iy(this.options.keys),this.setCollection(e,s)}setCollection(e,t){if(this._docs=e,t&&!(t instanceof Zl))throw new Error(My);this._myIndex=t||ef(this.options.keys,this._docs,{getFn:this.options.getFn,fieldNormWeight:this.options.fieldNormWeight})}add(e){bt(e)&&(this._docs.push(e),this._myIndex.add(e))}remove(e=()=>!1){const t=[];for(let s=0,n=this._docs.length;s<n;s+=1){const i=this._docs[s];e(i,s)&&(this.removeAt(s),s-=1,n-=1,t.push(i))}return t}removeAt(e){this._docs.splice(e,1),this._myIndex.removeAt(e)}getIndex(){return this._myIndex}search(e,{limit:t=-1}={}){const{includeMatches:s,includeScore:n,shouldSort:i,sortFn:o,ignoreFieldNorm:l}=this.options;let c=Bt(e)?Bt(this._docs[0])?this._searchStringList(e):this._searchObjectList(e):this._searchLogical(e);return ob(c,{ignoreFieldNorm:l}),i&&c.sort(o),Jh(t)&&t>-1&&(c=c.slice(0,t)),cb(c,this._docs,{includeMatches:s,includeScore:n})}_searchStringList(e){const t=Xa(e,this.options),{records:s}=this._myIndex,n=[];return s.forEach(({v:i,i:o,n:l})=>{if(!bt(i))return;const{isMatch:c,score:d,indices:u}=t.searchIn(i);c&&n.push({item:i,idx:o,matches:[{score:d,value:i,norm:l,indices:u}]})}),n}_searchLogical(e){const t=nf(e,this.options),s=(l,c,d)=>{if(!l.children){const{keyId:h,searcher:f}=l,p=this._findMatches({key:this._keyStore.get(h),value:this._myIndex.getValueForItemAtKeyId(c,h),searcher:f});return p&&p.length?[{idx:d,item:c,matches:p}]:[]}const u=[];for(let h=0,f=l.children.length;h<f;h+=1){const p=l.children[h],m=s(p,c,d);if(m.length)u.push(...m);else if(l.operator===$i.AND)return[]}return u},n=this._myIndex.records,i={},o=[];return n.forEach(({$:l,i:c})=>{if(bt(l)){let d=s(t,l,c);d.length&&(i[c]||(i[c]={idx:c,item:l,matches:[]},o.push(i[c])),d.forEach(({matches:u})=>{i[c].matches.push(...u)}))}}),o}_searchObjectList(e){const t=Xa(e,this.options),{keys:s,records:n}=this._myIndex,i=[];return n.forEach(({$:o,i:l})=>{if(!bt(o))return;let c=[];s.forEach((d,u)=>{c.push(...this._findMatches({key:d,value:o[u],searcher:t}))}),c.length&&i.push({idx:l,item:o,matches:c})}),i}_findMatches({key:e,value:t,searcher:s}){if(!bt(t))return[];let n=[];if(ar(t))t.forEach(({v:i,i:o,n:l})=>{if(!bt(i))return;const{isMatch:c,score:d,indices:u}=s.searchIn(i);c&&n.push({score:d,key:e,value:i,idx:o,norm:l,indices:u})});else{const{v:i,n:o}=t,{isMatch:l,score:c,indices:d}=s.searchIn(i);l&&n.push({score:c,key:e,value:i,norm:o,indices:d})}return n}}Qs.version="7.1.0";Qs.createIndex=ef;Qs.parseIndex=zy;Qs.config=ae;Qs.parseQuery=nf;sb(rb);const _i=r=>{if(!r)return"";const e=document.createElement("div");return e.innerHTML=r,e.textContent||e.innerText||""},of=r=>{const e=document.createElement("div");return e.innerHTML=r,e},db=r=>{if(!r.trim())return"";const e=r.trim().split(/\s+/);if(e.length===1){const s=e[0];return`='${s}' | ${s}`}return e.map(s=>`(='${s}' | ${s})`).join(" ")},la=(r,e)=>{if(!e.trim())return r;const t=_i(r),s=e.toLowerCase().trim().split(/\s+/);let n=t;return s.forEach(i=>{const o=new RegExp(`\\b(${i.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")})\\b`,"gi");n=n.replace(o,'<mark class="bg-yellow-200 px-0.5 rounded">$1</mark>')}),a.jsx("span",{dangerouslySetInnerHTML:{__html:n}})},ub=["Technology","Business","Tutorials","Science","News & Updates"],vs=({placeholder:r="Search articles...",className:e="",onResultClick:t,variant:s="default",filterByCurrentUser:n=!1,isHeaderSearch:i=!1})=>{const{userProfile:o}=ve(),[l,c]=b.useState(!1),[d,u]=b.useState(""),[h,f]=b.useState([]),[p,m]=b.useState(!1),[g,y]=b.useState([]),[x,N]=b.useState([]),[A,S]=b.useState(null),k=b.useRef(null),R=b.useRef(null);b.useEffect(()=>{(async()=>{try{let _;n&&(o!=null&&o.uid)?_=await _h(o.uid):_=await $h(),y(_);const Y=new Qs(_,{keys:[{name:"title",weight:.4},{name:"categories",weight:.3},{name:"tags",weight:.2},{name:"authorName",weight:.15},{name:"excerpt",weight:.1,getFn:Z=>_i(Z.excerpt||"")},{name:"content",weight:.05,getFn:Z=>_i(Z.content||"")}],includeScore:!0,includeMatches:!0,threshold:.3,ignoreLocation:!0,minMatchCharLength:1,useExtendedSearch:!0,shouldSort:!0});S(Y)}catch(_){console.error("Error loading articles:",_)}})(),v()},[n,o==null?void 0:o.uid]),b.useEffect(()=>{l&&k.current&&setTimeout(()=>{var L;(L=k.current)==null||L.focus()},150),v()},[l]),b.useEffect(()=>{o&&v()},[o]),b.useEffect(()=>{const L=_=>{R.current&&!R.current.contains(_.target)&&(c(!1),u(""),f([]))};return l&&document.addEventListener("mousedown",L),()=>{document.removeEventListener("mousedown",L)}},[l]);const j=b.useCallback(hb(L=>{if(!L.trim()||!A){f([]),m(!1);return}m(!0);try{const _=db(L),Z=A.search(_).sort((J,te)=>(J.score||0)-(te.score||0)).map(J=>J.item).slice(0,6);f(Z)}catch(_){console.error("Search error:",_),f([])}m(!1)},300),[A]),w=L=>{const _=L.target.value;u(_),j(_)},v=()=>{try{const L=(o==null?void 0:o.uid)||"anonymous",_=localStorage.getItem(`recent_searches_${L}`);if(_){const Y=JSON.parse(_),Z=Date.now()-30*24*60*60*1e3,J=Y.filter(te=>te.timestamp>Z).slice(0,5);N(J),J.length!==Y.length&&localStorage.setItem(`recent_searches_${L}`,JSON.stringify(J))}}catch(L){console.error("Error loading recent searches:",L)}},D=L=>{if(L.trim())try{const _=(o==null?void 0:o.uid)||"anonymous",Y=localStorage.getItem(`recent_searches_${_}`);let Z=Y?JSON.parse(Y):[];Z=Z.filter(J=>J.query.toLowerCase()!==L.toLowerCase()),Z.unshift({query:L,timestamp:Date.now()}),Z=Z.slice(0,5),localStorage.setItem(`recent_searches_${_}`,JSON.stringify(Z)),N(Z)}catch(_){console.error("Error saving recent search:",_)}},C=L=>{D(d),t==null||t(),c(!1),u(""),f([])},P=L=>{u(L),j(L)},O=L=>{u(L),j(L)},W=()=>{u(""),f([])},H=()=>{l||c(!0)},I=()=>{switch(s){case"minimal":return"bg-gradient-to-r from-[#1D4ED8] via-[#7C3AED] to-[#EC4899] p-[1px] rounded-xl hover:shadow-md";case"hero":return"bg-gradient-to-r from-[#1D4ED8] via-[#7C3AED] to-[#EC4899] p-[2px] rounded-2xl shadow-lg hover:shadow-xl";default:return"bg-gradient-to-r from-[#1D4ED8] via-[#7C3AED] to-[#EC4899] p-[1px] rounded-xl hover:shadow-md"}},E=()=>{switch(s){case"minimal":return"bg-white/95 backdrop-blur-sm rounded-xl";case"hero":return"bg-white/95 backdrop-blur-sm rounded-2xl";default:return"bg-white/95 backdrop-blur-sm rounded-xl"}},F=()=>{switch(s){case"hero":return"px-6 py-5 text-lg";case"minimal":return"px-4 py-2";default:return"px-4 py-3"}},U=()=>{switch(s){case"hero":return"h-6 w-6";default:return"h-5 w-5"}};return a.jsxs("div",{ref:R,className:`w-full transition-all duration-300 ease-out ${i?"relative":""} ${e}`,style:{zIndex:l?9999:"auto"},children:[a.jsx("div",{onClick:H,className:`
          w-full cursor-pointer transition-all duration-300 ease-out
          ${I()}
          ${l?"shadow-xl transform scale-[1.01]":"shadow-sm hover:shadow-md"}
        `,style:{zIndex:l?9999:"auto"},children:a.jsxs("div",{className:`
          flex items-center space-x-3 transition-all duration-300 ease-out
          ${E()}
          ${F()}
        `,children:[a.jsx(Ti,{className:`text-gray-400 flex-shrink-0 transition-all duration-300 ease-out ${U()} ${l?"text-blue-500":""}`}),a.jsx("input",{ref:k,type:"text",value:d,onChange:w,placeholder:r,className:"flex-1 bg-transparent outline-none text-gray-700 placeholder-gray-500 transition-all duration-300 ease-out"}),d&&a.jsx("button",{onClick:L=>{L.stopPropagation(),W()},className:"p-1 hover:bg-gray-100 rounded-full transition-all duration-200 flex-shrink-0 transform hover:scale-110",children:a.jsx(et,{className:"h-4 w-4 text-gray-400 hover:text-gray-600"})}),!l&&a.jsxs("div",{className:"hidden md:flex items-center space-x-1 text-xs text-gray-400 flex-shrink-0 transition-opacity duration-300",children:[a.jsx("kbd",{className:"px-2 py-1 bg-gray-100 rounded border text-xs transition-all duration-200 hover:bg-gray-200",children:"⌘"}),a.jsx("kbd",{className:"px-2 py-1 bg-gray-100 rounded border text-xs transition-all duration-200 hover:bg-gray-200",children:"K"})]})]})}),a.jsx("div",{className:`
          overflow-hidden
          bg-gradient-to-r from-[#1D4ED8] via-[#7C3AED] to-[#EC4899] p-[1px] rounded-b-xl
          transition-all duration-300 ease-out
          ${i?"absolute top-full left-0 right-0 mt-1":""}
          ${l?"opacity-100 shadow-2xl":"opacity-0 shadow-none pointer-events-none"}
          ${!i&&l?"mt-2":""}
          ${!i&&!l?"mt-0":""}
        `,style:{transformOrigin:"top center",transform:l?"scaleY(1)":"scaleY(0)",height:l?"auto":"0",zIndex:i?9998:"auto"},children:a.jsx("div",{className:"bg-white/95 backdrop-blur-sm rounded-b-xl transition-all duration-300 ease-out",children:a.jsxs("div",{className:"p-4 max-h-80 overflow-y-auto transition-all duration-300 ease-out",children:[!d&&a.jsxs("div",{className:"space-y-4",children:[x.length>0&&a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[a.jsx(jt,{className:"h-4 w-4 text-gray-400"}),a.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Recent"})]}),a.jsx("div",{className:"space-y-1",children:x.map((L,_)=>a.jsxs("button",{onClick:()=>P(L.query),className:"flex items-center justify-between w-full p-2 text-left hover:bg-gray-50 rounded-lg transition-colors group",children:[a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx(jt,{className:"h-4 w-4 text-gray-400"}),a.jsx("span",{className:"text-gray-700 group-hover:text-gray-900",children:L.query})]}),a.jsxs("span",{className:"text-xs text-gray-400",children:[Ht(L.timestamp)," ago"]})]},_))})]}),a.jsx("div",{children:a.jsx("div",{className:"flex flex-wrap gap-2",children:ub.map(L=>a.jsxs("button",{onClick:()=>O(L),className:"inline-flex items-center space-x-1 px-3 py-1.5 bg-gray-100 hover:bg-blue-100 hover:text-blue-700 text-gray-700 rounded-full text-sm font-medium transition-all duration-200 hover:scale-105",children:[a.jsx(hs,{className:"h-3 w-3"}),a.jsx("span",{children:L})]},L))})})]}),d&&a.jsx("div",{children:p?a.jsxs("div",{className:"flex items-center justify-center py-6",children:[a.jsx("div",{className:"animate-spin h-5 w-5 border-2 border-blue-500 border-t-transparent rounded-full"}),a.jsx("span",{className:"ml-3 text-gray-600",children:"Searching..."})]}):h.length>0?a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"text-sm text-gray-500 mb-3",children:[h.length," result",h.length!==1?"s":""," ","found"]}),h.map(L=>a.jsx(le,{to:`/article/${L.id}`,onClick:()=>C(),className:"block p-3 hover:bg-gray-50 rounded-lg transition-colors group",children:a.jsxs("div",{className:"flex items-start space-x-3",children:[L.coverImage&&a.jsx("div",{className:"flex-shrink-0 w-12 h-12 bg-gray-100 rounded-lg overflow-hidden",children:a.jsx("img",{src:L.coverImage,alt:L.title,className:"w-full h-full object-cover group-hover:scale-105 transition-transform"})}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("h3",{className:"font-medium text-gray-900 group-hover:text-blue-700 transition-colors line-clamp-1",children:la(L.title,d)}),a.jsx("p",{className:"text-sm text-gray-600 mt-1 line-clamp-2",children:la(L.excerpt,d)}),a.jsxs("div",{className:"flex items-center space-x-3 mt-2 text-xs text-gray-500",children:[a.jsxs("span",{children:["By ",L.authorName]}),a.jsx("span",{children:"•"}),a.jsxs("span",{children:[Ht(L.publishedAt||L.createdAt)," ","ago"]})]}),L.tags.length>0&&a.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:L.tags.slice(0,2).map(_=>a.jsx("span",{className:"px-2 py-0.5 bg-blue-100 text-blue-700 text-xs rounded-full",children:la(_,d)},_))})]}),a.jsx(mi,{className:"h-4 w-4 text-gray-400 group-hover:text-blue-600 transition-colors flex-shrink-0"})]})},L.id))]}):a.jsxs("div",{className:"text-center py-6",children:[a.jsx(Ti,{className:"h-8 w-8 text-gray-300 mx-auto mb-2"}),a.jsx("h3",{className:"text-sm font-medium text-gray-900 mb-1",children:"No results found"}),a.jsx("p",{className:"text-xs text-gray-600",children:"Try adjusting your search terms or browse our recommended topics above."})]})})]})})})]})};function hb(r,e){let t;return(...s)=>{clearTimeout(t),t=setTimeout(()=>r(...s),e)}}const fb=()=>{const r=b.useContext(gh);if(!r)return a.jsx("div",{className:"relative",children:a.jsx("button",{className:"relative p-2 text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-lg transition-colors",title:"Notifications (Loading...)",disabled:!0,children:a.jsx(Qn,{className:"h-6 w-6"})})});const{notifications:e,unreadCount:t,markAsRead:s,markAllAsRead:n,deleteNotification:i}=r,[o,l]=b.useState(!1),c=b.useRef(null);b.useEffect(()=>{const m=g=>{c.current&&!c.current.contains(g.target)&&l(!1)};return document.addEventListener("mousedown",m),()=>{document.removeEventListener("mousedown",m)}},[]);const d=async(m,g)=>{g||await s(m)},u=async()=>{await n()},h=async(m,g)=>{g.stopPropagation(),await i(m)},f=m=>{switch(m){case"role_approval":return a.jsx(Kc,{className:"h-5 w-5 text-blue-600"});case"system":return a.jsx(St,{className:"h-5 w-5 text-blue-600"});case"writer_privileges_removed":return a.jsx(St,{className:"h-5 w-5 text-red-600"});case"writer_privileges_restored":return a.jsx(Kc,{className:"h-5 w-5 text-green-600"});default:return a.jsx(Qn,{className:"h-5 w-5 text-gray-600"})}},p=(m,g)=>{if(g)return"bg-gray-50";switch(m){case"role_approval":return"bg-blue-50 border-l-4 border-blue-500";case"system":return"bg-blue-50 border-l-4 border-blue-500";case"writer_privileges_removed":return"bg-red-50 border-l-4 border-red-500";case"writer_privileges_restored":return"bg-green-50 border-l-4 border-green-500";default:return"bg-white border-l-4 border-gray-300"}};return a.jsxs("div",{className:"relative",ref:c,children:[a.jsxs("button",{onClick:()=>l(!o),className:"relative p-2 text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-lg transition-colors",title:"Notifications",children:[a.jsx(Qn,{className:"h-6 w-6"}),t>0&&a.jsx("span",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center font-medium",children:t>9?"9+":t})]}),o&&a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>l(!1)}),a.jsxs("div",{className:"absolute right-0 mt-2 w-96 bg-white rounded-lg shadow-lg border border-gray-200 z-20 max-h-96 overflow-hidden",children:[a.jsxs("div",{className:"px-4 py-3 border-b border-gray-200 flex items-center justify-between",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Notifications"}),t>0&&a.jsxs("button",{onClick:u,className:"text-sm text-blue-600 hover:text-blue-700 flex items-center space-x-1",children:[a.jsx(D0,{className:"h-4 w-4"}),a.jsx("span",{children:"Mark all read"})]})]}),a.jsx("div",{className:"max-h-80 overflow-y-auto",children:e.length===0?a.jsxs("div",{className:"px-4 py-8 text-center text-gray-500",children:[a.jsx(Qn,{className:"h-12 w-12 text-gray-300 mx-auto mb-3"}),a.jsx("p",{className:"text-sm",children:"No notifications yet"})]}):a.jsx("div",{className:"divide-y divide-gray-100",children:e.map(m=>a.jsx("div",{onClick:()=>d(m.id,m.isRead),className:`px-4 py-3 cursor-pointer hover:bg-gray-50 transition-colors ${p(m.type,m.isRead)}`,children:a.jsxs("div",{className:"flex items-start space-x-3",children:[a.jsx("div",{className:"flex-shrink-0 mt-1",children:f(m.type)}),a.jsx("div",{className:"flex-1 min-w-0",children:a.jsxs("div",{className:"flex items-start justify-between",children:[a.jsxs("div",{className:"flex-1",children:[a.jsx("p",{className:`text-sm font-medium ${m.isRead?"text-gray-700":"text-gray-900"}`,children:m.title}),a.jsx("p",{className:`text-sm mt-1 ${m.isRead?"text-gray-500":"text-gray-700"}`,children:m.message}),a.jsxs("p",{className:"text-xs text-gray-400 mt-2",children:[Ht(m.createdAt)," ","ago"]})]}),a.jsxs("div",{className:"flex items-center space-x-1 ml-2",children:[!m.isRead&&a.jsx("button",{onClick:g=>{g.stopPropagation(),s(m.id)},className:"p-1 text-gray-400 hover:text-green-600 transition-colors",title:"Mark as read",children:a.jsx(Fl,{className:"h-4 w-4"})}),a.jsx("button",{onClick:g=>h(m.id,g),className:"p-1 text-gray-400 hover:text-red-600 transition-colors",title:"Delete notification",children:a.jsx(et,{className:"h-4 w-4"})})]})]})})]})},m.id))})}),e.length>0&&a.jsx("div",{className:"px-4 py-3 border-t border-gray-200 text-center",children:a.jsxs("p",{className:"text-xs text-gray-500",children:[e.length," notification",e.length!==1?"s":""," total"]})})]})]})]})},Yr=class Yr{constructor(){Me(this,"uploads",new Map);Me(this,"progressCallbacks",new Map);Me(this,"completionCallbacks",new Map);Me(this,"isOnline",navigator.onLine);Me(this,"STORAGE_KEY","infonest_uploads");Me(this,"MAX_CONCURRENT_UPLOADS",3);Me(this,"uploadQueue",[]);Me(this,"activeUploads",new Set);try{const e=localStorage.getItem(this.STORAGE_KEY);e&&e.length>2*1024*1024&&(console.warn("Clearing large upload data from localStorage"),localStorage.removeItem(this.STORAGE_KEY))}catch{console.warn("Clearing corrupted upload data from localStorage"),localStorage.removeItem(this.STORAGE_KEY)}this.isOnline=navigator.onLine,this.setupNetworkListeners(),this.loadPersistedUploads(),this.startUploadProcessor()}static getInstance(){return Yr.instance||(Yr.instance=new Yr),Yr.instance}setupNetworkListeners(){window.addEventListener("online",()=>{this.isOnline=!0,this.uploads.forEach((e,t)=>{e.state==="paused"&&e.uploadTask&&this.resumeUpload(t)})}),window.addEventListener("offline",()=>{this.isOnline=!1,this.uploads.forEach((e,t)=>{e.state==="running"&&this.pauseUpload(t)})}),setInterval(()=>{this.checkConnectivity()},2e3)}async checkConnectivity(){try{const e=this.isOnline;this.isOnline=navigator.onLine,!e&&this.isOnline?(console.log("🌐 Connection restored, resuming paused uploads..."),this.uploads.forEach((t,s)=>{t.state==="paused"&&(console.log(`📤 Resuming upload: ${t.fileName} (${t.bytesTransferred}/${t.totalBytes} bytes)`),this.resumeUpload(s))})):e&&!this.isOnline&&(console.log("🔌 Connection lost, pausing running uploads..."),this.uploads.forEach((t,s)=>{t.state==="running"&&(console.log(`⏸️ Pausing upload: ${t.fileName} (${t.bytesTransferred}/${t.totalBytes} bytes)`),this.pauseUpload(s))}))}catch{const t=this.isOnline;this.isOnline=!1,t&&this.uploads.forEach((s,n)=>{s.state==="running"&&this.pauseUpload(n)})}}loadPersistedUploads(){try{const e=localStorage.getItem(this.STORAGE_KEY);e&&JSON.parse(e).forEach(s=>{if(s.state==="running"||s.state==="paused"){if(s.state="paused",s.fileData&&s.fileType&&s.fileName)try{const n=this.base64ToArrayBuffer(s.fileData),i=new File([n],s.fileName,{type:s.fileType,lastModified:s.fileLastModified||Date.now()});s.file=i,s.fileData=n}catch(n){console.error("Failed to restore file for upload:",s.id,n);return}else{console.warn("Upload missing file data, skipping:",s.id);return}this.uploads.set(s.id,s),s.state==="paused"&&this.uploadQueue.push(s.id)}})}catch(e){console.error("Failed to load persisted uploads:",e)}}persistUploads(){try{const e=Array.from(this.uploads.values()).map(s=>({id:s.id,fileName:s.fileName,filePath:s.filePath,userId:s.userId,folder:s.folder,startTime:s.startTime,lastProgressTime:s.lastProgressTime,bytesTransferred:s.bytesTransferred,totalBytes:s.totalBytes,state:s.state,fileType:s.fileType,fileLastModified:s.fileLastModified,context:s.context,needsProcessing:s.needsProcessing,uploadTask:void 0,file:void 0,fileData:void 0})),t=JSON.stringify(e);if(t.length>4*1024*1024){console.warn("Upload data too large for localStorage, clearing old uploads"),this.clearCompletedUploads();return}localStorage.setItem(this.STORAGE_KEY,t)}catch(e){console.error("Failed to persist uploads:",e);try{this.clearCompletedUploads();const t=Array.from(this.uploads.values()).filter(s=>s.state==="uploading"||s.state==="paused").map(s=>({id:s.id,fileName:s.fileName,filePath:s.filePath,userId:s.userId,folder:s.folder,startTime:s.startTime,lastProgressTime:s.lastProgressTime,bytesTransferred:s.bytesTransferred,totalBytes:s.totalBytes,state:s.state,fileType:s.fileType,fileLastModified:s.fileLastModified,context:s.context,needsProcessing:s.needsProcessing}));localStorage.setItem(this.STORAGE_KEY,JSON.stringify(t))}catch(t){console.error("Failed to persist even active uploads:",t),localStorage.removeItem(this.STORAGE_KEY)}}}clearCompletedUploads(){const e=["completed","failed","cancelled"];for(const[t,s]of this.uploads.entries())e.includes(s.state)&&this.uploads.delete(t);console.log("Cleared completed uploads to free localStorage space")}startUploadProcessor(){setInterval(()=>{this.processUploadQueue()},1e3)}processUploadQueue(){if(this.isOnline)for(;this.activeUploads.size<this.MAX_CONCURRENT_UPLOADS&&this.uploadQueue.length>0;){const e=this.uploadQueue.shift();e&&this.uploads.has(e)&&this.startUpload(e)}}async addUpload(e,t,s="articles",n,i,o){const l=this.generateUploadId(),c=o==null?void 0:o.articleId;let d,u;try{const p=this.generateFileName(e.name,t,c,s);d=p.split("/").pop()||e.name,s==="articles"&&!c?u=`temp/${p}`:u=`${s}/${p}`}catch(p){throw console.error("Error generating filename:",p),p}const h=await e.arrayBuffer(),f={id:l,file:e,fileName:e.name,filePath:u,userId:t,folder:s,startTime:Date.now(),lastProgressTime:Date.now(),bytesTransferred:0,totalBytes:e.size,state:"paused",fileData:h,fileType:e.type,fileLastModified:e.lastModified,context:o||{type:"attachment",pageUrl:window.location.href,autoSave:!1},needsProcessing:!1};return this.uploads.set(l,f),n&&this.progressCallbacks.set(l,n),i&&this.completionCallbacks.set(l,i),this.uploadQueue.push(l),this.persistUploads(),l}async startUpload(e){const t=this.uploads.get(e);if(!t||!t.file){console.error("Upload not found or file missing");return}if(!this.isOnline){t.state="paused";return}if(t.uploadTask&&t.state==="paused"){this.resumeUpload(e);return}this.activeUploads.add(e),t.state="running",t.bytesTransferred===0&&(t.startTime=Date.now()),t.lastProgressTime=Date.now();try{console.log(`🚀 Starting upload: ${t.fileName} → ${t.filePath}`);const s=Hn(Xs,t.filePath),n=cg(s,t.file);t.uploadTask=n,t.uploadSessionUrl=n.snapshot.ref.fullPath,n.on("state_changed",i=>{this.handleUploadProgress(e,i)},i=>{this.handleUploadError(e,i)},async()=>{await this.handleUploadComplete(e,n)}),this.persistUploads()}catch(s){this.handleUploadError(e,s)}}handleUploadProgress(e,t){const s=this.uploads.get(e);if(!s)return;const n=Date.now(),i=(n-s.lastProgressTime)/1e3,o=t.bytesTransferred-s.bytesTransferred;s.bytesTransferred=t.bytesTransferred,s.lastProgressTime=n;const l=i>0?o/i:0,c=s.totalBytes-s.bytesTransferred,d=l>0?c/l:0,u={bytesTransferred:t.bytesTransferred,totalBytes:t.totalBytes,percentage:Math.round(t.bytesTransferred/t.totalBytes*100),speed:l,estimatedTimeRemaining:d,state:s.state},h=this.progressCallbacks.get(e);h&&h(u),(u.percentage%5===0||i>10)&&this.persistUploads()}handleUploadError(e,t){var n;const s=this.uploads.get(e);if(s){if(console.error(`❌ Upload error for ${s.filePath}:`,t),console.error("📋 Upload details:",{fileName:s.fileName,filePath:s.filePath,userId:s.userId,articleId:(n=s.context)==null?void 0:n.articleId,bytesTransferred:s.bytesTransferred,totalBytes:s.totalBytes}),s.state="error",s.error=t.message,this.activeUploads.delete(e),this.isRetryableError(t))s.state="paused",this.uploadQueue.includes(e)||this.uploadQueue.push(e);else{const i=this.completionCallbacks.get(e);i&&i(t),this.cleanupUpload(e)}this.persistUploads()}}async handleUploadComplete(e,t){var n;const s=this.uploads.get(e);if(s)try{const i=await th(t.snapshot.ref);s.state="success",s.downloadURL=i,s.completedAt=Date.now(),this.activeUploads.delete(e);const o={url:i,path:s.filePath,name:s.filePath.split("/").pop()||s.fileName,originalName:s.fileName,size:s.totalBytes,type:((n=s.file)==null?void 0:n.type)||"application/octet-stream",uploadId:e};await this.handleCrossPageCompletion(s,o);const l=this.completionCallbacks.get(e);l?l(o):(s.needsProcessing=!0,this.persistUploads(),this.showGlobalNotification(s,o)),setTimeout(()=>{this.cleanupUpload(e)},3e4)}catch(i){this.handleUploadError(e,i)}}isRetryableError(e){return["network-request-failed","timeout","server-file-wrong-size","unknown"].some(s=>e.message.toLowerCase().includes(s)||e.name.toLowerCase().includes(s))}pauseUpload(e){const t=this.uploads.get(e);t&&t.uploadTask&&t.state==="running"&&(console.log(`⏸️ Pausing upload: ${t.fileName} at ${t.bytesTransferred}/${t.totalBytes} bytes`),t.uploadTask.pause(),t.state="paused",this.activeUploads.delete(e),this.persistUploads())}resumeUpload(e){const t=this.uploads.get(e);if(t&&t.state==="paused"&&this.isOnline){if(t.uploadTask)try{console.log(`▶️ Resuming existing upload task: ${t.fileName} from ${t.bytesTransferred}/${t.totalBytes} bytes`),t.uploadTask.resume(),t.state="running",this.activeUploads.add(e),t.lastProgressTime=Date.now(),this.persistUploads();return}catch(s){console.error("Failed to resume existing upload task:",e,s)}if(!t.file&&t.fileData)try{t.file=new File([t.fileData],t.fileName,{type:t.fileType||"application/octet-stream",lastModified:t.fileLastModified||Date.now()})}catch(s){console.error("Failed to recreate file for upload resumption:",e,s);return}this.uploadQueue.includes(e)||this.uploadQueue.push(e),this.persistUploads()}}cancelUpload(e){const t=this.uploads.get(e);if(!t)return;t.uploadTask&&t.uploadTask.cancel(),t.state="canceled",this.activeUploads.delete(e);const s=this.uploadQueue.indexOf(e);s>-1&&this.uploadQueue.splice(s,1),this.cleanupUpload(e)}deleteCompletedUpload(e){const t=this.uploads.get(e);if(t){if(!["completed","failed","canceled"].includes(t.state)){console.warn("Cannot delete active upload");return}this.uploads.delete(e),this.persistUploads(),console.log(`Deleted upload record: ${e}`)}}getUploadStatus(e){return this.uploads.get(e)||null}getAllUploads(){return Array.from(this.uploads.values())}getActiveUploads(){return Array.from(this.uploads.values()).filter(e=>e.state==="running"||e.state==="paused")}cleanupUpload(e){this.uploads.delete(e),this.progressCallbacks.delete(e),this.completionCallbacks.delete(e),this.activeUploads.delete(e);const t=this.uploadQueue.indexOf(e);t>-1&&this.uploadQueue.splice(t,1),this.persistUploads()}cleanupCompletedUploads(){Array.from(this.uploads.entries()).filter(([t,s])=>s.state==="success"||s.state==="error").forEach(([t,s])=>{this.cleanupUpload(t)})}removeUpload(e){const t=this.uploads.get(e);t&&((t.state==="running"||t.state==="paused")&&this.cancelUpload(e),this.uploads.delete(e),this.persistUploads(),console.log(`🗑️ Removed upload: ${e}`))}generateUploadId(){return`upload_${Date.now()}_${Math.random().toString(36).substring(2,15)}`}generateFileName(e,t,s,n){const i=Date.now(),l=e.replace(/[<>:"/\\|?*]/g,"_").replace(/\s+/g,"_").replace(/_{2,}/g,"_").replace(/^_+|_+$/g,"").split("."),c=l.pop()||"",d=l.join(".")||"file";return n==="articles"?s?`${t}/${s}/${d}_${i}.${c}`:`${t}/${d}_${i}.${c}`:`${t}/${d}_${i}.${c}`}formatFileSize(e){if(e===0)return"0 Bytes";const t=1024,s=["Bytes","KB","MB","GB"],n=Math.floor(Math.log(e)/Math.log(t));return parseFloat((e/Math.pow(t,n)).toFixed(2))+" "+s[n]}arrayBufferToBase64(e){const t=new Uint8Array(e);let s="";for(let n=0;n<t.byteLength;n++)s+=String.fromCharCode(t[n]);return btoa(s)}base64ToArrayBuffer(e){const t=atob(e),s=new Uint8Array(t.length);for(let n=0;n<t.length;n++)s[n]=t.charCodeAt(n);return s.buffer}formatSpeed(e){return`${this.formatFileSize(e)}/s`}formatTime(e){if(e===1/0||isNaN(e))return"Unknown";const t=Math.floor(e/3600),s=Math.floor(e%3600/60),n=Math.floor(e%60);return t>0?`${t}h ${s}m ${n}s`:s>0?`${s}m ${n}s`:`${n}s`}async handleCrossPageCompletion(e,t){if(e.context)try{switch(e.context.type){case"article":await this.handleArticleUploadCompletion(e,t);break;case"profile":await this.handleProfileUploadCompletion(e,t);break;case"cover":await this.handleCoverImageCompletion(e,t);break;default:break}}catch(s){console.error("Error handling cross-page upload completion:",s)}}async handleArticleUploadCompletion(e,t){const s=e.context;if(s!=null&&s.articleId)try{const{updateArticle:n,getArticle:i}=await Fe(async()=>{const{updateArticle:o,getArticle:l}=await Promise.resolve().then(()=>Ql);return{updateArticle:o,getArticle:l}},void 0);if(s.targetField==="coverImage"){const o=await i(s.articleId),l=o==null?void 0:o.coverImage;if(await n(s.articleId,{coverImage:t.url}),l&&l!==t.url)try{const{deleteFile:c,extractFilePathFromUrl:d}=await Fe(async()=>{const{deleteFile:h,extractFilePathFromUrl:f}=await Promise.resolve().then(()=>qa);return{deleteFile:h,extractFilePathFromUrl:f}},void 0),u=d(l);u&&u.startsWith("articles/")&&(await c(u),console.log("✅ Deleted old cover image:",u))}catch(c){console.error("⚠️ Failed to delete old cover image:",c)}}else if(s.autoSave){const o=await i(s.articleId);if(o){const l=[...o.attachments||[],t.url];await n(s.articleId,{attachments:l,status:"draft"})}}}catch(n){console.error("Error updating article with upload:",n)}}async handleProfileUploadCompletion(e,t){var s;try{const{doc:n,updateDoc:i,getDoc:o}=await Fe(async()=>{const{doc:p,updateDoc:m,getDoc:g}=await import("./firebase-CemElZ1T.js").then(y=>y.K);return{doc:p,updateDoc:m,getDoc:g}},[]),{firestore:l}=await Fe(async()=>{const{firestore:p}=await Promise.resolve().then(()=>Xn);return{firestore:p}},void 0),{deleteFile:c,extractFilePathFromUrl:d}=await Fe(async()=>{const{deleteFile:p,extractFilePathFromUrl:m}=await Promise.resolve().then(()=>qa);return{deleteFile:p,extractFilePathFromUrl:m}},void 0),u=n(l,"users",e.userId),h=await o(u),f=h.exists()?(s=h.data())==null?void 0:s.profilePicture:null;if(await i(u,{profilePicture:t.url,updatedAt:new Date}),f&&f!==t.url)try{const p=d(f);p&&p.startsWith("profiles/")&&(await c(p),console.log("✅ Deleted old profile picture:",p))}catch(p){console.error("⚠️ Failed to delete old profile picture:",p)}}catch(n){console.error("Error updating profile with upload:",n)}}async handleCoverImageCompletion(e,t){const s={uploadId:e.id,url:t.url,timestamp:Date.now(),context:e.context};localStorage.setItem("completed_cover_upload",JSON.stringify(s)),window.dispatchEvent(new CustomEvent("coverUploadCompleted",{detail:s}))}showGlobalNotification(e,t){const s={id:e.id,type:"upload_complete",title:"Upload Completed",message:`${e.fileName} has been uploaded successfully`,url:t.url,context:e.context,timestamp:Date.now()},n=JSON.parse(localStorage.getItem("upload_notifications")||"[]");n.push(s),n.length>10&&n.splice(0,n.length-10),localStorage.setItem("upload_notifications",JSON.stringify(n)),window.dispatchEvent(new CustomEvent("globalUploadComplete",{detail:s})),"Notification"in window&&Notification.permission==="granted"&&new Notification("Upload Completed",{body:s.message,icon:"/InfoNest/ChatGPT Image Jul 22, 2025, 11_54_47 AM.png"})}getCompletedUploads(){return Array.from(this.uploads.values()).filter(e=>e.state==="success"&&e.needsProcessing)}markAsProcessed(e){const t=this.uploads.get(e);t&&(t.needsProcessing=!1,this.persistUploads())}async updatePendingUploadsWithArticleId(e){const t=Array.from(this.uploads.entries()).filter(([s,n])=>{var i;return!((i=n.context)!=null&&i.articleId)&&n.folder==="articles"&&n.state==="success"&&n.filePath.includes("temp_")});if(t.length===0){console.log("No temp uploads to reorganize");return}console.log(`Moving ${t.length} temp files to organized structure`);for(const[s,n]of t)try{const i=this.generateFileName(n.fileName.replace(/^temp_\d+_[a-z0-9]+\./,"")||n.fileName,n.userId,e,n.folder),o=`${n.folder}/${i}`;await this.moveFileInStorage(n.filePath,o),n.context={...n.context,articleId:e},n.filePath=o,n.needsProcessing=!1,console.log(`✅ Moved: ${n.filePath} → ${o}`)}catch(i){console.error(`❌ Failed to move temp file ${n.filePath}:`,i)}this.persistUploads()}async moveFileInStorage(e,t){try{const{ref:s,uploadBytes:n,getDownloadURL:i,deleteObject:o}=await Fe(async()=>{const{ref:f,uploadBytes:p,getDownloadURL:m,deleteObject:g}=await import("./firebase-CemElZ1T.js").then(y=>y.L);return{ref:f,uploadBytes:p,getDownloadURL:m,deleteObject:g}},[]),{storage:l}=await Fe(async()=>{const{storage:f}=await Promise.resolve().then(()=>Xn);return{storage:f}},void 0),c=s(l,e),u=await(await fetch(await i(c))).blob(),h=s(l,t);await n(h,u),await o(c),console.log(`📁 File moved: ${e} → ${t}`)}catch(s){throw console.error(`❌ Error moving file from ${e} to ${t}:`,s),s}}async cleanupTempFiles(e){const t=Array.from(this.uploads.entries()).filter(([s,n])=>{var i;return n.userId===e&&n.folder==="articles"&&n.filePath.includes("temp_")&&!((i=n.context)!=null&&i.articleId)});if(t.length!==0){console.log(`🧹 Cleaning up ${t.length} temp files for user ${e}`);for(const[s,n]of t)try{const{ref:i,deleteObject:o}=await Fe(async()=>{const{ref:d,deleteObject:u}=await import("./firebase-CemElZ1T.js").then(h=>h.L);return{ref:d,deleteObject:u}},[]),{storage:l}=await Fe(async()=>{const{storage:d}=await Promise.resolve().then(()=>Xn);return{storage:d}},void 0),c=i(l,n.filePath);await o(c),this.uploads.delete(s),console.log(`🗑️ Deleted temp file: ${n.filePath}`)}catch(i){console.error(`❌ Failed to delete temp file ${n.filePath}:`,i)}this.persistUploads()}}async cleanupUnusedFiles(e,t,s,n,i){const o=Array.from(this.uploads.entries()).filter(([u,h])=>{var f;return h.userId===e&&((f=h.context)==null?void 0:f.articleId)===t&&h.state==="success"});if(o.length===0)return;const l=new Set;n&&l.add(n),i&&i.forEach(u=>l.add(u)),this.extractImageUrlsFromContent(s).forEach(u=>l.add(u));const d=o.filter(([u,h])=>h.downloadURL&&!l.has(h.downloadURL));if(d.length!==0){console.log(`🧹 Cleaning up ${d.length} unused files for article ${t}`);for(const[u,h]of d)try{const{ref:f,deleteObject:p}=await Fe(async()=>{const{ref:y,deleteObject:x}=await import("./firebase-CemElZ1T.js").then(N=>N.L);return{ref:y,deleteObject:x}},[]),{storage:m}=await Fe(async()=>{const{storage:y}=await Promise.resolve().then(()=>Xn);return{storage:y}},void 0),g=f(m,h.filePath);await p(g),this.uploads.delete(u),console.log(`🗑️ Deleted unused file: ${h.filePath}`)}catch(f){console.error(`❌ Failed to delete unused file ${h.filePath}:`,f)}this.persistUploads()}}extractImageUrlsFromContent(e){const t=/<img[^>]+src=["']([^"']+)["'][^>]*>/gi,s=[];let n;for(;(n=t.exec(e))!==null;)s.push(n[1]);return s}getUploadNotifications(){return JSON.parse(localStorage.getItem("upload_notifications")||"[]")}clearUploadNotifications(){localStorage.removeItem("upload_notifications")}};Me(Yr,"instance");let el=Yr;const ge=el.getInstance(),af=({isOpen:r,onClose:e,className:t="",articleId:s})=>{const[n,i]=b.useState([]),[o,l]=b.useState([]),[c,d]=b.useState(navigator.onLine),[u,h]=b.useState(!1),[f,p]=b.useState("all");b.useEffect(()=>{if(s){const v=ge.getAllUploads().filter(D=>{var C;return((C=D.context)==null?void 0:C.articleId)===s||D.state==="success"&&D.downloadURL}).map(D=>{const C={bytesTransferred:D.bytesTransferred,totalBytes:D.totalBytes,percentage:Math.round(D.bytesTransferred/D.totalBytes*100),speed:0,estimatedTimeRemaining:0,state:D.state};return{id:D.id,metadata:D,progress:C}});l(v)}},[s]),b.useEffect(()=>{const w=()=>d(!0),v=()=>d(!1);return window.addEventListener("online",w),window.addEventListener("offline",v),()=>{window.removeEventListener("online",w),window.removeEventListener("offline",v)}},[]),b.useEffect(()=>{const w=setInterval(()=>{const D=ge.getAllUploads().map(P=>{const O={bytesTransferred:P.bytesTransferred,totalBytes:P.totalBytes,percentage:Math.round(P.bytesTransferred/P.totalBytes*100),speed:0,estimatedTimeRemaining:0,state:P.state};return{id:P.id,metadata:P,progress:O}});i(D);const C=D.filter(P=>P.metadata.state==="success"&&P.metadata.downloadURL);l(P=>{const O=new Set(P.map(I=>I.id)),W=C.filter(I=>!O.has(I.id));return[...P,...W]})},1e3);return()=>clearInterval(w)},[s]);const m=(w,v)=>{switch(v){case"pause":ge.pauseUpload(w);break;case"resume":case"retry":ge.resumeUpload(w);break;case"cancel":ge.cancelUpload(w);break}},g=()=>{n.filter(v=>v.progress.state==="error"||v.progress.state==="canceled").forEach(v=>{ge.removeUpload(v.id)}),i(v=>v.filter(D=>D.progress.state!=="error"&&D.progress.state!=="canceled")),l(v=>v.filter(D=>D.progress.state!=="error"&&D.progress.state!=="canceled"))},y=()=>{const w=[...o];switch(n.forEach(v=>{w.find(D=>D.id===v.id)||w.push(v)}),f){case"active":return w.filter(v=>v.progress.state==="running"||v.progress.state==="paused");case"completed":return w.filter(v=>v.progress.state==="success");case"failed":return w.filter(v=>v.progress.state==="error"||v.progress.state==="canceled");default:return w}},x=w=>{switch(w){case"running":return a.jsx(rt,{className:"h-4 w-4 text-blue-600 animate-pulse"});case"paused":return a.jsx(Di,{className:"h-4 w-4 text-yellow-600"});case"success":return a.jsx(sr,{className:"h-4 w-4 text-green-600"});case"error":return a.jsx(St,{className:"h-4 w-4 text-red-600"});case"canceled":return a.jsx(et,{className:"h-4 w-4 text-gray-600"});default:return a.jsx(jt,{className:"h-4 w-4 text-gray-600"})}},N=w=>{switch(w){case"running":return"border-blue-200 bg-blue-50";case"paused":return"border-yellow-200 bg-yellow-50";case"success":return"border-green-200 bg-green-50";case"error":return"border-red-200 bg-red-50";case"canceled":return"border-gray-200 bg-gray-50";default:return"border-gray-200 bg-gray-50"}},A=y(),S=A,k=S.filter(w=>w.progress.state==="running"||w.progress.state==="paused").length,R=S.filter(w=>w.progress.state==="success").length,j=S.filter(w=>w.progress.state==="error"||w.progress.state==="canceled").length;return r?a.jsx("div",{className:`fixed bottom-4 right-4 z-50 ${t}`,children:a.jsxs("div",{className:"bg-white rounded-lg shadow-xl border border-gray-200 w-96 max-h-[600px] overflow-hidden",children:[a.jsxs("div",{className:"p-4 border-b border-gray-200 flex items-center justify-between bg-gradient-to-r from-blue-50 to-purple-50",children:[a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(rt,{className:"h-5 w-5 text-blue-600"}),a.jsx("h3",{className:"font-semibold text-gray-900",children:"Upload Manager"}),!c&&a.jsxs("div",{className:"flex items-center space-x-1 text-red-600 bg-red-100 px-2 py-1 rounded-full",children:[a.jsx(fn,{className:"h-3 w-3"}),a.jsx("span",{className:"text-xs",children:"Offline"})]})]}),a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx("button",{onClick:()=>h(!u),className:"text-gray-400 hover:text-gray-600 p-1",title:u?"Maximize":"Minimize",children:u?a.jsx(V0,{className:"h-4 w-4"}):a.jsx(q0,{className:"h-4 w-4"})}),a.jsx("button",{onClick:e,className:"text-gray-400 hover:text-gray-600 p-1",title:"Close",children:a.jsx(et,{className:"h-4 w-4"})})]})]}),!u&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"p-4 border-b border-gray-200 bg-gray-50",children:[a.jsxs("div",{className:"grid grid-cols-4 gap-2 mb-3",children:[a.jsxs("button",{onClick:()=>p("all"),className:`text-center p-2 rounded text-xs ${f==="all"?"bg-blue-100 text-blue-800":"text-gray-600 hover:bg-gray-100"}`,children:[a.jsx("div",{className:"font-semibold",children:S.length}),a.jsx("div",{children:"All"})]}),a.jsxs("button",{onClick:()=>p("active"),className:`text-center p-2 rounded text-xs ${f==="active"?"bg-yellow-100 text-yellow-800":"text-gray-600 hover:bg-gray-100"}`,children:[a.jsx("div",{className:"font-semibold",children:k}),a.jsx("div",{children:"Active"})]}),a.jsxs("button",{onClick:()=>p("completed"),className:`text-center p-2 rounded text-xs ${f==="completed"?"bg-green-100 text-green-800":"text-gray-600 hover:bg-gray-100"}`,children:[a.jsx("div",{className:"font-semibold",children:R}),a.jsx("div",{children:"Done"})]}),a.jsxs("button",{onClick:()=>p("failed"),className:`text-center p-2 rounded text-xs ${f==="failed"?"bg-red-100 text-red-800":"text-gray-600 hover:bg-gray-100"}`,children:[a.jsx("div",{className:"font-semibold",children:j}),a.jsx("div",{children:"Failed"})]})]}),j>0&&a.jsx("button",{onClick:g,className:"w-full text-xs text-gray-600 hover:text-gray-800 hover:bg-gray-100 py-1 px-2 rounded",children:"Clear failed uploads"})]}),a.jsx("div",{className:"max-h-80 overflow-y-auto",children:A.length===0?a.jsxs("div",{className:"p-8 text-center text-gray-500",children:[a.jsx(rt,{className:"h-8 w-8 mx-auto mb-2 text-gray-300"}),a.jsx("p",{className:"text-sm",children:f==="all"?"No uploads yet":`No ${f} uploads`})]}):A.map(w=>{var v;return a.jsxs("div",{className:`p-4 border-b border-gray-100 ${N(w.progress.state)}`,children:[a.jsxs("div",{className:"flex items-start justify-between mb-2",children:[a.jsxs("div",{className:"flex items-center space-x-2 flex-1 min-w-0",children:[Yl(((v=w.metadata.file)==null?void 0:v.type)||"")?a.jsx(_s,{className:"h-4 w-4 text-blue-600 flex-shrink-0"}):a.jsx(yh,{className:"h-4 w-4 text-gray-600 flex-shrink-0"}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("div",{className:"text-sm font-medium text-gray-900 truncate",children:w.metadata.fileName}),a.jsxs("div",{className:"text-xs text-gray-500",children:[ge.formatFileSize(w.metadata.totalBytes),w.metadata.startTime&&a.jsxs("span",{className:"ml-2",children:["Started ",Ht(w.metadata.startTime)," ago"]})]})]}),x(w.progress.state)]}),a.jsxs("div",{className:"flex items-center space-x-1 ml-2",children:[w.progress.state==="running"&&a.jsx("button",{onClick:()=>m(w.id,"pause"),className:"p-1 text-yellow-600 hover:bg-yellow-100 rounded",title:"Pause upload",children:a.jsx(Di,{className:"h-3 w-3"})}),w.progress.state==="paused"&&a.jsx("button",{onClick:()=>m(w.id,"resume"),className:"p-1 text-green-600 hover:bg-green-100 rounded",title:"Resume upload",children:a.jsx(kh,{className:"h-3 w-3"})}),w.progress.state==="error"&&a.jsx("button",{onClick:()=>m(w.id,"retry"),className:"p-1 text-blue-600 hover:bg-blue-100 rounded",title:"Retry upload",children:a.jsx(Lo,{className:"h-3 w-3"})}),w.progress.state==="success"&&w.metadata.downloadURL&&a.jsxs(a.Fragment,{children:[a.jsx("a",{href:w.metadata.downloadURL,target:"_blank",rel:"noopener noreferrer",className:"p-1 text-blue-600 hover:bg-blue-100 rounded",title:"View file",children:a.jsx(us,{className:"h-3 w-3"})}),a.jsx("a",{href:w.metadata.downloadURL,download:w.metadata.fileName,className:"p-1 text-green-600 hover:bg-green-100 rounded",title:"Download file",children:a.jsx(gi,{className:"h-3 w-3"})})]}),w.progress.state!=="success"&&a.jsx("button",{onClick:()=>m(w.id,"cancel"),className:"p-1 text-red-600 hover:bg-red-100 rounded",title:"Cancel upload",children:a.jsx(Or,{className:"h-3 w-3"})})]})]}),w.progress.state!=="success"&&w.progress.state!=="canceled"&&a.jsxs("div",{className:"mb-2",children:[a.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-600 mb-1",children:[a.jsxs("span",{children:[w.progress.percentage,"%"]}),a.jsxs("span",{children:[ge.formatFileSize(w.progress.bytesTransferred)," / ",ge.formatFileSize(w.progress.totalBytes)]})]}),a.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:a.jsx("div",{className:`h-2 rounded-full transition-all duration-300 ${w.progress.state==="running"?"bg-blue-600":w.progress.state==="paused"?"bg-yellow-500":w.progress.state==="error"?"bg-red-500":"bg-green-500"}`,style:{width:`${w.progress.percentage}%`}})})]}),w.progress.state==="running"&&a.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[a.jsxs("div",{className:"flex items-center space-x-1",children:[a.jsx(ql,{className:"h-3 w-3"}),a.jsx("span",{children:ge.formatSpeed(w.progress.speed)})]}),a.jsxs("div",{className:"flex items-center space-x-1",children:[a.jsx(jt,{className:"h-3 w-3"}),a.jsx("span",{children:ge.formatTime(w.progress.estimatedTimeRemaining)})]})]}),w.progress.state==="paused"&&a.jsxs("div",{className:"text-xs text-yellow-600",children:["Upload paused ",c?"":"(offline)"]}),w.progress.state==="error"&&w.metadata.error&&a.jsxs("div",{className:"text-xs text-red-600",children:["Error: ",w.metadata.error]}),w.progress.state==="success"&&a.jsx("div",{className:"text-xs text-green-600",children:"Upload completed successfully"})]},w.id)})})]})]})}):null},pb=()=>{const{userProfile:r,isAuthenticated:e,isInfoWriter:t,isAdmin:s}=ve();zn();const n=Tt(),[i,o]=b.useState(!1),[l,c]=b.useState(!1),[d,u]=b.useState(!1);b.useEffect(()=>{const f=setInterval(()=>{const m=ge.getActiveUploads().length>0;u(m),m&&!l&&c(!0)},2e3);return()=>clearInterval(f)},[l]);const h=async()=>{try{n("/",{replace:!0}),await ch()}catch(f){console.error("Error logging out:",f),n("/",{replace:!0})}};return b.useEffect(()=>{const f=p=>{p.target.closest("[data-dropdown]")||o(!1)};return document.addEventListener("mousedown",f),()=>document.removeEventListener("mousedown",f)},[]),e?a.jsxs("div",{className:"min-h-screen",style:{backgroundColor:"#EFEDFA"},children:[a.jsx("nav",{className:"bg-white/80 backdrop-blur-md border-b border-gray-200/50 sticky top-0 z-50",children:a.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:a.jsxs("div",{className:"flex justify-between items-center h-16",children:[a.jsx(le,{to:"/",className:"flex items-center space-x-3",children:a.jsx("span",{className:"text-3xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"InfoNest"})}),a.jsx("div",{className:"hidden md:flex items-center space-x-6 flex-1 max-w-md mx-8",children:a.jsx(vs,{variant:"minimal",placeholder:"Search articles, guides, documentation...",onResultClick:()=>{},className:"w-full",isHeaderSearch:!0})}),a.jsxs("div",{className:"flex items-center space-x-4",children:[a.jsx(fb,{}),d&&a.jsxs("button",{onClick:()=>c(!l),className:"relative p-2 text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-lg transition-colors",title:"Upload Manager",children:[a.jsx(rt,{className:"h-5 w-5"}),a.jsx("span",{className:"absolute -top-1 -right-1 bg-blue-500 text-white text-xs rounded-full h-4 w-4 flex items-center justify-center font-medium",children:ge.getActiveUploads().length})]}),a.jsxs("div",{className:"relative","data-dropdown":!0,children:[a.jsxs("button",{onClick:()=>o(!i),className:"flex items-center space-x-3 p-2 rounded-lg hover:bg-gray-100 transition-colors",children:[a.jsxs("div",{className:"text-right",children:[a.jsx("div",{className:"text-sm font-medium text-gray-700",children:(r==null?void 0:r.displayName)||(r==null?void 0:r.email)}),a.jsx("div",{className:"flex items-center justify-end space-x-2",children:(r==null?void 0:r.role)&&a.jsx(rx,{role:r.role})})]}),r!=null&&r.profilePicture?a.jsx("img",{src:r.profilePicture,alt:"Profile",className:"w-8 h-8 rounded-full object-cover border-2 border-gray-200"}):a.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 p-2 rounded-full hover:from-blue-700 hover:to-purple-700 transition-all",children:a.jsx(_e,{className:"h-4 w-4 text-white"})})]}),i&&a.jsxs("div",{className:"absolute right-0 mt-2 w-56 bg-white rounded-lg shadow-lg border border-gray-200 py-2 z-50",children:[a.jsxs(le,{to:"/profile",onClick:()=>o(!1),className:"flex items-center space-x-3 px-4 py-2 text-gray-700 hover:bg-gray-50 transition-colors",children:[a.jsx(_e,{className:"h-4 w-4"}),a.jsx("span",{children:"Profile"})]}),a.jsxs(le,{to:"/dashboard",onClick:()=>o(!1),className:"flex items-center space-x-3 px-4 py-2 text-gray-700 hover:bg-gray-50 transition-colors",children:[a.jsx(Er,{className:"h-4 w-4"}),a.jsx("span",{children:"Dashboard"})]}),a.jsxs(le,{to:"/saved-articles",onClick:()=>o(!1),className:"flex items-center space-x-3 px-4 py-2 text-gray-700 hover:bg-gray-50 transition-colors",children:[a.jsx(br,{className:"h-4 w-4"}),a.jsx("span",{children:"Saved Articles"})]}),s&&a.jsxs(le,{to:"/my-articles",onClick:()=>o(!1),className:"flex items-center space-x-3 px-4 py-2 text-gray-700 hover:bg-gray-50 transition-colors",children:[a.jsx(tx,{className:"h-4 w-4"}),a.jsx("span",{children:"My Articles"})]}),t&&!s&&a.jsxs(le,{to:"/article/new",onClick:()=>o(!1),className:"flex items-center space-x-3 px-4 py-2 text-gray-700 hover:bg-gray-50 transition-colors",children:[a.jsx(Wl,{className:"h-4 w-4"}),a.jsx("span",{children:"Create New Article"})]}),a.jsx("hr",{className:"my-2"}),a.jsxs("button",{onClick:h,className:"flex items-center space-x-3 px-4 py-2 text-red-600 hover:bg-red-50 transition-colors w-full text-left",children:[a.jsx(zl,{className:"h-4 w-4"}),a.jsx("span",{children:"Logout"})]})]})]})]})]})})}),a.jsxs("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[a.jsx(zc,{})," "]}),a.jsx(af,{isOpen:l,onClose:()=>c(!1)})]}):a.jsxs("div",{className:"min-h-screen",style:{backgroundColor:"#EFEDFA"},children:[a.jsx(zc,{})," "]})},mb={"gmial.com":"gmail.com","gmai.com":"gmail.com","gmal.com":"gmail.com","gmil.com":"gmail.com","gmail.co":"gmail.com","gmail.cm":"gmail.com","gmail.om":"gmail.com","gmaill.com":"gmail.com","gmails.com":"gmail.com","yaho.com":"yahoo.com","yahooo.com":"yahoo.com","yahoo.co":"yahoo.com","yahoo.cm":"yahoo.com","yahoo.om":"yahoo.com","ymail.co":"ymail.com","hotmial.com":"hotmail.com","hotmai.com":"hotmail.com","hotmal.com":"hotmail.com","hotmail.co":"hotmail.com","hotmail.cm":"hotmail.com","outlok.com":"outlook.com","outlook.co":"outlook.com","outlook.cm":"outlook.com","aol.co":"aol.com","aol.cm":"aol.com","icloud.co":"icloud.com","icloud.cm":"icloud.com","protonmail.co":"protonmail.com","protonmail.cm":"protonmail.com"},gb=new Set(["gmail.com","yahoo.com","hotmail.com","outlook.com","aol.com","icloud.com","protonmail.com","ymail.com","live.com","msn.com","comcast.net","verizon.net","att.net","sbcglobal.net","cox.net","charter.net","earthlink.net","juno.com","mail.com","zoho.com","fastmail.com","tutanota.com","mailbox.org","runbox.com","edu","ac.uk","edu.au","edu.ca","gov","mil","gov.uk","gov.au","gov.ca","company.com","corporation.com","business.com"]),xb=new Set(["tk","ml","ga","cf","gq","pw","top","click","download","stream","science","racing","review","faith","accountant","loan","win","cricket","date","party","trade","webcam"]),yb=new Set(["10minutemail.com","tempmail.org","guerrillamail.com","mailinator.com","throwaway.email","temp-mail.org","getnada.com","maildrop.cc","sharklasers.com","grr.la","guerrillamailblock.com","pokemail.net","spam4.me","bccto.me","chacuo.net","dispostable.com","fakeinbox.com"]);function bb(r){return/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/.test(r)}function wb(r){var s;const e=(s=r.split("@")[1])==null?void 0:s.toLowerCase();if(!e)return{hasTypo:!1};const t=mb[e];return t?{hasTypo:!0,suggestion:`${r.split("@")[0]}@${t}`}:{hasTypo:!1}}function vb(r){var s;const e=(s=r.split("@")[1])==null?void 0:s.toLowerCase();if(!e)return!1;const t=e.split(".").pop();return t?xb.has(t):!1}function Nb(r){var t;const e=(t=r.split("@")[1])==null?void 0:t.toLowerCase();return e?yb.has(e):!1}function jb(r){var i;const e=(i=r.split("@")[1])==null?void 0:i.toLowerCase();if(!e)return!1;if(gb.has(e))return!0;const t=e.split("."),s=t[t.length-1];return t.length>1&&t[t.length-2],s==="edu"||e.endsWith(".edu")||e.endsWith(".ac.uk")||e.endsWith(".edu.au")||e.endsWith(".edu.ca")||s==="gov"||e.endsWith(".gov")||e.endsWith(".gov.uk")||e.endsWith(".gov.au")||e.endsWith(".gov.ca")||s==="mil"?!0:["com","org","net","co","io","biz"].includes(s)&&t.length>=2?e.length>6&&!e.includes("test")&&!e.includes("example"):!1}function kb(r){var o;const e=(o=r.split("@")[0])==null?void 0:o.toLowerCase();if(!e)return!1;if(e.length>20)return!0;const t=(e.match(/\d/g)||[]).length,s=(e.match(/[a-z]/g)||[]).length;return t>0&&s>0&&t/s>2||/(.)\1{3,}/.test(e)?!0:[/^[a-z]{1,3}\d{6,}$/,/^\d{6,}[a-z]{1,3}$/,/^[a-z]\d[a-z]\d[a-z]\d/,/^(test|temp|fake|dummy|sample)\d*$/i,/^[qwerty]{4,}$/i,/^[asdf]{4,}$/i].some(l=>l.test(e))}function Sb(r){var s;const e=(s=r.split("@")[0])==null?void 0:s.toLowerCase();return e?["noreply","no-reply","donotreply","do-not-reply","admin","administrator","root","system","daemon","test","testing","temp","temporary","fake","dummy","example","sample","demo","null","void","none"].some(n=>e.includes(n)):!1}function tl(r){const e=r.trim().toLowerCase();if(!bb(e))return{isValid:!1,error:"Please enter a valid email address (e.g., user@example.com)"};const t=wb(e);return t.hasTypo?{isValid:!1,error:"Did you mean this email address?",suggestions:[t.suggestion]}:Nb(e)?{isValid:!1,error:"Temporary or disposable email addresses are not allowed. Please use a permanent email address."}:Sb(e)?{isValid:!1,error:"This email address appears to be a system or test email. Please use your personal email address."}:kb(e)?{isValid:!1,error:"This email address appears to be randomly generated. Please enter a valid email address."}:vb(e)?{isValid:!1,error:"This email domain appears suspicious. Please use an email from a trusted provider."}:(jb(e),{isValid:!0})}function Eb(r){var t;if(!r.trim())return{isValid:!0};const e=r.trim().toLowerCase();return e.includes("@")&&((t=e.split("@")[1])!=null&&t.includes("."))?tl(e):{isValid:!0}}const Ab=()=>{const{refreshProfile:r}=ve(),e=Tt(),[t,s]=b.useState(!0),[n,i]=b.useState({email:"",password:"",confirmPassword:"",displayName:""}),[o,l]=b.useState(!1),[c,d]=b.useState(!1),[u,h]=b.useState(!1),[f,p]=b.useState({isValid:!0}),[m,g]=b.useState(!1),[y,x]=b.useState(""),N=zn(),A=async w=>{w.preventDefault(),l(!0);try{const v=tl(n.email);if(!v.isValid){K.error(v.error||"Please enter a valid email address"),l(!1);return}if(t)await p0(n.email,n.password),await r(),K.success("Welcome back!"),e("/");else{if(n.password!==n.confirmPassword){K.error("Passwords do not match"),l(!1);return}const D=await h0(n.email,n.password,n.displayName);K.success("Account created! Please check your email and verify your address from any device."),e("/email-verify",{state:{email:n.email,displayName:n.displayName}})}}catch(v){K.error(v.message||"An error occurred")}finally{l(!1)}},S=async()=>{l(!0);try{await x0(),await r(),K.success("Signed in with Google!"),e("/")}catch(w){K.error(w.message||"Google sign-in failed.")}finally{l(!1)}},k=w=>{const{name:v,value:D}=w.target;if(i(C=>({...C,[v]:D})),v==="email"){const C=Eb(D);p(C),!m&&D.trim()&&g(!0)}},R=()=>{if(g(!0),n.email.trim()){const w=tl(n.email);p(w)}},j=w=>{i(v=>({...v,email:w})),p({isValid:!0})};return b.useEffect(()=>{const w=new URLSearchParams(N.search),v=w.get("mode"),D=w.get("oobCode");v==="verifyEmail"&&D&&e(`/verify-email?mode=${v}&oobCode=${D}`,{replace:!0});const C=N.state;C!=null&&C.message&&x(C.message),C!=null&&C.verifiedEmail&&i(P=>({...P,email:C.verifiedEmail})),C!=null&&C.showLogin&&s(!0),C&&e(N.pathname,{replace:!0,state:{}})},[N.search,N.state,e]),a.jsxs("div",{className:"min-h-screen flex flex-col px-4",style:{backgroundColor:"#EFEDFA"},children:[a.jsx("div",{className:"w-full max-w-7xl mx-auto py-4",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs(le,{to:"/",className:"flex items-center space-x-2 text-gray-600 hover:text-blue-600 transition-colors group",children:[a.jsx(Lt,{className:"h-5 w-5 group-hover:-translate-x-1 transition-transform"}),a.jsx("span",{className:"font-medium",children:"Back to Homepage"})]}),a.jsxs(le,{to:"/",className:"flex items-center space-x-3 text-2xl font-bold bg-gradient-to-r from-[#1D4ED8] via-[#7C3AED] to-[#EC4899] bg-clip-text text-transparent hover:from-blue-700 hover:to-purple-700 transition-all duration-300",children:[a.jsx(Bl,{className:"h-6 w-6 text-blue-600"}),a.jsx("span",{children:"InfoNest"})]})]})}),a.jsx("div",{className:"flex-1 flex items-center justify-center",children:a.jsxs("div",{className:"max-w-md w-full",children:[a.jsxs("div",{className:"text-center mb-8",children:[a.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-[#1D4ED8] via-[#7C3AED] to-[#EC4899] bg-clip-text text-transparent mb-2",children:"Welcome to InfoNest"}),a.jsx("p",{className:"text-gray-600 mt-2",children:t?"Where Documentation Meets Efficiency":"Join the knowledge community"})]}),a.jsxs("div",{className:"bg-white/80 backdrop-blur-md rounded-2xl shadow-xl border border-gray-100 p-8",children:[y&&a.jsx("div",{className:"mb-6 p-4 bg-green-50 border border-green-200 rounded-lg",children:a.jsx("p",{className:"text-green-800 text-sm",children:y})}),a.jsxs("form",{onSubmit:A,className:"space-y-6",children:[!t&&a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Display Name *"}),a.jsxs("div",{className:"relative",children:[a.jsx(_e,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),a.jsx("input",{type:"text",name:"displayName",value:n.displayName,onChange:k,onBlur:R,className:`w-full pl-10 pr-4 py-3 border rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all ${m&&!f.isValid?"border-red-300 bg-red-50":"border-gray-200"}`,placeholder:"Enter your name",required:!t})]}),m&&!f.isValid&&a.jsxs("div",{className:"mt-2",children:[a.jsx("p",{className:"text-red-600 text-sm",children:f.error}),f.suggestions&&f.suggestions.length>0&&a.jsxs("div",{className:"mt-2",children:[a.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Did you mean:"}),f.suggestions.map((w,v)=>a.jsx("button",{type:"button",onClick:()=>j(w),className:"inline-block bg-blue-100 hover:bg-blue-200 text-blue-800 px-3 py-1 rounded-full text-sm mr-2 transition-colors",children:w},v))]})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email Address *"}),a.jsxs("div",{className:"relative",children:[a.jsx(Wt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),a.jsx("input",{type:"email",name:"email",value:n.email,onChange:k,className:"w-full pl-10 pr-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all",placeholder:"Enter your email",required:!0})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Password *"}),a.jsxs("div",{className:"relative",children:[a.jsx(Hr,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),a.jsx("input",{type:c?"text":"password",name:"password",value:n.password,onChange:k,className:"w-full pl-10 pr-12 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all",placeholder:"Enter your password",required:!0}),a.jsx("button",{type:"button",onClick:()=>d(!c),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:c?a.jsx(zs,{className:"h-5 w-5"}):a.jsx(us,{className:"h-5 w-5"})})]})]}),!t&&a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Confirm Password *"}),a.jsxs("div",{className:"relative",children:[a.jsx(Hr,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),a.jsx("input",{type:u?"text":"password",name:"confirmPassword",value:n.confirmPassword,onChange:k,className:`w-full pl-10 pr-12 py-3 border rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all ${n.confirmPassword&&n.password!==n.confirmPassword?"border-red-300 bg-red-50":"border-gray-200"}`,placeholder:"Confirm your password",required:!t}),a.jsx("button",{type:"button",onClick:()=>h(!u),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:u?a.jsx(zs,{className:"h-5 w-5"}):a.jsx(us,{className:"h-5 w-5"})})]}),n.confirmPassword&&n.password!==n.confirmPassword&&a.jsx("p",{className:"text-red-600 text-sm mt-1",children:"Passwords do not match"})]}),a.jsx("button",{type:"submit",disabled:o||!t&&n.password!==n.confirmPassword||m&&!f.isValid,className:"w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white py-3 rounded-xl font-medium hover:from-blue-700 hover:to-purple-700 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:o?"Please wait...":t?"Sign In":"Create Account"})]}),a.jsx("div",{className:"mt-4",children:a.jsxs("button",{onClick:S,className:"w-full flex items-center justify-center border border-gray-300 text-gray-700 bg-white py-2 rounded-xl font-medium hover:bg-gray-50 transition-all",disabled:o,children:[a.jsx(H0,{className:"h-5 w-5 mr-2"})," Continue with Google"]})}),a.jsx("div",{className:"mt-6 text-center",children:a.jsx("button",{onClick:()=>s(!t),className:"text-blue-600 hover:text-blue-700 font-medium",children:t?"Don't have an account? Sign up":"Already have an account? Sign in"})})]}),a.jsx("div",{className:"text-center mt-8 text-sm text-gray-500",children:a.jsx("p",{children:"Secure knowledge management platform"})}),!t&&a.jsxs("div",{className:"mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[a.jsx("h4",{className:"text-sm font-semibold text-blue-900 mb-2",children:"📧 Email Verification Required"}),a.jsx("p",{className:"text-sm text-blue-800",children:"After creating your account, you'll receive a verification email. You can verify your email from any device - the verification will work across all your devices automatically."})]})]})})]})},Cb=r=>{const[e,t]=b.useState(!1),[s,n]=b.useState(null),[i,o]=b.useState(!0);return b.useEffect(()=>{let l;const c=Do(ke,async d=>{if(d){if(await d.reload(),(!r||d.email===r)&&d.emailVerified){t(!0),n(d),o(!1);return}n(d)}else n(null);o(!1)});return l=setInterval(async()=>{ke.currentUser&&(await ke.currentUser.reload(),(!r||ke.currentUser.email===r)&&ke.currentUser.emailVerified&&!e&&(t(!0),n(ke.currentUser)))},3e3),()=>{c(),l&&clearInterval(l)}},[r,e]),{isVerified:e,user:s,loading:i}},Mb=()=>{const r=Tt(),e=zn(),[t,s]=b.useState(!1),[n,i]=b.useState(""),[o,l]=b.useState(""),[c,d]=b.useState(null),[u,h]=b.useState(""),{isVerified:f,user:p}=Cb(n);b.useEffect(()=>{const y=e.state;y!=null&&y.email?(i(y.email),l(y.displayName||"")):r("/auth")},[e.state,r]);const m=async()=>{if(!c){r("/auth");return}s(!0),h("");try{const x=`${window.location.origin}/#/verify-email`;await eh(c,{url:x,handleCodeInApp:!1}),h("✅ Verification email sent! Please check your inbox.")}catch(y){y.code==="auth/too-many-requests"?h("⚠️ Too many requests. Please wait a few minutes before requesting another verification email."):y.code==="auth/user-not-found"?h("❌ User not found. Please sign up again."):h("❌ Failed to send verification email. Please try again later.")}finally{s(!1)}},g=async()=>{try{await Mo(ke),r("/")}catch{}};return b.useEffect(()=>{const y=Do(ke,async x=>{if(d(x),x)try{await x.reload()}catch{}else d(null)});return()=>{y()}},[]),b.useEffect(()=>{f&&p&&r("/auth",{replace:!0,state:{message:"Email verified successfully! Please log in to continue."}})},[f,p,r]),a.jsx("div",{className:"min-h-screen flex items-center justify-center px-4",style:{backgroundColor:"#EFEDFA"},children:a.jsxs("div",{className:"max-w-md w-full",children:[a.jsxs("div",{className:"text-center mb-8",children:[a.jsx("div",{className:"bg-blue-100 p-4 rounded-full w-20 h-20 mx-auto mb-6 flex items-center justify-center",children:a.jsx(Wt,{className:"h-10 w-10 text-blue-600"})}),a.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent mb-2",children:"Verify Your Email"}),a.jsx("p",{className:"text-gray-600",children:"We've sent a verification link to your email address."})]}),a.jsxs("div",{className:"bg-white/80 backdrop-blur-md rounded-2xl shadow-xl border border-gray-100 p-8",children:[a.jsxs("div",{className:"text-center mb-6",children:[a.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6",children:a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(St,{className:"h-5 w-5 text-yellow-600"}),a.jsx("p",{className:"text-yellow-800 text-sm",children:"Please verify your email address to continue using InfoNest."})]})}),a.jsx("p",{className:"text-gray-700 mb-2",children:"We sent a verification email to:"}),a.jsx("p",{className:"font-semibold text-gray-900 mb-6",children:n}),a.jsx("p",{className:"text-sm text-gray-600 mb-6",children:"Click the verification link in your email to activate your account."}),a.jsx("p",{className:"text-sm text-gray-600 mb-6",children:"Don't see the email? Check your spam folder or request a new one."})]}),a.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6",children:[a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx("div",{className:"animate-pulse h-3 w-3 bg-blue-500 rounded-full"}),a.jsx("p",{className:"text-blue-800 text-sm font-medium",children:"Waiting for email verification... This will happen automatically when you click the link from any device."})]}),a.jsx("p",{className:"text-blue-700 text-xs mt-2",children:"💡 You can verify your email from any device - mobile, tablet, or computer. Once verified, this page will automatically update."})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsx("button",{onClick:m,disabled:t||!c,className:"w-full flex items-center justify-center space-x-2 bg-gray-100 hover:bg-gray-200 text-gray-700 py-3 rounded-xl font-medium transition-all disabled:opacity-50",children:t?a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"animate-spin h-4 w-4 border-2 border-gray-600 border-t-transparent rounded-full"}),a.jsx("span",{children:"Sending..."})]}):a.jsxs(a.Fragment,{children:[a.jsx(Wt,{className:"h-4 w-4"}),a.jsx("span",{children:"Resend Verification Email"})]})}),u&&a.jsx("div",{className:`rounded-lg p-3 ${u.includes("✅")?"bg-green-50 border border-green-200":u.includes("⚠️")?"bg-yellow-50 border border-yellow-200":"bg-red-50 border border-red-200"}`,children:a.jsx("p",{className:`text-sm ${u.includes("✅")?"text-green-800":u.includes("⚠️")?"text-yellow-800":"text-red-800"}`,children:u})}),!c&&a.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3",children:a.jsx("p",{className:"text-yellow-800 text-sm",children:"⚠️ You've been signed out. Please sign in again to resend the verification email."})}),a.jsx("div",{className:"border-t border-gray-200 pt-4",children:a.jsxs("button",{onClick:g,className:"w-full flex items-center justify-center space-x-2 text-gray-600 hover:text-red-600 py-2 rounded-lg transition-colors",children:[a.jsx(zl,{className:"h-4 w-4"}),a.jsx("span",{children:"Sign Out"})]})})]})]}),a.jsx("div",{className:"text-center mt-8 text-sm text-gray-500",children:a.jsx("p",{children:"Having trouble? You can verify your email from any device. Contact support if you need help."})})]})})},Db=()=>{const[r]=Zu(),e=Tt(),[t,s]=b.useState("loading"),[n,i]=b.useState(""),[o,l]=b.useState(!1),[c,d]=b.useState(""),u=async()=>{l(!0),i("Please sign up again to receive a new verification email."),setTimeout(()=>{e("/auth",{replace:!0})},2e3),l(!1)};return b.useEffect(()=>{(async()=>{const f=r.get("mode"),p=r.get("oobCode");if(f!=="verifyEmail"||!p){s("error"),i("Invalid verification link. Please check your email for the correct link.");return}try{s("loading"),i("Verifying your email address...");const g=(await dg(ke,p)).data.email;d(g||""),await ug(ke,p),await new Promise(y=>setTimeout(y,1e3)),ke.currentUser&&ke.currentUser.email===g&&(await ke.currentUser.reload(),ke.currentUser.emailVerified||await ke.currentUser.reload()),s("success"),i("🎉 Email verified successfully! Your account is now active and you can sign in with your verified email."),setTimeout(()=>{e("/auth",{replace:!0,state:{message:"✅ Email verified successfully! Login to access the platform.",verifiedEmail:g,showLogin:!0}})},4e3)}catch(m){s("error"),m.code==="auth/invalid-action-code"?i("This verification link has expired or has already been used. Please sign up again to receive a new verification email."):m.code==="auth/expired-action-code"?i("This verification link has expired. Please sign up again to receive a new verification email."):m.code==="auth/user-disabled"?i("This account has been disabled. Please contact support."):m.code==="auth/user-not-found"?i("No account found for this verification link. Please sign up again."):i(`Email verification failed: ${m.message}. Please try signing up again.`)}})()},[r,e]),a.jsx("div",{className:"min-h-screen flex items-center justify-center px-4",style:{backgroundColor:"#EFEDFA"},children:a.jsxs("div",{className:"max-w-md w-full",children:[a.jsxs("div",{className:"bg-white/80 backdrop-blur-md rounded-2xl shadow-xl border border-gray-100 p-8 text-center",children:[t==="loading"&&a.jsxs(a.Fragment,{children:[a.jsx(qe,{className:"h-16 w-16 text-blue-600 animate-spin mx-auto mb-6"}),a.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Verifying Email"}),a.jsx("p",{className:"text-gray-600",children:n})]}),t==="success"&&a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"bg-green-100 p-4 rounded-full w-20 h-20 mx-auto mb-6 flex items-center justify-center",children:a.jsx(sr,{className:"h-10 w-10 text-green-600"})}),a.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Email Verified!"}),a.jsx("p",{className:"text-gray-600 mb-4",children:n}),c&&a.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4",children:a.jsxs("p",{className:"text-blue-800 text-sm font-medium",children:["✅ Verified Email: ",c]})}),a.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 mb-6",children:a.jsx("p",{className:"text-green-800 text-sm",children:"🎉 Email verification complete! You can now login to access the platform."})}),a.jsxs("button",{onClick:()=>e("/auth",{replace:!0,state:{message:"✅ Email verified successfully! Please log in to continue.",verifiedEmail:c,showLogin:!0}}),className:"inline-flex items-center space-x-2 bg-gradient-to-r from-blue-600 to-purple-600 text-white px-6 py-3 rounded-xl font-medium hover:from-blue-700 hover:to-purple-700 transition-all",children:[a.jsx(Bl,{className:"h-4 w-4"}),a.jsx("span",{children:"Go to Login"})]})]}),t==="error"&&a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"bg-red-100 p-4 rounded-full w-20 h-20 mx-auto mb-6 flex items-center justify-center",children:a.jsx(xi,{className:"h-10 w-10 text-red-600"})}),a.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Verification Failed"}),a.jsx("p",{className:"text-gray-600 mb-6",children:n}),a.jsxs("div",{className:"space-y-3",children:[a.jsx("button",{onClick:u,disabled:o,className:"w-full bg-gradient-to-r from-green-600 to-blue-600 text-white px-6 py-3 rounded-xl font-medium hover:from-green-700 hover:to-blue-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2",children:o?a.jsxs(a.Fragment,{children:[a.jsx(X0,{className:"h-4 w-4 animate-spin"}),a.jsx("span",{children:"Sending..."})]}):a.jsxs(a.Fragment,{children:[a.jsx(Wt,{className:"h-4 w-4"}),a.jsx("span",{children:"Get New Verification Email"})]})}),a.jsx("button",{onClick:()=>e("/auth",{replace:!0}),className:"w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white px-6 py-3 rounded-xl font-medium hover:from-blue-700 hover:to-purple-700 transition-all",children:"Sign Up Again"}),a.jsx("button",{onClick:()=>e("/",{replace:!0}),className:"w-full bg-gray-100 text-gray-700 px-6 py-3 rounded-xl font-medium hover:bg-gray-200 transition-colors",children:"Go to Homepage"})]})]})]}),a.jsx("div",{className:"text-center mt-8 text-sm text-gray-500",children:a.jsx("p",{children:"Having trouble? Contact support for assistance."})})]})})},ad=async(r,e)=>{try{const t=`${r}_${e.id}`;console.log("💾 Saving article");const s=ue(X,"savedArticles",t),n={id:t,userId:r,articleId:e.id,articleTitle:e.title,articleExcerpt:e.excerpt||"",articleAuthor:e.authorName||"Unknown",articleAuthorId:e.authorId||"",articleCategories:e.categories||[],articleTags:e.tags||[],articleCoverImage:e.coverImage||void 0,articleUpdatedAt:Le.fromDate(e.updatedAt),articlePublishedAt:e.publishedAt?Le.fromDate(e.publishedAt):null,savedAt:Le.now()};await bs(s,n)}catch(t){throw console.error("Error saving article:",t),new Error("Failed to save article")}},lf=async(r,e)=>{try{const t=ue(X,"savedArticles",`${r}_${e}`);await Rt(t)}catch(t){throw console.error("Error removing saved article:",t),new Error("Failed to remove saved article")}},Tb=async(r,e)=>{try{const t=ue(X,"savedArticles",`${r}_${e}`);return(await It(t)).exists()}catch(t){return console.error("Error checking if article is saved:",t),!1}},Ob=(r,e)=>{const t=xe(pe(X,"savedArticles"),Oe("userId","==",r));return Ee(t,s=>{const n=s.docs.map(i=>{var l,c;const o=i.data();return{...o,savedAt:o.savedAt.toDate(),articleUpdatedAt:((l=o.articleUpdatedAt)==null?void 0:l.toDate())||o.savedAt.toDate(),articlePublishedAt:(c=o.articlePublishedAt)==null?void 0:c.toDate()}});n.sort((i,o)=>o.savedAt.getTime()-i.savedAt.getTime()),e(n)},s=>{console.error("Error in saved articles subscription:",s),e([])})},cf=({article:r,articleId:e,articleTitle:t,articleAuthor:s,className:n="",showLabel:i=!1,size:o="md"})=>{const{userProfile:l,isAuthenticated:c}=ve(),[d,u]=b.useState(!1),[h,f]=b.useState(!1),[p,m]=b.useState(!0),g=(r==null?void 0:r.id)||e;b.useEffect(()=>{(async()=>{if(!(l!=null&&l.uid)||!c||!g){m(!1);return}try{const S=await Tb(l.uid,g);u(S)}catch(S){console.error("Error checking saved status:",S)}finally{m(!1)}})()},[l==null?void 0:l.uid,g,c]);const y=async()=>{if(!(l!=null&&l.uid)||!c||!g){K.error("Please login to save articles");return}f(!0);try{if(d)await lf(l.uid,g),u(!1),K.success("Article removed from saved articles");else{if(r)await ad(l.uid,r);else{const A=await Fo(g);if(A)await ad(l.uid,A);else throw new Error("Article not found")}u(!0),K.success("Article saved successfully!")}}catch(A){console.error("Error toggling save status:",A),K.error(d?"Failed to remove article":"Failed to save article")}finally{f(!1)}};if(!c)return null;const x={sm:"h-4 w-4",md:"h-5 w-5",lg:"h-6 w-6"},N={sm:"p-1.5",md:"p-2",lg:"p-3"};return p?a.jsxs("div",{className:`flex items-center space-x-2 ${n}`,children:[a.jsx("div",{className:"h-4 w-4 border-2 border-purple-600 border-t-transparent rounded-full animate-spin"}),i&&a.jsx("span",{className:"text-sm text-gray-600",children:"Checking..."})]}):i?a.jsxs("button",{onClick:y,disabled:h,className:`
        flex items-center space-x-2 px-4 py-2 rounded-lg transition-all duration-200
        ${d?"bg-purple-100 text-purple-700 hover:bg-purple-200 border border-purple-200":"bg-white text-gray-700 hover:bg-purple-50 border border-gray-200 hover:border-purple-200"}
        disabled:opacity-50 disabled:cursor-not-allowed
        ${n}
      `,title:d?"Remove from saved articles":"Save article for later",children:[h?a.jsx("div",{className:"h-4 w-4 border-2 border-current border-t-transparent rounded-full animate-spin"}):d?a.jsx(Gc,{className:"h-4 w-4"}):a.jsx(br,{className:"h-4 w-4"}),a.jsx("span",{className:"text-sm font-medium",children:h?d?"Removing...":"Saving...":d?"Saved":"Save Article"})]}):a.jsx("button",{onClick:y,disabled:h||!l,className:`${N[o]} ${d?"text-purple-600 hover:text-purple-700 hover:bg-purple-50":"text-gray-600 hover:text-purple-600 hover:bg-purple-50"} rounded-lg transition-colors flex items-center space-x-1 disabled:opacity-50 disabled:cursor-not-allowed ${n}`,title:d?"Remove from saved":"Save article",children:h?a.jsx("div",{className:`${x[o]} border-2 border-current border-t-transparent rounded-full animate-spin`}):d?a.jsx(Gc,{className:`${x[o]} fill-current transition-all`}):a.jsx(br,{className:`${x[o]} transition-all`})})},Rb=({articleId:r,articleStatus:e,articleAuthorId:t,initialLikes:s=0,initialLikedBy:n=[],size:i="md",showLabel:o=!0,className:l=""})=>{const{userProfile:c}=ve(),[d,u]=b.useState(!1),[h,f]=b.useState(s),[p,m]=b.useState(!1),[g,y]=b.useState(n);b.useEffect(()=>{f(s),y(n),c!=null&&c.uid?u(n.includes(c.uid)):u(!1)},[s,n,c==null?void 0:c.uid]),b.useEffect(()=>{if(!r)return;if(!(c?e==="published"||c.uid===t||c.role==="admin":!1)){f(s),y(n),c!=null&&c.uid&&u(n.includes(c.uid));return}const R=ue(X,"articles",r),j=Ee(R,w=>{if(w.exists()){const v=w.data(),D=v.likes||0,C=v.likedBy||[];f(D),y(C),c!=null&&c.uid?u(C.includes(c.uid)):u(!1)}},w=>{if(w.code==="permission-denied"){console.warn("Permission denied for like button subscription - article may be private");return}console.error("Error listening to article updates:",w)});return()=>j()},[r,c==null?void 0:c.uid,c==null?void 0:c.role,e,t,s,n]);const x=async k=>{if(k.preventDefault(),k.stopPropagation(),!c){K.error("Please log in to like articles");return}if(!p){m(!0);try{const R=ue(X,"articles",r),j=c.uid;d?await We(R,{likes:Sr(-1),likedBy:g.filter(w=>w!==j)}):await We(R,{likes:Sr(1),likedBy:[...g,j]})}catch(R){console.error("Error toggling like:",R),K.error("Failed to update like. Please try again.")}finally{m(!1)}}},N={sm:"h-3 w-3",md:"h-4 w-4",lg:"h-5 w-5"},A={sm:"p-1.5",md:"p-2",lg:"p-2.5"},S={sm:"text-xs",md:"text-sm",lg:"text-base"};return a.jsxs("button",{onClick:x,disabled:p,className:`${A[i]} ${d?"text-red-600 hover:text-red-700 hover:bg-red-50":"text-gray-600 hover:text-red-600 hover:bg-red-50"} rounded-lg transition-colors flex items-center space-x-1 disabled:opacity-50 disabled:cursor-not-allowed ${l}`,title:d?"Unlike article":"Like article",children:[p?a.jsx("div",{className:`${N[i]} border-2 border-current border-t-transparent rounded-full animate-spin`}):a.jsx(vh,{className:`${N[i]} ${d?"fill-current":""}`}),o&&a.jsx("span",{className:S[i],children:h})]})},Ns=({article:r,showStatus:e=!1,showActions:t=!0,showEditButton:s=!1,showManagementMenu:n=!1,variant:i="default",className:o=""})=>{const{userProfile:l,canEditArticle:c,canDeleteArticle:d}=ve(),[u,h]=b.useState(!1),[f,p]=b.useState(r),[m,g]=b.useState(null),[y,x]=b.useState(!1),[N,A]=b.useState(!1),[S,k]=b.useState(!1),[R,j]=b.useState(!1);b.useEffect(()=>{const H=ue(X,"articles",r.id),I=Ee(H,E=>{var F,U,L;if(E.exists()){const _=E.data(),Y={..._,id:E.id,createdAt:(F=_.createdAt)==null?void 0:F.toDate(),updatedAt:(U=_.updatedAt)==null?void 0:U.toDate(),publishedAt:(L=_.publishedAt)==null?void 0:L.toDate()};p(Y)}},E=>{if(E.code==="permission-denied"){console.warn("Permission denied for article card subscription - article may be private");return}console.error("Error in article card subscription:",E)});return()=>I()},[r.id]),b.useEffect(()=>{const H=I=>{if(S){const E=I.target,F=document.querySelector(`[data-dropdown-id="${f.id}"]`),U=document.querySelector(`[data-dropdown-button="${f.id}"]`);F&&!F.contains(E)&&U&&!U.contains(E)&&k(!1)}};return document.addEventListener("mousedown",H),()=>{document.removeEventListener("mousedown",H)}},[S,f.id]),b.useEffect(()=>{if(!r.authorId)return;const H=ue(X,"users",r.authorId),I=Ee(H,E=>{var F,U;if(E.exists()){const L=E.data(),_={uid:r.authorId,email:L.email||"",displayName:L.displayName||"",role:L.role||"user",emailVerified:L.emailVerified||!1,profilePicture:L.profilePicture||"",createdAt:(F=L.createdAt)==null?void 0:F.toDate(),updatedAt:(U=L.updatedAt)==null?void 0:U.toDate(),requestedWriterAccess:L.requestedWriterAccess||!1};g(_),L.profilePicture&&h(!1)}else g(null)},E=>{if(E.code==="permission-denied"){console.warn("Permission denied for author profile subscription - user may not have access");return}console.error("Error in author profile subscription:",E)});return()=>I()},[r.authorId]);const w=H=>{switch(H){case"published":return"bg-green-100 text-green-700";case"draft":return"bg-yellow-100 text-yellow-700";case"unpublished":return"bg-gray-100 text-gray-700";default:return"bg-gray-100 text-gray-700"}},v=()=>l?c(f.authorId,f.status):!1,D=()=>l?d(f.authorId,m==null?void 0:m.role):!1,C=async()=>{if(!(!l||!D())){A(!0);try{await Ph(f.id,l.role,l.uid,f.authorId,m==null?void 0:m.role,"Article removed by administrator");const I=l.uid===f.authorId?"Article deleted successfully":"Article unpublished successfully";Ne.success(I),x(!1),window.location.reload()}catch(H){console.error("Error deleting article:",H),Ne.error("Failed to delete article")}finally{A(!1)}}},P=async H=>{if(!(l!=null&&l.uid)){Ne.error("You must be logged in to update articles");return}j(!0);try{const I={status:H};if(H==="published"){const U=new Date;I.publishedAt=U,I.updatedAt=U}await _o(f.id,I);const E=new Date;p(U=>({...U,status:H,publishedAt:H==="published"?E:U.publishedAt,updatedAt:E}));const F=H==="published"?"published":"unpublished";Ne.success(`Article ${F} successfully`)}catch(I){console.error("Error updating article status:",I),Ne.error(`Error updating article status: ${I instanceof Error?I.message:"Unknown error"}`)}finally{j(!1),k(!1)}},O=()=>{switch(i){case"compact":return"p-4";case"featured":return"p-8";default:return"p-6"}},W=()=>{switch(i){case"compact":return"aspect-video h-32";case"featured":return"aspect-video h-48";default:return"aspect-video h-40"}};return a.jsxs("div",{className:`bg-white/80 backdrop-blur-sm rounded-xl border border-gray-200 hover:border-transparent transition-all duration-300 hover:shadow-lg group flex flex-col h-full relative overflow-hidden ${O()} ${o}`,style:{background:"white"},onMouseEnter:H=>{H.currentTarget.style.background="linear-gradient(white, white) padding-box, linear-gradient(to right, #1D4ED8, #7C3AED, #EC4899) border-box",H.currentTarget.style.border="2px solid transparent"},onMouseLeave:H=>{H.currentTarget.style.background="white",H.currentTarget.style.border="1px solid #e5e7eb"},children:[a.jsxs(le,{to:`/article/${f.id}`,className:"flex-1 flex flex-col",children:[f.coverImage&&a.jsx("div",{className:`bg-gray-100 rounded-lg mb-4 overflow-hidden ${W()} flex-shrink-0`,children:a.jsx("img",{src:f.coverImage,alt:f.title,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-300",onError:H=>{const I=H.target;I.style.display="none"}})}),a.jsxs("div",{className:"flex items-start justify-between mb-3 min-h-[3rem]",children:[a.jsx("h3",{className:`font-semibold bg-gradient-to-r from-[#1D4ED8] via-[#7C3AED] to-[#EC4899] bg-clip-text text-transparent transition-colors line-clamp-2 ${i==="featured"?"text-2xl":i==="compact"?"text-lg":"text-xl"}`,children:f.title}),e&&a.jsx("span",{className:`ml-2 px-2 py-1 text-xs rounded-full font-medium flex-shrink-0 ${w(f.status)}`,children:f.status})]}),a.jsx("div",{className:"flex items-center space-x-3 mb-3 min-h-[2.5rem]",children:a.jsxs(le,{to:`/author/${f.authorId}`,className:"flex items-center space-x-2 hover:bg-gray-50 rounded-lg p-1 -m-1 transition-colors group",onClick:H=>H.stopPropagation(),children:[a.jsx("div",{className:"w-8 h-8 rounded-full overflow-hidden bg-gray-200 flex-shrink-0 relative group-hover:ring-2 group-hover:ring-blue-200 transition-all",children:!u&&(m!=null&&m.profilePicture)?a.jsx("img",{src:m.profilePicture,alt:`${(m==null?void 0:m.displayName)||f.authorName}'s profile`,className:"w-full h-full object-cover",onError:()=>h(!0)}):a.jsx("div",{className:"w-full h-full bg-gradient-to-br from-blue-100 to-blue-200 flex items-center justify-center group-hover:from-blue-200 group-hover:to-blue-300 transition-all",children:a.jsx("span",{className:"text-blue-700 text-xs font-semibold",children:((m==null?void 0:m.displayName)||f.authorName).charAt(0).toUpperCase()})})}),a.jsxs("div",{className:"flex flex-col",children:[a.jsx("span",{className:"text-sm font-medium text-gray-700 group-hover:text-blue-600 transition-colors",children:(m==null?void 0:m.displayName)||f.authorName}),(m==null?void 0:m.role)&&a.jsx("span",{className:"text-xs text-gray-500 capitalize",children:m.role==="infowriter"||m.role==="admin"?"InfoWriter":m.role})]})]})}),a.jsx("p",{className:`text-gray-600 mb-4 flex-grow text-sm ${f.coverImage?"line-clamp-3":"line-clamp-6"}`,style:{minHeight:f.coverImage?"3.75rem":"7.5rem"},children:f.excerpt||"No excerpt available"}),a.jsxs("div",{className:"flex items-center text-xs text-gray-500 mb-3",children:[a.jsx(jt,{className:"h-3 w-3 mr-1"}),a.jsxs("span",{children:["Updated: ",Pi(f.updatedAt,"dd/MM/yyyy")]})]}),a.jsx("div",{className:"mb-3 min-h-[1.5rem] flex items-center",children:f.categories.length>0&&a.jsxs(a.Fragment,{children:[a.jsx(Mi,{className:"h-3 w-3 text-gray-400 mr-1"}),a.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-700 text-xs rounded-full",children:f.categories[0]})]})}),a.jsx("div",{className:"mb-4 min-h-[2rem] flex items-start",children:f.tags.length>0&&a.jsxs("div",{className:"flex flex-wrap gap-1",children:[f.tags.slice(0,3).map(H=>a.jsxs("span",{className:"px-2 py-1 bg-gray-100 text-gray-600 text-xs rounded-full flex items-center",children:[a.jsx(hs,{className:"h-2 w-2 mr-1"}),H]},H)),f.tags.length>3&&a.jsxs("span",{className:"text-xs text-gray-500",children:["+",f.tags.length-3," more"]})]})})]}),a.jsxs("div",{className:"flex items-center justify-between mt-auto pt-2",children:[a.jsx("div",{className:"flex items-center space-x-2",children:t&&a.jsxs(ze.Fragment,{children:[a.jsx(cf,{articleId:f.id,articleTitle:f.title,articleAuthor:f.authorName,size:"sm"},`save-${f.id}`),a.jsx(Rb,{articleId:f.id,articleStatus:f.status,articleAuthorId:f.authorId,initialLikes:f.likes||0,initialLikedBy:f.likedBy||[],size:"sm",showLabel:!0},`like-${f.id}`)]},"article-actions")}),a.jsxs("div",{className:"flex items-center space-x-2",children:[s&&v()&&a.jsx(le,{to:`/article/edit/${f.id}`,className:"p-2 text-gray-600 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",title:"Edit Article",children:a.jsx(Hl,{className:"h-4 w-4"})}),n&&(D()||l&&(l.role==="admin"||l.role==="infowriter"))&&a.jsx("div",{className:"relative",children:y?a.jsxs("div",{className:"flex items-center space-x-1",children:[a.jsx("button",{onClick:C,disabled:N,className:"p-2 text-red-600 hover:text-red-700 hover:bg-red-50 rounded-lg transition-colors disabled:opacity-50",title:"Confirm Delete",children:N?a.jsx("div",{className:"h-4 w-4 animate-spin border-2 border-red-600 border-t-transparent rounded-full"}):a.jsx(Ci,{className:"h-4 w-4"})}),a.jsx("button",{onClick:()=>x(!1),className:"p-2 text-gray-600 hover:text-gray-700 hover:bg-gray-50 rounded-lg transition-colors",title:"Cancel",children:a.jsx(gt,{className:"h-4 w-4"})})]}):a.jsxs(a.Fragment,{children:[a.jsx("button",{onClick:()=>k(!S),"data-dropdown-button":f.id,className:"p-2 text-gray-600 hover:text-gray-800 hover:bg-gray-50 rounded-lg transition-colors",title:"More Actions",children:a.jsx(jh,{className:"h-4 w-4"})}),S&&a.jsx("div",{"data-dropdown-id":f.id,className:"absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-gray-200 z-10",children:a.jsxs("div",{className:"py-1",children:[f.status==="published"&&l&&(l.role==="admin"||l.uid===f.authorId)&&a.jsxs("button",{onClick:H=>{H.stopPropagation(),P("unpublished")},disabled:R,className:"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-red-50 hover:text-red-700 flex items-center space-x-2 disabled:opacity-50",children:[a.jsx(zs,{className:"h-4 w-4"}),a.jsx("span",{children:"Unpublish"})]}),f.status==="unpublished"&&l&&(l.role==="admin"||l.uid===f.authorId)&&a.jsxs("button",{onClick:H=>{H.stopPropagation(),P("published")},disabled:R,className:"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-green-50 hover:text-green-700 flex items-center space-x-2 disabled:opacity-50",children:[a.jsx(Sn,{className:"h-4 w-4"}),a.jsx("span",{children:"Publish"})]}),D()&&a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"border-t border-gray-100 my-1"}),a.jsxs("button",{onClick:()=>{x(!0),k(!1)},className:"w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-red-50 flex items-center space-x-2",children:[a.jsx(Or,{className:"h-4 w-4"}),a.jsx("span",{children:"Delete"})]})]})]})})]})})]})]})]})},Ib=()=>{const r=Tt(),{isAuthenticated:e,userProfile:t,loading:s}=ve(),[n,i]=b.useState(null),[o,l]=b.useState(!0),[c,d]=b.useState(!1),u=()=>{l(!0);const m=xe(pe(X,"articles"),Oe("status","==","published"));return Ee(m,y=>{try{const x=[];y.forEach(j=>{var D,C,P;const w=j.data(),v={id:j.id,...w,createdAt:((D=w.createdAt)==null?void 0:D.toDate())||new Date,updatedAt:(C=w.updatedAt)==null?void 0:C.toDate(),publishedAt:(P=w.publishedAt)==null?void 0:P.toDate()};x.push(v)});const N=h(x),A=new Map,S=new Set;x.forEach(j=>{j.categories.forEach(w=>{A.set(w,(A.get(w)||0)+1)}),j.tags.forEach(w=>S.add(w))});const k=Array.from(A.entries()).map(([j,w])=>({name:j,count:w})).sort((j,w)=>w.count-j.count).slice(0,8),R=Array.from(S).slice(0,20);i({articles:x,featuredArticles:N,categories:k,tags:R}),l(!1)}catch(x){console.error("Error loading homepage data:",x),l(!1)}})},h=m=>{const g=["Technology","Business","Education","Health","Finance","Marketing","Development","Design","Management","Research"],y=x=>{let N=0;if(x.coverImage&&x.authorId&&(N+=1e4,N+=1e3),x.categories.some(S=>g.some(k=>S.toLowerCase().includes(k.toLowerCase())))){N+=5e3;const S=x.categories.filter(k=>g.some(R=>k.toLowerCase().includes(R.toLowerCase()))).length;N+=S*500}if(x.tags&&x.tags.length>0){N+=1e3,N+=Math.min(x.tags.length*100,500);const S=x.tags.filter(k=>k.length>2&&!k.includes(" "));N+=S.length*50}if(x.title&&x.title.trim().length>10){N+=500;const S=x.title.trim().length;S>=20&&S<=80&&(N+=200),["guide","tutorial","how to","best practices","tips"].some(j=>x.title.toLowerCase().includes(j))&&(N+=150)}if(x.content&&x.content.trim().length>100&&(N+=200,x.content.trim().length>=500&&(N+=100),x.content.trim().length>=1e3&&(N+=100)),x.publishedAt){const S=(Date.now()-x.publishedAt.getTime())/864e5;S<7?N+=300:S<30&&(N+=150)}return x.views&&x.views>0&&(N+=Math.min(x.views*.5,200)),x.likes&&x.likes>0&&(N+=Math.min(x.likes*2,100)),N};return m.map(x=>({article:x,priority:y(x)})).sort((x,N)=>N.priority-x.priority).slice(0,12).map(({article:x})=>x)};b.useEffect(()=>{const m=u();return()=>m()},[]);const f=m=>{e?m&&r(`/article/${m}`):r("/auth?redirect=dashboard")},p=async()=>{try{d(!1),r("/",{replace:!0}),await ch()}catch(m){console.error("Error logging out:",m),r("/",{replace:!0})}};return o||s?a.jsx("div",{className:"min-h-screen flex items-center justify-center",style:{backgroundColor:"#EFEDFA"},children:a.jsxs("div",{className:"text-center",children:[a.jsx(qe,{className:"h-16 w-16 text-blue-600 animate-spin mx-auto mb-6"}),a.jsx("h2",{className:"text-2xl font-semibold text-gray-900 mb-2",children:"Loading InfoNest"}),a.jsx("p",{className:"text-gray-600",children:"Preparing your knowledge base..."})]})}):n?a.jsxs("div",{className:"min-h-screen",style:{backgroundColor:"#EFEDFA"},children:[a.jsx("header",{className:"backdrop-blur-md border-b border-gray-200/50 sticky top-0 z-50",style:{backgroundColor:"#EFEDFA"},children:a.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:a.jsxs("div",{className:"flex justify-between items-center h-16",children:[a.jsx("div",{className:"flex items-center space-x-3",children:a.jsx(le,{to:"/",className:"cursor-pointer flex items-center space-x-3",children:a.jsxs("div",{children:[a.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-[#1D4ED8] via-[#7C3AED] to-[#EC4899] bg-clip-text text-transparent",children:"InfoNest"}),a.jsx("p",{className:"text-xs text-gray-500 -mt-1",children:"Where Documentation Meets Efficiency"})]})})}),a.jsxs("nav",{className:"hidden md:flex items-center space-x-10 pr-8 ml-auto",children:[a.jsx("a",{href:"#features",className:"text-gray-600 hover:text-blue-600 transition-colors",children:"Docs"}),a.jsx("a",{href:"#about",className:"text-gray-600 hover:text-blue-600 transition-colors",children:"About"})]}),a.jsx("div",{className:"flex items-center space-x-4",children:e?a.jsxs("div",{className:"relative",children:[a.jsxs("button",{onClick:()=>d(!c),className:"flex items-center space-x-3 p-2 rounded-lg hover:bg-white/20 transition-colors",children:[a.jsxs("div",{className:"text-right",children:[a.jsx("div",{className:"text-sm font-medium text-gray-700",children:(t==null?void 0:t.displayName)||(t==null?void 0:t.email)}),a.jsx("div",{className:"text-xs text-gray-500 capitalize",children:t==null?void 0:t.role})]}),t!=null&&t.profilePicture?a.jsx("img",{src:t.profilePicture,alt:"Profile",className:"w-8 h-8 rounded-full object-cover border-2 border-white shadow-sm"}):a.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-purple-600 p-2 rounded-full",children:a.jsx(_e,{className:"h-4 w-4 text-white"})})]}),c&&a.jsxs("div",{className:"absolute right-0 mt-2 w-56 bg-white rounded-lg shadow-lg border border-gray-200 py-2 z-50",children:[a.jsxs(le,{to:"/profile",onClick:()=>d(!1),className:"flex items-center space-x-3 px-4 py-2 text-gray-700 hover:bg-gray-50 transition-colors",children:[a.jsx(_e,{className:"h-4 w-4"}),a.jsx("span",{children:"Profile"})]}),a.jsxs(le,{to:"/dashboard",onClick:()=>d(!1),className:"flex items-center space-x-3 px-4 py-2 text-gray-700 hover:bg-gray-50 transition-colors",children:[a.jsx(Er,{className:"h-4 w-4"}),a.jsx("span",{children:"Dashboard"})]}),a.jsxs(le,{to:"/saved-articles",onClick:()=>d(!1),className:"flex items-center space-x-3 px-4 py-2 text-gray-700 hover:bg-gray-50 transition-colors",children:[a.jsx(br,{className:"h-4 w-4"}),a.jsx("span",{children:"Saved Articles"})]}),a.jsx("div",{className:"border-t border-gray-200 my-2"}),a.jsxs("button",{onClick:p,className:"flex items-center space-x-3 px-4 py-2 text-red-600 hover:bg-red-50 transition-colors w-full text-left",children:[a.jsx(zl,{className:"h-4 w-4"}),a.jsx("span",{children:"Logout"})]})]})]}):a.jsx(le,{to:"/auth",className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white px-6 py-2 rounded-xl font-medium hover:from-blue-700 hover:to-purple-700 transition-all",children:"Login"})})]})})}),a.jsx("section",{className:"relative py-20 px-4 sm:px-6 lg:px-8 bg-cover bg-center bg-no-repeat",style:{backgroundImage:"linear-gradient(rgba(0,0,0,0.1),rgba(0,0,0,0.1)),url('/InfoNest/image.png')",backgroundSize:"cover",backgroundPosition:"center"},children:a.jsxs("div",{className:"max-w-7xl mx-auto text-center relative z-10",children:[a.jsx("h1",{className:"text-4xl md:text-7xl font-bold text-white mb-6",style:{textShadow:"2px 2px 4px rgba(0,0,0,0.5)"},children:"Welcome to InfoNest"}),a.jsx("p",{className:"text-2xl md:text-3xl text-white mb-4 font-light",style:{textShadow:"1px 1px 2px rgba(0,0,0,0.5)"},children:"Where Documentation Meets Efficiency"}),a.jsx("p",{className:"text-xl text-white max-w-3xl mx-auto mb-12 leading-relaxed",style:{textShadow:"1px 1px 2px rgba(0,0,0,0.5)"},children:"Centralized knowledge hub for your organization's documentation. Discover, search, and access all your important documents in one secure, organized platform."}),a.jsx("div",{className:"mt-8",children:e?a.jsxs(le,{to:"/dashboard",className:"inline-flex items-center space-x-3 bg-gradient-to-r from-blue-600 to-purple-600 text-white px-8 py-4 rounded-2xl font-semibold text-lg hover:from-blue-700 hover:to-purple-700 transition-all shadow-lg hover:shadow-xl",children:[a.jsx("span",{children:"Go to Dashboard"}),a.jsx(mi,{className:"h-5 w-5"})]}):a.jsxs(le,{to:"/auth",className:"inline-flex items-center space-x-3 bg-gradient-to-r from-blue-600 to-purple-600 text-white px-8 py-4 rounded-2xl font-semibold text-lg hover:from-blue-700 hover:to-purple-700 transition-all shadow-lg hover:shadow-xl",children:[a.jsx("span",{children:"Login or Signup to Access Documents"}),a.jsx(mi,{className:"h-5 w-5"})]})})]})}),a.jsx("div",{className:"max-w-2xl mx-auto mb-8 mt-10 mb-16",children:a.jsx(vs,{variant:"hero",placeholder:"Search articles, guides, documentation...",onResultClick:()=>{}})}),a.jsx("section",{className:"py-16 px-4 sm:px-6 lg:px-8 bg-white/50",children:a.jsxs("div",{className:"max-w-7xl mx-auto",children:[a.jsxs("div",{className:"text-center mb-12",children:[a.jsx("h2",{className:"text-3xl font-bold text-gray-900 mb-4",children:"Featured Articles"}),a.jsx("p",{className:"text-gray-600 text-lg max-w-2xl mx-auto",children:"Discover our top-quality articles, prioritized by content quality, categories, and community engagement"})]}),n.featuredArticles.length>0?a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 auto-rows-fr",children:n.featuredArticles.map((m,g)=>a.jsx("div",{className:`
                    ${g%3===0?"md:col-start-1":""}
                    ${g%3===1?"md:col-start-2":""}
                    ${g%3===2?"md:col-start-3":""}
                    cursor-pointer transition-transform hover:scale-105
                  `,onClick:()=>f(m.id),children:a.jsx(Ns,{article:m,variant:"featured",showActions:!0})},m.id))}):a.jsxs("div",{className:"text-center py-12",children:[a.jsx(zt,{className:"h-16 w-16 text-gray-300 mx-auto mb-4"}),a.jsx("p",{className:"text-gray-500",children:"No featured articles available yet."})]}),n.articles.length>n.featuredArticles.length&&a.jsx("div",{className:"text-center mt-12",children:a.jsxs("button",{onClick:()=>{r(e?"/dashboard":"/auth?redirect=dashboard")},className:"inline-flex items-center space-x-2 bg-gradient-to-r from-blue-600 to-purple-600 text-white px-8 py-3 rounded-xl font-medium hover:from-blue-700 hover:to-purple-700 transition-all shadow-lg hover:shadow-xl",children:[a.jsx("span",{children:"View All Articles"}),a.jsx(mi,{className:"h-5 w-5"})]})})]})}),a.jsx("section",{id:"features",className:"py-16 px-4 sm:px-6 lg:px-8",children:a.jsxs("div",{className:"max-w-7xl mx-auto",children:[a.jsxs("div",{className:"text-center mb-16",children:[a.jsx("h2",{className:"text-3xl font-bold text-gray-900 mb-4",children:"Why Choose InfoNest?"}),a.jsx("p",{className:"text-gray-600 text-lg max-w-2xl mx-auto",children:"Powerful features designed to streamline your documentation workflow and enhance team collaboration"})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8",children:[a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"bg-gradient-to-r from-blue-100 to-blue-200 p-4 rounded-2xl w-16 h-16 mx-auto mb-6 flex items-center justify-center",children:a.jsx(Ti,{className:"h-8 w-8 text-blue-600"})}),a.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Powerful Search"}),a.jsx("p",{className:"text-gray-600",children:"Find any document instantly with our advanced full-text search across titles, content, and metadata."})]}),a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"bg-gradient-to-r from-purple-100 to-purple-200 p-4 rounded-2xl w-16 h-16 mx-auto mb-6 flex items-center justify-center",children:a.jsx(Er,{className:"h-8 w-8 text-purple-600"})}),a.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Role-Based Access"}),a.jsx("p",{className:"text-gray-600",children:"Secure permissions system with User, InfoWriter, and Admin roles to control access and editing rights."})]}),a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"bg-gradient-to-r from-green-100 to-green-200 p-4 rounded-2xl w-16 h-16 mx-auto mb-6 flex items-center justify-center",children:a.jsx(ql,{className:"h-8 w-8 text-green-600"})}),a.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Real-time Updates"}),a.jsx("p",{className:"text-gray-600",children:"Stay current with live updates, version tracking, and instant notifications when content changes."})]})]})]})}),a.jsx("section",{id:"about",className:"py-16 px-4 sm:px-6 lg:px-8",children:a.jsxs("div",{className:"max-w-4xl mx-auto text-center",children:[a.jsx("h2",{className:"text-3xl font-bold text-gray-900 mb-6",children:"About InfoNest"}),a.jsx("p",{className:"text-lg text-gray-600 leading-relaxed mb-8",children:"InfoNest is a comprehensive documentation platform designed to centralize your organization's knowledge base. From SOPs and guides to FAQs and technical documentation, InfoNest provides a secure, searchable, and organized environment for all your important information."}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8 text-center",children:[a.jsxs("div",{children:[a.jsxs("div",{className:"text-3xl font-bold text-blue-600 mb-2",children:[n.articles.length,"+"]}),a.jsx("div",{className:"text-gray-600",children:"Documents Available"})]}),a.jsxs("div",{children:[a.jsxs("div",{className:"text-3xl font-bold text-purple-600 mb-2",children:[n.categories.length,"+"]}),a.jsx("div",{className:"text-gray-600",children:"Categories"})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-3xl font-bold text-green-600 mb-2",children:"24/7"}),a.jsx("div",{className:"text-gray-600",children:"Access Available"})]})]})]})}),a.jsx("footer",{className:"bg-gray-900 text-white py-12 px-4 sm:px-6 lg:px-8",children:a.jsxs("div",{className:"max-w-7xl mx-auto",children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-8",children:[a.jsxs("div",{className:"col-span-1 md:col-span-2",children:[a.jsx("div",{className:"flex items-center space-x-3 mb-4",children:a.jsxs("div",{children:[a.jsx("h3",{className:"text-xl font-bold",children:"InfoNest"}),a.jsx("p",{className:"text-gray-400 text-sm",children:"Where Documentation Meets Efficiency"})]})}),a.jsx("p",{className:"text-gray-400 max-w-md",children:"Streamline your organization's knowledge management with our secure, searchable documentation platform."})]}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-semibold mb-4",children:"Quick Links"}),a.jsxs("ul",{className:"space-y-2 text-gray-400",children:[a.jsx("li",{children:a.jsx("a",{href:"#features",className:"hover:text-white transition-colors",children:"Features"})}),a.jsx("li",{children:a.jsx("a",{href:"#categories",className:"hover:text-white transition-colors",children:"Categories"})}),a.jsx("li",{children:a.jsx("a",{href:"#about",className:"hover:text-white transition-colors",children:"About"})}),a.jsx("li",{children:a.jsx(le,{to:"/auth",className:"hover:text-white transition-colors",children:"Login"})})]})]}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-semibold mb-4",children:"Legal"}),a.jsxs("ul",{className:"space-y-2 text-gray-400",children:[a.jsx("li",{children:a.jsx("a",{href:"#",className:"hover:text-white transition-colors",children:"Privacy Policy"})}),a.jsx("li",{children:a.jsx("a",{href:"#",className:"hover:text-white transition-colors",children:"Terms of Service"})}),a.jsx("li",{children:a.jsx("a",{href:"#",className:"hover:text-white transition-colors",children:"Contact"})})]})]})]}),a.jsx("div",{className:"border-t border-gray-800 mt-8 pt-8 text-center text-gray-400",children:a.jsx("p",{children:"© 2024 InfoNest. All rights reserved."})})]})})]}):a.jsx("div",{className:"min-h-screen flex items-center justify-center",style:{backgroundColor:"#EFEDFA"},children:a.jsxs("div",{className:"text-center",children:[a.jsx(qe,{className:"h-12 w-12 text-blue-600 animate-spin mx-auto mb-4"}),a.jsx("p",{className:"text-gray-600",children:"Loading content..."})]})})},Pb=()=>{const{userProfile:r}=ve(),[e,t]=b.useState(),[s,n]=b.useState(!0),[i,o]=b.useState([]),[l,c]=b.useState(!1),[d,u]=b.useState("");return b.useEffect(()=>{if(!r)return;const h=xe(pe(X,"articles"),Oe("status","==","published")),f=Ee(h,p=>{const m=[],g=new Set,y=new Map;p.forEach(S=>{var j,w,v,D,C;const k=S.data(),R={id:S.id,...k,createdAt:((j=k.createdAt)==null?void 0:j.toDate())||new Date,updatedAt:(w=k.updatedAt)==null?void 0:w.toDate(),publishedAt:(v=k.publishedAt)==null?void 0:v.toDate()};m.push(R),(D=R.categories)==null||D.forEach(P=>g.add(P)),(C=R.tags)==null||C.forEach(P=>{y.set(P,(y.get(P)||0)+1)})}),m.sort((S,k)=>k.createdAt.getTime()-S.createdAt.getTime());const x=Array.from(g).sort(),N=m.slice(0,6),A=Array.from(y.entries()).map(([S,k])=>({tag:S,count:k})).sort((S,k)=>k.count-S.count).slice(0,10);t({publishedArticles:m,availableCategories:x,recentArticles:N,topTags:A}),n(!1)},p=>{if(p.code==="permission-denied"){console.warn("Permission denied for dashboard articles subscription - user may not be authenticated"),n(!1);return}console.error("Error in dashboard articles subscription:",p),n(!1)});return()=>f()},[r]),b.useEffect(()=>{if(!e)return;let h=e.publishedArticles;if(d.trim()){const f=d.toLowerCase();h=h.filter(p=>p.title.toLowerCase().includes(f)||p.content.toLowerCase().includes(f)||p.excerpt.toLowerCase().includes(f))}o(h.slice(0,6))},[e,d]),s?a.jsx("div",{className:"flex items-center justify-center min-h-64",children:a.jsx("div",{className:"animate-spin h-8 w-8 border-2 border-blue-500 border-t-transparent rounded-full"})}):e?a.jsxs("div",{className:"space-y-8",children:[a.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl p-6 border border-gray-200",children:a.jsx("div",{className:"space-y-4",children:a.jsx(vs,{variant:"default",placeholder:"Search articles...",onResultClick:()=>{}})})}),a.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl p-6 border border-gray-200",children:a.jsxs("div",{className:"space-y-4",children:[a.jsxs("button",{onClick:()=>c(!l),className:"flex items-center justify-between w-full p-4 bg-gradient-to-r from-blue-50 to-purple-50 rounded-xl hover:from-blue-100 hover:to-purple-100 transition-all duration-200",children:[a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-blue-700 p-2 rounded-lg",children:a.jsx(_e,{className:"h-5 w-5 text-white"})}),a.jsxs("div",{className:"text-left",children:[a.jsx("h3",{className:"font-medium text-gray-900",children:"Quick Actions"}),a.jsx("p",{className:"text-sm text-gray-600",children:"Access your saved content and features"})]})]}),a.jsx(Io,{className:`h-5 w-5 text-gray-500 transition-transform duration-200 ${l?"rotate-180":""}`})]}),a.jsx("div",{className:`overflow-hidden transition-all duration-300 ease-in-out ${l?"max-h-96 opacity-100":"max-h-0 opacity-0"}`,children:a.jsx("div",{className:"bg-gray-50 rounded-xl border border-gray-200",children:a.jsxs("div",{className:"p-3 space-y-2",children:[a.jsxs(le,{to:"/saved-articles",className:"flex items-center space-x-3 p-3 hover:bg-white rounded-lg transition-colors duration-150 group",children:[a.jsx("div",{className:"bg-blue-100 p-2 rounded-lg group-hover:bg-blue-200 transition-colors",children:a.jsx(Z0,{className:"h-4 w-4 text-blue-600"})}),a.jsxs("div",{children:[a.jsx("span",{className:"font-medium text-gray-900 group-hover:text-blue-700",children:"Saved Articles"}),a.jsx("p",{className:"text-xs text-gray-600",children:"View your bookmarked content"})]})]}),a.jsxs(le,{to:"/writer-request",className:"flex items-center space-x-3 p-3 hover:bg-white rounded-lg transition-colors duration-150 group",children:[a.jsx("div",{className:"bg-purple-100 p-2 rounded-lg group-hover:bg-purple-200 transition-colors",children:a.jsx(Wl,{className:"h-4 w-4 text-purple-600"})}),a.jsxs("div",{children:[a.jsx("span",{className:"font-medium text-gray-900 group-hover:text-purple-700",children:"Apply for InfoWriter"}),a.jsx("p",{className:"text-xs text-gray-600",children:"Request content creation access"})]})]})]})})})]})}),a.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl p-6 border border-gray-200",children:i.length===0?a.jsxs("div",{className:"text-center py-12",children:[a.jsx(zt,{className:"h-12 w-12 text-gray-300 mx-auto mb-4"}),a.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No articles yet"}),a.jsx("p",{className:"text-gray-600",children:"Be the first to contribute to the knowledge base!"})]}):a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:i.map(h=>a.jsx(Ns,{article:h,variant:"default",showActions:!0,title:h.title,author:h.author,date:h.date},h.id))})})]}):a.jsxs("div",{className:"text-center py-12",children:[a.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Unable to load dashboard"}),a.jsx("p",{className:"text-gray-600",children:"Please try refreshing the page."})]})},Lb=()=>{const{userProfile:r}=ve(),[e,t]=b.useState(null),[s,n]=b.useState(!0),[i,o]=b.useState(!1),[l,c]=b.useState("");return b.useEffect(()=>{const d=u=>{console.log("AdminDashboard: Writer request processed",u.detail)};return window.addEventListener("writerRequestProcessed",d),()=>{window.removeEventListener("writerRequestProcessed",d)}},[]),b.useEffect(()=>{if(!r)return;const d=xe(pe(X,"articles"),Oe("status","==","published")),u=Ee(d,h=>{const f=[],p=new Set,m=new Map;h.forEach(A=>{var R,j,w;const S=A.data(),k={id:A.id,...S,createdAt:((R=S.createdAt)==null?void 0:R.toDate())||new Date,updatedAt:(j=S.updatedAt)==null?void 0:j.toDate(),publishedAt:(w=S.publishedAt)==null?void 0:w.toDate()};f.push(k),S.category&&p.add(S.category),S.tags&&S.tags.forEach(v=>{m.set(v,(m.get(v)||0)+1)})}),f.sort((A,S)=>S.createdAt.getTime()-A.createdAt.getTime());const g=f.slice(0,6),y=Array.from(m.entries()).map(([A,S])=>({tag:A,count:S})).sort((A,S)=>S.count-A.count).slice(0,10),x=xe(pe(X,"users")),N=Ee(x,A=>{let S=0,k=0,R=0,j=0;A.forEach(D=>{S++;const C=D.data();C.requestedWriterAccess&&C.role==="user"&&k++,C.role==="infowriter"&&R++,C.previousRoles&&C.previousRoles.includes(C.uid||D.id)&&C.role!=="infowriter"&&C.privilegesRemovedAt&&j++});const w=xe(pe(X,"writerRequests"),Oe("status","==","pending")),v=Ee(w,D=>{const C=D.size,P=k+C;t({publishedArticles:f,totalUsers:S,pendingWriterRequests:P,activeWriters:R,removedWriters:j,totalArticles:f.length,recentArticles:g,availableCategories:Array.from(p),topTags:y,systemStats:{totalArticles:f.length,totalCategories:p.size,totalTags:m.size}}),n(!1)});return()=>v()});return()=>N()});return()=>u()},[r]),s?a.jsx("div",{className:"flex items-center justify-center min-h-64",children:a.jsx("div",{className:"animate-spin h-8 w-8 border-2 border-blue-500 border-t-transparent rounded-full"})}):e?a.jsxs("div",{className:"space-y-8",children:[a.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl p-6 border border-gray-200",children:a.jsx("div",{className:"space-y-4",children:a.jsx(vs,{variant:"default",placeholder:"Search articles...",onResultClick:()=>{}})})}),a.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl p-6 border border-gray-200",children:a.jsxs("div",{className:"space-y-4",children:[a.jsxs("button",{onClick:()=>o(!i),className:"flex items-center justify-between w-full p-4 bg-gradient-to-r from-blue-50 to-purple-50 rounded-xl hover:from-blue-100 hover:to-purple-100 transition-all duration-200",children:[a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-blue-700 p-2 rounded-lg",children:a.jsx(E0,{className:"h-5 w-5 text-white"})}),a.jsxs("div",{className:"text-left",children:[a.jsx("h3",{className:"font-medium text-gray-900",children:"Quick Actions"}),a.jsx("p",{className:"text-sm text-gray-600",children:"Manage platform and user administration"})]})]}),a.jsx(Io,{className:`h-5 w-5 text-gray-500 transition-transform duration-200 ${i?"rotate-180":""}`})]}),a.jsx("div",{className:`overflow-hidden transition-all duration-300 ease-in-out ${i?"max-h-96 opacity-100":"max-h-0 opacity-0"}`,children:a.jsxs("div",{className:"space-y-3 pt-2",children:[a.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-blue-50 rounded-lg border border-blue-100",children:[a.jsx("div",{className:"bg-blue-100 p-2 rounded-lg",children:a.jsx(zt,{className:"h-4 w-4 text-blue-600"})}),a.jsxs("div",{className:"flex-1",children:[a.jsx("p",{className:"font-medium text-gray-900",children:"Total Articles"}),a.jsx("p",{className:"text-sm text-gray-600",children:"Published articles on the platform"})]}),a.jsx("span",{className:"bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-lg font-bold",children:(e==null?void 0:e.systemStats.totalArticles)||0})]}),a.jsxs(le,{to:"/admin/writer-requests",className:"flex items-center space-x-3 p-3 hover:bg-white rounded-lg transition-colors duration-150 group",children:[a.jsx("div",{className:"bg-orange-100 p-2 rounded-lg group-hover:bg-orange-200 transition-colors",children:a.jsx(Wl,{className:"h-4 w-4 text-orange-600"})}),a.jsxs("div",{className:"flex-1",children:[a.jsx("p",{className:"font-medium text-gray-900",children:"InfoWriter Requests"}),a.jsx("p",{className:"text-sm text-gray-600",children:"Review and approve writer applications"})]}),a.jsx("span",{className:"bg-orange-100 text-orange-800 px-2 py-1 rounded-full text-sm font-medium",children:(e==null?void 0:e.pendingWriterRequests)||0})]}),a.jsxs(le,{to:"/admin/active-writers",className:"flex items-center space-x-3 p-3 hover:bg-white rounded-lg transition-colors duration-150 group",children:[a.jsx("div",{className:"bg-green-100 p-2 rounded-lg group-hover:bg-green-200 transition-colors",children:a.jsx(Ha,{className:"h-4 w-4 text-green-600"})}),a.jsxs("div",{className:"flex-1",children:[a.jsx("p",{className:"font-medium text-gray-900",children:"Active Writers"}),a.jsx("p",{className:"text-sm text-gray-600",children:"Manage current InfoWriter privileges"})]}),a.jsx("span",{className:"bg-green-100 text-green-800 px-2 py-1 rounded-full text-sm font-medium",children:(e==null?void 0:e.activeWriters)||0})]}),a.jsxs(le,{to:"/admin/removed-writers",className:"flex items-center space-x-3 p-3 hover:bg-white rounded-lg transition-colors duration-150 group",children:[a.jsx("div",{className:"bg-red-100 p-2 rounded-lg group-hover:bg-red-200 transition-colors",children:a.jsx(Va,{className:"h-4 w-4 text-red-600"})}),a.jsxs("div",{className:"flex-1",children:[a.jsx("p",{className:"font-medium text-gray-900",children:"Removed Writers"}),a.jsx("p",{className:"text-sm text-gray-600",children:"View and restore writer privileges"})]}),a.jsx("span",{className:"bg-red-100 text-red-800 px-2 py-1 rounded-full text-sm font-medium",children:(e==null?void 0:e.removedWriters)||0})]}),a.jsxs(le,{to:"/my-articles",className:"flex items-center space-x-3 p-3 hover:bg-white rounded-lg transition-colors duration-150 group",children:[a.jsx("div",{className:"bg-purple-100 p-2 rounded-lg group-hover:bg-purple-200 transition-colors",children:a.jsx(Hl,{className:"h-4 w-4 text-purple-600"})}),a.jsxs("div",{children:[a.jsx("p",{className:"font-medium text-gray-900",children:"My Articles"}),a.jsx("p",{className:"text-sm text-gray-600",children:"Create and manage your own articles"})]})]}),a.jsxs(le,{to:"/my-articles?status=unpublished",className:"flex items-center space-x-3 p-3 hover:bg-white rounded-lg transition-colors duration-150 group",children:[a.jsx("div",{className:"bg-orange-100 p-2 rounded-lg group-hover:bg-orange-200 transition-colors",children:a.jsx(zs,{className:"h-4 w-4 text-orange-600"})}),a.jsxs("div",{children:[a.jsx("p",{className:"font-medium text-gray-900",children:"Unpublished Articles"}),a.jsx("p",{className:"text-sm text-gray-600",children:"View and manage unpublished content"})]})]})]})})]})}),a.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl p-6 border border-gray-200",children:!e.publishedArticles||e.publishedArticles.length===0?a.jsxs("div",{className:"text-center py-12",children:[a.jsx(zt,{className:"h-12 w-12 text-gray-300 mx-auto mb-4"}),a.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No articles yet"}),a.jsx("p",{className:"text-gray-600",children:"Articles will appear here once published."})]}):a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:e.publishedArticles.sort((d,u)=>(u.views||0)-(d.views||0)).slice(0,6).map(d=>a.jsx(Ns,{article:d,variant:"compact",showActions:!0},d.id))})})]}):a.jsxs("div",{className:"text-center py-12",children:[a.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Unable to load admin dashboard"}),a.jsx("p",{className:"text-gray-600",children:"Please try refreshing the page."})]})},$b=()=>{const{userProfile:r,isAdmin:e,isInfoWriter:t,isUser:s,loading:n}=ve(),i=Tt();b.useEffect(()=>{r&&t&&!e&&i("/my-articles",{replace:!0})},[r,t,e,i]);const o=b.useMemo(()=>r?e?Lb:s?Pb:null:null,[r,e,s]);return n&&!r?a.jsx("div",{className:"flex items-center justify-center min-h-64",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"animate-spin h-8 w-8 border-2 border-blue-500 border-t-transparent rounded-full mx-auto mb-4"}),a.jsx("p",{className:"text-gray-600",children:"Loading your dashboard..."})]})}):r?o?a.jsx(o,{}):a.jsxs("div",{className:"text-center py-12",children:[a.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Unknown Role"}),a.jsx("p",{className:"text-gray-600",children:"Your account role is not recognized. Please contact support."})]}):a.jsxs("div",{className:"text-center py-12",children:[a.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Access Denied"}),a.jsx("p",{className:"text-gray-600",children:"Please log in to access the dashboard."})]})},_b=({onRecover:r,onDismiss:e,currentArticleId:t})=>{const[s,n]=b.useState([]),[i,o]=b.useState(!1);b.useEffect(()=>{const u=()=>{try{const h=[];for(let m=0;m<localStorage.length;m++){const g=localStorage.key(m);if(g!=null&&g.startsWith("autosave_draft_")){const y=localStorage.getItem(g);if(y)try{const x=JSON.parse(y);x.lastModified&&x.title&&x.content&&h.push({...x,lastModified:new Date(x.lastModified),id:g.replace("autosave_draft_","")})}catch(x){console.error("Error parsing draft:",x)}}}const f=new Date(Date.now()-7*24*60*60*1e3),p=h.filter(m=>{const g=!t||m.id!==t,y=m.lastModified>f,x=m.content.trim().length>50;return g&&y&&x});p.sort((m,g)=>g.lastModified.getTime()-m.lastModified.getTime()),n(p.slice(0,3)),o(p.length>0)}catch(h){console.error("Error checking for drafts:",h)}};return u(),window.addEventListener("storage",u),()=>{window.removeEventListener("storage",u)}},[t]);const l=u=>{r(u),localStorage.removeItem(`autosave_draft_${u.id}`),o(!1)},c=()=>{o(!1),e()},d=()=>{s.forEach(u=>{localStorage.removeItem(`autosave_draft_${u.id}`)}),o(!1),e()};return!i||s.length===0?null:a.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center p-4 z-50",children:a.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[80vh] overflow-hidden",children:[a.jsx("div",{className:"bg-gradient-to-r from-amber-500 to-orange-500 px-6 py-4",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx("div",{className:"bg-white/20 p-2 rounded-lg",children:a.jsx(Ci,{className:"h-5 w-5 text-white"})}),a.jsxs("div",{children:[a.jsx("h2",{className:"text-lg font-semibold text-white",children:"Unsaved Drafts Found"}),a.jsxs("p",{className:"text-amber-100 text-sm",children:["We found ",s.length," unsaved draft",s.length!==1?"s":""," from previous sessions"]})]})]}),a.jsx("button",{onClick:c,className:"text-white/80 hover:text-white p-1 rounded-lg hover:bg-white/10 transition-colors",children:a.jsx(et,{className:"h-5 w-5"})})]})}),a.jsx("div",{className:"p-6 max-h-96 overflow-y-auto",children:a.jsx("div",{className:"space-y-4",children:s.map((u,h)=>a.jsxs("div",{className:"border border-gray-200 rounded-xl p-4 hover:border-amber-300 transition-colors",children:[a.jsxs("div",{className:"flex items-start justify-between mb-3",children:[a.jsxs("div",{className:"flex-1",children:[a.jsx("h3",{className:"font-medium text-gray-900 line-clamp-1",children:u.title||"Untitled Draft"}),a.jsxs("div",{className:"flex items-center space-x-4 mt-1 text-sm text-gray-500",children:[a.jsxs("div",{className:"flex items-center space-x-1",children:[a.jsx(jt,{className:"h-3 w-3"}),a.jsx("span",{children:Ht(u.lastModified,{addSuffix:!0})})]}),a.jsx("span",{children:"•"}),a.jsx("span",{children:u.deviceInfo||"Unknown device"})]})]}),a.jsxs("button",{onClick:()=>l(u),className:"flex items-center space-x-2 bg-amber-600 text-white px-4 py-2 rounded-lg hover:bg-amber-700 transition-colors",children:[a.jsx(Lo,{className:"h-4 w-4"}),a.jsx("span",{children:"Recover"})]})]}),a.jsx("div",{className:"bg-gray-50 rounded-lg p-3",children:a.jsxs("p",{className:"text-sm text-gray-600 line-clamp-3",children:[u.content.replace(/<[^>]*>/g,"").substring(0,200),"..."]})})]},u.id))})}),a.jsxs("div",{className:"bg-gray-50 px-6 py-4 flex items-center justify-between",children:[a.jsx("button",{onClick:d,className:"text-sm text-gray-600 hover:text-gray-800 underline",children:"Clear all drafts"}),a.jsx("div",{className:"flex items-center space-x-3",children:a.jsx("button",{onClick:c,className:"px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors",children:"Continue without recovering"})})]})]})})},Jr=class Jr{constructor(){Me(this,"STORAGE_PREFIX","autosave_draft_");Me(this,"MAX_DRAFTS",10);Me(this,"CLEANUP_INTERVAL",24*60*60*1e3);this.setupPeriodicCleanup()}static getInstance(){return Jr.instance||(Jr.instance=new Jr),Jr.instance}saveDraft(e,t){try{const s=e||`new_${Date.now()}`,n=`${this.STORAGE_PREFIX}${s}`,i={title:t.title||"",content:t.content||"",excerpt:t.excerpt,categories:t.categories||[],tags:t.tags||[],coverImage:t.coverImage,lastModified:new Date,deviceInfo:this.getDeviceInfo(),userAgent:navigator.userAgent,articleId:e||void 0,...t};localStorage.setItem(n,JSON.stringify(i)),this.cleanupOldDrafts()}catch(s){console.error("Failed to save draft:",s),this.cleanupOldDrafts();try{const n=`${this.STORAGE_PREFIX}${e||`new_${Date.now()}`}`;localStorage.setItem(n,JSON.stringify(t))}catch(n){console.error("Failed to save draft after cleanup:",n)}}}loadDraft(e){try{const t=`${this.STORAGE_PREFIX}${e}`,s=localStorage.getItem(t);if(s){const n=JSON.parse(s);return{...n,lastModified:new Date(n.lastModified)}}}catch(t){console.error("Failed to load draft:",t)}return null}getAllDrafts(){const e=[];try{for(let t=0;t<localStorage.length;t++){const s=localStorage.key(t);if(s!=null&&s.startsWith(this.STORAGE_PREFIX)){const n=localStorage.getItem(s);if(n)try{const i=JSON.parse(n);e.push({...i,id:s.replace(this.STORAGE_PREFIX,""),lastModified:new Date(i.lastModified)})}catch(i){console.error("Failed to parse draft:",i),localStorage.removeItem(s)}}}}catch(t){console.error("Failed to get all drafts:",t)}return e.sort((t,s)=>s.lastModified.getTime()-t.lastModified.getTime())}deleteDraft(e){try{const t=`${this.STORAGE_PREFIX}${e}`;localStorage.removeItem(t)}catch(t){console.error("Failed to delete draft:",t)}}clearAllDrafts(){try{const e=[];for(let t=0;t<localStorage.length;t++){const s=localStorage.key(t);s!=null&&s.startsWith(this.STORAGE_PREFIX)&&e.push(s)}e.forEach(t=>localStorage.removeItem(t))}catch(e){console.error("Failed to clear all drafts:",e)}}cleanupOldDrafts(){try{const e=this.getAllDrafts(),t=new Date(Date.now()-7*24*60*60*1e3);e.forEach(n=>{n.lastModified<t&&this.deleteDraft(n.id)});const s=e.filter(n=>n.lastModified>=t);s.length>this.MAX_DRAFTS&&s.slice(this.MAX_DRAFTS).forEach(i=>this.deleteDraft(i.id))}catch(e){console.error("Failed to cleanup old drafts:",e)}}setupPeriodicCleanup(){setInterval(()=>{this.cleanupOldDrafts()},this.CLEANUP_INTERVAL)}getDeviceInfo(){const e=navigator.platform||"Unknown",t=/Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);return`${this.getBrowserName()} on ${e}${t?" (Mobile)":""}`}getBrowserName(){const e=navigator.userAgent;return e.includes("Chrome")?"Chrome":e.includes("Firefox")?"Firefox":e.includes("Safari")?"Safari":e.includes("Edge")?"Edge":e.includes("Opera")?"Opera":"Unknown Browser"}hasDraft(e){const t=`${this.STORAGE_PREFIX}${e}`;return localStorage.getItem(t)!==null}getStorageInfo(){try{let e=0;for(let n=0;n<localStorage.length;n++){const i=localStorage.key(n);if(i!=null&&i.startsWith(this.STORAGE_PREFIX)){const o=localStorage.getItem(i);o&&(e+=i.length+o.length)}}const t=5*1024*1024,s=e/t*100;return{used:e,available:t-e,percentage:Math.min(s,100)}}catch(e){return console.error("Failed to get storage info:",e),{used:0,available:0,percentage:0}}}};Me(Jr,"instance");let rl=Jr;const ca=rl.getInstance();function Xe(r){this.content=r}Xe.prototype={constructor:Xe,find:function(r){for(var e=0;e<this.content.length;e+=2)if(this.content[e]===r)return e;return-1},get:function(r){var e=this.find(r);return e==-1?void 0:this.content[e+1]},update:function(r,e,t){var s=t&&t!=r?this.remove(t):this,n=s.find(r),i=s.content.slice();return n==-1?i.push(t||r,e):(i[n+1]=e,t&&(i[n]=t)),new Xe(i)},remove:function(r){var e=this.find(r);if(e==-1)return this;var t=this.content.slice();return t.splice(e,2),new Xe(t)},addToStart:function(r,e){return new Xe([r,e].concat(this.remove(r).content))},addToEnd:function(r,e){var t=this.remove(r).content.slice();return t.push(r,e),new Xe(t)},addBefore:function(r,e,t){var s=this.remove(e),n=s.content.slice(),i=s.find(r);return n.splice(i==-1?n.length:i,0,e,t),new Xe(n)},forEach:function(r){for(var e=0;e<this.content.length;e+=2)r(this.content[e],this.content[e+1])},prepend:function(r){return r=Xe.from(r),r.size?new Xe(r.content.concat(this.subtract(r).content)):this},append:function(r){return r=Xe.from(r),r.size?new Xe(this.subtract(r).content.concat(r.content)):this},subtract:function(r){var e=this;r=Xe.from(r);for(var t=0;t<r.content.length;t+=2)e=e.remove(r.content[t]);return e},toObject:function(){var r={};return this.forEach(function(e,t){r[e]=t}),r},get size(){return this.content.length>>1}};Xe.from=function(r){if(r instanceof Xe)return r;var e=[];if(r)for(var t in r)e.push(t,r[t]);return new Xe(e)};function df(r,e,t){for(let s=0;;s++){if(s==r.childCount||s==e.childCount)return r.childCount==e.childCount?null:t;let n=r.child(s),i=e.child(s);if(n==i){t+=n.nodeSize;continue}if(!n.sameMarkup(i))return t;if(n.isText&&n.text!=i.text){for(let o=0;n.text[o]==i.text[o];o++)t++;return t}if(n.content.size||i.content.size){let o=df(n.content,i.content,t+1);if(o!=null)return o}t+=n.nodeSize}}function uf(r,e,t,s){for(let n=r.childCount,i=e.childCount;;){if(n==0||i==0)return n==i?null:{a:t,b:s};let o=r.child(--n),l=e.child(--i),c=o.nodeSize;if(o==l){t-=c,s-=c;continue}if(!o.sameMarkup(l))return{a:t,b:s};if(o.isText&&o.text!=l.text){let d=0,u=Math.min(o.text.length,l.text.length);for(;d<u&&o.text[o.text.length-d-1]==l.text[l.text.length-d-1];)d++,t--,s--;return{a:t,b:s}}if(o.content.size||l.content.size){let d=uf(o.content,l.content,t-1,s-1);if(d)return d}t-=c,s-=c}}class z{constructor(e,t){if(this.content=e,this.size=t||0,t==null)for(let s=0;s<e.length;s++)this.size+=e[s].nodeSize}nodesBetween(e,t,s,n=0,i){for(let o=0,l=0;l<t;o++){let c=this.content[o],d=l+c.nodeSize;if(d>e&&s(c,n+l,i||null,o)!==!1&&c.content.size){let u=l+1;c.nodesBetween(Math.max(0,e-u),Math.min(c.content.size,t-u),s,n+u)}l=d}}descendants(e){this.nodesBetween(0,this.size,e)}textBetween(e,t,s,n){let i="",o=!0;return this.nodesBetween(e,t,(l,c)=>{let d=l.isText?l.text.slice(Math.max(e,c)-c,t-c):l.isLeaf?n?typeof n=="function"?n(l):n:l.type.spec.leafText?l.type.spec.leafText(l):"":"";l.isBlock&&(l.isLeaf&&d||l.isTextblock)&&s&&(o?o=!1:i+=s),i+=d},0),i}append(e){if(!e.size)return this;if(!this.size)return e;let t=this.lastChild,s=e.firstChild,n=this.content.slice(),i=0;for(t.isText&&t.sameMarkup(s)&&(n[n.length-1]=t.withText(t.text+s.text),i=1);i<e.content.length;i++)n.push(e.content[i]);return new z(n,this.size+e.size)}cut(e,t=this.size){if(e==0&&t==this.size)return this;let s=[],n=0;if(t>e)for(let i=0,o=0;o<t;i++){let l=this.content[i],c=o+l.nodeSize;c>e&&((o<e||c>t)&&(l.isText?l=l.cut(Math.max(0,e-o),Math.min(l.text.length,t-o)):l=l.cut(Math.max(0,e-o-1),Math.min(l.content.size,t-o-1))),s.push(l),n+=l.nodeSize),o=c}return new z(s,n)}cutByIndex(e,t){return e==t?z.empty:e==0&&t==this.content.length?this:new z(this.content.slice(e,t))}replaceChild(e,t){let s=this.content[e];if(s==t)return this;let n=this.content.slice(),i=this.size+t.nodeSize-s.nodeSize;return n[e]=t,new z(n,i)}addToStart(e){return new z([e].concat(this.content),this.size+e.nodeSize)}addToEnd(e){return new z(this.content.concat(e),this.size+e.nodeSize)}eq(e){if(this.content.length!=e.content.length)return!1;for(let t=0;t<this.content.length;t++)if(!this.content[t].eq(e.content[t]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(e){let t=this.content[e];if(!t)throw new RangeError("Index "+e+" out of range for "+this);return t}maybeChild(e){return this.content[e]||null}forEach(e){for(let t=0,s=0;t<this.content.length;t++){let n=this.content[t];e(n,s,t),s+=n.nodeSize}}findDiffStart(e,t=0){return df(this,e,t)}findDiffEnd(e,t=this.size,s=e.size){return uf(this,e,t,s)}findIndex(e,t=-1){if(e==0)return ei(0,e);if(e==this.size)return ei(this.content.length,e);if(e>this.size||e<0)throw new RangeError(`Position ${e} outside of fragment (${this})`);for(let s=0,n=0;;s++){let i=this.child(s),o=n+i.nodeSize;if(o>=e)return o==e||t>0?ei(s+1,o):ei(s,n);n=o}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map(e=>e.toJSON()):null}static fromJSON(e,t){if(!t)return z.empty;if(!Array.isArray(t))throw new RangeError("Invalid input for Fragment.fromJSON");return new z(t.map(e.nodeFromJSON))}static fromArray(e){if(!e.length)return z.empty;let t,s=0;for(let n=0;n<e.length;n++){let i=e[n];s+=i.nodeSize,n&&i.isText&&e[n-1].sameMarkup(i)?(t||(t=e.slice(0,n)),t[t.length-1]=i.withText(t[t.length-1].text+i.text)):t&&t.push(i)}return new z(t||e,s)}static from(e){if(!e)return z.empty;if(e instanceof z)return e;if(Array.isArray(e))return this.fromArray(e);if(e.attrs)return new z([e],e.nodeSize);throw new RangeError("Can not convert "+e+" to a Fragment"+(e.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}}z.empty=new z([],0);const da={index:0,offset:0};function ei(r,e){return da.index=r,da.offset=e,da}function Fi(r,e){if(r===e)return!0;if(!(r&&typeof r=="object")||!(e&&typeof e=="object"))return!1;let t=Array.isArray(r);if(Array.isArray(e)!=t)return!1;if(t){if(r.length!=e.length)return!1;for(let s=0;s<r.length;s++)if(!Fi(r[s],e[s]))return!1}else{for(let s in r)if(!(s in e)||!Fi(r[s],e[s]))return!1;for(let s in e)if(!(s in r))return!1}return!0}let Ae=class sl{constructor(e,t){this.type=e,this.attrs=t}addToSet(e){let t,s=!1;for(let n=0;n<e.length;n++){let i=e[n];if(this.eq(i))return e;if(this.type.excludes(i.type))t||(t=e.slice(0,n));else{if(i.type.excludes(this.type))return e;!s&&i.type.rank>this.type.rank&&(t||(t=e.slice(0,n)),t.push(this),s=!0),t&&t.push(i)}}return t||(t=e.slice()),s||t.push(this),t}removeFromSet(e){for(let t=0;t<e.length;t++)if(this.eq(e[t]))return e.slice(0,t).concat(e.slice(t+1));return e}isInSet(e){for(let t=0;t<e.length;t++)if(this.eq(e[t]))return!0;return!1}eq(e){return this==e||this.type==e.type&&Fi(this.attrs,e.attrs)}toJSON(){let e={type:this.type.name};for(let t in this.attrs){e.attrs=this.attrs;break}return e}static fromJSON(e,t){if(!t)throw new RangeError("Invalid input for Mark.fromJSON");let s=e.marks[t.type];if(!s)throw new RangeError(`There is no mark type ${t.type} in this schema`);let n=s.create(t.attrs);return s.checkAttrs(n.attrs),n}static sameSet(e,t){if(e==t)return!0;if(e.length!=t.length)return!1;for(let s=0;s<e.length;s++)if(!e[s].eq(t[s]))return!1;return!0}static setFrom(e){if(!e||Array.isArray(e)&&e.length==0)return sl.none;if(e instanceof sl)return[e];let t=e.slice();return t.sort((s,n)=>s.type.rank-n.type.rank),t}};Ae.none=[];class Bi extends Error{}class Q{constructor(e,t,s){this.content=e,this.openStart=t,this.openEnd=s}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(e,t){let s=ff(this.content,e+this.openStart,t);return s&&new Q(s,this.openStart,this.openEnd)}removeBetween(e,t){return new Q(hf(this.content,e+this.openStart,t+this.openStart),this.openStart,this.openEnd)}eq(e){return this.content.eq(e.content)&&this.openStart==e.openStart&&this.openEnd==e.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let e={content:this.content.toJSON()};return this.openStart>0&&(e.openStart=this.openStart),this.openEnd>0&&(e.openEnd=this.openEnd),e}static fromJSON(e,t){if(!t)return Q.empty;let s=t.openStart||0,n=t.openEnd||0;if(typeof s!="number"||typeof n!="number")throw new RangeError("Invalid input for Slice.fromJSON");return new Q(z.fromJSON(e,t.content),s,n)}static maxOpen(e,t=!0){let s=0,n=0;for(let i=e.firstChild;i&&!i.isLeaf&&(t||!i.type.spec.isolating);i=i.firstChild)s++;for(let i=e.lastChild;i&&!i.isLeaf&&(t||!i.type.spec.isolating);i=i.lastChild)n++;return new Q(e,s,n)}}Q.empty=new Q(z.empty,0,0);function hf(r,e,t){let{index:s,offset:n}=r.findIndex(e),i=r.maybeChild(s),{index:o,offset:l}=r.findIndex(t);if(n==e||i.isText){if(l!=t&&!r.child(o).isText)throw new RangeError("Removing non-flat range");return r.cut(0,e).append(r.cut(t))}if(s!=o)throw new RangeError("Removing non-flat range");return r.replaceChild(s,i.copy(hf(i.content,e-n-1,t-n-1)))}function ff(r,e,t,s){let{index:n,offset:i}=r.findIndex(e),o=r.maybeChild(n);if(i==e||o.isText)return r.cut(0,e).append(t).append(r.cut(e));let l=ff(o.content,e-i-1,t);return l&&r.replaceChild(n,o.copy(l))}function Fb(r,e,t){if(t.openStart>r.depth)throw new Bi("Inserted content deeper than insertion position");if(r.depth-t.openStart!=e.depth-t.openEnd)throw new Bi("Inconsistent open depths");return pf(r,e,t,0)}function pf(r,e,t,s){let n=r.index(s),i=r.node(s);if(n==e.index(s)&&s<r.depth-t.openStart){let o=pf(r,e,t,s+1);return i.copy(i.content.replaceChild(n,o))}else if(t.content.size)if(!t.openStart&&!t.openEnd&&r.depth==s&&e.depth==s){let o=r.parent,l=o.content;return ns(o,l.cut(0,r.parentOffset).append(t.content).append(l.cut(e.parentOffset)))}else{let{start:o,end:l}=Bb(t,r);return ns(i,gf(r,o,l,e,s))}else return ns(i,Ui(r,e,s))}function mf(r,e){if(!e.type.compatibleContent(r.type))throw new Bi("Cannot join "+e.type.name+" onto "+r.type.name)}function nl(r,e,t){let s=r.node(t);return mf(s,e.node(t)),s}function ss(r,e){let t=e.length-1;t>=0&&r.isText&&r.sameMarkup(e[t])?e[t]=r.withText(e[t].text+r.text):e.push(r)}function pn(r,e,t,s){let n=(e||r).node(t),i=0,o=e?e.index(t):n.childCount;r&&(i=r.index(t),r.depth>t?i++:r.textOffset&&(ss(r.nodeAfter,s),i++));for(let l=i;l<o;l++)ss(n.child(l),s);e&&e.depth==t&&e.textOffset&&ss(e.nodeBefore,s)}function ns(r,e){return r.type.checkContent(e),r.copy(e)}function gf(r,e,t,s,n){let i=r.depth>n&&nl(r,e,n+1),o=s.depth>n&&nl(t,s,n+1),l=[];return pn(null,r,n,l),i&&o&&e.index(n)==t.index(n)?(mf(i,o),ss(ns(i,gf(r,e,t,s,n+1)),l)):(i&&ss(ns(i,Ui(r,e,n+1)),l),pn(e,t,n,l),o&&ss(ns(o,Ui(t,s,n+1)),l)),pn(s,null,n,l),new z(l)}function Ui(r,e,t){let s=[];if(pn(null,r,t,s),r.depth>t){let n=nl(r,e,t+1);ss(ns(n,Ui(r,e,t+1)),s)}return pn(e,null,t,s),new z(s)}function Bb(r,e){let t=e.depth-r.openStart,n=e.node(t).copy(r.content);for(let i=t-1;i>=0;i--)n=e.node(i).copy(z.from(n));return{start:n.resolveNoCache(r.openStart+t),end:n.resolveNoCache(n.content.size-r.openEnd-t)}}class En{constructor(e,t,s){this.pos=e,this.path=t,this.parentOffset=s,this.depth=t.length/3-1}resolveDepth(e){return e==null?this.depth:e<0?this.depth+e:e}get parent(){return this.node(this.depth)}get doc(){return this.node(0)}node(e){return this.path[this.resolveDepth(e)*3]}index(e){return this.path[this.resolveDepth(e)*3+1]}indexAfter(e){return e=this.resolveDepth(e),this.index(e)+(e==this.depth&&!this.textOffset?0:1)}start(e){return e=this.resolveDepth(e),e==0?0:this.path[e*3-1]+1}end(e){return e=this.resolveDepth(e),this.start(e)+this.node(e).content.size}before(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position before the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]}after(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position after the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]+this.path[e*3].nodeSize}get textOffset(){return this.pos-this.path[this.path.length-1]}get nodeAfter(){let e=this.parent,t=this.index(this.depth);if(t==e.childCount)return null;let s=this.pos-this.path[this.path.length-1],n=e.child(t);return s?e.child(t).cut(s):n}get nodeBefore(){let e=this.index(this.depth),t=this.pos-this.path[this.path.length-1];return t?this.parent.child(e).cut(0,t):e==0?null:this.parent.child(e-1)}posAtIndex(e,t){t=this.resolveDepth(t);let s=this.path[t*3],n=t==0?0:this.path[t*3-1]+1;for(let i=0;i<e;i++)n+=s.child(i).nodeSize;return n}marks(){let e=this.parent,t=this.index();if(e.content.size==0)return Ae.none;if(this.textOffset)return e.child(t).marks;let s=e.maybeChild(t-1),n=e.maybeChild(t);if(!s){let l=s;s=n,n=l}let i=s.marks;for(var o=0;o<i.length;o++)i[o].type.spec.inclusive===!1&&(!n||!i[o].isInSet(n.marks))&&(i=i[o--].removeFromSet(i));return i}marksAcross(e){let t=this.parent.maybeChild(this.index());if(!t||!t.isInline)return null;let s=t.marks,n=e.parent.maybeChild(e.index());for(var i=0;i<s.length;i++)s[i].type.spec.inclusive===!1&&(!n||!s[i].isInSet(n.marks))&&(s=s[i--].removeFromSet(s));return s}sharedDepth(e){for(let t=this.depth;t>0;t--)if(this.start(t)<=e&&this.end(t)>=e)return t;return 0}blockRange(e=this,t){if(e.pos<this.pos)return e.blockRange(this);for(let s=this.depth-(this.parent.inlineContent||this.pos==e.pos?1:0);s>=0;s--)if(e.pos<=this.end(s)&&(!t||t(this.node(s))))return new zi(this,e,s);return null}sameParent(e){return this.pos-this.parentOffset==e.pos-e.parentOffset}max(e){return e.pos>this.pos?e:this}min(e){return e.pos<this.pos?e:this}toString(){let e="";for(let t=1;t<=this.depth;t++)e+=(e?"/":"")+this.node(t).type.name+"_"+this.index(t-1);return e+":"+this.parentOffset}static resolve(e,t){if(!(t>=0&&t<=e.content.size))throw new RangeError("Position "+t+" out of range");let s=[],n=0,i=t;for(let o=e;;){let{index:l,offset:c}=o.content.findIndex(i),d=i-c;if(s.push(o,l,n+c),!d||(o=o.child(l),o.isText))break;i=d-1,n+=c+1}return new En(t,s,i)}static resolveCached(e,t){let s=ld.get(e);if(s)for(let i=0;i<s.elts.length;i++){let o=s.elts[i];if(o.pos==t)return o}else ld.set(e,s=new Ub);let n=s.elts[s.i]=En.resolve(e,t);return s.i=(s.i+1)%zb,n}}class Ub{constructor(){this.elts=[],this.i=0}}const zb=12,ld=new WeakMap;class zi{constructor(e,t,s){this.$from=e,this.$to=t,this.depth=s}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}}const Wb=Object.create(null);let Ar=class il{constructor(e,t,s,n=Ae.none){this.type=e,this.attrs=t,this.marks=n,this.content=s||z.empty}get children(){return this.content.content}get nodeSize(){return this.isLeaf?1:2+this.content.size}get childCount(){return this.content.childCount}child(e){return this.content.child(e)}maybeChild(e){return this.content.maybeChild(e)}forEach(e){this.content.forEach(e)}nodesBetween(e,t,s,n=0){this.content.nodesBetween(e,t,s,n,this)}descendants(e){this.nodesBetween(0,this.content.size,e)}get textContent(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}textBetween(e,t,s,n){return this.content.textBetween(e,t,s,n)}get firstChild(){return this.content.firstChild}get lastChild(){return this.content.lastChild}eq(e){return this==e||this.sameMarkup(e)&&this.content.eq(e.content)}sameMarkup(e){return this.hasMarkup(e.type,e.attrs,e.marks)}hasMarkup(e,t,s){return this.type==e&&Fi(this.attrs,t||e.defaultAttrs||Wb)&&Ae.sameSet(this.marks,s||Ae.none)}copy(e=null){return e==this.content?this:new il(this.type,this.attrs,e,this.marks)}mark(e){return e==this.marks?this:new il(this.type,this.attrs,this.content,e)}cut(e,t=this.content.size){return e==0&&t==this.content.size?this:this.copy(this.content.cut(e,t))}slice(e,t=this.content.size,s=!1){if(e==t)return Q.empty;let n=this.resolve(e),i=this.resolve(t),o=s?0:n.sharedDepth(t),l=n.start(o),d=n.node(o).content.cut(n.pos-l,i.pos-l);return new Q(d,n.depth-o,i.depth-o)}replace(e,t,s){return Fb(this.resolve(e),this.resolve(t),s)}nodeAt(e){for(let t=this;;){let{index:s,offset:n}=t.content.findIndex(e);if(t=t.maybeChild(s),!t)return null;if(n==e||t.isText)return t;e-=n+1}}childAfter(e){let{index:t,offset:s}=this.content.findIndex(e);return{node:this.content.maybeChild(t),index:t,offset:s}}childBefore(e){if(e==0)return{node:null,index:0,offset:0};let{index:t,offset:s}=this.content.findIndex(e);if(s<e)return{node:this.content.child(t),index:t,offset:s};let n=this.content.child(t-1);return{node:n,index:t-1,offset:s-n.nodeSize}}resolve(e){return En.resolveCached(this,e)}resolveNoCache(e){return En.resolve(this,e)}rangeHasMark(e,t,s){let n=!1;return t>e&&this.nodesBetween(e,t,i=>(s.isInSet(i.marks)&&(n=!0),!n)),n}get isBlock(){return this.type.isBlock}get isTextblock(){return this.type.isTextblock}get inlineContent(){return this.type.inlineContent}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return this.type.isLeaf}get isAtom(){return this.type.isAtom}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);let e=this.type.name;return this.content.size&&(e+="("+this.content.toStringInner()+")"),xf(this.marks,e)}contentMatchAt(e){let t=this.type.contentMatch.matchFragment(this.content,0,e);if(!t)throw new Error("Called contentMatchAt on a node with invalid content");return t}canReplace(e,t,s=z.empty,n=0,i=s.childCount){let o=this.contentMatchAt(e).matchFragment(s,n,i),l=o&&o.matchFragment(this.content,t);if(!l||!l.validEnd)return!1;for(let c=n;c<i;c++)if(!this.type.allowsMarks(s.child(c).marks))return!1;return!0}canReplaceWith(e,t,s,n){if(n&&!this.type.allowsMarks(n))return!1;let i=this.contentMatchAt(e).matchType(s),o=i&&i.matchFragment(this.content,t);return o?o.validEnd:!1}canAppend(e){return e.content.size?this.canReplace(this.childCount,this.childCount,e.content):this.type.compatibleContent(e.type)}check(){this.type.checkContent(this.content),this.type.checkAttrs(this.attrs);let e=Ae.none;for(let t=0;t<this.marks.length;t++){let s=this.marks[t];s.type.checkAttrs(s.attrs),e=s.addToSet(e)}if(!Ae.sameSet(e,this.marks))throw new RangeError(`Invalid collection of marks for node ${this.type.name}: ${this.marks.map(t=>t.type.name)}`);this.content.forEach(t=>t.check())}toJSON(){let e={type:this.type.name};for(let t in this.attrs){e.attrs=this.attrs;break}return this.content.size&&(e.content=this.content.toJSON()),this.marks.length&&(e.marks=this.marks.map(t=>t.toJSON())),e}static fromJSON(e,t){if(!t)throw new RangeError("Invalid input for Node.fromJSON");let s;if(t.marks){if(!Array.isArray(t.marks))throw new RangeError("Invalid mark data for Node.fromJSON");s=t.marks.map(e.markFromJSON)}if(t.type=="text"){if(typeof t.text!="string")throw new RangeError("Invalid text node in JSON");return e.text(t.text,s)}let n=z.fromJSON(e,t.content),i=e.nodeType(t.type).create(t.attrs,n,s);return i.type.checkAttrs(i.attrs),i}};Ar.prototype.text=void 0;class Wi extends Ar{constructor(e,t,s,n){if(super(e,t,null,n),!s)throw new RangeError("Empty text nodes are not allowed");this.text=s}toString(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):xf(this.marks,JSON.stringify(this.text))}get textContent(){return this.text}textBetween(e,t){return this.text.slice(e,t)}get nodeSize(){return this.text.length}mark(e){return e==this.marks?this:new Wi(this.type,this.attrs,this.text,e)}withText(e){return e==this.text?this:new Wi(this.type,this.attrs,e,this.marks)}cut(e=0,t=this.text.length){return e==0&&t==this.text.length?this:this.withText(this.text.slice(e,t))}eq(e){return this.sameMarkup(e)&&this.text==e.text}toJSON(){let e=super.toJSON();return e.text=this.text,e}}function xf(r,e){for(let t=r.length-1;t>=0;t--)e=r[t].type.name+"("+e+")";return e}class ps{constructor(e){this.validEnd=e,this.next=[],this.wrapCache=[]}static parse(e,t){let s=new Hb(e,t);if(s.next==null)return ps.empty;let n=yf(s);s.next&&s.err("Unexpected trailing text");let i=Xb(Jb(n));return Qb(i,s),i}matchType(e){for(let t=0;t<this.next.length;t++)if(this.next[t].type==e)return this.next[t].next;return null}matchFragment(e,t=0,s=e.childCount){let n=this;for(let i=t;n&&i<s;i++)n=n.matchType(e.child(i).type);return n}get inlineContent(){return this.next.length!=0&&this.next[0].type.isInline}get defaultType(){for(let e=0;e<this.next.length;e++){let{type:t}=this.next[e];if(!(t.isText||t.hasRequiredAttrs()))return t}return null}compatible(e){for(let t=0;t<this.next.length;t++)for(let s=0;s<e.next.length;s++)if(this.next[t].type==e.next[s].type)return!0;return!1}fillBefore(e,t=!1,s=0){let n=[this];function i(o,l){let c=o.matchFragment(e,s);if(c&&(!t||c.validEnd))return z.from(l.map(d=>d.createAndFill()));for(let d=0;d<o.next.length;d++){let{type:u,next:h}=o.next[d];if(!(u.isText||u.hasRequiredAttrs())&&n.indexOf(h)==-1){n.push(h);let f=i(h,l.concat(u));if(f)return f}}return null}return i(this,[])}findWrapping(e){for(let s=0;s<this.wrapCache.length;s+=2)if(this.wrapCache[s]==e)return this.wrapCache[s+1];let t=this.computeWrapping(e);return this.wrapCache.push(e,t),t}computeWrapping(e){let t=Object.create(null),s=[{match:this,type:null,via:null}];for(;s.length;){let n=s.shift(),i=n.match;if(i.matchType(e)){let o=[];for(let l=n;l.type;l=l.via)o.push(l.type);return o.reverse()}for(let o=0;o<i.next.length;o++){let{type:l,next:c}=i.next[o];!l.isLeaf&&!l.hasRequiredAttrs()&&!(l.name in t)&&(!n.type||c.validEnd)&&(s.push({match:l.contentMatch,type:l,via:n}),t[l.name]=!0)}}return null}get edgeCount(){return this.next.length}edge(e){if(e>=this.next.length)throw new RangeError(`There's no ${e}th edge in this content match`);return this.next[e]}toString(){let e=[];function t(s){e.push(s);for(let n=0;n<s.next.length;n++)e.indexOf(s.next[n].next)==-1&&t(s.next[n].next)}return t(this),e.map((s,n)=>{let i=n+(s.validEnd?"*":" ")+" ";for(let o=0;o<s.next.length;o++)i+=(o?", ":"")+s.next[o].type.name+"->"+e.indexOf(s.next[o].next);return i}).join(`
`)}}ps.empty=new ps(!0);class Hb{constructor(e,t){this.string=e,this.nodeTypes=t,this.inline=null,this.pos=0,this.tokens=e.split(/\s*(?=\b|\W|$)/),this.tokens[this.tokens.length-1]==""&&this.tokens.pop(),this.tokens[0]==""&&this.tokens.shift()}get next(){return this.tokens[this.pos]}eat(e){return this.next==e&&(this.pos++||!0)}err(e){throw new SyntaxError(e+" (in content expression '"+this.string+"')")}}function yf(r){let e=[];do e.push(Vb(r));while(r.eat("|"));return e.length==1?e[0]:{type:"choice",exprs:e}}function Vb(r){let e=[];do e.push(qb(r));while(r.next&&r.next!=")"&&r.next!="|");return e.length==1?e[0]:{type:"seq",exprs:e}}function qb(r){let e=Yb(r);for(;;)if(r.eat("+"))e={type:"plus",expr:e};else if(r.eat("*"))e={type:"star",expr:e};else if(r.eat("?"))e={type:"opt",expr:e};else if(r.eat("{"))e=Kb(r,e);else break;return e}function cd(r){/\D/.test(r.next)&&r.err("Expected number, got '"+r.next+"'");let e=Number(r.next);return r.pos++,e}function Kb(r,e){let t=cd(r),s=t;return r.eat(",")&&(r.next!="}"?s=cd(r):s=-1),r.eat("}")||r.err("Unclosed braced range"),{type:"range",min:t,max:s,expr:e}}function Gb(r,e){let t=r.nodeTypes,s=t[e];if(s)return[s];let n=[];for(let i in t){let o=t[i];o.isInGroup(e)&&n.push(o)}return n.length==0&&r.err("No node type or group '"+e+"' found"),n}function Yb(r){if(r.eat("(")){let e=yf(r);return r.eat(")")||r.err("Missing closing paren"),e}else if(/\W/.test(r.next))r.err("Unexpected token '"+r.next+"'");else{let e=Gb(r,r.next).map(t=>(r.inline==null?r.inline=t.isInline:r.inline!=t.isInline&&r.err("Mixing inline and block content"),{type:"name",value:t}));return r.pos++,e.length==1?e[0]:{type:"choice",exprs:e}}}function Jb(r){let e=[[]];return n(i(r,0),t()),e;function t(){return e.push([])-1}function s(o,l,c){let d={term:c,to:l};return e[o].push(d),d}function n(o,l){o.forEach(c=>c.to=l)}function i(o,l){if(o.type=="choice")return o.exprs.reduce((c,d)=>c.concat(i(d,l)),[]);if(o.type=="seq")for(let c=0;;c++){let d=i(o.exprs[c],l);if(c==o.exprs.length-1)return d;n(d,l=t())}else if(o.type=="star"){let c=t();return s(l,c),n(i(o.expr,c),c),[s(c)]}else if(o.type=="plus"){let c=t();return n(i(o.expr,l),c),n(i(o.expr,c),c),[s(c)]}else{if(o.type=="opt")return[s(l)].concat(i(o.expr,l));if(o.type=="range"){let c=l;for(let d=0;d<o.min;d++){let u=t();n(i(o.expr,c),u),c=u}if(o.max==-1)n(i(o.expr,c),c);else for(let d=o.min;d<o.max;d++){let u=t();s(c,u),n(i(o.expr,c),u),c=u}return[s(c)]}else{if(o.type=="name")return[s(l,void 0,o.value)];throw new Error("Unknown expr type")}}}}function bf(r,e){return e-r}function dd(r,e){let t=[];return s(e),t.sort(bf);function s(n){let i=r[n];if(i.length==1&&!i[0].term)return s(i[0].to);t.push(n);for(let o=0;o<i.length;o++){let{term:l,to:c}=i[o];!l&&t.indexOf(c)==-1&&s(c)}}}function Xb(r){let e=Object.create(null);return t(dd(r,0));function t(s){let n=[];s.forEach(o=>{r[o].forEach(({term:l,to:c})=>{if(!l)return;let d;for(let u=0;u<n.length;u++)n[u][0]==l&&(d=n[u][1]);dd(r,c).forEach(u=>{d||n.push([l,d=[]]),d.indexOf(u)==-1&&d.push(u)})})});let i=e[s.join(",")]=new ps(s.indexOf(r.length-1)>-1);for(let o=0;o<n.length;o++){let l=n[o][1].sort(bf);i.next.push({type:n[o][0],next:e[l.join(",")]||t(l)})}return i}}function Qb(r,e){for(let t=0,s=[r];t<s.length;t++){let n=s[t],i=!n.validEnd,o=[];for(let l=0;l<n.next.length;l++){let{type:c,next:d}=n.next[l];o.push(c.name),i&&!(c.isText||c.hasRequiredAttrs())&&(i=!1),s.indexOf(d)==-1&&s.push(d)}i&&e.err("Only non-generatable nodes ("+o.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}function wf(r){let e=Object.create(null);for(let t in r){let s=r[t];if(!s.hasDefault)return null;e[t]=s.default}return e}function vf(r,e){let t=Object.create(null);for(let s in r){let n=e&&e[s];if(n===void 0){let i=r[s];if(i.hasDefault)n=i.default;else throw new RangeError("No value supplied for attribute "+s)}t[s]=n}return t}function Nf(r,e,t,s){for(let n in e)if(!(n in r))throw new RangeError(`Unsupported attribute ${n} for ${t} of type ${n}`);for(let n in r){let i=r[n];i.validate&&i.validate(e[n])}}function jf(r,e){let t=Object.create(null);if(e)for(let s in e)t[s]=new ew(r,s,e[s]);return t}let ud=class kf{constructor(e,t,s){this.name=e,this.schema=t,this.spec=s,this.markSet=null,this.groups=s.group?s.group.split(" "):[],this.attrs=jf(e,s.attrs),this.defaultAttrs=wf(this.attrs),this.contentMatch=null,this.inlineContent=null,this.isBlock=!(s.inline||e=="text"),this.isText=e=="text"}get isInline(){return!this.isBlock}get isTextblock(){return this.isBlock&&this.inlineContent}get isLeaf(){return this.contentMatch==ps.empty}get isAtom(){return this.isLeaf||!!this.spec.atom}isInGroup(e){return this.groups.indexOf(e)>-1}get whitespace(){return this.spec.whitespace||(this.spec.code?"pre":"normal")}hasRequiredAttrs(){for(let e in this.attrs)if(this.attrs[e].isRequired)return!0;return!1}compatibleContent(e){return this==e||this.contentMatch.compatible(e.contentMatch)}computeAttrs(e){return!e&&this.defaultAttrs?this.defaultAttrs:vf(this.attrs,e)}create(e=null,t,s){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new Ar(this,this.computeAttrs(e),z.from(t),Ae.setFrom(s))}createChecked(e=null,t,s){return t=z.from(t),this.checkContent(t),new Ar(this,this.computeAttrs(e),t,Ae.setFrom(s))}createAndFill(e=null,t,s){if(e=this.computeAttrs(e),t=z.from(t),t.size){let o=this.contentMatch.fillBefore(t);if(!o)return null;t=o.append(t)}let n=this.contentMatch.matchFragment(t),i=n&&n.fillBefore(z.empty,!0);return i?new Ar(this,e,t.append(i),Ae.setFrom(s)):null}validContent(e){let t=this.contentMatch.matchFragment(e);if(!t||!t.validEnd)return!1;for(let s=0;s<e.childCount;s++)if(!this.allowsMarks(e.child(s).marks))return!1;return!0}checkContent(e){if(!this.validContent(e))throw new RangeError(`Invalid content for node ${this.name}: ${e.toString().slice(0,50)}`)}checkAttrs(e){Nf(this.attrs,e,"node",this.name)}allowsMarkType(e){return this.markSet==null||this.markSet.indexOf(e)>-1}allowsMarks(e){if(this.markSet==null)return!0;for(let t=0;t<e.length;t++)if(!this.allowsMarkType(e[t].type))return!1;return!0}allowedMarks(e){if(this.markSet==null)return e;let t;for(let s=0;s<e.length;s++)this.allowsMarkType(e[s].type)?t&&t.push(e[s]):t||(t=e.slice(0,s));return t?t.length?t:Ae.none:e}static compile(e,t){let s=Object.create(null);e.forEach((i,o)=>s[i]=new kf(i,t,o));let n=t.spec.topNode||"doc";if(!s[n])throw new RangeError("Schema is missing its top node type ('"+n+"')");if(!s.text)throw new RangeError("Every schema needs a 'text' type");for(let i in s.text.attrs)throw new RangeError("The text node type should not have attributes");return s}};function Zb(r,e,t){let s=t.split("|");return n=>{let i=n===null?"null":typeof n;if(s.indexOf(i)<0)throw new RangeError(`Expected value of type ${s} for attribute ${e} on type ${r}, got ${i}`)}}class ew{constructor(e,t,s){this.hasDefault=Object.prototype.hasOwnProperty.call(s,"default"),this.default=s.default,this.validate=typeof s.validate=="string"?Zb(e,t,s.validate):s.validate}get isRequired(){return!this.hasDefault}}class Bo{constructor(e,t,s,n){this.name=e,this.rank=t,this.schema=s,this.spec=n,this.attrs=jf(e,n.attrs),this.excluded=null;let i=wf(this.attrs);this.instance=i?new Ae(this,i):null}create(e=null){return!e&&this.instance?this.instance:new Ae(this,vf(this.attrs,e))}static compile(e,t){let s=Object.create(null),n=0;return e.forEach((i,o)=>s[i]=new Bo(i,n++,t,o)),s}removeFromSet(e){for(var t=0;t<e.length;t++)e[t].type==this&&(e=e.slice(0,t).concat(e.slice(t+1)),t--);return e}isInSet(e){for(let t=0;t<e.length;t++)if(e[t].type==this)return e[t]}checkAttrs(e){Nf(this.attrs,e,"mark",this.name)}excludes(e){return this.excluded.indexOf(e)>-1}}class Sf{constructor(e){this.linebreakReplacement=null,this.cached=Object.create(null);let t=this.spec={};for(let n in e)t[n]=e[n];t.nodes=Xe.from(e.nodes),t.marks=Xe.from(e.marks||{}),this.nodes=ud.compile(this.spec.nodes,this),this.marks=Bo.compile(this.spec.marks,this);let s=Object.create(null);for(let n in this.nodes){if(n in this.marks)throw new RangeError(n+" can not be both a node and a mark");let i=this.nodes[n],o=i.spec.content||"",l=i.spec.marks;if(i.contentMatch=s[o]||(s[o]=ps.parse(o,this.nodes)),i.inlineContent=i.contentMatch.inlineContent,i.spec.linebreakReplacement){if(this.linebreakReplacement)throw new RangeError("Multiple linebreak nodes defined");if(!i.isInline||!i.isLeaf)throw new RangeError("Linebreak replacement nodes must be inline leaf nodes");this.linebreakReplacement=i}i.markSet=l=="_"?null:l?hd(this,l.split(" ")):l==""||!i.inlineContent?[]:null}for(let n in this.marks){let i=this.marks[n],o=i.spec.excludes;i.excluded=o==null?[i]:o==""?[]:hd(this,o.split(" "))}this.nodeFromJSON=this.nodeFromJSON.bind(this),this.markFromJSON=this.markFromJSON.bind(this),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached.wrappings=Object.create(null)}node(e,t=null,s,n){if(typeof e=="string")e=this.nodeType(e);else if(e instanceof ud){if(e.schema!=this)throw new RangeError("Node type from different schema used ("+e.name+")")}else throw new RangeError("Invalid node type: "+e);return e.createChecked(t,s,n)}text(e,t){let s=this.nodes.text;return new Wi(s,s.defaultAttrs,e,Ae.setFrom(t))}mark(e,t){return typeof e=="string"&&(e=this.marks[e]),e.create(t)}nodeFromJSON(e){return Ar.fromJSON(this,e)}markFromJSON(e){return Ae.fromJSON(this,e)}nodeType(e){let t=this.nodes[e];if(!t)throw new RangeError("Unknown node type: "+e);return t}}function hd(r,e){let t=[];for(let s=0;s<e.length;s++){let n=e[s],i=r.marks[n],o=i;if(i)t.push(i);else for(let l in r.marks){let c=r.marks[l];(n=="_"||c.spec.group&&c.spec.group.split(" ").indexOf(n)>-1)&&t.push(o=c)}if(!o)throw new SyntaxError("Unknown mark type: '"+e[s]+"'")}return t}function tw(r){return r.tag!=null}function rw(r){return r.style!=null}class Cr{constructor(e,t){this.schema=e,this.rules=t,this.tags=[],this.styles=[];let s=this.matchedStyles=[];t.forEach(n=>{if(tw(n))this.tags.push(n);else if(rw(n)){let i=/[^=]*/.exec(n.style)[0];s.indexOf(i)<0&&s.push(i),this.styles.push(n)}}),this.normalizeLists=!this.tags.some(n=>{if(!/^(ul|ol)\b/.test(n.tag)||!n.node)return!1;let i=e.nodes[n.node];return i.contentMatch.matchType(i)})}parse(e,t={}){let s=new pd(this,t,!1);return s.addAll(e,Ae.none,t.from,t.to),s.finish()}parseSlice(e,t={}){let s=new pd(this,t,!0);return s.addAll(e,Ae.none,t.from,t.to),Q.maxOpen(s.finish())}matchTag(e,t,s){for(let n=s?this.tags.indexOf(s)+1:0;n<this.tags.length;n++){let i=this.tags[n];if(iw(e,i.tag)&&(i.namespace===void 0||e.namespaceURI==i.namespace)&&(!i.context||t.matchesContext(i.context))){if(i.getAttrs){let o=i.getAttrs(e);if(o===!1)continue;i.attrs=o||void 0}return i}}}matchStyle(e,t,s,n){for(let i=n?this.styles.indexOf(n)+1:0;i<this.styles.length;i++){let o=this.styles[i],l=o.style;if(!(l.indexOf(e)!=0||o.context&&!s.matchesContext(o.context)||l.length>e.length&&(l.charCodeAt(e.length)!=61||l.slice(e.length+1)!=t))){if(o.getAttrs){let c=o.getAttrs(t);if(c===!1)continue;o.attrs=c||void 0}return o}}}static schemaRules(e){let t=[];function s(n){let i=n.priority==null?50:n.priority,o=0;for(;o<t.length;o++){let l=t[o];if((l.priority==null?50:l.priority)<i)break}t.splice(o,0,n)}for(let n in e.marks){let i=e.marks[n].spec.parseDOM;i&&i.forEach(o=>{s(o=md(o)),o.mark||o.ignore||o.clearMark||(o.mark=n)})}for(let n in e.nodes){let i=e.nodes[n].spec.parseDOM;i&&i.forEach(o=>{s(o=md(o)),o.node||o.ignore||o.mark||(o.node=n)})}return t}static fromSchema(e){return e.cached.domParser||(e.cached.domParser=new Cr(e,Cr.schemaRules(e)))}}const Ef={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},sw={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},Af={ol:!0,ul:!0},An=1,ol=2,mn=4;function fd(r,e,t){return e!=null?(e?An:0)|(e==="full"?ol:0):r&&r.whitespace=="pre"?An|ol:t&~mn}class ti{constructor(e,t,s,n,i,o){this.type=e,this.attrs=t,this.marks=s,this.solid=n,this.options=o,this.content=[],this.activeMarks=Ae.none,this.match=i||(o&mn?null:e.contentMatch)}findWrapping(e){if(!this.match){if(!this.type)return[];let t=this.type.contentMatch.fillBefore(z.from(e));if(t)this.match=this.type.contentMatch.matchFragment(t);else{let s=this.type.contentMatch,n;return(n=s.findWrapping(e.type))?(this.match=s,n):null}}return this.match.findWrapping(e.type)}finish(e){if(!(this.options&An)){let s=this.content[this.content.length-1],n;if(s&&s.isText&&(n=/[ \t\r\n\u000c]+$/.exec(s.text))){let i=s;s.text.length==n[0].length?this.content.pop():this.content[this.content.length-1]=i.withText(i.text.slice(0,i.text.length-n[0].length))}}let t=z.from(this.content);return!e&&this.match&&(t=t.append(this.match.fillBefore(z.empty,!0))),this.type?this.type.create(this.attrs,t,this.marks):t}inlineContext(e){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:e.parentNode&&!Ef.hasOwnProperty(e.parentNode.nodeName.toLowerCase())}}class pd{constructor(e,t,s){this.parser=e,this.options=t,this.isOpen=s,this.open=0,this.localPreserveWS=!1;let n=t.topNode,i,o=fd(null,t.preserveWhitespace,0)|(s?mn:0);n?i=new ti(n.type,n.attrs,Ae.none,!0,t.topMatch||n.type.contentMatch,o):s?i=new ti(null,null,Ae.none,!0,null,o):i=new ti(e.schema.topNodeType,null,Ae.none,!0,null,o),this.nodes=[i],this.find=t.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(e,t){e.nodeType==3?this.addTextNode(e,t):e.nodeType==1&&this.addElement(e,t)}addTextNode(e,t){let s=e.nodeValue,n=this.top,i=n.options&ol?"full":this.localPreserveWS||(n.options&An)>0;if(i==="full"||n.inlineContext(e)||/[^ \t\r\n\u000c]/.test(s)){if(i)i!=="full"?s=s.replace(/\r?\n|\r/g," "):s=s.replace(/\r\n?/g,`
`);else if(s=s.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(s)&&this.open==this.nodes.length-1){let o=n.content[n.content.length-1],l=e.previousSibling;(!o||l&&l.nodeName=="BR"||o.isText&&/[ \t\r\n\u000c]$/.test(o.text))&&(s=s.slice(1))}s&&this.insertNode(this.parser.schema.text(s),t,!/\S/.test(s)),this.findInText(e)}else this.findInside(e)}addElement(e,t,s){let n=this.localPreserveWS,i=this.top;(e.tagName=="PRE"||/pre/.test(e.style&&e.style.whiteSpace))&&(this.localPreserveWS=!0);let o=e.nodeName.toLowerCase(),l;Af.hasOwnProperty(o)&&this.parser.normalizeLists&&nw(e);let c=this.options.ruleFromNode&&this.options.ruleFromNode(e)||(l=this.parser.matchTag(e,this,s));e:if(c?c.ignore:sw.hasOwnProperty(o))this.findInside(e),this.ignoreFallback(e,t);else if(!c||c.skip||c.closeParent){c&&c.closeParent?this.open=Math.max(0,this.open-1):c&&c.skip.nodeType&&(e=c.skip);let d,u=this.needsBlock;if(Ef.hasOwnProperty(o))i.content.length&&i.content[0].isInline&&this.open&&(this.open--,i=this.top),d=!0,i.type||(this.needsBlock=!0);else if(!e.firstChild){this.leafFallback(e,t);break e}let h=c&&c.skip?t:this.readStyles(e,t);h&&this.addAll(e,h),d&&this.sync(i),this.needsBlock=u}else{let d=this.readStyles(e,t);d&&this.addElementByRule(e,c,d,c.consuming===!1?l:void 0)}this.localPreserveWS=n}leafFallback(e,t){e.nodeName=="BR"&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(e.ownerDocument.createTextNode(`
`),t)}ignoreFallback(e,t){e.nodeName=="BR"&&(!this.top.type||!this.top.type.inlineContent)&&this.findPlace(this.parser.schema.text("-"),t,!0)}readStyles(e,t){let s=e.style;if(s&&s.length)for(let n=0;n<this.parser.matchedStyles.length;n++){let i=this.parser.matchedStyles[n],o=s.getPropertyValue(i);if(o)for(let l=void 0;;){let c=this.parser.matchStyle(i,o,this,l);if(!c)break;if(c.ignore)return null;if(c.clearMark?t=t.filter(d=>!c.clearMark(d)):t=t.concat(this.parser.schema.marks[c.mark].create(c.attrs)),c.consuming===!1)l=c;else break}}return t}addElementByRule(e,t,s,n){let i,o;if(t.node)if(o=this.parser.schema.nodes[t.node],o.isLeaf)this.insertNode(o.create(t.attrs),s,e.nodeName=="BR")||this.leafFallback(e,s);else{let c=this.enter(o,t.attrs||null,s,t.preserveWhitespace);c&&(i=!0,s=c)}else{let c=this.parser.schema.marks[t.mark];s=s.concat(c.create(t.attrs))}let l=this.top;if(o&&o.isLeaf)this.findInside(e);else if(n)this.addElement(e,s,n);else if(t.getContent)this.findInside(e),t.getContent(e,this.parser.schema).forEach(c=>this.insertNode(c,s,!1));else{let c=e;typeof t.contentElement=="string"?c=e.querySelector(t.contentElement):typeof t.contentElement=="function"?c=t.contentElement(e):t.contentElement&&(c=t.contentElement),this.findAround(e,c,!0),this.addAll(c,s),this.findAround(e,c,!1)}i&&this.sync(l)&&this.open--}addAll(e,t,s,n){let i=s||0;for(let o=s?e.childNodes[s]:e.firstChild,l=n==null?null:e.childNodes[n];o!=l;o=o.nextSibling,++i)this.findAtPoint(e,i),this.addDOM(o,t);this.findAtPoint(e,i)}findPlace(e,t,s){let n,i;for(let o=this.open,l=0;o>=0;o--){let c=this.nodes[o],d=c.findWrapping(e);if(d&&(!n||n.length>d.length+l)&&(n=d,i=c,!d.length))break;if(c.solid){if(s)break;l+=2}}if(!n)return null;this.sync(i);for(let o=0;o<n.length;o++)t=this.enterInner(n[o],null,t,!1);return t}insertNode(e,t,s){if(e.isInline&&this.needsBlock&&!this.top.type){let i=this.textblockFromContext();i&&(t=this.enterInner(i,null,t))}let n=this.findPlace(e,t,s);if(n){this.closeExtra();let i=this.top;i.match&&(i.match=i.match.matchType(e.type));let o=Ae.none;for(let l of n.concat(e.marks))(i.type?i.type.allowsMarkType(l.type):gd(l.type,e.type))&&(o=l.addToSet(o));return i.content.push(e.mark(o)),!0}return!1}enter(e,t,s,n){let i=this.findPlace(e.create(t),s,!1);return i&&(i=this.enterInner(e,t,s,!0,n)),i}enterInner(e,t,s,n=!1,i){this.closeExtra();let o=this.top;o.match=o.match&&o.match.matchType(e);let l=fd(e,i,o.options);o.options&mn&&o.content.length==0&&(l|=mn);let c=Ae.none;return s=s.filter(d=>(o.type?o.type.allowsMarkType(d.type):gd(d.type,e))?(c=d.addToSet(c),!1):!0),this.nodes.push(new ti(e,t,c,n,null,l)),this.open++,s}closeExtra(e=!1){let t=this.nodes.length-1;if(t>this.open){for(;t>this.open;t--)this.nodes[t-1].content.push(this.nodes[t].finish(e));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(!!(this.isOpen||this.options.topOpen))}sync(e){for(let t=this.open;t>=0;t--){if(this.nodes[t]==e)return this.open=t,!0;this.localPreserveWS&&(this.nodes[t].options|=An)}return!1}get currentPos(){this.closeExtra();let e=0;for(let t=this.open;t>=0;t--){let s=this.nodes[t].content;for(let n=s.length-1;n>=0;n--)e+=s[n].nodeSize;t&&e++}return e}findAtPoint(e,t){if(this.find)for(let s=0;s<this.find.length;s++)this.find[s].node==e&&this.find[s].offset==t&&(this.find[s].pos=this.currentPos)}findInside(e){if(this.find)for(let t=0;t<this.find.length;t++)this.find[t].pos==null&&e.nodeType==1&&e.contains(this.find[t].node)&&(this.find[t].pos=this.currentPos)}findAround(e,t,s){if(e!=t&&this.find)for(let n=0;n<this.find.length;n++)this.find[n].pos==null&&e.nodeType==1&&e.contains(this.find[n].node)&&t.compareDocumentPosition(this.find[n].node)&(s?2:4)&&(this.find[n].pos=this.currentPos)}findInText(e){if(this.find)for(let t=0;t<this.find.length;t++)this.find[t].node==e&&(this.find[t].pos=this.currentPos-(e.nodeValue.length-this.find[t].offset))}matchesContext(e){if(e.indexOf("|")>-1)return e.split(/\s*\|\s*/).some(this.matchesContext,this);let t=e.split("/"),s=this.options.context,n=!this.isOpen&&(!s||s.parent.type==this.nodes[0].type),i=-(s?s.depth+1:0)+(n?0:1),o=(l,c)=>{for(;l>=0;l--){let d=t[l];if(d==""){if(l==t.length-1||l==0)continue;for(;c>=i;c--)if(o(l-1,c))return!0;return!1}else{let u=c>0||c==0&&n?this.nodes[c].type:s&&c>=i?s.node(c-i).type:null;if(!u||u.name!=d&&!u.isInGroup(d))return!1;c--}}return!0};return o(t.length-1,this.open)}textblockFromContext(){let e=this.options.context;if(e)for(let t=e.depth;t>=0;t--){let s=e.node(t).contentMatchAt(e.indexAfter(t)).defaultType;if(s&&s.isTextblock&&s.defaultAttrs)return s}for(let t in this.parser.schema.nodes){let s=this.parser.schema.nodes[t];if(s.isTextblock&&s.defaultAttrs)return s}}}function nw(r){for(let e=r.firstChild,t=null;e;e=e.nextSibling){let s=e.nodeType==1?e.nodeName.toLowerCase():null;s&&Af.hasOwnProperty(s)&&t?(t.appendChild(e),e=t):s=="li"?t=e:s&&(t=null)}}function iw(r,e){return(r.matches||r.msMatchesSelector||r.webkitMatchesSelector||r.mozMatchesSelector).call(r,e)}function md(r){let e={};for(let t in r)e[t]=r[t];return e}function gd(r,e){let t=e.schema.nodes;for(let s in t){let n=t[s];if(!n.allowsMarkType(r))continue;let i=[],o=l=>{i.push(l);for(let c=0;c<l.edgeCount;c++){let{type:d,next:u}=l.edge(c);if(d==e||i.indexOf(u)<0&&o(u))return!0}};if(o(n.contentMatch))return!0}}class js{constructor(e,t){this.nodes=e,this.marks=t}serializeFragment(e,t={},s){s||(s=ua(t).createDocumentFragment());let n=s,i=[];return e.forEach(o=>{if(i.length||o.marks.length){let l=0,c=0;for(;l<i.length&&c<o.marks.length;){let d=o.marks[c];if(!this.marks[d.type.name]){c++;continue}if(!d.eq(i[l][0])||d.type.spec.spanning===!1)break;l++,c++}for(;l<i.length;)n=i.pop()[1];for(;c<o.marks.length;){let d=o.marks[c++],u=this.serializeMark(d,o.isInline,t);u&&(i.push([d,n]),n.appendChild(u.dom),n=u.contentDOM||u.dom)}}n.appendChild(this.serializeNodeInner(o,t))}),s}serializeNodeInner(e,t){let{dom:s,contentDOM:n}=wi(ua(t),this.nodes[e.type.name](e),null,e.attrs);if(n){if(e.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");this.serializeFragment(e.content,t,n)}return s}serializeNode(e,t={}){let s=this.serializeNodeInner(e,t);for(let n=e.marks.length-1;n>=0;n--){let i=this.serializeMark(e.marks[n],e.isInline,t);i&&((i.contentDOM||i.dom).appendChild(s),s=i.dom)}return s}serializeMark(e,t,s={}){let n=this.marks[e.type.name];return n&&wi(ua(s),n(e,t),null,e.attrs)}static renderSpec(e,t,s=null,n){return wi(e,t,s,n)}static fromSchema(e){return e.cached.domSerializer||(e.cached.domSerializer=new js(this.nodesFromSchema(e),this.marksFromSchema(e)))}static nodesFromSchema(e){let t=xd(e.nodes);return t.text||(t.text=s=>s.text),t}static marksFromSchema(e){return xd(e.marks)}}function xd(r){let e={};for(let t in r){let s=r[t].spec.toDOM;s&&(e[t]=s)}return e}function ua(r){return r.document||window.document}const yd=new WeakMap;function ow(r){let e=yd.get(r);return e===void 0&&yd.set(r,e=aw(r)),e}function aw(r){let e=null;function t(s){if(s&&typeof s=="object")if(Array.isArray(s))if(typeof s[0]=="string")e||(e=[]),e.push(s);else for(let n=0;n<s.length;n++)t(s[n]);else for(let n in s)t(s[n])}return t(r),e}function wi(r,e,t,s){if(typeof e=="string")return{dom:r.createTextNode(e)};if(e.nodeType!=null)return{dom:e};if(e.dom&&e.dom.nodeType!=null)return e;let n=e[0],i;if(typeof n!="string")throw new RangeError("Invalid array passed to renderSpec");if(s&&(i=ow(s))&&i.indexOf(e)>-1)throw new RangeError("Using an array from an attribute object as a DOM spec. This may be an attempted cross site scripting attack.");let o=n.indexOf(" ");o>0&&(t=n.slice(0,o),n=n.slice(o+1));let l,c=t?r.createElementNS(t,n):r.createElement(n),d=e[1],u=1;if(d&&typeof d=="object"&&d.nodeType==null&&!Array.isArray(d)){u=2;for(let h in d)if(d[h]!=null){let f=h.indexOf(" ");f>0?c.setAttributeNS(h.slice(0,f),h.slice(f+1),d[h]):c.setAttribute(h,d[h])}}for(let h=u;h<e.length;h++){let f=e[h];if(f===0){if(h<e.length-1||h>u)throw new RangeError("Content hole must be the only child of its parent node");return{dom:c,contentDOM:c}}else{let{dom:p,contentDOM:m}=wi(r,f,t,s);if(c.appendChild(p),m){if(l)throw new RangeError("Multiple content holes");l=m}}}return{dom:c,contentDOM:l}}const Cf=65535,Mf=Math.pow(2,16);function lw(r,e){return r+e*Mf}function bd(r){return r&Cf}function cw(r){return(r-(r&Cf))/Mf}const Df=1,Tf=2,vi=4,Of=8;class al{constructor(e,t,s){this.pos=e,this.delInfo=t,this.recover=s}get deleted(){return(this.delInfo&Of)>0}get deletedBefore(){return(this.delInfo&(Df|vi))>0}get deletedAfter(){return(this.delInfo&(Tf|vi))>0}get deletedAcross(){return(this.delInfo&vi)>0}}class wt{constructor(e,t=!1){if(this.ranges=e,this.inverted=t,!e.length&&wt.empty)return wt.empty}recover(e){let t=0,s=bd(e);if(!this.inverted)for(let n=0;n<s;n++)t+=this.ranges[n*3+2]-this.ranges[n*3+1];return this.ranges[s*3]+t+cw(e)}mapResult(e,t=1){return this._map(e,t,!1)}map(e,t=1){return this._map(e,t,!0)}_map(e,t,s){let n=0,i=this.inverted?2:1,o=this.inverted?1:2;for(let l=0;l<this.ranges.length;l+=3){let c=this.ranges[l]-(this.inverted?n:0);if(c>e)break;let d=this.ranges[l+i],u=this.ranges[l+o],h=c+d;if(e<=h){let f=d?e==c?-1:e==h?1:t:t,p=c+n+(f<0?0:u);if(s)return p;let m=e==(t<0?c:h)?null:lw(l/3,e-c),g=e==c?Tf:e==h?Df:vi;return(t<0?e!=c:e!=h)&&(g|=Of),new al(p,g,m)}n+=u-d}return s?e+n:new al(e+n,0,null)}touches(e,t){let s=0,n=bd(t),i=this.inverted?2:1,o=this.inverted?1:2;for(let l=0;l<this.ranges.length;l+=3){let c=this.ranges[l]-(this.inverted?s:0);if(c>e)break;let d=this.ranges[l+i],u=c+d;if(e<=u&&l==n*3)return!0;s+=this.ranges[l+o]-d}return!1}forEach(e){let t=this.inverted?2:1,s=this.inverted?1:2;for(let n=0,i=0;n<this.ranges.length;n+=3){let o=this.ranges[n],l=o-(this.inverted?i:0),c=o+(this.inverted?0:i),d=this.ranges[n+t],u=this.ranges[n+s];e(l,l+d,c,c+u),i+=u-d}}invert(){return new wt(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(e){return e==0?wt.empty:new wt(e<0?[0,-e,0]:[0,0,e])}}wt.empty=new wt([]);class Cn{constructor(e,t,s=0,n=e?e.length:0){this.mirror=t,this.from=s,this.to=n,this._maps=e||[],this.ownData=!(e||t)}get maps(){return this._maps}slice(e=0,t=this.maps.length){return new Cn(this._maps,this.mirror,e,t)}appendMap(e,t){this.ownData||(this._maps=this._maps.slice(),this.mirror=this.mirror&&this.mirror.slice(),this.ownData=!0),this.to=this._maps.push(e),t!=null&&this.setMirror(this._maps.length-1,t)}appendMapping(e){for(let t=0,s=this._maps.length;t<e._maps.length;t++){let n=e.getMirror(t);this.appendMap(e._maps[t],n!=null&&n<t?s+n:void 0)}}getMirror(e){if(this.mirror){for(let t=0;t<this.mirror.length;t++)if(this.mirror[t]==e)return this.mirror[t+(t%2?-1:1)]}}setMirror(e,t){this.mirror||(this.mirror=[]),this.mirror.push(e,t)}appendMappingInverted(e){for(let t=e.maps.length-1,s=this._maps.length+e._maps.length;t>=0;t--){let n=e.getMirror(t);this.appendMap(e._maps[t].invert(),n!=null&&n>t?s-n-1:void 0)}}invert(){let e=new Cn;return e.appendMappingInverted(this),e}map(e,t=1){if(this.mirror)return this._map(e,t,!0);for(let s=this.from;s<this.to;s++)e=this._maps[s].map(e,t);return e}mapResult(e,t=1){return this._map(e,t,!1)}_map(e,t,s){let n=0;for(let i=this.from;i<this.to;i++){let o=this._maps[i],l=o.mapResult(e,t);if(l.recover!=null){let c=this.getMirror(i);if(c!=null&&c>i&&c<this.to){i=c,e=this._maps[c].recover(l.recover);continue}}n|=l.delInfo,e=l.pos}return s?e:new al(e,n,null)}}const ha=Object.create(null);class it{getMap(){return wt.empty}merge(e){return null}static fromJSON(e,t){if(!t||!t.stepType)throw new RangeError("Invalid input for Step.fromJSON");let s=ha[t.stepType];if(!s)throw new RangeError(`No step type ${t.stepType} defined`);return s.fromJSON(e,t)}static jsonID(e,t){if(e in ha)throw new RangeError("Duplicate use of step JSON ID "+e);return ha[e]=t,t.prototype.jsonID=e,t}}class Ue{constructor(e,t){this.doc=e,this.failed=t}static ok(e){return new Ue(e,null)}static fail(e){return new Ue(null,e)}static fromReplace(e,t,s,n){try{return Ue.ok(e.replace(t,s,n))}catch(i){if(i instanceof Bi)return Ue.fail(i.message);throw i}}}function ec(r,e,t){let s=[];for(let n=0;n<r.childCount;n++){let i=r.child(n);i.content.size&&(i=i.copy(ec(i.content,e,i))),i.isInline&&(i=e(i,t,n)),s.push(i)}return z.fromArray(s)}class wr extends it{constructor(e,t,s){super(),this.from=e,this.to=t,this.mark=s}apply(e){let t=e.slice(this.from,this.to),s=e.resolve(this.from),n=s.node(s.sharedDepth(this.to)),i=new Q(ec(t.content,(o,l)=>!o.isAtom||!l.type.allowsMarkType(this.mark.type)?o:o.mark(this.mark.addToSet(o.marks)),n),t.openStart,t.openEnd);return Ue.fromReplace(e,this.from,this.to,i)}invert(){return new Ut(this.from,this.to,this.mark)}map(e){let t=e.mapResult(this.from,1),s=e.mapResult(this.to,-1);return t.deleted&&s.deleted||t.pos>=s.pos?null:new wr(t.pos,s.pos,this.mark)}merge(e){return e instanceof wr&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new wr(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number")throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new wr(t.from,t.to,e.markFromJSON(t.mark))}}it.jsonID("addMark",wr);class Ut extends it{constructor(e,t,s){super(),this.from=e,this.to=t,this.mark=s}apply(e){let t=e.slice(this.from,this.to),s=new Q(ec(t.content,n=>n.mark(this.mark.removeFromSet(n.marks)),e),t.openStart,t.openEnd);return Ue.fromReplace(e,this.from,this.to,s)}invert(){return new wr(this.from,this.to,this.mark)}map(e){let t=e.mapResult(this.from,1),s=e.mapResult(this.to,-1);return t.deleted&&s.deleted||t.pos>=s.pos?null:new Ut(t.pos,s.pos,this.mark)}merge(e){return e instanceof Ut&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new Ut(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number")throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new Ut(t.from,t.to,e.markFromJSON(t.mark))}}it.jsonID("removeMark",Ut);class vr extends it{constructor(e,t){super(),this.pos=e,this.mark=t}apply(e){let t=e.nodeAt(this.pos);if(!t)return Ue.fail("No node at mark step's position");let s=t.type.create(t.attrs,null,this.mark.addToSet(t.marks));return Ue.fromReplace(e,this.pos,this.pos+1,new Q(z.from(s),0,t.isLeaf?0:1))}invert(e){let t=e.nodeAt(this.pos);if(t){let s=this.mark.addToSet(t.marks);if(s.length==t.marks.length){for(let n=0;n<t.marks.length;n++)if(!t.marks[n].isInSet(s))return new vr(this.pos,t.marks[n]);return new vr(this.pos,this.mark)}}return new ms(this.pos,this.mark)}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new vr(t.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,t){if(typeof t.pos!="number")throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new vr(t.pos,e.markFromJSON(t.mark))}}it.jsonID("addNodeMark",vr);class ms extends it{constructor(e,t){super(),this.pos=e,this.mark=t}apply(e){let t=e.nodeAt(this.pos);if(!t)return Ue.fail("No node at mark step's position");let s=t.type.create(t.attrs,null,this.mark.removeFromSet(t.marks));return Ue.fromReplace(e,this.pos,this.pos+1,new Q(z.from(s),0,t.isLeaf?0:1))}invert(e){let t=e.nodeAt(this.pos);return!t||!this.mark.isInSet(t.marks)?this:new vr(this.pos,this.mark)}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new ms(t.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,t){if(typeof t.pos!="number")throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new ms(t.pos,e.markFromJSON(t.mark))}}it.jsonID("removeNodeMark",ms);class Ve extends it{constructor(e,t,s,n=!1){super(),this.from=e,this.to=t,this.slice=s,this.structure=n}apply(e){return this.structure&&ll(e,this.from,this.to)?Ue.fail("Structure replace would overwrite content"):Ue.fromReplace(e,this.from,this.to,this.slice)}getMap(){return new wt([this.from,this.to-this.from,this.slice.size])}invert(e){return new Ve(this.from,this.from+this.slice.size,e.slice(this.from,this.to))}map(e){let t=e.mapResult(this.from,1),s=e.mapResult(this.to,-1);return t.deletedAcross&&s.deletedAcross?null:new Ve(t.pos,Math.max(t.pos,s.pos),this.slice,this.structure)}merge(e){if(!(e instanceof Ve)||e.structure||this.structure)return null;if(this.from+this.slice.size==e.from&&!this.slice.openEnd&&!e.slice.openStart){let t=this.slice.size+e.slice.size==0?Q.empty:new Q(this.slice.content.append(e.slice.content),this.slice.openStart,e.slice.openEnd);return new Ve(this.from,this.to+(e.to-e.from),t,this.structure)}else if(e.to==this.from&&!this.slice.openStart&&!e.slice.openEnd){let t=this.slice.size+e.slice.size==0?Q.empty:new Q(e.slice.content.append(this.slice.content),e.slice.openStart,this.slice.openEnd);return new Ve(e.from,this.to,t,this.structure)}else return null}toJSON(){let e={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number")throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new Ve(t.from,t.to,Q.fromJSON(e,t.slice),!!t.structure)}}it.jsonID("replace",Ve);class Ke extends it{constructor(e,t,s,n,i,o,l=!1){super(),this.from=e,this.to=t,this.gapFrom=s,this.gapTo=n,this.slice=i,this.insert=o,this.structure=l}apply(e){if(this.structure&&(ll(e,this.from,this.gapFrom)||ll(e,this.gapTo,this.to)))return Ue.fail("Structure gap-replace would overwrite content");let t=e.slice(this.gapFrom,this.gapTo);if(t.openStart||t.openEnd)return Ue.fail("Gap is not a flat range");let s=this.slice.insertAt(this.insert,t.content);return s?Ue.fromReplace(e,this.from,this.to,s):Ue.fail("Content does not fit in gap")}getMap(){return new wt([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(e){let t=this.gapTo-this.gapFrom;return new Ke(this.from,this.from+this.slice.size+t,this.from+this.insert,this.from+this.insert+t,e.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(e){let t=e.mapResult(this.from,1),s=e.mapResult(this.to,-1),n=this.from==this.gapFrom?t.pos:e.map(this.gapFrom,-1),i=this.to==this.gapTo?s.pos:e.map(this.gapTo,1);return t.deletedAcross&&s.deletedAcross||n<t.pos||i>s.pos?null:new Ke(t.pos,s.pos,n,i,this.slice,this.insert,this.structure)}toJSON(){let e={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number"||typeof t.gapFrom!="number"||typeof t.gapTo!="number"||typeof t.insert!="number")throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new Ke(t.from,t.to,t.gapFrom,t.gapTo,Q.fromJSON(e,t.slice),t.insert,!!t.structure)}}it.jsonID("replaceAround",Ke);function ll(r,e,t){let s=r.resolve(e),n=t-e,i=s.depth;for(;n>0&&i>0&&s.indexAfter(i)==s.node(i).childCount;)i--,n--;if(n>0){let o=s.node(i).maybeChild(s.indexAfter(i));for(;n>0;){if(!o||o.isLeaf)return!0;o=o.firstChild,n--}}return!1}function dw(r,e,t,s){let n=[],i=[],o,l;r.doc.nodesBetween(e,t,(c,d,u)=>{if(!c.isInline)return;let h=c.marks;if(!s.isInSet(h)&&u.type.allowsMarkType(s.type)){let f=Math.max(d,e),p=Math.min(d+c.nodeSize,t),m=s.addToSet(h);for(let g=0;g<h.length;g++)h[g].isInSet(m)||(o&&o.to==f&&o.mark.eq(h[g])?o.to=p:n.push(o=new Ut(f,p,h[g])));l&&l.to==f?l.to=p:i.push(l=new wr(f,p,s))}}),n.forEach(c=>r.step(c)),i.forEach(c=>r.step(c))}function uw(r,e,t,s){let n=[],i=0;r.doc.nodesBetween(e,t,(o,l)=>{if(!o.isInline)return;i++;let c=null;if(s instanceof Bo){let d=o.marks,u;for(;u=s.isInSet(d);)(c||(c=[])).push(u),d=u.removeFromSet(d)}else s?s.isInSet(o.marks)&&(c=[s]):c=o.marks;if(c&&c.length){let d=Math.min(l+o.nodeSize,t);for(let u=0;u<c.length;u++){let h=c[u],f;for(let p=0;p<n.length;p++){let m=n[p];m.step==i-1&&h.eq(n[p].style)&&(f=m)}f?(f.to=d,f.step=i):n.push({style:h,from:Math.max(l,e),to:d,step:i})}}}),n.forEach(o=>r.step(new Ut(o.from,o.to,o.style)))}function tc(r,e,t,s=t.contentMatch,n=!0){let i=r.doc.nodeAt(e),o=[],l=e+1;for(let c=0;c<i.childCount;c++){let d=i.child(c),u=l+d.nodeSize,h=s.matchType(d.type);if(!h)o.push(new Ve(l,u,Q.empty));else{s=h;for(let f=0;f<d.marks.length;f++)t.allowsMarkType(d.marks[f].type)||r.step(new Ut(l,u,d.marks[f]));if(n&&d.isText&&t.whitespace!="pre"){let f,p=/\r?\n|\r/g,m;for(;f=p.exec(d.text);)m||(m=new Q(z.from(t.schema.text(" ",t.allowedMarks(d.marks))),0,0)),o.push(new Ve(l+f.index,l+f.index+f[0].length,m))}}l=u}if(!s.validEnd){let c=s.fillBefore(z.empty,!0);r.replace(l,l,new Q(c,0,0))}for(let c=o.length-1;c>=0;c--)r.step(o[c])}function hw(r,e,t){return(e==0||r.canReplace(e,r.childCount))&&(t==r.childCount||r.canReplace(0,t))}function Zs(r){let t=r.parent.content.cutByIndex(r.startIndex,r.endIndex);for(let s=r.depth;;--s){let n=r.$from.node(s),i=r.$from.index(s),o=r.$to.indexAfter(s);if(s<r.depth&&n.canReplace(i,o,t))return s;if(s==0||n.type.spec.isolating||!hw(n,i,o))break}return null}function fw(r,e,t){let{$from:s,$to:n,depth:i}=e,o=s.before(i+1),l=n.after(i+1),c=o,d=l,u=z.empty,h=0;for(let m=i,g=!1;m>t;m--)g||s.index(m)>0?(g=!0,u=z.from(s.node(m).copy(u)),h++):c--;let f=z.empty,p=0;for(let m=i,g=!1;m>t;m--)g||n.after(m+1)<n.end(m)?(g=!0,f=z.from(n.node(m).copy(f)),p++):d++;r.step(new Ke(c,d,o,l,new Q(u.append(f),h,p),u.size-h,!0))}function rc(r,e,t=null,s=r){let n=pw(r,e),i=n&&mw(s,e);return i?n.map(wd).concat({type:e,attrs:t}).concat(i.map(wd)):null}function wd(r){return{type:r,attrs:null}}function pw(r,e){let{parent:t,startIndex:s,endIndex:n}=r,i=t.contentMatchAt(s).findWrapping(e);if(!i)return null;let o=i.length?i[0]:e;return t.canReplaceWith(s,n,o)?i:null}function mw(r,e){let{parent:t,startIndex:s,endIndex:n}=r,i=t.child(s),o=e.contentMatch.findWrapping(i.type);if(!o)return null;let c=(o.length?o[o.length-1]:e).contentMatch;for(let d=s;c&&d<n;d++)c=c.matchType(t.child(d).type);return!c||!c.validEnd?null:o}function gw(r,e,t){let s=z.empty;for(let o=t.length-1;o>=0;o--){if(s.size){let l=t[o].type.contentMatch.matchFragment(s);if(!l||!l.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}s=z.from(t[o].type.create(t[o].attrs,s))}let n=e.start,i=e.end;r.step(new Ke(n,i,n,i,new Q(s,0,0),t.length,!0))}function xw(r,e,t,s,n){if(!s.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");let i=r.steps.length;r.doc.nodesBetween(e,t,(o,l)=>{let c=typeof n=="function"?n(o):n;if(o.isTextblock&&!o.hasMarkup(s,c)&&yw(r.doc,r.mapping.slice(i).map(l),s)){let d=null;if(s.schema.linebreakReplacement){let p=s.whitespace=="pre",m=!!s.contentMatch.matchType(s.schema.linebreakReplacement);p&&!m?d=!1:!p&&m&&(d=!0)}d===!1&&If(r,o,l,i),tc(r,r.mapping.slice(i).map(l,1),s,void 0,d===null);let u=r.mapping.slice(i),h=u.map(l,1),f=u.map(l+o.nodeSize,1);return r.step(new Ke(h,f,h+1,f-1,new Q(z.from(s.create(c,null,o.marks)),0,0),1,!0)),d===!0&&Rf(r,o,l,i),!1}})}function Rf(r,e,t,s){e.forEach((n,i)=>{if(n.isText){let o,l=/\r?\n|\r/g;for(;o=l.exec(n.text);){let c=r.mapping.slice(s).map(t+1+i+o.index);r.replaceWith(c,c+1,e.type.schema.linebreakReplacement.create())}}})}function If(r,e,t,s){e.forEach((n,i)=>{if(n.type==n.type.schema.linebreakReplacement){let o=r.mapping.slice(s).map(t+1+i);r.replaceWith(o,o+1,e.type.schema.text(`
`))}})}function yw(r,e,t){let s=r.resolve(e),n=s.index();return s.parent.canReplaceWith(n,n+1,t)}function bw(r,e,t,s,n){let i=r.doc.nodeAt(e);if(!i)throw new RangeError("No node at given position");t||(t=i.type);let o=t.create(s,null,n||i.marks);if(i.isLeaf)return r.replaceWith(e,e+i.nodeSize,o);if(!t.validContent(i.content))throw new RangeError("Invalid content for node type "+t.name);r.step(new Ke(e,e+i.nodeSize,e+1,e+i.nodeSize-1,new Q(z.from(o),0,0),1,!0))}function nr(r,e,t=1,s){let n=r.resolve(e),i=n.depth-t,o=s&&s[s.length-1]||n.parent;if(i<0||n.parent.type.spec.isolating||!n.parent.canReplace(n.index(),n.parent.childCount)||!o.type.validContent(n.parent.content.cutByIndex(n.index(),n.parent.childCount)))return!1;for(let d=n.depth-1,u=t-2;d>i;d--,u--){let h=n.node(d),f=n.index(d);if(h.type.spec.isolating)return!1;let p=h.content.cutByIndex(f,h.childCount),m=s&&s[u+1];m&&(p=p.replaceChild(0,m.type.create(m.attrs)));let g=s&&s[u]||h;if(!h.canReplace(f+1,h.childCount)||!g.type.validContent(p))return!1}let l=n.indexAfter(i),c=s&&s[0];return n.node(i).canReplaceWith(l,l,c?c.type:n.node(i+1).type)}function ww(r,e,t=1,s){let n=r.doc.resolve(e),i=z.empty,o=z.empty;for(let l=n.depth,c=n.depth-t,d=t-1;l>c;l--,d--){i=z.from(n.node(l).copy(i));let u=s&&s[d];o=z.from(u?u.type.create(u.attrs,o):n.node(l).copy(o))}r.step(new Ve(e,e,new Q(i.append(o),t,t),!0))}function Lr(r,e){let t=r.resolve(e),s=t.index();return Pf(t.nodeBefore,t.nodeAfter)&&t.parent.canReplace(s,s+1)}function vw(r,e){e.content.size||r.type.compatibleContent(e.type);let t=r.contentMatchAt(r.childCount),{linebreakReplacement:s}=r.type.schema;for(let n=0;n<e.childCount;n++){let i=e.child(n),o=i.type==s?r.type.schema.nodes.text:i.type;if(t=t.matchType(o),!t||!r.type.allowsMarks(i.marks))return!1}return t.validEnd}function Pf(r,e){return!!(r&&e&&!r.isLeaf&&vw(r,e))}function Uo(r,e,t=-1){let s=r.resolve(e);for(let n=s.depth;;n--){let i,o,l=s.index(n);if(n==s.depth?(i=s.nodeBefore,o=s.nodeAfter):t>0?(i=s.node(n+1),l++,o=s.node(n).maybeChild(l)):(i=s.node(n).maybeChild(l-1),o=s.node(n+1)),i&&!i.isTextblock&&Pf(i,o)&&s.node(n).canReplace(l,l+1))return e;if(n==0)break;e=t<0?s.before(n):s.after(n)}}function Nw(r,e,t){let s=null,{linebreakReplacement:n}=r.doc.type.schema,i=r.doc.resolve(e-t),o=i.node().type;if(n&&o.inlineContent){let u=o.whitespace=="pre",h=!!o.contentMatch.matchType(n);u&&!h?s=!1:!u&&h&&(s=!0)}let l=r.steps.length;if(s===!1){let u=r.doc.resolve(e+t);If(r,u.node(),u.before(),l)}o.inlineContent&&tc(r,e+t-1,o,i.node().contentMatchAt(i.index()),s==null);let c=r.mapping.slice(l),d=c.map(e-t);if(r.step(new Ve(d,c.map(e+t,-1),Q.empty,!0)),s===!0){let u=r.doc.resolve(d);Rf(r,u.node(),u.before(),r.steps.length)}return r}function jw(r,e,t){let s=r.resolve(e);if(s.parent.canReplaceWith(s.index(),s.index(),t))return e;if(s.parentOffset==0)for(let n=s.depth-1;n>=0;n--){let i=s.index(n);if(s.node(n).canReplaceWith(i,i,t))return s.before(n+1);if(i>0)return null}if(s.parentOffset==s.parent.content.size)for(let n=s.depth-1;n>=0;n--){let i=s.indexAfter(n);if(s.node(n).canReplaceWith(i,i,t))return s.after(n+1);if(i<s.node(n).childCount)return null}return null}function Lf(r,e,t){let s=r.resolve(e);if(!t.content.size)return e;let n=t.content;for(let i=0;i<t.openStart;i++)n=n.firstChild.content;for(let i=1;i<=(t.openStart==0&&t.size?2:1);i++)for(let o=s.depth;o>=0;o--){let l=o==s.depth?0:s.pos<=(s.start(o+1)+s.end(o+1))/2?-1:1,c=s.index(o)+(l>0?1:0),d=s.node(o),u=!1;if(i==1)u=d.canReplace(c,c,n);else{let h=d.contentMatchAt(c).findWrapping(n.firstChild.type);u=h&&d.canReplaceWith(c,c,h[0])}if(u)return l==0?s.pos:l<0?s.before(o+1):s.after(o+1)}return null}function zo(r,e,t=e,s=Q.empty){if(e==t&&!s.size)return null;let n=r.resolve(e),i=r.resolve(t);return $f(n,i,s)?new Ve(e,t,s):new kw(n,i,s).fit()}function $f(r,e,t){return!t.openStart&&!t.openEnd&&r.start()==e.start()&&r.parent.canReplace(r.index(),e.index(),t.content)}class kw{constructor(e,t,s){this.$from=e,this.$to=t,this.unplaced=s,this.frontier=[],this.placed=z.empty;for(let n=0;n<=e.depth;n++){let i=e.node(n);this.frontier.push({type:i.type,match:i.contentMatchAt(e.indexAfter(n))})}for(let n=e.depth;n>0;n--)this.placed=z.from(e.node(n).copy(this.placed))}get depth(){return this.frontier.length-1}fit(){for(;this.unplaced.size;){let d=this.findFittable();d?this.placeNodes(d):this.openMore()||this.dropNode()}let e=this.mustMoveInline(),t=this.placed.size-this.depth-this.$from.depth,s=this.$from,n=this.close(e<0?this.$to:s.doc.resolve(e));if(!n)return null;let i=this.placed,o=s.depth,l=n.depth;for(;o&&l&&i.childCount==1;)i=i.firstChild.content,o--,l--;let c=new Q(i,o,l);return e>-1?new Ke(s.pos,e,this.$to.pos,this.$to.end(),c,t):c.size||s.pos!=this.$to.pos?new Ve(s.pos,n.pos,c):null}findFittable(){let e=this.unplaced.openStart;for(let t=this.unplaced.content,s=0,n=this.unplaced.openEnd;s<e;s++){let i=t.firstChild;if(t.childCount>1&&(n=0),i.type.spec.isolating&&n<=s){e=s;break}t=i.content}for(let t=1;t<=2;t++)for(let s=t==1?e:this.unplaced.openStart;s>=0;s--){let n,i=null;s?(i=fa(this.unplaced.content,s-1).firstChild,n=i.content):n=this.unplaced.content;let o=n.firstChild;for(let l=this.depth;l>=0;l--){let{type:c,match:d}=this.frontier[l],u,h=null;if(t==1&&(o?d.matchType(o.type)||(h=d.fillBefore(z.from(o),!1)):i&&c.compatibleContent(i.type)))return{sliceDepth:s,frontierDepth:l,parent:i,inject:h};if(t==2&&o&&(u=d.findWrapping(o.type)))return{sliceDepth:s,frontierDepth:l,parent:i,wrap:u};if(i&&d.matchType(i.type))break}}}openMore(){let{content:e,openStart:t,openEnd:s}=this.unplaced,n=fa(e,t);return!n.childCount||n.firstChild.isLeaf?!1:(this.unplaced=new Q(e,t+1,Math.max(s,n.size+t>=e.size-s?t+1:0)),!0)}dropNode(){let{content:e,openStart:t,openEnd:s}=this.unplaced,n=fa(e,t);if(n.childCount<=1&&t>0){let i=e.size-t<=t+n.size;this.unplaced=new Q(ln(e,t-1,1),t-1,i?t-1:s)}else this.unplaced=new Q(ln(e,t,1),t,s)}placeNodes({sliceDepth:e,frontierDepth:t,parent:s,inject:n,wrap:i}){for(;this.depth>t;)this.closeFrontierNode();if(i)for(let g=0;g<i.length;g++)this.openFrontierNode(i[g]);let o=this.unplaced,l=s?s.content:o.content,c=o.openStart-e,d=0,u=[],{match:h,type:f}=this.frontier[t];if(n){for(let g=0;g<n.childCount;g++)u.push(n.child(g));h=h.matchFragment(n)}let p=l.size+e-(o.content.size-o.openEnd);for(;d<l.childCount;){let g=l.child(d),y=h.matchType(g.type);if(!y)break;d++,(d>1||c==0||g.content.size)&&(h=y,u.push(_f(g.mark(f.allowedMarks(g.marks)),d==1?c:0,d==l.childCount?p:-1)))}let m=d==l.childCount;m||(p=-1),this.placed=cn(this.placed,t,z.from(u)),this.frontier[t].match=h,m&&p<0&&s&&s.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(let g=0,y=l;g<p;g++){let x=y.lastChild;this.frontier.push({type:x.type,match:x.contentMatchAt(x.childCount)}),y=x.content}this.unplaced=m?e==0?Q.empty:new Q(ln(o.content,e-1,1),e-1,p<0?o.openEnd:e-1):new Q(ln(o.content,e,d),o.openStart,o.openEnd)}mustMoveInline(){if(!this.$to.parent.isTextblock)return-1;let e=this.frontier[this.depth],t;if(!e.type.isTextblock||!pa(this.$to,this.$to.depth,e.type,e.match,!1)||this.$to.depth==this.depth&&(t=this.findCloseLevel(this.$to))&&t.depth==this.depth)return-1;let{depth:s}=this.$to,n=this.$to.after(s);for(;s>1&&n==this.$to.end(--s);)++n;return n}findCloseLevel(e){e:for(let t=Math.min(this.depth,e.depth);t>=0;t--){let{match:s,type:n}=this.frontier[t],i=t<e.depth&&e.end(t+1)==e.pos+(e.depth-(t+1)),o=pa(e,t,n,s,i);if(o){for(let l=t-1;l>=0;l--){let{match:c,type:d}=this.frontier[l],u=pa(e,l,d,c,!0);if(!u||u.childCount)continue e}return{depth:t,fit:o,move:i?e.doc.resolve(e.after(t+1)):e}}}}close(e){let t=this.findCloseLevel(e);if(!t)return null;for(;this.depth>t.depth;)this.closeFrontierNode();t.fit.childCount&&(this.placed=cn(this.placed,t.depth,t.fit)),e=t.move;for(let s=t.depth+1;s<=e.depth;s++){let n=e.node(s),i=n.type.contentMatch.fillBefore(n.content,!0,e.index(s));this.openFrontierNode(n.type,n.attrs,i)}return e}openFrontierNode(e,t=null,s){let n=this.frontier[this.depth];n.match=n.match.matchType(e),this.placed=cn(this.placed,this.depth,z.from(e.create(t,s))),this.frontier.push({type:e,match:e.contentMatch})}closeFrontierNode(){let t=this.frontier.pop().match.fillBefore(z.empty,!0);t.childCount&&(this.placed=cn(this.placed,this.frontier.length,t))}}function ln(r,e,t){return e==0?r.cutByIndex(t,r.childCount):r.replaceChild(0,r.firstChild.copy(ln(r.firstChild.content,e-1,t)))}function cn(r,e,t){return e==0?r.append(t):r.replaceChild(r.childCount-1,r.lastChild.copy(cn(r.lastChild.content,e-1,t)))}function fa(r,e){for(let t=0;t<e;t++)r=r.firstChild.content;return r}function _f(r,e,t){if(e<=0)return r;let s=r.content;return e>1&&(s=s.replaceChild(0,_f(s.firstChild,e-1,s.childCount==1?t-1:0))),e>0&&(s=r.type.contentMatch.fillBefore(s).append(s),t<=0&&(s=s.append(r.type.contentMatch.matchFragment(s).fillBefore(z.empty,!0)))),r.copy(s)}function pa(r,e,t,s,n){let i=r.node(e),o=n?r.indexAfter(e):r.index(e);if(o==i.childCount&&!t.compatibleContent(i.type))return null;let l=s.fillBefore(i.content,!0,o);return l&&!Sw(t,i.content,o)?l:null}function Sw(r,e,t){for(let s=t;s<e.childCount;s++)if(!r.allowsMarks(e.child(s).marks))return!0;return!1}function Ew(r){return r.spec.defining||r.spec.definingForContent}function Aw(r,e,t,s){if(!s.size)return r.deleteRange(e,t);let n=r.doc.resolve(e),i=r.doc.resolve(t);if($f(n,i,s))return r.step(new Ve(e,t,s));let o=Bf(n,r.doc.resolve(t));o[o.length-1]==0&&o.pop();let l=-(n.depth+1);o.unshift(l);for(let f=n.depth,p=n.pos-1;f>0;f--,p--){let m=n.node(f).type.spec;if(m.defining||m.definingAsContext||m.isolating)break;o.indexOf(f)>-1?l=f:n.before(f)==p&&o.splice(1,0,-f)}let c=o.indexOf(l),d=[],u=s.openStart;for(let f=s.content,p=0;;p++){let m=f.firstChild;if(d.push(m),p==s.openStart)break;f=m.content}for(let f=u-1;f>=0;f--){let p=d[f],m=Ew(p.type);if(m&&!p.sameMarkup(n.node(Math.abs(l)-1)))u=f;else if(m||!p.type.isTextblock)break}for(let f=s.openStart;f>=0;f--){let p=(f+u+1)%(s.openStart+1),m=d[p];if(m)for(let g=0;g<o.length;g++){let y=o[(g+c)%o.length],x=!0;y<0&&(x=!1,y=-y);let N=n.node(y-1),A=n.index(y-1);if(N.canReplaceWith(A,A,m.type,m.marks))return r.replace(n.before(y),x?i.after(y):t,new Q(Ff(s.content,0,s.openStart,p),p,s.openEnd))}}let h=r.steps.length;for(let f=o.length-1;f>=0&&(r.replace(e,t,s),!(r.steps.length>h));f--){let p=o[f];p<0||(e=n.before(p),t=i.after(p))}}function Ff(r,e,t,s,n){if(e<t){let i=r.firstChild;r=r.replaceChild(0,i.copy(Ff(i.content,e+1,t,s,i)))}if(e>s){let i=n.contentMatchAt(0),o=i.fillBefore(r).append(r);r=o.append(i.matchFragment(o).fillBefore(z.empty,!0))}return r}function Cw(r,e,t,s){if(!s.isInline&&e==t&&r.doc.resolve(e).parent.content.size){let n=jw(r.doc,e,s.type);n!=null&&(e=t=n)}r.replaceRange(e,t,new Q(z.from(s),0,0))}function Mw(r,e,t){let s=r.doc.resolve(e),n=r.doc.resolve(t),i=Bf(s,n);for(let o=0;o<i.length;o++){let l=i[o],c=o==i.length-1;if(c&&l==0||s.node(l).type.contentMatch.validEnd)return r.delete(s.start(l),n.end(l));if(l>0&&(c||s.node(l-1).canReplace(s.index(l-1),n.indexAfter(l-1))))return r.delete(s.before(l),n.after(l))}for(let o=1;o<=s.depth&&o<=n.depth;o++)if(e-s.start(o)==s.depth-o&&t>s.end(o)&&n.end(o)-t!=n.depth-o&&s.start(o-1)==n.start(o-1)&&s.node(o-1).canReplace(s.index(o-1),n.index(o-1)))return r.delete(s.before(o),t);r.delete(e,t)}function Bf(r,e){let t=[],s=Math.min(r.depth,e.depth);for(let n=s;n>=0;n--){let i=r.start(n);if(i<r.pos-(r.depth-n)||e.end(n)>e.pos+(e.depth-n)||r.node(n).type.spec.isolating||e.node(n).type.spec.isolating)break;(i==e.start(n)||n==r.depth&&n==e.depth&&r.parent.inlineContent&&e.parent.inlineContent&&n&&e.start(n-1)==i-1)&&t.push(n)}return t}class Fs extends it{constructor(e,t,s){super(),this.pos=e,this.attr=t,this.value=s}apply(e){let t=e.nodeAt(this.pos);if(!t)return Ue.fail("No node at attribute step's position");let s=Object.create(null);for(let i in t.attrs)s[i]=t.attrs[i];s[this.attr]=this.value;let n=t.type.create(s,null,t.marks);return Ue.fromReplace(e,this.pos,this.pos+1,new Q(z.from(n),0,t.isLeaf?0:1))}getMap(){return wt.empty}invert(e){return new Fs(this.pos,this.attr,e.nodeAt(this.pos).attrs[this.attr])}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new Fs(t.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(e,t){if(typeof t.pos!="number"||typeof t.attr!="string")throw new RangeError("Invalid input for AttrStep.fromJSON");return new Fs(t.pos,t.attr,t.value)}}it.jsonID("attr",Fs);class Mn extends it{constructor(e,t){super(),this.attr=e,this.value=t}apply(e){let t=Object.create(null);for(let n in e.attrs)t[n]=e.attrs[n];t[this.attr]=this.value;let s=e.type.create(t,e.content,e.marks);return Ue.ok(s)}getMap(){return wt.empty}invert(e){return new Mn(this.attr,e.attrs[this.attr])}map(e){return this}toJSON(){return{stepType:"docAttr",attr:this.attr,value:this.value}}static fromJSON(e,t){if(typeof t.attr!="string")throw new RangeError("Invalid input for DocAttrStep.fromJSON");return new Mn(t.attr,t.value)}}it.jsonID("docAttr",Mn);let Ws=class extends Error{};Ws=function r(e){let t=Error.call(this,e);return t.__proto__=r.prototype,t};Ws.prototype=Object.create(Error.prototype);Ws.prototype.constructor=Ws;Ws.prototype.name="TransformError";class Uf{constructor(e){this.doc=e,this.steps=[],this.docs=[],this.mapping=new Cn}get before(){return this.docs.length?this.docs[0]:this.doc}step(e){let t=this.maybeStep(e);if(t.failed)throw new Ws(t.failed);return this}maybeStep(e){let t=e.apply(this.doc);return t.failed||this.addStep(e,t.doc),t}get docChanged(){return this.steps.length>0}addStep(e,t){this.docs.push(this.doc),this.steps.push(e),this.mapping.appendMap(e.getMap()),this.doc=t}replace(e,t=e,s=Q.empty){let n=zo(this.doc,e,t,s);return n&&this.step(n),this}replaceWith(e,t,s){return this.replace(e,t,new Q(z.from(s),0,0))}delete(e,t){return this.replace(e,t,Q.empty)}insert(e,t){return this.replaceWith(e,e,t)}replaceRange(e,t,s){return Aw(this,e,t,s),this}replaceRangeWith(e,t,s){return Cw(this,e,t,s),this}deleteRange(e,t){return Mw(this,e,t),this}lift(e,t){return fw(this,e,t),this}join(e,t=1){return Nw(this,e,t),this}wrap(e,t){return gw(this,e,t),this}setBlockType(e,t=e,s,n=null){return xw(this,e,t,s,n),this}setNodeMarkup(e,t,s=null,n){return bw(this,e,t,s,n),this}setNodeAttribute(e,t,s){return this.step(new Fs(e,t,s)),this}setDocAttribute(e,t){return this.step(new Mn(e,t)),this}addNodeMark(e,t){return this.step(new vr(e,t)),this}removeNodeMark(e,t){let s=this.doc.nodeAt(e);if(!s)throw new RangeError("No node at position "+e);if(t instanceof Ae)t.isInSet(s.marks)&&this.step(new ms(e,t));else{let n=s.marks,i,o=[];for(;i=t.isInSet(n);)o.push(new ms(e,i)),n=i.removeFromSet(n);for(let l=o.length-1;l>=0;l--)this.step(o[l])}return this}split(e,t=1,s){return ww(this,e,t,s),this}addMark(e,t,s){return dw(this,e,t,s),this}removeMark(e,t,s){return uw(this,e,t,s),this}clearIncompatible(e,t,s){return tc(this,e,t,s),this}}const ma=Object.create(null);class de{constructor(e,t,s){this.$anchor=e,this.$head=t,this.ranges=s||[new Dw(e.min(t),e.max(t))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let e=this.ranges;for(let t=0;t<e.length;t++)if(e[t].$from.pos!=e[t].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(e,t=Q.empty){let s=t.content.lastChild,n=null;for(let l=0;l<t.openEnd;l++)n=s,s=s.lastChild;let i=e.steps.length,o=this.ranges;for(let l=0;l<o.length;l++){let{$from:c,$to:d}=o[l],u=e.mapping.slice(i);e.replaceRange(u.map(c.pos),u.map(d.pos),l?Q.empty:t),l==0&&jd(e,i,(s?s.isInline:n&&n.isTextblock)?-1:1)}}replaceWith(e,t){let s=e.steps.length,n=this.ranges;for(let i=0;i<n.length;i++){let{$from:o,$to:l}=n[i],c=e.mapping.slice(s),d=c.map(o.pos),u=c.map(l.pos);i?e.deleteRange(d,u):(e.replaceRangeWith(d,u,t),jd(e,s,t.isInline?-1:1))}}static findFrom(e,t,s=!1){let n=e.parent.inlineContent?new ce(e):Os(e.node(0),e.parent,e.pos,e.index(),t,s);if(n)return n;for(let i=e.depth-1;i>=0;i--){let o=t<0?Os(e.node(0),e.node(i),e.before(i+1),e.index(i),t,s):Os(e.node(0),e.node(i),e.after(i+1),e.index(i)+1,t,s);if(o)return o}return null}static near(e,t=1){return this.findFrom(e,t)||this.findFrom(e,-t)||new kt(e.node(0))}static atStart(e){return Os(e,e,0,0,1)||new kt(e)}static atEnd(e){return Os(e,e,e.content.size,e.childCount,-1)||new kt(e)}static fromJSON(e,t){if(!t||!t.type)throw new RangeError("Invalid input for Selection.fromJSON");let s=ma[t.type];if(!s)throw new RangeError(`No selection type ${t.type} defined`);return s.fromJSON(e,t)}static jsonID(e,t){if(e in ma)throw new RangeError("Duplicate use of selection JSON ID "+e);return ma[e]=t,t.prototype.jsonID=e,t}getBookmark(){return ce.between(this.$anchor,this.$head).getBookmark()}}de.prototype.visible=!0;class Dw{constructor(e,t){this.$from=e,this.$to=t}}let vd=!1;function Nd(r){!vd&&!r.parent.inlineContent&&(vd=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+r.parent.type.name+")"))}class ce extends de{constructor(e,t=e){Nd(e),Nd(t),super(e,t)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(e,t){let s=e.resolve(t.map(this.head));if(!s.parent.inlineContent)return de.near(s);let n=e.resolve(t.map(this.anchor));return new ce(n.parent.inlineContent?n:s,s)}replace(e,t=Q.empty){if(super.replace(e,t),t==Q.empty){let s=this.$from.marksAcross(this.$to);s&&e.ensureMarks(s)}}eq(e){return e instanceof ce&&e.anchor==this.anchor&&e.head==this.head}getBookmark(){return new Wo(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(e,t){if(typeof t.anchor!="number"||typeof t.head!="number")throw new RangeError("Invalid input for TextSelection.fromJSON");return new ce(e.resolve(t.anchor),e.resolve(t.head))}static create(e,t,s=t){let n=e.resolve(t);return new this(n,s==t?n:e.resolve(s))}static between(e,t,s){let n=e.pos-t.pos;if((!s||n)&&(s=n>=0?1:-1),!t.parent.inlineContent){let i=de.findFrom(t,s,!0)||de.findFrom(t,-s,!0);if(i)t=i.$head;else return de.near(t,s)}return e.parent.inlineContent||(n==0?e=t:(e=(de.findFrom(e,-s,!0)||de.findFrom(e,s,!0)).$anchor,e.pos<t.pos!=n<0&&(e=t))),new ce(e,t)}}de.jsonID("text",ce);class Wo{constructor(e,t){this.anchor=e,this.head=t}map(e){return new Wo(e.map(this.anchor),e.map(this.head))}resolve(e){return ce.between(e.resolve(this.anchor),e.resolve(this.head))}}class se extends de{constructor(e){let t=e.nodeAfter,s=e.node(0).resolve(e.pos+t.nodeSize);super(e,s),this.node=t}map(e,t){let{deleted:s,pos:n}=t.mapResult(this.anchor),i=e.resolve(n);return s?de.near(i):new se(i)}content(){return new Q(z.from(this.node),0,0)}eq(e){return e instanceof se&&e.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new sc(this.anchor)}static fromJSON(e,t){if(typeof t.anchor!="number")throw new RangeError("Invalid input for NodeSelection.fromJSON");return new se(e.resolve(t.anchor))}static create(e,t){return new se(e.resolve(t))}static isSelectable(e){return!e.isText&&e.type.spec.selectable!==!1}}se.prototype.visible=!1;de.jsonID("node",se);class sc{constructor(e){this.anchor=e}map(e){let{deleted:t,pos:s}=e.mapResult(this.anchor);return t?new Wo(s,s):new sc(s)}resolve(e){let t=e.resolve(this.anchor),s=t.nodeAfter;return s&&se.isSelectable(s)?new se(t):de.near(t)}}class kt extends de{constructor(e){super(e.resolve(0),e.resolve(e.content.size))}replace(e,t=Q.empty){if(t==Q.empty){e.delete(0,e.doc.content.size);let s=de.atStart(e.doc);s.eq(e.selection)||e.setSelection(s)}else super.replace(e,t)}toJSON(){return{type:"all"}}static fromJSON(e){return new kt(e)}map(e){return new kt(e)}eq(e){return e instanceof kt}getBookmark(){return Tw}}de.jsonID("all",kt);const Tw={map(){return this},resolve(r){return new kt(r)}};function Os(r,e,t,s,n,i=!1){if(e.inlineContent)return ce.create(r,t);for(let o=s-(n>0?0:1);n>0?o<e.childCount:o>=0;o+=n){let l=e.child(o);if(l.isAtom){if(!i&&se.isSelectable(l))return se.create(r,t-(n<0?l.nodeSize:0))}else{let c=Os(r,l,t+n,n<0?l.childCount:0,n,i);if(c)return c}t+=l.nodeSize*n}return null}function jd(r,e,t){let s=r.steps.length-1;if(s<e)return;let n=r.steps[s];if(!(n instanceof Ve||n instanceof Ke))return;let i=r.mapping.maps[s],o;i.forEach((l,c,d,u)=>{o==null&&(o=u)}),r.setSelection(de.near(r.doc.resolve(o),t))}const kd=1,ri=2,Sd=4;class Ow extends Uf{constructor(e){super(e.doc),this.curSelectionFor=0,this.updated=0,this.meta=Object.create(null),this.time=Date.now(),this.curSelection=e.selection,this.storedMarks=e.storedMarks}get selection(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection}setSelection(e){if(e.$from.doc!=this.doc)throw new RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=e,this.curSelectionFor=this.steps.length,this.updated=(this.updated|kd)&~ri,this.storedMarks=null,this}get selectionSet(){return(this.updated&kd)>0}setStoredMarks(e){return this.storedMarks=e,this.updated|=ri,this}ensureMarks(e){return Ae.sameSet(this.storedMarks||this.selection.$from.marks(),e)||this.setStoredMarks(e),this}addStoredMark(e){return this.ensureMarks(e.addToSet(this.storedMarks||this.selection.$head.marks()))}removeStoredMark(e){return this.ensureMarks(e.removeFromSet(this.storedMarks||this.selection.$head.marks()))}get storedMarksSet(){return(this.updated&ri)>0}addStep(e,t){super.addStep(e,t),this.updated=this.updated&~ri,this.storedMarks=null}setTime(e){return this.time=e,this}replaceSelection(e){return this.selection.replace(this,e),this}replaceSelectionWith(e,t=!0){let s=this.selection;return t&&(e=e.mark(this.storedMarks||(s.empty?s.$from.marks():s.$from.marksAcross(s.$to)||Ae.none))),s.replaceWith(this,e),this}deleteSelection(){return this.selection.replace(this),this}insertText(e,t,s){let n=this.doc.type.schema;if(t==null)return e?this.replaceSelectionWith(n.text(e),!0):this.deleteSelection();{if(s==null&&(s=t),s=s??t,!e)return this.deleteRange(t,s);let i=this.storedMarks;if(!i){let o=this.doc.resolve(t);i=s==t?o.marks():o.marksAcross(this.doc.resolve(s))}return this.replaceRangeWith(t,s,n.text(e,i)),this.selection.empty||this.setSelection(de.near(this.selection.$to)),this}}setMeta(e,t){return this.meta[typeof e=="string"?e:e.key]=t,this}getMeta(e){return this.meta[typeof e=="string"?e:e.key]}get isGeneric(){for(let e in this.meta)return!1;return!0}scrollIntoView(){return this.updated|=Sd,this}get scrolledIntoView(){return(this.updated&Sd)>0}}function Ed(r,e){return!e||!r?r:r.bind(e)}class dn{constructor(e,t,s){this.name=e,this.init=Ed(t.init,s),this.apply=Ed(t.apply,s)}}const Rw=[new dn("doc",{init(r){return r.doc||r.schema.topNodeType.createAndFill()},apply(r){return r.doc}}),new dn("selection",{init(r,e){return r.selection||de.atStart(e.doc)},apply(r){return r.selection}}),new dn("storedMarks",{init(r){return r.storedMarks||null},apply(r,e,t,s){return s.selection.$cursor?r.storedMarks:null}}),new dn("scrollToSelection",{init(){return 0},apply(r,e){return r.scrolledIntoView?e+1:e}})];class ga{constructor(e,t){this.schema=e,this.plugins=[],this.pluginsByKey=Object.create(null),this.fields=Rw.slice(),t&&t.forEach(s=>{if(this.pluginsByKey[s.key])throw new RangeError("Adding different instances of a keyed plugin ("+s.key+")");this.plugins.push(s),this.pluginsByKey[s.key]=s,s.spec.state&&this.fields.push(new dn(s.key,s.spec.state,s))})}}class Ls{constructor(e){this.config=e}get schema(){return this.config.schema}get plugins(){return this.config.plugins}apply(e){return this.applyTransaction(e).state}filterTransaction(e,t=-1){for(let s=0;s<this.config.plugins.length;s++)if(s!=t){let n=this.config.plugins[s];if(n.spec.filterTransaction&&!n.spec.filterTransaction.call(n,e,this))return!1}return!0}applyTransaction(e){if(!this.filterTransaction(e))return{state:this,transactions:[]};let t=[e],s=this.applyInner(e),n=null;for(;;){let i=!1;for(let o=0;o<this.config.plugins.length;o++){let l=this.config.plugins[o];if(l.spec.appendTransaction){let c=n?n[o].n:0,d=n?n[o].state:this,u=c<t.length&&l.spec.appendTransaction.call(l,c?t.slice(c):t,d,s);if(u&&s.filterTransaction(u,o)){if(u.setMeta("appendedTransaction",e),!n){n=[];for(let h=0;h<this.config.plugins.length;h++)n.push(h<o?{state:s,n:t.length}:{state:this,n:0})}t.push(u),s=s.applyInner(u),i=!0}n&&(n[o]={state:s,n:t.length})}}if(!i)return{state:s,transactions:t}}}applyInner(e){if(!e.before.eq(this.doc))throw new RangeError("Applying a mismatched transaction");let t=new Ls(this.config),s=this.config.fields;for(let n=0;n<s.length;n++){let i=s[n];t[i.name]=i.apply(e,this[i.name],this,t)}return t}get tr(){return new Ow(this)}static create(e){let t=new ga(e.doc?e.doc.type.schema:e.schema,e.plugins),s=new Ls(t);for(let n=0;n<t.fields.length;n++)s[t.fields[n].name]=t.fields[n].init(e,s);return s}reconfigure(e){let t=new ga(this.schema,e.plugins),s=t.fields,n=new Ls(t);for(let i=0;i<s.length;i++){let o=s[i].name;n[o]=this.hasOwnProperty(o)?this[o]:s[i].init(e,n)}return n}toJSON(e){let t={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(t.storedMarks=this.storedMarks.map(s=>s.toJSON())),e&&typeof e=="object")for(let s in e){if(s=="doc"||s=="selection")throw new RangeError("The JSON fields `doc` and `selection` are reserved");let n=e[s],i=n.spec.state;i&&i.toJSON&&(t[s]=i.toJSON.call(n,this[n.key]))}return t}static fromJSON(e,t,s){if(!t)throw new RangeError("Invalid input for EditorState.fromJSON");if(!e.schema)throw new RangeError("Required config field 'schema' missing");let n=new ga(e.schema,e.plugins),i=new Ls(n);return n.fields.forEach(o=>{if(o.name=="doc")i.doc=Ar.fromJSON(e.schema,t.doc);else if(o.name=="selection")i.selection=de.fromJSON(i.doc,t.selection);else if(o.name=="storedMarks")t.storedMarks&&(i.storedMarks=t.storedMarks.map(e.schema.markFromJSON));else{if(s)for(let l in s){let c=s[l],d=c.spec.state;if(c.key==o.name&&d&&d.fromJSON&&Object.prototype.hasOwnProperty.call(t,l)){i[o.name]=d.fromJSON.call(c,e,t[l],i);return}}i[o.name]=o.init(e,i)}}),i}}function zf(r,e,t){for(let s in r){let n=r[s];n instanceof Function?n=n.bind(e):s=="handleDOMEvents"&&(n=zf(n,e,{})),t[s]=n}return t}class Je{constructor(e){this.spec=e,this.props={},e.props&&zf(e.props,this,this.props),this.key=e.key?e.key.key:Wf("plugin")}getState(e){return e[this.key]}}const xa=Object.create(null);function Wf(r){return r in xa?r+"$"+ ++xa[r]:(xa[r]=0,r+"$")}class yt{constructor(e="key"){this.key=Wf(e)}get(e){return e.config.pluginsByKey[this.key]}getState(e){return e[this.key]}}const Qe=function(r){for(var e=0;;e++)if(r=r.previousSibling,!r)return e},Hs=function(r){let e=r.assignedSlot||r.parentNode;return e&&e.nodeType==11?e.host:e};let cl=null;const tr=function(r,e,t){let s=cl||(cl=document.createRange());return s.setEnd(r,t??r.nodeValue.length),s.setStart(r,e||0),s},Iw=function(){cl=null},gs=function(r,e,t,s){return t&&(Ad(r,e,t,s,-1)||Ad(r,e,t,s,1))},Pw=/^(img|br|input|textarea|hr)$/i;function Ad(r,e,t,s,n){for(var i;;){if(r==t&&e==s)return!0;if(e==(n<0?0:Mt(r))){let o=r.parentNode;if(!o||o.nodeType!=1||Kn(r)||Pw.test(r.nodeName)||r.contentEditable=="false")return!1;e=Qe(r)+(n<0?0:1),r=o}else if(r.nodeType==1){let o=r.childNodes[e+(n<0?-1:0)];if(o.nodeType==1&&o.contentEditable=="false")if(!((i=o.pmViewDesc)===null||i===void 0)&&i.ignoreForSelection)e+=n;else return!1;else r=o,e=n<0?Mt(r):0}else return!1}}function Mt(r){return r.nodeType==3?r.nodeValue.length:r.childNodes.length}function Lw(r,e){for(;;){if(r.nodeType==3&&e)return r;if(r.nodeType==1&&e>0){if(r.contentEditable=="false")return null;r=r.childNodes[e-1],e=Mt(r)}else if(r.parentNode&&!Kn(r))e=Qe(r),r=r.parentNode;else return null}}function $w(r,e){for(;;){if(r.nodeType==3&&e<r.nodeValue.length)return r;if(r.nodeType==1&&e<r.childNodes.length){if(r.contentEditable=="false")return null;r=r.childNodes[e],e=0}else if(r.parentNode&&!Kn(r))e=Qe(r)+1,r=r.parentNode;else return null}}function _w(r,e,t){for(let s=e==0,n=e==Mt(r);s||n;){if(r==t)return!0;let i=Qe(r);if(r=r.parentNode,!r)return!1;s=s&&i==0,n=n&&i==Mt(r)}}function Kn(r){let e;for(let t=r;t&&!(e=t.pmViewDesc);t=t.parentNode);return e&&e.node&&e.node.isBlock&&(e.dom==r||e.contentDOM==r)}const Ho=function(r){return r.focusNode&&gs(r.focusNode,r.focusOffset,r.anchorNode,r.anchorOffset)};function qr(r,e){let t=document.createEvent("Event");return t.initEvent("keydown",!0,!0),t.keyCode=r,t.key=t.code=e,t}function Fw(r){let e=r.activeElement;for(;e&&e.shadowRoot;)e=e.shadowRoot.activeElement;return e}function Bw(r,e,t){if(r.caretPositionFromPoint)try{let s=r.caretPositionFromPoint(e,t);if(s)return{node:s.offsetNode,offset:Math.min(Mt(s.offsetNode),s.offset)}}catch{}if(r.caretRangeFromPoint){let s=r.caretRangeFromPoint(e,t);if(s)return{node:s.startContainer,offset:Math.min(Mt(s.startContainer),s.startOffset)}}}const Vt=typeof navigator<"u"?navigator:null,Cd=typeof document<"u"?document:null,$r=Vt&&Vt.userAgent||"",dl=/Edge\/(\d+)/.exec($r),Hf=/MSIE \d/.exec($r),ul=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec($r),xt=!!(Hf||ul||dl),Mr=Hf?document.documentMode:ul?+ul[1]:dl?+dl[1]:0,Pt=!xt&&/gecko\/(\d+)/i.test($r);Pt&&+(/Firefox\/(\d+)/.exec($r)||[0,0])[1];const hl=!xt&&/Chrome\/(\d+)/.exec($r),st=!!hl,Vf=hl?+hl[1]:0,lt=!xt&&!!Vt&&/Apple Computer/.test(Vt.vendor),Vs=lt&&(/Mobile\/\w+/.test($r)||!!Vt&&Vt.maxTouchPoints>2),Ct=Vs||(Vt?/Mac/.test(Vt.platform):!1),Uw=Vt?/Win/.test(Vt.platform):!1,rr=/Android \d/.test($r),Gn=!!Cd&&"webkitFontSmoothing"in Cd.documentElement.style,zw=Gn?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0;function Ww(r){let e=r.defaultView&&r.defaultView.visualViewport;return e?{left:0,right:e.width,top:0,bottom:e.height}:{left:0,right:r.documentElement.clientWidth,top:0,bottom:r.documentElement.clientHeight}}function Xt(r,e){return typeof r=="number"?r:r[e]}function Hw(r){let e=r.getBoundingClientRect(),t=e.width/r.offsetWidth||1,s=e.height/r.offsetHeight||1;return{left:e.left,right:e.left+r.clientWidth*t,top:e.top,bottom:e.top+r.clientHeight*s}}function Md(r,e,t){let s=r.someProp("scrollThreshold")||0,n=r.someProp("scrollMargin")||5,i=r.dom.ownerDocument;for(let o=t||r.dom;o;){if(o.nodeType!=1){o=Hs(o);continue}let l=o,c=l==i.body,d=c?Ww(i):Hw(l),u=0,h=0;if(e.top<d.top+Xt(s,"top")?h=-(d.top-e.top+Xt(n,"top")):e.bottom>d.bottom-Xt(s,"bottom")&&(h=e.bottom-e.top>d.bottom-d.top?e.top+Xt(n,"top")-d.top:e.bottom-d.bottom+Xt(n,"bottom")),e.left<d.left+Xt(s,"left")?u=-(d.left-e.left+Xt(n,"left")):e.right>d.right-Xt(s,"right")&&(u=e.right-d.right+Xt(n,"right")),u||h)if(c)i.defaultView.scrollBy(u,h);else{let p=l.scrollLeft,m=l.scrollTop;h&&(l.scrollTop+=h),u&&(l.scrollLeft+=u);let g=l.scrollLeft-p,y=l.scrollTop-m;e={left:e.left-g,top:e.top-y,right:e.right-g,bottom:e.bottom-y}}let f=c?"fixed":getComputedStyle(o).position;if(/^(fixed|sticky)$/.test(f))break;o=f=="absolute"?o.offsetParent:Hs(o)}}function Vw(r){let e=r.dom.getBoundingClientRect(),t=Math.max(0,e.top),s,n;for(let i=(e.left+e.right)/2,o=t+1;o<Math.min(innerHeight,e.bottom);o+=5){let l=r.root.elementFromPoint(i,o);if(!l||l==r.dom||!r.dom.contains(l))continue;let c=l.getBoundingClientRect();if(c.top>=t-20){s=l,n=c.top;break}}return{refDOM:s,refTop:n,stack:qf(r.dom)}}function qf(r){let e=[],t=r.ownerDocument;for(let s=r;s&&(e.push({dom:s,top:s.scrollTop,left:s.scrollLeft}),r!=t);s=Hs(s));return e}function qw({refDOM:r,refTop:e,stack:t}){let s=r?r.getBoundingClientRect().top:0;Kf(t,s==0?0:s-e)}function Kf(r,e){for(let t=0;t<r.length;t++){let{dom:s,top:n,left:i}=r[t];s.scrollTop!=n+e&&(s.scrollTop=n+e),s.scrollLeft!=i&&(s.scrollLeft=i)}}let Cs=null;function Kw(r){if(r.setActive)return r.setActive();if(Cs)return r.focus(Cs);let e=qf(r);r.focus(Cs==null?{get preventScroll(){return Cs={preventScroll:!0},!0}}:void 0),Cs||(Cs=!1,Kf(e,0))}function Gf(r,e){let t,s=2e8,n,i=0,o=e.top,l=e.top,c,d;for(let u=r.firstChild,h=0;u;u=u.nextSibling,h++){let f;if(u.nodeType==1)f=u.getClientRects();else if(u.nodeType==3)f=tr(u).getClientRects();else continue;for(let p=0;p<f.length;p++){let m=f[p];if(m.top<=o&&m.bottom>=l){o=Math.max(m.bottom,o),l=Math.min(m.top,l);let g=m.left>e.left?m.left-e.left:m.right<e.left?e.left-m.right:0;if(g<s){t=u,s=g,n=g&&t.nodeType==3?{left:m.right<e.left?m.right:m.left,top:e.top}:e,u.nodeType==1&&g&&(i=h+(e.left>=(m.left+m.right)/2?1:0));continue}}else m.top>e.top&&!c&&m.left<=e.left&&m.right>=e.left&&(c=u,d={left:Math.max(m.left,Math.min(m.right,e.left)),top:m.top});!t&&(e.left>=m.right&&e.top>=m.top||e.left>=m.left&&e.top>=m.bottom)&&(i=h+1)}}return!t&&c&&(t=c,n=d,s=0),t&&t.nodeType==3?Gw(t,n):!t||s&&t.nodeType==1?{node:r,offset:i}:Gf(t,n)}function Gw(r,e){let t=r.nodeValue.length,s=document.createRange();for(let n=0;n<t;n++){s.setEnd(r,n+1),s.setStart(r,n);let i=hr(s,1);if(i.top!=i.bottom&&nc(e,i))return{node:r,offset:n+(e.left>=(i.left+i.right)/2?1:0)}}return{node:r,offset:0}}function nc(r,e){return r.left>=e.left-1&&r.left<=e.right+1&&r.top>=e.top-1&&r.top<=e.bottom+1}function Yw(r,e){let t=r.parentNode;return t&&/^li$/i.test(t.nodeName)&&e.left<r.getBoundingClientRect().left?t:r}function Jw(r,e,t){let{node:s,offset:n}=Gf(e,t),i=-1;if(s.nodeType==1&&!s.firstChild){let o=s.getBoundingClientRect();i=o.left!=o.right&&t.left>(o.left+o.right)/2?1:-1}return r.docView.posFromDOM(s,n,i)}function Xw(r,e,t,s){let n=-1;for(let i=e,o=!1;i!=r.dom;){let l=r.docView.nearestDesc(i,!0),c;if(!l)return null;if(l.dom.nodeType==1&&(l.node.isBlock&&l.parent||!l.contentDOM)&&((c=l.dom.getBoundingClientRect()).width||c.height)&&(l.node.isBlock&&l.parent&&(!o&&c.left>s.left||c.top>s.top?n=l.posBefore:(!o&&c.right<s.left||c.bottom<s.top)&&(n=l.posAfter),o=!0),!l.contentDOM&&n<0&&!l.node.isText))return(l.node.isBlock?s.top<(c.top+c.bottom)/2:s.left<(c.left+c.right)/2)?l.posBefore:l.posAfter;i=l.dom.parentNode}return n>-1?n:r.docView.posFromDOM(e,t,-1)}function Yf(r,e,t){let s=r.childNodes.length;if(s&&t.top<t.bottom)for(let n=Math.max(0,Math.min(s-1,Math.floor(s*(e.top-t.top)/(t.bottom-t.top))-2)),i=n;;){let o=r.childNodes[i];if(o.nodeType==1){let l=o.getClientRects();for(let c=0;c<l.length;c++){let d=l[c];if(nc(e,d))return Yf(o,e,d)}}if((i=(i+1)%s)==n)break}return r}function Qw(r,e){let t=r.dom.ownerDocument,s,n=0,i=Bw(t,e.left,e.top);i&&({node:s,offset:n}=i);let o=(r.root.elementFromPoint?r.root:t).elementFromPoint(e.left,e.top),l;if(!o||!r.dom.contains(o.nodeType!=1?o.parentNode:o)){let d=r.dom.getBoundingClientRect();if(!nc(e,d)||(o=Yf(r.dom,e,d),!o))return null}if(lt)for(let d=o;s&&d;d=Hs(d))d.draggable&&(s=void 0);if(o=Yw(o,e),s){if(Pt&&s.nodeType==1&&(n=Math.min(n,s.childNodes.length),n<s.childNodes.length)){let u=s.childNodes[n],h;u.nodeName=="IMG"&&(h=u.getBoundingClientRect()).right<=e.left&&h.bottom>e.top&&n++}let d;Gn&&n&&s.nodeType==1&&(d=s.childNodes[n-1]).nodeType==1&&d.contentEditable=="false"&&d.getBoundingClientRect().top>=e.top&&n--,s==r.dom&&n==s.childNodes.length-1&&s.lastChild.nodeType==1&&e.top>s.lastChild.getBoundingClientRect().bottom?l=r.state.doc.content.size:(n==0||s.nodeType!=1||s.childNodes[n-1].nodeName!="BR")&&(l=Xw(r,s,n,e))}l==null&&(l=Jw(r,o,e));let c=r.docView.nearestDesc(o,!0);return{pos:l,inside:c?c.posAtStart-c.border:-1}}function Dd(r){return r.top<r.bottom||r.left<r.right}function hr(r,e){let t=r.getClientRects();if(t.length){let s=t[e<0?0:t.length-1];if(Dd(s))return s}return Array.prototype.find.call(t,Dd)||r.getBoundingClientRect()}const Zw=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;function Jf(r,e,t){let{node:s,offset:n,atom:i}=r.docView.domFromPos(e,t<0?-1:1),o=Gn||Pt;if(s.nodeType==3)if(o&&(Zw.test(s.nodeValue)||(t<0?!n:n==s.nodeValue.length))){let c=hr(tr(s,n,n),t);if(Pt&&n&&/\s/.test(s.nodeValue[n-1])&&n<s.nodeValue.length){let d=hr(tr(s,n-1,n-1),-1);if(d.top==c.top){let u=hr(tr(s,n,n+1),-1);if(u.top!=c.top)return on(u,u.left<d.left)}}return c}else{let c=n,d=n,u=t<0?1:-1;return t<0&&!n?(d++,u=-1):t>=0&&n==s.nodeValue.length?(c--,u=1):t<0?c--:d++,on(hr(tr(s,c,d),u),u<0)}if(!r.state.doc.resolve(e-(i||0)).parent.inlineContent){if(i==null&&n&&(t<0||n==Mt(s))){let c=s.childNodes[n-1];if(c.nodeType==1)return ya(c.getBoundingClientRect(),!1)}if(i==null&&n<Mt(s)){let c=s.childNodes[n];if(c.nodeType==1)return ya(c.getBoundingClientRect(),!0)}return ya(s.getBoundingClientRect(),t>=0)}if(i==null&&n&&(t<0||n==Mt(s))){let c=s.childNodes[n-1],d=c.nodeType==3?tr(c,Mt(c)-(o?0:1)):c.nodeType==1&&(c.nodeName!="BR"||!c.nextSibling)?c:null;if(d)return on(hr(d,1),!1)}if(i==null&&n<Mt(s)){let c=s.childNodes[n];for(;c.pmViewDesc&&c.pmViewDesc.ignoreForCoords;)c=c.nextSibling;let d=c?c.nodeType==3?tr(c,0,o?0:1):c.nodeType==1?c:null:null;if(d)return on(hr(d,-1),!0)}return on(hr(s.nodeType==3?tr(s):s,-t),t>=0)}function on(r,e){if(r.width==0)return r;let t=e?r.left:r.right;return{top:r.top,bottom:r.bottom,left:t,right:t}}function ya(r,e){if(r.height==0)return r;let t=e?r.top:r.bottom;return{top:t,bottom:t,left:r.left,right:r.right}}function Xf(r,e,t){let s=r.state,n=r.root.activeElement;s!=e&&r.updateState(e),n!=r.dom&&r.focus();try{return t()}finally{s!=e&&r.updateState(s),n!=r.dom&&n&&n.focus()}}function ev(r,e,t){let s=e.selection,n=t=="up"?s.$from:s.$to;return Xf(r,e,()=>{let{node:i}=r.docView.domFromPos(n.pos,t=="up"?-1:1);for(;;){let l=r.docView.nearestDesc(i,!0);if(!l)break;if(l.node.isBlock){i=l.contentDOM||l.dom;break}i=l.dom.parentNode}let o=Jf(r,n.pos,1);for(let l=i.firstChild;l;l=l.nextSibling){let c;if(l.nodeType==1)c=l.getClientRects();else if(l.nodeType==3)c=tr(l,0,l.nodeValue.length).getClientRects();else continue;for(let d=0;d<c.length;d++){let u=c[d];if(u.bottom>u.top+1&&(t=="up"?o.top-u.top>(u.bottom-o.top)*2:u.bottom-o.bottom>(o.bottom-u.top)*2))return!1}}return!0})}const tv=/[\u0590-\u08ac]/;function rv(r,e,t){let{$head:s}=e.selection;if(!s.parent.isTextblock)return!1;let n=s.parentOffset,i=!n,o=n==s.parent.content.size,l=r.domSelection();return l?!tv.test(s.parent.textContent)||!l.modify?t=="left"||t=="backward"?i:o:Xf(r,e,()=>{let{focusNode:c,focusOffset:d,anchorNode:u,anchorOffset:h}=r.domSelectionRange(),f=l.caretBidiLevel;l.modify("move",t,"character");let p=s.depth?r.docView.domAfterPos(s.before()):r.dom,{focusNode:m,focusOffset:g}=r.domSelectionRange(),y=m&&!p.contains(m.nodeType==1?m:m.parentNode)||c==m&&d==g;try{l.collapse(u,h),c&&(c!=u||d!=h)&&l.extend&&l.extend(c,d)}catch{}return f!=null&&(l.caretBidiLevel=f),y}):s.pos==s.start()||s.pos==s.end()}let Td=null,Od=null,Rd=!1;function sv(r,e,t){return Td==e&&Od==t?Rd:(Td=e,Od=t,Rd=t=="up"||t=="down"?ev(r,e,t):rv(r,e,t))}const Dt=0,Id=1,Zr=2,qt=3;class Yn{constructor(e,t,s,n){this.parent=e,this.children=t,this.dom=s,this.contentDOM=n,this.dirty=Dt,s.pmViewDesc=this}matchesWidget(e){return!1}matchesMark(e){return!1}matchesNode(e,t,s){return!1}matchesHack(e){return!1}parseRule(){return null}stopEvent(e){return!1}get size(){let e=0;for(let t=0;t<this.children.length;t++)e+=this.children[t].size;return e}get border(){return 0}destroy(){this.parent=void 0,this.dom.pmViewDesc==this&&(this.dom.pmViewDesc=void 0);for(let e=0;e<this.children.length;e++)this.children[e].destroy()}posBeforeChild(e){for(let t=0,s=this.posAtStart;;t++){let n=this.children[t];if(n==e)return s;s+=n.size}}get posBefore(){return this.parent.posBeforeChild(this)}get posAtStart(){return this.parent?this.parent.posBeforeChild(this)+this.border:0}get posAfter(){return this.posBefore+this.size}get posAtEnd(){return this.posAtStart+this.size-2*this.border}localPosFromDOM(e,t,s){if(this.contentDOM&&this.contentDOM.contains(e.nodeType==1?e:e.parentNode))if(s<0){let i,o;if(e==this.contentDOM)i=e.childNodes[t-1];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;i=e.previousSibling}for(;i&&!((o=i.pmViewDesc)&&o.parent==this);)i=i.previousSibling;return i?this.posBeforeChild(o)+o.size:this.posAtStart}else{let i,o;if(e==this.contentDOM)i=e.childNodes[t];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;i=e.nextSibling}for(;i&&!((o=i.pmViewDesc)&&o.parent==this);)i=i.nextSibling;return i?this.posBeforeChild(o):this.posAtEnd}let n;if(e==this.dom&&this.contentDOM)n=t>Qe(this.contentDOM);else if(this.contentDOM&&this.contentDOM!=this.dom&&this.dom.contains(this.contentDOM))n=e.compareDocumentPosition(this.contentDOM)&2;else if(this.dom.firstChild){if(t==0)for(let i=e;;i=i.parentNode){if(i==this.dom){n=!1;break}if(i.previousSibling)break}if(n==null&&t==e.childNodes.length)for(let i=e;;i=i.parentNode){if(i==this.dom){n=!0;break}if(i.nextSibling)break}}return n??s>0?this.posAtEnd:this.posAtStart}nearestDesc(e,t=!1){for(let s=!0,n=e;n;n=n.parentNode){let i=this.getDesc(n),o;if(i&&(!t||i.node))if(s&&(o=i.nodeDOM)&&!(o.nodeType==1?o.contains(e.nodeType==1?e:e.parentNode):o==e))s=!1;else return i}}getDesc(e){let t=e.pmViewDesc;for(let s=t;s;s=s.parent)if(s==this)return t}posFromDOM(e,t,s){for(let n=e;n;n=n.parentNode){let i=this.getDesc(n);if(i)return i.localPosFromDOM(e,t,s)}return-1}descAt(e){for(let t=0,s=0;t<this.children.length;t++){let n=this.children[t],i=s+n.size;if(s==e&&i!=s){for(;!n.border&&n.children.length;)for(let o=0;o<n.children.length;o++){let l=n.children[o];if(l.size){n=l;break}}return n}if(e<i)return n.descAt(e-s-n.border);s=i}}domFromPos(e,t){if(!this.contentDOM)return{node:this.dom,offset:0,atom:e+1};let s=0,n=0;for(let i=0;s<this.children.length;s++){let o=this.children[s],l=i+o.size;if(l>e||o instanceof Zf){n=e-i;break}i=l}if(n)return this.children[s].domFromPos(n-this.children[s].border,t);for(let i;s&&!(i=this.children[s-1]).size&&i instanceof Qf&&i.side>=0;s--);if(t<=0){let i,o=!0;for(;i=s?this.children[s-1]:null,!(!i||i.dom.parentNode==this.contentDOM);s--,o=!1);return i&&t&&o&&!i.border&&!i.domAtom?i.domFromPos(i.size,t):{node:this.contentDOM,offset:i?Qe(i.dom)+1:0}}else{let i,o=!0;for(;i=s<this.children.length?this.children[s]:null,!(!i||i.dom.parentNode==this.contentDOM);s++,o=!1);return i&&o&&!i.border&&!i.domAtom?i.domFromPos(0,t):{node:this.contentDOM,offset:i?Qe(i.dom):this.contentDOM.childNodes.length}}}parseRange(e,t,s=0){if(this.children.length==0)return{node:this.contentDOM,from:e,to:t,fromOffset:0,toOffset:this.contentDOM.childNodes.length};let n=-1,i=-1;for(let o=s,l=0;;l++){let c=this.children[l],d=o+c.size;if(n==-1&&e<=d){let u=o+c.border;if(e>=u&&t<=d-c.border&&c.node&&c.contentDOM&&this.contentDOM.contains(c.contentDOM))return c.parseRange(e,t,u);e=o;for(let h=l;h>0;h--){let f=this.children[h-1];if(f.size&&f.dom.parentNode==this.contentDOM&&!f.emptyChildAt(1)){n=Qe(f.dom)+1;break}e-=f.size}n==-1&&(n=0)}if(n>-1&&(d>t||l==this.children.length-1)){t=d;for(let u=l+1;u<this.children.length;u++){let h=this.children[u];if(h.size&&h.dom.parentNode==this.contentDOM&&!h.emptyChildAt(-1)){i=Qe(h.dom);break}t+=h.size}i==-1&&(i=this.contentDOM.childNodes.length);break}o=d}return{node:this.contentDOM,from:e,to:t,fromOffset:n,toOffset:i}}emptyChildAt(e){if(this.border||!this.contentDOM||!this.children.length)return!1;let t=this.children[e<0?0:this.children.length-1];return t.size==0||t.emptyChildAt(e)}domAfterPos(e){let{node:t,offset:s}=this.domFromPos(e,0);if(t.nodeType!=1||s==t.childNodes.length)throw new RangeError("No node after pos "+e);return t.childNodes[s]}setSelection(e,t,s,n=!1){let i=Math.min(e,t),o=Math.max(e,t);for(let p=0,m=0;p<this.children.length;p++){let g=this.children[p],y=m+g.size;if(i>m&&o<y)return g.setSelection(e-m-g.border,t-m-g.border,s,n);m=y}let l=this.domFromPos(e,e?-1:1),c=t==e?l:this.domFromPos(t,t?-1:1),d=s.root.getSelection(),u=s.domSelectionRange(),h=!1;if((Pt||lt)&&e==t){let{node:p,offset:m}=l;if(p.nodeType==3){if(h=!!(m&&p.nodeValue[m-1]==`
`),h&&m==p.nodeValue.length)for(let g=p,y;g;g=g.parentNode){if(y=g.nextSibling){y.nodeName=="BR"&&(l=c={node:y.parentNode,offset:Qe(y)+1});break}let x=g.pmViewDesc;if(x&&x.node&&x.node.isBlock)break}}else{let g=p.childNodes[m-1];h=g&&(g.nodeName=="BR"||g.contentEditable=="false")}}if(Pt&&u.focusNode&&u.focusNode!=c.node&&u.focusNode.nodeType==1){let p=u.focusNode.childNodes[u.focusOffset];p&&p.contentEditable=="false"&&(n=!0)}if(!(n||h&&lt)&&gs(l.node,l.offset,u.anchorNode,u.anchorOffset)&&gs(c.node,c.offset,u.focusNode,u.focusOffset))return;let f=!1;if((d.extend||e==t)&&!h){d.collapse(l.node,l.offset);try{e!=t&&d.extend(c.node,c.offset),f=!0}catch{}}if(!f){if(e>t){let m=l;l=c,c=m}let p=document.createRange();p.setEnd(c.node,c.offset),p.setStart(l.node,l.offset),d.removeAllRanges(),d.addRange(p)}}ignoreMutation(e){return!this.contentDOM&&e.type!="selection"}get contentLost(){return this.contentDOM&&this.contentDOM!=this.dom&&!this.dom.contains(this.contentDOM)}markDirty(e,t){for(let s=0,n=0;n<this.children.length;n++){let i=this.children[n],o=s+i.size;if(s==o?e<=o&&t>=s:e<o&&t>s){let l=s+i.border,c=o-i.border;if(e>=l&&t<=c){this.dirty=e==s||t==o?Zr:Id,e==l&&t==c&&(i.contentLost||i.dom.parentNode!=this.contentDOM)?i.dirty=qt:i.markDirty(e-l,t-l);return}else i.dirty=i.dom==i.contentDOM&&i.dom.parentNode==this.contentDOM&&!i.children.length?Zr:qt}s=o}this.dirty=Zr}markParentsDirty(){let e=1;for(let t=this.parent;t;t=t.parent,e++){let s=e==1?Zr:Id;t.dirty<s&&(t.dirty=s)}}get domAtom(){return!1}get ignoreForCoords(){return!1}get ignoreForSelection(){return!1}isText(e){return!1}}class Qf extends Yn{constructor(e,t,s,n){let i,o=t.type.toDOM;if(typeof o=="function"&&(o=o(s,()=>{if(!i)return n;if(i.parent)return i.parent.posBeforeChild(i)})),!t.type.spec.raw){if(o.nodeType!=1){let l=document.createElement("span");l.appendChild(o),o=l}o.contentEditable="false",o.classList.add("ProseMirror-widget")}super(e,[],o,null),this.widget=t,this.widget=t,i=this}matchesWidget(e){return this.dirty==Dt&&e.type.eq(this.widget.type)}parseRule(){return{ignore:!0}}stopEvent(e){let t=this.widget.spec.stopEvent;return t?t(e):!1}ignoreMutation(e){return e.type!="selection"||this.widget.spec.ignoreSelection}destroy(){this.widget.type.destroy(this.dom),super.destroy()}get domAtom(){return!0}get ignoreForSelection(){return!!this.widget.type.spec.relaxedSide}get side(){return this.widget.type.side}}class nv extends Yn{constructor(e,t,s,n){super(e,[],t,null),this.textDOM=s,this.text=n}get size(){return this.text.length}localPosFromDOM(e,t){return e!=this.textDOM?this.posAtStart+(t?this.size:0):this.posAtStart+t}domFromPos(e){return{node:this.textDOM,offset:e}}ignoreMutation(e){return e.type==="characterData"&&e.target.nodeValue==e.oldValue}}class xs extends Yn{constructor(e,t,s,n,i){super(e,[],s,n),this.mark=t,this.spec=i}static create(e,t,s,n){let i=n.nodeViews[t.type.name],o=i&&i(t,n,s);return(!o||!o.dom)&&(o=js.renderSpec(document,t.type.spec.toDOM(t,s),null,t.attrs)),new xs(e,t,o.dom,o.contentDOM||o.dom,o)}parseRule(){return this.dirty&qt||this.mark.type.spec.reparseInView?null:{mark:this.mark.type.name,attrs:this.mark.attrs,contentElement:this.contentDOM}}matchesMark(e){return this.dirty!=qt&&this.mark.eq(e)}markDirty(e,t){if(super.markDirty(e,t),this.dirty!=Dt){let s=this.parent;for(;!s.node;)s=s.parent;s.dirty<this.dirty&&(s.dirty=this.dirty),this.dirty=Dt}}slice(e,t,s){let n=xs.create(this.parent,this.mark,!0,s),i=this.children,o=this.size;t<o&&(i=pl(i,t,o,s)),e>0&&(i=pl(i,0,e,s));for(let l=0;l<i.length;l++)i[l].parent=n;return n.children=i,n}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}}class Dr extends Yn{constructor(e,t,s,n,i,o,l,c,d){super(e,[],i,o),this.node=t,this.outerDeco=s,this.innerDeco=n,this.nodeDOM=l}static create(e,t,s,n,i,o){let l=i.nodeViews[t.type.name],c,d=l&&l(t,i,()=>{if(!c)return o;if(c.parent)return c.parent.posBeforeChild(c)},s,n),u=d&&d.dom,h=d&&d.contentDOM;if(t.isText){if(!u)u=document.createTextNode(t.text);else if(u.nodeType!=3)throw new RangeError("Text must be rendered as a DOM text node")}else u||({dom:u,contentDOM:h}=js.renderSpec(document,t.type.spec.toDOM(t),null,t.attrs));!h&&!t.isText&&u.nodeName!="BR"&&(u.hasAttribute("contenteditable")||(u.contentEditable="false"),t.type.spec.draggable&&(u.draggable=!0));let f=u;return u=rp(u,s,t),d?c=new iv(e,t,s,n,u,h||null,f,d,i,o+1):t.isText?new Vo(e,t,s,n,u,f,i):new Dr(e,t,s,n,u,h||null,f,i,o+1)}parseRule(){if(this.node.type.spec.reparseInView)return null;let e={node:this.node.type.name,attrs:this.node.attrs};if(this.node.type.whitespace=="pre"&&(e.preserveWhitespace="full"),!this.contentDOM)e.getContent=()=>this.node.content;else if(!this.contentLost)e.contentElement=this.contentDOM;else{for(let t=this.children.length-1;t>=0;t--){let s=this.children[t];if(this.dom.contains(s.dom.parentNode)){e.contentElement=s.dom.parentNode;break}}e.contentElement||(e.getContent=()=>z.empty)}return e}matchesNode(e,t,s){return this.dirty==Dt&&e.eq(this.node)&&Hi(t,this.outerDeco)&&s.eq(this.innerDeco)}get size(){return this.node.nodeSize}get border(){return this.node.isLeaf?0:1}updateChildren(e,t){let s=this.node.inlineContent,n=t,i=e.composing?this.localCompositionInfo(e,t):null,o=i&&i.pos>-1?i:null,l=i&&i.pos<0,c=new av(this,o&&o.node,e);dv(this.node,this.innerDeco,(d,u,h)=>{d.spec.marks?c.syncToMarks(d.spec.marks,s,e):d.type.side>=0&&!h&&c.syncToMarks(u==this.node.childCount?Ae.none:this.node.child(u).marks,s,e),c.placeWidget(d,e,n)},(d,u,h,f)=>{c.syncToMarks(d.marks,s,e);let p;c.findNodeMatch(d,u,h,f)||l&&e.state.selection.from>n&&e.state.selection.to<n+d.nodeSize&&(p=c.findIndexWithChild(i.node))>-1&&c.updateNodeAt(d,u,h,p,e)||c.updateNextNode(d,u,h,e,f,n)||c.addNode(d,u,h,e,n),n+=d.nodeSize}),c.syncToMarks([],s,e),this.node.isTextblock&&c.addTextblockHacks(),c.destroyRest(),(c.changed||this.dirty==Zr)&&(o&&this.protectLocalComposition(e,o),ep(this.contentDOM,this.children,e),Vs&&uv(this.dom))}localCompositionInfo(e,t){let{from:s,to:n}=e.state.selection;if(!(e.state.selection instanceof ce)||s<t||n>t+this.node.content.size)return null;let i=e.input.compositionNode;if(!i||!this.dom.contains(i.parentNode))return null;if(this.node.inlineContent){let o=i.nodeValue,l=hv(this.node.content,o,s-t,n-t);return l<0?null:{node:i,pos:l,text:o}}else return{node:i,pos:-1,text:""}}protectLocalComposition(e,{node:t,pos:s,text:n}){if(this.getDesc(t))return;let i=t;for(;i.parentNode!=this.contentDOM;i=i.parentNode){for(;i.previousSibling;)i.parentNode.removeChild(i.previousSibling);for(;i.nextSibling;)i.parentNode.removeChild(i.nextSibling);i.pmViewDesc&&(i.pmViewDesc=void 0)}let o=new nv(this,i,t,n);e.input.compositionNodes.push(o),this.children=pl(this.children,s,s+n.length,e,o)}update(e,t,s,n){return this.dirty==qt||!e.sameMarkup(this.node)?!1:(this.updateInner(e,t,s,n),!0)}updateInner(e,t,s,n){this.updateOuterDeco(t),this.node=e,this.innerDeco=s,this.contentDOM&&this.updateChildren(n,this.posAtStart),this.dirty=Dt}updateOuterDeco(e){if(Hi(e,this.outerDeco))return;let t=this.nodeDOM.nodeType!=1,s=this.dom;this.dom=tp(this.dom,this.nodeDOM,fl(this.outerDeco,this.node,t),fl(e,this.node,t)),this.dom!=s&&(s.pmViewDesc=void 0,this.dom.pmViewDesc=this),this.outerDeco=e}selectNode(){this.nodeDOM.nodeType==1&&this.nodeDOM.classList.add("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&(this.dom.draggable=!0)}deselectNode(){this.nodeDOM.nodeType==1&&(this.nodeDOM.classList.remove("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&this.dom.removeAttribute("draggable"))}get domAtom(){return this.node.isAtom}}function Pd(r,e,t,s,n){rp(s,e,r);let i=new Dr(void 0,r,e,t,s,s,s,n,0);return i.contentDOM&&i.updateChildren(n,0),i}class Vo extends Dr{constructor(e,t,s,n,i,o,l){super(e,t,s,n,i,null,o,l,0)}parseRule(){let e=this.nodeDOM.parentNode;for(;e&&e!=this.dom&&!e.pmIsDeco;)e=e.parentNode;return{skip:e||!0}}update(e,t,s,n){return this.dirty==qt||this.dirty!=Dt&&!this.inParent()||!e.sameMarkup(this.node)?!1:(this.updateOuterDeco(t),(this.dirty!=Dt||e.text!=this.node.text)&&e.text!=this.nodeDOM.nodeValue&&(this.nodeDOM.nodeValue=e.text,n.trackWrites==this.nodeDOM&&(n.trackWrites=null)),this.node=e,this.dirty=Dt,!0)}inParent(){let e=this.parent.contentDOM;for(let t=this.nodeDOM;t;t=t.parentNode)if(t==e)return!0;return!1}domFromPos(e){return{node:this.nodeDOM,offset:e}}localPosFromDOM(e,t,s){return e==this.nodeDOM?this.posAtStart+Math.min(t,this.node.text.length):super.localPosFromDOM(e,t,s)}ignoreMutation(e){return e.type!="characterData"&&e.type!="selection"}slice(e,t,s){let n=this.node.cut(e,t),i=document.createTextNode(n.text);return new Vo(this.parent,n,this.outerDeco,this.innerDeco,i,i,s)}markDirty(e,t){super.markDirty(e,t),this.dom!=this.nodeDOM&&(e==0||t==this.nodeDOM.nodeValue.length)&&(this.dirty=qt)}get domAtom(){return!1}isText(e){return this.node.text==e}}class Zf extends Yn{parseRule(){return{ignore:!0}}matchesHack(e){return this.dirty==Dt&&this.dom.nodeName==e}get domAtom(){return!0}get ignoreForCoords(){return this.dom.nodeName=="IMG"}}class iv extends Dr{constructor(e,t,s,n,i,o,l,c,d,u){super(e,t,s,n,i,o,l,d,u),this.spec=c}update(e,t,s,n){if(this.dirty==qt)return!1;if(this.spec.update&&(this.node.type==e.type||this.spec.multiType)){let i=this.spec.update(e,t,s);return i&&this.updateInner(e,t,s,n),i}else return!this.contentDOM&&!e.isLeaf?!1:super.update(e,t,s,n)}selectNode(){this.spec.selectNode?this.spec.selectNode():super.selectNode()}deselectNode(){this.spec.deselectNode?this.spec.deselectNode():super.deselectNode()}setSelection(e,t,s,n){this.spec.setSelection?this.spec.setSelection(e,t,s.root):super.setSelection(e,t,s,n)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}stopEvent(e){return this.spec.stopEvent?this.spec.stopEvent(e):!1}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}}function ep(r,e,t){let s=r.firstChild,n=!1;for(let i=0;i<e.length;i++){let o=e[i],l=o.dom;if(l.parentNode==r){for(;l!=s;)s=Ld(s),n=!0;s=s.nextSibling}else n=!0,r.insertBefore(l,s);if(o instanceof xs){let c=s?s.previousSibling:r.lastChild;ep(o.contentDOM,o.children,t),s=c?c.nextSibling:r.firstChild}}for(;s;)s=Ld(s),n=!0;n&&t.trackWrites==r&&(t.trackWrites=null)}const gn=function(r){r&&(this.nodeName=r)};gn.prototype=Object.create(null);const es=[new gn];function fl(r,e,t){if(r.length==0)return es;let s=t?es[0]:new gn,n=[s];for(let i=0;i<r.length;i++){let o=r[i].type.attrs;if(o){o.nodeName&&n.push(s=new gn(o.nodeName));for(let l in o){let c=o[l];c!=null&&(t&&n.length==1&&n.push(s=new gn(e.isInline?"span":"div")),l=="class"?s.class=(s.class?s.class+" ":"")+c:l=="style"?s.style=(s.style?s.style+";":"")+c:l!="nodeName"&&(s[l]=c))}}}return n}function tp(r,e,t,s){if(t==es&&s==es)return e;let n=e;for(let i=0;i<s.length;i++){let o=s[i],l=t[i];if(i){let c;l&&l.nodeName==o.nodeName&&n!=r&&(c=n.parentNode)&&c.nodeName.toLowerCase()==o.nodeName||(c=document.createElement(o.nodeName),c.pmIsDeco=!0,c.appendChild(n),l=es[0]),n=c}ov(n,l||es[0],o)}return n}function ov(r,e,t){for(let s in e)s!="class"&&s!="style"&&s!="nodeName"&&!(s in t)&&r.removeAttribute(s);for(let s in t)s!="class"&&s!="style"&&s!="nodeName"&&t[s]!=e[s]&&r.setAttribute(s,t[s]);if(e.class!=t.class){let s=e.class?e.class.split(" ").filter(Boolean):[],n=t.class?t.class.split(" ").filter(Boolean):[];for(let i=0;i<s.length;i++)n.indexOf(s[i])==-1&&r.classList.remove(s[i]);for(let i=0;i<n.length;i++)s.indexOf(n[i])==-1&&r.classList.add(n[i]);r.classList.length==0&&r.removeAttribute("class")}if(e.style!=t.style){if(e.style){let s=/\s*([\w\-\xa1-\uffff]+)\s*:(?:"(?:\\.|[^"])*"|'(?:\\.|[^'])*'|\(.*?\)|[^;])*/g,n;for(;n=s.exec(e.style);)r.style.removeProperty(n[1])}t.style&&(r.style.cssText+=t.style)}}function rp(r,e,t){return tp(r,r,es,fl(e,t,r.nodeType!=1))}function Hi(r,e){if(r.length!=e.length)return!1;for(let t=0;t<r.length;t++)if(!r[t].type.eq(e[t].type))return!1;return!0}function Ld(r){let e=r.nextSibling;return r.parentNode.removeChild(r),e}class av{constructor(e,t,s){this.lock=t,this.view=s,this.index=0,this.stack=[],this.changed=!1,this.top=e,this.preMatch=lv(e.node.content,e)}destroyBetween(e,t){if(e!=t){for(let s=e;s<t;s++)this.top.children[s].destroy();this.top.children.splice(e,t-e),this.changed=!0}}destroyRest(){this.destroyBetween(this.index,this.top.children.length)}syncToMarks(e,t,s){let n=0,i=this.stack.length>>1,o=Math.min(i,e.length);for(;n<o&&(n==i-1?this.top:this.stack[n+1<<1]).matchesMark(e[n])&&e[n].type.spec.spanning!==!1;)n++;for(;n<i;)this.destroyRest(),this.top.dirty=Dt,this.index=this.stack.pop(),this.top=this.stack.pop(),i--;for(;i<e.length;){this.stack.push(this.top,this.index+1);let l=-1;for(let c=this.index;c<Math.min(this.index+3,this.top.children.length);c++){let d=this.top.children[c];if(d.matchesMark(e[i])&&!this.isLocked(d.dom)){l=c;break}}if(l>-1)l>this.index&&(this.changed=!0,this.destroyBetween(this.index,l)),this.top=this.top.children[this.index];else{let c=xs.create(this.top,e[i],t,s);this.top.children.splice(this.index,0,c),this.top=c,this.changed=!0}this.index=0,i++}}findNodeMatch(e,t,s,n){let i=-1,o;if(n>=this.preMatch.index&&(o=this.preMatch.matches[n-this.preMatch.index]).parent==this.top&&o.matchesNode(e,t,s))i=this.top.children.indexOf(o,this.index);else for(let l=this.index,c=Math.min(this.top.children.length,l+5);l<c;l++){let d=this.top.children[l];if(d.matchesNode(e,t,s)&&!this.preMatch.matched.has(d)){i=l;break}}return i<0?!1:(this.destroyBetween(this.index,i),this.index++,!0)}updateNodeAt(e,t,s,n,i){let o=this.top.children[n];return o.dirty==qt&&o.dom==o.contentDOM&&(o.dirty=Zr),o.update(e,t,s,i)?(this.destroyBetween(this.index,n),this.index++,!0):!1}findIndexWithChild(e){for(;;){let t=e.parentNode;if(!t)return-1;if(t==this.top.contentDOM){let s=e.pmViewDesc;if(s){for(let n=this.index;n<this.top.children.length;n++)if(this.top.children[n]==s)return n}return-1}e=t}}updateNextNode(e,t,s,n,i,o){for(let l=this.index;l<this.top.children.length;l++){let c=this.top.children[l];if(c instanceof Dr){let d=this.preMatch.matched.get(c);if(d!=null&&d!=i)return!1;let u=c.dom,h,f=this.isLocked(u)&&!(e.isText&&c.node&&c.node.isText&&c.nodeDOM.nodeValue==e.text&&c.dirty!=qt&&Hi(t,c.outerDeco));if(!f&&c.update(e,t,s,n))return this.destroyBetween(this.index,l),c.dom!=u&&(this.changed=!0),this.index++,!0;if(!f&&(h=this.recreateWrapper(c,e,t,s,n,o)))return this.destroyBetween(this.index,l),this.top.children[this.index]=h,h.contentDOM&&(h.dirty=Zr,h.updateChildren(n,o+1),h.dirty=Dt),this.changed=!0,this.index++,!0;break}}return!1}recreateWrapper(e,t,s,n,i,o){if(e.dirty||t.isAtom||!e.children.length||!e.node.content.eq(t.content)||!Hi(s,e.outerDeco)||!n.eq(e.innerDeco))return null;let l=Dr.create(this.top,t,s,n,i,o);if(l.contentDOM){l.children=e.children,e.children=[];for(let c of l.children)c.parent=l}return e.destroy(),l}addNode(e,t,s,n,i){let o=Dr.create(this.top,e,t,s,n,i);o.contentDOM&&o.updateChildren(n,i+1),this.top.children.splice(this.index++,0,o),this.changed=!0}placeWidget(e,t,s){let n=this.index<this.top.children.length?this.top.children[this.index]:null;if(n&&n.matchesWidget(e)&&(e==n.widget||!n.widget.type.toDOM.parentNode))this.index++;else{let i=new Qf(this.top,e,t,s);this.top.children.splice(this.index++,0,i),this.changed=!0}}addTextblockHacks(){let e=this.top.children[this.index-1],t=this.top;for(;e instanceof xs;)t=e,e=t.children[t.children.length-1];(!e||!(e instanceof Vo)||/\n$/.test(e.node.text)||this.view.requiresGeckoHackNode&&/\s$/.test(e.node.text))&&((lt||st)&&e&&e.dom.contentEditable=="false"&&this.addHackNode("IMG",t),this.addHackNode("BR",this.top))}addHackNode(e,t){if(t==this.top&&this.index<t.children.length&&t.children[this.index].matchesHack(e))this.index++;else{let s=document.createElement(e);e=="IMG"&&(s.className="ProseMirror-separator",s.alt=""),e=="BR"&&(s.className="ProseMirror-trailingBreak");let n=new Zf(this.top,[],s,null);t!=this.top?t.children.push(n):t.children.splice(this.index++,0,n),this.changed=!0}}isLocked(e){return this.lock&&(e==this.lock||e.nodeType==1&&e.contains(this.lock.parentNode))}}function lv(r,e){let t=e,s=t.children.length,n=r.childCount,i=new Map,o=[];e:for(;n>0;){let l;for(;;)if(s){let d=t.children[s-1];if(d instanceof xs)t=d,s=d.children.length;else{l=d,s--;break}}else{if(t==e)break e;s=t.parent.children.indexOf(t),t=t.parent}let c=l.node;if(c){if(c!=r.child(n-1))break;--n,i.set(l,n),o.push(l)}}return{index:n,matched:i,matches:o.reverse()}}function cv(r,e){return r.type.side-e.type.side}function dv(r,e,t,s){let n=e.locals(r),i=0;if(n.length==0){for(let d=0;d<r.childCount;d++){let u=r.child(d);s(u,n,e.forChild(i,u),d),i+=u.nodeSize}return}let o=0,l=[],c=null;for(let d=0;;){let u,h;for(;o<n.length&&n[o].to==i;){let y=n[o++];y.widget&&(u?(h||(h=[u])).push(y):u=y)}if(u)if(h){h.sort(cv);for(let y=0;y<h.length;y++)t(h[y],d,!!c)}else t(u,d,!!c);let f,p;if(c)p=-1,f=c,c=null;else if(d<r.childCount)p=d,f=r.child(d++);else break;for(let y=0;y<l.length;y++)l[y].to<=i&&l.splice(y--,1);for(;o<n.length&&n[o].from<=i&&n[o].to>i;)l.push(n[o++]);let m=i+f.nodeSize;if(f.isText){let y=m;o<n.length&&n[o].from<y&&(y=n[o].from);for(let x=0;x<l.length;x++)l[x].to<y&&(y=l[x].to);y<m&&(c=f.cut(y-i),f=f.cut(0,y-i),m=y,p=-1)}else for(;o<n.length&&n[o].to<m;)o++;let g=f.isInline&&!f.isLeaf?l.filter(y=>!y.inline):l.slice();s(f,g,e.forChild(i,f),p),i=m}}function uv(r){if(r.nodeName=="UL"||r.nodeName=="OL"){let e=r.style.cssText;r.style.cssText=e+"; list-style: square !important",window.getComputedStyle(r).listStyle,r.style.cssText=e}}function hv(r,e,t,s){for(let n=0,i=0;n<r.childCount&&i<=s;){let o=r.child(n++),l=i;if(i+=o.nodeSize,!o.isText)continue;let c=o.text;for(;n<r.childCount;){let d=r.child(n++);if(i+=d.nodeSize,!d.isText)break;c+=d.text}if(i>=t){if(i>=s&&c.slice(s-e.length-l,s-l)==e)return s-e.length;let d=l<s?c.lastIndexOf(e,s-l-1):-1;if(d>=0&&d+e.length+l>=t)return l+d;if(t==s&&c.length>=s+e.length-l&&c.slice(s-l,s-l+e.length)==e)return s}}return-1}function pl(r,e,t,s,n){let i=[];for(let o=0,l=0;o<r.length;o++){let c=r[o],d=l,u=l+=c.size;d>=t||u<=e?i.push(c):(d<e&&i.push(c.slice(0,e-d,s)),n&&(i.push(n),n=void 0),u>t&&i.push(c.slice(t-d,c.size,s)))}return i}function ic(r,e=null){let t=r.domSelectionRange(),s=r.state.doc;if(!t.focusNode)return null;let n=r.docView.nearestDesc(t.focusNode),i=n&&n.size==0,o=r.docView.posFromDOM(t.focusNode,t.focusOffset,1);if(o<0)return null;let l=s.resolve(o),c,d;if(Ho(t)){for(c=o;n&&!n.node;)n=n.parent;let h=n.node;if(n&&h.isAtom&&se.isSelectable(h)&&n.parent&&!(h.isInline&&_w(t.focusNode,t.focusOffset,n.dom))){let f=n.posBefore;d=new se(o==f?l:s.resolve(f))}}else{if(t instanceof r.dom.ownerDocument.defaultView.Selection&&t.rangeCount>1){let h=o,f=o;for(let p=0;p<t.rangeCount;p++){let m=t.getRangeAt(p);h=Math.min(h,r.docView.posFromDOM(m.startContainer,m.startOffset,1)),f=Math.max(f,r.docView.posFromDOM(m.endContainer,m.endOffset,-1))}if(h<0)return null;[c,o]=f==r.state.selection.anchor?[f,h]:[h,f],l=s.resolve(o)}else c=r.docView.posFromDOM(t.anchorNode,t.anchorOffset,1);if(c<0)return null}let u=s.resolve(c);if(!d){let h=e=="pointer"||r.state.selection.head<l.pos&&!i?1:-1;d=oc(r,u,l,h)}return d}function sp(r){return r.editable?r.hasFocus():ip(r)&&document.activeElement&&document.activeElement.contains(r.dom)}function ir(r,e=!1){let t=r.state.selection;if(np(r,t),!!sp(r)){if(!e&&r.input.mouseDown&&r.input.mouseDown.allowDefault&&st){let s=r.domSelectionRange(),n=r.domObserver.currentSelection;if(s.anchorNode&&n.anchorNode&&gs(s.anchorNode,s.anchorOffset,n.anchorNode,n.anchorOffset)){r.input.mouseDown.delayedSelectionSync=!0,r.domObserver.setCurSelection();return}}if(r.domObserver.disconnectSelection(),r.cursorWrapper)pv(r);else{let{anchor:s,head:n}=t,i,o;$d&&!(t instanceof ce)&&(t.$from.parent.inlineContent||(i=_d(r,t.from)),!t.empty&&!t.$from.parent.inlineContent&&(o=_d(r,t.to))),r.docView.setSelection(s,n,r,e),$d&&(i&&Fd(i),o&&Fd(o)),t.visible?r.dom.classList.remove("ProseMirror-hideselection"):(r.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&fv(r))}r.domObserver.setCurSelection(),r.domObserver.connectSelection()}}const $d=lt||st&&Vf<63;function _d(r,e){let{node:t,offset:s}=r.docView.domFromPos(e,0),n=s<t.childNodes.length?t.childNodes[s]:null,i=s?t.childNodes[s-1]:null;if(lt&&n&&n.contentEditable=="false")return ba(n);if((!n||n.contentEditable=="false")&&(!i||i.contentEditable=="false")){if(n)return ba(n);if(i)return ba(i)}}function ba(r){return r.contentEditable="true",lt&&r.draggable&&(r.draggable=!1,r.wasDraggable=!0),r}function Fd(r){r.contentEditable="false",r.wasDraggable&&(r.draggable=!0,r.wasDraggable=null)}function fv(r){let e=r.dom.ownerDocument;e.removeEventListener("selectionchange",r.input.hideSelectionGuard);let t=r.domSelectionRange(),s=t.anchorNode,n=t.anchorOffset;e.addEventListener("selectionchange",r.input.hideSelectionGuard=()=>{(t.anchorNode!=s||t.anchorOffset!=n)&&(e.removeEventListener("selectionchange",r.input.hideSelectionGuard),setTimeout(()=>{(!sp(r)||r.state.selection.visible)&&r.dom.classList.remove("ProseMirror-hideselection")},20))})}function pv(r){let e=r.domSelection(),t=document.createRange();if(!e)return;let s=r.cursorWrapper.dom,n=s.nodeName=="IMG";n?t.setStart(s.parentNode,Qe(s)+1):t.setStart(s,0),t.collapse(!0),e.removeAllRanges(),e.addRange(t),!n&&!r.state.selection.visible&&xt&&Mr<=11&&(s.disabled=!0,s.disabled=!1)}function np(r,e){if(e instanceof se){let t=r.docView.descAt(e.from);t!=r.lastSelectedViewDesc&&(Bd(r),t&&t.selectNode(),r.lastSelectedViewDesc=t)}else Bd(r)}function Bd(r){r.lastSelectedViewDesc&&(r.lastSelectedViewDesc.parent&&r.lastSelectedViewDesc.deselectNode(),r.lastSelectedViewDesc=void 0)}function oc(r,e,t,s){return r.someProp("createSelectionBetween",n=>n(r,e,t))||ce.between(e,t,s)}function Ud(r){return r.editable&&!r.hasFocus()?!1:ip(r)}function ip(r){let e=r.domSelectionRange();if(!e.anchorNode)return!1;try{return r.dom.contains(e.anchorNode.nodeType==3?e.anchorNode.parentNode:e.anchorNode)&&(r.editable||r.dom.contains(e.focusNode.nodeType==3?e.focusNode.parentNode:e.focusNode))}catch{return!1}}function mv(r){let e=r.docView.domFromPos(r.state.selection.anchor,0),t=r.domSelectionRange();return gs(e.node,e.offset,t.anchorNode,t.anchorOffset)}function ml(r,e){let{$anchor:t,$head:s}=r.selection,n=e>0?t.max(s):t.min(s),i=n.parent.inlineContent?n.depth?r.doc.resolve(e>0?n.after():n.before()):null:n;return i&&de.findFrom(i,e)}function fr(r,e){return r.dispatch(r.state.tr.setSelection(e).scrollIntoView()),!0}function zd(r,e,t){let s=r.state.selection;if(s instanceof ce)if(t.indexOf("s")>-1){let{$head:n}=s,i=n.textOffset?null:e<0?n.nodeBefore:n.nodeAfter;if(!i||i.isText||!i.isLeaf)return!1;let o=r.state.doc.resolve(n.pos+i.nodeSize*(e<0?-1:1));return fr(r,new ce(s.$anchor,o))}else if(s.empty){if(r.endOfTextblock(e>0?"forward":"backward")){let n=ml(r.state,e);return n&&n instanceof se?fr(r,n):!1}else if(!(Ct&&t.indexOf("m")>-1)){let n=s.$head,i=n.textOffset?null:e<0?n.nodeBefore:n.nodeAfter,o;if(!i||i.isText)return!1;let l=e<0?n.pos-i.nodeSize:n.pos;return i.isAtom||(o=r.docView.descAt(l))&&!o.contentDOM?se.isSelectable(i)?fr(r,new se(e<0?r.state.doc.resolve(n.pos-i.nodeSize):n)):Gn?fr(r,new ce(r.state.doc.resolve(e<0?l:l+i.nodeSize))):!1:!1}}else return!1;else{if(s instanceof se&&s.node.isInline)return fr(r,new ce(e>0?s.$to:s.$from));{let n=ml(r.state,e);return n?fr(r,n):!1}}}function Vi(r){return r.nodeType==3?r.nodeValue.length:r.childNodes.length}function xn(r,e){let t=r.pmViewDesc;return t&&t.size==0&&(e<0||r.nextSibling||r.nodeName!="BR")}function Ms(r,e){return e<0?gv(r):xv(r)}function gv(r){let e=r.domSelectionRange(),t=e.focusNode,s=e.focusOffset;if(!t)return;let n,i,o=!1;for(Pt&&t.nodeType==1&&s<Vi(t)&&xn(t.childNodes[s],-1)&&(o=!0);;)if(s>0){if(t.nodeType!=1)break;{let l=t.childNodes[s-1];if(xn(l,-1))n=t,i=--s;else if(l.nodeType==3)t=l,s=t.nodeValue.length;else break}}else{if(op(t))break;{let l=t.previousSibling;for(;l&&xn(l,-1);)n=t.parentNode,i=Qe(l),l=l.previousSibling;if(l)t=l,s=Vi(t);else{if(t=t.parentNode,t==r.dom)break;s=0}}}o?gl(r,t,s):n&&gl(r,n,i)}function xv(r){let e=r.domSelectionRange(),t=e.focusNode,s=e.focusOffset;if(!t)return;let n=Vi(t),i,o;for(;;)if(s<n){if(t.nodeType!=1)break;let l=t.childNodes[s];if(xn(l,1))i=t,o=++s;else break}else{if(op(t))break;{let l=t.nextSibling;for(;l&&xn(l,1);)i=l.parentNode,o=Qe(l)+1,l=l.nextSibling;if(l)t=l,s=0,n=Vi(t);else{if(t=t.parentNode,t==r.dom)break;s=n=0}}}i&&gl(r,i,o)}function op(r){let e=r.pmViewDesc;return e&&e.node&&e.node.isBlock}function yv(r,e){for(;r&&e==r.childNodes.length&&!Kn(r);)e=Qe(r)+1,r=r.parentNode;for(;r&&e<r.childNodes.length;){let t=r.childNodes[e];if(t.nodeType==3)return t;if(t.nodeType==1&&t.contentEditable=="false")break;r=t,e=0}}function bv(r,e){for(;r&&!e&&!Kn(r);)e=Qe(r),r=r.parentNode;for(;r&&e;){let t=r.childNodes[e-1];if(t.nodeType==3)return t;if(t.nodeType==1&&t.contentEditable=="false")break;r=t,e=r.childNodes.length}}function gl(r,e,t){if(e.nodeType!=3){let i,o;(o=yv(e,t))?(e=o,t=0):(i=bv(e,t))&&(e=i,t=i.nodeValue.length)}let s=r.domSelection();if(!s)return;if(Ho(s)){let i=document.createRange();i.setEnd(e,t),i.setStart(e,t),s.removeAllRanges(),s.addRange(i)}else s.extend&&s.extend(e,t);r.domObserver.setCurSelection();let{state:n}=r;setTimeout(()=>{r.state==n&&ir(r)},50)}function Wd(r,e){let t=r.state.doc.resolve(e);if(!(st||Uw)&&t.parent.inlineContent){let n=r.coordsAtPos(e);if(e>t.start()){let i=r.coordsAtPos(e-1),o=(i.top+i.bottom)/2;if(o>n.top&&o<n.bottom&&Math.abs(i.left-n.left)>1)return i.left<n.left?"ltr":"rtl"}if(e<t.end()){let i=r.coordsAtPos(e+1),o=(i.top+i.bottom)/2;if(o>n.top&&o<n.bottom&&Math.abs(i.left-n.left)>1)return i.left>n.left?"ltr":"rtl"}}return getComputedStyle(r.dom).direction=="rtl"?"rtl":"ltr"}function Hd(r,e,t){let s=r.state.selection;if(s instanceof ce&&!s.empty||t.indexOf("s")>-1||Ct&&t.indexOf("m")>-1)return!1;let{$from:n,$to:i}=s;if(!n.parent.inlineContent||r.endOfTextblock(e<0?"up":"down")){let o=ml(r.state,e);if(o&&o instanceof se)return fr(r,o)}if(!n.parent.inlineContent){let o=e<0?n:i,l=s instanceof kt?de.near(o,e):de.findFrom(o,e);return l?fr(r,l):!1}return!1}function Vd(r,e){if(!(r.state.selection instanceof ce))return!0;let{$head:t,$anchor:s,empty:n}=r.state.selection;if(!t.sameParent(s))return!0;if(!n)return!1;if(r.endOfTextblock(e>0?"forward":"backward"))return!0;let i=!t.textOffset&&(e<0?t.nodeBefore:t.nodeAfter);if(i&&!i.isText){let o=r.state.tr;return e<0?o.delete(t.pos-i.nodeSize,t.pos):o.delete(t.pos,t.pos+i.nodeSize),r.dispatch(o),!0}return!1}function qd(r,e,t){r.domObserver.stop(),e.contentEditable=t,r.domObserver.start()}function wv(r){if(!lt||r.state.selection.$head.parentOffset>0)return!1;let{focusNode:e,focusOffset:t}=r.domSelectionRange();if(e&&e.nodeType==1&&t==0&&e.firstChild&&e.firstChild.contentEditable=="false"){let s=e.firstChild;qd(r,s,"true"),setTimeout(()=>qd(r,s,"false"),20)}return!1}function vv(r){let e="";return r.ctrlKey&&(e+="c"),r.metaKey&&(e+="m"),r.altKey&&(e+="a"),r.shiftKey&&(e+="s"),e}function Nv(r,e){let t=e.keyCode,s=vv(e);if(t==8||Ct&&t==72&&s=="c")return Vd(r,-1)||Ms(r,-1);if(t==46&&!e.shiftKey||Ct&&t==68&&s=="c")return Vd(r,1)||Ms(r,1);if(t==13||t==27)return!0;if(t==37||Ct&&t==66&&s=="c"){let n=t==37?Wd(r,r.state.selection.from)=="ltr"?-1:1:-1;return zd(r,n,s)||Ms(r,n)}else if(t==39||Ct&&t==70&&s=="c"){let n=t==39?Wd(r,r.state.selection.from)=="ltr"?1:-1:1;return zd(r,n,s)||Ms(r,n)}else{if(t==38||Ct&&t==80&&s=="c")return Hd(r,-1,s)||Ms(r,-1);if(t==40||Ct&&t==78&&s=="c")return wv(r)||Hd(r,1,s)||Ms(r,1);if(s==(Ct?"m":"c")&&(t==66||t==73||t==89||t==90))return!0}return!1}function ac(r,e){r.someProp("transformCopied",p=>{e=p(e,r)});let t=[],{content:s,openStart:n,openEnd:i}=e;for(;n>1&&i>1&&s.childCount==1&&s.firstChild.childCount==1;){n--,i--;let p=s.firstChild;t.push(p.type.name,p.attrs!=p.type.defaultAttrs?p.attrs:null),s=p.content}let o=r.someProp("clipboardSerializer")||js.fromSchema(r.state.schema),l=hp(),c=l.createElement("div");c.appendChild(o.serializeFragment(s,{document:l}));let d=c.firstChild,u,h=0;for(;d&&d.nodeType==1&&(u=up[d.nodeName.toLowerCase()]);){for(let p=u.length-1;p>=0;p--){let m=l.createElement(u[p]);for(;c.firstChild;)m.appendChild(c.firstChild);c.appendChild(m),h++}d=c.firstChild}d&&d.nodeType==1&&d.setAttribute("data-pm-slice",`${n} ${i}${h?` -${h}`:""} ${JSON.stringify(t)}`);let f=r.someProp("clipboardTextSerializer",p=>p(e,r))||e.content.textBetween(0,e.content.size,`

`);return{dom:c,text:f,slice:e}}function ap(r,e,t,s,n){let i=n.parent.type.spec.code,o,l;if(!t&&!e)return null;let c=e&&(s||i||!t);if(c){if(r.someProp("transformPastedText",f=>{e=f(e,i||s,r)}),i)return e?new Q(z.from(r.state.schema.text(e.replace(/\r\n?/g,`
`))),0,0):Q.empty;let h=r.someProp("clipboardTextParser",f=>f(e,n,s,r));if(h)l=h;else{let f=n.marks(),{schema:p}=r.state,m=js.fromSchema(p);o=document.createElement("div"),e.split(/(?:\r\n?|\n)+/).forEach(g=>{let y=o.appendChild(document.createElement("p"));g&&y.appendChild(m.serializeNode(p.text(g,f)))})}}else r.someProp("transformPastedHTML",h=>{t=h(t,r)}),o=Ev(t),Gn&&Av(o);let d=o&&o.querySelector("[data-pm-slice]"),u=d&&/^(\d+) (\d+)(?: -(\d+))? (.*)/.exec(d.getAttribute("data-pm-slice")||"");if(u&&u[3])for(let h=+u[3];h>0;h--){let f=o.firstChild;for(;f&&f.nodeType!=1;)f=f.nextSibling;if(!f)break;o=f}if(l||(l=(r.someProp("clipboardParser")||r.someProp("domParser")||Cr.fromSchema(r.state.schema)).parseSlice(o,{preserveWhitespace:!!(c||u),context:n,ruleFromNode(f){return f.nodeName=="BR"&&!f.nextSibling&&f.parentNode&&!jv.test(f.parentNode.nodeName)?{ignore:!0}:null}})),u)l=Cv(Kd(l,+u[1],+u[2]),u[4]);else if(l=Q.maxOpen(kv(l.content,n),!0),l.openStart||l.openEnd){let h=0,f=0;for(let p=l.content.firstChild;h<l.openStart&&!p.type.spec.isolating;h++,p=p.firstChild);for(let p=l.content.lastChild;f<l.openEnd&&!p.type.spec.isolating;f++,p=p.lastChild);l=Kd(l,h,f)}return r.someProp("transformPasted",h=>{l=h(l,r)}),l}const jv=/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/i;function kv(r,e){if(r.childCount<2)return r;for(let t=e.depth;t>=0;t--){let n=e.node(t).contentMatchAt(e.index(t)),i,o=[];if(r.forEach(l=>{if(!o)return;let c=n.findWrapping(l.type),d;if(!c)return o=null;if(d=o.length&&i.length&&cp(c,i,l,o[o.length-1],0))o[o.length-1]=d;else{o.length&&(o[o.length-1]=dp(o[o.length-1],i.length));let u=lp(l,c);o.push(u),n=n.matchType(u.type),i=c}}),o)return z.from(o)}return r}function lp(r,e,t=0){for(let s=e.length-1;s>=t;s--)r=e[s].create(null,z.from(r));return r}function cp(r,e,t,s,n){if(n<r.length&&n<e.length&&r[n]==e[n]){let i=cp(r,e,t,s.lastChild,n+1);if(i)return s.copy(s.content.replaceChild(s.childCount-1,i));if(s.contentMatchAt(s.childCount).matchType(n==r.length-1?t.type:r[n+1]))return s.copy(s.content.append(z.from(lp(t,r,n+1))))}}function dp(r,e){if(e==0)return r;let t=r.content.replaceChild(r.childCount-1,dp(r.lastChild,e-1)),s=r.contentMatchAt(r.childCount).fillBefore(z.empty,!0);return r.copy(t.append(s))}function xl(r,e,t,s,n,i){let o=e<0?r.firstChild:r.lastChild,l=o.content;return r.childCount>1&&(i=0),n<s-1&&(l=xl(l,e,t,s,n+1,i)),n>=t&&(l=e<0?o.contentMatchAt(0).fillBefore(l,i<=n).append(l):l.append(o.contentMatchAt(o.childCount).fillBefore(z.empty,!0))),r.replaceChild(e<0?0:r.childCount-1,o.copy(l))}function Kd(r,e,t){return e<r.openStart&&(r=new Q(xl(r.content,-1,e,r.openStart,0,r.openEnd),e,r.openEnd)),t<r.openEnd&&(r=new Q(xl(r.content,1,t,r.openEnd,0,0),r.openStart,t)),r}const up={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]};let Gd=null;function hp(){return Gd||(Gd=document.implementation.createHTMLDocument("title"))}let wa=null;function Sv(r){let e=window.trustedTypes;return e?(wa||(wa=e.defaultPolicy||e.createPolicy("ProseMirrorClipboard",{createHTML:t=>t})),wa.createHTML(r)):r}function Ev(r){let e=/^(\s*<meta [^>]*>)*/.exec(r);e&&(r=r.slice(e[0].length));let t=hp().createElement("div"),s=/<([a-z][^>\s]+)/i.exec(r),n;if((n=s&&up[s[1].toLowerCase()])&&(r=n.map(i=>"<"+i+">").join("")+r+n.map(i=>"</"+i+">").reverse().join("")),t.innerHTML=Sv(r),n)for(let i=0;i<n.length;i++)t=t.querySelector(n[i])||t;return t}function Av(r){let e=r.querySelectorAll(st?"span:not([class]):not([style])":"span.Apple-converted-space");for(let t=0;t<e.length;t++){let s=e[t];s.childNodes.length==1&&s.textContent==" "&&s.parentNode&&s.parentNode.replaceChild(r.ownerDocument.createTextNode(" "),s)}}function Cv(r,e){if(!r.size)return r;let t=r.content.firstChild.type.schema,s;try{s=JSON.parse(e)}catch{return r}let{content:n,openStart:i,openEnd:o}=r;for(let l=s.length-2;l>=0;l-=2){let c=t.nodes[s[l]];if(!c||c.hasRequiredAttrs())break;n=z.from(c.create(s[l+1],n)),i++,o++}return new Q(n,i,o)}const ct={},dt={},Mv={touchstart:!0,touchmove:!0};class Dv{constructor(){this.shiftKey=!1,this.mouseDown=null,this.lastKeyCode=null,this.lastKeyCodeTime=0,this.lastClick={time:0,x:0,y:0,type:"",button:0},this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastIOSEnter=0,this.lastIOSEnterFallbackTimeout=-1,this.lastFocus=0,this.lastTouch=0,this.lastChromeDelete=0,this.composing=!1,this.compositionNode=null,this.composingTimeout=-1,this.compositionNodes=[],this.compositionEndedAt=-2e8,this.compositionID=1,this.compositionPendingChanges=0,this.domChangeCount=0,this.eventHandlers=Object.create(null),this.hideSelectionGuard=null}}function Tv(r){for(let e in ct){let t=ct[e];r.dom.addEventListener(e,r.input.eventHandlers[e]=s=>{Rv(r,s)&&!lc(r,s)&&(r.editable||!(s.type in dt))&&t(r,s)},Mv[e]?{passive:!0}:void 0)}lt&&r.dom.addEventListener("input",()=>null),yl(r)}function Nr(r,e){r.input.lastSelectionOrigin=e,r.input.lastSelectionTime=Date.now()}function Ov(r){r.domObserver.stop();for(let e in r.input.eventHandlers)r.dom.removeEventListener(e,r.input.eventHandlers[e]);clearTimeout(r.input.composingTimeout),clearTimeout(r.input.lastIOSEnterFallbackTimeout)}function yl(r){r.someProp("handleDOMEvents",e=>{for(let t in e)r.input.eventHandlers[t]||r.dom.addEventListener(t,r.input.eventHandlers[t]=s=>lc(r,s))})}function lc(r,e){return r.someProp("handleDOMEvents",t=>{let s=t[e.type];return s?s(r,e)||e.defaultPrevented:!1})}function Rv(r,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let t=e.target;t!=r.dom;t=t.parentNode)if(!t||t.nodeType==11||t.pmViewDesc&&t.pmViewDesc.stopEvent(e))return!1;return!0}function Iv(r,e){!lc(r,e)&&ct[e.type]&&(r.editable||!(e.type in dt))&&ct[e.type](r,e)}dt.keydown=(r,e)=>{let t=e;if(r.input.shiftKey=t.keyCode==16||t.shiftKey,!pp(r,t)&&(r.input.lastKeyCode=t.keyCode,r.input.lastKeyCodeTime=Date.now(),!(rr&&st&&t.keyCode==13)))if(t.keyCode!=229&&r.domObserver.forceFlush(),Vs&&t.keyCode==13&&!t.ctrlKey&&!t.altKey&&!t.metaKey){let s=Date.now();r.input.lastIOSEnter=s,r.input.lastIOSEnterFallbackTimeout=setTimeout(()=>{r.input.lastIOSEnter==s&&(r.someProp("handleKeyDown",n=>n(r,qr(13,"Enter"))),r.input.lastIOSEnter=0)},200)}else r.someProp("handleKeyDown",s=>s(r,t))||Nv(r,t)?t.preventDefault():Nr(r,"key")};dt.keyup=(r,e)=>{e.keyCode==16&&(r.input.shiftKey=!1)};dt.keypress=(r,e)=>{let t=e;if(pp(r,t)||!t.charCode||t.ctrlKey&&!t.altKey||Ct&&t.metaKey)return;if(r.someProp("handleKeyPress",n=>n(r,t))){t.preventDefault();return}let s=r.state.selection;if(!(s instanceof ce)||!s.$from.sameParent(s.$to)){let n=String.fromCharCode(t.charCode),i=()=>r.state.tr.insertText(n).scrollIntoView();!/[\r\n]/.test(n)&&!r.someProp("handleTextInput",o=>o(r,s.$from.pos,s.$to.pos,n,i))&&r.dispatch(i()),t.preventDefault()}};function qo(r){return{left:r.clientX,top:r.clientY}}function Pv(r,e){let t=e.x-r.clientX,s=e.y-r.clientY;return t*t+s*s<100}function cc(r,e,t,s,n){if(s==-1)return!1;let i=r.state.doc.resolve(s);for(let o=i.depth+1;o>0;o--)if(r.someProp(e,l=>o>i.depth?l(r,t,i.nodeAfter,i.before(o),n,!0):l(r,t,i.node(o),i.before(o),n,!1)))return!0;return!1}function Bs(r,e,t){if(r.focused||r.focus(),r.state.selection.eq(e))return;let s=r.state.tr.setSelection(e);s.setMeta("pointer",!0),r.dispatch(s)}function Lv(r,e){if(e==-1)return!1;let t=r.state.doc.resolve(e),s=t.nodeAfter;return s&&s.isAtom&&se.isSelectable(s)?(Bs(r,new se(t)),!0):!1}function $v(r,e){if(e==-1)return!1;let t=r.state.selection,s,n;t instanceof se&&(s=t.node);let i=r.state.doc.resolve(e);for(let o=i.depth+1;o>0;o--){let l=o>i.depth?i.nodeAfter:i.node(o);if(se.isSelectable(l)){s&&t.$from.depth>0&&o>=t.$from.depth&&i.before(t.$from.depth+1)==t.$from.pos?n=i.before(t.$from.depth):n=i.before(o);break}}return n!=null?(Bs(r,se.create(r.state.doc,n)),!0):!1}function _v(r,e,t,s,n){return cc(r,"handleClickOn",e,t,s)||r.someProp("handleClick",i=>i(r,e,s))||(n?$v(r,t):Lv(r,t))}function Fv(r,e,t,s){return cc(r,"handleDoubleClickOn",e,t,s)||r.someProp("handleDoubleClick",n=>n(r,e,s))}function Bv(r,e,t,s){return cc(r,"handleTripleClickOn",e,t,s)||r.someProp("handleTripleClick",n=>n(r,e,s))||Uv(r,t,s)}function Uv(r,e,t){if(t.button!=0)return!1;let s=r.state.doc;if(e==-1)return s.inlineContent?(Bs(r,ce.create(s,0,s.content.size)),!0):!1;let n=s.resolve(e);for(let i=n.depth+1;i>0;i--){let o=i>n.depth?n.nodeAfter:n.node(i),l=n.before(i);if(o.inlineContent)Bs(r,ce.create(s,l+1,l+1+o.content.size));else if(se.isSelectable(o))Bs(r,se.create(s,l));else continue;return!0}}function dc(r){return qi(r)}const fp=Ct?"metaKey":"ctrlKey";ct.mousedown=(r,e)=>{let t=e;r.input.shiftKey=t.shiftKey;let s=dc(r),n=Date.now(),i="singleClick";n-r.input.lastClick.time<500&&Pv(t,r.input.lastClick)&&!t[fp]&&r.input.lastClick.button==t.button&&(r.input.lastClick.type=="singleClick"?i="doubleClick":r.input.lastClick.type=="doubleClick"&&(i="tripleClick")),r.input.lastClick={time:n,x:t.clientX,y:t.clientY,type:i,button:t.button};let o=r.posAtCoords(qo(t));o&&(i=="singleClick"?(r.input.mouseDown&&r.input.mouseDown.done(),r.input.mouseDown=new zv(r,o,t,!!s)):(i=="doubleClick"?Fv:Bv)(r,o.pos,o.inside,t)?t.preventDefault():Nr(r,"pointer"))};class zv{constructor(e,t,s,n){this.view=e,this.pos=t,this.event=s,this.flushed=n,this.delayedSelectionSync=!1,this.mightDrag=null,this.startDoc=e.state.doc,this.selectNode=!!s[fp],this.allowDefault=s.shiftKey;let i,o;if(t.inside>-1)i=e.state.doc.nodeAt(t.inside),o=t.inside;else{let u=e.state.doc.resolve(t.pos);i=u.parent,o=u.depth?u.before():0}const l=n?null:s.target,c=l?e.docView.nearestDesc(l,!0):null;this.target=c&&c.dom.nodeType==1?c.dom:null;let{selection:d}=e.state;(s.button==0&&i.type.spec.draggable&&i.type.spec.selectable!==!1||d instanceof se&&d.from<=o&&d.to>o)&&(this.mightDrag={node:i,pos:o,addAttr:!!(this.target&&!this.target.draggable),setUneditable:!!(this.target&&Pt&&!this.target.hasAttribute("contentEditable"))}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout(()=>{this.view.input.mouseDown==this&&this.target.setAttribute("contentEditable","false")},20),this.view.domObserver.start()),e.root.addEventListener("mouseup",this.up=this.up.bind(this)),e.root.addEventListener("mousemove",this.move=this.move.bind(this)),Nr(e,"pointer")}done(){this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout(()=>ir(this.view)),this.view.input.mouseDown=null}up(e){if(this.done(),!this.view.dom.contains(e.target))return;let t=this.pos;this.view.state.doc!=this.startDoc&&(t=this.view.posAtCoords(qo(e))),this.updateAllowDefault(e),this.allowDefault||!t?Nr(this.view,"pointer"):_v(this.view,t.pos,t.inside,e,this.selectNode)?e.preventDefault():e.button==0&&(this.flushed||lt&&this.mightDrag&&!this.mightDrag.node.isAtom||st&&!this.view.state.selection.visible&&Math.min(Math.abs(t.pos-this.view.state.selection.from),Math.abs(t.pos-this.view.state.selection.to))<=2)?(Bs(this.view,de.near(this.view.state.doc.resolve(t.pos))),e.preventDefault()):Nr(this.view,"pointer")}move(e){this.updateAllowDefault(e),Nr(this.view,"pointer"),e.buttons==0&&this.done()}updateAllowDefault(e){!this.allowDefault&&(Math.abs(this.event.x-e.clientX)>4||Math.abs(this.event.y-e.clientY)>4)&&(this.allowDefault=!0)}}ct.touchstart=r=>{r.input.lastTouch=Date.now(),dc(r),Nr(r,"pointer")};ct.touchmove=r=>{r.input.lastTouch=Date.now(),Nr(r,"pointer")};ct.contextmenu=r=>dc(r);function pp(r,e){return r.composing?!0:lt&&Math.abs(e.timeStamp-r.input.compositionEndedAt)<500?(r.input.compositionEndedAt=-2e8,!0):!1}const Wv=rr?5e3:-1;dt.compositionstart=dt.compositionupdate=r=>{if(!r.composing){r.domObserver.flush();let{state:e}=r,t=e.selection.$to;if(e.selection instanceof ce&&(e.storedMarks||!t.textOffset&&t.parentOffset&&t.nodeBefore.marks.some(s=>s.type.spec.inclusive===!1)))r.markCursor=r.state.storedMarks||t.marks(),qi(r,!0),r.markCursor=null;else if(qi(r,!e.selection.empty),Pt&&e.selection.empty&&t.parentOffset&&!t.textOffset&&t.nodeBefore.marks.length){let s=r.domSelectionRange();for(let n=s.focusNode,i=s.focusOffset;n&&n.nodeType==1&&i!=0;){let o=i<0?n.lastChild:n.childNodes[i-1];if(!o)break;if(o.nodeType==3){let l=r.domSelection();l&&l.collapse(o,o.nodeValue.length);break}else n=o,i=-1}}r.input.composing=!0}mp(r,Wv)};dt.compositionend=(r,e)=>{r.composing&&(r.input.composing=!1,r.input.compositionEndedAt=e.timeStamp,r.input.compositionPendingChanges=r.domObserver.pendingRecords().length?r.input.compositionID:0,r.input.compositionNode=null,r.input.compositionPendingChanges&&Promise.resolve().then(()=>r.domObserver.flush()),r.input.compositionID++,mp(r,20))};function mp(r,e){clearTimeout(r.input.composingTimeout),e>-1&&(r.input.composingTimeout=setTimeout(()=>qi(r),e))}function gp(r){for(r.composing&&(r.input.composing=!1,r.input.compositionEndedAt=Vv());r.input.compositionNodes.length>0;)r.input.compositionNodes.pop().markParentsDirty()}function Hv(r){let e=r.domSelectionRange();if(!e.focusNode)return null;let t=Lw(e.focusNode,e.focusOffset),s=$w(e.focusNode,e.focusOffset);if(t&&s&&t!=s){let n=s.pmViewDesc,i=r.domObserver.lastChangedTextNode;if(t==i||s==i)return i;if(!n||!n.isText(s.nodeValue))return s;if(r.input.compositionNode==s){let o=t.pmViewDesc;if(!(!o||!o.isText(t.nodeValue)))return s}}return t||s}function Vv(){let r=document.createEvent("Event");return r.initEvent("event",!0,!0),r.timeStamp}function qi(r,e=!1){if(!(rr&&r.domObserver.flushingSoon>=0)){if(r.domObserver.forceFlush(),gp(r),e||r.docView&&r.docView.dirty){let t=ic(r),s=r.state.selection;return t&&!t.eq(s)?r.dispatch(r.state.tr.setSelection(t)):(r.markCursor||e)&&!s.$from.node(s.$from.sharedDepth(s.to)).inlineContent?r.dispatch(r.state.tr.deleteSelection()):r.updateState(r.state),!0}return!1}}function qv(r,e){if(!r.dom.parentNode)return;let t=r.dom.parentNode.appendChild(document.createElement("div"));t.appendChild(e),t.style.cssText="position: fixed; left: -10000px; top: 10px";let s=getSelection(),n=document.createRange();n.selectNodeContents(e),r.dom.blur(),s.removeAllRanges(),s.addRange(n),setTimeout(()=>{t.parentNode&&t.parentNode.removeChild(t),r.focus()},50)}const Dn=xt&&Mr<15||Vs&&zw<604;ct.copy=dt.cut=(r,e)=>{let t=e,s=r.state.selection,n=t.type=="cut";if(s.empty)return;let i=Dn?null:t.clipboardData,o=s.content(),{dom:l,text:c}=ac(r,o);i?(t.preventDefault(),i.clearData(),i.setData("text/html",l.innerHTML),i.setData("text/plain",c)):qv(r,l),n&&r.dispatch(r.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))};function Kv(r){return r.openStart==0&&r.openEnd==0&&r.content.childCount==1?r.content.firstChild:null}function Gv(r,e){if(!r.dom.parentNode)return;let t=r.input.shiftKey||r.state.selection.$from.parent.type.spec.code,s=r.dom.parentNode.appendChild(document.createElement(t?"textarea":"div"));t||(s.contentEditable="true"),s.style.cssText="position: fixed; left: -10000px; top: 10px",s.focus();let n=r.input.shiftKey&&r.input.lastKeyCode!=45;setTimeout(()=>{r.focus(),s.parentNode&&s.parentNode.removeChild(s),t?Tn(r,s.value,null,n,e):Tn(r,s.textContent,s.innerHTML,n,e)},50)}function Tn(r,e,t,s,n){let i=ap(r,e,t,s,r.state.selection.$from);if(r.someProp("handlePaste",c=>c(r,n,i||Q.empty)))return!0;if(!i)return!1;let o=Kv(i),l=o?r.state.tr.replaceSelectionWith(o,s):r.state.tr.replaceSelection(i);return r.dispatch(l.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}function xp(r){let e=r.getData("text/plain")||r.getData("Text");if(e)return e;let t=r.getData("text/uri-list");return t?t.replace(/\r?\n/g," "):""}dt.paste=(r,e)=>{let t=e;if(r.composing&&!rr)return;let s=Dn?null:t.clipboardData,n=r.input.shiftKey&&r.input.lastKeyCode!=45;s&&Tn(r,xp(s),s.getData("text/html"),n,t)?t.preventDefault():Gv(r,t)};class yp{constructor(e,t,s){this.slice=e,this.move=t,this.node=s}}const Yv=Ct?"altKey":"ctrlKey";function bp(r,e){let t=r.someProp("dragCopies",s=>!s(e));return t??!e[Yv]}ct.dragstart=(r,e)=>{let t=e,s=r.input.mouseDown;if(s&&s.done(),!t.dataTransfer)return;let n=r.state.selection,i=n.empty?null:r.posAtCoords(qo(t)),o;if(!(i&&i.pos>=n.from&&i.pos<=(n instanceof se?n.to-1:n.to))){if(s&&s.mightDrag)o=se.create(r.state.doc,s.mightDrag.pos);else if(t.target&&t.target.nodeType==1){let h=r.docView.nearestDesc(t.target,!0);h&&h.node.type.spec.draggable&&h!=r.docView&&(o=se.create(r.state.doc,h.posBefore))}}let l=(o||r.state.selection).content(),{dom:c,text:d,slice:u}=ac(r,l);(!t.dataTransfer.files.length||!st||Vf>120)&&t.dataTransfer.clearData(),t.dataTransfer.setData(Dn?"Text":"text/html",c.innerHTML),t.dataTransfer.effectAllowed="copyMove",Dn||t.dataTransfer.setData("text/plain",d),r.dragging=new yp(u,bp(r,t),o)};ct.dragend=r=>{let e=r.dragging;window.setTimeout(()=>{r.dragging==e&&(r.dragging=null)},50)};dt.dragover=dt.dragenter=(r,e)=>e.preventDefault();dt.drop=(r,e)=>{let t=e,s=r.dragging;if(r.dragging=null,!t.dataTransfer)return;let n=r.posAtCoords(qo(t));if(!n)return;let i=r.state.doc.resolve(n.pos),o=s&&s.slice;o?r.someProp("transformPasted",m=>{o=m(o,r)}):o=ap(r,xp(t.dataTransfer),Dn?null:t.dataTransfer.getData("text/html"),!1,i);let l=!!(s&&bp(r,t));if(r.someProp("handleDrop",m=>m(r,t,o||Q.empty,l))){t.preventDefault();return}if(!o)return;t.preventDefault();let c=o?Lf(r.state.doc,i.pos,o):i.pos;c==null&&(c=i.pos);let d=r.state.tr;if(l){let{node:m}=s;m?m.replace(d):d.deleteSelection()}let u=d.mapping.map(c),h=o.openStart==0&&o.openEnd==0&&o.content.childCount==1,f=d.doc;if(h?d.replaceRangeWith(u,u,o.content.firstChild):d.replaceRange(u,u,o),d.doc.eq(f))return;let p=d.doc.resolve(u);if(h&&se.isSelectable(o.content.firstChild)&&p.nodeAfter&&p.nodeAfter.sameMarkup(o.content.firstChild))d.setSelection(new se(p));else{let m=d.mapping.map(c);d.mapping.maps[d.mapping.maps.length-1].forEach((g,y,x,N)=>m=N),d.setSelection(oc(r,p,d.doc.resolve(m)))}r.focus(),r.dispatch(d.setMeta("uiEvent","drop"))};ct.focus=r=>{r.input.lastFocus=Date.now(),r.focused||(r.domObserver.stop(),r.dom.classList.add("ProseMirror-focused"),r.domObserver.start(),r.focused=!0,setTimeout(()=>{r.docView&&r.hasFocus()&&!r.domObserver.currentSelection.eq(r.domSelectionRange())&&ir(r)},20))};ct.blur=(r,e)=>{let t=e;r.focused&&(r.domObserver.stop(),r.dom.classList.remove("ProseMirror-focused"),r.domObserver.start(),t.relatedTarget&&r.dom.contains(t.relatedTarget)&&r.domObserver.currentSelection.clear(),r.focused=!1)};ct.beforeinput=(r,e)=>{if(st&&rr&&e.inputType=="deleteContentBackward"){r.domObserver.flushSoon();let{domChangeCount:s}=r.input;setTimeout(()=>{if(r.input.domChangeCount!=s||(r.dom.blur(),r.focus(),r.someProp("handleKeyDown",i=>i(r,qr(8,"Backspace")))))return;let{$cursor:n}=r.state.selection;n&&n.pos>0&&r.dispatch(r.state.tr.delete(n.pos-1,n.pos).scrollIntoView())},50)}};for(let r in dt)ct[r]=dt[r];function On(r,e){if(r==e)return!0;for(let t in r)if(r[t]!==e[t])return!1;for(let t in e)if(!(t in r))return!1;return!0}class Ki{constructor(e,t){this.toDOM=e,this.spec=t||is,this.side=this.spec.side||0}map(e,t,s,n){let{pos:i,deleted:o}=e.mapResult(t.from+n,this.side<0?-1:1);return o?null:new Nt(i-s,i-s,this)}valid(){return!0}eq(e){return this==e||e instanceof Ki&&(this.spec.key&&this.spec.key==e.spec.key||this.toDOM==e.toDOM&&On(this.spec,e.spec))}destroy(e){this.spec.destroy&&this.spec.destroy(e)}}class Tr{constructor(e,t){this.attrs=e,this.spec=t||is}map(e,t,s,n){let i=e.map(t.from+n,this.spec.inclusiveStart?-1:1)-s,o=e.map(t.to+n,this.spec.inclusiveEnd?1:-1)-s;return i>=o?null:new Nt(i,o,this)}valid(e,t){return t.from<t.to}eq(e){return this==e||e instanceof Tr&&On(this.attrs,e.attrs)&&On(this.spec,e.spec)}static is(e){return e.type instanceof Tr}destroy(){}}class uc{constructor(e,t){this.attrs=e,this.spec=t||is}map(e,t,s,n){let i=e.mapResult(t.from+n,1);if(i.deleted)return null;let o=e.mapResult(t.to+n,-1);return o.deleted||o.pos<=i.pos?null:new Nt(i.pos-s,o.pos-s,this)}valid(e,t){let{index:s,offset:n}=e.content.findIndex(t.from),i;return n==t.from&&!(i=e.child(s)).isText&&n+i.nodeSize==t.to}eq(e){return this==e||e instanceof uc&&On(this.attrs,e.attrs)&&On(this.spec,e.spec)}destroy(){}}class Nt{constructor(e,t,s){this.from=e,this.to=t,this.type=s}copy(e,t){return new Nt(e,t,this.type)}eq(e,t=0){return this.type.eq(e.type)&&this.from+t==e.from&&this.to+t==e.to}map(e,t,s){return this.type.map(e,this,t,s)}static widget(e,t,s){return new Nt(e,e,new Ki(t,s))}static inline(e,t,s,n){return new Nt(e,t,new Tr(s,n))}static node(e,t,s,n){return new Nt(e,t,new uc(s,n))}get spec(){return this.type.spec}get inline(){return this.type instanceof Tr}get widget(){return this.type instanceof Ki}}const Rs=[],is={};class Be{constructor(e,t){this.local=e.length?e:Rs,this.children=t.length?t:Rs}static create(e,t){return t.length?Gi(t,e,0,is):tt}find(e,t,s){let n=[];return this.findInner(e??0,t??1e9,n,0,s),n}findInner(e,t,s,n,i){for(let o=0;o<this.local.length;o++){let l=this.local[o];l.from<=t&&l.to>=e&&(!i||i(l.spec))&&s.push(l.copy(l.from+n,l.to+n))}for(let o=0;o<this.children.length;o+=3)if(this.children[o]<t&&this.children[o+1]>e){let l=this.children[o]+1;this.children[o+2].findInner(e-l,t-l,s,n+l,i)}}map(e,t,s){return this==tt||e.maps.length==0?this:this.mapInner(e,t,0,0,s||is)}mapInner(e,t,s,n,i){let o;for(let l=0;l<this.local.length;l++){let c=this.local[l].map(e,s,n);c&&c.type.valid(t,c)?(o||(o=[])).push(c):i.onRemove&&i.onRemove(this.local[l].spec)}return this.children.length?Jv(this.children,o||[],e,t,s,n,i):o?new Be(o.sort(as),Rs):tt}add(e,t){return t.length?this==tt?Be.create(e,t):this.addInner(e,t,0):this}addInner(e,t,s){let n,i=0;e.forEach((l,c)=>{let d=c+s,u;if(u=vp(t,l,d)){for(n||(n=this.children.slice());i<n.length&&n[i]<c;)i+=3;n[i]==c?n[i+2]=n[i+2].addInner(l,u,d+1):n.splice(i,0,c,c+l.nodeSize,Gi(u,l,d+1,is)),i+=3}});let o=wp(i?Np(t):t,-s);for(let l=0;l<o.length;l++)o[l].type.valid(e,o[l])||o.splice(l--,1);return new Be(o.length?this.local.concat(o).sort(as):this.local,n||this.children)}remove(e){return e.length==0||this==tt?this:this.removeInner(e,0)}removeInner(e,t){let s=this.children,n=this.local;for(let i=0;i<s.length;i+=3){let o,l=s[i]+t,c=s[i+1]+t;for(let u=0,h;u<e.length;u++)(h=e[u])&&h.from>l&&h.to<c&&(e[u]=null,(o||(o=[])).push(h));if(!o)continue;s==this.children&&(s=this.children.slice());let d=s[i+2].removeInner(o,l+1);d!=tt?s[i+2]=d:(s.splice(i,3),i-=3)}if(n.length){for(let i=0,o;i<e.length;i++)if(o=e[i])for(let l=0;l<n.length;l++)n[l].eq(o,t)&&(n==this.local&&(n=this.local.slice()),n.splice(l--,1))}return s==this.children&&n==this.local?this:n.length||s.length?new Be(n,s):tt}forChild(e,t){if(this==tt)return this;if(t.isLeaf)return Be.empty;let s,n;for(let l=0;l<this.children.length;l+=3)if(this.children[l]>=e){this.children[l]==e&&(s=this.children[l+2]);break}let i=e+1,o=i+t.content.size;for(let l=0;l<this.local.length;l++){let c=this.local[l];if(c.from<o&&c.to>i&&c.type instanceof Tr){let d=Math.max(i,c.from)-i,u=Math.min(o,c.to)-i;d<u&&(n||(n=[])).push(c.copy(d,u))}}if(n){let l=new Be(n.sort(as),Rs);return s?new xr([l,s]):l}return s||tt}eq(e){if(this==e)return!0;if(!(e instanceof Be)||this.local.length!=e.local.length||this.children.length!=e.children.length)return!1;for(let t=0;t<this.local.length;t++)if(!this.local[t].eq(e.local[t]))return!1;for(let t=0;t<this.children.length;t+=3)if(this.children[t]!=e.children[t]||this.children[t+1]!=e.children[t+1]||!this.children[t+2].eq(e.children[t+2]))return!1;return!0}locals(e){return hc(this.localsInner(e))}localsInner(e){if(this==tt)return Rs;if(e.inlineContent||!this.local.some(Tr.is))return this.local;let t=[];for(let s=0;s<this.local.length;s++)this.local[s].type instanceof Tr||t.push(this.local[s]);return t}forEachSet(e){e(this)}}Be.empty=new Be([],[]);Be.removeOverlap=hc;const tt=Be.empty;class xr{constructor(e){this.members=e}map(e,t){const s=this.members.map(n=>n.map(e,t,is));return xr.from(s)}forChild(e,t){if(t.isLeaf)return Be.empty;let s=[];for(let n=0;n<this.members.length;n++){let i=this.members[n].forChild(e,t);i!=tt&&(i instanceof xr?s=s.concat(i.members):s.push(i))}return xr.from(s)}eq(e){if(!(e instanceof xr)||e.members.length!=this.members.length)return!1;for(let t=0;t<this.members.length;t++)if(!this.members[t].eq(e.members[t]))return!1;return!0}locals(e){let t,s=!0;for(let n=0;n<this.members.length;n++){let i=this.members[n].localsInner(e);if(i.length)if(!t)t=i;else{s&&(t=t.slice(),s=!1);for(let o=0;o<i.length;o++)t.push(i[o])}}return t?hc(s?t:t.sort(as)):Rs}static from(e){switch(e.length){case 0:return tt;case 1:return e[0];default:return new xr(e.every(t=>t instanceof Be)?e:e.reduce((t,s)=>t.concat(s instanceof Be?s:s.members),[]))}}forEachSet(e){for(let t=0;t<this.members.length;t++)this.members[t].forEachSet(e)}}function Jv(r,e,t,s,n,i,o){let l=r.slice();for(let d=0,u=i;d<t.maps.length;d++){let h=0;t.maps[d].forEach((f,p,m,g)=>{let y=g-m-(p-f);for(let x=0;x<l.length;x+=3){let N=l[x+1];if(N<0||f>N+u-h)continue;let A=l[x]+u-h;p>=A?l[x+1]=f<=A?-2:-1:f>=u&&y&&(l[x]+=y,l[x+1]+=y)}h+=y}),u=t.maps[d].map(u,-1)}let c=!1;for(let d=0;d<l.length;d+=3)if(l[d+1]<0){if(l[d+1]==-2){c=!0,l[d+1]=-1;continue}let u=t.map(r[d]+i),h=u-n;if(h<0||h>=s.content.size){c=!0;continue}let f=t.map(r[d+1]+i,-1),p=f-n,{index:m,offset:g}=s.content.findIndex(h),y=s.maybeChild(m);if(y&&g==h&&g+y.nodeSize==p){let x=l[d+2].mapInner(t,y,u+1,r[d]+i+1,o);x!=tt?(l[d]=h,l[d+1]=p,l[d+2]=x):(l[d+1]=-2,c=!0)}else c=!0}if(c){let d=Xv(l,r,e,t,n,i,o),u=Gi(d,s,0,o);e=u.local;for(let h=0;h<l.length;h+=3)l[h+1]<0&&(l.splice(h,3),h-=3);for(let h=0,f=0;h<u.children.length;h+=3){let p=u.children[h];for(;f<l.length&&l[f]<p;)f+=3;l.splice(f,0,u.children[h],u.children[h+1],u.children[h+2])}}return new Be(e.sort(as),l)}function wp(r,e){if(!e||!r.length)return r;let t=[];for(let s=0;s<r.length;s++){let n=r[s];t.push(new Nt(n.from+e,n.to+e,n.type))}return t}function Xv(r,e,t,s,n,i,o){function l(c,d){for(let u=0;u<c.local.length;u++){let h=c.local[u].map(s,n,d);h?t.push(h):o.onRemove&&o.onRemove(c.local[u].spec)}for(let u=0;u<c.children.length;u+=3)l(c.children[u+2],c.children[u]+d+1)}for(let c=0;c<r.length;c+=3)r[c+1]==-1&&l(r[c+2],e[c]+i+1);return t}function vp(r,e,t){if(e.isLeaf)return null;let s=t+e.nodeSize,n=null;for(let i=0,o;i<r.length;i++)(o=r[i])&&o.from>t&&o.to<s&&((n||(n=[])).push(o),r[i]=null);return n}function Np(r){let e=[];for(let t=0;t<r.length;t++)r[t]!=null&&e.push(r[t]);return e}function Gi(r,e,t,s){let n=[],i=!1;e.forEach((l,c)=>{let d=vp(r,l,c+t);if(d){i=!0;let u=Gi(d,l,t+c+1,s);u!=tt&&n.push(c,c+l.nodeSize,u)}});let o=wp(i?Np(r):r,-t).sort(as);for(let l=0;l<o.length;l++)o[l].type.valid(e,o[l])||(s.onRemove&&s.onRemove(o[l].spec),o.splice(l--,1));return o.length||n.length?new Be(o,n):tt}function as(r,e){return r.from-e.from||r.to-e.to}function hc(r){let e=r;for(let t=0;t<e.length-1;t++){let s=e[t];if(s.from!=s.to)for(let n=t+1;n<e.length;n++){let i=e[n];if(i.from==s.from){i.to!=s.to&&(e==r&&(e=r.slice()),e[n]=i.copy(i.from,s.to),Yd(e,n+1,i.copy(s.to,i.to)));continue}else{i.from<s.to&&(e==r&&(e=r.slice()),e[t]=s.copy(s.from,i.from),Yd(e,n,s.copy(i.from,s.to)));break}}}return e}function Yd(r,e,t){for(;e<r.length&&as(t,r[e])>0;)e++;r.splice(e,0,t)}function va(r){let e=[];return r.someProp("decorations",t=>{let s=t(r.state);s&&s!=tt&&e.push(s)}),r.cursorWrapper&&e.push(Be.create(r.state.doc,[r.cursorWrapper.deco])),xr.from(e)}const Qv={childList:!0,characterData:!0,characterDataOldValue:!0,attributes:!0,attributeOldValue:!0,subtree:!0},Zv=xt&&Mr<=11;class e1{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}set(e){this.anchorNode=e.anchorNode,this.anchorOffset=e.anchorOffset,this.focusNode=e.focusNode,this.focusOffset=e.focusOffset}clear(){this.anchorNode=this.focusNode=null}eq(e){return e.anchorNode==this.anchorNode&&e.anchorOffset==this.anchorOffset&&e.focusNode==this.focusNode&&e.focusOffset==this.focusOffset}}class t1{constructor(e,t){this.view=e,this.handleDOMChange=t,this.queue=[],this.flushingSoon=-1,this.observer=null,this.currentSelection=new e1,this.onCharData=null,this.suppressingSelectionUpdates=!1,this.lastChangedTextNode=null,this.observer=window.MutationObserver&&new window.MutationObserver(s=>{for(let n=0;n<s.length;n++)this.queue.push(s[n]);xt&&Mr<=11&&s.some(n=>n.type=="childList"&&n.removedNodes.length||n.type=="characterData"&&n.oldValue.length>n.target.nodeValue.length)?this.flushSoon():this.flush()}),Zv&&(this.onCharData=s=>{this.queue.push({target:s.target,type:"characterData",oldValue:s.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this)}flushSoon(){this.flushingSoon<0&&(this.flushingSoon=window.setTimeout(()=>{this.flushingSoon=-1,this.flush()},20))}forceFlush(){this.flushingSoon>-1&&(window.clearTimeout(this.flushingSoon),this.flushingSoon=-1,this.flush())}start(){this.observer&&(this.observer.takeRecords(),this.observer.observe(this.view.dom,Qv)),this.onCharData&&this.view.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.connectSelection()}stop(){if(this.observer){let e=this.observer.takeRecords();if(e.length){for(let t=0;t<e.length;t++)this.queue.push(e[t]);window.setTimeout(()=>this.flush(),20)}this.observer.disconnect()}this.onCharData&&this.view.dom.removeEventListener("DOMCharacterDataModified",this.onCharData),this.disconnectSelection()}connectSelection(){this.view.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}disconnectSelection(){this.view.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange)}suppressSelectionUpdates(){this.suppressingSelectionUpdates=!0,setTimeout(()=>this.suppressingSelectionUpdates=!1,50)}onSelectionChange(){if(Ud(this.view)){if(this.suppressingSelectionUpdates)return ir(this.view);if(xt&&Mr<=11&&!this.view.state.selection.empty){let e=this.view.domSelectionRange();if(e.focusNode&&gs(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset))return this.flushSoon()}this.flush()}}setCurSelection(){this.currentSelection.set(this.view.domSelectionRange())}ignoreSelectionChange(e){if(!e.focusNode)return!0;let t=new Set,s;for(let i=e.focusNode;i;i=Hs(i))t.add(i);for(let i=e.anchorNode;i;i=Hs(i))if(t.has(i)){s=i;break}let n=s&&this.view.docView.nearestDesc(s);if(n&&n.ignoreMutation({type:"selection",target:s.nodeType==3?s.parentNode:s}))return this.setCurSelection(),!0}pendingRecords(){if(this.observer)for(let e of this.observer.takeRecords())this.queue.push(e);return this.queue}flush(){let{view:e}=this;if(!e.docView||this.flushingSoon>-1)return;let t=this.pendingRecords();t.length&&(this.queue=[]);let s=e.domSelectionRange(),n=!this.suppressingSelectionUpdates&&!this.currentSelection.eq(s)&&Ud(e)&&!this.ignoreSelectionChange(s),i=-1,o=-1,l=!1,c=[];if(e.editable)for(let u=0;u<t.length;u++){let h=this.registerMutation(t[u],c);h&&(i=i<0?h.from:Math.min(h.from,i),o=o<0?h.to:Math.max(h.to,o),h.typeOver&&(l=!0))}if(Pt&&c.length){let u=c.filter(h=>h.nodeName=="BR");if(u.length==2){let[h,f]=u;h.parentNode&&h.parentNode.parentNode==f.parentNode?f.remove():h.remove()}else{let{focusNode:h}=this.currentSelection;for(let f of u){let p=f.parentNode;p&&p.nodeName=="LI"&&(!h||n1(e,h)!=p)&&f.remove()}}}let d=null;i<0&&n&&e.input.lastFocus>Date.now()-200&&Math.max(e.input.lastTouch,e.input.lastClick.time)<Date.now()-300&&Ho(s)&&(d=ic(e))&&d.eq(de.near(e.state.doc.resolve(0),1))?(e.input.lastFocus=0,ir(e),this.currentSelection.set(s),e.scrollToSelection()):(i>-1||n)&&(i>-1&&(e.docView.markDirty(i,o),r1(e)),this.handleDOMChange(i,o,l,c),e.docView&&e.docView.dirty?e.updateState(e.state):this.currentSelection.eq(s)||ir(e),this.currentSelection.set(s))}registerMutation(e,t){if(t.indexOf(e.target)>-1)return null;let s=this.view.docView.nearestDesc(e.target);if(e.type=="attributes"&&(s==this.view.docView||e.attributeName=="contenteditable"||e.attributeName=="style"&&!e.oldValue&&!e.target.getAttribute("style"))||!s||s.ignoreMutation(e))return null;if(e.type=="childList"){for(let u=0;u<e.addedNodes.length;u++){let h=e.addedNodes[u];t.push(h),h.nodeType==3&&(this.lastChangedTextNode=h)}if(s.contentDOM&&s.contentDOM!=s.dom&&!s.contentDOM.contains(e.target))return{from:s.posBefore,to:s.posAfter};let n=e.previousSibling,i=e.nextSibling;if(xt&&Mr<=11&&e.addedNodes.length)for(let u=0;u<e.addedNodes.length;u++){let{previousSibling:h,nextSibling:f}=e.addedNodes[u];(!h||Array.prototype.indexOf.call(e.addedNodes,h)<0)&&(n=h),(!f||Array.prototype.indexOf.call(e.addedNodes,f)<0)&&(i=f)}let o=n&&n.parentNode==e.target?Qe(n)+1:0,l=s.localPosFromDOM(e.target,o,-1),c=i&&i.parentNode==e.target?Qe(i):e.target.childNodes.length,d=s.localPosFromDOM(e.target,c,1);return{from:l,to:d}}else return e.type=="attributes"?{from:s.posAtStart-s.border,to:s.posAtEnd+s.border}:(this.lastChangedTextNode=e.target,{from:s.posAtStart,to:s.posAtEnd,typeOver:e.target.nodeValue==e.oldValue})}}let Jd=new WeakMap,Xd=!1;function r1(r){if(!Jd.has(r)&&(Jd.set(r,null),["normal","nowrap","pre-line"].indexOf(getComputedStyle(r.dom).whiteSpace)!==-1)){if(r.requiresGeckoHackNode=Pt,Xd)return;console.warn("ProseMirror expects the CSS white-space property to be set, preferably to 'pre-wrap'. It is recommended to load style/prosemirror.css from the prosemirror-view package."),Xd=!0}}function Qd(r,e){let t=e.startContainer,s=e.startOffset,n=e.endContainer,i=e.endOffset,o=r.domAtPos(r.state.selection.anchor);return gs(o.node,o.offset,n,i)&&([t,s,n,i]=[n,i,t,s]),{anchorNode:t,anchorOffset:s,focusNode:n,focusOffset:i}}function s1(r,e){if(e.getComposedRanges){let n=e.getComposedRanges(r.root)[0];if(n)return Qd(r,n)}let t;function s(n){n.preventDefault(),n.stopImmediatePropagation(),t=n.getTargetRanges()[0]}return r.dom.addEventListener("beforeinput",s,!0),document.execCommand("indent"),r.dom.removeEventListener("beforeinput",s,!0),t?Qd(r,t):null}function n1(r,e){for(let t=e.parentNode;t&&t!=r.dom;t=t.parentNode){let s=r.docView.nearestDesc(t,!0);if(s&&s.node.isBlock)return t}return null}function i1(r,e,t){let{node:s,fromOffset:n,toOffset:i,from:o,to:l}=r.docView.parseRange(e,t),c=r.domSelectionRange(),d,u=c.anchorNode;if(u&&r.dom.contains(u.nodeType==1?u:u.parentNode)&&(d=[{node:u,offset:c.anchorOffset}],Ho(c)||d.push({node:c.focusNode,offset:c.focusOffset})),st&&r.input.lastKeyCode===8)for(let y=i;y>n;y--){let x=s.childNodes[y-1],N=x.pmViewDesc;if(x.nodeName=="BR"&&!N){i=y;break}if(!N||N.size)break}let h=r.state.doc,f=r.someProp("domParser")||Cr.fromSchema(r.state.schema),p=h.resolve(o),m=null,g=f.parse(s,{topNode:p.parent,topMatch:p.parent.contentMatchAt(p.index()),topOpen:!0,from:n,to:i,preserveWhitespace:p.parent.type.whitespace=="pre"?"full":!0,findPositions:d,ruleFromNode:o1,context:p});if(d&&d[0].pos!=null){let y=d[0].pos,x=d[1]&&d[1].pos;x==null&&(x=y),m={anchor:y+o,head:x+o}}return{doc:g,sel:m,from:o,to:l}}function o1(r){let e=r.pmViewDesc;if(e)return e.parseRule();if(r.nodeName=="BR"&&r.parentNode){if(lt&&/^(ul|ol)$/i.test(r.parentNode.nodeName)){let t=document.createElement("div");return t.appendChild(document.createElement("li")),{skip:t}}else if(r.parentNode.lastChild==r||lt&&/^(tr|table)$/i.test(r.parentNode.nodeName))return{ignore:!0}}else if(r.nodeName=="IMG"&&r.getAttribute("mark-placeholder"))return{ignore:!0};return null}const a1=/^(a|abbr|acronym|b|bd[io]|big|br|button|cite|code|data(list)?|del|dfn|em|i|ins|kbd|label|map|mark|meter|output|q|ruby|s|samp|small|span|strong|su[bp]|time|u|tt|var)$/i;function l1(r,e,t,s,n){let i=r.input.compositionPendingChanges||(r.composing?r.input.compositionID:0);if(r.input.compositionPendingChanges=0,e<0){let w=r.input.lastSelectionTime>Date.now()-50?r.input.lastSelectionOrigin:null,v=ic(r,w);if(v&&!r.state.selection.eq(v)){if(st&&rr&&r.input.lastKeyCode===13&&Date.now()-100<r.input.lastKeyCodeTime&&r.someProp("handleKeyDown",C=>C(r,qr(13,"Enter"))))return;let D=r.state.tr.setSelection(v);w=="pointer"?D.setMeta("pointer",!0):w=="key"&&D.scrollIntoView(),i&&D.setMeta("composition",i),r.dispatch(D)}return}let o=r.state.doc.resolve(e),l=o.sharedDepth(t);e=o.before(l+1),t=r.state.doc.resolve(t).after(l+1);let c=r.state.selection,d=i1(r,e,t),u=r.state.doc,h=u.slice(d.from,d.to),f,p;r.input.lastKeyCode===8&&Date.now()-100<r.input.lastKeyCodeTime?(f=r.state.selection.to,p="end"):(f=r.state.selection.from,p="start"),r.input.lastKeyCode=null;let m=u1(h.content,d.doc.content,d.from,f,p);if(m&&r.input.domChangeCount++,(Vs&&r.input.lastIOSEnter>Date.now()-225||rr)&&n.some(w=>w.nodeType==1&&!a1.test(w.nodeName))&&(!m||m.endA>=m.endB)&&r.someProp("handleKeyDown",w=>w(r,qr(13,"Enter")))){r.input.lastIOSEnter=0;return}if(!m)if(s&&c instanceof ce&&!c.empty&&c.$head.sameParent(c.$anchor)&&!r.composing&&!(d.sel&&d.sel.anchor!=d.sel.head))m={start:c.from,endA:c.to,endB:c.to};else{if(d.sel){let w=Zd(r,r.state.doc,d.sel);if(w&&!w.eq(r.state.selection)){let v=r.state.tr.setSelection(w);i&&v.setMeta("composition",i),r.dispatch(v)}}return}r.state.selection.from<r.state.selection.to&&m.start==m.endB&&r.state.selection instanceof ce&&(m.start>r.state.selection.from&&m.start<=r.state.selection.from+2&&r.state.selection.from>=d.from?m.start=r.state.selection.from:m.endA<r.state.selection.to&&m.endA>=r.state.selection.to-2&&r.state.selection.to<=d.to&&(m.endB+=r.state.selection.to-m.endA,m.endA=r.state.selection.to)),xt&&Mr<=11&&m.endB==m.start+1&&m.endA==m.start&&m.start>d.from&&d.doc.textBetween(m.start-d.from-1,m.start-d.from+1)=="  "&&(m.start--,m.endA--,m.endB--);let g=d.doc.resolveNoCache(m.start-d.from),y=d.doc.resolveNoCache(m.endB-d.from),x=u.resolve(m.start),N=g.sameParent(y)&&g.parent.inlineContent&&x.end()>=m.endA,A;if((Vs&&r.input.lastIOSEnter>Date.now()-225&&(!N||n.some(w=>w.nodeName=="DIV"||w.nodeName=="P"))||!N&&g.pos<d.doc.content.size&&(!g.sameParent(y)||!g.parent.inlineContent)&&!/\S/.test(d.doc.textBetween(g.pos,y.pos,"",""))&&(A=de.findFrom(d.doc.resolve(g.pos+1),1,!0))&&A.head>g.pos)&&r.someProp("handleKeyDown",w=>w(r,qr(13,"Enter")))){r.input.lastIOSEnter=0;return}if(r.state.selection.anchor>m.start&&d1(u,m.start,m.endA,g,y)&&r.someProp("handleKeyDown",w=>w(r,qr(8,"Backspace")))){rr&&st&&r.domObserver.suppressSelectionUpdates();return}st&&m.endB==m.start&&(r.input.lastChromeDelete=Date.now()),rr&&!N&&g.start()!=y.start()&&y.parentOffset==0&&g.depth==y.depth&&d.sel&&d.sel.anchor==d.sel.head&&d.sel.head==m.endA&&(m.endB-=2,y=d.doc.resolveNoCache(m.endB-d.from),setTimeout(()=>{r.someProp("handleKeyDown",function(w){return w(r,qr(13,"Enter"))})},20));let S=m.start,k=m.endA,R=w=>{let v=w||r.state.tr.replace(S,k,d.doc.slice(m.start-d.from,m.endB-d.from));if(d.sel){let D=Zd(r,v.doc,d.sel);D&&!(st&&r.composing&&D.empty&&(m.start!=m.endB||r.input.lastChromeDelete<Date.now()-100)&&(D.head==S||D.head==v.mapping.map(k)-1)||xt&&D.empty&&D.head==S)&&v.setSelection(D)}return i&&v.setMeta("composition",i),v.scrollIntoView()},j;if(N){if(g.pos==y.pos){xt&&Mr<=11&&g.parentOffset==0&&(r.domObserver.suppressSelectionUpdates(),setTimeout(()=>ir(r),20));let w=R(r.state.tr.delete(S,k)),v=u.resolve(m.start).marksAcross(u.resolve(m.endA));v&&w.ensureMarks(v),r.dispatch(w)}else if(m.endA==m.endB&&(j=c1(g.parent.content.cut(g.parentOffset,y.parentOffset),x.parent.content.cut(x.parentOffset,m.endA-x.start())))){let w=R(r.state.tr);j.type=="add"?w.addMark(S,k,j.mark):w.removeMark(S,k,j.mark),r.dispatch(w)}else if(g.parent.child(g.index()).isText&&g.index()==y.index()-(y.textOffset?0:1)){let w=g.parent.textBetween(g.parentOffset,y.parentOffset),v=()=>R(r.state.tr.insertText(w,S,k));r.someProp("handleTextInput",D=>D(r,S,k,w,v))||r.dispatch(v())}}else r.dispatch(R())}function Zd(r,e,t){return Math.max(t.anchor,t.head)>e.content.size?null:oc(r,e.resolve(t.anchor),e.resolve(t.head))}function c1(r,e){let t=r.firstChild.marks,s=e.firstChild.marks,n=t,i=s,o,l,c;for(let u=0;u<s.length;u++)n=s[u].removeFromSet(n);for(let u=0;u<t.length;u++)i=t[u].removeFromSet(i);if(n.length==1&&i.length==0)l=n[0],o="add",c=u=>u.mark(l.addToSet(u.marks));else if(n.length==0&&i.length==1)l=i[0],o="remove",c=u=>u.mark(l.removeFromSet(u.marks));else return null;let d=[];for(let u=0;u<e.childCount;u++)d.push(c(e.child(u)));if(z.from(d).eq(r))return{mark:l,type:o}}function d1(r,e,t,s,n){if(t-e<=n.pos-s.pos||Na(s,!0,!1)<n.pos)return!1;let i=r.resolve(e);if(!s.parent.isTextblock){let l=i.nodeAfter;return l!=null&&t==e+l.nodeSize}if(i.parentOffset<i.parent.content.size||!i.parent.isTextblock)return!1;let o=r.resolve(Na(i,!0,!0));return!o.parent.isTextblock||o.pos>t||Na(o,!0,!1)<t?!1:s.parent.content.cut(s.parentOffset).eq(o.parent.content)}function Na(r,e,t){let s=r.depth,n=e?r.end():r.pos;for(;s>0&&(e||r.indexAfter(s)==r.node(s).childCount);)s--,n++,e=!1;if(t){let i=r.node(s).maybeChild(r.indexAfter(s));for(;i&&!i.isLeaf;)i=i.firstChild,n++}return n}function u1(r,e,t,s,n){let i=r.findDiffStart(e,t);if(i==null)return null;let{a:o,b:l}=r.findDiffEnd(e,t+r.size,t+e.size);if(n=="end"){let c=Math.max(0,i-Math.min(o,l));s-=o+c-i}if(o<i&&r.size<e.size){let c=s<=i&&s>=o?i-s:0;i-=c,i&&i<e.size&&eu(e.textBetween(i-1,i+1))&&(i+=c?1:-1),l=i+(l-o),o=i}else if(l<i){let c=s<=i&&s>=l?i-s:0;i-=c,i&&i<r.size&&eu(r.textBetween(i-1,i+1))&&(i+=c?1:-1),o=i+(o-l),l=i}return{start:i,endA:o,endB:l}}function eu(r){if(r.length!=2)return!1;let e=r.charCodeAt(0),t=r.charCodeAt(1);return e>=56320&&e<=57343&&t>=55296&&t<=56319}class jp{constructor(e,t){this._root=null,this.focused=!1,this.trackWrites=null,this.mounted=!1,this.markCursor=null,this.cursorWrapper=null,this.lastSelectedViewDesc=void 0,this.input=new Dv,this.prevDirectPlugins=[],this.pluginViews=[],this.requiresGeckoHackNode=!1,this.dragging=null,this._props=t,this.state=t.state,this.directPlugins=t.plugins||[],this.directPlugins.forEach(iu),this.dispatch=this.dispatch.bind(this),this.dom=e&&e.mount||document.createElement("div"),e&&(e.appendChild?e.appendChild(this.dom):typeof e=="function"?e(this.dom):e.mount&&(this.mounted=!0)),this.editable=su(this),ru(this),this.nodeViews=nu(this),this.docView=Pd(this.state.doc,tu(this),va(this),this.dom,this),this.domObserver=new t1(this,(s,n,i,o)=>l1(this,s,n,i,o)),this.domObserver.start(),Tv(this),this.updatePluginViews()}get composing(){return this.input.composing}get props(){if(this._props.state!=this.state){let e=this._props;this._props={};for(let t in e)this._props[t]=e[t];this._props.state=this.state}return this._props}update(e){e.handleDOMEvents!=this._props.handleDOMEvents&&yl(this);let t=this._props;this._props=e,e.plugins&&(e.plugins.forEach(iu),this.directPlugins=e.plugins),this.updateStateInner(e.state,t)}setProps(e){let t={};for(let s in this._props)t[s]=this._props[s];t.state=this.state;for(let s in e)t[s]=e[s];this.update(t)}updateState(e){this.updateStateInner(e,this._props)}updateStateInner(e,t){var s;let n=this.state,i=!1,o=!1;e.storedMarks&&this.composing&&(gp(this),o=!0),this.state=e;let l=n.plugins!=e.plugins||this._props.plugins!=t.plugins;if(l||this._props.plugins!=t.plugins||this._props.nodeViews!=t.nodeViews){let p=nu(this);f1(p,this.nodeViews)&&(this.nodeViews=p,i=!0)}(l||t.handleDOMEvents!=this._props.handleDOMEvents)&&yl(this),this.editable=su(this),ru(this);let c=va(this),d=tu(this),u=n.plugins!=e.plugins&&!n.doc.eq(e.doc)?"reset":e.scrollToSelection>n.scrollToSelection?"to selection":"preserve",h=i||!this.docView.matchesNode(e.doc,d,c);(h||!e.selection.eq(n.selection))&&(o=!0);let f=u=="preserve"&&o&&this.dom.style.overflowAnchor==null&&Vw(this);if(o){this.domObserver.stop();let p=h&&(xt||st)&&!this.composing&&!n.selection.empty&&!e.selection.empty&&h1(n.selection,e.selection);if(h){let m=st?this.trackWrites=this.domSelectionRange().focusNode:null;this.composing&&(this.input.compositionNode=Hv(this)),(i||!this.docView.update(e.doc,d,c,this))&&(this.docView.updateOuterDeco(d),this.docView.destroy(),this.docView=Pd(e.doc,d,c,this.dom,this)),m&&!this.trackWrites&&(p=!0)}p||!(this.input.mouseDown&&this.domObserver.currentSelection.eq(this.domSelectionRange())&&mv(this))?ir(this,p):(np(this,e.selection),this.domObserver.setCurSelection()),this.domObserver.start()}this.updatePluginViews(n),!((s=this.dragging)===null||s===void 0)&&s.node&&!n.doc.eq(e.doc)&&this.updateDraggedNode(this.dragging,n),u=="reset"?this.dom.scrollTop=0:u=="to selection"?this.scrollToSelection():f&&qw(f)}scrollToSelection(){let e=this.domSelectionRange().focusNode;if(!(!e||!this.dom.contains(e.nodeType==1?e:e.parentNode))){if(!this.someProp("handleScrollToSelection",t=>t(this)))if(this.state.selection instanceof se){let t=this.docView.domAfterPos(this.state.selection.from);t.nodeType==1&&Md(this,t.getBoundingClientRect(),e)}else Md(this,this.coordsAtPos(this.state.selection.head,1),e)}}destroyPluginViews(){let e;for(;e=this.pluginViews.pop();)e.destroy&&e.destroy()}updatePluginViews(e){if(!e||e.plugins!=this.state.plugins||this.directPlugins!=this.prevDirectPlugins){this.prevDirectPlugins=this.directPlugins,this.destroyPluginViews();for(let t=0;t<this.directPlugins.length;t++){let s=this.directPlugins[t];s.spec.view&&this.pluginViews.push(s.spec.view(this))}for(let t=0;t<this.state.plugins.length;t++){let s=this.state.plugins[t];s.spec.view&&this.pluginViews.push(s.spec.view(this))}}else for(let t=0;t<this.pluginViews.length;t++){let s=this.pluginViews[t];s.update&&s.update(this,e)}}updateDraggedNode(e,t){let s=e.node,n=-1;if(this.state.doc.nodeAt(s.from)==s.node)n=s.from;else{let i=s.from+(this.state.doc.content.size-t.doc.content.size);(i>0&&this.state.doc.nodeAt(i))==s.node&&(n=i)}this.dragging=new yp(e.slice,e.move,n<0?void 0:se.create(this.state.doc,n))}someProp(e,t){let s=this._props&&this._props[e],n;if(s!=null&&(n=t?t(s):s))return n;for(let o=0;o<this.directPlugins.length;o++){let l=this.directPlugins[o].props[e];if(l!=null&&(n=t?t(l):l))return n}let i=this.state.plugins;if(i)for(let o=0;o<i.length;o++){let l=i[o].props[e];if(l!=null&&(n=t?t(l):l))return n}}hasFocus(){if(xt){let e=this.root.activeElement;if(e==this.dom)return!0;if(!e||!this.dom.contains(e))return!1;for(;e&&this.dom!=e&&this.dom.contains(e);){if(e.contentEditable=="false")return!1;e=e.parentElement}return!0}return this.root.activeElement==this.dom}focus(){this.domObserver.stop(),this.editable&&Kw(this.dom),ir(this),this.domObserver.start()}get root(){let e=this._root;if(e==null){for(let t=this.dom.parentNode;t;t=t.parentNode)if(t.nodeType==9||t.nodeType==11&&t.host)return t.getSelection||(Object.getPrototypeOf(t).getSelection=()=>t.ownerDocument.getSelection()),this._root=t}return e||document}updateRoot(){this._root=null}posAtCoords(e){return Qw(this,e)}coordsAtPos(e,t=1){return Jf(this,e,t)}domAtPos(e,t=0){return this.docView.domFromPos(e,t)}nodeDOM(e){let t=this.docView.descAt(e);return t?t.nodeDOM:null}posAtDOM(e,t,s=-1){let n=this.docView.posFromDOM(e,t,s);if(n==null)throw new RangeError("DOM position not inside the editor");return n}endOfTextblock(e,t){return sv(this,t||this.state,e)}pasteHTML(e,t){return Tn(this,"",e,!1,t||new ClipboardEvent("paste"))}pasteText(e,t){return Tn(this,e,null,!0,t||new ClipboardEvent("paste"))}serializeForClipboard(e){return ac(this,e)}destroy(){this.docView&&(Ov(this),this.destroyPluginViews(),this.mounted?(this.docView.update(this.state.doc,[],va(this),this),this.dom.textContent=""):this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.docView.destroy(),this.docView=null,Iw())}get isDestroyed(){return this.docView==null}dispatchEvent(e){return Iv(this,e)}domSelectionRange(){let e=this.domSelection();return e?lt&&this.root.nodeType===11&&Fw(this.dom.ownerDocument)==this.dom&&s1(this,e)||e:{focusNode:null,focusOffset:0,anchorNode:null,anchorOffset:0}}domSelection(){return this.root.getSelection()}}jp.prototype.dispatch=function(r){let e=this._props.dispatchTransaction;e?e.call(this,r):this.updateState(this.state.apply(r))};function tu(r){let e=Object.create(null);return e.class="ProseMirror",e.contenteditable=String(r.editable),r.someProp("attributes",t=>{if(typeof t=="function"&&(t=t(r.state)),t)for(let s in t)s=="class"?e.class+=" "+t[s]:s=="style"?e.style=(e.style?e.style+";":"")+t[s]:!e[s]&&s!="contenteditable"&&s!="nodeName"&&(e[s]=String(t[s]))}),e.translate||(e.translate="no"),[Nt.node(0,r.state.doc.content.size,e)]}function ru(r){if(r.markCursor){let e=document.createElement("img");e.className="ProseMirror-separator",e.setAttribute("mark-placeholder","true"),e.setAttribute("alt",""),r.cursorWrapper={dom:e,deco:Nt.widget(r.state.selection.from,e,{raw:!0,marks:r.markCursor})}}else r.cursorWrapper=null}function su(r){return!r.someProp("editable",e=>e(r.state)===!1)}function h1(r,e){let t=Math.min(r.$anchor.sharedDepth(r.head),e.$anchor.sharedDepth(e.head));return r.$anchor.start(t)!=e.$anchor.start(t)}function nu(r){let e=Object.create(null);function t(s){for(let n in s)Object.prototype.hasOwnProperty.call(e,n)||(e[n]=s[n])}return r.someProp("nodeViews",t),r.someProp("markViews",t),e}function f1(r,e){let t=0,s=0;for(let n in r){if(r[n]!=e[n])return!0;t++}for(let n in e)s++;return t!=s}function iu(r){if(r.spec.state||r.spec.filterTransaction||r.spec.appendTransaction)throw new RangeError("Plugins passed directly to the view must not have a state component")}var Rr={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},Yi={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},p1=typeof navigator<"u"&&/Mac/.test(navigator.platform),m1=typeof navigator<"u"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent);for(var Ze=0;Ze<10;Ze++)Rr[48+Ze]=Rr[96+Ze]=String(Ze);for(var Ze=1;Ze<=24;Ze++)Rr[Ze+111]="F"+Ze;for(var Ze=65;Ze<=90;Ze++)Rr[Ze]=String.fromCharCode(Ze+32),Yi[Ze]=String.fromCharCode(Ze);for(var ja in Rr)Yi.hasOwnProperty(ja)||(Yi[ja]=Rr[ja]);function g1(r){var e=p1&&r.metaKey&&r.shiftKey&&!r.ctrlKey&&!r.altKey||m1&&r.shiftKey&&r.key&&r.key.length==1||r.key=="Unidentified",t=!e&&r.key||(r.shiftKey?Yi:Rr)[r.keyCode]||r.key||"Unidentified";return t=="Esc"&&(t="Escape"),t=="Del"&&(t="Delete"),t=="Left"&&(t="ArrowLeft"),t=="Up"&&(t="ArrowUp"),t=="Right"&&(t="ArrowRight"),t=="Down"&&(t="ArrowDown"),t}const x1=typeof navigator<"u"&&/Mac|iP(hone|[oa]d)/.test(navigator.platform),y1=typeof navigator<"u"&&/Win/.test(navigator.platform);function b1(r){let e=r.split(/-(?!$)/),t=e[e.length-1];t=="Space"&&(t=" ");let s,n,i,o;for(let l=0;l<e.length-1;l++){let c=e[l];if(/^(cmd|meta|m)$/i.test(c))o=!0;else if(/^a(lt)?$/i.test(c))s=!0;else if(/^(c|ctrl|control)$/i.test(c))n=!0;else if(/^s(hift)?$/i.test(c))i=!0;else if(/^mod$/i.test(c))x1?o=!0:n=!0;else throw new Error("Unrecognized modifier name: "+c)}return s&&(t="Alt-"+t),n&&(t="Ctrl-"+t),o&&(t="Meta-"+t),i&&(t="Shift-"+t),t}function w1(r){let e=Object.create(null);for(let t in r)e[b1(t)]=r[t];return e}function ka(r,e,t=!0){return e.altKey&&(r="Alt-"+r),e.ctrlKey&&(r="Ctrl-"+r),e.metaKey&&(r="Meta-"+r),t&&e.shiftKey&&(r="Shift-"+r),r}function v1(r){return new Je({props:{handleKeyDown:kp(r)}})}function kp(r){let e=w1(r);return function(t,s){let n=g1(s),i,o=e[ka(n,s)];if(o&&o(t.state,t.dispatch,t))return!0;if(n.length==1&&n!=" "){if(s.shiftKey){let l=e[ka(n,s,!1)];if(l&&l(t.state,t.dispatch,t))return!0}if((s.altKey||s.metaKey||s.ctrlKey)&&!(y1&&s.ctrlKey&&s.altKey)&&(i=Rr[s.keyCode])&&i!=n){let l=e[ka(i,s)];if(l&&l(t.state,t.dispatch,t))return!0}}return!1}}const fc=(r,e)=>r.selection.empty?!1:(e&&e(r.tr.deleteSelection().scrollIntoView()),!0);function Sp(r,e){let{$cursor:t}=r.selection;return!t||(e?!e.endOfTextblock("backward",r):t.parentOffset>0)?null:t}const Ep=(r,e,t)=>{let s=Sp(r,t);if(!s)return!1;let n=pc(s);if(!n){let o=s.blockRange(),l=o&&Zs(o);return l==null?!1:(e&&e(r.tr.lift(o,l).scrollIntoView()),!0)}let i=n.nodeBefore;if(Pp(r,n,e,-1))return!0;if(s.parent.content.size==0&&(qs(i,"end")||se.isSelectable(i)))for(let o=s.depth;;o--){let l=zo(r.doc,s.before(o),s.after(o),Q.empty);if(l&&l.slice.size<l.to-l.from){if(e){let c=r.tr.step(l);c.setSelection(qs(i,"end")?de.findFrom(c.doc.resolve(c.mapping.map(n.pos,-1)),-1):se.create(c.doc,n.pos-i.nodeSize)),e(c.scrollIntoView())}return!0}if(o==1||s.node(o-1).childCount>1)break}return i.isAtom&&n.depth==s.depth-1?(e&&e(r.tr.delete(n.pos-i.nodeSize,n.pos).scrollIntoView()),!0):!1},N1=(r,e,t)=>{let s=Sp(r,t);if(!s)return!1;let n=pc(s);return n?Ap(r,n,e):!1},j1=(r,e,t)=>{let s=Mp(r,t);if(!s)return!1;let n=mc(s);return n?Ap(r,n,e):!1};function Ap(r,e,t){let s=e.nodeBefore,n=s,i=e.pos-1;for(;!n.isTextblock;i--){if(n.type.spec.isolating)return!1;let u=n.lastChild;if(!u)return!1;n=u}let o=e.nodeAfter,l=o,c=e.pos+1;for(;!l.isTextblock;c++){if(l.type.spec.isolating)return!1;let u=l.firstChild;if(!u)return!1;l=u}let d=zo(r.doc,i,c,Q.empty);if(!d||d.from!=i||d instanceof Ve&&d.slice.size>=c-i)return!1;if(t){let u=r.tr.step(d);u.setSelection(ce.create(u.doc,i)),t(u.scrollIntoView())}return!0}function qs(r,e,t=!1){for(let s=r;s;s=e=="start"?s.firstChild:s.lastChild){if(s.isTextblock)return!0;if(t&&s.childCount!=1)return!1}return!1}const Cp=(r,e,t)=>{let{$head:s,empty:n}=r.selection,i=s;if(!n)return!1;if(s.parent.isTextblock){if(t?!t.endOfTextblock("backward",r):s.parentOffset>0)return!1;i=pc(s)}let o=i&&i.nodeBefore;return!o||!se.isSelectable(o)?!1:(e&&e(r.tr.setSelection(se.create(r.doc,i.pos-o.nodeSize)).scrollIntoView()),!0)};function pc(r){if(!r.parent.type.spec.isolating)for(let e=r.depth-1;e>=0;e--){if(r.index(e)>0)return r.doc.resolve(r.before(e+1));if(r.node(e).type.spec.isolating)break}return null}function Mp(r,e){let{$cursor:t}=r.selection;return!t||(e?!e.endOfTextblock("forward",r):t.parentOffset<t.parent.content.size)?null:t}const Dp=(r,e,t)=>{let s=Mp(r,t);if(!s)return!1;let n=mc(s);if(!n)return!1;let i=n.nodeAfter;if(Pp(r,n,e,1))return!0;if(s.parent.content.size==0&&(qs(i,"start")||se.isSelectable(i))){let o=zo(r.doc,s.before(),s.after(),Q.empty);if(o&&o.slice.size<o.to-o.from){if(e){let l=r.tr.step(o);l.setSelection(qs(i,"start")?de.findFrom(l.doc.resolve(l.mapping.map(n.pos)),1):se.create(l.doc,l.mapping.map(n.pos))),e(l.scrollIntoView())}return!0}}return i.isAtom&&n.depth==s.depth-1?(e&&e(r.tr.delete(n.pos,n.pos+i.nodeSize).scrollIntoView()),!0):!1},Tp=(r,e,t)=>{let{$head:s,empty:n}=r.selection,i=s;if(!n)return!1;if(s.parent.isTextblock){if(t?!t.endOfTextblock("forward",r):s.parentOffset<s.parent.content.size)return!1;i=mc(s)}let o=i&&i.nodeAfter;return!o||!se.isSelectable(o)?!1:(e&&e(r.tr.setSelection(se.create(r.doc,i.pos)).scrollIntoView()),!0)};function mc(r){if(!r.parent.type.spec.isolating)for(let e=r.depth-1;e>=0;e--){let t=r.node(e);if(r.index(e)+1<t.childCount)return r.doc.resolve(r.after(e+1));if(t.type.spec.isolating)break}return null}const k1=(r,e)=>{let t=r.selection,s=t instanceof se,n;if(s){if(t.node.isTextblock||!Lr(r.doc,t.from))return!1;n=t.from}else if(n=Uo(r.doc,t.from,-1),n==null)return!1;if(e){let i=r.tr.join(n);s&&i.setSelection(se.create(i.doc,n-r.doc.resolve(n).nodeBefore.nodeSize)),e(i.scrollIntoView())}return!0},S1=(r,e)=>{let t=r.selection,s;if(t instanceof se){if(t.node.isTextblock||!Lr(r.doc,t.to))return!1;s=t.to}else if(s=Uo(r.doc,t.to,1),s==null)return!1;return e&&e(r.tr.join(s).scrollIntoView()),!0},E1=(r,e)=>{let{$from:t,$to:s}=r.selection,n=t.blockRange(s),i=n&&Zs(n);return i==null?!1:(e&&e(r.tr.lift(n,i).scrollIntoView()),!0)},Op=(r,e)=>{let{$head:t,$anchor:s}=r.selection;return!t.parent.type.spec.code||!t.sameParent(s)?!1:(e&&e(r.tr.insertText(`
`).scrollIntoView()),!0)};function gc(r){for(let e=0;e<r.edgeCount;e++){let{type:t}=r.edge(e);if(t.isTextblock&&!t.hasRequiredAttrs())return t}return null}const A1=(r,e)=>{let{$head:t,$anchor:s}=r.selection;if(!t.parent.type.spec.code||!t.sameParent(s))return!1;let n=t.node(-1),i=t.indexAfter(-1),o=gc(n.contentMatchAt(i));if(!o||!n.canReplaceWith(i,i,o))return!1;if(e){let l=t.after(),c=r.tr.replaceWith(l,l,o.createAndFill());c.setSelection(de.near(c.doc.resolve(l),1)),e(c.scrollIntoView())}return!0},Rp=(r,e)=>{let t=r.selection,{$from:s,$to:n}=t;if(t instanceof kt||s.parent.inlineContent||n.parent.inlineContent)return!1;let i=gc(n.parent.contentMatchAt(n.indexAfter()));if(!i||!i.isTextblock)return!1;if(e){let o=(!s.parentOffset&&n.index()<n.parent.childCount?s:n).pos,l=r.tr.insert(o,i.createAndFill());l.setSelection(ce.create(l.doc,o+1)),e(l.scrollIntoView())}return!0},Ip=(r,e)=>{let{$cursor:t}=r.selection;if(!t||t.parent.content.size)return!1;if(t.depth>1&&t.after()!=t.end(-1)){let i=t.before();if(nr(r.doc,i))return e&&e(r.tr.split(i).scrollIntoView()),!0}let s=t.blockRange(),n=s&&Zs(s);return n==null?!1:(e&&e(r.tr.lift(s,n).scrollIntoView()),!0)};function C1(r){return(e,t)=>{let{$from:s,$to:n}=e.selection;if(e.selection instanceof se&&e.selection.node.isBlock)return!s.parentOffset||!nr(e.doc,s.pos)?!1:(t&&t(e.tr.split(s.pos).scrollIntoView()),!0);if(!s.depth)return!1;let i=[],o,l,c=!1,d=!1;for(let p=s.depth;;p--)if(s.node(p).isBlock){c=s.end(p)==s.pos+(s.depth-p),d=s.start(p)==s.pos-(s.depth-p),l=gc(s.node(p-1).contentMatchAt(s.indexAfter(p-1))),i.unshift(c&&l?{type:l}:null),o=p;break}else{if(p==1)return!1;i.unshift(null)}let u=e.tr;(e.selection instanceof ce||e.selection instanceof kt)&&u.deleteSelection();let h=u.mapping.map(s.pos),f=nr(u.doc,h,i.length,i);if(f||(i[0]=l?{type:l}:null,f=nr(u.doc,h,i.length,i)),!f)return!1;if(u.split(h,i.length,i),!c&&d&&s.node(o).type!=l){let p=u.mapping.map(s.before(o)),m=u.doc.resolve(p);l&&s.node(o-1).canReplaceWith(m.index(),m.index()+1,l)&&u.setNodeMarkup(u.mapping.map(s.before(o)),l)}return t&&t(u.scrollIntoView()),!0}}const M1=C1(),D1=(r,e)=>{let{$from:t,to:s}=r.selection,n,i=t.sharedDepth(s);return i==0?!1:(n=t.before(i),e&&e(r.tr.setSelection(se.create(r.doc,n))),!0)};function T1(r,e,t){let s=e.nodeBefore,n=e.nodeAfter,i=e.index();return!s||!n||!s.type.compatibleContent(n.type)?!1:!s.content.size&&e.parent.canReplace(i-1,i)?(t&&t(r.tr.delete(e.pos-s.nodeSize,e.pos).scrollIntoView()),!0):!e.parent.canReplace(i,i+1)||!(n.isTextblock||Lr(r.doc,e.pos))?!1:(t&&t(r.tr.join(e.pos).scrollIntoView()),!0)}function Pp(r,e,t,s){let n=e.nodeBefore,i=e.nodeAfter,o,l,c=n.type.spec.isolating||i.type.spec.isolating;if(!c&&T1(r,e,t))return!0;let d=!c&&e.parent.canReplace(e.index(),e.index()+1);if(d&&(o=(l=n.contentMatchAt(n.childCount)).findWrapping(i.type))&&l.matchType(o[0]||i.type).validEnd){if(t){let p=e.pos+i.nodeSize,m=z.empty;for(let x=o.length-1;x>=0;x--)m=z.from(o[x].create(null,m));m=z.from(n.copy(m));let g=r.tr.step(new Ke(e.pos-1,p,e.pos,p,new Q(m,1,0),o.length,!0)),y=g.doc.resolve(p+2*o.length);y.nodeAfter&&y.nodeAfter.type==n.type&&Lr(g.doc,y.pos)&&g.join(y.pos),t(g.scrollIntoView())}return!0}let u=i.type.spec.isolating||s>0&&c?null:de.findFrom(e,1),h=u&&u.$from.blockRange(u.$to),f=h&&Zs(h);if(f!=null&&f>=e.depth)return t&&t(r.tr.lift(h,f).scrollIntoView()),!0;if(d&&qs(i,"start",!0)&&qs(n,"end")){let p=n,m=[];for(;m.push(p),!p.isTextblock;)p=p.lastChild;let g=i,y=1;for(;!g.isTextblock;g=g.firstChild)y++;if(p.canReplace(p.childCount,p.childCount,g.content)){if(t){let x=z.empty;for(let A=m.length-1;A>=0;A--)x=z.from(m[A].copy(x));let N=r.tr.step(new Ke(e.pos-m.length,e.pos+i.nodeSize,e.pos+y,e.pos+i.nodeSize-y,new Q(x,m.length,0),0,!0));t(N.scrollIntoView())}return!0}}return!1}function Lp(r){return function(e,t){let s=e.selection,n=r<0?s.$from:s.$to,i=n.depth;for(;n.node(i).isInline;){if(!i)return!1;i--}return n.node(i).isTextblock?(t&&t(e.tr.setSelection(ce.create(e.doc,r<0?n.start(i):n.end(i)))),!0):!1}}const O1=Lp(-1),R1=Lp(1);function I1(r,e=null){return function(t,s){let{$from:n,$to:i}=t.selection,o=n.blockRange(i),l=o&&rc(o,r,e);return l?(s&&s(t.tr.wrap(o,l).scrollIntoView()),!0):!1}}function ou(r,e=null){return function(t,s){let n=!1;for(let i=0;i<t.selection.ranges.length&&!n;i++){let{$from:{pos:o},$to:{pos:l}}=t.selection.ranges[i];t.doc.nodesBetween(o,l,(c,d)=>{if(n)return!1;if(!(!c.isTextblock||c.hasMarkup(r,e)))if(c.type==r)n=!0;else{let u=t.doc.resolve(d),h=u.index();n=u.parent.canReplaceWith(h,h+1,r)}})}if(!n)return!1;if(s){let i=t.tr;for(let o=0;o<t.selection.ranges.length;o++){let{$from:{pos:l},$to:{pos:c}}=t.selection.ranges[o];i.setBlockType(l,c,r,e)}s(i.scrollIntoView())}return!0}}function xc(...r){return function(e,t,s){for(let n=0;n<r.length;n++)if(r[n](e,t,s))return!0;return!1}}xc(fc,Ep,Cp);xc(fc,Dp,Tp);xc(Op,Rp,Ip,M1);typeof navigator<"u"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):typeof os<"u"&&os.platform&&os.platform()=="darwin";function P1(r,e=null){return function(t,s){let{$from:n,$to:i}=t.selection,o=n.blockRange(i);if(!o)return!1;let l=s?t.tr:null;return L1(l,o,r,e)?(s&&s(l.scrollIntoView()),!0):!1}}function L1(r,e,t,s=null){let n=!1,i=e,o=e.$from.doc;if(e.depth>=2&&e.$from.node(e.depth-1).type.compatibleContent(t)&&e.startIndex==0){if(e.$from.index(e.depth-1)==0)return!1;let c=o.resolve(e.start-2);i=new zi(c,c,e.depth),e.endIndex<e.parent.childCount&&(e=new zi(e.$from,o.resolve(e.$to.end(e.depth)),e.depth)),n=!0}let l=rc(i,t,s,e);return l?(r&&$1(r,e,l,n,t),!0):!1}function $1(r,e,t,s,n){let i=z.empty;for(let u=t.length-1;u>=0;u--)i=z.from(t[u].type.create(t[u].attrs,i));r.step(new Ke(e.start-(s?2:0),e.end,e.start,e.end,new Q(i,0,0),t.length,!0));let o=0;for(let u=0;u<t.length;u++)t[u].type==n&&(o=u+1);let l=t.length-o,c=e.start+t.length-(s?2:0),d=e.parent;for(let u=e.startIndex,h=e.endIndex,f=!0;u<h;u++,f=!1)!f&&nr(r.doc,c,l)&&(r.split(c,l),c+=2*l),c+=d.child(u).nodeSize;return r}function _1(r){return function(e,t){let{$from:s,$to:n}=e.selection,i=s.blockRange(n,o=>o.childCount>0&&o.firstChild.type==r);return i?t?s.node(i.depth-1).type==r?F1(e,t,r,i):B1(e,t,i):!0:!1}}function F1(r,e,t,s){let n=r.tr,i=s.end,o=s.$to.end(s.depth);i<o&&(n.step(new Ke(i-1,o,i,o,new Q(z.from(t.create(null,s.parent.copy())),1,0),1,!0)),s=new zi(n.doc.resolve(s.$from.pos),n.doc.resolve(o),s.depth));const l=Zs(s);if(l==null)return!1;n.lift(s,l);let c=n.doc.resolve(n.mapping.map(i,-1)-1);return Lr(n.doc,c.pos)&&c.nodeBefore.type==c.nodeAfter.type&&n.join(c.pos),e(n.scrollIntoView()),!0}function B1(r,e,t){let s=r.tr,n=t.parent;for(let p=t.end,m=t.endIndex-1,g=t.startIndex;m>g;m--)p-=n.child(m).nodeSize,s.delete(p-1,p+1);let i=s.doc.resolve(t.start),o=i.nodeAfter;if(s.mapping.map(t.end)!=t.start+i.nodeAfter.nodeSize)return!1;let l=t.startIndex==0,c=t.endIndex==n.childCount,d=i.node(-1),u=i.index(-1);if(!d.canReplace(u+(l?0:1),u+1,o.content.append(c?z.empty:z.from(n))))return!1;let h=i.pos,f=h+o.nodeSize;return s.step(new Ke(h-(l?1:0),f+(c?1:0),h+1,f-1,new Q((l?z.empty:z.from(n.copy(z.empty))).append(c?z.empty:z.from(n.copy(z.empty))),l?0:1,c?0:1),l?0:1)),e(s.scrollIntoView()),!0}function U1(r){return function(e,t){let{$from:s,$to:n}=e.selection,i=s.blockRange(n,d=>d.childCount>0&&d.firstChild.type==r);if(!i)return!1;let o=i.startIndex;if(o==0)return!1;let l=i.parent,c=l.child(o-1);if(c.type!=r)return!1;if(t){let d=c.lastChild&&c.lastChild.type==l.type,u=z.from(d?r.create():null),h=new Q(z.from(r.create(null,z.from(l.type.create(null,u)))),d?3:1,0),f=i.start,p=i.end;t(e.tr.step(new Ke(f-(d?3:1),p,f,p,h,1,!0)).scrollIntoView())}return!0}}function Ko(r){const{state:e,transaction:t}=r;let{selection:s}=t,{doc:n}=t,{storedMarks:i}=t;return{...e,apply:e.apply.bind(e),applyTransaction:e.applyTransaction.bind(e),plugins:e.plugins,schema:e.schema,reconfigure:e.reconfigure.bind(e),toJSON:e.toJSON.bind(e),get storedMarks(){return i},get selection(){return s},get doc(){return n},get tr(){return s=t.selection,n=t.doc,i=t.storedMarks,t}}}class Go{constructor(e){this.editor=e.editor,this.rawCommands=this.editor.extensionManager.commands,this.customState=e.state}get hasCustomState(){return!!this.customState}get state(){return this.customState||this.editor.state}get commands(){const{rawCommands:e,editor:t,state:s}=this,{view:n}=t,{tr:i}=s,o=this.buildProps(i);return Object.fromEntries(Object.entries(e).map(([l,c])=>[l,(...u)=>{const h=c(...u)(o);return!i.getMeta("preventDispatch")&&!this.hasCustomState&&n.dispatch(i),h}]))}get chain(){return()=>this.createChain()}get can(){return()=>this.createCan()}createChain(e,t=!0){const{rawCommands:s,editor:n,state:i}=this,{view:o}=n,l=[],c=!!e,d=e||i.tr,u=()=>(!c&&t&&!d.getMeta("preventDispatch")&&!this.hasCustomState&&o.dispatch(d),l.every(f=>f===!0)),h={...Object.fromEntries(Object.entries(s).map(([f,p])=>[f,(...g)=>{const y=this.buildProps(d,t),x=p(...g)(y);return l.push(x),h}])),run:u};return h}createCan(e){const{rawCommands:t,state:s}=this,n=!1,i=e||s.tr,o=this.buildProps(i,n);return{...Object.fromEntries(Object.entries(t).map(([c,d])=>[c,(...u)=>d(...u)({...o,dispatch:void 0})])),chain:()=>this.createChain(i,n)}}buildProps(e,t=!0){const{rawCommands:s,editor:n,state:i}=this,{view:o}=n,l={tr:e,editor:n,view:o,state:Ko({state:i,transaction:e}),dispatch:t?()=>{}:void 0,chain:()=>this.createChain(e,t),can:()=>this.createCan(e),get commands(){return Object.fromEntries(Object.entries(s).map(([c,d])=>[c,(...u)=>d(...u)(l)]))}};return l}}class z1{constructor(){this.callbacks={}}on(e,t){return this.callbacks[e]||(this.callbacks[e]=[]),this.callbacks[e].push(t),this}emit(e,...t){const s=this.callbacks[e];return s&&s.forEach(n=>n.apply(this,t)),this}off(e,t){const s=this.callbacks[e];return s&&(t?this.callbacks[e]=s.filter(n=>n!==t):delete this.callbacks[e]),this}once(e,t){const s=(...n)=>{this.off(e,s),t.apply(this,n)};return this.on(e,s)}removeAllListeners(){this.callbacks={}}}function ee(r,e,t){return r.config[e]===void 0&&r.parent?ee(r.parent,e,t):typeof r.config[e]=="function"?r.config[e].bind({...t,parent:r.parent?ee(r.parent,e,t):null}):r.config[e]}function Yo(r){const e=r.filter(n=>n.type==="extension"),t=r.filter(n=>n.type==="node"),s=r.filter(n=>n.type==="mark");return{baseExtensions:e,nodeExtensions:t,markExtensions:s}}function $p(r){const e=[],{nodeExtensions:t,markExtensions:s}=Yo(r),n=[...t,...s],i={default:null,rendered:!0,renderHTML:null,parseHTML:null,keepOnSplit:!0,isRequired:!1};return r.forEach(o=>{const l={name:o.name,options:o.options,storage:o.storage,extensions:n},c=ee(o,"addGlobalAttributes",l);if(!c)return;c().forEach(u=>{u.types.forEach(h=>{Object.entries(u.attributes).forEach(([f,p])=>{e.push({type:h,name:f,attribute:{...i,...p}})})})})}),n.forEach(o=>{const l={name:o.name,options:o.options,storage:o.storage},c=ee(o,"addAttributes",l);if(!c)return;const d=c();Object.entries(d).forEach(([u,h])=>{const f={...i,...h};typeof(f==null?void 0:f.default)=="function"&&(f.default=f.default()),f!=null&&f.isRequired&&(f==null?void 0:f.default)===void 0&&delete f.default,e.push({type:o.name,name:u,attribute:f})})}),e}function Ye(r,e){if(typeof r=="string"){if(!e.nodes[r])throw Error(`There is no node type named '${r}'. Maybe you forgot to add the extension?`);return e.nodes[r]}return r}function He(...r){return r.filter(e=>!!e).reduce((e,t)=>{const s={...e};return Object.entries(t).forEach(([n,i])=>{if(!s[n]){s[n]=i;return}if(n==="class"){const l=i?String(i).split(" "):[],c=s[n]?s[n].split(" "):[],d=l.filter(u=>!c.includes(u));s[n]=[...c,...d].join(" ")}else if(n==="style"){const l=i?i.split(";").map(u=>u.trim()).filter(Boolean):[],c=s[n]?s[n].split(";").map(u=>u.trim()).filter(Boolean):[],d=new Map;c.forEach(u=>{const[h,f]=u.split(":").map(p=>p.trim());d.set(h,f)}),l.forEach(u=>{const[h,f]=u.split(":").map(p=>p.trim());d.set(h,f)}),s[n]=Array.from(d.entries()).map(([u,h])=>`${u}: ${h}`).join("; ")}else s[n]=i}),s},{})}function Ji(r,e){return e.filter(t=>t.type===r.type.name).filter(t=>t.attribute.rendered).map(t=>t.attribute.renderHTML?t.attribute.renderHTML(r.attrs)||{}:{[t.name]:r.attrs[t.name]}).reduce((t,s)=>He(t,s),{})}function _p(r){return typeof r=="function"}function fe(r,e=void 0,...t){return _p(r)?e?r.bind(e)(...t):r(...t):r}function W1(r={}){return Object.keys(r).length===0&&r.constructor===Object}function H1(r){return typeof r!="string"?r:r.match(/^[+-]?(?:\d*\.)?\d+$/)?Number(r):r==="true"?!0:r==="false"?!1:r}function au(r,e){return"style"in r?r:{...r,getAttrs:t=>{const s=r.getAttrs?r.getAttrs(t):r.attrs;if(s===!1)return!1;const n=e.reduce((i,o)=>{const l=o.attribute.parseHTML?o.attribute.parseHTML(t):H1(t.getAttribute(o.name));return l==null?i:{...i,[o.name]:l}},{});return{...s,...n}}}}function lu(r){return Object.fromEntries(Object.entries(r).filter(([e,t])=>e==="attrs"&&W1(t)?!1:t!=null))}function V1(r,e){var t;const s=$p(r),{nodeExtensions:n,markExtensions:i}=Yo(r),o=(t=n.find(d=>ee(d,"topNode")))===null||t===void 0?void 0:t.name,l=Object.fromEntries(n.map(d=>{const u=s.filter(x=>x.type===d.name),h={name:d.name,options:d.options,storage:d.storage,editor:e},f=r.reduce((x,N)=>{const A=ee(N,"extendNodeSchema",h);return{...x,...A?A(d):{}}},{}),p=lu({...f,content:fe(ee(d,"content",h)),marks:fe(ee(d,"marks",h)),group:fe(ee(d,"group",h)),inline:fe(ee(d,"inline",h)),atom:fe(ee(d,"atom",h)),selectable:fe(ee(d,"selectable",h)),draggable:fe(ee(d,"draggable",h)),code:fe(ee(d,"code",h)),whitespace:fe(ee(d,"whitespace",h)),linebreakReplacement:fe(ee(d,"linebreakReplacement",h)),defining:fe(ee(d,"defining",h)),isolating:fe(ee(d,"isolating",h)),attrs:Object.fromEntries(u.map(x=>{var N;return[x.name,{default:(N=x==null?void 0:x.attribute)===null||N===void 0?void 0:N.default}]}))}),m=fe(ee(d,"parseHTML",h));m&&(p.parseDOM=m.map(x=>au(x,u)));const g=ee(d,"renderHTML",h);g&&(p.toDOM=x=>g({node:x,HTMLAttributes:Ji(x,u)}));const y=ee(d,"renderText",h);return y&&(p.toText=y),[d.name,p]})),c=Object.fromEntries(i.map(d=>{const u=s.filter(y=>y.type===d.name),h={name:d.name,options:d.options,storage:d.storage,editor:e},f=r.reduce((y,x)=>{const N=ee(x,"extendMarkSchema",h);return{...y,...N?N(d):{}}},{}),p=lu({...f,inclusive:fe(ee(d,"inclusive",h)),excludes:fe(ee(d,"excludes",h)),group:fe(ee(d,"group",h)),spanning:fe(ee(d,"spanning",h)),code:fe(ee(d,"code",h)),attrs:Object.fromEntries(u.map(y=>{var x;return[y.name,{default:(x=y==null?void 0:y.attribute)===null||x===void 0?void 0:x.default}]}))}),m=fe(ee(d,"parseHTML",h));m&&(p.parseDOM=m.map(y=>au(y,u)));const g=ee(d,"renderHTML",h);return g&&(p.toDOM=y=>g({mark:y,HTMLAttributes:Ji(y,u)})),[d.name,p]}));return new Sf({topNode:o,nodes:l,marks:c})}function Sa(r,e){return e.nodes[r]||e.marks[r]||null}function cu(r,e){return Array.isArray(e)?e.some(t=>(typeof t=="string"?t:t.name)===r.name):e}function yc(r,e){const t=js.fromSchema(e).serializeFragment(r),n=document.implementation.createHTMLDocument().createElement("div");return n.appendChild(t),n.innerHTML}const q1=(r,e=500)=>{let t="";const s=r.parentOffset;return r.parent.nodesBetween(Math.max(0,s-e),s,(n,i,o,l)=>{var c,d;const u=((d=(c=n.type.spec).toText)===null||d===void 0?void 0:d.call(c,{node:n,pos:i,parent:o,index:l}))||n.textContent||"%leaf%";t+=n.isAtom&&!n.isText?u:u.slice(0,Math.max(0,s-i))}),t};function bc(r){return Object.prototype.toString.call(r)==="[object RegExp]"}class Jo{constructor(e){this.find=e.find,this.handler=e.handler}}const K1=(r,e)=>{if(bc(e))return e.exec(r);const t=e(r);if(!t)return null;const s=[t.text];return s.index=t.index,s.input=r,s.data=t.data,t.replaceWith&&(t.text.includes(t.replaceWith)||console.warn('[tiptap warn]: "inputRuleMatch.replaceWith" must be part of "inputRuleMatch.text".'),s.push(t.replaceWith)),s};function si(r){var e;const{editor:t,from:s,to:n,text:i,rules:o,plugin:l}=r,{view:c}=t;if(c.composing)return!1;const d=c.state.doc.resolve(s);if(d.parent.type.spec.code||!((e=d.nodeBefore||d.nodeAfter)===null||e===void 0)&&e.marks.find(f=>f.type.spec.code))return!1;let u=!1;const h=q1(d)+i;return o.forEach(f=>{if(u)return;const p=K1(h,f.find);if(!p)return;const m=c.state.tr,g=Ko({state:c.state,transaction:m}),y={from:s-(p[0].length-i.length),to:n},{commands:x,chain:N,can:A}=new Go({editor:t,state:g});f.handler({state:g,range:y,match:p,commands:x,chain:N,can:A})===null||!m.steps.length||(m.setMeta(l,{transform:m,from:s,to:n,text:i}),c.dispatch(m),u=!0)}),u}function G1(r){const{editor:e,rules:t}=r,s=new Je({state:{init(){return null},apply(n,i,o){const l=n.getMeta(s);if(l)return l;const c=n.getMeta("applyInputRules");return!!c&&setTimeout(()=>{let{text:u}=c;typeof u=="string"?u=u:u=yc(z.from(u),o.schema);const{from:h}=c,f=h+u.length;si({editor:e,from:h,to:f,text:u,rules:t,plugin:s})}),n.selectionSet||n.docChanged?null:i}},props:{handleTextInput(n,i,o,l){return si({editor:e,from:i,to:o,text:l,rules:t,plugin:s})},handleDOMEvents:{compositionend:n=>(setTimeout(()=>{const{$cursor:i}=n.state.selection;i&&si({editor:e,from:i.pos,to:i.pos,text:"",rules:t,plugin:s})}),!1)},handleKeyDown(n,i){if(i.key!=="Enter")return!1;const{$cursor:o}=n.state.selection;return o?si({editor:e,from:o.pos,to:o.pos,text:`
`,rules:t,plugin:s}):!1}},isInputRules:!0});return s}function Y1(r){return Object.prototype.toString.call(r).slice(8,-1)}function ni(r){return Y1(r)!=="Object"?!1:r.constructor===Object&&Object.getPrototypeOf(r)===Object.prototype}function Xo(r,e){const t={...r};return ni(r)&&ni(e)&&Object.keys(e).forEach(s=>{ni(e[s])&&ni(r[s])?t[s]=Xo(r[s],e[s]):t[s]=e[s]}),t}class Kt{constructor(e={}){this.type="mark",this.name="mark",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...e},this.name=this.config.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=fe(ee(this,"addOptions",{name:this.name}))),this.storage=fe(ee(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new Kt(e)}configure(e={}){const t=this.extend({...this.config,addOptions:()=>Xo(this.options,e)});return t.name=this.name,t.parent=this.parent,t}extend(e={}){const t=new Kt(e);return t.parent=this,this.child=t,t.name=e.name?e.name:t.parent.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${t.name}".`),t.options=fe(ee(t,"addOptions",{name:t.name})),t.storage=fe(ee(t,"addStorage",{name:t.name,options:t.options})),t}static handleExit({editor:e,mark:t}){const{tr:s}=e.state,n=e.state.selection.$from;if(n.pos===n.end()){const o=n.marks();if(!!!o.find(d=>(d==null?void 0:d.type.name)===t.name))return!1;const c=o.find(d=>(d==null?void 0:d.type.name)===t.name);return c&&s.removeStoredMark(c),s.insertText(" ",n.pos),e.view.dispatch(s),!0}return!1}}function J1(r){return typeof r=="number"}class X1{constructor(e){this.find=e.find,this.handler=e.handler}}const Q1=(r,e,t)=>{if(bc(e))return[...r.matchAll(e)];const s=e(r,t);return s?s.map(n=>{const i=[n.text];return i.index=n.index,i.input=r,i.data=n.data,n.replaceWith&&(n.text.includes(n.replaceWith)||console.warn('[tiptap warn]: "pasteRuleMatch.replaceWith" must be part of "pasteRuleMatch.text".'),i.push(n.replaceWith)),i}):[]};function Z1(r){const{editor:e,state:t,from:s,to:n,rule:i,pasteEvent:o,dropEvent:l}=r,{commands:c,chain:d,can:u}=new Go({editor:e,state:t}),h=[];return t.doc.nodesBetween(s,n,(p,m)=>{if(!p.isTextblock||p.type.spec.code)return;const g=Math.max(s,m),y=Math.min(n,m+p.content.size),x=p.textBetween(g-m,y-m,void 0,"￼");Q1(x,i.find,o).forEach(A=>{if(A.index===void 0)return;const S=g+A.index+1,k=S+A[0].length,R={from:t.tr.mapping.map(S),to:t.tr.mapping.map(k)},j=i.handler({state:t,range:R,match:A,commands:c,chain:d,can:u,pasteEvent:o,dropEvent:l});h.push(j)})}),h.every(p=>p!==null)}let ii=null;const eN=r=>{var e;const t=new ClipboardEvent("paste",{clipboardData:new DataTransfer});return(e=t.clipboardData)===null||e===void 0||e.setData("text/html",r),t};function tN(r){const{editor:e,rules:t}=r;let s=null,n=!1,i=!1,o=typeof ClipboardEvent<"u"?new ClipboardEvent("paste"):null,l;try{l=typeof DragEvent<"u"?new DragEvent("drop"):null}catch{l=null}const c=({state:u,from:h,to:f,rule:p,pasteEvt:m})=>{const g=u.tr,y=Ko({state:u,transaction:g});if(!(!Z1({editor:e,state:y,from:Math.max(h-1,0),to:f.b-1,rule:p,pasteEvent:m,dropEvent:l})||!g.steps.length)){try{l=typeof DragEvent<"u"?new DragEvent("drop"):null}catch{l=null}return o=typeof ClipboardEvent<"u"?new ClipboardEvent("paste"):null,g}};return t.map(u=>new Je({view(h){const f=m=>{var g;s=!((g=h.dom.parentElement)===null||g===void 0)&&g.contains(m.target)?h.dom.parentElement:null,s&&(ii=e)},p=()=>{ii&&(ii=null)};return window.addEventListener("dragstart",f),window.addEventListener("dragend",p),{destroy(){window.removeEventListener("dragstart",f),window.removeEventListener("dragend",p)}}},props:{handleDOMEvents:{drop:(h,f)=>{if(i=s===h.dom.parentElement,l=f,!i){const p=ii;p!=null&&p.isEditable&&setTimeout(()=>{const m=p.state.selection;m&&p.commands.deleteRange({from:m.from,to:m.to})},10)}return!1},paste:(h,f)=>{var p;const m=(p=f.clipboardData)===null||p===void 0?void 0:p.getData("text/html");return o=f,n=!!(m!=null&&m.includes("data-pm-slice")),!1}}},appendTransaction:(h,f,p)=>{const m=h[0],g=m.getMeta("uiEvent")==="paste"&&!n,y=m.getMeta("uiEvent")==="drop"&&!i,x=m.getMeta("applyPasteRules"),N=!!x;if(!g&&!y&&!N)return;if(N){let{text:k}=x;typeof k=="string"?k=k:k=yc(z.from(k),p.schema);const{from:R}=x,j=R+k.length,w=eN(k);return c({rule:u,state:p,from:R,to:{b:j},pasteEvt:w})}const A=f.doc.content.findDiffStart(p.doc.content),S=f.doc.content.findDiffEnd(p.doc.content);if(!(!J1(A)||!S||A===S.b))return c({rule:u,state:p,from:A,to:S,pasteEvt:o})}}))}function rN(r){const e=r.filter((t,s)=>r.indexOf(t)!==s);return Array.from(new Set(e))}class $s{constructor(e,t){this.splittableMarks=[],this.editor=t,this.extensions=$s.resolve(e),this.schema=V1(this.extensions,t),this.setupExtensions()}static resolve(e){const t=$s.sort($s.flatten(e)),s=rN(t.map(n=>n.name));return s.length&&console.warn(`[tiptap warn]: Duplicate extension names found: [${s.map(n=>`'${n}'`).join(", ")}]. This can lead to issues.`),t}static flatten(e){return e.map(t=>{const s={name:t.name,options:t.options,storage:t.storage},n=ee(t,"addExtensions",s);return n?[t,...this.flatten(n())]:t}).flat(10)}static sort(e){return e.sort((s,n)=>{const i=ee(s,"priority")||100,o=ee(n,"priority")||100;return i>o?-1:i<o?1:0})}get commands(){return this.extensions.reduce((e,t)=>{const s={name:t.name,options:t.options,storage:t.storage,editor:this.editor,type:Sa(t.name,this.schema)},n=ee(t,"addCommands",s);return n?{...e,...n()}:e},{})}get plugins(){const{editor:e}=this,t=$s.sort([...this.extensions].reverse()),s=[],n=[],i=t.map(o=>{const l={name:o.name,options:o.options,storage:o.storage,editor:e,type:Sa(o.name,this.schema)},c=[],d=ee(o,"addKeyboardShortcuts",l);let u={};if(o.type==="mark"&&ee(o,"exitable",l)&&(u.ArrowRight=()=>Kt.handleExit({editor:e,mark:o})),d){const g=Object.fromEntries(Object.entries(d()).map(([y,x])=>[y,()=>x({editor:e})]));u={...u,...g}}const h=v1(u);c.push(h);const f=ee(o,"addInputRules",l);cu(o,e.options.enableInputRules)&&f&&s.push(...f());const p=ee(o,"addPasteRules",l);cu(o,e.options.enablePasteRules)&&p&&n.push(...p());const m=ee(o,"addProseMirrorPlugins",l);if(m){const g=m();c.push(...g)}return c}).flat();return[G1({editor:e,rules:s}),...tN({editor:e,rules:n}),...i]}get attributes(){return $p(this.extensions)}get nodeViews(){const{editor:e}=this,{nodeExtensions:t}=Yo(this.extensions);return Object.fromEntries(t.filter(s=>!!ee(s,"addNodeView")).map(s=>{const n=this.attributes.filter(c=>c.type===s.name),i={name:s.name,options:s.options,storage:s.storage,editor:e,type:Ye(s.name,this.schema)},o=ee(s,"addNodeView",i);if(!o)return[];const l=(c,d,u,h,f)=>{const p=Ji(c,n);return o()({node:c,view:d,getPos:u,decorations:h,innerDecorations:f,editor:e,extension:s,HTMLAttributes:p})};return[s.name,l]}))}setupExtensions(){this.extensions.forEach(e=>{var t;this.editor.extensionStorage[e.name]=e.storage;const s={name:e.name,options:e.options,storage:e.storage,editor:this.editor,type:Sa(e.name,this.schema)};e.type==="mark"&&(!((t=fe(ee(e,"keepOnSplit",s)))!==null&&t!==void 0)||t)&&this.splittableMarks.push(e.name);const n=ee(e,"onBeforeCreate",s),i=ee(e,"onCreate",s),o=ee(e,"onUpdate",s),l=ee(e,"onSelectionUpdate",s),c=ee(e,"onTransaction",s),d=ee(e,"onFocus",s),u=ee(e,"onBlur",s),h=ee(e,"onDestroy",s);n&&this.editor.on("beforeCreate",n),i&&this.editor.on("create",i),o&&this.editor.on("update",o),l&&this.editor.on("selectionUpdate",l),c&&this.editor.on("transaction",c),d&&this.editor.on("focus",d),u&&this.editor.on("blur",u),h&&this.editor.on("destroy",h)})}}class nt{constructor(e={}){this.type="extension",this.name="extension",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...e},this.name=this.config.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=fe(ee(this,"addOptions",{name:this.name}))),this.storage=fe(ee(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new nt(e)}configure(e={}){const t=this.extend({...this.config,addOptions:()=>Xo(this.options,e)});return t.name=this.name,t.parent=this.parent,t}extend(e={}){const t=new nt({...this.config,...e});return t.parent=this,this.child=t,t.name=e.name?e.name:t.parent.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${t.name}".`),t.options=fe(ee(t,"addOptions",{name:t.name})),t.storage=fe(ee(t,"addStorage",{name:t.name,options:t.options})),t}}function Fp(r,e,t){const{from:s,to:n}=e,{blockSeparator:i=`

`,textSerializers:o={}}=t||{};let l="";return r.nodesBetween(s,n,(c,d,u,h)=>{var f;c.isBlock&&d>s&&(l+=i);const p=o==null?void 0:o[c.type.name];if(p)return u&&(l+=p({node:c,pos:d,parent:u,index:h,range:e})),!1;c.isText&&(l+=(f=c==null?void 0:c.text)===null||f===void 0?void 0:f.slice(Math.max(s,d)-d,n-d))}),l}function Bp(r){return Object.fromEntries(Object.entries(r.nodes).filter(([,e])=>e.spec.toText).map(([e,t])=>[e,t.spec.toText]))}const sN=nt.create({name:"clipboardTextSerializer",addOptions(){return{blockSeparator:void 0}},addProseMirrorPlugins(){return[new Je({key:new yt("clipboardTextSerializer"),props:{clipboardTextSerializer:()=>{const{editor:r}=this,{state:e,schema:t}=r,{doc:s,selection:n}=e,{ranges:i}=n,o=Math.min(...i.map(u=>u.$from.pos)),l=Math.max(...i.map(u=>u.$to.pos)),c=Bp(t);return Fp(s,{from:o,to:l},{...this.options.blockSeparator!==void 0?{blockSeparator:this.options.blockSeparator}:{},textSerializers:c})}}})]}}),nN=()=>({editor:r,view:e})=>(requestAnimationFrame(()=>{var t;r.isDestroyed||(e.dom.blur(),(t=window==null?void 0:window.getSelection())===null||t===void 0||t.removeAllRanges())}),!0),iN=(r=!1)=>({commands:e})=>e.setContent("",r),oN=()=>({state:r,tr:e,dispatch:t})=>{const{selection:s}=e,{ranges:n}=s;return t&&n.forEach(({$from:i,$to:o})=>{r.doc.nodesBetween(i.pos,o.pos,(l,c)=>{if(l.type.isText)return;const{doc:d,mapping:u}=e,h=d.resolve(u.map(c)),f=d.resolve(u.map(c+l.nodeSize)),p=h.blockRange(f);if(!p)return;const m=Zs(p);if(l.type.isTextblock){const{defaultType:g}=h.parent.contentMatchAt(h.index());e.setNodeMarkup(p.start,g)}(m||m===0)&&e.lift(p,m)})}),!0},aN=r=>e=>r(e),lN=()=>({state:r,dispatch:e})=>Rp(r,e),cN=(r,e)=>({editor:t,tr:s})=>{const{state:n}=t,i=n.doc.slice(r.from,r.to);s.deleteRange(r.from,r.to);const o=s.mapping.map(e);return s.insert(o,i.content),s.setSelection(new ce(s.doc.resolve(o-1))),!0},dN=()=>({tr:r,dispatch:e})=>{const{selection:t}=r,s=t.$anchor.node();if(s.content.size>0)return!1;const n=r.selection.$anchor;for(let i=n.depth;i>0;i-=1)if(n.node(i).type===s.type){if(e){const l=n.before(i),c=n.after(i);r.delete(l,c).scrollIntoView()}return!0}return!1},uN=r=>({tr:e,state:t,dispatch:s})=>{const n=Ye(r,t.schema),i=e.selection.$anchor;for(let o=i.depth;o>0;o-=1)if(i.node(o).type===n){if(s){const c=i.before(o),d=i.after(o);e.delete(c,d).scrollIntoView()}return!0}return!1},hN=r=>({tr:e,dispatch:t})=>{const{from:s,to:n}=r;return t&&e.delete(s,n),!0},fN=()=>({state:r,dispatch:e})=>fc(r,e),pN=()=>({commands:r})=>r.keyboardShortcut("Enter"),mN=()=>({state:r,dispatch:e})=>A1(r,e);function Xi(r,e,t={strict:!0}){const s=Object.keys(e);return s.length?s.every(n=>t.strict?e[n]===r[n]:bc(e[n])?e[n].test(r[n]):e[n]===r[n]):!0}function Up(r,e,t={}){return r.find(s=>s.type===e&&Xi(Object.fromEntries(Object.keys(t).map(n=>[n,s.attrs[n]])),t))}function du(r,e,t={}){return!!Up(r,e,t)}function wc(r,e,t){var s;if(!r||!e)return;let n=r.parent.childAfter(r.parentOffset);if((!n.node||!n.node.marks.some(u=>u.type===e))&&(n=r.parent.childBefore(r.parentOffset)),!n.node||!n.node.marks.some(u=>u.type===e)||(t=t||((s=n.node.marks[0])===null||s===void 0?void 0:s.attrs),!Up([...n.node.marks],e,t)))return;let o=n.index,l=r.start()+n.offset,c=o+1,d=l+n.node.nodeSize;for(;o>0&&du([...r.parent.child(o-1).marks],e,t);)o-=1,l-=r.parent.child(o).nodeSize;for(;c<r.parent.childCount&&du([...r.parent.child(c).marks],e,t);)d+=r.parent.child(c).nodeSize,c+=1;return{from:l,to:d}}function _r(r,e){if(typeof r=="string"){if(!e.marks[r])throw Error(`There is no mark type named '${r}'. Maybe you forgot to add the extension?`);return e.marks[r]}return r}const gN=(r,e={})=>({tr:t,state:s,dispatch:n})=>{const i=_r(r,s.schema),{doc:o,selection:l}=t,{$from:c,from:d,to:u}=l;if(n){const h=wc(c,i,e);if(h&&h.from<=d&&h.to>=u){const f=ce.create(o,h.from,h.to);t.setSelection(f)}}return!0},xN=r=>e=>{const t=typeof r=="function"?r(e):r;for(let s=0;s<t.length;s+=1)if(t[s](e))return!0;return!1};function zp(r){return r instanceof ce}function ts(r=0,e=0,t=0){return Math.min(Math.max(r,e),t)}function Wp(r,e=null){if(!e)return null;const t=de.atStart(r),s=de.atEnd(r);if(e==="start"||e===!0)return t;if(e==="end")return s;const n=t.from,i=s.to;return e==="all"?ce.create(r,ts(0,n,i),ts(r.content.size,n,i)):ce.create(r,ts(e,n,i),ts(e,n,i))}function Hp(){return navigator.platform==="Android"||/android/i.test(navigator.userAgent)}function Qo(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}const yN=(r=null,e={})=>({editor:t,view:s,tr:n,dispatch:i})=>{e={scrollIntoView:!0,...e};const o=()=>{(Qo()||Hp())&&s.dom.focus(),requestAnimationFrame(()=>{t.isDestroyed||(s.focus(),e!=null&&e.scrollIntoView&&t.commands.scrollIntoView())})};if(s.hasFocus()&&r===null||r===!1)return!0;if(i&&r===null&&!zp(t.state.selection))return o(),!0;const l=Wp(n.doc,r)||t.state.selection,c=t.state.selection.eq(l);return i&&(c||n.setSelection(l),c&&n.storedMarks&&n.setStoredMarks(n.storedMarks),o()),!0},bN=(r,e)=>t=>r.every((s,n)=>e(s,{...t,index:n})),wN=(r,e)=>({tr:t,commands:s})=>s.insertContentAt({from:t.selection.from,to:t.selection.to},r,e),Vp=r=>{const e=r.childNodes;for(let t=e.length-1;t>=0;t-=1){const s=e[t];s.nodeType===3&&s.nodeValue&&/^(\n\s\s|\n)$/.test(s.nodeValue)?r.removeChild(s):s.nodeType===1&&Vp(s)}return r};function oi(r){const e=`<body>${r}</body>`,t=new window.DOMParser().parseFromString(e,"text/html").body;return Vp(t)}function Rn(r,e,t){if(r instanceof Ar||r instanceof z)return r;t={slice:!0,parseOptions:{},...t};const s=typeof r=="object"&&r!==null,n=typeof r=="string";if(s)try{if(Array.isArray(r)&&r.length>0)return z.fromArray(r.map(l=>e.nodeFromJSON(l)));const o=e.nodeFromJSON(r);return t.errorOnInvalidContent&&o.check(),o}catch(i){if(t.errorOnInvalidContent)throw new Error("[tiptap error]: Invalid JSON content",{cause:i});return console.warn("[tiptap warn]: Invalid content.","Passed value:",r,"Error:",i),Rn("",e,t)}if(n){if(t.errorOnInvalidContent){let o=!1,l="";const c=new Sf({topNode:e.spec.topNode,marks:e.spec.marks,nodes:e.spec.nodes.append({__tiptap__private__unknown__catch__all__node:{content:"inline*",group:"block",parseDOM:[{tag:"*",getAttrs:d=>(o=!0,l=typeof d=="string"?d:d.outerHTML,null)}]}})});if(t.slice?Cr.fromSchema(c).parseSlice(oi(r),t.parseOptions):Cr.fromSchema(c).parse(oi(r),t.parseOptions),t.errorOnInvalidContent&&o)throw new Error("[tiptap error]: Invalid HTML content",{cause:new Error(`Invalid element found: ${l}`)})}const i=Cr.fromSchema(e);return t.slice?i.parseSlice(oi(r),t.parseOptions).content:i.parse(oi(r),t.parseOptions)}return Rn("",e,t)}function vN(r,e,t){const s=r.steps.length-1;if(s<e)return;const n=r.steps[s];if(!(n instanceof Ve||n instanceof Ke))return;const i=r.mapping.maps[s];let o=0;i.forEach((l,c,d,u)=>{o===0&&(o=u)}),r.setSelection(de.near(r.doc.resolve(o),t))}const NN=r=>!("type"in r),jN=(r,e,t)=>({tr:s,dispatch:n,editor:i})=>{var o;if(n){t={parseOptions:i.options.parseOptions,updateSelection:!0,applyInputRules:!1,applyPasteRules:!1,...t};let l;const c=y=>{i.emit("contentError",{editor:i,error:y,disableCollaboration:()=>{i.storage.collaboration&&(i.storage.collaboration.isDisabled=!0)}})},d={preserveWhitespace:"full",...t.parseOptions};if(!t.errorOnInvalidContent&&!i.options.enableContentCheck&&i.options.emitContentError)try{Rn(e,i.schema,{parseOptions:d,errorOnInvalidContent:!0})}catch(y){c(y)}try{l=Rn(e,i.schema,{parseOptions:d,errorOnInvalidContent:(o=t.errorOnInvalidContent)!==null&&o!==void 0?o:i.options.enableContentCheck})}catch(y){return c(y),!1}let{from:u,to:h}=typeof r=="number"?{from:r,to:r}:{from:r.from,to:r.to},f=!0,p=!0;if((NN(l)?l:[l]).forEach(y=>{y.check(),f=f?y.isText&&y.marks.length===0:!1,p=p?y.isBlock:!1}),u===h&&p){const{parent:y}=s.doc.resolve(u);y.isTextblock&&!y.type.spec.code&&!y.childCount&&(u-=1,h+=1)}let g;if(f){if(Array.isArray(e))g=e.map(y=>y.text||"").join("");else if(e instanceof z){let y="";e.forEach(x=>{x.text&&(y+=x.text)}),g=y}else typeof e=="object"&&e&&e.text?g=e.text:g=e;s.insertText(g,u,h)}else g=l,s.replaceWith(u,h,g);t.updateSelection&&vN(s,s.steps.length-1,-1),t.applyInputRules&&s.setMeta("applyInputRules",{from:u,text:g}),t.applyPasteRules&&s.setMeta("applyPasteRules",{from:u,text:g})}return!0},kN=()=>({state:r,dispatch:e})=>k1(r,e),SN=()=>({state:r,dispatch:e})=>S1(r,e),EN=()=>({state:r,dispatch:e})=>Ep(r,e),AN=()=>({state:r,dispatch:e})=>Dp(r,e),CN=()=>({state:r,dispatch:e,tr:t})=>{try{const s=Uo(r.doc,r.selection.$from.pos,-1);return s==null?!1:(t.join(s,2),e&&e(t),!0)}catch{return!1}},MN=()=>({state:r,dispatch:e,tr:t})=>{try{const s=Uo(r.doc,r.selection.$from.pos,1);return s==null?!1:(t.join(s,2),e&&e(t),!0)}catch{return!1}},DN=()=>({state:r,dispatch:e})=>N1(r,e),TN=()=>({state:r,dispatch:e})=>j1(r,e);function qp(){return typeof navigator<"u"?/Mac/.test(navigator.platform):!1}function ON(r){const e=r.split(/-(?!$)/);let t=e[e.length-1];t==="Space"&&(t=" ");let s,n,i,o;for(let l=0;l<e.length-1;l+=1){const c=e[l];if(/^(cmd|meta|m)$/i.test(c))o=!0;else if(/^a(lt)?$/i.test(c))s=!0;else if(/^(c|ctrl|control)$/i.test(c))n=!0;else if(/^s(hift)?$/i.test(c))i=!0;else if(/^mod$/i.test(c))Qo()||qp()?o=!0:n=!0;else throw new Error(`Unrecognized modifier name: ${c}`)}return s&&(t=`Alt-${t}`),n&&(t=`Ctrl-${t}`),o&&(t=`Meta-${t}`),i&&(t=`Shift-${t}`),t}const RN=r=>({editor:e,view:t,tr:s,dispatch:n})=>{const i=ON(r).split(/-(?!$)/),o=i.find(d=>!["Alt","Ctrl","Meta","Shift"].includes(d)),l=new KeyboardEvent("keydown",{key:o==="Space"?" ":o,altKey:i.includes("Alt"),ctrlKey:i.includes("Ctrl"),metaKey:i.includes("Meta"),shiftKey:i.includes("Shift"),bubbles:!0,cancelable:!0}),c=e.captureTransaction(()=>{t.someProp("handleKeyDown",d=>d(t,l))});return c==null||c.steps.forEach(d=>{const u=d.map(s.mapping);u&&n&&s.maybeStep(u)}),!0};function In(r,e,t={}){const{from:s,to:n,empty:i}=r.selection,o=e?Ye(e,r.schema):null,l=[];r.doc.nodesBetween(s,n,(h,f)=>{if(h.isText)return;const p=Math.max(s,f),m=Math.min(n,f+h.nodeSize);l.push({node:h,from:p,to:m})});const c=n-s,d=l.filter(h=>o?o.name===h.node.type.name:!0).filter(h=>Xi(h.node.attrs,t,{strict:!1}));return i?!!d.length:d.reduce((h,f)=>h+f.to-f.from,0)>=c}const IN=(r,e={})=>({state:t,dispatch:s})=>{const n=Ye(r,t.schema);return In(t,n,e)?E1(t,s):!1},PN=()=>({state:r,dispatch:e})=>Ip(r,e),LN=r=>({state:e,dispatch:t})=>{const s=Ye(r,e.schema);return _1(s)(e,t)},$N=()=>({state:r,dispatch:e})=>Op(r,e);function Zo(r,e){return e.nodes[r]?"node":e.marks[r]?"mark":null}function uu(r,e){const t=typeof e=="string"?[e]:e;return Object.keys(r).reduce((s,n)=>(t.includes(n)||(s[n]=r[n]),s),{})}const _N=(r,e)=>({tr:t,state:s,dispatch:n})=>{let i=null,o=null;const l=Zo(typeof r=="string"?r:r.name,s.schema);return l?(l==="node"&&(i=Ye(r,s.schema)),l==="mark"&&(o=_r(r,s.schema)),n&&t.selection.ranges.forEach(c=>{s.doc.nodesBetween(c.$from.pos,c.$to.pos,(d,u)=>{i&&i===d.type&&t.setNodeMarkup(u,void 0,uu(d.attrs,e)),o&&d.marks.length&&d.marks.forEach(h=>{o===h.type&&t.addMark(u,u+d.nodeSize,o.create(uu(h.attrs,e)))})})}),!0):!1},FN=()=>({tr:r,dispatch:e})=>(e&&r.scrollIntoView(),!0),BN=()=>({tr:r,dispatch:e})=>{if(e){const t=new kt(r.doc);r.setSelection(t)}return!0},UN=()=>({state:r,dispatch:e})=>Cp(r,e),zN=()=>({state:r,dispatch:e})=>Tp(r,e),WN=()=>({state:r,dispatch:e})=>D1(r,e),HN=()=>({state:r,dispatch:e})=>R1(r,e),VN=()=>({state:r,dispatch:e})=>O1(r,e);function bl(r,e,t={},s={}){return Rn(r,e,{slice:!1,parseOptions:t,errorOnInvalidContent:s.errorOnInvalidContent})}const qN=(r,e=!1,t={},s={})=>({editor:n,tr:i,dispatch:o,commands:l})=>{var c,d;const{doc:u}=i;if(t.preserveWhitespace!=="full"){const h=bl(r,n.schema,t,{errorOnInvalidContent:(c=s.errorOnInvalidContent)!==null&&c!==void 0?c:n.options.enableContentCheck});return o&&i.replaceWith(0,u.content.size,h).setMeta("preventUpdate",!e),!0}return o&&i.setMeta("preventUpdate",!e),l.insertContentAt({from:0,to:u.content.size},r,{parseOptions:t,errorOnInvalidContent:(d=s.errorOnInvalidContent)!==null&&d!==void 0?d:n.options.enableContentCheck})};function Kp(r,e){const t=_r(e,r.schema),{from:s,to:n,empty:i}=r.selection,o=[];i?(r.storedMarks&&o.push(...r.storedMarks),o.push(...r.selection.$head.marks())):r.doc.nodesBetween(s,n,c=>{o.push(...c.marks)});const l=o.find(c=>c.type.name===t.name);return l?{...l.attrs}:{}}function KN(r,e){const t=new Uf(r);return e.forEach(s=>{s.steps.forEach(n=>{t.step(n)})}),t}function GN(r){for(let e=0;e<r.edgeCount;e+=1){const{type:t}=r.edge(e);if(t.isTextblock&&!t.hasRequiredAttrs())return t}return null}function wl(r,e){const t=[];return r.descendants((s,n)=>{e(s)&&t.push({node:s,pos:n})}),t}function YN(r,e,t){const s=[];return r.nodesBetween(e.from,e.to,(n,i)=>{t(n)&&s.push({node:n,pos:i})}),s}function JN(r,e){for(let t=r.depth;t>0;t-=1){const s=r.node(t);if(e(s))return{pos:t>0?r.before(t):0,start:r.start(t),depth:t,node:s}}}function vc(r){return e=>JN(e.$from,r)}function XN(r,e){const t={from:0,to:r.content.size};return Fp(r,t,e)}function QN(r,e){const t=Ye(e,r.schema),{from:s,to:n}=r.selection,i=[];r.doc.nodesBetween(s,n,l=>{i.push(l)});const o=i.reverse().find(l=>l.type.name===t.name);return o?{...o.attrs}:{}}function Gp(r,e){const t=Zo(typeof e=="string"?e:e.name,r.schema);return t==="node"?QN(r,e):t==="mark"?Kp(r,e):{}}function ZN(r,e=JSON.stringify){const t={};return r.filter(s=>{const n=e(s);return Object.prototype.hasOwnProperty.call(t,n)?!1:t[n]=!0})}function ej(r){const e=ZN(r);return e.length===1?e:e.filter((t,s)=>!e.filter((i,o)=>o!==s).some(i=>t.oldRange.from>=i.oldRange.from&&t.oldRange.to<=i.oldRange.to&&t.newRange.from>=i.newRange.from&&t.newRange.to<=i.newRange.to))}function tj(r){const{mapping:e,steps:t}=r,s=[];return e.maps.forEach((n,i)=>{const o=[];if(n.ranges.length)n.forEach((l,c)=>{o.push({from:l,to:c})});else{const{from:l,to:c}=t[i];if(l===void 0||c===void 0)return;o.push({from:l,to:c})}o.forEach(({from:l,to:c})=>{const d=e.slice(i).map(l,-1),u=e.slice(i).map(c),h=e.invert().map(d,-1),f=e.invert().map(u);s.push({oldRange:{from:h,to:f},newRange:{from:d,to:u}})})}),ej(s)}function Nc(r,e,t){const s=[];return r===e?t.resolve(r).marks().forEach(n=>{const i=t.resolve(r),o=wc(i,n.type);o&&s.push({mark:n,...o})}):t.nodesBetween(r,e,(n,i)=>{!n||(n==null?void 0:n.nodeSize)===void 0||s.push(...n.marks.map(o=>({from:i,to:i+n.nodeSize,mark:o})))}),s}function Ni(r,e,t){return Object.fromEntries(Object.entries(t).filter(([s])=>{const n=r.find(i=>i.type===e&&i.name===s);return n?n.attribute.keepOnSplit:!1}))}function vl(r,e,t={}){const{empty:s,ranges:n}=r.selection,i=e?_r(e,r.schema):null;if(s)return!!(r.storedMarks||r.selection.$from.marks()).filter(h=>i?i.name===h.type.name:!0).find(h=>Xi(h.attrs,t,{strict:!1}));let o=0;const l=[];if(n.forEach(({$from:h,$to:f})=>{const p=h.pos,m=f.pos;r.doc.nodesBetween(p,m,(g,y)=>{if(!g.isText&&!g.marks.length)return;const x=Math.max(p,y),N=Math.min(m,y+g.nodeSize),A=N-x;o+=A,l.push(...g.marks.map(S=>({mark:S,from:x,to:N})))})}),o===0)return!1;const c=l.filter(h=>i?i.name===h.mark.type.name:!0).filter(h=>Xi(h.mark.attrs,t,{strict:!1})).reduce((h,f)=>h+f.to-f.from,0),d=l.filter(h=>i?h.mark.type!==i&&h.mark.type.excludes(i):!0).reduce((h,f)=>h+f.to-f.from,0);return(c>0?c+d:c)>=o}function rj(r,e,t={}){if(!e)return In(r,null,t)||vl(r,null,t);const s=Zo(e,r.schema);return s==="node"?In(r,e,t):s==="mark"?vl(r,e,t):!1}function hu(r,e){const{nodeExtensions:t}=Yo(e),s=t.find(o=>o.name===r);if(!s)return!1;const n={name:s.name,options:s.options,storage:s.storage},i=fe(ee(s,"group",n));return typeof i!="string"?!1:i.split(" ").includes("list")}function jc(r,{checkChildren:e=!0,ignoreWhitespace:t=!1}={}){var s;if(t){if(r.type.name==="hardBreak")return!0;if(r.isText)return/^\s*$/m.test((s=r.text)!==null&&s!==void 0?s:"")}if(r.isText)return!r.text;if(r.isAtom||r.isLeaf)return!1;if(r.content.childCount===0)return!0;if(e){let n=!0;return r.content.forEach(i=>{n!==!1&&(jc(i,{ignoreWhitespace:t,checkChildren:e})||(n=!1))}),n}return!1}function sj(r){return r instanceof se}function nj(r,e,t){var s;const{selection:n}=e;let i=null;if(zp(n)&&(i=n.$cursor),i){const l=(s=r.storedMarks)!==null&&s!==void 0?s:i.marks();return!!t.isInSet(l)||!l.some(c=>c.type.excludes(t))}const{ranges:o}=n;return o.some(({$from:l,$to:c})=>{let d=l.depth===0?r.doc.inlineContent&&r.doc.type.allowsMarkType(t):!1;return r.doc.nodesBetween(l.pos,c.pos,(u,h,f)=>{if(d)return!1;if(u.isInline){const p=!f||f.type.allowsMarkType(t),m=!!t.isInSet(u.marks)||!u.marks.some(g=>g.type.excludes(t));d=p&&m}return!d}),d})}const ij=(r,e={})=>({tr:t,state:s,dispatch:n})=>{const{selection:i}=t,{empty:o,ranges:l}=i,c=_r(r,s.schema);if(n)if(o){const d=Kp(s,c);t.addStoredMark(c.create({...d,...e}))}else l.forEach(d=>{const u=d.$from.pos,h=d.$to.pos;s.doc.nodesBetween(u,h,(f,p)=>{const m=Math.max(p,u),g=Math.min(p+f.nodeSize,h);f.marks.find(x=>x.type===c)?f.marks.forEach(x=>{c===x.type&&t.addMark(m,g,c.create({...x.attrs,...e}))}):t.addMark(m,g,c.create(e))})});return nj(s,t,c)},oj=(r,e)=>({tr:t})=>(t.setMeta(r,e),!0),aj=(r,e={})=>({state:t,dispatch:s,chain:n})=>{const i=Ye(r,t.schema);let o;return t.selection.$anchor.sameParent(t.selection.$head)&&(o=t.selection.$anchor.parent.attrs),i.isTextblock?n().command(({commands:l})=>ou(i,{...o,...e})(t)?!0:l.clearNodes()).command(({state:l})=>ou(i,{...o,...e})(l,s)).run():(console.warn('[tiptap warn]: Currently "setNode()" only supports text block nodes.'),!1)},lj=r=>({tr:e,dispatch:t})=>{if(t){const{doc:s}=e,n=ts(r,0,s.content.size),i=se.create(s,n);e.setSelection(i)}return!0},cj=r=>({tr:e,dispatch:t})=>{if(t){const{doc:s}=e,{from:n,to:i}=typeof r=="number"?{from:r,to:r}:r,o=ce.atStart(s).from,l=ce.atEnd(s).to,c=ts(n,o,l),d=ts(i,o,l),u=ce.create(s,c,d);e.setSelection(u)}return!0},dj=r=>({state:e,dispatch:t})=>{const s=Ye(r,e.schema);return U1(s)(e,t)};function fu(r,e){const t=r.storedMarks||r.selection.$to.parentOffset&&r.selection.$from.marks();if(t){const s=t.filter(n=>e==null?void 0:e.includes(n.type.name));r.tr.ensureMarks(s)}}const uj=({keepMarks:r=!0}={})=>({tr:e,state:t,dispatch:s,editor:n})=>{const{selection:i,doc:o}=e,{$from:l,$to:c}=i,d=n.extensionManager.attributes,u=Ni(d,l.node().type.name,l.node().attrs);if(i instanceof se&&i.node.isBlock)return!l.parentOffset||!nr(o,l.pos)?!1:(s&&(r&&fu(t,n.extensionManager.splittableMarks),e.split(l.pos).scrollIntoView()),!0);if(!l.parent.isBlock)return!1;const h=c.parentOffset===c.parent.content.size,f=l.depth===0?void 0:GN(l.node(-1).contentMatchAt(l.indexAfter(-1)));let p=h&&f?[{type:f,attrs:u}]:void 0,m=nr(e.doc,e.mapping.map(l.pos),1,p);if(!p&&!m&&nr(e.doc,e.mapping.map(l.pos),1,f?[{type:f}]:void 0)&&(m=!0,p=f?[{type:f,attrs:u}]:void 0),s){if(m&&(i instanceof ce&&e.deleteSelection(),e.split(e.mapping.map(l.pos),1,p),f&&!h&&!l.parentOffset&&l.parent.type!==f)){const g=e.mapping.map(l.before()),y=e.doc.resolve(g);l.node(-1).canReplaceWith(y.index(),y.index()+1,f)&&e.setNodeMarkup(e.mapping.map(l.before()),f)}r&&fu(t,n.extensionManager.splittableMarks),e.scrollIntoView()}return m},hj=(r,e={})=>({tr:t,state:s,dispatch:n,editor:i})=>{var o;const l=Ye(r,s.schema),{$from:c,$to:d}=s.selection,u=s.selection.node;if(u&&u.isBlock||c.depth<2||!c.sameParent(d))return!1;const h=c.node(-1);if(h.type!==l)return!1;const f=i.extensionManager.attributes;if(c.parent.content.size===0&&c.node(-1).childCount===c.indexAfter(-1)){if(c.depth===2||c.node(-3).type!==l||c.index(-2)!==c.node(-2).childCount-1)return!1;if(n){let x=z.empty;const N=c.index(-1)?1:c.index(-2)?2:3;for(let w=c.depth-N;w>=c.depth-3;w-=1)x=z.from(c.node(w).copy(x));const A=c.indexAfter(-1)<c.node(-2).childCount?1:c.indexAfter(-2)<c.node(-3).childCount?2:3,S={...Ni(f,c.node().type.name,c.node().attrs),...e},k=((o=l.contentMatch.defaultType)===null||o===void 0?void 0:o.createAndFill(S))||void 0;x=x.append(z.from(l.createAndFill(null,k)||void 0));const R=c.before(c.depth-(N-1));t.replace(R,c.after(-A),new Q(x,4-N,0));let j=-1;t.doc.nodesBetween(R,t.doc.content.size,(w,v)=>{if(j>-1)return!1;w.isTextblock&&w.content.size===0&&(j=v+1)}),j>-1&&t.setSelection(ce.near(t.doc.resolve(j))),t.scrollIntoView()}return!0}const p=d.pos===c.end()?h.contentMatchAt(0).defaultType:null,m={...Ni(f,h.type.name,h.attrs),...e},g={...Ni(f,c.node().type.name,c.node().attrs),...e};t.delete(c.pos,d.pos);const y=p?[{type:l,attrs:m},{type:p,attrs:g}]:[{type:l,attrs:m}];if(!nr(t.doc,c.pos,2))return!1;if(n){const{selection:x,storedMarks:N}=s,{splittableMarks:A}=i.extensionManager,S=N||x.$to.parentOffset&&x.$from.marks();if(t.split(c.pos,2,y).scrollIntoView(),!S||!n)return!0;const k=S.filter(R=>A.includes(R.type.name));t.ensureMarks(k)}return!0},Ea=(r,e)=>{const t=vc(o=>o.type===e)(r.selection);if(!t)return!0;const s=r.doc.resolve(Math.max(0,t.pos-1)).before(t.depth);if(s===void 0)return!0;const n=r.doc.nodeAt(s);return t.node.type===(n==null?void 0:n.type)&&Lr(r.doc,t.pos)&&r.join(t.pos),!0},Aa=(r,e)=>{const t=vc(o=>o.type===e)(r.selection);if(!t)return!0;const s=r.doc.resolve(t.start).after(t.depth);if(s===void 0)return!0;const n=r.doc.nodeAt(s);return t.node.type===(n==null?void 0:n.type)&&Lr(r.doc,s)&&r.join(s),!0},fj=(r,e,t,s={})=>({editor:n,tr:i,state:o,dispatch:l,chain:c,commands:d,can:u})=>{const{extensions:h,splittableMarks:f}=n.extensionManager,p=Ye(r,o.schema),m=Ye(e,o.schema),{selection:g,storedMarks:y}=o,{$from:x,$to:N}=g,A=x.blockRange(N),S=y||g.$to.parentOffset&&g.$from.marks();if(!A)return!1;const k=vc(R=>hu(R.type.name,h))(g);if(A.depth>=1&&k&&A.depth-k.depth<=1){if(k.node.type===p)return d.liftListItem(m);if(hu(k.node.type.name,h)&&p.validContent(k.node.content)&&l)return c().command(()=>(i.setNodeMarkup(k.pos,p),!0)).command(()=>Ea(i,p)).command(()=>Aa(i,p)).run()}return!t||!S||!l?c().command(()=>u().wrapInList(p,s)?!0:d.clearNodes()).wrapInList(p,s).command(()=>Ea(i,p)).command(()=>Aa(i,p)).run():c().command(()=>{const R=u().wrapInList(p,s),j=S.filter(w=>f.includes(w.type.name));return i.ensureMarks(j),R?!0:d.clearNodes()}).wrapInList(p,s).command(()=>Ea(i,p)).command(()=>Aa(i,p)).run()},pj=(r,e={},t={})=>({state:s,commands:n})=>{const{extendEmptyMarkRange:i=!1}=t,o=_r(r,s.schema);return vl(s,o,e)?n.unsetMark(o,{extendEmptyMarkRange:i}):n.setMark(o,e)},mj=(r,e,t={})=>({state:s,commands:n})=>{const i=Ye(r,s.schema),o=Ye(e,s.schema),l=In(s,i,t);let c;return s.selection.$anchor.sameParent(s.selection.$head)&&(c=s.selection.$anchor.parent.attrs),l?n.setNode(o,c):n.setNode(i,{...c,...t})},gj=(r,e={})=>({state:t,commands:s})=>{const n=Ye(r,t.schema);return In(t,n,e)?s.lift(n):s.wrapIn(n,e)},xj=()=>({state:r,dispatch:e})=>{const t=r.plugins;for(let s=0;s<t.length;s+=1){const n=t[s];let i;if(n.spec.isInputRules&&(i=n.getState(r))){if(e){const o=r.tr,l=i.transform;for(let c=l.steps.length-1;c>=0;c-=1)o.step(l.steps[c].invert(l.docs[c]));if(i.text){const c=o.doc.resolve(i.from).marks();o.replaceWith(i.from,i.to,r.schema.text(i.text,c))}else o.delete(i.from,i.to)}return!0}}return!1},yj=()=>({tr:r,dispatch:e})=>{const{selection:t}=r,{empty:s,ranges:n}=t;return s||e&&n.forEach(i=>{r.removeMark(i.$from.pos,i.$to.pos)}),!0},bj=(r,e={})=>({tr:t,state:s,dispatch:n})=>{var i;const{extendEmptyMarkRange:o=!1}=e,{selection:l}=t,c=_r(r,s.schema),{$from:d,empty:u,ranges:h}=l;if(!n)return!0;if(u&&o){let{from:f,to:p}=l;const m=(i=d.marks().find(y=>y.type===c))===null||i===void 0?void 0:i.attrs,g=wc(d,c,m);g&&(f=g.from,p=g.to),t.removeMark(f,p,c)}else h.forEach(f=>{t.removeMark(f.$from.pos,f.$to.pos,c)});return t.removeStoredMark(c),!0},wj=(r,e={})=>({tr:t,state:s,dispatch:n})=>{let i=null,o=null;const l=Zo(typeof r=="string"?r:r.name,s.schema);return l?(l==="node"&&(i=Ye(r,s.schema)),l==="mark"&&(o=_r(r,s.schema)),n&&t.selection.ranges.forEach(c=>{const d=c.$from.pos,u=c.$to.pos;let h,f,p,m;t.selection.empty?s.doc.nodesBetween(d,u,(g,y)=>{i&&i===g.type&&(p=Math.max(y,d),m=Math.min(y+g.nodeSize,u),h=y,f=g)}):s.doc.nodesBetween(d,u,(g,y)=>{y<d&&i&&i===g.type&&(p=Math.max(y,d),m=Math.min(y+g.nodeSize,u),h=y,f=g),y>=d&&y<=u&&(i&&i===g.type&&t.setNodeMarkup(y,void 0,{...g.attrs,...e}),o&&g.marks.length&&g.marks.forEach(x=>{if(o===x.type){const N=Math.max(y,d),A=Math.min(y+g.nodeSize,u);t.addMark(N,A,o.create({...x.attrs,...e}))}}))}),f&&(h!==void 0&&t.setNodeMarkup(h,void 0,{...f.attrs,...e}),o&&f.marks.length&&f.marks.forEach(g=>{o===g.type&&t.addMark(p,m,o.create({...g.attrs,...e}))}))}),!0):!1},vj=(r,e={})=>({state:t,dispatch:s})=>{const n=Ye(r,t.schema);return I1(n,e)(t,s)},Nj=(r,e={})=>({state:t,dispatch:s})=>{const n=Ye(r,t.schema);return P1(n,e)(t,s)};var jj=Object.freeze({__proto__:null,blur:nN,clearContent:iN,clearNodes:oN,command:aN,createParagraphNear:lN,cut:cN,deleteCurrentNode:dN,deleteNode:uN,deleteRange:hN,deleteSelection:fN,enter:pN,exitCode:mN,extendMarkRange:gN,first:xN,focus:yN,forEach:bN,insertContent:wN,insertContentAt:jN,joinBackward:EN,joinDown:SN,joinForward:AN,joinItemBackward:CN,joinItemForward:MN,joinTextblockBackward:DN,joinTextblockForward:TN,joinUp:kN,keyboardShortcut:RN,lift:IN,liftEmptyBlock:PN,liftListItem:LN,newlineInCode:$N,resetAttributes:_N,scrollIntoView:FN,selectAll:BN,selectNodeBackward:UN,selectNodeForward:zN,selectParentNode:WN,selectTextblockEnd:HN,selectTextblockStart:VN,setContent:qN,setMark:ij,setMeta:oj,setNode:aj,setNodeSelection:lj,setTextSelection:cj,sinkListItem:dj,splitBlock:uj,splitListItem:hj,toggleList:fj,toggleMark:pj,toggleNode:mj,toggleWrap:gj,undoInputRule:xj,unsetAllMarks:yj,unsetMark:bj,updateAttributes:wj,wrapIn:vj,wrapInList:Nj});const kj=nt.create({name:"commands",addCommands(){return{...jj}}}),Sj=nt.create({name:"drop",addProseMirrorPlugins(){return[new Je({key:new yt("tiptapDrop"),props:{handleDrop:(r,e,t,s)=>{this.editor.emit("drop",{editor:this.editor,event:e,slice:t,moved:s})}}})]}}),Ej=nt.create({name:"editable",addProseMirrorPlugins(){return[new Je({key:new yt("editable"),props:{editable:()=>this.editor.options.editable}})]}}),Aj=new yt("focusEvents"),Cj=nt.create({name:"focusEvents",addProseMirrorPlugins(){const{editor:r}=this;return[new Je({key:Aj,props:{handleDOMEvents:{focus:(e,t)=>{r.isFocused=!0;const s=r.state.tr.setMeta("focus",{event:t}).setMeta("addToHistory",!1);return e.dispatch(s),!1},blur:(e,t)=>{r.isFocused=!1;const s=r.state.tr.setMeta("blur",{event:t}).setMeta("addToHistory",!1);return e.dispatch(s),!1}}}})]}}),Mj=nt.create({name:"keymap",addKeyboardShortcuts(){const r=()=>this.editor.commands.first(({commands:o})=>[()=>o.undoInputRule(),()=>o.command(({tr:l})=>{const{selection:c,doc:d}=l,{empty:u,$anchor:h}=c,{pos:f,parent:p}=h,m=h.parent.isTextblock&&f>0?l.doc.resolve(f-1):h,g=m.parent.type.spec.isolating,y=h.pos-h.parentOffset,x=g&&m.parent.childCount===1?y===h.pos:de.atStart(d).from===f;return!u||!p.type.isTextblock||p.textContent.length||!x||x&&h.parent.type.name==="paragraph"?!1:o.clearNodes()}),()=>o.deleteSelection(),()=>o.joinBackward(),()=>o.selectNodeBackward()]),e=()=>this.editor.commands.first(({commands:o})=>[()=>o.deleteSelection(),()=>o.deleteCurrentNode(),()=>o.joinForward(),()=>o.selectNodeForward()]),s={Enter:()=>this.editor.commands.first(({commands:o})=>[()=>o.newlineInCode(),()=>o.createParagraphNear(),()=>o.liftEmptyBlock(),()=>o.splitBlock()]),"Mod-Enter":()=>this.editor.commands.exitCode(),Backspace:r,"Mod-Backspace":r,"Shift-Backspace":r,Delete:e,"Mod-Delete":e,"Mod-a":()=>this.editor.commands.selectAll()},n={...s},i={...s,"Ctrl-h":r,"Alt-Backspace":r,"Ctrl-d":e,"Ctrl-Alt-Backspace":e,"Alt-Delete":e,"Alt-d":e,"Ctrl-a":()=>this.editor.commands.selectTextblockStart(),"Ctrl-e":()=>this.editor.commands.selectTextblockEnd()};return Qo()||qp()?i:n},addProseMirrorPlugins(){return[new Je({key:new yt("clearDocument"),appendTransaction:(r,e,t)=>{if(r.some(g=>g.getMeta("composition")))return;const s=r.some(g=>g.docChanged)&&!e.doc.eq(t.doc),n=r.some(g=>g.getMeta("preventClearDocument"));if(!s||n)return;const{empty:i,from:o,to:l}=e.selection,c=de.atStart(e.doc).from,d=de.atEnd(e.doc).to;if(i||!(o===c&&l===d)||!jc(t.doc))return;const f=t.tr,p=Ko({state:t,transaction:f}),{commands:m}=new Go({editor:this.editor,state:p});if(m.clearNodes(),!!f.steps.length)return f}})]}}),Dj=nt.create({name:"paste",addProseMirrorPlugins(){return[new Je({key:new yt("tiptapPaste"),props:{handlePaste:(r,e,t)=>{this.editor.emit("paste",{editor:this.editor,event:e,slice:t})}}})]}}),Tj=nt.create({name:"tabindex",addProseMirrorPlugins(){return[new Je({key:new yt("tabindex"),props:{attributes:()=>this.editor.isEditable?{tabindex:"0"}:{}}})]}});class Kr{get name(){return this.node.type.name}constructor(e,t,s=!1,n=null){this.currentNode=null,this.actualDepth=null,this.isBlock=s,this.resolvedPos=e,this.editor=t,this.currentNode=n}get node(){return this.currentNode||this.resolvedPos.node()}get element(){return this.editor.view.domAtPos(this.pos).node}get depth(){var e;return(e=this.actualDepth)!==null&&e!==void 0?e:this.resolvedPos.depth}get pos(){return this.resolvedPos.pos}get content(){return this.node.content}set content(e){let t=this.from,s=this.to;if(this.isBlock){if(this.content.size===0){console.error(`You can’t set content on a block node. Tried to set content on ${this.name} at ${this.pos}`);return}t=this.from+1,s=this.to-1}this.editor.commands.insertContentAt({from:t,to:s},e)}get attributes(){return this.node.attrs}get textContent(){return this.node.textContent}get size(){return this.node.nodeSize}get from(){return this.isBlock?this.pos:this.resolvedPos.start(this.resolvedPos.depth)}get range(){return{from:this.from,to:this.to}}get to(){return this.isBlock?this.pos+this.size:this.resolvedPos.end(this.resolvedPos.depth)+(this.node.isText?0:1)}get parent(){if(this.depth===0)return null;const e=this.resolvedPos.start(this.resolvedPos.depth-1),t=this.resolvedPos.doc.resolve(e);return new Kr(t,this.editor)}get before(){let e=this.resolvedPos.doc.resolve(this.from-(this.isBlock?1:2));return e.depth!==this.depth&&(e=this.resolvedPos.doc.resolve(this.from-3)),new Kr(e,this.editor)}get after(){let e=this.resolvedPos.doc.resolve(this.to+(this.isBlock?2:1));return e.depth!==this.depth&&(e=this.resolvedPos.doc.resolve(this.to+3)),new Kr(e,this.editor)}get children(){const e=[];return this.node.content.forEach((t,s)=>{const n=t.isBlock&&!t.isTextblock,i=t.isAtom&&!t.isText,o=this.pos+s+(i?0:1);if(o<0||o>this.resolvedPos.doc.nodeSize-2)return;const l=this.resolvedPos.doc.resolve(o);if(!n&&l.depth<=this.depth)return;const c=new Kr(l,this.editor,n,n?t:null);n&&(c.actualDepth=this.depth+1),e.push(new Kr(l,this.editor,n,n?t:null))}),e}get firstChild(){return this.children[0]||null}get lastChild(){const e=this.children;return e[e.length-1]||null}closest(e,t={}){let s=null,n=this.parent;for(;n&&!s;){if(n.node.type.name===e)if(Object.keys(t).length>0){const i=n.node.attrs,o=Object.keys(t);for(let l=0;l<o.length;l+=1){const c=o[l];if(i[c]!==t[c])break}}else s=n;n=n.parent}return s}querySelector(e,t={}){return this.querySelectorAll(e,t,!0)[0]||null}querySelectorAll(e,t={},s=!1){let n=[];if(!this.children||this.children.length===0)return n;const i=Object.keys(t);return this.children.forEach(o=>{s&&n.length>0||(o.node.type.name===e&&i.every(c=>t[c]===o.node.attrs[c])&&n.push(o),!(s&&n.length>0)&&(n=n.concat(o.querySelectorAll(e,t,s))))}),n}setAttribute(e){const{tr:t}=this.editor.state;t.setNodeMarkup(this.from,void 0,{...this.node.attrs,...e}),this.editor.view.dispatch(t)}}const Oj=`.ProseMirror {
  position: relative;
}

.ProseMirror {
  word-wrap: break-word;
  white-space: pre-wrap;
  white-space: break-spaces;
  -webkit-font-variant-ligatures: none;
  font-variant-ligatures: none;
  font-feature-settings: "liga" 0; /* the above doesn't seem to work in Edge */
}

.ProseMirror [contenteditable="false"] {
  white-space: normal;
}

.ProseMirror [contenteditable="false"] [contenteditable="true"] {
  white-space: pre-wrap;
}

.ProseMirror pre {
  white-space: pre-wrap;
}

img.ProseMirror-separator {
  display: inline !important;
  border: none !important;
  margin: 0 !important;
  width: 0 !important;
  height: 0 !important;
}

.ProseMirror-gapcursor {
  display: none;
  pointer-events: none;
  position: absolute;
  margin: 0;
}

.ProseMirror-gapcursor:after {
  content: "";
  display: block;
  position: absolute;
  top: -2px;
  width: 20px;
  border-top: 1px solid black;
  animation: ProseMirror-cursor-blink 1.1s steps(2, start) infinite;
}

@keyframes ProseMirror-cursor-blink {
  to {
    visibility: hidden;
  }
}

.ProseMirror-hideselection *::selection {
  background: transparent;
}

.ProseMirror-hideselection *::-moz-selection {
  background: transparent;
}

.ProseMirror-hideselection * {
  caret-color: transparent;
}

.ProseMirror-focused .ProseMirror-gapcursor {
  display: block;
}

.tippy-box[data-animation=fade][data-state=hidden] {
  opacity: 0
}`;function Rj(r,e,t){const s=document.querySelector("style[data-tiptap-style]");if(s!==null)return s;const n=document.createElement("style");return e&&n.setAttribute("nonce",e),n.setAttribute("data-tiptap-style",""),n.innerHTML=r,document.getElementsByTagName("head")[0].appendChild(n),n}class Ij extends z1{constructor(e={}){super(),this.isFocused=!1,this.isInitialized=!1,this.extensionStorage={},this.options={element:document.createElement("div"),content:"",injectCSS:!0,injectNonce:void 0,extensions:[],autofocus:!1,editable:!0,editorProps:{},parseOptions:{},coreExtensionOptions:{},enableInputRules:!0,enablePasteRules:!0,enableCoreExtensions:!0,enableContentCheck:!1,emitContentError:!1,onBeforeCreate:()=>null,onCreate:()=>null,onUpdate:()=>null,onSelectionUpdate:()=>null,onTransaction:()=>null,onFocus:()=>null,onBlur:()=>null,onDestroy:()=>null,onContentError:({error:t})=>{throw t},onPaste:()=>null,onDrop:()=>null},this.isCapturingTransaction=!1,this.capturedTransaction=null,this.setOptions(e),this.createExtensionManager(),this.createCommandManager(),this.createSchema(),this.on("beforeCreate",this.options.onBeforeCreate),this.emit("beforeCreate",{editor:this}),this.on("contentError",this.options.onContentError),this.createView(),this.injectCSS(),this.on("create",this.options.onCreate),this.on("update",this.options.onUpdate),this.on("selectionUpdate",this.options.onSelectionUpdate),this.on("transaction",this.options.onTransaction),this.on("focus",this.options.onFocus),this.on("blur",this.options.onBlur),this.on("destroy",this.options.onDestroy),this.on("drop",({event:t,slice:s,moved:n})=>this.options.onDrop(t,s,n)),this.on("paste",({event:t,slice:s})=>this.options.onPaste(t,s)),window.setTimeout(()=>{this.isDestroyed||(this.commands.focus(this.options.autofocus),this.emit("create",{editor:this}),this.isInitialized=!0)},0)}get storage(){return this.extensionStorage}get commands(){return this.commandManager.commands}chain(){return this.commandManager.chain()}can(){return this.commandManager.can()}injectCSS(){this.options.injectCSS&&document&&(this.css=Rj(Oj,this.options.injectNonce))}setOptions(e={}){this.options={...this.options,...e},!(!this.view||!this.state||this.isDestroyed)&&(this.options.editorProps&&this.view.setProps(this.options.editorProps),this.view.updateState(this.state))}setEditable(e,t=!0){this.setOptions({editable:e}),t&&this.emit("update",{editor:this,transaction:this.state.tr})}get isEditable(){return this.options.editable&&this.view&&this.view.editable}get state(){return this.view.state}registerPlugin(e,t){const s=_p(t)?t(e,[...this.state.plugins]):[...this.state.plugins,e],n=this.state.reconfigure({plugins:s});return this.view.updateState(n),n}unregisterPlugin(e){if(this.isDestroyed)return;const t=this.state.plugins;let s=t;if([].concat(e).forEach(i=>{const o=typeof i=="string"?`${i}$`:i.key;s=s.filter(l=>!l.key.startsWith(o))}),t.length===s.length)return;const n=this.state.reconfigure({plugins:s});return this.view.updateState(n),n}createExtensionManager(){var e,t;const n=[...this.options.enableCoreExtensions?[Ej,sN.configure({blockSeparator:(t=(e=this.options.coreExtensionOptions)===null||e===void 0?void 0:e.clipboardTextSerializer)===null||t===void 0?void 0:t.blockSeparator}),kj,Cj,Mj,Tj,Sj,Dj].filter(i=>typeof this.options.enableCoreExtensions=="object"?this.options.enableCoreExtensions[i.name]!==!1:!0):[],...this.options.extensions].filter(i=>["extension","node","mark"].includes(i==null?void 0:i.type));this.extensionManager=new $s(n,this)}createCommandManager(){this.commandManager=new Go({editor:this})}createSchema(){this.schema=this.extensionManager.schema}createView(){var e;let t;try{t=bl(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:this.options.enableContentCheck})}catch(o){if(!(o instanceof Error)||!["[tiptap error]: Invalid JSON content","[tiptap error]: Invalid HTML content"].includes(o.message))throw o;this.emit("contentError",{editor:this,error:o,disableCollaboration:()=>{this.storage.collaboration&&(this.storage.collaboration.isDisabled=!0),this.options.extensions=this.options.extensions.filter(l=>l.name!=="collaboration"),this.createExtensionManager()}}),t=bl(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:!1})}const s=Wp(t,this.options.autofocus);this.view=new jp(this.options.element,{...this.options.editorProps,attributes:{role:"textbox",...(e=this.options.editorProps)===null||e===void 0?void 0:e.attributes},dispatchTransaction:this.dispatchTransaction.bind(this),state:Ls.create({doc:t,selection:s||void 0})});const n=this.state.reconfigure({plugins:this.extensionManager.plugins});this.view.updateState(n),this.createNodeViews(),this.prependClass();const i=this.view.dom;i.editor=this}createNodeViews(){this.view.isDestroyed||this.view.setProps({nodeViews:this.extensionManager.nodeViews})}prependClass(){this.view.dom.className=`tiptap ${this.view.dom.className}`}captureTransaction(e){this.isCapturingTransaction=!0,e(),this.isCapturingTransaction=!1;const t=this.capturedTransaction;return this.capturedTransaction=null,t}dispatchTransaction(e){if(this.view.isDestroyed)return;if(this.isCapturingTransaction){if(!this.capturedTransaction){this.capturedTransaction=e;return}e.steps.forEach(o=>{var l;return(l=this.capturedTransaction)===null||l===void 0?void 0:l.step(o)});return}const t=this.state.apply(e),s=!this.state.selection.eq(t.selection);this.emit("beforeTransaction",{editor:this,transaction:e,nextState:t}),this.view.updateState(t),this.emit("transaction",{editor:this,transaction:e}),s&&this.emit("selectionUpdate",{editor:this,transaction:e});const n=e.getMeta("focus"),i=e.getMeta("blur");n&&this.emit("focus",{editor:this,event:n.event,transaction:e}),i&&this.emit("blur",{editor:this,event:i.event,transaction:e}),!(!e.docChanged||e.getMeta("preventUpdate"))&&this.emit("update",{editor:this,transaction:e})}getAttributes(e){return Gp(this.state,e)}isActive(e,t){const s=typeof e=="string"?e:null,n=typeof e=="string"?t:e;return rj(this.state,s,n)}getJSON(){return this.state.doc.toJSON()}getHTML(){return yc(this.state.doc.content,this.schema)}getText(e){const{blockSeparator:t=`

`,textSerializers:s={}}=e||{};return XN(this.state.doc,{blockSeparator:t,textSerializers:{...Bp(this.schema),...s}})}get isEmpty(){return jc(this.state.doc)}getCharacterCount(){return console.warn('[tiptap warn]: "editor.getCharacterCount()" is deprecated. Please use "editor.storage.characterCount.characters()" instead.'),this.state.doc.content.size-2}destroy(){if(this.emit("destroy"),this.view){const e=this.view.dom;e&&e.editor&&delete e.editor,this.view.destroy()}this.removeAllListeners()}get isDestroyed(){var e;return!(!((e=this.view)===null||e===void 0)&&e.docView)}$node(e,t){var s;return((s=this.$doc)===null||s===void 0?void 0:s.querySelector(e,t))||null}$nodes(e,t){var s;return((s=this.$doc)===null||s===void 0?void 0:s.querySelectorAll(e,t))||null}$pos(e){const t=this.state.doc.resolve(e);return new Kr(t,this)}get $doc(){return this.$pos(0)}}function Ks(r){return new Jo({find:r.find,handler:({state:e,range:t,match:s})=>{const n=fe(r.getAttributes,void 0,s);if(n===!1||n===null)return null;const{tr:i}=e,o=s[s.length-1],l=s[0];if(o){const c=l.search(/\S/),d=t.from+l.indexOf(o),u=d+o.length;if(Nc(t.from,t.to,e.doc).filter(p=>p.mark.type.excluded.find(g=>g===r.type&&g!==p.mark.type)).filter(p=>p.to>d).length)return null;u<t.to&&i.delete(u,t.to),d>t.from&&i.delete(t.from+c,d);const f=t.from+c+o.length;i.addMark(t.from+c,f,r.type.create(n||{})),i.removeStoredMark(r.type)}}})}function Pj(r){return new Jo({find:r.find,handler:({state:e,range:t,match:s})=>{const n=fe(r.getAttributes,void 0,s)||{},{tr:i}=e,o=t.from;let l=t.to;const c=r.type.create(n);if(s[1]){const d=s[0].lastIndexOf(s[1]);let u=o+d;u>l?u=l:l=u+s[1].length;const h=s[0][s[0].length-1];i.insertText(h,o+s[0].length-1),i.replaceWith(u,l,c)}else if(s[0]){const d=r.type.isInline?o:o-1;i.insert(d,r.type.create(n)).delete(i.mapping.map(o),i.mapping.map(l))}i.scrollIntoView()}})}function Nl(r){return new Jo({find:r.find,handler:({state:e,range:t,match:s})=>{const n=e.doc.resolve(t.from),i=fe(r.getAttributes,void 0,s)||{};if(!n.node(-1).canReplaceWith(n.index(-1),n.indexAfter(-1),r.type))return null;e.tr.delete(t.from,t.to).setBlockType(t.from,t.from,r.type,i)}})}function Pn(r){return new Jo({find:r.find,handler:({state:e,range:t,match:s,chain:n})=>{const i=fe(r.getAttributes,void 0,s)||{},o=e.tr.delete(t.from,t.to),c=o.doc.resolve(t.from).blockRange(),d=c&&rc(c,r.type,i);if(!d)return null;if(o.wrap(c,d),r.keepMarks&&r.editor){const{selection:h,storedMarks:f}=e,{splittableMarks:p}=r.editor.extensionManager,m=f||h.$to.parentOffset&&h.$from.marks();if(m){const g=m.filter(y=>p.includes(y.type.name));o.ensureMarks(g)}}if(r.keepAttributes){const h=r.type.name==="bulletList"||r.type.name==="orderedList"?"listItem":"taskList";n().updateAttributes(h,i).run()}const u=o.doc.resolve(t.from-1).nodeBefore;u&&u.type===r.type&&Lr(o.doc,t.from-1)&&(!r.joinPredicate||r.joinPredicate(s,u))&&o.join(t.from-1)}})}class ut{constructor(e={}){this.type="node",this.name="node",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...e},this.name=this.config.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=fe(ee(this,"addOptions",{name:this.name}))),this.storage=fe(ee(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new ut(e)}configure(e={}){const t=this.extend({...this.config,addOptions:()=>Xo(this.options,e)});return t.name=this.name,t.parent=this.parent,t}extend(e={}){const t=new ut(e);return t.parent=this,this.child=t,t.name=e.name?e.name:t.parent.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${t.name}".`),t.options=fe(ee(t,"addOptions",{name:t.name})),t.storage=fe(ee(t,"addStorage",{name:t.name,options:t.options})),t}}class Lj{constructor(e,t,s){this.isDragging=!1,this.component=e,this.editor=t.editor,this.options={stopEvent:null,ignoreMutation:null,...s},this.extension=t.extension,this.node=t.node,this.decorations=t.decorations,this.innerDecorations=t.innerDecorations,this.view=t.view,this.HTMLAttributes=t.HTMLAttributes,this.getPos=t.getPos,this.mount()}mount(){}get dom(){return this.editor.view.dom}get contentDOM(){return null}onDragStart(e){var t,s,n,i,o,l,c;const{view:d}=this.editor,u=e.target,h=u.nodeType===3?(t=u.parentElement)===null||t===void 0?void 0:t.closest("[data-drag-handle]"):u.closest("[data-drag-handle]");if(!this.dom||!((s=this.contentDOM)===null||s===void 0)&&s.contains(u)||!h)return;let f=0,p=0;if(this.dom!==h){const N=this.dom.getBoundingClientRect(),A=h.getBoundingClientRect(),S=(n=e.offsetX)!==null&&n!==void 0?n:(i=e.nativeEvent)===null||i===void 0?void 0:i.offsetX,k=(o=e.offsetY)!==null&&o!==void 0?o:(l=e.nativeEvent)===null||l===void 0?void 0:l.offsetY;f=A.x-N.x+S,p=A.y-N.y+k}const m=this.dom.cloneNode(!0);(c=e.dataTransfer)===null||c===void 0||c.setDragImage(m,f,p);const g=this.getPos();if(typeof g!="number")return;const y=se.create(d.state.doc,g),x=d.state.tr.setSelection(y);d.dispatch(x)}stopEvent(e){var t;if(!this.dom)return!1;if(typeof this.options.stopEvent=="function")return this.options.stopEvent({event:e});const s=e.target;if(!(this.dom.contains(s)&&!(!((t=this.contentDOM)===null||t===void 0)&&t.contains(s))))return!1;const i=e.type.startsWith("drag"),o=e.type==="drop";if((["INPUT","BUTTON","SELECT","TEXTAREA"].includes(s.tagName)||s.isContentEditable)&&!o&&!i)return!0;const{isEditable:c}=this.editor,{isDragging:d}=this,u=!!this.node.type.spec.draggable,h=se.isSelectable(this.node),f=e.type==="copy",p=e.type==="paste",m=e.type==="cut",g=e.type==="mousedown";if(!u&&h&&i&&e.target===this.dom&&e.preventDefault(),u&&i&&!d&&e.target===this.dom)return e.preventDefault(),!1;if(u&&c&&!d&&g){const y=s.closest("[data-drag-handle]");y&&(this.dom===y||this.dom.contains(y))&&(this.isDragging=!0,document.addEventListener("dragend",()=>{this.isDragging=!1},{once:!0}),document.addEventListener("drop",()=>{this.isDragging=!1},{once:!0}),document.addEventListener("mouseup",()=>{this.isDragging=!1},{once:!0}))}return!(d||o||f||p||m||g&&h)}ignoreMutation(e){return!this.dom||!this.contentDOM?!0:typeof this.options.ignoreMutation=="function"?this.options.ignoreMutation({mutation:e}):this.node.isLeaf||this.node.isAtom?!0:e.type==="selection"||this.dom.contains(e.target)&&e.type==="childList"&&(Qo()||Hp())&&this.editor.isFocused&&[...Array.from(e.addedNodes),...Array.from(e.removedNodes)].every(s=>s.isContentEditable)?!1:this.contentDOM===e.target&&e.type==="attributes"?!0:!this.contentDOM.contains(e.target)}updateAttributes(e){this.editor.commands.command(({tr:t})=>{const s=this.getPos();return typeof s!="number"?!1:(t.setNodeMarkup(s,void 0,{...this.node.attrs,...e}),!0)})}deleteNode(){const e=this.getPos();if(typeof e!="number")return;const t=e+this.node.nodeSize;this.editor.commands.deleteRange({from:e,to:t})}}function ys(r){return new X1({find:r.find,handler:({state:e,range:t,match:s,pasteEvent:n})=>{const i=fe(r.getAttributes,void 0,s,n);if(i===!1||i===null)return null;const{tr:o}=e,l=s[s.length-1],c=s[0];let d=t.to;if(l){const u=c.search(/\S/),h=t.from+c.indexOf(l),f=h+l.length;if(Nc(t.from,t.to,e.doc).filter(m=>m.mark.type.excluded.find(y=>y===r.type&&y!==m.mark.type)).filter(m=>m.to>h).length)return null;f<t.to&&o.delete(f,t.to),h>t.from&&o.delete(t.from+u,h),d=t.from+u+l.length,o.addMark(t.from+u,d,r.type.create(i||{})),o.removeStoredMark(r.type)}}})}function $j(r,e){const{selection:t}=r,{$from:s}=t;if(t instanceof se){const i=s.index();return s.parent.canReplaceWith(i,i+1,e)}let n=s.depth;for(;n>=0;){const i=s.index(n);if(s.node(n).contentMatchAt(i).matchType(e))return!0;n-=1}return!1}function _j(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var Yp={exports:{}},Ca={};/**
 * @license React
 * use-sync-external-store-shim.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var pu;function Fj(){if(pu)return Ca;pu=1;var r=ze;function e(h,f){return h===f&&(h!==0||1/h===1/f)||h!==h&&f!==f}var t=typeof Object.is=="function"?Object.is:e,s=r.useState,n=r.useEffect,i=r.useLayoutEffect,o=r.useDebugValue;function l(h,f){var p=f(),m=s({inst:{value:p,getSnapshot:f}}),g=m[0].inst,y=m[1];return i(function(){g.value=p,g.getSnapshot=f,c(g)&&y({inst:g})},[h,p,f]),n(function(){return c(g)&&y({inst:g}),h(function(){c(g)&&y({inst:g})})},[h]),o(p),p}function c(h){var f=h.getSnapshot;h=h.value;try{var p=f();return!t(h,p)}catch{return!0}}function d(h,f){return f()}var u=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?d:l;return Ca.useSyncExternalStore=r.useSyncExternalStore!==void 0?r.useSyncExternalStore:u,Ca}Yp.exports=Fj();var kc=Yp.exports;const Bj=(...r)=>e=>{r.forEach(t=>{typeof t=="function"?t(e):t&&(t.current=e)})},Uj=({contentComponent:r})=>{const e=kc.useSyncExternalStore(r.subscribe,r.getSnapshot,r.getServerSnapshot);return ze.createElement(ze.Fragment,null,Object.values(e))};function zj(){const r=new Set;let e={};return{subscribe(t){return r.add(t),()=>{r.delete(t)}},getSnapshot(){return e},getServerSnapshot(){return e},setRenderer(t,s){e={...e,[t]:Km.createPortal(s.reactElement,s.element,t)},r.forEach(n=>n())},removeRenderer(t){const s={...e};delete s[t],e=s,r.forEach(n=>n())}}}class Wj extends ze.Component{constructor(e){var t;super(e),this.editorContentRef=ze.createRef(),this.initialized=!1,this.state={hasContentComponentInitialized:!!(!((t=e.editor)===null||t===void 0)&&t.contentComponent)}}componentDidMount(){this.init()}componentDidUpdate(){this.init()}init(){const e=this.props.editor;if(e&&!e.isDestroyed&&e.options.element){if(e.contentComponent)return;const t=this.editorContentRef.current;t.append(...e.options.element.childNodes),e.setOptions({element:t}),e.contentComponent=zj(),this.state.hasContentComponentInitialized||(this.unsubscribeToContentComponent=e.contentComponent.subscribe(()=>{this.setState(s=>s.hasContentComponentInitialized?s:{hasContentComponentInitialized:!0}),this.unsubscribeToContentComponent&&this.unsubscribeToContentComponent()})),e.createNodeViews(),this.initialized=!0}}componentWillUnmount(){const e=this.props.editor;if(!e||(this.initialized=!1,e.isDestroyed||e.view.setProps({nodeViews:{}}),this.unsubscribeToContentComponent&&this.unsubscribeToContentComponent(),e.contentComponent=null,!e.options.element.firstChild))return;const t=document.createElement("div");t.append(...e.options.element.childNodes),e.setOptions({element:t})}render(){const{editor:e,innerRef:t,...s}=this.props;return ze.createElement(ze.Fragment,null,ze.createElement("div",{ref:Bj(t,this.editorContentRef),...s}),(e==null?void 0:e.contentComponent)&&ze.createElement(Uj,{contentComponent:e.contentComponent}))}}const Hj=b.forwardRef((r,e)=>{const t=ze.useMemo(()=>Math.floor(Math.random()*4294967295).toString(),[r.editor]);return ze.createElement(Wj,{key:t,innerRef:e,...r})}),Vj=ze.memo(Hj);var qj=function r(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){if(e.constructor!==t.constructor)return!1;var s,n,i;if(Array.isArray(e)){if(s=e.length,s!=t.length)return!1;for(n=s;n--!==0;)if(!r(e[n],t[n]))return!1;return!0}if(e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(n of e.entries())if(!t.has(n[0]))return!1;for(n of e.entries())if(!r(n[1],t.get(n[0])))return!1;return!0}if(e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(n of e.entries())if(!t.has(n[0]))return!1;return!0}if(ArrayBuffer.isView(e)&&ArrayBuffer.isView(t)){if(s=e.length,s!=t.length)return!1;for(n=s;n--!==0;)if(e[n]!==t[n])return!1;return!0}if(e.constructor===RegExp)return e.source===t.source&&e.flags===t.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===t.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===t.toString();if(i=Object.keys(e),s=i.length,s!==Object.keys(t).length)return!1;for(n=s;n--!==0;)if(!Object.prototype.hasOwnProperty.call(t,i[n]))return!1;for(n=s;n--!==0;){var o=i[n];if(!(o==="_owner"&&e.$$typeof)&&!r(e[o],t[o]))return!1}return!0}return e!==e&&t!==t},Kj=_j(qj),Jp={exports:{}},Ma={};/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var mu;function Gj(){if(mu)return Ma;mu=1;var r=ze,e=kc;function t(d,u){return d===u&&(d!==0||1/d===1/u)||d!==d&&u!==u}var s=typeof Object.is=="function"?Object.is:t,n=e.useSyncExternalStore,i=r.useRef,o=r.useEffect,l=r.useMemo,c=r.useDebugValue;return Ma.useSyncExternalStoreWithSelector=function(d,u,h,f,p){var m=i(null);if(m.current===null){var g={hasValue:!1,value:null};m.current=g}else g=m.current;m=l(function(){function x(R){if(!N){if(N=!0,A=R,R=f(R),p!==void 0&&g.hasValue){var j=g.value;if(p(j,R))return S=j}return S=R}if(j=S,s(A,R))return j;var w=f(R);return p!==void 0&&p(j,w)?j:(A=R,S=w)}var N=!1,A,S,k=h===void 0?null:h;return[function(){return x(u())},k===null?void 0:function(){return x(k())}]},[u,h,f,p]);var y=n(d,m[0],m[1]);return o(function(){g.hasValue=!0,g.value=y},[y]),c(y),y},Ma}Jp.exports=Gj();var Yj=Jp.exports;const Jj=typeof window<"u"?b.useLayoutEffect:b.useEffect;class Xj{constructor(e){this.transactionNumber=0,this.lastTransactionNumber=0,this.subscribers=new Set,this.editor=e,this.lastSnapshot={editor:e,transactionNumber:0},this.getSnapshot=this.getSnapshot.bind(this),this.getServerSnapshot=this.getServerSnapshot.bind(this),this.watch=this.watch.bind(this),this.subscribe=this.subscribe.bind(this)}getSnapshot(){return this.transactionNumber===this.lastTransactionNumber?this.lastSnapshot:(this.lastTransactionNumber=this.transactionNumber,this.lastSnapshot={editor:this.editor,transactionNumber:this.transactionNumber},this.lastSnapshot)}getServerSnapshot(){return{editor:null,transactionNumber:0}}subscribe(e){return this.subscribers.add(e),()=>{this.subscribers.delete(e)}}watch(e){if(this.editor=e,this.editor){const t=()=>{this.transactionNumber+=1,this.subscribers.forEach(n=>n())},s=this.editor;return s.on("transaction",t),()=>{s.off("transaction",t)}}}}function Qj(r){var e;const[t]=b.useState(()=>new Xj(r.editor)),s=Yj.useSyncExternalStoreWithSelector(t.subscribe,t.getSnapshot,t.getServerSnapshot,r.selector,(e=r.equalityFn)!==null&&e!==void 0?e:Kj);return Jj(()=>t.watch(r.editor),[r.editor,t]),b.useDebugValue(s),s}const Zj=!1,jl=typeof window>"u",ek=jl||!!(typeof window<"u"&&window.next);class Sc{constructor(e){this.editor=null,this.subscriptions=new Set,this.isComponentMounted=!1,this.previousDeps=null,this.instanceId="",this.options=e,this.subscriptions=new Set,this.setEditor(this.getInitialEditor()),this.scheduleDestroy(),this.getEditor=this.getEditor.bind(this),this.getServerSnapshot=this.getServerSnapshot.bind(this),this.subscribe=this.subscribe.bind(this),this.refreshEditorInstance=this.refreshEditorInstance.bind(this),this.scheduleDestroy=this.scheduleDestroy.bind(this),this.onRender=this.onRender.bind(this),this.createEditor=this.createEditor.bind(this)}setEditor(e){this.editor=e,this.instanceId=Math.random().toString(36).slice(2,9),this.subscriptions.forEach(t=>t())}getInitialEditor(){return this.options.current.immediatelyRender===void 0?jl||ek?null:this.createEditor():(this.options.current.immediatelyRender,this.options.current.immediatelyRender?this.createEditor():null)}createEditor(){const e={...this.options.current,onBeforeCreate:(...s)=>{var n,i;return(i=(n=this.options.current).onBeforeCreate)===null||i===void 0?void 0:i.call(n,...s)},onBlur:(...s)=>{var n,i;return(i=(n=this.options.current).onBlur)===null||i===void 0?void 0:i.call(n,...s)},onCreate:(...s)=>{var n,i;return(i=(n=this.options.current).onCreate)===null||i===void 0?void 0:i.call(n,...s)},onDestroy:(...s)=>{var n,i;return(i=(n=this.options.current).onDestroy)===null||i===void 0?void 0:i.call(n,...s)},onFocus:(...s)=>{var n,i;return(i=(n=this.options.current).onFocus)===null||i===void 0?void 0:i.call(n,...s)},onSelectionUpdate:(...s)=>{var n,i;return(i=(n=this.options.current).onSelectionUpdate)===null||i===void 0?void 0:i.call(n,...s)},onTransaction:(...s)=>{var n,i;return(i=(n=this.options.current).onTransaction)===null||i===void 0?void 0:i.call(n,...s)},onUpdate:(...s)=>{var n,i;return(i=(n=this.options.current).onUpdate)===null||i===void 0?void 0:i.call(n,...s)},onContentError:(...s)=>{var n,i;return(i=(n=this.options.current).onContentError)===null||i===void 0?void 0:i.call(n,...s)},onDrop:(...s)=>{var n,i;return(i=(n=this.options.current).onDrop)===null||i===void 0?void 0:i.call(n,...s)},onPaste:(...s)=>{var n,i;return(i=(n=this.options.current).onPaste)===null||i===void 0?void 0:i.call(n,...s)}};return new Ij(e)}getEditor(){return this.editor}getServerSnapshot(){return null}subscribe(e){return this.subscriptions.add(e),()=>{this.subscriptions.delete(e)}}static compareOptions(e,t){return Object.keys(e).every(s=>["onCreate","onBeforeCreate","onDestroy","onUpdate","onTransaction","onFocus","onBlur","onSelectionUpdate","onContentError","onDrop","onPaste"].includes(s)?!0:s==="extensions"&&e.extensions&&t.extensions?e.extensions.length!==t.extensions.length?!1:e.extensions.every((n,i)=>{var o;return n===((o=t.extensions)===null||o===void 0?void 0:o[i])}):e[s]===t[s])}onRender(e){return()=>(this.isComponentMounted=!0,clearTimeout(this.scheduledDestructionTimeout),this.editor&&!this.editor.isDestroyed&&e.length===0?Sc.compareOptions(this.options.current,this.editor.options)||this.editor.setOptions({...this.options.current,editable:this.editor.isEditable}):this.refreshEditorInstance(e),()=>{this.isComponentMounted=!1,this.scheduleDestroy()})}refreshEditorInstance(e){if(this.editor&&!this.editor.isDestroyed){if(this.previousDeps===null){this.previousDeps=e;return}if(this.previousDeps.length===e.length&&this.previousDeps.every((s,n)=>s===e[n]))return}this.editor&&!this.editor.isDestroyed&&this.editor.destroy(),this.setEditor(this.createEditor()),this.previousDeps=e}scheduleDestroy(){const e=this.instanceId,t=this.editor;this.scheduledDestructionTimeout=setTimeout(()=>{if(this.isComponentMounted&&this.instanceId===e){t&&t.setOptions(this.options.current);return}t&&!t.isDestroyed&&(t.destroy(),this.instanceId===e&&this.setEditor(null))},1)}}function tk(r={},e=[]){const t=b.useRef(r);t.current=r;const[s]=b.useState(()=>new Sc(t)),n=kc.useSyncExternalStore(s.subscribe,s.getEditor,s.getServerSnapshot);return b.useDebugValue(n),b.useEffect(s.onRender(e)),Qj({editor:n,selector:({transactionNumber:i})=>r.shouldRerenderOnTransaction===!1?null:r.immediatelyRender&&i===0?0:i+1}),n}const rk=b.createContext({editor:null});rk.Consumer;const Xp=b.createContext({onDragStart:void 0}),sk=()=>b.useContext(Xp),nk=ze.forwardRef((r,e)=>{const{onDragStart:t}=sk(),s=r.as||"div";return ze.createElement(s,{...r,ref:e,"data-node-view-wrapper":"",onDragStart:t,style:{whiteSpace:"normal",...r.style}})});function gu(r){return!!(typeof r=="function"&&r.prototype&&r.prototype.isReactComponent)}function xu(r){return!!(typeof r=="object"&&r.$$typeof&&(r.$$typeof.toString()==="Symbol(react.forward_ref)"||r.$$typeof.description==="react.forward_ref"))}function ik(r){return!!(typeof r=="object"&&r.$$typeof&&(r.$$typeof.toString()==="Symbol(react.memo)"||r.$$typeof.description==="react.memo"))}function ok(r){if(gu(r)||xu(r))return!0;if(ik(r)){const e=r.type;if(e)return gu(e)||xu(e)}return!1}function ak(){try{if(b.version)return parseInt(b.version.split(".")[0],10)>=19}catch{}return!1}class lk{constructor(e,{editor:t,props:s={},as:n="div",className:i=""}){this.ref=null,this.id=Math.floor(Math.random()*4294967295).toString(),this.component=e,this.editor=t,this.props=s,this.element=document.createElement(n),this.element.classList.add("react-renderer"),i&&this.element.classList.add(...i.split(" ")),this.editor.isInitialized?Qu.flushSync(()=>{this.render()}):this.render()}render(){var e;const t=this.component,s=this.props,n=this.editor,i=ak(),o=ok(t),l={...s};l.ref&&!(i||o)&&delete l.ref,!l.ref&&(i||o)&&(l.ref=c=>{this.ref=c}),this.reactElement=ze.createElement(t,{...l}),(e=n==null?void 0:n.contentComponent)===null||e===void 0||e.setRenderer(this.id,this)}updateProps(e={}){this.props={...this.props,...e},this.render()}destroy(){var e;const t=this.editor;(e=t==null?void 0:t.contentComponent)===null||e===void 0||e.removeRenderer(this.id)}updateAttributes(e){Object.keys(e).forEach(t=>{this.element.setAttribute(t,e[t])})}}class ck extends Lj{mount(){const e={editor:this.editor,node:this.node,decorations:this.decorations,innerDecorations:this.innerDecorations,view:this.view,selected:!1,extension:this.extension,HTMLAttributes:this.HTMLAttributes,getPos:()=>this.getPos(),updateAttributes:(d={})=>this.updateAttributes(d),deleteNode:()=>this.deleteNode(),ref:b.createRef()};if(!this.component.displayName){const d=u=>u.charAt(0).toUpperCase()+u.substring(1);this.component.displayName=d(this.extension.name)}const n={onDragStart:this.onDragStart.bind(this),nodeViewContentRef:d=>{d&&this.contentDOMElement&&d.firstChild!==this.contentDOMElement&&d.appendChild(this.contentDOMElement)}},i=this.component,o=b.memo(d=>ze.createElement(Xp.Provider,{value:n},b.createElement(i,d)));o.displayName="ReactNodeView",this.node.isLeaf?this.contentDOMElement=null:this.options.contentDOMElementTag?this.contentDOMElement=document.createElement(this.options.contentDOMElementTag):this.contentDOMElement=document.createElement(this.node.isInline?"span":"div"),this.contentDOMElement&&(this.contentDOMElement.dataset.nodeViewContentReact="",this.contentDOMElement.style.whiteSpace="inherit");let l=this.node.isInline?"span":"div";this.options.as&&(l=this.options.as);const{className:c=""}=this.options;this.handleSelectionUpdate=this.handleSelectionUpdate.bind(this),this.renderer=new lk(o,{editor:this.editor,props:e,as:l,className:`node-${this.node.type.name} ${c}`.trim()}),this.editor.on("selectionUpdate",this.handleSelectionUpdate),this.updateElementAttributes()}get dom(){var e;if(this.renderer.element.firstElementChild&&!(!((e=this.renderer.element.firstElementChild)===null||e===void 0)&&e.hasAttribute("data-node-view-wrapper")))throw Error("Please use the NodeViewWrapper component for your node view.");return this.renderer.element}get contentDOM(){return this.node.isLeaf?null:this.contentDOMElement}handleSelectionUpdate(){const{from:e,to:t}=this.editor.state.selection,s=this.getPos();if(typeof s=="number")if(e<=s&&t>=s+this.node.nodeSize){if(this.renderer.props.selected)return;this.selectNode()}else{if(!this.renderer.props.selected)return;this.deselectNode()}}update(e,t,s){const n=i=>{this.renderer.updateProps(i),typeof this.options.attrs=="function"&&this.updateElementAttributes()};if(e.type!==this.node.type)return!1;if(typeof this.options.update=="function"){const i=this.node,o=this.decorations,l=this.innerDecorations;return this.node=e,this.decorations=t,this.innerDecorations=s,this.options.update({oldNode:i,oldDecorations:o,newNode:e,newDecorations:t,oldInnerDecorations:l,innerDecorations:s,updateProps:()=>n({node:e,decorations:t,innerDecorations:s})})}return e===this.node&&this.decorations===t&&this.innerDecorations===s||(this.node=e,this.decorations=t,this.innerDecorations=s,n({node:e,decorations:t,innerDecorations:s})),!0}selectNode(){this.renderer.updateProps({selected:!0}),this.renderer.element.classList.add("ProseMirror-selectednode")}deselectNode(){this.renderer.updateProps({selected:!1}),this.renderer.element.classList.remove("ProseMirror-selectednode")}destroy(){this.renderer.destroy(),this.editor.off("selectionUpdate",this.handleSelectionUpdate),this.contentDOMElement=null}updateElementAttributes(){if(this.options.attrs){let e={};if(typeof this.options.attrs=="function"){const t=this.editor.extensionManager.attributes,s=Ji(this.node,t);e=this.options.attrs({node:this.node,HTMLAttributes:s})}else e=this.options.attrs;this.renderer.updateAttributes(e)}}}function dk(r,e){return t=>t.editor.contentComponent?new ck(r,t,e):{}}const uk=/^\s*>\s$/,hk=ut.create({name:"blockquote",addOptions(){return{HTMLAttributes:{}}},content:"block+",group:"block",defining:!0,parseHTML(){return[{tag:"blockquote"}]},renderHTML({HTMLAttributes:r}){return["blockquote",He(this.options.HTMLAttributes,r),0]},addCommands(){return{setBlockquote:()=>({commands:r})=>r.wrapIn(this.name),toggleBlockquote:()=>({commands:r})=>r.toggleWrap(this.name),unsetBlockquote:()=>({commands:r})=>r.lift(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-b":()=>this.editor.commands.toggleBlockquote()}},addInputRules(){return[Pn({find:uk,type:this.type})]}}),fk=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))$/,pk=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))/g,mk=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))$/,gk=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))/g,xk=Kt.create({name:"bold",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"strong"},{tag:"b",getAttrs:r=>r.style.fontWeight!=="normal"&&null},{style:"font-weight=400",clearMark:r=>r.type.name===this.name},{style:"font-weight",getAttrs:r=>/^(bold(er)?|[5-9]\d{2,})$/.test(r)&&null}]},renderHTML({HTMLAttributes:r}){return["strong",He(this.options.HTMLAttributes,r),0]},addCommands(){return{setBold:()=>({commands:r})=>r.setMark(this.name),toggleBold:()=>({commands:r})=>r.toggleMark(this.name),unsetBold:()=>({commands:r})=>r.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-b":()=>this.editor.commands.toggleBold(),"Mod-B":()=>this.editor.commands.toggleBold()}},addInputRules(){return[Ks({find:fk,type:this.type}),Ks({find:mk,type:this.type})]},addPasteRules(){return[ys({find:pk,type:this.type}),ys({find:gk,type:this.type})]}}),yk="listItem",yu="textStyle",bu=/^\s*([-+*])\s$/,Qp=ut.create({name:"bulletList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:"ul"}]},renderHTML({HTMLAttributes:r}){return["ul",He(this.options.HTMLAttributes,r),0]},addCommands(){return{toggleBulletList:()=>({commands:r,chain:e})=>this.options.keepAttributes?e().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(yk,this.editor.getAttributes(yu)).run():r.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-8":()=>this.editor.commands.toggleBulletList()}},addInputRules(){let r=Pn({find:bu,type:this.type});return(this.options.keepMarks||this.options.keepAttributes)&&(r=Pn({find:bu,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:()=>this.editor.getAttributes(yu),editor:this.editor})),[r]}}),bk=/(^|[^`])`([^`]+)`(?!`)/,wk=/(^|[^`])`([^`]+)`(?!`)/g,vk=Kt.create({name:"code",addOptions(){return{HTMLAttributes:{}}},excludes:"_",code:!0,exitable:!0,parseHTML(){return[{tag:"code"}]},renderHTML({HTMLAttributes:r}){return["code",He(this.options.HTMLAttributes,r),0]},addCommands(){return{setCode:()=>({commands:r})=>r.setMark(this.name),toggleCode:()=>({commands:r})=>r.toggleMark(this.name),unsetCode:()=>({commands:r})=>r.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-e":()=>this.editor.commands.toggleCode()}},addInputRules(){return[Ks({find:bk,type:this.type})]},addPasteRules(){return[ys({find:wk,type:this.type})]}}),Nk=/^```([a-z]+)?[\s\n]$/,jk=/^~~~([a-z]+)?[\s\n]$/,Zp=ut.create({name:"codeBlock",addOptions(){return{languageClassPrefix:"language-",exitOnTripleEnter:!0,exitOnArrowDown:!0,defaultLanguage:null,HTMLAttributes:{}}},content:"text*",marks:"",group:"block",code:!0,defining:!0,addAttributes(){return{language:{default:this.options.defaultLanguage,parseHTML:r=>{var e;const{languageClassPrefix:t}=this.options,i=[...((e=r.firstElementChild)===null||e===void 0?void 0:e.classList)||[]].filter(o=>o.startsWith(t)).map(o=>o.replace(t,""))[0];return i||null},rendered:!1}}},parseHTML(){return[{tag:"pre",preserveWhitespace:"full"}]},renderHTML({node:r,HTMLAttributes:e}){return["pre",He(this.options.HTMLAttributes,e),["code",{class:r.attrs.language?this.options.languageClassPrefix+r.attrs.language:null},0]]},addCommands(){return{setCodeBlock:r=>({commands:e})=>e.setNode(this.name,r),toggleCodeBlock:r=>({commands:e})=>e.toggleNode(this.name,"paragraph",r)}},addKeyboardShortcuts(){return{"Mod-Alt-c":()=>this.editor.commands.toggleCodeBlock(),Backspace:()=>{const{empty:r,$anchor:e}=this.editor.state.selection,t=e.pos===1;return!r||e.parent.type.name!==this.name?!1:t||!e.parent.textContent.length?this.editor.commands.clearNodes():!1},Enter:({editor:r})=>{if(!this.options.exitOnTripleEnter)return!1;const{state:e}=r,{selection:t}=e,{$from:s,empty:n}=t;if(!n||s.parent.type!==this.type)return!1;const i=s.parentOffset===s.parent.nodeSize-2,o=s.parent.textContent.endsWith(`

`);return!i||!o?!1:r.chain().command(({tr:l})=>(l.delete(s.pos-2,s.pos),!0)).exitCode().run()},ArrowDown:({editor:r})=>{if(!this.options.exitOnArrowDown)return!1;const{state:e}=r,{selection:t,doc:s}=e,{$from:n,empty:i}=t;if(!i||n.parent.type!==this.type||!(n.parentOffset===n.parent.nodeSize-2))return!1;const l=n.after();return l===void 0?!1:s.nodeAt(l)?r.commands.command(({tr:d})=>(d.setSelection(de.near(s.resolve(l))),!0)):r.commands.exitCode()}}},addInputRules(){return[Nl({find:Nk,type:this.type,getAttributes:r=>({language:r[1]})}),Nl({find:jk,type:this.type,getAttributes:r=>({language:r[1]})})]},addProseMirrorPlugins(){return[new Je({key:new yt("codeBlockVSCodeHandler"),props:{handlePaste:(r,e)=>{if(!e.clipboardData||this.editor.isActive(this.type.name))return!1;const t=e.clipboardData.getData("text/plain"),s=e.clipboardData.getData("vscode-editor-data"),n=s?JSON.parse(s):void 0,i=n==null?void 0:n.mode;if(!t||!i)return!1;const{tr:o,schema:l}=r.state,c=l.text(t.replace(/\r\n?/g,`
`));return o.replaceSelectionWith(this.type.create({language:i},c)),o.selection.$from.parent.type!==this.type&&o.setSelection(ce.near(o.doc.resolve(Math.max(0,o.selection.from-2)))),o.setMeta("paste",!0),r.dispatch(o),!0}}})]}}),kk=ut.create({name:"doc",topNode:!0,content:"block+"});function Sk(r={}){return new Je({view(e){return new Ek(e,r)}})}class Ek{constructor(e,t){var s;this.editorView=e,this.cursorPos=null,this.element=null,this.timeout=-1,this.width=(s=t.width)!==null&&s!==void 0?s:1,this.color=t.color===!1?void 0:t.color||"black",this.class=t.class,this.handlers=["dragover","dragend","drop","dragleave"].map(n=>{let i=o=>{this[n](o)};return e.dom.addEventListener(n,i),{name:n,handler:i}})}destroy(){this.handlers.forEach(({name:e,handler:t})=>this.editorView.dom.removeEventListener(e,t))}update(e,t){this.cursorPos!=null&&t.doc!=e.state.doc&&(this.cursorPos>e.state.doc.content.size?this.setCursor(null):this.updateOverlay())}setCursor(e){e!=this.cursorPos&&(this.cursorPos=e,e==null?(this.element.parentNode.removeChild(this.element),this.element=null):this.updateOverlay())}updateOverlay(){let e=this.editorView.state.doc.resolve(this.cursorPos),t=!e.parent.inlineContent,s,n=this.editorView.dom,i=n.getBoundingClientRect(),o=i.width/n.offsetWidth,l=i.height/n.offsetHeight;if(t){let h=e.nodeBefore,f=e.nodeAfter;if(h||f){let p=this.editorView.nodeDOM(this.cursorPos-(h?h.nodeSize:0));if(p){let m=p.getBoundingClientRect(),g=h?m.bottom:m.top;h&&f&&(g=(g+this.editorView.nodeDOM(this.cursorPos).getBoundingClientRect().top)/2);let y=this.width/2*l;s={left:m.left,right:m.right,top:g-y,bottom:g+y}}}}if(!s){let h=this.editorView.coordsAtPos(this.cursorPos),f=this.width/2*o;s={left:h.left-f,right:h.left+f,top:h.top,bottom:h.bottom}}let c=this.editorView.dom.offsetParent;this.element||(this.element=c.appendChild(document.createElement("div")),this.class&&(this.element.className=this.class),this.element.style.cssText="position: absolute; z-index: 50; pointer-events: none;",this.color&&(this.element.style.backgroundColor=this.color)),this.element.classList.toggle("prosemirror-dropcursor-block",t),this.element.classList.toggle("prosemirror-dropcursor-inline",!t);let d,u;if(!c||c==document.body&&getComputedStyle(c).position=="static")d=-pageXOffset,u=-pageYOffset;else{let h=c.getBoundingClientRect(),f=h.width/c.offsetWidth,p=h.height/c.offsetHeight;d=h.left-c.scrollLeft*f,u=h.top-c.scrollTop*p}this.element.style.left=(s.left-d)/o+"px",this.element.style.top=(s.top-u)/l+"px",this.element.style.width=(s.right-s.left)/o+"px",this.element.style.height=(s.bottom-s.top)/l+"px"}scheduleRemoval(e){clearTimeout(this.timeout),this.timeout=setTimeout(()=>this.setCursor(null),e)}dragover(e){if(!this.editorView.editable)return;let t=this.editorView.posAtCoords({left:e.clientX,top:e.clientY}),s=t&&t.inside>=0&&this.editorView.state.doc.nodeAt(t.inside),n=s&&s.type.spec.disableDropCursor,i=typeof n=="function"?n(this.editorView,t,e):n;if(t&&!i){let o=t.pos;if(this.editorView.dragging&&this.editorView.dragging.slice){let l=Lf(this.editorView.state.doc,o,this.editorView.dragging.slice);l!=null&&(o=l)}this.setCursor(o),this.scheduleRemoval(5e3)}}dragend(){this.scheduleRemoval(20)}drop(){this.scheduleRemoval(20)}dragleave(e){this.editorView.dom.contains(e.relatedTarget)||this.setCursor(null)}}const Ak=nt.create({name:"dropCursor",addOptions(){return{color:"currentColor",width:1,class:void 0}},addProseMirrorPlugins(){return[Sk(this.options)]}});class Pe extends de{constructor(e){super(e,e)}map(e,t){let s=e.resolve(t.map(this.head));return Pe.valid(s)?new Pe(s):de.near(s)}content(){return Q.empty}eq(e){return e instanceof Pe&&e.head==this.head}toJSON(){return{type:"gapcursor",pos:this.head}}static fromJSON(e,t){if(typeof t.pos!="number")throw new RangeError("Invalid input for GapCursor.fromJSON");return new Pe(e.resolve(t.pos))}getBookmark(){return new Ec(this.anchor)}static valid(e){let t=e.parent;if(t.isTextblock||!Ck(e)||!Mk(e))return!1;let s=t.type.spec.allowGapCursor;if(s!=null)return s;let n=t.contentMatchAt(e.index()).defaultType;return n&&n.isTextblock}static findGapCursorFrom(e,t,s=!1){e:for(;;){if(!s&&Pe.valid(e))return e;let n=e.pos,i=null;for(let o=e.depth;;o--){let l=e.node(o);if(t>0?e.indexAfter(o)<l.childCount:e.index(o)>0){i=l.child(t>0?e.indexAfter(o):e.index(o)-1);break}else if(o==0)return null;n+=t;let c=e.doc.resolve(n);if(Pe.valid(c))return c}for(;;){let o=t>0?i.firstChild:i.lastChild;if(!o){if(i.isAtom&&!i.isText&&!se.isSelectable(i)){e=e.doc.resolve(n+i.nodeSize*t),s=!1;continue e}break}i=o,n+=t;let l=e.doc.resolve(n);if(Pe.valid(l))return l}return null}}}Pe.prototype.visible=!1;Pe.findFrom=Pe.findGapCursorFrom;de.jsonID("gapcursor",Pe);class Ec{constructor(e){this.pos=e}map(e){return new Ec(e.map(this.pos))}resolve(e){let t=e.resolve(this.pos);return Pe.valid(t)?new Pe(t):de.near(t)}}function Ck(r){for(let e=r.depth;e>=0;e--){let t=r.index(e),s=r.node(e);if(t==0){if(s.type.spec.isolating)return!0;continue}for(let n=s.child(t-1);;n=n.lastChild){if(n.childCount==0&&!n.inlineContent||n.isAtom||n.type.spec.isolating)return!0;if(n.inlineContent)return!1}}return!0}function Mk(r){for(let e=r.depth;e>=0;e--){let t=r.indexAfter(e),s=r.node(e);if(t==s.childCount){if(s.type.spec.isolating)return!0;continue}for(let n=s.child(t);;n=n.firstChild){if(n.childCount==0&&!n.inlineContent||n.isAtom||n.type.spec.isolating)return!0;if(n.inlineContent)return!1}}return!0}function Dk(){return new Je({props:{decorations:Ik,createSelectionBetween(r,e,t){return e.pos==t.pos&&Pe.valid(t)?new Pe(t):null},handleClick:Ok,handleKeyDown:Tk,handleDOMEvents:{beforeinput:Rk}}})}const Tk=kp({ArrowLeft:ai("horiz",-1),ArrowRight:ai("horiz",1),ArrowUp:ai("vert",-1),ArrowDown:ai("vert",1)});function ai(r,e){const t=r=="vert"?e>0?"down":"up":e>0?"right":"left";return function(s,n,i){let o=s.selection,l=e>0?o.$to:o.$from,c=o.empty;if(o instanceof ce){if(!i.endOfTextblock(t)||l.depth==0)return!1;c=!1,l=s.doc.resolve(e>0?l.after():l.before())}let d=Pe.findGapCursorFrom(l,e,c);return d?(n&&n(s.tr.setSelection(new Pe(d))),!0):!1}}function Ok(r,e,t){if(!r||!r.editable)return!1;let s=r.state.doc.resolve(e);if(!Pe.valid(s))return!1;let n=r.posAtCoords({left:t.clientX,top:t.clientY});return n&&n.inside>-1&&se.isSelectable(r.state.doc.nodeAt(n.inside))?!1:(r.dispatch(r.state.tr.setSelection(new Pe(s))),!0)}function Rk(r,e){if(e.inputType!="insertCompositionText"||!(r.state.selection instanceof Pe))return!1;let{$from:t}=r.state.selection,s=t.parent.contentMatchAt(t.index()).findWrapping(r.state.schema.nodes.text);if(!s)return!1;let n=z.empty;for(let o=s.length-1;o>=0;o--)n=z.from(s[o].createAndFill(null,n));let i=r.state.tr.replace(t.pos,t.pos,new Q(n,0,0));return i.setSelection(ce.near(i.doc.resolve(t.pos+1))),r.dispatch(i),!1}function Ik(r){if(!(r.selection instanceof Pe))return null;let e=document.createElement("div");return e.className="ProseMirror-gapcursor",Be.create(r.doc,[Nt.widget(r.selection.head,e,{key:"gapcursor"})])}const Pk=nt.create({name:"gapCursor",addProseMirrorPlugins(){return[Dk()]},extendNodeSchema(r){var e;const t={name:r.name,options:r.options,storage:r.storage};return{allowGapCursor:(e=fe(ee(r,"allowGapCursor",t)))!==null&&e!==void 0?e:null}}}),Lk=ut.create({name:"hardBreak",addOptions(){return{keepMarks:!0,HTMLAttributes:{}}},inline:!0,group:"inline",selectable:!1,linebreakReplacement:!0,parseHTML(){return[{tag:"br"}]},renderHTML({HTMLAttributes:r}){return["br",He(this.options.HTMLAttributes,r)]},renderText(){return`
`},addCommands(){return{setHardBreak:()=>({commands:r,chain:e,state:t,editor:s})=>r.first([()=>r.exitCode(),()=>r.command(()=>{const{selection:n,storedMarks:i}=t;if(n.$from.parent.type.spec.isolating)return!1;const{keepMarks:o}=this.options,{splittableMarks:l}=s.extensionManager,c=i||n.$to.parentOffset&&n.$from.marks();return e().insertContent({type:this.name}).command(({tr:d,dispatch:u})=>{if(u&&c&&o){const h=c.filter(f=>l.includes(f.type.name));d.ensureMarks(h)}return!0}).run()})])}},addKeyboardShortcuts(){return{"Mod-Enter":()=>this.editor.commands.setHardBreak(),"Shift-Enter":()=>this.editor.commands.setHardBreak()}}}),$k=ut.create({name:"heading",addOptions(){return{levels:[1,2,3,4,5,6],HTMLAttributes:{}}},content:"inline*",group:"block",defining:!0,addAttributes(){return{level:{default:1,rendered:!1}}},parseHTML(){return this.options.levels.map(r=>({tag:`h${r}`,attrs:{level:r}}))},renderHTML({node:r,HTMLAttributes:e}){return[`h${this.options.levels.includes(r.attrs.level)?r.attrs.level:this.options.levels[0]}`,He(this.options.HTMLAttributes,e),0]},addCommands(){return{setHeading:r=>({commands:e})=>this.options.levels.includes(r.level)?e.setNode(this.name,r):!1,toggleHeading:r=>({commands:e})=>this.options.levels.includes(r.level)?e.toggleNode(this.name,"paragraph",r):!1}},addKeyboardShortcuts(){return this.options.levels.reduce((r,e)=>({...r,[`Mod-Alt-${e}`]:()=>this.editor.commands.toggleHeading({level:e})}),{})},addInputRules(){return this.options.levels.map(r=>Nl({find:new RegExp(`^(#{${Math.min(...this.options.levels)},${r}})\\s$`),type:this.type,getAttributes:{level:r}}))}});var Qi=200,Ge=function(){};Ge.prototype.append=function(e){return e.length?(e=Ge.from(e),!this.length&&e||e.length<Qi&&this.leafAppend(e)||this.length<Qi&&e.leafPrepend(this)||this.appendInner(e)):this};Ge.prototype.prepend=function(e){return e.length?Ge.from(e).append(this):this};Ge.prototype.appendInner=function(e){return new _k(this,e)};Ge.prototype.slice=function(e,t){return e===void 0&&(e=0),t===void 0&&(t=this.length),e>=t?Ge.empty:this.sliceInner(Math.max(0,e),Math.min(this.length,t))};Ge.prototype.get=function(e){if(!(e<0||e>=this.length))return this.getInner(e)};Ge.prototype.forEach=function(e,t,s){t===void 0&&(t=0),s===void 0&&(s=this.length),t<=s?this.forEachInner(e,t,s,0):this.forEachInvertedInner(e,t,s,0)};Ge.prototype.map=function(e,t,s){t===void 0&&(t=0),s===void 0&&(s=this.length);var n=[];return this.forEach(function(i,o){return n.push(e(i,o))},t,s),n};Ge.from=function(e){return e instanceof Ge?e:e&&e.length?new em(e):Ge.empty};var em=function(r){function e(s){r.call(this),this.values=s}r&&(e.__proto__=r),e.prototype=Object.create(r&&r.prototype),e.prototype.constructor=e;var t={length:{configurable:!0},depth:{configurable:!0}};return e.prototype.flatten=function(){return this.values},e.prototype.sliceInner=function(n,i){return n==0&&i==this.length?this:new e(this.values.slice(n,i))},e.prototype.getInner=function(n){return this.values[n]},e.prototype.forEachInner=function(n,i,o,l){for(var c=i;c<o;c++)if(n(this.values[c],l+c)===!1)return!1},e.prototype.forEachInvertedInner=function(n,i,o,l){for(var c=i-1;c>=o;c--)if(n(this.values[c],l+c)===!1)return!1},e.prototype.leafAppend=function(n){if(this.length+n.length<=Qi)return new e(this.values.concat(n.flatten()))},e.prototype.leafPrepend=function(n){if(this.length+n.length<=Qi)return new e(n.flatten().concat(this.values))},t.length.get=function(){return this.values.length},t.depth.get=function(){return 0},Object.defineProperties(e.prototype,t),e}(Ge);Ge.empty=new em([]);var _k=function(r){function e(t,s){r.call(this),this.left=t,this.right=s,this.length=t.length+s.length,this.depth=Math.max(t.depth,s.depth)+1}return r&&(e.__proto__=r),e.prototype=Object.create(r&&r.prototype),e.prototype.constructor=e,e.prototype.flatten=function(){return this.left.flatten().concat(this.right.flatten())},e.prototype.getInner=function(s){return s<this.left.length?this.left.get(s):this.right.get(s-this.left.length)},e.prototype.forEachInner=function(s,n,i,o){var l=this.left.length;if(n<l&&this.left.forEachInner(s,n,Math.min(i,l),o)===!1||i>l&&this.right.forEachInner(s,Math.max(n-l,0),Math.min(this.length,i)-l,o+l)===!1)return!1},e.prototype.forEachInvertedInner=function(s,n,i,o){var l=this.left.length;if(n>l&&this.right.forEachInvertedInner(s,n-l,Math.max(i,l)-l,o+l)===!1||i<l&&this.left.forEachInvertedInner(s,Math.min(n,l),i,o)===!1)return!1},e.prototype.sliceInner=function(s,n){if(s==0&&n==this.length)return this;var i=this.left.length;return n<=i?this.left.slice(s,n):s>=i?this.right.slice(s-i,n-i):this.left.slice(s,i).append(this.right.slice(0,n-i))},e.prototype.leafAppend=function(s){var n=this.right.leafAppend(s);if(n)return new e(this.left,n)},e.prototype.leafPrepend=function(s){var n=this.left.leafPrepend(s);if(n)return new e(n,this.right)},e.prototype.appendInner=function(s){return this.left.depth>=Math.max(this.right.depth,s.depth)+1?new e(this.left,new e(this.right,s)):new e(this,s)},e}(Ge);const Fk=500;class Ot{constructor(e,t){this.items=e,this.eventCount=t}popEvent(e,t){if(this.eventCount==0)return null;let s=this.items.length;for(;;s--)if(this.items.get(s-1).selection){--s;break}let n,i;t&&(n=this.remapping(s,this.items.length),i=n.maps.length);let o=e.tr,l,c,d=[],u=[];return this.items.forEach((h,f)=>{if(!h.step){n||(n=this.remapping(s,f+1),i=n.maps.length),i--,u.push(h);return}if(n){u.push(new $t(h.map));let p=h.step.map(n.slice(i)),m;p&&o.maybeStep(p).doc&&(m=o.mapping.maps[o.mapping.maps.length-1],d.push(new $t(m,void 0,void 0,d.length+u.length))),i--,m&&n.appendMap(m,i)}else o.maybeStep(h.step);if(h.selection)return l=n?h.selection.map(n.slice(i)):h.selection,c=new Ot(this.items.slice(0,s).append(u.reverse().concat(d)),this.eventCount-1),!1},this.items.length,0),{remaining:c,transform:o,selection:l}}addTransform(e,t,s,n){let i=[],o=this.eventCount,l=this.items,c=!n&&l.length?l.get(l.length-1):null;for(let u=0;u<e.steps.length;u++){let h=e.steps[u].invert(e.docs[u]),f=new $t(e.mapping.maps[u],h,t),p;(p=c&&c.merge(f))&&(f=p,u?i.pop():l=l.slice(0,l.length-1)),i.push(f),t&&(o++,t=void 0),n||(c=f)}let d=o-s.depth;return d>Uk&&(l=Bk(l,d),o-=d),new Ot(l.append(i),o)}remapping(e,t){let s=new Cn;return this.items.forEach((n,i)=>{let o=n.mirrorOffset!=null&&i-n.mirrorOffset>=e?s.maps.length-n.mirrorOffset:void 0;s.appendMap(n.map,o)},e,t),s}addMaps(e){return this.eventCount==0?this:new Ot(this.items.append(e.map(t=>new $t(t))),this.eventCount)}rebased(e,t){if(!this.eventCount)return this;let s=[],n=Math.max(0,this.items.length-t),i=e.mapping,o=e.steps.length,l=this.eventCount;this.items.forEach(f=>{f.selection&&l--},n);let c=t;this.items.forEach(f=>{let p=i.getMirror(--c);if(p==null)return;o=Math.min(o,p);let m=i.maps[p];if(f.step){let g=e.steps[p].invert(e.docs[p]),y=f.selection&&f.selection.map(i.slice(c+1,p));y&&l++,s.push(new $t(m,g,y))}else s.push(new $t(m))},n);let d=[];for(let f=t;f<o;f++)d.push(new $t(i.maps[f]));let u=this.items.slice(0,n).append(d).append(s),h=new Ot(u,l);return h.emptyItemCount()>Fk&&(h=h.compress(this.items.length-s.length)),h}emptyItemCount(){let e=0;return this.items.forEach(t=>{t.step||e++}),e}compress(e=this.items.length){let t=this.remapping(0,e),s=t.maps.length,n=[],i=0;return this.items.forEach((o,l)=>{if(l>=e)n.push(o),o.selection&&i++;else if(o.step){let c=o.step.map(t.slice(s)),d=c&&c.getMap();if(s--,d&&t.appendMap(d,s),c){let u=o.selection&&o.selection.map(t.slice(s));u&&i++;let h=new $t(d.invert(),c,u),f,p=n.length-1;(f=n.length&&n[p].merge(h))?n[p]=f:n.push(h)}}else o.map&&s--},this.items.length,0),new Ot(Ge.from(n.reverse()),i)}}Ot.empty=new Ot(Ge.empty,0);function Bk(r,e){let t;return r.forEach((s,n)=>{if(s.selection&&e--==0)return t=n,!1}),r.slice(t)}class $t{constructor(e,t,s,n){this.map=e,this.step=t,this.selection=s,this.mirrorOffset=n}merge(e){if(this.step&&e.step&&!e.selection){let t=e.step.merge(this.step);if(t)return new $t(t.getMap().invert(),t,this.selection)}}}class pr{constructor(e,t,s,n,i){this.done=e,this.undone=t,this.prevRanges=s,this.prevTime=n,this.prevComposition=i}}const Uk=20;function zk(r,e,t,s){let n=t.getMeta(ls),i;if(n)return n.historyState;t.getMeta(Vk)&&(r=new pr(r.done,r.undone,null,0,-1));let o=t.getMeta("appendedTransaction");if(t.steps.length==0)return r;if(o&&o.getMeta(ls))return o.getMeta(ls).redo?new pr(r.done.addTransform(t,void 0,s,ji(e)),r.undone,wu(t.mapping.maps),r.prevTime,r.prevComposition):new pr(r.done,r.undone.addTransform(t,void 0,s,ji(e)),null,r.prevTime,r.prevComposition);if(t.getMeta("addToHistory")!==!1&&!(o&&o.getMeta("addToHistory")===!1)){let l=t.getMeta("composition"),c=r.prevTime==0||!o&&r.prevComposition!=l&&(r.prevTime<(t.time||0)-s.newGroupDelay||!Wk(t,r.prevRanges)),d=o?Da(r.prevRanges,t.mapping):wu(t.mapping.maps);return new pr(r.done.addTransform(t,c?e.selection.getBookmark():void 0,s,ji(e)),Ot.empty,d,t.time,l??r.prevComposition)}else return(i=t.getMeta("rebased"))?new pr(r.done.rebased(t,i),r.undone.rebased(t,i),Da(r.prevRanges,t.mapping),r.prevTime,r.prevComposition):new pr(r.done.addMaps(t.mapping.maps),r.undone.addMaps(t.mapping.maps),Da(r.prevRanges,t.mapping),r.prevTime,r.prevComposition)}function Wk(r,e){if(!e)return!1;if(!r.docChanged)return!0;let t=!1;return r.mapping.maps[0].forEach((s,n)=>{for(let i=0;i<e.length;i+=2)s<=e[i+1]&&n>=e[i]&&(t=!0)}),t}function wu(r){let e=[];for(let t=r.length-1;t>=0&&e.length==0;t--)r[t].forEach((s,n,i,o)=>e.push(i,o));return e}function Da(r,e){if(!r)return null;let t=[];for(let s=0;s<r.length;s+=2){let n=e.map(r[s],1),i=e.map(r[s+1],-1);n<=i&&t.push(n,i)}return t}function Hk(r,e,t){let s=ji(e),n=ls.get(e).spec.config,i=(t?r.undone:r.done).popEvent(e,s);if(!i)return null;let o=i.selection.resolve(i.transform.doc),l=(t?r.done:r.undone).addTransform(i.transform,e.selection.getBookmark(),n,s),c=new pr(t?l:i.remaining,t?i.remaining:l,null,0,-1);return i.transform.setSelection(o).setMeta(ls,{redo:t,historyState:c})}let Ta=!1,vu=null;function ji(r){let e=r.plugins;if(vu!=e){Ta=!1,vu=e;for(let t=0;t<e.length;t++)if(e[t].spec.historyPreserveItems){Ta=!0;break}}return Ta}const ls=new yt("history"),Vk=new yt("closeHistory");function qk(r={}){return r={depth:r.depth||100,newGroupDelay:r.newGroupDelay||500},new Je({key:ls,state:{init(){return new pr(Ot.empty,Ot.empty,null,0,-1)},apply(e,t,s){return zk(t,s,e,r)}},config:r,props:{handleDOMEvents:{beforeinput(e,t){let s=t.inputType,n=s=="historyUndo"?rm:s=="historyRedo"?sm:null;return n?(t.preventDefault(),n(e.state,e.dispatch)):!1}}}})}function tm(r,e){return(t,s)=>{let n=ls.getState(t);if(!n||(r?n.undone:n.done).eventCount==0)return!1;if(s){let i=Hk(n,t,r);i&&s(e?i.scrollIntoView():i)}return!0}}const rm=tm(!1,!0),sm=tm(!0,!0),Kk=nt.create({name:"history",addOptions(){return{depth:100,newGroupDelay:500}},addCommands(){return{undo:()=>({state:r,dispatch:e})=>rm(r,e),redo:()=>({state:r,dispatch:e})=>sm(r,e)}},addProseMirrorPlugins(){return[qk(this.options)]},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Shift-Mod-z":()=>this.editor.commands.redo(),"Mod-y":()=>this.editor.commands.redo(),"Mod-я":()=>this.editor.commands.undo(),"Shift-Mod-я":()=>this.editor.commands.redo()}}}),Gk=ut.create({name:"horizontalRule",addOptions(){return{HTMLAttributes:{}}},group:"block",parseHTML(){return[{tag:"hr"}]},renderHTML({HTMLAttributes:r}){return["hr",He(this.options.HTMLAttributes,r)]},addCommands(){return{setHorizontalRule:()=>({chain:r,state:e})=>{if(!$j(e,e.schema.nodes[this.name]))return!1;const{selection:t}=e,{$from:s,$to:n}=t,i=r();return s.parentOffset===0?i.insertContentAt({from:Math.max(s.pos-1,0),to:n.pos},{type:this.name}):sj(t)?i.insertContentAt(n.pos,{type:this.name}):i.insertContent({type:this.name}),i.command(({tr:o,dispatch:l})=>{var c;if(l){const{$to:d}=o.selection,u=d.end();if(d.nodeAfter)d.nodeAfter.isTextblock?o.setSelection(ce.create(o.doc,d.pos+1)):d.nodeAfter.isBlock?o.setSelection(se.create(o.doc,d.pos)):o.setSelection(ce.create(o.doc,d.pos));else{const h=(c=d.parent.type.contentMatch.defaultType)===null||c===void 0?void 0:c.create();h&&(o.insert(u,h),o.setSelection(ce.create(o.doc,u+1)))}o.scrollIntoView()}return!0}).run()}}},addInputRules(){return[Pj({find:/^(?:---|—-|___\s|\*\*\*\s)$/,type:this.type})]}}),Yk=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))$/,Jk=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))/g,Xk=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))$/,Qk=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))/g,Zk=Kt.create({name:"italic",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"em"},{tag:"i",getAttrs:r=>r.style.fontStyle!=="normal"&&null},{style:"font-style=normal",clearMark:r=>r.type.name===this.name},{style:"font-style=italic"}]},renderHTML({HTMLAttributes:r}){return["em",He(this.options.HTMLAttributes,r),0]},addCommands(){return{setItalic:()=>({commands:r})=>r.setMark(this.name),toggleItalic:()=>({commands:r})=>r.toggleMark(this.name),unsetItalic:()=>({commands:r})=>r.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-i":()=>this.editor.commands.toggleItalic(),"Mod-I":()=>this.editor.commands.toggleItalic()}},addInputRules(){return[Ks({find:Yk,type:this.type}),Ks({find:Xk,type:this.type})]},addPasteRules(){return[ys({find:Jk,type:this.type}),ys({find:Qk,type:this.type})]}}),kl=ut.create({name:"listItem",addOptions(){return{HTMLAttributes:{},bulletListTypeName:"bulletList",orderedListTypeName:"orderedList"}},content:"paragraph block*",defining:!0,parseHTML(){return[{tag:"li"}]},renderHTML({HTMLAttributes:r}){return["li",He(this.options.HTMLAttributes,r),0]},addKeyboardShortcuts(){return{Enter:()=>this.editor.commands.splitListItem(this.name),Tab:()=>this.editor.commands.sinkListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)}}}),e2="listItem",Nu="textStyle",ju=/^(\d+)\.\s$/,nm=ut.create({name:"orderedList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},addAttributes(){return{start:{default:1,parseHTML:r=>r.hasAttribute("start")?parseInt(r.getAttribute("start")||"",10):1},type:{default:null,parseHTML:r=>r.getAttribute("type")}}},parseHTML(){return[{tag:"ol"}]},renderHTML({HTMLAttributes:r}){const{start:e,...t}=r;return e===1?["ol",He(this.options.HTMLAttributes,t),0]:["ol",He(this.options.HTMLAttributes,r),0]},addCommands(){return{toggleOrderedList:()=>({commands:r,chain:e})=>this.options.keepAttributes?e().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(e2,this.editor.getAttributes(Nu)).run():r.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-7":()=>this.editor.commands.toggleOrderedList()}},addInputRules(){let r=Pn({find:ju,type:this.type,getAttributes:e=>({start:+e[1]}),joinPredicate:(e,t)=>t.childCount+t.attrs.start===+e[1]});return(this.options.keepMarks||this.options.keepAttributes)&&(r=Pn({find:ju,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:e=>({start:+e[1],...this.editor.getAttributes(Nu)}),joinPredicate:(e,t)=>t.childCount+t.attrs.start===+e[1],editor:this.editor})),[r]}}),t2=ut.create({name:"paragraph",priority:1e3,addOptions(){return{HTMLAttributes:{}}},group:"block",content:"inline*",parseHTML(){return[{tag:"p"}]},renderHTML({HTMLAttributes:r}){return["p",He(this.options.HTMLAttributes,r),0]},addCommands(){return{setParagraph:()=>({commands:r})=>r.setNode(this.name)}},addKeyboardShortcuts(){return{"Mod-Alt-0":()=>this.editor.commands.setParagraph()}}}),r2=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))$/,s2=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))/g,n2=Kt.create({name:"strike",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"s"},{tag:"del"},{tag:"strike"},{style:"text-decoration",consuming:!1,getAttrs:r=>r.includes("line-through")?{}:!1}]},renderHTML({HTMLAttributes:r}){return["s",He(this.options.HTMLAttributes,r),0]},addCommands(){return{setStrike:()=>({commands:r})=>r.setMark(this.name),toggleStrike:()=>({commands:r})=>r.toggleMark(this.name),unsetStrike:()=>({commands:r})=>r.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-s":()=>this.editor.commands.toggleStrike()}},addInputRules(){return[Ks({find:r2,type:this.type})]},addPasteRules(){return[ys({find:s2,type:this.type})]}}),i2=ut.create({name:"text",group:"inline"}),o2=nt.create({name:"starterKit",addExtensions(){const r=[];return this.options.bold!==!1&&r.push(xk.configure(this.options.bold)),this.options.blockquote!==!1&&r.push(hk.configure(this.options.blockquote)),this.options.bulletList!==!1&&r.push(Qp.configure(this.options.bulletList)),this.options.code!==!1&&r.push(vk.configure(this.options.code)),this.options.codeBlock!==!1&&r.push(Zp.configure(this.options.codeBlock)),this.options.document!==!1&&r.push(kk.configure(this.options.document)),this.options.dropcursor!==!1&&r.push(Ak.configure(this.options.dropcursor)),this.options.gapcursor!==!1&&r.push(Pk.configure(this.options.gapcursor)),this.options.hardBreak!==!1&&r.push(Lk.configure(this.options.hardBreak)),this.options.heading!==!1&&r.push($k.configure(this.options.heading)),this.options.history!==!1&&r.push(Kk.configure(this.options.history)),this.options.horizontalRule!==!1&&r.push(Gk.configure(this.options.horizontalRule)),this.options.italic!==!1&&r.push(Zk.configure(this.options.italic)),this.options.listItem!==!1&&r.push(kl.configure(this.options.listItem)),this.options.orderedList!==!1&&r.push(nm.configure(this.options.orderedList)),this.options.paragraph!==!1&&r.push(t2.configure(this.options.paragraph)),this.options.strike!==!1&&r.push(n2.configure(this.options.strike)),this.options.text!==!1&&r.push(i2.configure(this.options.text)),r}}),a2="aaa1rp3bb0ott3vie4c1le2ogado5udhabi7c0ademy5centure6ountant0s9o1tor4d0s1ult4e0g1ro2tna4f0l1rica5g0akhan5ency5i0g1rbus3force5tel5kdn3l0ibaba4pay4lfinanz6state5y2sace3tom5m0azon4ericanexpress7family11x2fam3ica3sterdam8nalytics7droid5quan4z2o0l2partments8p0le4q0uarelle8r0ab1mco4chi3my2pa2t0e3s0da2ia2sociates9t0hleta5torney7u0ction5di0ble3o3spost5thor3o0s4w0s2x0a2z0ure5ba0by2idu3namex4d1k2r0celona5laycard4s5efoot5gains6seball5ketball8uhaus5yern5b0c1t1va3cg1n2d1e0ats2uty4er2rlin4st0buy5t2f1g1h0arti5i0ble3d1ke2ng0o3o1z2j1lack0friday9ockbuster8g1omberg7ue3m0s1w2n0pparibas9o0ats3ehringer8fa2m1nd2o0k0ing5sch2tik2on4t1utique6x2r0adesco6idgestone9oadway5ker3ther5ussels7s1t1uild0ers6siness6y1zz3v1w1y1z0h3ca0b1fe2l0l1vinklein9m0era3p2non3petown5ital0one8r0avan4ds2e0er0s4s2sa1e1h1ino4t0ering5holic7ba1n1re3c1d1enter4o1rn3f0a1d2g1h0anel2nel4rity4se2t2eap3intai5ristmas6ome4urch5i0priani6rcle4sco3tadel4i0c2y3k1l0aims4eaning6ick2nic1que6othing5ud3ub0med6m1n1o0ach3des3ffee4llege4ogne5m0mbank4unity6pany2re3uter5sec4ndos3struction8ulting7tact3ractors9oking4l1p2rsica5untry4pon0s4rses6pa2r0edit0card4union9icket5own3s1uise0s6u0isinella9v1w1x1y0mru3ou3z2dad1nce3ta1e1ing3sun4y2clk3ds2e0al0er2s3gree4livery5l1oitte5ta3mocrat6ntal2ist5si0gn4v2hl2iamonds6et2gital5rect0ory7scount3ver5h2y2j1k1m1np2o0cs1tor4g1mains5t1wnload7rive4tv2ubai3nlop4pont4rban5vag2r2z2earth3t2c0o2deka3u0cation8e1g1mail3erck5nergy4gineer0ing9terprises10pson4quipment8r0icsson6ni3s0q1tate5t1u0rovision8s2vents5xchange6pert3osed4ress5traspace10fage2il1rwinds6th3mily4n0s2rm0ers5shion4t3edex3edback6rrari3ero6i0delity5o2lm2nal1nce1ial7re0stone6mdale6sh0ing5t0ness6j1k1lickr3ghts4r2orist4wers5y2m1o0o0d1tball6rd1ex2sale4um3undation8x2r0ee1senius7l1ogans4ntier7tr2ujitsu5n0d2rniture7tbol5yi3ga0l0lery3o1up4me0s3p1rden4y2b0iz3d0n2e0a1nt0ing5orge5f1g0ee3h1i0ft0s3ves2ing5l0ass3e1obal2o4m0ail3bh2o1x2n1odaddy5ld0point6f2o0dyear5g0le4p1t1v2p1q1r0ainger5phics5tis4een3ipe3ocery4up4s1t1u0cci3ge2ide2tars5ru3w1y2hair2mburg5ngout5us3bo2dfc0bank7ealth0care8lp1sinki6re1mes5iphop4samitsu7tachi5v2k0t2m1n1ockey4ldings5iday5medepot5goods5s0ense7nda3rse3spital5t0ing5t0els3mail5use3w2r1sbc3t1u0ghes5yatt3undai7ibm2cbc2e1u2d1e0ee3fm2kano4l1m0amat4db2mo0bilien9n0c1dustries8finiti5o2g1k1stitute6urance4e4t0ernational10uit4vestments10o1piranga7q1r0ish4s0maili5t0anbul7t0au2v3jaguar4va3cb2e0ep2tzt3welry6io2ll2m0p2nj2o0bs1urg4t1y2p0morgan6rs3uegos4niper7kaufen5ddi3e0rryhotels6properties14fh2g1h1i0a1ds2m1ndle4tchen5wi3m1n1oeln3matsu5sher5p0mg2n2r0d1ed3uokgroup8w1y0oto4z2la0caixa5mborghini8er3nd0rover6xess5salle5t0ino3robe5w0yer5b1c1ds2ease3clerc5frak4gal2o2xus4gbt3i0dl2fe0insurance9style7ghting6ke2lly3mited4o2ncoln4k2ve1ing5k1lc1p2oan0s3cker3us3l1ndon4tte1o3ve3pl0financial11r1s1t0d0a3u0ndbeck6xe1ury5v1y2ma0drid4if1son4keup4n0agement7go3p1rket0ing3s4riott5shalls7ttel5ba2c0kinsey7d1e0d0ia3et2lbourne7me1orial6n0u2rckmsd7g1h1iami3crosoft7l1ni1t2t0subishi9k1l0b1s2m0a2n1o0bi0le4da2e1i1m1nash3ey2ster5rmon3tgage6scow4to0rcycles9v0ie4p1q1r1s0d2t0n1r2u0seum3ic4v1w1x1y1z2na0b1goya4me2vy3ba2c1e0c1t0bank4flix4work5ustar5w0s2xt0direct7us4f0l2g0o2hk2i0co2ke1on3nja3ssan1y5l1o0kia3rton4w0ruz3tv4p1r0a1w2tt2u1yc2z2obi1server7ffice5kinawa6layan0group9lo3m0ega4ne1g1l0ine5oo2pen3racle3nge4g0anic5igins6saka4tsuka4t2vh3pa0ge2nasonic7ris2s1tners4s1y3y2ccw3e0t2f0izer5g1h0armacy6d1ilips5one2to0graphy6s4ysio5ics1tet2ures6d1n0g1k2oneer5zza4k1l0ace2y0station9umbing5s3m1n0c2ohl2ker3litie5rn2st3r0america6xi3ess3ime3o0d0uctions8f1gressive8mo2perties3y5tection8u0dential9s1t1ub2w0c2y2qa1pon3uebec3st5racing4dio4e0ad1lestate6tor2y4cipes5d0stone5umbrella9hab3ise0n3t2liance6n0t0als5pair3ort3ublican8st0aurant8view0s5xroth6ich0ardli6oh3l1o1p2o0cks3deo3gers4om3s0vp3u0gby3hr2n2w0e2yukyu6sa0arland6fe0ty4kura4le1on3msclub4ung5ndvik0coromant12ofi4p1rl2s1ve2xo3b0i1s2c0b1haeffler7midt4olarships8ol3ule3warz5ience5ot3d1e0arch3t2cure1ity6ek2lect4ner3rvices6ven3w1x0y3fr2g1h0angrila6rp3ell3ia1ksha5oes2p0ping5uji3w3i0lk2na1gles5te3j1k0i0n2y0pe4l0ing4m0art3ile4n0cf3o0ccer3ial4ftbank4ware6hu2lar2utions7ng1y2y2pa0ce3ort2t3r0l2s1t0ada2ples4r1tebank4farm7c0group6ockholm6rage3e3ream4udio2y3yle4u0cks3pplies3y2ort5rf1gery5zuki5v1watch4iss4x1y0dney4stems6z2tab1ipei4lk2obao4rget4tamotors6r2too4x0i3c0i2d0k2eam2ch0nology8l1masek5nnis4va3f1g1h0d1eater2re6iaa2ckets5enda4ps2res2ol4j0maxx4x2k0maxx5l1m0all4n1o0day3kyo3ols3p1ray3shiba5tal3urs3wn2yota3s3r0ade1ing4ining5vel0ers0insurance16ust3v2t1ube2i1nes3shu4v0s2w1z2ua1bank3s2g1k1nicom3versity8o2ol2ps2s1y1z2va0cations7na1guard7c1e0gas3ntures6risign5mögensberater2ung14sicherung10t2g1i0ajes4deo3g1king4llas4n1p1rgin4sa1ion4va1o3laanderen9n1odka3lvo3te1ing3o2yage5u2wales2mart4ter4ng0gou5tch0es6eather0channel12bcam3er2site5d0ding5ibo2r3f1hoswho6ien2ki2lliamhill9n0dows4e1ners6me2olterskluwer11odside6rk0s2ld3w2s1tc1f3xbox3erox4ihuan4n2xx2yz3yachts4hoo3maxun5ndex5e1odobashi7ga2kohama6u0tube6t1un3za0ppos4ra3ero3ip2m1one3uerich6w2",l2="ελ1υ2бг1ел3дети4ею2католик6ом3мкд2он1сква6онлайн5рг3рус2ф2сайт3рб3укр3қаз3հայ3ישראל5קום3ابوظبي5رامكو5لاردن4بحرين5جزائر5سعودية6عليان5مغرب5مارات5یران5بارت2زار4يتك3ھارت5تونس4سودان3رية5شبكة4عراق2ب2مان4فلسطين6قطر3كاثوليك6وم3مصر2ليسيا5وريتانيا7قع4همراه5پاکستان7ڀارت4कॉम3नेट3भारत0म्3ोत5संगठन5বাংলা5ভারত2ৰত4ਭਾਰਤ4ભારત4ଭାରତ4இந்தியா6லங்கை6சிங்கப்பூர்11భారత్5ಭಾರತ4ഭാരതം5ලංකා4คอม3ไทย3ລາວ3გე2みんな3アマゾン4クラウド4グーグル4コム2ストア3セール3ファッション6ポイント4世界2中信1国1國1文网3亚马逊3企业2佛山2信息2健康2八卦2公司1益2台湾1灣2商城1店1标2嘉里0大酒店5在线2大拿2天主教3娱乐2家電2广东2微博2慈善2我爱你3手机2招聘2政务1府2新加坡2闻2时尚2書籍2机构2淡马锡3游戏2澳門2点看2移动2组织机构4网址1店1站1络2联通2谷歌2购物2通販2集团2電訊盈科4飞利浦3食品2餐厅2香格里拉3港2닷넷1컴2삼성2한국2",Gs=(r,e)=>{for(const t in e)r[t]=e[t];return r},Sl="numeric",El="ascii",Al="alpha",yn="asciinumeric",un="alphanumeric",Cl="domain",im="emoji",c2="scheme",d2="slashscheme",Oa="whitespace";function u2(r,e){return r in e||(e[r]=[]),e[r]}function rs(r,e,t){e[Sl]&&(e[yn]=!0,e[un]=!0),e[El]&&(e[yn]=!0,e[Al]=!0),e[yn]&&(e[un]=!0),e[Al]&&(e[un]=!0),e[un]&&(e[Cl]=!0),e[im]&&(e[Cl]=!0);for(const s in e){const n=u2(s,t);n.indexOf(r)<0&&n.push(r)}}function h2(r,e){const t={};for(const s in e)e[s].indexOf(r)>=0&&(t[s]=!0);return t}function mt(r=null){this.j={},this.jr=[],this.jd=null,this.t=r}mt.groups={};mt.prototype={accepts(){return!!this.t},go(r){const e=this,t=e.j[r];if(t)return t;for(let s=0;s<e.jr.length;s++){const n=e.jr[s][0],i=e.jr[s][1];if(i&&n.test(r))return i}return e.jd},has(r,e=!1){return e?r in this.j:!!this.go(r)},ta(r,e,t,s){for(let n=0;n<r.length;n++)this.tt(r[n],e,t,s)},tr(r,e,t,s){s=s||mt.groups;let n;return e&&e.j?n=e:(n=new mt(e),t&&s&&rs(e,t,s)),this.jr.push([r,n]),n},ts(r,e,t,s){let n=this;const i=r.length;if(!i)return n;for(let o=0;o<i-1;o++)n=n.tt(r[o]);return n.tt(r[i-1],e,t,s)},tt(r,e,t,s){s=s||mt.groups;const n=this;if(e&&e.j)return n.j[r]=e,e;const i=e;let o,l=n.go(r);if(l?(o=new mt,Gs(o.j,l.j),o.jr.push.apply(o.jr,l.jr),o.jd=l.jd,o.t=l.t):o=new mt,i){if(s)if(o.t&&typeof o.t=="string"){const c=Gs(h2(o.t,s),t);rs(i,c,s)}else t&&rs(i,t,s);o.t=i}return n.j[r]=o,o}};const he=(r,e,t,s,n)=>r.ta(e,t,s,n),Ie=(r,e,t,s,n)=>r.tr(e,t,s,n),ku=(r,e,t,s,n)=>r.ts(e,t,s,n),V=(r,e,t,s,n)=>r.tt(e,t,s,n),er="WORD",Ml="UWORD",om="ASCIINUMERICAL",am="ALPHANUMERICAL",Ln="LOCALHOST",Dl="TLD",Tl="UTLD",ki="SCHEME",Is="SLASH_SCHEME",Ac="NUM",Ol="WS",Cc="NL",bn="OPENBRACE",wn="CLOSEBRACE",Zi="OPENBRACKET",eo="CLOSEBRACKET",to="OPENPAREN",ro="CLOSEPAREN",so="OPENANGLEBRACKET",no="CLOSEANGLEBRACKET",io="FULLWIDTHLEFTPAREN",oo="FULLWIDTHRIGHTPAREN",ao="LEFTCORNERBRACKET",lo="RIGHTCORNERBRACKET",co="LEFTWHITECORNERBRACKET",uo="RIGHTWHITECORNERBRACKET",ho="FULLWIDTHLESSTHAN",fo="FULLWIDTHGREATERTHAN",po="AMPERSAND",mo="APOSTROPHE",go="ASTERISK",mr="AT",xo="BACKSLASH",yo="BACKTICK",bo="CARET",yr="COLON",Mc="COMMA",wo="DOLLAR",_t="DOT",vo="EQUALS",Dc="EXCLAMATION",At="HYPHEN",vn="PERCENT",No="PIPE",jo="PLUS",ko="POUND",Nn="QUERY",Tc="QUOTE",lm="FULLWIDTHMIDDLEDOT",Oc="SEMI",Ft="SLASH",jn="TILDE",So="UNDERSCORE",cm="EMOJI",Eo="SYM";var dm=Object.freeze({__proto__:null,ALPHANUMERICAL:am,AMPERSAND:po,APOSTROPHE:mo,ASCIINUMERICAL:om,ASTERISK:go,AT:mr,BACKSLASH:xo,BACKTICK:yo,CARET:bo,CLOSEANGLEBRACKET:no,CLOSEBRACE:wn,CLOSEBRACKET:eo,CLOSEPAREN:ro,COLON:yr,COMMA:Mc,DOLLAR:wo,DOT:_t,EMOJI:cm,EQUALS:vo,EXCLAMATION:Dc,FULLWIDTHGREATERTHAN:fo,FULLWIDTHLEFTPAREN:io,FULLWIDTHLESSTHAN:ho,FULLWIDTHMIDDLEDOT:lm,FULLWIDTHRIGHTPAREN:oo,HYPHEN:At,LEFTCORNERBRACKET:ao,LEFTWHITECORNERBRACKET:co,LOCALHOST:Ln,NL:Cc,NUM:Ac,OPENANGLEBRACKET:so,OPENBRACE:bn,OPENBRACKET:Zi,OPENPAREN:to,PERCENT:vn,PIPE:No,PLUS:jo,POUND:ko,QUERY:Nn,QUOTE:Tc,RIGHTCORNERBRACKET:lo,RIGHTWHITECORNERBRACKET:uo,SCHEME:ki,SEMI:Oc,SLASH:Ft,SLASH_SCHEME:Is,SYM:Eo,TILDE:jn,TLD:Dl,UNDERSCORE:So,UTLD:Tl,UWORD:Ml,WORD:er,WS:Ol});const Qt=/[a-z]/,an=new RegExp("\\p{L}","u"),Ra=new RegExp("\\p{Emoji}","u"),Zt=/\d/,Ia=/\s/,Su="\r",Pa=`
`,f2="️",p2="‍",La="￼";let li=null,ci=null;function m2(r=[]){const e={};mt.groups=e;const t=new mt;li==null&&(li=Eu(a2)),ci==null&&(ci=Eu(l2)),V(t,"'",mo),V(t,"{",bn),V(t,"}",wn),V(t,"[",Zi),V(t,"]",eo),V(t,"(",to),V(t,")",ro),V(t,"<",so),V(t,">",no),V(t,"（",io),V(t,"）",oo),V(t,"「",ao),V(t,"」",lo),V(t,"『",co),V(t,"』",uo),V(t,"＜",ho),V(t,"＞",fo),V(t,"&",po),V(t,"*",go),V(t,"@",mr),V(t,"`",yo),V(t,"^",bo),V(t,":",yr),V(t,",",Mc),V(t,"$",wo),V(t,".",_t),V(t,"=",vo),V(t,"!",Dc),V(t,"-",At),V(t,"%",vn),V(t,"|",No),V(t,"+",jo),V(t,"#",ko),V(t,"?",Nn),V(t,'"',Tc),V(t,"/",Ft),V(t,";",Oc),V(t,"~",jn),V(t,"_",So),V(t,"\\",xo),V(t,"・",lm);const s=Ie(t,Zt,Ac,{[Sl]:!0});Ie(s,Zt,s);const n=Ie(s,Qt,om,{[yn]:!0}),i=Ie(s,an,am,{[un]:!0}),o=Ie(t,Qt,er,{[El]:!0});Ie(o,Zt,n),Ie(o,Qt,o),Ie(n,Zt,n),Ie(n,Qt,n);const l=Ie(t,an,Ml,{[Al]:!0});Ie(l,Qt),Ie(l,Zt,i),Ie(l,an,l),Ie(i,Zt,i),Ie(i,Qt),Ie(i,an,i);const c=V(t,Pa,Cc,{[Oa]:!0}),d=V(t,Su,Ol,{[Oa]:!0}),u=Ie(t,Ia,Ol,{[Oa]:!0});V(t,La,u),V(d,Pa,c),V(d,La,u),Ie(d,Ia,u),V(u,Su),V(u,Pa),Ie(u,Ia,u),V(u,La,u);const h=Ie(t,Ra,cm,{[im]:!0});V(h,"#"),Ie(h,Ra,h),V(h,f2,h);const f=V(h,p2);V(f,"#"),Ie(f,Ra,h);const p=[[Qt,o],[Zt,n]],m=[[Qt,null],[an,l],[Zt,i]];for(let g=0;g<li.length;g++)dr(t,li[g],Dl,er,p);for(let g=0;g<ci.length;g++)dr(t,ci[g],Tl,Ml,m);rs(Dl,{tld:!0,ascii:!0},e),rs(Tl,{utld:!0,alpha:!0},e),dr(t,"file",ki,er,p),dr(t,"mailto",ki,er,p),dr(t,"http",Is,er,p),dr(t,"https",Is,er,p),dr(t,"ftp",Is,er,p),dr(t,"ftps",Is,er,p),rs(ki,{scheme:!0,ascii:!0},e),rs(Is,{slashscheme:!0,ascii:!0},e),r=r.sort((g,y)=>g[0]>y[0]?1:-1);for(let g=0;g<r.length;g++){const y=r[g][0],N=r[g][1]?{[c2]:!0}:{[d2]:!0};y.indexOf("-")>=0?N[Cl]=!0:Qt.test(y)?Zt.test(y)?N[yn]=!0:N[El]=!0:N[Sl]=!0,ku(t,y,y,N)}return ku(t,"localhost",Ln,{ascii:!0}),t.jd=new mt(Eo),{start:t,tokens:Gs({groups:e},dm)}}function um(r,e){const t=g2(e.replace(/[A-Z]/g,l=>l.toLowerCase())),s=t.length,n=[];let i=0,o=0;for(;o<s;){let l=r,c=null,d=0,u=null,h=-1,f=-1;for(;o<s&&(c=l.go(t[o]));)l=c,l.accepts()?(h=0,f=0,u=l):h>=0&&(h+=t[o].length,f++),d+=t[o].length,i+=t[o].length,o++;i-=h,o-=f,d-=h,n.push({t:u.t,v:e.slice(i-d,i),s:i-d,e:i})}return n}function g2(r){const e=[],t=r.length;let s=0;for(;s<t;){let n=r.charCodeAt(s),i,o=n<55296||n>56319||s+1===t||(i=r.charCodeAt(s+1))<56320||i>57343?r[s]:r.slice(s,s+2);e.push(o),s+=o.length}return e}function dr(r,e,t,s,n){let i;const o=e.length;for(let l=0;l<o-1;l++){const c=e[l];r.j[c]?i=r.j[c]:(i=new mt(s),i.jr=n.slice(),r.j[c]=i),r=i}return i=new mt(t),i.jr=n.slice(),r.j[e[o-1]]=i,i}function Eu(r){const e=[],t=[];let s=0,n="0123456789";for(;s<r.length;){let i=0;for(;n.indexOf(r[s+i])>=0;)i++;if(i>0){e.push(t.join(""));for(let o=parseInt(r.substring(s,s+i),10);o>0;o--)t.pop();s+=i}else t.push(r[s]),s++}return e}const $n={defaultProtocol:"http",events:null,format:Au,formatHref:Au,nl2br:!1,tagName:"a",target:null,rel:null,validate:!0,truncate:1/0,className:null,attributes:null,ignoreTags:[],render:null};function Rc(r,e=null){let t=Gs({},$n);r&&(t=Gs(t,r instanceof Rc?r.o:r));const s=t.ignoreTags,n=[];for(let i=0;i<s.length;i++)n.push(s[i].toUpperCase());this.o=t,e&&(this.defaultRender=e),this.ignoreTags=n}Rc.prototype={o:$n,ignoreTags:[],defaultRender(r){return r},check(r){return this.get("validate",r.toString(),r)},get(r,e,t){const s=e!=null;let n=this.o[r];return n&&(typeof n=="object"?(n=t.t in n?n[t.t]:$n[r],typeof n=="function"&&s&&(n=n(e,t))):typeof n=="function"&&s&&(n=n(e,t.t,t)),n)},getObj(r,e,t){let s=this.o[r];return typeof s=="function"&&e!=null&&(s=s(e,t.t,t)),s},render(r){const e=r.render(this);return(this.get("render",null,r)||this.defaultRender)(e,r.t,r)}};function Au(r){return r}function hm(r,e){this.t="token",this.v=r,this.tk=e}hm.prototype={isLink:!1,toString(){return this.v},toHref(r){return this.toString()},toFormattedString(r){const e=this.toString(),t=r.get("truncate",e,this),s=r.get("format",e,this);return t&&s.length>t?s.substring(0,t)+"…":s},toFormattedHref(r){return r.get("formatHref",this.toHref(r.get("defaultProtocol")),this)},startIndex(){return this.tk[0].s},endIndex(){return this.tk[this.tk.length-1].e},toObject(r=$n.defaultProtocol){return{type:this.t,value:this.toString(),isLink:this.isLink,href:this.toHref(r),start:this.startIndex(),end:this.endIndex()}},toFormattedObject(r){return{type:this.t,value:this.toFormattedString(r),isLink:this.isLink,href:this.toFormattedHref(r),start:this.startIndex(),end:this.endIndex()}},validate(r){return r.get("validate",this.toString(),this)},render(r){const e=this,t=this.toHref(r.get("defaultProtocol")),s=r.get("formatHref",t,this),n=r.get("tagName",t,e),i=this.toFormattedString(r),o={},l=r.get("className",t,e),c=r.get("target",t,e),d=r.get("rel",t,e),u=r.getObj("attributes",t,e),h=r.getObj("events",t,e);return o.href=s,l&&(o.class=l),c&&(o.target=c),d&&(o.rel=d),u&&Gs(o,u),{tagName:n,attributes:o,content:i,eventListeners:h}}};function ea(r,e){class t extends hm{constructor(n,i){super(n,i),this.t=r}}for(const s in e)t.prototype[s]=e[s];return t.t=r,t}const Cu=ea("email",{isLink:!0,toHref(){return"mailto:"+this.toString()}}),Mu=ea("text"),x2=ea("nl"),di=ea("url",{isLink:!0,toHref(r=$n.defaultProtocol){return this.hasProtocol()?this.v:`${r}://${this.v}`},hasProtocol(){const r=this.tk;return r.length>=2&&r[0].t!==Ln&&r[1].t===yr}}),Et=r=>new mt(r);function y2({groups:r}){const e=r.domain.concat([po,go,mr,xo,yo,bo,wo,vo,At,Ac,vn,No,jo,ko,Ft,Eo,jn,So]),t=[mo,yr,Mc,_t,Dc,vn,Nn,Tc,Oc,so,no,bn,wn,eo,Zi,to,ro,io,oo,ao,lo,co,uo,ho,fo],s=[po,mo,go,xo,yo,bo,wo,vo,At,bn,wn,vn,No,jo,ko,Nn,Ft,Eo,jn,So],n=Et(),i=V(n,jn);he(i,s,i),he(i,r.domain,i);const o=Et(),l=Et(),c=Et();he(n,r.domain,o),he(n,r.scheme,l),he(n,r.slashscheme,c),he(o,s,i),he(o,r.domain,o);const d=V(o,mr);V(i,mr,d),V(l,mr,d),V(c,mr,d);const u=V(i,_t);he(u,s,i),he(u,r.domain,i);const h=Et();he(d,r.domain,h),he(h,r.domain,h);const f=V(h,_t);he(f,r.domain,h);const p=Et(Cu);he(f,r.tld,p),he(f,r.utld,p),V(d,Ln,p);const m=V(h,At);V(m,At,m),he(m,r.domain,h),he(p,r.domain,h),V(p,_t,f),V(p,At,m);const g=V(p,yr);he(g,r.numeric,Cu);const y=V(o,At),x=V(o,_t);V(y,At,y),he(y,r.domain,o),he(x,s,i),he(x,r.domain,o);const N=Et(di);he(x,r.tld,N),he(x,r.utld,N),he(N,r.domain,o),he(N,s,i),V(N,_t,x),V(N,At,y),V(N,mr,d);const A=V(N,yr),S=Et(di);he(A,r.numeric,S);const k=Et(di),R=Et();he(k,e,k),he(k,t,R),he(R,e,k),he(R,t,R),V(N,Ft,k),V(S,Ft,k);const j=V(l,yr),w=V(c,yr),v=V(w,Ft),D=V(v,Ft);he(l,r.domain,o),V(l,_t,x),V(l,At,y),he(c,r.domain,o),V(c,_t,x),V(c,At,y),he(j,r.domain,k),V(j,Ft,k),V(j,Nn,k),he(D,r.domain,k),he(D,e,k),V(D,Ft,k);const C=[[bn,wn],[Zi,eo],[to,ro],[so,no],[io,oo],[ao,lo],[co,uo],[ho,fo]];for(let P=0;P<C.length;P++){const[O,W]=C[P],H=V(k,O);V(R,O,H),V(H,W,k);const I=Et(di);he(H,e,I);const E=Et();he(H,t),he(I,e,I),he(I,t,E),he(E,e,I),he(E,t,E),V(I,W,k),V(E,W,k)}return V(n,Ln,N),V(n,Cc,x2),{start:n,tokens:dm}}function b2(r,e,t){let s=t.length,n=0,i=[],o=[];for(;n<s;){let l=r,c=null,d=null,u=0,h=null,f=-1;for(;n<s&&!(c=l.go(t[n].t));)o.push(t[n++]);for(;n<s&&(d=c||l.go(t[n].t));)c=null,l=d,l.accepts()?(f=0,h=l):f>=0&&f++,n++,u++;if(f<0)n-=u,n<s&&(o.push(t[n]),n++);else{o.length>0&&(i.push($a(Mu,e,o)),o=[]),n-=f,u-=f;const p=h.t,m=t.slice(n-u,n);i.push($a(p,e,m))}}return o.length>0&&i.push($a(Mu,e,o)),i}function $a(r,e,t){const s=t[0].s,n=t[t.length-1].e,i=e.slice(s,n);return new r(i,t)}const w2=typeof console<"u"&&console&&console.warn||(()=>{}),v2="until manual call of linkify.init(). Register all schemes and plugins before invoking linkify the first time.",De={scanner:null,parser:null,tokenQueue:[],pluginQueue:[],customSchemes:[],initialized:!1};function N2(){return mt.groups={},De.scanner=null,De.parser=null,De.tokenQueue=[],De.pluginQueue=[],De.customSchemes=[],De.initialized=!1,De}function Du(r,e=!1){if(De.initialized&&w2(`linkifyjs: already initialized - will not register custom scheme "${r}" ${v2}`),!/^[0-9a-z]+(-[0-9a-z]+)*$/.test(r))throw new Error(`linkifyjs: incorrect scheme format.
1. Must only contain digits, lowercase ASCII letters or "-"
2. Cannot start or end with "-"
3. "-" cannot repeat`);De.customSchemes.push([r,e])}function j2(){De.scanner=m2(De.customSchemes);for(let r=0;r<De.tokenQueue.length;r++)De.tokenQueue[r][1]({scanner:De.scanner});De.parser=y2(De.scanner.tokens);for(let r=0;r<De.pluginQueue.length;r++)De.pluginQueue[r][1]({scanner:De.scanner,parser:De.parser});return De.initialized=!0,De}function Ic(r){return De.initialized||j2(),b2(De.parser.start,r,um(De.scanner.start,r))}Ic.scan=um;function fm(r,e=null,t=null){if(e&&typeof e=="object"){if(t)throw Error(`linkifyjs: Invalid link type ${e}; must be a string`);t=e,e=null}const s=new Rc(t),n=Ic(r),i=[];for(let o=0;o<n.length;o++){const l=n[o];l.isLink&&(!e||l.t===e)&&s.check(l)&&i.push(l.toFormattedObject(s))}return i}function k2(r){return r.length===1?r[0].isLink:r.length===3&&r[1].isLink?["()","[]"].includes(r[0].value+r[2].value):!1}function S2(r){return new Je({key:new yt("autolink"),appendTransaction:(e,t,s)=>{const n=e.some(d=>d.docChanged)&&!t.doc.eq(s.doc),i=e.some(d=>d.getMeta("preventAutolink"));if(!n||i)return;const{tr:o}=s,l=KN(t.doc,[...e]);if(tj(l).forEach(({newRange:d})=>{const u=YN(s.doc,d,p=>p.isTextblock);let h,f;if(u.length>1?(h=u[0],f=s.doc.textBetween(h.pos,h.pos+h.node.nodeSize,void 0," ")):u.length&&s.doc.textBetween(d.from,d.to," "," ").endsWith(" ")&&(h=u[0],f=s.doc.textBetween(h.pos,d.to,void 0," ")),h&&f){const p=f.split(" ").filter(x=>x!=="");if(p.length<=0)return!1;const m=p[p.length-1],g=h.pos+f.lastIndexOf(m);if(!m)return!1;const y=Ic(m).map(x=>x.toObject(r.defaultProtocol));if(!k2(y))return!1;y.filter(x=>x.isLink).map(x=>({...x,from:g+x.start+1,to:g+x.end+1})).filter(x=>s.schema.marks.code?!s.doc.rangeHasMark(x.from,x.to,s.schema.marks.code):!0).filter(x=>r.validate(x.value)).filter(x=>r.shouldAutoLink(x.value)).forEach(x=>{Nc(x.from,x.to,s.doc).some(N=>N.mark.type===r.type)||o.addMark(x.from,x.to,r.type.create({href:x.href}))})}}),!!o.steps.length)return o}})}function E2(r){return new Je({key:new yt("handleClickLink"),props:{handleClick:(e,t,s)=>{var n,i;if(s.button!==0||!e.editable)return!1;let o=s.target;const l=[];for(;o.nodeName!=="DIV";)l.push(o),o=o.parentNode;if(!l.find(f=>f.nodeName==="A"))return!1;const c=Gp(e.state,r.type.name),d=s.target,u=(n=d==null?void 0:d.href)!==null&&n!==void 0?n:c.href,h=(i=d==null?void 0:d.target)!==null&&i!==void 0?i:c.target;return d&&u?(window.open(u,h),!0):!1}}})}function A2(r){return new Je({key:new yt("handlePasteLink"),props:{handlePaste:(e,t,s)=>{const{state:n}=e,{selection:i}=n,{empty:o}=i;if(o)return!1;let l="";s.content.forEach(d=>{l+=d.textContent});const c=fm(l,{defaultProtocol:r.defaultProtocol}).find(d=>d.isLink&&d.value===l);return!l||!c?!1:r.editor.commands.setMark(r.type,{href:c.href})}}})}const C2=/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g;function zr(r,e){const t=["http","https","ftp","ftps","mailto","tel","callto","sms","cid","xmpp"];return e&&e.forEach(s=>{const n=typeof s=="string"?s:s.scheme;n&&t.push(n)}),!r||r.replace(C2,"").match(new RegExp(`^(?:(?:${t.join("|")}):|[^a-z]|[a-z0-9+.-]+(?:[^a-z+.-:]|$))`,"i"))}const M2=Kt.create({name:"link",priority:1e3,keepOnSplit:!1,exitable:!0,onCreate(){this.options.validate&&!this.options.shouldAutoLink&&(this.options.shouldAutoLink=this.options.validate,console.warn("The `validate` option is deprecated. Rename to the `shouldAutoLink` option instead.")),this.options.protocols.forEach(r=>{if(typeof r=="string"){Du(r);return}Du(r.scheme,r.optionalSlashes)})},onDestroy(){N2()},inclusive(){return this.options.autolink},addOptions(){return{openOnClick:!0,linkOnPaste:!0,autolink:!0,protocols:[],defaultProtocol:"http",HTMLAttributes:{target:"_blank",rel:"noopener noreferrer nofollow",class:null},isAllowedUri:(r,e)=>!!zr(r,e.protocols),validate:r=>!!r,shouldAutoLink:r=>!!r}},addAttributes(){return{href:{default:null,parseHTML(r){return r.getAttribute("href")}},target:{default:this.options.HTMLAttributes.target},rel:{default:this.options.HTMLAttributes.rel},class:{default:this.options.HTMLAttributes.class}}},parseHTML(){return[{tag:"a[href]",getAttrs:r=>{const e=r.getAttribute("href");return!e||!this.options.isAllowedUri(e,{defaultValidate:t=>!!zr(t,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?!1:null}}]},renderHTML({HTMLAttributes:r}){return this.options.isAllowedUri(r.href,{defaultValidate:e=>!!zr(e,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?["a",He(this.options.HTMLAttributes,r),0]:["a",He(this.options.HTMLAttributes,{...r,href:""}),0]},addCommands(){return{setLink:r=>({chain:e})=>{const{href:t}=r;return this.options.isAllowedUri(t,{defaultValidate:s=>!!zr(s,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?e().setMark(this.name,r).setMeta("preventAutolink",!0).run():!1},toggleLink:r=>({chain:e})=>{const{href:t}=r;return this.options.isAllowedUri(t,{defaultValidate:s=>!!zr(s,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?e().toggleMark(this.name,r,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run():!1},unsetLink:()=>({chain:r})=>r().unsetMark(this.name,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()}},addPasteRules(){return[ys({find:r=>{const e=[];if(r){const{protocols:t,defaultProtocol:s}=this.options,n=fm(r).filter(i=>i.isLink&&this.options.isAllowedUri(i.value,{defaultValidate:o=>!!zr(o,t),protocols:t,defaultProtocol:s}));n.length&&n.forEach(i=>e.push({text:i.value,data:{href:i.href},index:i.start}))}return e},type:this.type,getAttributes:r=>{var e;return{href:(e=r.data)===null||e===void 0?void 0:e.href}}})]},addProseMirrorPlugins(){const r=[],{protocols:e,defaultProtocol:t}=this.options;return this.options.autolink&&r.push(S2({type:this.type,defaultProtocol:this.options.defaultProtocol,validate:s=>this.options.isAllowedUri(s,{defaultValidate:n=>!!zr(n,e),protocols:e,defaultProtocol:t}),shouldAutoLink:this.options.shouldAutoLink})),this.options.openOnClick===!0&&r.push(E2({type:this.type})),this.options.linkOnPaste&&r.push(A2({editor:this.editor,defaultProtocol:this.options.defaultProtocol,type:this.type})),r}});function D2(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function pm(r){return r instanceof Map?r.clear=r.delete=r.set=function(){throw new Error("map is read-only")}:r instanceof Set&&(r.add=r.clear=r.delete=function(){throw new Error("set is read-only")}),Object.freeze(r),Object.getOwnPropertyNames(r).forEach(e=>{const t=r[e],s=typeof t;(s==="object"||s==="function")&&!Object.isFrozen(t)&&pm(t)}),r}let Tu=class{constructor(e){e.data===void 0&&(e.data={}),this.data=e.data,this.isMatchIgnored=!1}ignoreMatch(){this.isMatchIgnored=!0}};function mm(r){return r.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;")}function jr(r,...e){const t=Object.create(null);for(const s in r)t[s]=r[s];return e.forEach(function(s){for(const n in s)t[n]=s[n]}),t}const T2="</span>",Ou=r=>!!r.scope,O2=(r,{prefix:e})=>{if(r.startsWith("language:"))return r.replace("language:","language-");if(r.includes(".")){const t=r.split(".");return[`${e}${t.shift()}`,...t.map((s,n)=>`${s}${"_".repeat(n+1)}`)].join(" ")}return`${e}${r}`};let R2=class{constructor(e,t){this.buffer="",this.classPrefix=t.classPrefix,e.walk(this)}addText(e){this.buffer+=mm(e)}openNode(e){if(!Ou(e))return;const t=O2(e.scope,{prefix:this.classPrefix});this.span(t)}closeNode(e){Ou(e)&&(this.buffer+=T2)}value(){return this.buffer}span(e){this.buffer+=`<span class="${e}">`}};const Ru=(r={})=>{const e={children:[]};return Object.assign(e,r),e};let I2=class gm{constructor(){this.rootNode=Ru(),this.stack=[this.rootNode]}get top(){return this.stack[this.stack.length-1]}get root(){return this.rootNode}add(e){this.top.children.push(e)}openNode(e){const t=Ru({scope:e});this.add(t),this.stack.push(t)}closeNode(){if(this.stack.length>1)return this.stack.pop()}closeAllNodes(){for(;this.closeNode(););}toJSON(){return JSON.stringify(this.rootNode,null,4)}walk(e){return this.constructor._walk(e,this.rootNode)}static _walk(e,t){return typeof t=="string"?e.addText(t):t.children&&(e.openNode(t),t.children.forEach(s=>this._walk(e,s)),e.closeNode(t)),e}static _collapse(e){typeof e!="string"&&e.children&&(e.children.every(t=>typeof t=="string")?e.children=[e.children.join("")]:e.children.forEach(t=>{gm._collapse(t)}))}},P2=class extends I2{constructor(e){super(),this.options=e}addText(e){e!==""&&this.add(e)}startScope(e){this.openNode(e)}endScope(){this.closeNode()}__addSublanguage(e,t){const s=e.root;t&&(s.scope=`language:${t}`),this.add(s)}toHTML(){return new R2(this,this.options).value()}finalize(){return this.closeAllNodes(),!0}};function _n(r){return r?typeof r=="string"?r:r.source:null}function xm(r){return ks("(?=",r,")")}function L2(r){return ks("(?:",r,")*")}function $2(r){return ks("(?:",r,")?")}function ks(...r){return r.map(t=>_n(t)).join("")}function _2(r){const e=r[r.length-1];return typeof e=="object"&&e.constructor===Object?(r.splice(r.length-1,1),e):{}}function Pc(...r){return"("+(_2(r).capture?"":"?:")+r.map(s=>_n(s)).join("|")+")"}function ym(r){return new RegExp(r.toString()+"|").exec("").length-1}function F2(r,e){const t=r&&r.exec(e);return t&&t.index===0}const B2=/\[(?:[^\\\]]|\\.)*\]|\(\??|\\([1-9][0-9]*)|\\./;function Lc(r,{joinWith:e}){let t=0;return r.map(s=>{t+=1;const n=t;let i=_n(s),o="";for(;i.length>0;){const l=B2.exec(i);if(!l){o+=i;break}o+=i.substring(0,l.index),i=i.substring(l.index+l[0].length),l[0][0]==="\\"&&l[1]?o+="\\"+String(Number(l[1])+n):(o+=l[0],l[0]==="("&&t++)}return o}).map(s=>`(${s})`).join(e)}const U2=/\b\B/,bm="[a-zA-Z]\\w*",$c="[a-zA-Z_]\\w*",wm="\\b\\d+(\\.\\d+)?",vm="(-?)(\\b0[xX][a-fA-F0-9]+|(\\b\\d+(\\.\\d*)?|\\.\\d+)([eE][-+]?\\d+)?)",Nm="\\b(0b[01]+)",z2="!|!=|!==|%|%=|&|&&|&=|\\*|\\*=|\\+|\\+=|,|-|-=|/=|/|:|;|<<|<<=|<=|<|===|==|=|>>>=|>>=|>=|>>>|>>|>|\\?|\\[|\\{|\\(|\\^|\\^=|\\||\\|=|\\|\\||~",W2=(r={})=>{const e=/^#![ ]*\//;return r.binary&&(r.begin=ks(e,/.*\b/,r.binary,/\b.*/)),jr({scope:"meta",begin:e,end:/$/,relevance:0,"on:begin":(t,s)=>{t.index!==0&&s.ignoreMatch()}},r)},Fn={begin:"\\\\[\\s\\S]",relevance:0},H2={scope:"string",begin:"'",end:"'",illegal:"\\n",contains:[Fn]},V2={scope:"string",begin:'"',end:'"',illegal:"\\n",contains:[Fn]},q2={begin:/\b(a|an|the|are|I'm|isn't|don't|doesn't|won't|but|just|should|pretty|simply|enough|gonna|going|wtf|so|such|will|you|your|they|like|more)\b/},ta=function(r,e,t={}){const s=jr({scope:"comment",begin:r,end:e,contains:[]},t);s.contains.push({scope:"doctag",begin:"[ ]*(?=(TODO|FIXME|NOTE|BUG|OPTIMIZE|HACK|XXX):)",end:/(TODO|FIXME|NOTE|BUG|OPTIMIZE|HACK|XXX):/,excludeBegin:!0,relevance:0});const n=Pc("I","a","is","so","us","to","at","if","in","it","on",/[A-Za-z]+['](d|ve|re|ll|t|s|n)/,/[A-Za-z]+[-][a-z]+/,/[A-Za-z][a-z]{2,}/);return s.contains.push({begin:ks(/[ ]+/,"(",n,/[.]?[:]?([.][ ]|[ ])/,"){3}")}),s},K2=ta("//","$"),G2=ta("/\\*","\\*/"),Y2=ta("#","$"),J2={scope:"number",begin:wm,relevance:0},X2={scope:"number",begin:vm,relevance:0},Q2={scope:"number",begin:Nm,relevance:0},Z2={scope:"regexp",begin:/\/(?=[^/\n]*\/)/,end:/\/[gimuy]*/,contains:[Fn,{begin:/\[/,end:/\]/,relevance:0,contains:[Fn]}]},eS={scope:"title",begin:bm,relevance:0},tS={scope:"title",begin:$c,relevance:0},rS={begin:"\\.\\s*"+$c,relevance:0},sS=function(r){return Object.assign(r,{"on:begin":(e,t)=>{t.data._beginMatch=e[1]},"on:end":(e,t)=>{t.data._beginMatch!==e[1]&&t.ignoreMatch()}})};var ui=Object.freeze({__proto__:null,APOS_STRING_MODE:H2,BACKSLASH_ESCAPE:Fn,BINARY_NUMBER_MODE:Q2,BINARY_NUMBER_RE:Nm,COMMENT:ta,C_BLOCK_COMMENT_MODE:G2,C_LINE_COMMENT_MODE:K2,C_NUMBER_MODE:X2,C_NUMBER_RE:vm,END_SAME_AS_BEGIN:sS,HASH_COMMENT_MODE:Y2,IDENT_RE:bm,MATCH_NOTHING_RE:U2,METHOD_GUARD:rS,NUMBER_MODE:J2,NUMBER_RE:wm,PHRASAL_WORDS_MODE:q2,QUOTE_STRING_MODE:V2,REGEXP_MODE:Z2,RE_STARTERS_RE:z2,SHEBANG:W2,TITLE_MODE:eS,UNDERSCORE_IDENT_RE:$c,UNDERSCORE_TITLE_MODE:tS});function nS(r,e){r.input[r.index-1]==="."&&e.ignoreMatch()}function iS(r,e){r.className!==void 0&&(r.scope=r.className,delete r.className)}function oS(r,e){e&&r.beginKeywords&&(r.begin="\\b("+r.beginKeywords.split(" ").join("|")+")(?!\\.)(?=\\b|\\s)",r.__beforeBegin=nS,r.keywords=r.keywords||r.beginKeywords,delete r.beginKeywords,r.relevance===void 0&&(r.relevance=0))}function aS(r,e){Array.isArray(r.illegal)&&(r.illegal=Pc(...r.illegal))}function lS(r,e){if(r.match){if(r.begin||r.end)throw new Error("begin & end are not supported with match");r.begin=r.match,delete r.match}}function cS(r,e){r.relevance===void 0&&(r.relevance=1)}const dS=(r,e)=>{if(!r.beforeMatch)return;if(r.starts)throw new Error("beforeMatch cannot be used with starts");const t=Object.assign({},r);Object.keys(r).forEach(s=>{delete r[s]}),r.keywords=t.keywords,r.begin=ks(t.beforeMatch,xm(t.begin)),r.starts={relevance:0,contains:[Object.assign(t,{endsParent:!0})]},r.relevance=0,delete t.beforeMatch},uS=["of","and","for","in","not","or","if","then","parent","list","value"],hS="keyword";function jm(r,e,t=hS){const s=Object.create(null);return typeof r=="string"?n(t,r.split(" ")):Array.isArray(r)?n(t,r):Object.keys(r).forEach(function(i){Object.assign(s,jm(r[i],e,i))}),s;function n(i,o){e&&(o=o.map(l=>l.toLowerCase())),o.forEach(function(l){const c=l.split("|");s[c[0]]=[i,fS(c[0],c[1])]})}}function fS(r,e){return e?Number(e):pS(r)?0:1}function pS(r){return uS.includes(r.toLowerCase())}const Iu={},cs=r=>{console.error(r)},Pu=(r,...e)=>{console.log(`WARN: ${r}`,...e)},Ds=(r,e)=>{Iu[`${r}/${e}`]||(console.log(`Deprecated as of ${r}. ${e}`),Iu[`${r}/${e}`]=!0)},Ao=new Error;function km(r,e,{key:t}){let s=0;const n=r[t],i={},o={};for(let l=1;l<=e.length;l++)o[l+s]=n[l],i[l+s]=!0,s+=ym(e[l-1]);r[t]=o,r[t]._emit=i,r[t]._multi=!0}function mS(r){if(Array.isArray(r.begin)){if(r.skip||r.excludeBegin||r.returnBegin)throw cs("skip, excludeBegin, returnBegin not compatible with beginScope: {}"),Ao;if(typeof r.beginScope!="object"||r.beginScope===null)throw cs("beginScope must be object"),Ao;km(r,r.begin,{key:"beginScope"}),r.begin=Lc(r.begin,{joinWith:""})}}function gS(r){if(Array.isArray(r.end)){if(r.skip||r.excludeEnd||r.returnEnd)throw cs("skip, excludeEnd, returnEnd not compatible with endScope: {}"),Ao;if(typeof r.endScope!="object"||r.endScope===null)throw cs("endScope must be object"),Ao;km(r,r.end,{key:"endScope"}),r.end=Lc(r.end,{joinWith:""})}}function xS(r){r.scope&&typeof r.scope=="object"&&r.scope!==null&&(r.beginScope=r.scope,delete r.scope)}function yS(r){xS(r),typeof r.beginScope=="string"&&(r.beginScope={_wrap:r.beginScope}),typeof r.endScope=="string"&&(r.endScope={_wrap:r.endScope}),mS(r),gS(r)}function bS(r){function e(o,l){return new RegExp(_n(o),"m"+(r.case_insensitive?"i":"")+(r.unicodeRegex?"u":"")+(l?"g":""))}class t{constructor(){this.matchIndexes={},this.regexes=[],this.matchAt=1,this.position=0}addRule(l,c){c.position=this.position++,this.matchIndexes[this.matchAt]=c,this.regexes.push([c,l]),this.matchAt+=ym(l)+1}compile(){this.regexes.length===0&&(this.exec=()=>null);const l=this.regexes.map(c=>c[1]);this.matcherRe=e(Lc(l,{joinWith:"|"}),!0),this.lastIndex=0}exec(l){this.matcherRe.lastIndex=this.lastIndex;const c=this.matcherRe.exec(l);if(!c)return null;const d=c.findIndex((h,f)=>f>0&&h!==void 0),u=this.matchIndexes[d];return c.splice(0,d),Object.assign(c,u)}}class s{constructor(){this.rules=[],this.multiRegexes=[],this.count=0,this.lastIndex=0,this.regexIndex=0}getMatcher(l){if(this.multiRegexes[l])return this.multiRegexes[l];const c=new t;return this.rules.slice(l).forEach(([d,u])=>c.addRule(d,u)),c.compile(),this.multiRegexes[l]=c,c}resumingScanAtSamePosition(){return this.regexIndex!==0}considerAll(){this.regexIndex=0}addRule(l,c){this.rules.push([l,c]),c.type==="begin"&&this.count++}exec(l){const c=this.getMatcher(this.regexIndex);c.lastIndex=this.lastIndex;let d=c.exec(l);if(this.resumingScanAtSamePosition()&&!(d&&d.index===this.lastIndex)){const u=this.getMatcher(0);u.lastIndex=this.lastIndex+1,d=u.exec(l)}return d&&(this.regexIndex+=d.position+1,this.regexIndex===this.count&&this.considerAll()),d}}function n(o){const l=new s;return o.contains.forEach(c=>l.addRule(c.begin,{rule:c,type:"begin"})),o.terminatorEnd&&l.addRule(o.terminatorEnd,{type:"end"}),o.illegal&&l.addRule(o.illegal,{type:"illegal"}),l}function i(o,l){const c=o;if(o.isCompiled)return c;[iS,lS,yS,dS].forEach(u=>u(o,l)),r.compilerExtensions.forEach(u=>u(o,l)),o.__beforeBegin=null,[oS,aS,cS].forEach(u=>u(o,l)),o.isCompiled=!0;let d=null;return typeof o.keywords=="object"&&o.keywords.$pattern&&(o.keywords=Object.assign({},o.keywords),d=o.keywords.$pattern,delete o.keywords.$pattern),d=d||/\w+/,o.keywords&&(o.keywords=jm(o.keywords,r.case_insensitive)),c.keywordPatternRe=e(d,!0),l&&(o.begin||(o.begin=/\B|\b/),c.beginRe=e(c.begin),!o.end&&!o.endsWithParent&&(o.end=/\B|\b/),o.end&&(c.endRe=e(c.end)),c.terminatorEnd=_n(c.end)||"",o.endsWithParent&&l.terminatorEnd&&(c.terminatorEnd+=(o.end?"|":"")+l.terminatorEnd)),o.illegal&&(c.illegalRe=e(o.illegal)),o.contains||(o.contains=[]),o.contains=[].concat(...o.contains.map(function(u){return wS(u==="self"?o:u)})),o.contains.forEach(function(u){i(u,c)}),o.starts&&i(o.starts,l),c.matcher=n(c),c}if(r.compilerExtensions||(r.compilerExtensions=[]),r.contains&&r.contains.includes("self"))throw new Error("ERR: contains `self` is not supported at the top-level of a language.  See documentation.");return r.classNameAliases=jr(r.classNameAliases||{}),i(r)}function Sm(r){return r?r.endsWithParent||Sm(r.starts):!1}function wS(r){return r.variants&&!r.cachedVariants&&(r.cachedVariants=r.variants.map(function(e){return jr(r,{variants:null},e)})),r.cachedVariants?r.cachedVariants:Sm(r)?jr(r,{starts:r.starts?jr(r.starts):null}):Object.isFrozen(r)?jr(r):r}var vS="11.10.0";let NS=class extends Error{constructor(e,t){super(e),this.name="HTMLInjectionError",this.html=t}};const _a=mm,Lu=jr,$u=Symbol("nomatch"),jS=7,Em=function(r){const e=Object.create(null),t=Object.create(null),s=[];let n=!0;const i="Could not find the language '{}', did you forget to load/include a language module?",o={disableAutodetect:!0,name:"Plain text",contains:[]};let l={ignoreUnescapedHTML:!1,throwUnescapedHTML:!1,noHighlightRe:/^(no-?highlight)$/i,languageDetectRe:/\blang(?:uage)?-([\w-]+)\b/i,classPrefix:"hljs-",cssSelector:"pre code",languages:null,__emitter:P2};function c(E){return l.noHighlightRe.test(E)}function d(E){let F=E.className+" ";F+=E.parentNode?E.parentNode.className:"";const U=l.languageDetectRe.exec(F);if(U){const L=v(U[1]);return L||(Pu(i.replace("{}",U[1])),Pu("Falling back to no-highlight mode for this block.",E)),L?U[1]:"no-highlight"}return F.split(/\s+/).find(L=>c(L)||v(L))}function u(E,F,U){let L="",_="";typeof F=="object"?(L=E,U=F.ignoreIllegals,_=F.language):(Ds("10.7.0","highlight(lang, code, ...args) has been deprecated."),Ds("10.7.0",`Please use highlight(code, options) instead.
https://github.com/highlightjs/highlight.js/issues/2277`),_=E,L=F),U===void 0&&(U=!0);const Y={code:L,language:_};H("before:highlight",Y);const Z=Y.result?Y.result:h(Y.language,Y.code,U);return Z.code=Y.code,H("after:highlight",Z),Z}function h(E,F,U,L){const _=Object.create(null);function Y(M,B){return M.keywords[B]}function Z(){if(!ie.keywords){oe.addText(we);return}let M=0;ie.keywordPatternRe.lastIndex=0;let B=ie.keywordPatternRe.exec(we),q="";for(;B;){q+=we.substring(M,B.index);const re=ft.case_insensitive?B[0].toLowerCase():B[0],ye=Y(ie,re);if(ye){const[je,Yt]=ye;if(oe.addText(q),q="",_[re]=(_[re]||0)+1,_[re]<=jS&&(at+=Yt),je.startsWith("_"))q+=B[0];else{const Hm=ft.classNameAliases[je]||je;be(B[0],Hm)}}else q+=B[0];M=ie.keywordPatternRe.lastIndex,B=ie.keywordPatternRe.exec(we)}q+=we.substring(M),oe.addText(q)}function J(){if(we==="")return;let M=null;if(typeof ie.subLanguage=="string"){if(!e[ie.subLanguage]){oe.addText(we);return}M=h(ie.subLanguage,we,!0,Re[ie.subLanguage]),Re[ie.subLanguage]=M._top}else M=p(we,ie.subLanguage.length?ie.subLanguage:null);ie.relevance>0&&(at+=M.relevance),oe.__addSublanguage(M._emitter,M.language)}function te(){ie.subLanguage!=null?J():Z(),we=""}function be(M,B){M!==""&&(oe.startScope(B),oe.addText(M),oe.endScope())}function ht(M,B){let q=1;const re=B.length-1;for(;q<=re;){if(!M._emit[q]){q++;continue}const ye=ft.classNameAliases[M[q]]||M[q],je=B[q];ye?be(je,ye):(we=je,Z(),we=""),q++}}function Fr(M,B){return M.scope&&typeof M.scope=="string"&&oe.openNode(ft.classNameAliases[M.scope]||M.scope),M.beginScope&&(M.beginScope._wrap?(be(we,ft.classNameAliases[M.beginScope._wrap]||M.beginScope._wrap),we=""):M.beginScope._multi&&(ht(M.beginScope,B),we="")),ie=Object.create(M,{parent:{value:ie}}),ie}function Br(M,B,q){let re=F2(M.endRe,q);if(re){if(M["on:end"]){const ye=new Tu(M);M["on:end"](B,ye),ye.isMatchIgnored&&(re=!1)}if(re){for(;M.endsParent&&M.parent;)M=M.parent;return M}}if(M.endsWithParent)return Br(M.parent,B,q)}function en(M){return ie.matcher.regexIndex===0?(we+=M[0],1):(T=!0,0)}function Es(M){const B=M[0],q=M.rule,re=new Tu(q),ye=[q.__beforeBegin,q["on:begin"]];for(const je of ye)if(je&&(je(M,re),re.isMatchIgnored))return en(B);return q.skip?we+=B:(q.excludeBegin&&(we+=B),te(),!q.returnBegin&&!q.excludeBegin&&(we=B)),Fr(q,M),q.returnBegin?0:B.length}function tn(M){const B=M[0],q=F.substring(M.index),re=Br(ie,M,q);if(!re)return $u;const ye=ie;ie.endScope&&ie.endScope._wrap?(te(),be(B,ie.endScope._wrap)):ie.endScope&&ie.endScope._multi?(te(),ht(ie.endScope,M)):ye.skip?we+=B:(ye.returnEnd||ye.excludeEnd||(we+=B),te(),ye.excludeEnd&&(we=B));do ie.scope&&oe.closeNode(),!ie.skip&&!ie.subLanguage&&(at+=ie.relevance),ie=ie.parent;while(ie!==re.parent);return re.starts&&Fr(re.starts,M),ye.returnEnd?0:B.length}function lr(){const M=[];for(let B=ie;B!==ft;B=B.parent)B.scope&&M.unshift(B.scope);M.forEach(B=>oe.openNode(B))}let Gt={};function ot(M,B){const q=B&&B[0];if(we+=M,q==null)return te(),0;if(Gt.type==="begin"&&B.type==="end"&&Gt.index===B.index&&q===""){if(we+=F.slice(B.index,B.index+1),!n){const re=new Error(`0 width match regex (${E})`);throw re.languageName=E,re.badRule=Gt.rule,re}return 1}if(Gt=B,B.type==="begin")return Es(B);if(B.type==="illegal"&&!U){const re=new Error('Illegal lexeme "'+q+'" for mode "'+(ie.scope||"<unnamed>")+'"');throw re.mode=ie,re}else if(B.type==="end"){const re=tn(B);if(re!==$u)return re}if(B.type==="illegal"&&q==="")return 1;if($>1e5&&$>B.index*3)throw new Error("potential infinite loop, way more iterations than matches");return we+=q,q.length}const ft=v(E);if(!ft)throw cs(i.replace("{}",E)),new Error('Unknown language: "'+E+'"');const Ur=bS(ft);let ne="",ie=L||Ur;const Re={},oe=new l.__emitter(l);lr();let we="",at=0,pt=0,$=0,T=!1;try{if(ft.__emitTokens)ft.__emitTokens(F,oe);else{for(ie.matcher.considerAll();;){$++,T?T=!1:ie.matcher.considerAll(),ie.matcher.lastIndex=pt;const M=ie.matcher.exec(F);if(!M)break;const B=F.substring(pt,M.index),q=ot(B,M);pt=M.index+q}ot(F.substring(pt))}return oe.finalize(),ne=oe.toHTML(),{language:E,value:ne,relevance:at,illegal:!1,_emitter:oe,_top:ie}}catch(M){if(M.message&&M.message.includes("Illegal"))return{language:E,value:_a(F),illegal:!0,relevance:0,_illegalBy:{message:M.message,index:pt,context:F.slice(pt-100,pt+100),mode:M.mode,resultSoFar:ne},_emitter:oe};if(n)return{language:E,value:_a(F),illegal:!1,relevance:0,errorRaised:M,_emitter:oe,_top:ie};throw M}}function f(E){const F={value:_a(E),illegal:!1,relevance:0,_top:o,_emitter:new l.__emitter(l)};return F._emitter.addText(E),F}function p(E,F){F=F||l.languages||Object.keys(e);const U=f(E),L=F.filter(v).filter(C).map(te=>h(te,E,!1));L.unshift(U);const _=L.sort((te,be)=>{if(te.relevance!==be.relevance)return be.relevance-te.relevance;if(te.language&&be.language){if(v(te.language).supersetOf===be.language)return 1;if(v(be.language).supersetOf===te.language)return-1}return 0}),[Y,Z]=_,J=Y;return J.secondBest=Z,J}function m(E,F,U){const L=F&&t[F]||U;E.classList.add("hljs"),E.classList.add(`language-${L}`)}function g(E){let F=null;const U=d(E);if(c(U))return;if(H("before:highlightElement",{el:E,language:U}),E.dataset.highlighted){console.log("Element previously highlighted. To highlight again, first unset `dataset.highlighted`.",E);return}if(E.children.length>0&&(l.ignoreUnescapedHTML||(console.warn("One of your code blocks includes unescaped HTML. This is a potentially serious security risk."),console.warn("https://github.com/highlightjs/highlight.js/wiki/security"),console.warn("The element with unescaped HTML:"),console.warn(E)),l.throwUnescapedHTML))throw new NS("One of your code blocks includes unescaped HTML.",E.innerHTML);F=E;const L=F.textContent,_=U?u(L,{language:U,ignoreIllegals:!0}):p(L);E.innerHTML=_.value,E.dataset.highlighted="yes",m(E,U,_.language),E.result={language:_.language,re:_.relevance,relevance:_.relevance},_.secondBest&&(E.secondBest={language:_.secondBest.language,relevance:_.secondBest.relevance}),H("after:highlightElement",{el:E,result:_,text:L})}function y(E){l=Lu(l,E)}const x=()=>{S(),Ds("10.6.0","initHighlighting() deprecated.  Use highlightAll() now.")};function N(){S(),Ds("10.6.0","initHighlightingOnLoad() deprecated.  Use highlightAll() now.")}let A=!1;function S(){if(document.readyState==="loading"){A=!0;return}document.querySelectorAll(l.cssSelector).forEach(g)}function k(){A&&S()}typeof window<"u"&&window.addEventListener&&window.addEventListener("DOMContentLoaded",k,!1);function R(E,F){let U=null;try{U=F(r)}catch(L){if(cs("Language definition for '{}' could not be registered.".replace("{}",E)),n)cs(L);else throw L;U=o}U.name||(U.name=E),e[E]=U,U.rawDefinition=F.bind(null,r),U.aliases&&D(U.aliases,{languageName:E})}function j(E){delete e[E];for(const F of Object.keys(t))t[F]===E&&delete t[F]}function w(){return Object.keys(e)}function v(E){return E=(E||"").toLowerCase(),e[E]||e[t[E]]}function D(E,{languageName:F}){typeof E=="string"&&(E=[E]),E.forEach(U=>{t[U.toLowerCase()]=F})}function C(E){const F=v(E);return F&&!F.disableAutodetect}function P(E){E["before:highlightBlock"]&&!E["before:highlightElement"]&&(E["before:highlightElement"]=F=>{E["before:highlightBlock"](Object.assign({block:F.el},F))}),E["after:highlightBlock"]&&!E["after:highlightElement"]&&(E["after:highlightElement"]=F=>{E["after:highlightBlock"](Object.assign({block:F.el},F))})}function O(E){P(E),s.push(E)}function W(E){const F=s.indexOf(E);F!==-1&&s.splice(F,1)}function H(E,F){const U=E;s.forEach(function(L){L[U]&&L[U](F)})}function I(E){return Ds("10.7.0","highlightBlock will be removed entirely in v12.0"),Ds("10.7.0","Please use highlightElement now."),g(E)}Object.assign(r,{highlight:u,highlightAuto:p,highlightAll:S,highlightElement:g,highlightBlock:I,configure:y,initHighlighting:x,initHighlightingOnLoad:N,registerLanguage:R,unregisterLanguage:j,listLanguages:w,getLanguage:v,registerAliases:D,autoDetection:C,inherit:Lu,addPlugin:O,removePlugin:W}),r.debugMode=function(){n=!1},r.safeMode=function(){n=!0},r.versionString=vS,r.regex={concat:ks,lookahead:xm,either:Pc,optional:$2,anyNumberOfTimes:L2};for(const E in ui)typeof ui[E]=="object"&&pm(ui[E]);return Object.assign(r,ui),r},Ys=Em({});Ys.newInstance=()=>Em({});var kS=Ys;Ys.HighlightJS=Ys;Ys.default=Ys;var SS=D2(kS);function Am(r,e=[]){return r.map(t=>{const s=[...e,...t.properties?t.properties.className:[]];return t.children?Am(t.children,s):{text:t.value,classes:s}}).flat()}function _u(r){return r.value||r.children||[]}function ES(r){return!!SS.getLanguage(r)}function Fu({doc:r,name:e,lowlight:t,defaultLanguage:s}){const n=[];return wl(r,i=>i.type.name===e).forEach(i=>{var o;let l=i.pos+1;const c=i.node.attrs.language||s,d=t.listLanguages(),u=c&&(d.includes(c)||ES(c)||!((o=t.registered)===null||o===void 0)&&o.call(t,c))?_u(t.highlight(c,i.node.textContent)):_u(t.highlightAuto(i.node.textContent));Am(u).forEach(h=>{const f=l+h.text.length;if(h.classes.length){const p=Nt.inline(l,f,{class:h.classes.join(" ")});n.push(p)}l=f})}),Be.create(r,n)}function AS(r){return typeof r=="function"}function CS({name:r,lowlight:e,defaultLanguage:t}){if(!["highlight","highlightAuto","listLanguages"].every(n=>AS(e[n])))throw Error("You should provide an instance of lowlight to use the code-block-lowlight extension");const s=new Je({key:new yt("lowlight"),state:{init:(n,{doc:i})=>Fu({doc:i,name:r,lowlight:e,defaultLanguage:t}),apply:(n,i,o,l)=>{const c=o.selection.$head.parent.type.name,d=l.selection.$head.parent.type.name,u=wl(o.doc,f=>f.type.name===r),h=wl(l.doc,f=>f.type.name===r);return n.docChanged&&([c,d].includes(r)||h.length!==u.length||n.steps.some(f=>f.from!==void 0&&f.to!==void 0&&u.some(p=>p.pos>=f.from&&p.pos+p.node.nodeSize<=f.to)))?Fu({doc:n.doc,name:r,lowlight:e,defaultLanguage:t}):i.map(n.mapping,n.doc)}},props:{decorations(n){return s.getState(n)}}});return s}const MS=Zp.extend({addOptions(){var r;return{...(r=this.parent)===null||r===void 0?void 0:r.call(this),lowlight:{},languageClassPrefix:"language-",exitOnTripleEnter:!0,exitOnArrowDown:!0,defaultLanguage:null,HTMLAttributes:{}}},addProseMirrorPlugins(){var r;return[...((r=this.parent)===null||r===void 0?void 0:r.call(this))||[],CS({name:this.name,lowlight:this.options.lowlight,defaultLanguage:this.options.defaultLanguage})]}}),DS=r=>{if(!r.children.length)return;const e=r.querySelectorAll("span");e&&e.forEach(t=>{var s,n;const i=t.getAttribute("style"),o=(n=(s=t.parentElement)===null||s===void 0?void 0:s.closest("span"))===null||n===void 0?void 0:n.getAttribute("style");t.setAttribute("style",`${o};${i}`)})},Bu=Kt.create({name:"textStyle",priority:101,addOptions(){return{HTMLAttributes:{},mergeNestedSpanStyles:!1}},parseHTML(){return[{tag:"span",getAttrs:r=>r.hasAttribute("style")?(this.options.mergeNestedSpanStyles&&DS(r),{}):!1}]},renderHTML({HTMLAttributes:r}){return["span",He(this.options.HTMLAttributes,r),0]},addCommands(){return{removeEmptyTextStyle:()=>({tr:r})=>{const{selection:e}=r;return r.doc.nodesBetween(e.from,e.to,(t,s)=>{if(t.isTextblock)return!0;t.marks.filter(n=>n.type===this.type).some(n=>Object.values(n.attrs).some(i=>!!i))||r.removeMark(s,s+t.nodeSize,this.type)}),!0}}}}),TS=nt.create({name:"color",addOptions(){return{types:["textStyle"]}},addGlobalAttributes(){return[{types:this.options.types,attributes:{color:{default:null,parseHTML:r=>{var e;return(e=r.style.color)===null||e===void 0?void 0:e.replace(/['"]+/g,"")},renderHTML:r=>r.color?{style:`color: ${r.color}`}:{}}}}]},addCommands(){return{setColor:r=>({chain:e})=>e().setMark("textStyle",{color:r}).run(),unsetColor:()=>({chain:r})=>r().setMark("textStyle",{color:null}).removeEmptyTextStyle().run()}}});function Cm(r){return r instanceof Map?r.clear=r.delete=r.set=function(){throw new Error("map is read-only")}:r instanceof Set&&(r.add=r.clear=r.delete=function(){throw new Error("set is read-only")}),Object.freeze(r),Object.getOwnPropertyNames(r).forEach(e=>{const t=r[e],s=typeof t;(s==="object"||s==="function")&&!Object.isFrozen(t)&&Cm(t)}),r}class Uu{constructor(e){e.data===void 0&&(e.data={}),this.data=e.data,this.isMatchIgnored=!1}ignoreMatch(){this.isMatchIgnored=!0}}function Mm(r){return r.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;")}function kr(r,...e){const t=Object.create(null);for(const s in r)t[s]=r[s];return e.forEach(function(s){for(const n in s)t[n]=s[n]}),t}const OS="</span>",zu=r=>!!r.scope,RS=(r,{prefix:e})=>{if(r.startsWith("language:"))return r.replace("language:","language-");if(r.includes(".")){const t=r.split(".");return[`${e}${t.shift()}`,...t.map((s,n)=>`${s}${"_".repeat(n+1)}`)].join(" ")}return`${e}${r}`};class IS{constructor(e,t){this.buffer="",this.classPrefix=t.classPrefix,e.walk(this)}addText(e){this.buffer+=Mm(e)}openNode(e){if(!zu(e))return;const t=RS(e.scope,{prefix:this.classPrefix});this.span(t)}closeNode(e){zu(e)&&(this.buffer+=OS)}value(){return this.buffer}span(e){this.buffer+=`<span class="${e}">`}}const Wu=(r={})=>{const e={children:[]};return Object.assign(e,r),e};class _c{constructor(){this.rootNode=Wu(),this.stack=[this.rootNode]}get top(){return this.stack[this.stack.length-1]}get root(){return this.rootNode}add(e){this.top.children.push(e)}openNode(e){const t=Wu({scope:e});this.add(t),this.stack.push(t)}closeNode(){if(this.stack.length>1)return this.stack.pop()}closeAllNodes(){for(;this.closeNode(););}toJSON(){return JSON.stringify(this.rootNode,null,4)}walk(e){return this.constructor._walk(e,this.rootNode)}static _walk(e,t){return typeof t=="string"?e.addText(t):t.children&&(e.openNode(t),t.children.forEach(s=>this._walk(e,s)),e.closeNode(t)),e}static _collapse(e){typeof e!="string"&&e.children&&(e.children.every(t=>typeof t=="string")?e.children=[e.children.join("")]:e.children.forEach(t=>{_c._collapse(t)}))}}class PS extends _c{constructor(e){super(),this.options=e}addText(e){e!==""&&this.add(e)}startScope(e){this.openNode(e)}endScope(){this.closeNode()}__addSublanguage(e,t){const s=e.root;t&&(s.scope=`language:${t}`),this.add(s)}toHTML(){return new IS(this,this.options).value()}finalize(){return this.closeAllNodes(),!0}}function Bn(r){return r?typeof r=="string"?r:r.source:null}function Dm(r){return Ss("(?=",r,")")}function LS(r){return Ss("(?:",r,")*")}function $S(r){return Ss("(?:",r,")?")}function Ss(...r){return r.map(t=>Bn(t)).join("")}function _S(r){const e=r[r.length-1];return typeof e=="object"&&e.constructor===Object?(r.splice(r.length-1,1),e):{}}function Fc(...r){return"("+(_S(r).capture?"":"?:")+r.map(s=>Bn(s)).join("|")+")"}function Tm(r){return new RegExp(r.toString()+"|").exec("").length-1}function FS(r,e){const t=r&&r.exec(e);return t&&t.index===0}const BS=/\[(?:[^\\\]]|\\.)*\]|\(\??|\\([1-9][0-9]*)|\\./;function Bc(r,{joinWith:e}){let t=0;return r.map(s=>{t+=1;const n=t;let i=Bn(s),o="";for(;i.length>0;){const l=BS.exec(i);if(!l){o+=i;break}o+=i.substring(0,l.index),i=i.substring(l.index+l[0].length),l[0][0]==="\\"&&l[1]?o+="\\"+String(Number(l[1])+n):(o+=l[0],l[0]==="("&&t++)}return o}).map(s=>`(${s})`).join(e)}const US=/\b\B/,Om="[a-zA-Z]\\w*",Uc="[a-zA-Z_]\\w*",Rm="\\b\\d+(\\.\\d+)?",Im="(-?)(\\b0[xX][a-fA-F0-9]+|(\\b\\d+(\\.\\d*)?|\\.\\d+)([eE][-+]?\\d+)?)",Pm="\\b(0b[01]+)",zS="!|!=|!==|%|%=|&|&&|&=|\\*|\\*=|\\+|\\+=|,|-|-=|/=|/|:|;|<<|<<=|<=|<|===|==|=|>>>=|>>=|>=|>>>|>>|>|\\?|\\[|\\{|\\(|\\^|\\^=|\\||\\|=|\\|\\||~",WS=(r={})=>{const e=/^#![ ]*\//;return r.binary&&(r.begin=Ss(e,/.*\b/,r.binary,/\b.*/)),kr({scope:"meta",begin:e,end:/$/,relevance:0,"on:begin":(t,s)=>{t.index!==0&&s.ignoreMatch()}},r)},Un={begin:"\\\\[\\s\\S]",relevance:0},HS={scope:"string",begin:"'",end:"'",illegal:"\\n",contains:[Un]},VS={scope:"string",begin:'"',end:'"',illegal:"\\n",contains:[Un]},qS={begin:/\b(a|an|the|are|I'm|isn't|don't|doesn't|won't|but|just|should|pretty|simply|enough|gonna|going|wtf|so|such|will|you|your|they|like|more)\b/},ra=function(r,e,t={}){const s=kr({scope:"comment",begin:r,end:e,contains:[]},t);s.contains.push({scope:"doctag",begin:"[ ]*(?=(TODO|FIXME|NOTE|BUG|OPTIMIZE|HACK|XXX):)",end:/(TODO|FIXME|NOTE|BUG|OPTIMIZE|HACK|XXX):/,excludeBegin:!0,relevance:0});const n=Fc("I","a","is","so","us","to","at","if","in","it","on",/[A-Za-z]+['](d|ve|re|ll|t|s|n)/,/[A-Za-z]+[-][a-z]+/,/[A-Za-z][a-z]{2,}/);return s.contains.push({begin:Ss(/[ ]+/,"(",n,/[.]?[:]?([.][ ]|[ ])/,"){3}")}),s},KS=ra("//","$"),GS=ra("/\\*","\\*/"),YS=ra("#","$"),JS={scope:"number",begin:Rm,relevance:0},XS={scope:"number",begin:Im,relevance:0},QS={scope:"number",begin:Pm,relevance:0},ZS={scope:"regexp",begin:/\/(?=[^/\n]*\/)/,end:/\/[gimuy]*/,contains:[Un,{begin:/\[/,end:/\]/,relevance:0,contains:[Un]}]},eE={scope:"title",begin:Om,relevance:0},tE={scope:"title",begin:Uc,relevance:0},rE={begin:"\\.\\s*"+Uc,relevance:0},sE=function(r){return Object.assign(r,{"on:begin":(e,t)=>{t.data._beginMatch=e[1]},"on:end":(e,t)=>{t.data._beginMatch!==e[1]&&t.ignoreMatch()}})};var hi=Object.freeze({__proto__:null,APOS_STRING_MODE:HS,BACKSLASH_ESCAPE:Un,BINARY_NUMBER_MODE:QS,BINARY_NUMBER_RE:Pm,COMMENT:ra,C_BLOCK_COMMENT_MODE:GS,C_LINE_COMMENT_MODE:KS,C_NUMBER_MODE:XS,C_NUMBER_RE:Im,END_SAME_AS_BEGIN:sE,HASH_COMMENT_MODE:YS,IDENT_RE:Om,MATCH_NOTHING_RE:US,METHOD_GUARD:rE,NUMBER_MODE:JS,NUMBER_RE:Rm,PHRASAL_WORDS_MODE:qS,QUOTE_STRING_MODE:VS,REGEXP_MODE:ZS,RE_STARTERS_RE:zS,SHEBANG:WS,TITLE_MODE:eE,UNDERSCORE_IDENT_RE:Uc,UNDERSCORE_TITLE_MODE:tE});function nE(r,e){r.input[r.index-1]==="."&&e.ignoreMatch()}function iE(r,e){r.className!==void 0&&(r.scope=r.className,delete r.className)}function oE(r,e){e&&r.beginKeywords&&(r.begin="\\b("+r.beginKeywords.split(" ").join("|")+")(?!\\.)(?=\\b|\\s)",r.__beforeBegin=nE,r.keywords=r.keywords||r.beginKeywords,delete r.beginKeywords,r.relevance===void 0&&(r.relevance=0))}function aE(r,e){Array.isArray(r.illegal)&&(r.illegal=Fc(...r.illegal))}function lE(r,e){if(r.match){if(r.begin||r.end)throw new Error("begin & end are not supported with match");r.begin=r.match,delete r.match}}function cE(r,e){r.relevance===void 0&&(r.relevance=1)}const dE=(r,e)=>{if(!r.beforeMatch)return;if(r.starts)throw new Error("beforeMatch cannot be used with starts");const t=Object.assign({},r);Object.keys(r).forEach(s=>{delete r[s]}),r.keywords=t.keywords,r.begin=Ss(t.beforeMatch,Dm(t.begin)),r.starts={relevance:0,contains:[Object.assign(t,{endsParent:!0})]},r.relevance=0,delete t.beforeMatch},uE=["of","and","for","in","not","or","if","then","parent","list","value"],hE="keyword";function Lm(r,e,t=hE){const s=Object.create(null);return typeof r=="string"?n(t,r.split(" ")):Array.isArray(r)?n(t,r):Object.keys(r).forEach(function(i){Object.assign(s,Lm(r[i],e,i))}),s;function n(i,o){e&&(o=o.map(l=>l.toLowerCase())),o.forEach(function(l){const c=l.split("|");s[c[0]]=[i,fE(c[0],c[1])]})}}function fE(r,e){return e?Number(e):pE(r)?0:1}function pE(r){return uE.includes(r.toLowerCase())}const Hu={},ds=r=>{console.error(r)},Vu=(r,...e)=>{console.log(`WARN: ${r}`,...e)},Ts=(r,e)=>{Hu[`${r}/${e}`]||(console.log(`Deprecated as of ${r}. ${e}`),Hu[`${r}/${e}`]=!0)},Co=new Error;function $m(r,e,{key:t}){let s=0;const n=r[t],i={},o={};for(let l=1;l<=e.length;l++)o[l+s]=n[l],i[l+s]=!0,s+=Tm(e[l-1]);r[t]=o,r[t]._emit=i,r[t]._multi=!0}function mE(r){if(Array.isArray(r.begin)){if(r.skip||r.excludeBegin||r.returnBegin)throw ds("skip, excludeBegin, returnBegin not compatible with beginScope: {}"),Co;if(typeof r.beginScope!="object"||r.beginScope===null)throw ds("beginScope must be object"),Co;$m(r,r.begin,{key:"beginScope"}),r.begin=Bc(r.begin,{joinWith:""})}}function gE(r){if(Array.isArray(r.end)){if(r.skip||r.excludeEnd||r.returnEnd)throw ds("skip, excludeEnd, returnEnd not compatible with endScope: {}"),Co;if(typeof r.endScope!="object"||r.endScope===null)throw ds("endScope must be object"),Co;$m(r,r.end,{key:"endScope"}),r.end=Bc(r.end,{joinWith:""})}}function xE(r){r.scope&&typeof r.scope=="object"&&r.scope!==null&&(r.beginScope=r.scope,delete r.scope)}function yE(r){xE(r),typeof r.beginScope=="string"&&(r.beginScope={_wrap:r.beginScope}),typeof r.endScope=="string"&&(r.endScope={_wrap:r.endScope}),mE(r),gE(r)}function bE(r){function e(o,l){return new RegExp(Bn(o),"m"+(r.case_insensitive?"i":"")+(r.unicodeRegex?"u":"")+(l?"g":""))}class t{constructor(){this.matchIndexes={},this.regexes=[],this.matchAt=1,this.position=0}addRule(l,c){c.position=this.position++,this.matchIndexes[this.matchAt]=c,this.regexes.push([c,l]),this.matchAt+=Tm(l)+1}compile(){this.regexes.length===0&&(this.exec=()=>null);const l=this.regexes.map(c=>c[1]);this.matcherRe=e(Bc(l,{joinWith:"|"}),!0),this.lastIndex=0}exec(l){this.matcherRe.lastIndex=this.lastIndex;const c=this.matcherRe.exec(l);if(!c)return null;const d=c.findIndex((h,f)=>f>0&&h!==void 0),u=this.matchIndexes[d];return c.splice(0,d),Object.assign(c,u)}}class s{constructor(){this.rules=[],this.multiRegexes=[],this.count=0,this.lastIndex=0,this.regexIndex=0}getMatcher(l){if(this.multiRegexes[l])return this.multiRegexes[l];const c=new t;return this.rules.slice(l).forEach(([d,u])=>c.addRule(d,u)),c.compile(),this.multiRegexes[l]=c,c}resumingScanAtSamePosition(){return this.regexIndex!==0}considerAll(){this.regexIndex=0}addRule(l,c){this.rules.push([l,c]),c.type==="begin"&&this.count++}exec(l){const c=this.getMatcher(this.regexIndex);c.lastIndex=this.lastIndex;let d=c.exec(l);if(this.resumingScanAtSamePosition()&&!(d&&d.index===this.lastIndex)){const u=this.getMatcher(0);u.lastIndex=this.lastIndex+1,d=u.exec(l)}return d&&(this.regexIndex+=d.position+1,this.regexIndex===this.count&&this.considerAll()),d}}function n(o){const l=new s;return o.contains.forEach(c=>l.addRule(c.begin,{rule:c,type:"begin"})),o.terminatorEnd&&l.addRule(o.terminatorEnd,{type:"end"}),o.illegal&&l.addRule(o.illegal,{type:"illegal"}),l}function i(o,l){const c=o;if(o.isCompiled)return c;[iE,lE,yE,dE].forEach(u=>u(o,l)),r.compilerExtensions.forEach(u=>u(o,l)),o.__beforeBegin=null,[oE,aE,cE].forEach(u=>u(o,l)),o.isCompiled=!0;let d=null;return typeof o.keywords=="object"&&o.keywords.$pattern&&(o.keywords=Object.assign({},o.keywords),d=o.keywords.$pattern,delete o.keywords.$pattern),d=d||/\w+/,o.keywords&&(o.keywords=Lm(o.keywords,r.case_insensitive)),c.keywordPatternRe=e(d,!0),l&&(o.begin||(o.begin=/\B|\b/),c.beginRe=e(c.begin),!o.end&&!o.endsWithParent&&(o.end=/\B|\b/),o.end&&(c.endRe=e(c.end)),c.terminatorEnd=Bn(c.end)||"",o.endsWithParent&&l.terminatorEnd&&(c.terminatorEnd+=(o.end?"|":"")+l.terminatorEnd)),o.illegal&&(c.illegalRe=e(o.illegal)),o.contains||(o.contains=[]),o.contains=[].concat(...o.contains.map(function(u){return wE(u==="self"?o:u)})),o.contains.forEach(function(u){i(u,c)}),o.starts&&i(o.starts,l),c.matcher=n(c),c}if(r.compilerExtensions||(r.compilerExtensions=[]),r.contains&&r.contains.includes("self"))throw new Error("ERR: contains `self` is not supported at the top-level of a language.  See documentation.");return r.classNameAliases=kr(r.classNameAliases||{}),i(r)}function _m(r){return r?r.endsWithParent||_m(r.starts):!1}function wE(r){return r.variants&&!r.cachedVariants&&(r.cachedVariants=r.variants.map(function(e){return kr(r,{variants:null},e)})),r.cachedVariants?r.cachedVariants:_m(r)?kr(r,{starts:r.starts?kr(r.starts):null}):Object.isFrozen(r)?kr(r):r}var vE="11.11.1";class NE extends Error{constructor(e,t){super(e),this.name="HTMLInjectionError",this.html=t}}const Fa=Mm,qu=kr,Ku=Symbol("nomatch"),jE=7,Fm=function(r){const e=Object.create(null),t=Object.create(null),s=[];let n=!0;const i="Could not find the language '{}', did you forget to load/include a language module?",o={disableAutodetect:!0,name:"Plain text",contains:[]};let l={ignoreUnescapedHTML:!1,throwUnescapedHTML:!1,noHighlightRe:/^(no-?highlight)$/i,languageDetectRe:/\blang(?:uage)?-([\w-]+)\b/i,classPrefix:"hljs-",cssSelector:"pre code",languages:null,__emitter:PS};function c(I){return l.noHighlightRe.test(I)}function d(I){let E=I.className+" ";E+=I.parentNode?I.parentNode.className:"";const F=l.languageDetectRe.exec(E);if(F){const U=w(F[1]);return U||(Vu(i.replace("{}",F[1])),Vu("Falling back to no-highlight mode for this block.",I)),U?F[1]:"no-highlight"}return E.split(/\s+/).find(U=>c(U)||w(U))}function u(I,E,F){let U="",L="";typeof E=="object"?(U=I,F=E.ignoreIllegals,L=E.language):(Ts("10.7.0","highlight(lang, code, ...args) has been deprecated."),Ts("10.7.0",`Please use highlight(code, options) instead.
https://github.com/highlightjs/highlight.js/issues/2277`),L=I,U=E),F===void 0&&(F=!0);const _={code:U,language:L};W("before:highlight",_);const Y=_.result?_.result:h(_.language,_.code,F);return Y.code=_.code,W("after:highlight",Y),Y}function h(I,E,F,U){const L=Object.create(null);function _(T,M){return T.keywords[M]}function Y(){if(!ne.keywords){Re.addText(oe);return}let T=0;ne.keywordPatternRe.lastIndex=0;let M=ne.keywordPatternRe.exec(oe),B="";for(;M;){B+=oe.substring(T,M.index);const q=ot.case_insensitive?M[0].toLowerCase():M[0],re=_(ne,q);if(re){const[ye,je]=re;if(Re.addText(B),B="",L[q]=(L[q]||0)+1,L[q]<=jE&&(we+=je),ye.startsWith("_"))B+=M[0];else{const Yt=ot.classNameAliases[ye]||ye;te(M[0],Yt)}}else B+=M[0];T=ne.keywordPatternRe.lastIndex,M=ne.keywordPatternRe.exec(oe)}B+=oe.substring(T),Re.addText(B)}function Z(){if(oe==="")return;let T=null;if(typeof ne.subLanguage=="string"){if(!e[ne.subLanguage]){Re.addText(oe);return}T=h(ne.subLanguage,oe,!0,ie[ne.subLanguage]),ie[ne.subLanguage]=T._top}else T=p(oe,ne.subLanguage.length?ne.subLanguage:null);ne.relevance>0&&(we+=T.relevance),Re.__addSublanguage(T._emitter,T.language)}function J(){ne.subLanguage!=null?Z():Y(),oe=""}function te(T,M){T!==""&&(Re.startScope(M),Re.addText(T),Re.endScope())}function be(T,M){let B=1;const q=M.length-1;for(;B<=q;){if(!T._emit[B]){B++;continue}const re=ot.classNameAliases[T[B]]||T[B],ye=M[B];re?te(ye,re):(oe=ye,Y(),oe=""),B++}}function ht(T,M){return T.scope&&typeof T.scope=="string"&&Re.openNode(ot.classNameAliases[T.scope]||T.scope),T.beginScope&&(T.beginScope._wrap?(te(oe,ot.classNameAliases[T.beginScope._wrap]||T.beginScope._wrap),oe=""):T.beginScope._multi&&(be(T.beginScope,M),oe="")),ne=Object.create(T,{parent:{value:ne}}),ne}function Fr(T,M,B){let q=FS(T.endRe,B);if(q){if(T["on:end"]){const re=new Uu(T);T["on:end"](M,re),re.isMatchIgnored&&(q=!1)}if(q){for(;T.endsParent&&T.parent;)T=T.parent;return T}}if(T.endsWithParent)return Fr(T.parent,M,B)}function Br(T){return ne.matcher.regexIndex===0?(oe+=T[0],1):($=!0,0)}function en(T){const M=T[0],B=T.rule,q=new Uu(B),re=[B.__beforeBegin,B["on:begin"]];for(const ye of re)if(ye&&(ye(T,q),q.isMatchIgnored))return Br(M);return B.skip?oe+=M:(B.excludeBegin&&(oe+=M),J(),!B.returnBegin&&!B.excludeBegin&&(oe=M)),ht(B,T),B.returnBegin?0:M.length}function Es(T){const M=T[0],B=E.substring(T.index),q=Fr(ne,T,B);if(!q)return Ku;const re=ne;ne.endScope&&ne.endScope._wrap?(J(),te(M,ne.endScope._wrap)):ne.endScope&&ne.endScope._multi?(J(),be(ne.endScope,T)):re.skip?oe+=M:(re.returnEnd||re.excludeEnd||(oe+=M),J(),re.excludeEnd&&(oe=M));do ne.scope&&Re.closeNode(),!ne.skip&&!ne.subLanguage&&(we+=ne.relevance),ne=ne.parent;while(ne!==q.parent);return q.starts&&ht(q.starts,T),re.returnEnd?0:M.length}function tn(){const T=[];for(let M=ne;M!==ot;M=M.parent)M.scope&&T.unshift(M.scope);T.forEach(M=>Re.openNode(M))}let lr={};function Gt(T,M){const B=M&&M[0];if(oe+=T,B==null)return J(),0;if(lr.type==="begin"&&M.type==="end"&&lr.index===M.index&&B===""){if(oe+=E.slice(M.index,M.index+1),!n){const q=new Error(`0 width match regex (${I})`);throw q.languageName=I,q.badRule=lr.rule,q}return 1}if(lr=M,M.type==="begin")return en(M);if(M.type==="illegal"&&!F){const q=new Error('Illegal lexeme "'+B+'" for mode "'+(ne.scope||"<unnamed>")+'"');throw q.mode=ne,q}else if(M.type==="end"){const q=Es(M);if(q!==Ku)return q}if(M.type==="illegal"&&B==="")return oe+=`
`,1;if(pt>1e5&&pt>M.index*3)throw new Error("potential infinite loop, way more iterations than matches");return oe+=B,B.length}const ot=w(I);if(!ot)throw ds(i.replace("{}",I)),new Error('Unknown language: "'+I+'"');const ft=bE(ot);let Ur="",ne=U||ft;const ie={},Re=new l.__emitter(l);tn();let oe="",we=0,at=0,pt=0,$=!1;try{if(ot.__emitTokens)ot.__emitTokens(E,Re);else{for(ne.matcher.considerAll();;){pt++,$?$=!1:ne.matcher.considerAll(),ne.matcher.lastIndex=at;const T=ne.matcher.exec(E);if(!T)break;const M=E.substring(at,T.index),B=Gt(M,T);at=T.index+B}Gt(E.substring(at))}return Re.finalize(),Ur=Re.toHTML(),{language:I,value:Ur,relevance:we,illegal:!1,_emitter:Re,_top:ne}}catch(T){if(T.message&&T.message.includes("Illegal"))return{language:I,value:Fa(E),illegal:!0,relevance:0,_illegalBy:{message:T.message,index:at,context:E.slice(at-100,at+100),mode:T.mode,resultSoFar:Ur},_emitter:Re};if(n)return{language:I,value:Fa(E),illegal:!1,relevance:0,errorRaised:T,_emitter:Re,_top:ne};throw T}}function f(I){const E={value:Fa(I),illegal:!1,relevance:0,_top:o,_emitter:new l.__emitter(l)};return E._emitter.addText(I),E}function p(I,E){E=E||l.languages||Object.keys(e);const F=f(I),U=E.filter(w).filter(D).map(J=>h(J,I,!1));U.unshift(F);const L=U.sort((J,te)=>{if(J.relevance!==te.relevance)return te.relevance-J.relevance;if(J.language&&te.language){if(w(J.language).supersetOf===te.language)return 1;if(w(te.language).supersetOf===J.language)return-1}return 0}),[_,Y]=L,Z=_;return Z.secondBest=Y,Z}function m(I,E,F){const U=E&&t[E]||F;I.classList.add("hljs"),I.classList.add(`language-${U}`)}function g(I){let E=null;const F=d(I);if(c(F))return;if(W("before:highlightElement",{el:I,language:F}),I.dataset.highlighted){console.log("Element previously highlighted. To highlight again, first unset `dataset.highlighted`.",I);return}if(I.children.length>0&&(l.ignoreUnescapedHTML||(console.warn("One of your code blocks includes unescaped HTML. This is a potentially serious security risk."),console.warn("https://github.com/highlightjs/highlight.js/wiki/security"),console.warn("The element with unescaped HTML:"),console.warn(I)),l.throwUnescapedHTML))throw new NE("One of your code blocks includes unescaped HTML.",I.innerHTML);E=I;const U=E.textContent,L=F?u(U,{language:F,ignoreIllegals:!0}):p(U);I.innerHTML=L.value,I.dataset.highlighted="yes",m(I,F,L.language),I.result={language:L.language,re:L.relevance,relevance:L.relevance},L.secondBest&&(I.secondBest={language:L.secondBest.language,relevance:L.secondBest.relevance}),W("after:highlightElement",{el:I,result:L,text:U})}function y(I){l=qu(l,I)}const x=()=>{S(),Ts("10.6.0","initHighlighting() deprecated.  Use highlightAll() now.")};function N(){S(),Ts("10.6.0","initHighlightingOnLoad() deprecated.  Use highlightAll() now.")}let A=!1;function S(){function I(){S()}if(document.readyState==="loading"){A||window.addEventListener("DOMContentLoaded",I,!1),A=!0;return}document.querySelectorAll(l.cssSelector).forEach(g)}function k(I,E){let F=null;try{F=E(r)}catch(U){if(ds("Language definition for '{}' could not be registered.".replace("{}",I)),n)ds(U);else throw U;F=o}F.name||(F.name=I),e[I]=F,F.rawDefinition=E.bind(null,r),F.aliases&&v(F.aliases,{languageName:I})}function R(I){delete e[I];for(const E of Object.keys(t))t[E]===I&&delete t[E]}function j(){return Object.keys(e)}function w(I){return I=(I||"").toLowerCase(),e[I]||e[t[I]]}function v(I,{languageName:E}){typeof I=="string"&&(I=[I]),I.forEach(F=>{t[F.toLowerCase()]=E})}function D(I){const E=w(I);return E&&!E.disableAutodetect}function C(I){I["before:highlightBlock"]&&!I["before:highlightElement"]&&(I["before:highlightElement"]=E=>{I["before:highlightBlock"](Object.assign({block:E.el},E))}),I["after:highlightBlock"]&&!I["after:highlightElement"]&&(I["after:highlightElement"]=E=>{I["after:highlightBlock"](Object.assign({block:E.el},E))})}function P(I){C(I),s.push(I)}function O(I){const E=s.indexOf(I);E!==-1&&s.splice(E,1)}function W(I,E){const F=I;s.forEach(function(U){U[F]&&U[F](E)})}function H(I){return Ts("10.7.0","highlightBlock will be removed entirely in v12.0"),Ts("10.7.0","Please use highlightElement now."),g(I)}Object.assign(r,{highlight:u,highlightAuto:p,highlightAll:S,highlightElement:g,highlightBlock:H,configure:y,initHighlighting:x,initHighlightingOnLoad:N,registerLanguage:k,unregisterLanguage:R,listLanguages:j,getLanguage:w,registerAliases:v,autoDetection:D,inherit:qu,addPlugin:P,removePlugin:O}),r.debugMode=function(){n=!1},r.safeMode=function(){n=!0},r.versionString=vE,r.regex={concat:Ss,lookahead:Dm,either:Fc,optional:$S,anyNumberOfTimes:LS};for(const I in hi)typeof hi[I]=="object"&&Cm(hi[I]);return Object.assign(r,hi),r},Js=Fm({});Js.newInstance=()=>Fm({});var kE=Js;Js.HighlightJS=Js;Js.default=Js;const SE=Gm(kE),Gu={},EE="hljs-";function AE(r){const e=SE.newInstance();return{highlight:t,highlightAuto:s,listLanguages:n,register:i,registerAlias:o,registered:l};function t(c,d,u){const h=u||Gu,f=typeof h.prefix=="string"?h.prefix:EE;if(!e.getLanguage(c))throw new Error("Unknown language: `"+c+"` is not registered");e.configure({__emitter:CE,classPrefix:f});const p=e.highlight(d,{ignoreIllegals:!0,language:c});if(p.errorRaised)throw new Error("Could not highlight with `Highlight.js`",{cause:p.errorRaised});const m=p._emitter.root,g=m.data;return g.language=p.language,g.relevance=p.relevance,m}function s(c,d){const h=(d||Gu).subset||n();let f=-1,p=0,m;for(;++f<h.length;){const g=h[f];if(!e.getLanguage(g))continue;const y=t(g,c,d);y.data&&y.data.relevance!==void 0&&y.data.relevance>p&&(p=y.data.relevance,m=y)}return m||{type:"root",children:[],data:{language:void 0,relevance:p}}}function n(){return e.listLanguages()}function i(c,d){if(typeof c=="string")e.registerLanguage(c,d);else{let u;for(u in c)Object.hasOwn(c,u)&&e.registerLanguage(u,c[u])}}function o(c,d){if(typeof c=="string")e.registerAliases(typeof d=="string"?d:[...d],{languageName:c});else{let u;for(u in c)if(Object.hasOwn(c,u)){const h=c[u];e.registerAliases(typeof h=="string"?h:[...h],{languageName:u})}}}function l(c){return!!e.getLanguage(c)}}class CE{constructor(e){this.options=e,this.root={type:"root",children:[],data:{language:void 0,relevance:0}},this.stack=[this.root]}addText(e){if(e==="")return;const t=this.stack[this.stack.length-1],s=t.children[t.children.length-1];s&&s.type==="text"?s.value+=e:t.children.push({type:"text",value:e})}startScope(e){this.openNode(String(e))}endScope(){this.closeNode()}__addSublanguage(e,t){const s=this.stack[this.stack.length-1],n=e.root.children;t?s.children.push({type:"element",tagName:"span",properties:{className:[t]},children:n}):s.children.push(...n)}openNode(e){const t=this,s=e.split(".").map(function(o,l){return l?o+"_".repeat(l):t.options.classPrefix+o}),n=this.stack[this.stack.length-1],i={type:"element",tagName:"span",properties:{className:s},children:[]};n.children.push(i),this.stack.push(i)}closeNode(){this.stack.pop()}finalize(){}toHTML(){return""}}const Bm=({onUploadComplete:r,onUploadError:e,accept:t="image/*,.pdf,.txt,.doc,.docx",folder:s="articles",className:n="",children:i,showUploadManager:o=!0,articleId:l})=>{const{userProfile:c}=ve(),[d,u]=b.useState(!1),[h,f]=b.useState([]),[p,m]=b.useState(navigator.onLine),[g,y]=b.useState(!1),x=b.useRef(null);b.useEffect(()=>{const v=()=>m(!0),D=()=>m(!1);return window.addEventListener("online",v),window.addEventListener("offline",D),()=>{window.removeEventListener("online",v),window.removeEventListener("offline",D)}},[]),b.useEffect(()=>{const v=setInterval(()=>{const C=ge.getActiveUploads().map(P=>{const O={bytesTransferred:P.bytesTransferred,totalBytes:P.totalBytes,percentage:Math.round(P.bytesTransferred/P.totalBytes*100),speed:0,estimatedTimeRemaining:0,state:P.state};return{id:P.id,metadata:P,progress:O}});f(C)},1e3);return()=>clearInterval(v)},[]);const N=b.useCallback(async v=>{if(!v||v.length===0)return;if(!c){K.error("Please login to upload files"),e==null||e("Please login to upload files");return}const D=v[0],C=$o(D);if(!C.isValid){const P=C.error||"Invalid file";console.error("File validation failed:",P),K.error(P),e==null||e(P);return}try{console.log(`📤 Starting upload: ${D.name}`);const P=await ge.addUpload(D,c.uid,s,O=>{f(W=>W.map(H=>H.id===P?{...H,progress:O}:H))},O=>{O instanceof Error?(console.error("Upload failed:",O.message),K.error(`Upload failed: ${O.message}`),e==null||e(O.message)):(console.log(`✅ File uploaded: ${D.name} → ${O.url}`),K.success("File uploaded successfully!"),r(O)),f(W=>W.filter(H=>H.id!==P))},l?{articleId:l,type:"article",targetField:t!=null&&t.includes("image")?"coverImage":"attachment"}:void 0);K.success(`Upload started: ${D.name}`)}catch(P){const O=P instanceof Error?P.message:"Upload failed";console.error("Upload error:",O),K.error(O),e==null||e(O)}},[c,s,r,e,l]),A=b.useCallback(v=>{v.preventDefault(),v.stopPropagation(),v.type==="dragenter"||v.type==="dragover"?u(!0):v.type==="dragleave"&&u(!1)},[]),S=b.useCallback(v=>{v.preventDefault(),v.stopPropagation(),u(!1),v.dataTransfer.files&&v.dataTransfer.files[0]&&N(v.dataTransfer.files)},[N]),k=b.useCallback(()=>{var v;(v=x.current)==null||v.click()},[]),R=b.useCallback((v,D)=>{switch(D){case"pause":ge.pauseUpload(v),K.info("Upload paused");break;case"resume":ge.resumeUpload(v),K.info("Upload resumed");break;case"cancel":ge.cancelUpload(v),K.info("Upload canceled"),f(C=>C.filter(P=>P.id!==v));break;case"delete":ge.deleteCompletedUpload(v),K.success("Upload record deleted"),f(C=>C.filter(P=>P.id!==v));break}},[]),j=v=>{switch(v){case"running":return a.jsx(rt,{className:"h-4 w-4 text-blue-600 animate-pulse"});case"paused":return a.jsx(Di,{className:"h-4 w-4 text-yellow-600"});case"success":return a.jsx(sr,{className:"h-4 w-4 text-green-600"});case"error":return a.jsx(St,{className:"h-4 w-4 text-red-600"});case"canceled":return a.jsx(et,{className:"h-4 w-4 text-gray-600"});default:return a.jsx(jt,{className:"h-4 w-4 text-gray-600"})}},w=v=>{switch(v){case"running":return"border-blue-200 bg-blue-50";case"paused":return"border-yellow-200 bg-yellow-50";case"success":return"border-green-200 bg-green-50";case"error":return"border-red-200 bg-red-50";case"canceled":return"border-gray-200 bg-gray-50";default:return"border-gray-200 bg-gray-50"}};return i?a.jsxs(a.Fragment,{children:[a.jsx("div",{onClick:k,className:"cursor-pointer",children:i}),a.jsx("input",{ref:x,type:"file",accept:t,onChange:v=>N(v.target.files),className:"hidden"}),o&&h.length>0&&a.jsx("div",{className:"fixed bottom-4 right-4 z-50",children:a.jsxs("div",{className:"bg-white rounded-lg shadow-xl border border-gray-200 w-96 max-h-96 overflow-hidden",children:[a.jsxs("div",{className:"p-4 border-b border-gray-200 flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(rt,{className:"h-5 w-5 text-blue-600"}),a.jsxs("div",{className:"flex flex-col",children:[a.jsx("h3",{className:"font-semibold text-gray-900",children:"File Uploads"}),a.jsxs("div",{className:"flex items-center space-x-3 text-xs text-gray-600",children:[a.jsxs("span",{children:[h.filter(v=>v.progress.state==="success").length," ","completed"]}),a.jsxs("span",{children:[h.filter(v=>["running","paused"].includes(v.progress.state)).length," ","active"]}),a.jsxs("span",{children:[h.filter(v=>v.progress.state==="error").length," ","failed"]})]})]}),!p&&a.jsxs("div",{className:"flex items-center space-x-1 text-red-600",children:[a.jsx(fn,{className:"h-4 w-4"}),a.jsx("span",{className:"text-xs",children:"Offline"})]})]}),a.jsx("button",{onClick:()=>y(!g),className:"text-gray-400 hover:text-gray-600",children:g?a.jsx(et,{className:"h-4 w-4"}):a.jsx(rt,{className:"h-4 w-4"})})]}),g&&a.jsx("div",{className:"max-h-64 overflow-y-auto",children:h.map(v=>{var D;return a.jsxs("div",{className:`p-4 border-b border-gray-100 ${w(v.progress.state)}`,children:[a.jsxs("div",{className:"flex items-start justify-between mb-2",children:[a.jsxs("div",{className:"flex items-center space-x-2 flex-1 min-w-0",children:[Yl(((D=v.metadata.file)==null?void 0:D.type)||"")?a.jsx(_s,{className:"h-4 w-4 text-blue-600 flex-shrink-0"}):a.jsx(yh,{className:"h-4 w-4 text-gray-600 flex-shrink-0"}),a.jsx("span",{className:"text-sm font-medium text-gray-900 truncate",children:v.metadata.fileName}),j(v.progress.state)]}),a.jsxs("div",{className:"flex items-center space-x-1 ml-2",children:[v.progress.state==="running"&&a.jsx("button",{onClick:()=>R(v.id,"pause"),className:"p-1 text-yellow-600 hover:bg-yellow-100 rounded",title:"Pause upload",children:a.jsx(Di,{className:"h-3 w-3"})}),v.progress.state==="paused"&&a.jsx("button",{onClick:()=>R(v.id,"resume"),className:"p-1 text-green-600 hover:bg-green-100 rounded",title:"Resume upload",children:a.jsx(kh,{className:"h-3 w-3"})}),v.progress.state==="error"&&a.jsx("button",{onClick:()=>R(v.id,"resume"),className:"p-1 text-blue-600 hover:bg-blue-100 rounded",title:"Retry upload",children:a.jsx(Lo,{className:"h-3 w-3"})}),v.progress.state==="success"&&a.jsx("button",{onClick:()=>R(v.id,"delete"),className:"p-1 text-green-600 hover:bg-green-100 rounded",title:"Remove from list",children:a.jsx(Or,{className:"h-3 w-3"})}),["running","paused","error"].includes(v.progress.state)&&a.jsx("button",{onClick:()=>R(v.id,"cancel"),className:"p-1 text-red-600 hover:bg-red-100 rounded",title:"Cancel upload",children:a.jsx(Or,{className:"h-3 w-3"})}),v.progress.state==="error"&&a.jsx("button",{onClick:()=>R(v.id,"delete"),className:"p-1 text-gray-600 hover:bg-gray-100 rounded ml-1",title:"Remove failed upload",children:a.jsx(et,{className:"h-3 w-3"})})]})]}),a.jsxs("div",{className:"mb-2",children:[a.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-600 mb-1",children:[a.jsxs("span",{children:[v.progress.percentage,"%"]}),a.jsxs("span",{children:[ge.formatFileSize(v.progress.bytesTransferred)," ","/"," ",ge.formatFileSize(v.progress.totalBytes)]})]}),a.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:a.jsx("div",{className:`h-2 rounded-full transition-all duration-300 ${v.progress.state==="running"?"bg-blue-600":v.progress.state==="paused"?"bg-yellow-500":v.progress.state==="error"?"bg-red-500":"bg-green-500"}`,style:{width:`${v.progress.percentage}%`}})})]}),v.progress.state==="running"&&a.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[a.jsxs("div",{className:"flex items-center space-x-1",children:[a.jsx(ql,{className:"h-3 w-3"}),a.jsx("span",{children:ge.formatSpeed(v.progress.speed)})]}),a.jsxs("div",{className:"flex items-center space-x-1",children:[a.jsx(jt,{className:"h-3 w-3"}),a.jsx("span",{children:ge.formatTime(v.progress.estimatedTimeRemaining)})]})]}),v.progress.state==="paused"&&a.jsxs("div",{className:"text-xs text-yellow-600",children:["Upload paused ",p?"":"(offline)"]}),v.progress.state==="error"&&v.metadata.error&&a.jsxs("div",{className:"text-xs text-red-600",children:["Error: ",v.metadata.error]})]},v.id)})})]})})]}):a.jsxs("div",{className:`relative ${n}`,children:[a.jsxs("div",{className:`border-2 border-dashed rounded-lg p-6 text-center transition-all ${d?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-blue-400 hover:bg-blue-50"}`,onDragEnter:A,onDragLeave:A,onDragOver:A,onDrop:S,onClick:k,children:[a.jsx("input",{ref:x,type:"file",accept:t,onChange:v=>N(v.target.files),className:"hidden"}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center justify-center",children:[a.jsx(rt,{className:"h-12 w-12 text-gray-400"}),!p&&a.jsx("div",{className:"absolute -top-1 -right-1 bg-red-500 text-white rounded-full p-1",children:a.jsx(fn,{className:"h-3 w-3"})})]}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:p?"Drop files here or click to upload":"Offline - Files will upload when online"}),a.jsx("p",{className:"text-sm text-gray-600",children:"Supports resumable uploads with automatic retry on network reconnection"}),a.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Images, PDFs, and documents up to 10MB"})]})]})]}),a.jsx("div",{className:`absolute top-2 right-2 flex items-center space-x-1 px-2 py-1 rounded-full text-xs ${p?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:p?a.jsxs(a.Fragment,{children:[a.jsx(Ah,{className:"h-3 w-3"}),a.jsx("span",{children:"Online"})]}):a.jsxs(a.Fragment,{children:[a.jsx(fn,{className:"h-3 w-3"}),a.jsx("span",{children:"Offline"})]})})]})},ME=({children:r,...e})=>a.jsx(Bm,{...e,children:r}),Rl=({onUploadComplete:r,onUploadError:e,accept:t="image/*,.pdf,.txt,.doc,.docx",folder:s="articles",className:n="",children:i,useResumable:o=!0,articleId:l})=>{const{userProfile:c}=ve(),[d,u]=b.useState(!1),[h,f]=b.useState(0),[p,m]=b.useState(!1),[g,y]=b.useState(null),[x,N]=b.useState(new Set),A=b.useRef(null);if(o)return a.jsx(Bm,{onUploadComplete:w=>{const v={url:w.url,path:w.path,name:w.name,size:w.size,type:w.type};r(v)},onUploadError:e,accept:t,folder:s,className:n,articleId:l,children:i});const S=async w=>{if(!w||w.length===0)return;if(!c){const O="Please login to upload files";K.error(O),e==null||e(O);return}if(d)return;const v=w[0],D=`${v.name}-${v.size}-${v.lastModified}`,C=`${v.name}_${v.size}_${v.type}`;if(g===D){K.error("This file was just uploaded. Please wait before uploading again.");return}if(x.has(C)){K.error("A file with the same name, size, and type has already been uploaded.");return}const P=$o(v);if(!P.isValid){const O=P.error||"Invalid file";console.error("File validation failed:",O),K.error(O),e==null||e(O);return}u(!0),f(0);try{const O=await Kl(v,c.uid,s,W=>{f(W)},l);y(D),N(W=>new Set([...W,C])),setTimeout(()=>{y(null)},5e3),K.success("File uploaded successfully!"),r(O)}catch(O){const W=O instanceof Error?O.message:"Upload failed";console.error("Upload error:",W),K.error(W),e==null||e(W)}finally{u(!1),f(0),A.current&&(A.current.value="")}},k=w=>{w.preventDefault(),w.stopPropagation(),w.type==="dragenter"||w.type==="dragover"?m(!0):w.type==="dragleave"&&m(!1)},R=w=>{w.preventDefault(),w.stopPropagation(),m(!1),w.dataTransfer.files&&w.dataTransfer.files[0]&&S(w.dataTransfer.files)},j=()=>{var w;(w=A.current)==null||w.click()};return i?a.jsxs(a.Fragment,{children:[a.jsx("div",{onClick:j,className:"cursor-pointer",children:i}),a.jsx("input",{ref:A,type:"file",accept:t,onChange:w=>S(w.target.files),className:"hidden",disabled:d}),d&&a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:a.jsx("div",{className:"bg-white rounded-lg p-6 max-w-sm w-full mx-4",children:a.jsxs("div",{className:"text-center",children:[a.jsx(rt,{className:"h-8 w-8 text-blue-600 mx-auto mb-4 animate-pulse"}),a.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Uploading File"}),a.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 mb-4",children:a.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${h}%`}})}),a.jsxs("p",{className:"text-sm text-gray-600",children:[h,"% complete"]})]})})})]}):a.jsx("div",{className:`relative ${n}`,children:a.jsxs("div",{className:`border-2 border-dashed rounded-lg p-6 text-center transition-all ${p?"border-blue-500 bg-blue-50":d?"border-gray-300 bg-gray-50":"border-gray-300 hover:border-blue-400 hover:bg-blue-50"}`,onDragEnter:k,onDragLeave:k,onDragOver:k,onDrop:R,onClick:d?void 0:j,children:[a.jsx("input",{ref:A,type:"file",accept:t,onChange:w=>S(w.target.files),className:"hidden",disabled:d}),d?a.jsxs("div",{className:"space-y-4",children:[a.jsx(rt,{className:"h-12 w-12 text-blue-600 mx-auto animate-pulse"}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Uploading..."}),a.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 mb-2",children:a.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${h}%`}})}),a.jsxs("p",{className:"text-sm text-gray-600",children:[h,"% complete"]})]})]}):a.jsxs("div",{className:"space-y-4",children:[a.jsx(rt,{className:"h-12 w-12 text-gray-400 mx-auto"}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Drop files here or click to upload"}),a.jsx("p",{className:"text-sm text-gray-600",children:"Supports images, PDFs, and documents up to 10MB"})]})]})]})})},DE=({children:r,...e})=>{const{useResumable:t=!0,...s}=e;return t?a.jsx(ME,{...s,children:r}):a.jsx(Rl,{useResumable:!1,...s,children:r})},TE=({layout:r,onLayoutChange:e})=>{const t=[{id:"full-column",label:"Full Column",icon:S0,description:"Standard width within content column"},{id:"outset",label:"Outset",icon:I0,description:"Extends beyond column boundaries"},{id:"full-screen",label:"Full Width",icon:_0,description:"Spans entire article view width"}];return a.jsxs("div",{className:"absolute -top-12 left-1/2 transform -translate-x-1/2 z-50",children:[a.jsx("div",{className:"bg-white border border-gray-200 rounded-lg shadow-lg p-2 flex items-center space-x-1",children:a.jsx("div",{className:"flex items-center space-x-1 pr-2 border-r border-gray-200",children:t.map(s=>{const n=s.icon,i=r===s.id;return a.jsxs("button",{onClick:()=>e(s.id),className:`
                  p-2 rounded-md transition-colors text-xs font-medium flex flex-col items-center min-w-[60px]
                  ${i?"bg-blue-100 text-blue-700 border border-blue-200":"text-gray-600 hover:bg-gray-100 hover:text-gray-800"}
                `,title:s.description,children:[a.jsx(n,{className:"h-4 w-4 mb-1"}),a.jsx("span",{className:"text-[10px] leading-none",children:s.label})]},s.id)})})}),a.jsxs("div",{className:"absolute top-full left-1/2 transform -translate-x-1/2",children:[a.jsx("div",{className:"w-0 h-0 border-l-4 border-r-4 border-t-4 border-l-transparent border-r-transparent border-t-gray-200"}),a.jsx("div",{className:"w-0 h-0 border-l-4 border-r-4 border-t-4 border-l-transparent border-r-transparent border-t-white absolute -top-1 left-0"})]})]})},OE=({node:r,updateAttributes:e,selected:t,editor:s,getPos:n})=>{const[i,o]=b.useState(!1),[l,c]=b.useState(!1),[d,u]=b.useState(r.attrs.caption||""),h=b.useRef(null),f=b.useRef(null),{src:p,title:m,layout:g,caption:y}=r.attrs;b.useEffect(()=>{o(t),t?c(!0):(c(!1),d!==(r.attrs.caption||"")&&e({caption:d.trim()||null}))},[t,d,r.attrs.caption,e]),b.useEffect(()=>{u(r.attrs.caption||"")},[r.attrs.caption]),b.useEffect(()=>{l&&f.current&&t&&setTimeout(()=>{var R;(R=f.current)==null||R.focus()},100)},[l,t]);const x=R=>{e({layout:R})},N=R=>{u(R.target.value)},A=R=>{var j,w;R.key==="Enter"?(R.preventDefault(),e({caption:d.trim()||null}),(j=f.current)==null||j.blur()):R.key==="Escape"&&(R.preventDefault(),u(r.attrs.caption||""),(w=f.current)==null||w.blur())},S=()=>{e({caption:d.trim()||null})},k=()=>{const R="custom-image transition-all duration-200 rounded-lg",j={"full-column":"image-full-column max-w-full mx-auto block",outset:"image-outset max-w-none mx-auto block","full-screen":"image-full-screen w-screen max-w-none mx-auto block"},w=t?"ring-2 ring-blue-500 ring-opacity-50 shadow-lg":"hover:shadow-md";return`${R} ${j[g]||j["full-column"]} ${w}`};return a.jsxs(nk,{className:"relative group",children:[i&&a.jsx(TE,{layout:g,onLayoutChange:x}),a.jsxs("div",{className:"relative",children:[a.jsx("img",{ref:h,src:p,title:m||"",className:k(),draggable:!1,onLoad:()=>{},onError:R=>{console.error("Image failed to load:",p)}}),t&&a.jsx("div",{className:"absolute inset-0 bg-blue-500 bg-opacity-10 rounded-lg pointer-events-none"})]}),l&&t&&a.jsx("div",{className:"mt-2 text-center",children:a.jsx("input",{ref:f,type:"text",value:d,onChange:N,onKeyDown:A,onBlur:S,placeholder:"Add a caption...",className:"w-full max-w-md px-3 py-2 text-sm text-center text-gray-700 bg-transparent border-b border-gray-300 focus:outline-none focus:border-blue-500 focus:bg-white rounded-none",style:{fontStyle:"italic"}})}),!t&&y&&a.jsx("div",{className:"mt-2 text-center",children:a.jsx("p",{className:"text-sm text-gray-600 italic max-w-md mx-auto px-4",children:y})})]})},RE=ut.create({name:"customImage",addOptions(){return{inline:!1,allowBase64:!0,HTMLAttributes:{}}},inline(){return this.options.inline},group(){return this.options.inline?"inline":"block"},draggable:!0,addAttributes(){return{src:{default:null},title:{default:null},caption:{default:null,parseHTML:r=>r.getAttribute("data-caption")||null},layout:{default:"full-column",parseHTML:r=>r.getAttribute("data-layout")||"full-column"},width:{default:null,renderHTML:r=>r.width?{width:r.width}:{},parseHTML:r=>r.getAttribute("width")},height:{default:null,renderHTML:r=>r.height?{height:r.height}:{},parseHTML:r=>r.getAttribute("height")}}},parseHTML(){return[{tag:"img[src]"}]},renderHTML({HTMLAttributes:r}){const{layout:e,caption:t,...s}=r,n={"full-column":"image-full-column",outset:"image-outset","full-screen":"image-full-screen"},o={class:["custom-image",n[e]||n["full-column"]].filter(Boolean).join(" "),"data-layout":e||"full-column",style:e==="full-column"?"display: block; margin: 16px auto; text-align: center;":void 0};return t&&t.trim()&&(o["data-caption"]=t.trim()),["img",He(this.options.HTMLAttributes,s,o)]},addNodeView(){return dk(OE)},addCommands(){return{setImage:r=>({commands:e})=>e.insertContent({type:this.name,attrs:r}),updateImageLayout:r=>({tr:e,state:t})=>{const{selection:s}=t,{from:n}=s,i=t.doc.nodeAt(n);return i&&i.type.name===this.name?(e.setNodeMarkup(n,void 0,{...i.attrs,layout:r}),!0):!1}}}});class IE{constructor(e,t={}){Me(this,"editor");Me(this,"options");this.editor=e,this.options={maxColumns:4,spacing:8,responsive:!0,...t}}createGrid(e){if(e.length<2)return!1;const t=`grid-${Date.now()}`,s=e.map(n=>({type:"customImage",attrs:{...n,layout:"grid",gridId:t}}));return this.editor.chain().focus().insertContent([{type:"paragraph",attrs:{class:"image-grid-container","data-grid-id":t},content:s}]).run()}convertSelectionToGrid(){const{selection:e}=this.editor.state,t=[];return this.editor.state.doc.nodesBetween(e.from,e.to,s=>{s.type.name==="customImage"&&t.push({src:s.attrs.src,alt:s.attrs.alt,title:s.attrs.title})}),t.length<2?!1:(this.editor.chain().focus().deleteSelection().run(),this.createGrid(t))}addToGrid(e,t){const{state:s}=this.editor;let n=!1,i=-1;return s.doc.descendants((o,l)=>{if(o.type.name==="paragraph"&&o.attrs["data-grid-id"]===e)return n=!0,i=l+o.nodeSize-1,!1}),!n||i===-1?!1:this.editor.chain().focus().insertContentAt(i,{type:"customImage",attrs:{...t,layout:"grid",gridId:e}}).run()}removeFromGrid(e,t){const{state:s}=this.editor;let n=null;const i=[];if(s.doc.descendants((o,l)=>{if(o.type.name==="paragraph"&&o.attrs["data-grid-id"]===e)return n={node:o,pos:l},o.descendants((c,d)=>{c.type.name==="customImage"&&c.attrs.gridId===e&&i.push({node:c,pos:l+d+1})}),!1}),!n||i.length===0)return!1;if(t>=0&&t<i.length){const o=i[t];return this.editor.chain().focus().deleteRange({from:o.pos,to:o.pos+o.node.nodeSize}).run(),i.length===2&&i.find((c,d)=>d!==t)&&this.convertGridToSingleImage(e),!0}return!1}convertGridToSingleImage(e){const{state:t}=this.editor;let s=null;const n=[];if(t.doc.descendants((o,l)=>{if(o.type.name==="paragraph"&&o.attrs["data-grid-id"]===e)return s={node:o,pos:l},o.descendants((c,d)=>{c.type.name==="customImage"&&c.attrs.gridId===e&&n.push({node:c,pos:l+d+1})}),!1}),!s||n.length===0)return!1;const i=n.map(({node:o})=>({type:"customImage",attrs:{...o.attrs,layout:"full-column",gridId:null}}));return this.editor.chain().focus().deleteRange({from:s.pos,to:s.pos+s.node.nodeSize}).insertContent(i.map(o=>({type:"paragraph",content:[o]}))).run()}getOptimalLayout(e){const t=this.options.maxColumns||4;if(e<=1)return{columns:1,rows:1};if(e===2)return{columns:2,rows:1};if(e===3)return{columns:3,rows:1};if(e===4)return{columns:2,rows:2};const s=Math.min(t,Math.ceil(Math.sqrt(e))),n=Math.ceil(e/s);return{columns:s,rows:n}}updateResponsiveLayout(e){if(!this.options.responsive)return;window.matchMedia("(max-width: 768px)").matches?this.updateGridColumns(e,2):this.updateGridColumns(e,this.options.maxColumns||4)}updateGridColumns(e,t){const s=document.querySelector(`[data-grid-id="${e}"]`);s&&s.style.setProperty("--grid-columns",t.toString())}}const PE=AE(),LE=({content:r,onChange:e,placeholder:t="Start writing your article...",articleId:s})=>{ve();const[n,i]=b.useState(!1),[o,l]=b.useState(!1),c=b.useRef(null),d=[{name:"Black",value:"#000000"},{name:"Dark Gray",value:"#404040"},{name:"Gray",value:"#808080"},{name:"Light Gray",value:"#C0C0C0"},{name:"Red",value:"#FF0000"},{name:"Orange",value:"#FFA500"},{name:"Yellow",value:"#FFFF00"},{name:"Green",value:"#008000"},{name:"Blue",value:"#0000FF"},{name:"Purple",value:"#800080"},{name:"Dark Red",value:"#8B0000"},{name:"Dark Orange",value:"#FF8C00"},{name:"Dark Yellow",value:"#B8860B"},{name:"Dark Green",value:"#006400"},{name:"Dark Blue",value:"#000080"},{name:"Dark Purple",value:"#4B0082"}],u=tk({extensions:[o2.configure({bulletList:!1,orderedList:!1,listItem:!1,codeBlock:!1}),Bu,TS.configure({types:[Bu.name,kl.name]}),kl.configure({HTMLAttributes:{class:"list-item"},keepMarks:!0,keepAttributes:!0}),Qp.configure({HTMLAttributes:{class:"bullet-list"},keepMarks:!0,keepAttributes:!0}),nm.configure({HTMLAttributes:{class:"ordered-list"},keepMarks:!0,keepAttributes:!0}),RE.configure({inline:!1,allowBase64:!0,HTMLAttributes:{class:"custom-image"}}),M2.configure({openOnClick:!1,HTMLAttributes:{class:"text-blue-600 hover:text-blue-800 underline"}}),MS.configure({lowlight:PE,HTMLAttributes:{class:"bg-gray-100 rounded-lg p-4 font-mono text-sm"}})],content:r,onUpdate:({editor:x})=>{e(x.getHTML())},onCreate:({editor:x})=>{c.current=new IE(x)},editorProps:{attributes:{class:"prose prose-lg max-w-none focus:outline-none min-h-[400px] p-6"},handleKeyDown:(x,N)=>{const{state:A}=x,{selection:S}=A;if(N.key==="Tab"&&!N.shiftKey&&(u!=null&&u.isActive("bulletList")||u!=null&&u.isActive("orderedList")))return N.preventDefault(),N.stopPropagation(),A.tr,u.can().sinkListItem("listItem")?u.chain().focus().sinkListItem("listItem").run():!0;if(N.key==="Tab"&&N.shiftKey&&(u!=null&&u.isActive("bulletList")||u!=null&&u.isActive("orderedList")))return N.preventDefault(),N.stopPropagation(),A.tr,u.can().liftListItem("listItem")?u.chain().focus().liftListItem("listItem").run():!0;if(N.key==="Enter"&&!N.shiftKey&&(u!=null&&u.isActive("bulletList")||u!=null&&u.isActive("orderedList")))return u.can().splitListItem("listItem")?(N.preventDefault(),u.chain().focus().splitListItem("listItem").run()):!1;if(N.key==="Backspace"&&(u!=null&&u.isActive("bulletList")||u!=null&&u.isActive("orderedList"))){const{$from:k}=S;if(k.parentOffset===0&&u.can().liftListItem("listItem"))return N.preventDefault(),u.chain().focus().liftListItem("listItem").run()}return!1}}});if(!u)return null;const h=()=>{const x=window.prompt("Enter image URL:");x&&u.commands.setImage({src:x,alt:"",layout:"full-column"})},f=()=>{const x=window.prompt("Enter URL:");x&&u.chain().focus().setLink({href:x}).run()},p=x=>{if(x.type.startsWith("image/"))u.commands.setImage({src:x.url,alt:x.name||"",title:x.name||"",layout:"full-column"});else{const N=x.type==="application/pdf"?"PDF":"Document",A=`📄 ${x.name} (${N})`;u.chain().focus().setLink({href:x.url,target:"_blank"}).insertContent(A).run()}},m=x=>{K.error(x)},g=x=>{u.chain().focus().setColor(x).run(),l(!1)},y=()=>{u.chain().focus().unsetColor().run(),l(!1)};return a.jsxs("div",{className:"border border-gray-200 rounded-xl bg-white relative flex flex-col max-h-[600px]",children:[a.jsx("style",{children:`
        /* Typography styles for both editor and preview */
        .ProseMirror h1, .article-content h1, h1 {
          font-size: 32px !important;
          font-weight: bold !important;
          margin: 16px 0 8px 0 !important;
          line-height: 48px !important;
        }
        .ProseMirror h3, .article-content h3, h3 {
          font-size: 24px !important;
          font-weight: 600 !important;
          margin: 12px 0 6px 0 !important;
          line-height: 27.6px !important;
        }
        .ProseMirror p, .article-content p, p {
          font-size: 16px !important;
          line-height: 18.4px !important;
          margin: 8px 0 !important;
        }
        .ProseMirror, .article-content {
          font-size: 16px !important;
          line-height: 18.4px !important;
        }
        /* Custom Image Layout Styles */
        .custom-image {
          cursor: pointer;
          border-radius: 8px;
          transition: all 0.2s ease;
          height: auto;
        }

        /* Full Column Width Layout */
        .image-full-column {
          max-width: 100%;
          width: auto;
          display: block;
          margin: 16px auto;
          text-align: center;
        }

        /* Outset Layout - extends beyond column boundaries */
        .image-outset {
          max-width: 120%;
          width: auto;
          display: block;
          margin: 16px auto;
          margin-left: -10%;
          margin-right: -10%;
        }

        /* Full Screen Width Layout */
        .image-full-screen {
          width: calc(100% + 2rem);
          max-width: none;
          display: block;
          margin: 16px 0;
          margin-left: -1rem;
          margin-right: -1rem;
          object-fit: cover;
        }

        /* Image Grid Layouts */
        .image-grid-item {
          display: inline-block;
          margin: 4px;
          border-radius: 8px;
          vertical-align: top;
        }

        /* 2-image grid */
        .image-grid-item:nth-child(2n) {
          width: calc(50% - 8px);
        }

        /* 3-image grid */
        .image-grid-item:nth-child(3n) {
          width: calc(33.333% - 8px);
        }

        /* 4+ image grid */
        .image-grid-item:nth-child(4n) {
          width: calc(25% - 8px);
        }

        /* Grid container */
        .image-grid-container {
          display: flex;
          flex-wrap: wrap;
          gap: 8px;
          margin: 16px 0;
          justify-content: center;
        }

        /* Responsive grid adjustments */
        @media (max-width: 768px) {
          .image-outset {
            max-width: 100%;
            margin-left: 0;
            margin-right: 0;
          }

          .image-full-screen {
            width: 100%;
            margin-left: 0;
            margin-right: 0;
            padding: 0;
          }

          .image-grid-item:nth-child(n) {
            width: calc(50% - 8px);
          }
        }

        @media (max-width: 480px) {
          .image-grid-item:nth-child(n) {
            width: 100%;
            margin: 4px 0;
          }
        }

        /* Hover and selection states */
        .custom-image:hover {
          outline: 2px solid #3b82f6;
          box-shadow: 0 4px 12px rgba(59, 130, 246, 0.15);
        }

        .ProseMirror .custom-image.ProseMirror-selectednode {
          outline: 2px solid #3b82f6;
          box-shadow: 0 4px 12px rgba(59, 130, 246, 0.15);
        }

        /* Legacy image styles for backward compatibility */
        .ProseMirror img:not(.custom-image), .article-content img:not(.custom-image) {
          cursor: pointer;
          border-radius: 8px;
          transition: all 0.2s ease;
          max-width: 100%;
          height: auto;
          display: block;
          margin: 8px auto;
        }

        .ProseMirror img:not(.custom-image):hover, .article-content img:not(.custom-image):hover {
          outline: 2px solid #3b82f6;
          box-shadow: 0 4px 12px rgba(59, 130, 246, 0.15);
        }

        .ProseMirror img:not(.custom-image).ProseMirror-selectednode {
          outline: 2px solid #3b82f6;
          box-shadow: 0 4px 12px rgba(59, 130, 246, 0.15);
        }

        /* Float left images (legacy) */
        .ProseMirror img[style*="float: left"], .article-content img[style*="float: left"] {
          float: left !important;
          margin: 0 16px 8px 0 !important;
          max-width: 50% !important;
          display: inline !important;
        }

        /* Float right images (legacy) */
        .ProseMirror img[style*="float: right"], .article-content img[style*="float: right"] {
          float: right !important;
          margin: 0 0 8px 16px !important;
          max-width: 50% !important;
          display: inline !important;
        }

        /* Centered images (legacy) */
        .ProseMirror img[style*="margin: 16px auto"], .article-content img[style*="margin: 16px auto"] {
          display: block !important;
          margin: 16px auto !important;
          max-width: 100% !important;
          float: none !important;
        }

        /* Resizable images (legacy) */
        .ProseMirror img[style*="resize: both"], .article-content img[style*="resize: both"] {
          resize: both !important;
          overflow: auto !important;
        }
        .ProseMirror ul, .ProseMirror ol {
          font-size: 16px !important;
          line-height: 18.4px !important;
          margin: 8px 0 !important;
          padding-left: 24px !important;
          position: relative !important;
          display: block !important;
          box-sizing: border-box !important;
        }
        .ProseMirror ul li, .ProseMirror ol li {
          font-size: 16px !important;
          line-height: 18.4px !important;
          margin: 2px 0 !important;
          padding-left: 4px !important;
          position: relative !important;
          display: list-item !important;
          box-sizing: border-box !important;
          min-height: 1.2em !important;
        }
        .ProseMirror ul {
          list-style-type: disc !important;
        }
        .ProseMirror ol {
          list-style-type: decimal !important;
        }
        .ProseMirror ul ul {
          list-style-type: circle !important;
          margin-top: 4px !important;
          margin-bottom: 4px !important;
        }
        .ProseMirror ul ul ul {
          list-style-type: square !important;
        }
        .ProseMirror ol ol {
          list-style-type: lower-alpha !important;
          margin-top: 4px !important;
          margin-bottom: 4px !important;
        }
        .ProseMirror ol ol ol {
          list-style-type: lower-roman !important;
        }
        /* Prevent list jumping and ensure stable positioning */
        .ProseMirror ul, .ProseMirror ol {
          transform: translateZ(0) !important;
          backface-visibility: hidden !important;
          will-change: auto !important;
        }
        .ProseMirror li {
          transform: translateZ(0) !important;
          backface-visibility: hidden !important;
        }
        /* Ensure consistent list marker positioning */
        .ProseMirror ul li::marker, .ProseMirror ol li::marker {
          content: normal !important;
        }
        /* Stable list item content */
        .ProseMirror li p {
          margin: 0 !important;
          padding: 0 !important;
          display: inline !important;
        }
        /* Smooth scrolling and stable positioning during scroll */
        .ProseMirror {
          scroll-behavior: smooth !important;
          -webkit-overflow-scrolling: touch !important;
        }
        /* Prevent layout shifts during scrolling */
        .ProseMirror ul, .ProseMirror ol {
          contain: layout style !important;
          isolation: isolate !important;
        }
        .ProseMirror li {
          contain: layout !important;
        }
        /* Medium-style smooth editing experience */
        .ProseMirror * {
          transition: none !important;
        }
        /* Stable focus states during scrolling */
        .ProseMirror:focus-within {
          outline: none !important;
        }
      `}),a.jsxs("div",{className:"border-b border-gray-200 p-3 flex flex-wrap gap-1 sticky top-0 z-10 bg-white flex-shrink-0",children:[a.jsxs("select",{onChange:x=>{const N=parseInt(x.target.value),{selection:A}=u.state,{$from:S}=A,k=S.pos;if(N===0?u.chain().focus().setParagraph().run():u.chain().focus().toggleHeading({level:N}).run(),S.nodeBefore||S.start()>1){const R=S.start(S.depth);if(R>1){const j=R-1,w=u.state.doc.resolve(j),v=w.start(w.depth);u.chain().focus().setTextSelection({from:v,to:j}).run(),N===0?u.chain().focus().setParagraph().run():u.chain().focus().toggleHeading({level:N}).run(),u.chain().focus().setTextSelection(k).run()}}},value:u.isActive("heading",{level:1})?"1":u.isActive("heading",{level:2})?"2":u.isActive("heading",{level:3})?"3":"0",className:"px-3 py-1 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[a.jsx("option",{value:"0",children:"Content (16px)"}),a.jsx("option",{value:"3",children:"Subheading (24px)"}),a.jsx("option",{value:"1",children:"Heading (32px)"})]}),a.jsx("div",{className:"w-px h-6 bg-gray-300 mx-1"}),a.jsx("button",{onClick:()=>u.chain().focus().toggleBold().run(),className:`p-2 rounded-lg hover:bg-gray-100 ${u.isActive("bold")?"bg-blue-100 text-blue-700":"text-gray-600"}`,title:"Bold",children:a.jsx(A0,{className:"h-4 w-4"})}),a.jsx("button",{onClick:()=>u.chain().focus().toggleItalic().run(),className:`p-2 rounded-lg hover:bg-gray-100 ${u.isActive("italic")?"bg-blue-100 text-blue-700":"text-gray-600"}`,title:"Italic",children:a.jsx(B0,{className:"h-4 w-4"})}),a.jsxs("div",{className:"relative",children:[a.jsx("button",{onClick:()=>l(!o),className:`p-2 rounded-lg hover:bg-gray-100 ${o?"bg-blue-100 text-blue-700":"text-gray-600"}`,title:"Text Color",children:a.jsx(K0,{className:"h-4 w-4"})}),o&&a.jsxs("div",{className:"absolute top-full left-0 mt-1 bg-white border border-gray-200 rounded-lg shadow-lg p-3 z-20",children:[a.jsx("div",{className:"grid grid-cols-4 gap-1 mb-2",children:d.map(x=>a.jsx("button",{onClick:()=>g(x.value),className:"w-6 h-6 rounded border border-gray-300 hover:scale-110 transition-transform",style:{backgroundColor:x.value},title:x.name},x.value))}),a.jsx("button",{onClick:y,className:"w-full text-xs text-gray-600 hover:text-gray-800 py-1 border-t border-gray-200",children:"Remove Color"})]})]}),a.jsx("div",{className:"w-px h-6 bg-gray-300 mx-1"}),a.jsx("button",{onClick:()=>u.chain().focus().toggleBulletList().run(),className:`p-2 rounded-lg hover:bg-gray-100 ${u.isActive("bulletList")?"bg-blue-100 text-blue-700":"text-gray-600"}`,title:"Bullet List",children:a.jsx(W0,{className:"h-4 w-4"})}),a.jsx("button",{onClick:()=>u.chain().focus().toggleOrderedList().run(),className:`p-2 rounded-lg hover:bg-gray-100 ${u.isActive("orderedList")?"bg-blue-100 text-blue-700":"text-gray-600"}`,title:"Numbered List",children:a.jsx(z0,{className:"h-4 w-4"})}),(u.isActive("bulletList")||u.isActive("orderedList"))&&a.jsxs(a.Fragment,{children:[a.jsx("button",{onClick:()=>u.chain().focus().sinkListItem("listItem").run(),disabled:!u.can().sinkListItem("listItem"),className:`p-2 rounded-lg hover:bg-gray-100 text-gray-600 ${u.can().sinkListItem("listItem")?"":"opacity-50 cursor-not-allowed"}`,title:"Indent List Item (Tab)",children:"→"}),a.jsx("button",{onClick:()=>u.chain().focus().liftListItem("listItem").run(),disabled:!u.can().liftListItem("listItem"),className:`p-2 rounded-lg hover:bg-gray-100 text-gray-600 ${u.can().liftListItem("listItem")?"":"opacity-50 cursor-not-allowed"}`,title:"Outdent List Item (Shift+Tab)",children:"←"})]}),a.jsx("button",{onClick:()=>u.chain().focus().toggleBlockquote().run(),className:`p-2 rounded-lg hover:bg-gray-100 ${u.isActive("blockquote")?"bg-blue-100 text-blue-700":"text-gray-600"}`,title:"Quote",children:a.jsx(Y0,{className:"h-4 w-4"})}),a.jsx("button",{onClick:()=>u.chain().focus().toggleCodeBlock().run(),className:`p-2 rounded-lg hover:bg-gray-100 ${u.isActive("codeBlock")?"bg-blue-100 text-blue-700":"text-gray-600"}`,title:"Code Block",children:a.jsx(O0,{className:"h-4 w-4"})}),a.jsx("div",{className:"w-px h-6 bg-gray-300 mx-1"}),a.jsx("button",{onClick:f,className:"p-2 rounded-lg hover:bg-gray-100 text-gray-600",title:"Add Link",children:a.jsx(U0,{className:"h-4 w-4"})}),a.jsx("button",{onClick:h,className:"p-2 rounded-lg hover:bg-gray-100 text-gray-600",title:"Add Image",children:a.jsx(_s,{className:"h-4 w-4"})}),a.jsx("div",{className:"w-px h-6 bg-gray-300 mx-1"}),a.jsx(DE,{onUploadComplete:p,onUploadError:m,accept:"image/*,.pdf,.txt,.doc,.docx",folder:"articles",className:"p-2 rounded-lg hover:bg-gray-100 text-gray-600",useResumable:!0,articleId:s,children:a.jsx(rt,{className:"h-4 w-4",title:"Upload File"})}),a.jsx("div",{className:"w-px h-6 bg-gray-300 mx-1"}),a.jsx("button",{onClick:()=>u.chain().focus().undo().run(),disabled:!u.can().undo(),className:"p-2 rounded-lg hover:bg-gray-100 text-gray-600 disabled:opacity-50",title:"Undo",children:a.jsx(ex,{className:"h-4 w-4"})}),a.jsx("button",{onClick:()=>u.chain().focus().redo().run(),disabled:!u.can().redo(),className:"p-2 rounded-lg hover:bg-gray-100 text-gray-600 disabled:opacity-50",title:"Redo",children:a.jsx(J0,{className:"h-4 w-4"})})]}),a.jsx("div",{className:"flex-1 overflow-y-auto p-4",style:{scrollBehavior:"smooth"},children:a.jsx(Vj,{editor:u,className:"prose prose-lg max-w-none focus:outline-none min-h-[300px]",style:{fontSize:"16px",lineHeight:"18.4px"}})})]})};function $E(r){if(!r)return r;const e=of(r);return e.querySelectorAll("img[data-caption]").forEach(s=>{const n=s.getAttribute("data-caption");if(n&&n.trim()){const i=document.createElement("figure");i.className="image-figure-container",i.style.cssText="margin: 16px auto; text-align: center; display: block;";const o=document.createElement("figcaption");o.className="image-caption-text",o.style.cssText=`
        margin-top: 12px;
        margin-bottom: 16px;
        font-size: 0.875rem;
        color: #6b7280;
        font-style: italic;
        line-height: 1.5;
        text-align: center;
        max-width: 600px;
        margin-left: auto;
        margin-right: auto;
        padding: 0 20px;
        box-sizing: border-box;
        font-family: inherit;
      `.replace(/\s+/g," ").trim(),o.textContent=n.trim();const l=s.cloneNode(!0);l.removeAttribute("data-caption"),s.parentNode&&(i.appendChild(l),i.appendChild(o),s.parentNode.replaceChild(i,s))}}),e.innerHTML}function Um(r){const e=$E(r),t=of(e);return t.querySelectorAll("figure.image-figure-container").forEach(n=>{const i=n.querySelector("img"),o=n.querySelector("figcaption");if(i&&o){const l=i.getAttribute("data-layout");l==="outset"?o.style.maxWidth="500px":l==="full-screen"&&(o.style.maxWidth="800px")}}),t.innerHTML}const Yu=r=>{try{let n=(decodeURIComponent(r).split("/").pop()||"").split("?")[0].replace(/^temp_/,"");const i=n.split("_");if(i.length>=2){const o=i[i.length-1];if(/^\d{13,}\.[\w]+$/.test(o)){let d=i.slice(0,-1).join("_");const u=o.split(".").pop();return d=d.replace(/_/g," ").replace(/\s+/g," ").trim(),`${d}.${u}`}}return n.replace(/_/g," ").replace(/\s+/g," ").trim()||"Download"}catch(e){return console.error("Error extracting filename:",e),"Download"}},Ju=()=>{var at,pt;const{id:r}=Pl(),e=Tt(),{userProfile:t,isInfoWriter:s,isAdmin:n}=ve(),i=r!=="new",[o,l]=b.useState(!1),[c,d]=b.useState(!1),[u,h]=b.useState(!1),[f,p]=b.useState({title:"",content:"",excerpt:"",status:"draft",categories:[],tags:[],coverImage:"",attachments:[]}),[m,g]=b.useState(!1),[y,x]=b.useState(0),[N,A]=b.useState(!1),[S,k]=b.useState(""),[R,j]=b.useState(!1),[w,v]=b.useState(""),[D,C]=b.useState(""),[P,O]=b.useState(""),[W,H]=b.useState("upload"),[I,E]=b.useState(""),[F,U]=b.useState(!1),[L,_]=b.useState(!1),[Y,Z]=b.useState(!1),[J,te]=b.useState({title:"",content:"",category:"",tags:""}),be=["Technology","Programming","Web Development","Mobile Development","Data Science","AI & Machine Learning","DevOps","Cybersecurity","UI/UX Design","Business","Tutorials","News & Updates","Other"];b.useEffect(()=>{i||setTimeout(()=>{ca.getAllDrafts().some(B=>{const q=!r||B.id!==r,re=B.content.trim().length>50,ye=Date.now()-B.lastModified.getTime()<7*24*60*60*1e3;return q&&re&&ye})&&!i&&g(!0)},1e3)},[i,r]),b.useEffect(()=>{var M,B;if(!t)return;const T=JSON.stringify({title:f.title||"",content:f.content||"",excerpt:f.excerpt||"",categories:f.categories||[],tags:f.tags||[],coverImage:f.coverImage||""})!==S&&(((M=f.title)==null?void 0:M.trim())||((B=f.content)==null?void 0:B.trim()));A(T)},[f,S,t]),b.useEffect(()=>{if(!t||!f.title&&!f.content)return;const $={title:f.title||"",content:f.content||"",excerpt:f.excerpt||"",categories:f.categories||[],tags:f.tags||[],coverImage:f.coverImage||""};($.title.trim()||$.content.trim())&&ca.saveDraft(r==="new"?null:r,$)},[f,t,r]),b.useEffect(()=>{const $=T=>{if(N)return T.preventDefault(),T.returnValue="You have unsaved changes. Are you sure you want to leave?",T.returnValue};return window.addEventListener("beforeunload",$),()=>window.removeEventListener("beforeunload",$)},[N]);const ht=async $=>{if(Y)return K.error("Please wait for all file uploads to complete before leaving this page."),!1;if(N)return j(!0),!1;if(r==="new"&&t)try{await ge.cleanupTempFiles(t.uid),console.log("🧹 Cleaned up temp files on navigation")}catch(T){console.error("Error cleaning up temp files:",T)}return e($||-1),!0},Fr=$=>{var T;p({title:$.title||"",content:$.content||"",excerpt:$.excerpt||"",status:"draft",categories:$.categories||[],tags:$.tags||[],coverImage:$.coverImage||"",attachments:[]}),v(((T=$.categories)==null?void 0:T[0])||""),g(!1),K.success("Draft recovered successfully!")},Br=()=>{if(D.trim()&&f.tags&&f.tags.length<4){const $=D.trim();f.tags.includes($)||p(T=>({...T,tags:[...T.tags||[],$]})),C("")}else f.tags&&f.tags.length>=4&&K.error("Maximum 4 tags allowed")},en=$=>{p(T=>{var M;return{...T,tags:((M=T.tags)==null?void 0:M.filter(B=>B!==$))||[]}})},Es=$=>{v($),p(T=>({...T,categories:$==="Other"?[]:$?[$]:[]})),$!=="Other"&&O("")},tn=async $=>{p(T=>({...T,coverImage:$.url})),U(!1),K.success("Cover image uploaded successfully")};b.useEffect(()=>{const $=setInterval(()=>{const M=ge.getActiveUploads().length>0;Z(M),M&&!L&&_(!0)},1e3);return()=>clearInterval($)},[L]),b.useEffect(()=>{const $=M=>{const{url:B,context:q}=M.detail;(q==null?void 0:q.type)==="cover"&&(q==null?void 0:q.articleId)===r&&(p(re=>({...re,coverImage:B})),K.success("Cover image uploaded successfully"))};return(()=>{var B;const M=localStorage.getItem("completed_cover_upload");if(M)try{const q=JSON.parse(M);((B=q.context)==null?void 0:B.articleId)===r&&Date.now()-q.timestamp<3e5&&(p(re=>({...re,coverImage:q.url})),K.success("Cover image uploaded successfully"),localStorage.removeItem("completed_cover_upload"))}catch(q){console.error("Error processing completed cover upload:",q)}})(),window.addEventListener("coverUploadCompleted",$),()=>{window.removeEventListener("coverUploadCompleted",$)}},[r]);const lr=()=>{const $=I.trim();if(!$){K.error("Please enter an image URL");return}try{const T=new URL($);if(!["http:","https:"].includes(T.protocol)){K.error("Please enter a valid HTTP or HTTPS URL");return}}catch{K.error("Please enter a valid URL");return}p(T=>({...T,coverImage:$})),E(""),K.success("Cover image URL added successfully")},Gt=async()=>{const $=f.coverImage;if(p(T=>({...T,coverImage:""})),E(""),$)try{const T=Jl($);T&&T.startsWith("articles/")&&(await Gl(T),console.log("✅ Deleted removed cover image:",T))}catch(T){console.error("⚠️ Failed to delete removed cover image:",T)}},ot=$=>{p(T=>({...T,attachments:[...T.attachments||[],$.url]})),K.success("File attached successfully")},ft=async($,T)=>{if(t)try{await ge.updatePendingUploadsWithArticleId($),await ge.cleanupUnusedFiles(t.uid,$,T.content||"",T.coverImage,T.attachments),console.log(`✅ File organization completed for article: ${$}`)}catch(M){console.error("Error handling file uploads for new article:",M)}};b.useEffect(()=>{if(t){if(!s&&!n){K.error("You need InfoWriter or Admin privileges to create or edit articles"),e("/dashboard");return}i&&r&&Ur(r)}},[r,i,s,n,e,t]);const Ur=async $=>{var T;l(!0);try{const M=await Fo($);if(M){if(M.authorId!==(t==null?void 0:t.uid)){K.error("You can only edit your own articles"),e("/my-articles");return}if(M.status==="archive"){K.error("Archived articles cannot be edited"),e("/my-articles");return}p(M),v(((T=M.categories)==null?void 0:T[0])||"")}else K.error("Article not found"),e("/my-articles")}catch{K.error("Error loading article"),e("/my-articles")}finally{l(!1)}},ne=$=>{const M=_i($).split(/\s+/).filter(q=>q.length>0),B=70;return M.length<=B?M.join(" "):M.slice(0,B).join(" ")+"..."},ie=()=>{r&&r!=="new"&&ca.deleteDraft(r)},Re=()=>{p({title:"",content:"",excerpt:"",status:"draft",categories:[],tags:[],coverImage:"",attachments:[]}),v(""),O(""),C(""),E(""),x($=>$+1),te({title:"",content:"",category:"",tags:""}),k(""),A(!1)},oe=async($="draft")=>{var B,q,re;if(!t){K.error("User authentication error. Please refresh and try again.");return}if(Y){K.error("Please wait for all file uploads to complete before saving.");return}if(!((B=f.title)!=null&&B.trim())){K.error("Article title is required");return}te({title:"",content:"",category:"",tags:""});const T={title:"",content:"",category:"",tags:""};let M=!1;if((q=f.title)!=null&&q.trim()||(T.title="This field is required",M=!0),(re=f.content)!=null&&re.trim()||(T.content="This field is required",M=!0),w?w==="Other"&&!P.trim()&&(T.category="Please enter your custom category",M=!0):(T.category="Please select a category",M=!0),(!f.tags||f.tags.length===0)&&(T.tags="At least one tag is required",M=!0),M){te(T),K.error("Please fill in all required fields");return}if(!t.uid){K.error("User authentication error. Please refresh and try again.");return}if(!t.displayName&&!t.email){K.error("User profile incomplete. Please update your profile.");return}d(!0);try{const ye=new Date,je={...f,status:$,excerpt:f.excerpt||ne(f.content),authorId:t.uid,authorName:t.displayName||t.email,publishedAt:$==="published"&&!f.publishedAt?ye:f.publishedAt,updatedAt:ye};if(i&&r){if(await _o(r,je),t)try{await ge.cleanupUnusedFiles(t.uid,r,je.content||"",je.coverImage,je.attachments),console.log("🧹 Cleaned up unused files after article update")}catch(Yt){console.error("Error cleaning up unused files:",Yt)}if(K.success(`Article ${$==="published"?"published":$==="archive"?"archived":"saved"} successfully`),k(JSON.stringify({title:je.title||"",content:je.content||"",excerpt:je.excerpt||"",categories:je.categories||[],tags:je.tags||[],coverImage:je.coverImage||""})),$==="published"){ie(),Re(),e(n?"/personal-dashboard":"/dashboard");return}if($==="archive"){e("/my-articles?status=archive");return}if($==="draft"){e(n?"/personal-dashboard":"/dashboard");return}}else{const Yt=await Oh(je);await ft(Yt,je),K.success(`Article ${$==="published"?"published":$==="archive"?"archived":"created"} successfully`),k(JSON.stringify({title:je.title||"",content:je.content||"",excerpt:je.excerpt||"",categories:je.categories||[],tags:je.tags||[],coverImage:je.coverImage||""})),$==="published"&&ie(),Re(),e($==="draft"?n?"/personal-dashboard":"/dashboard":$==="archive"?"/my-articles?status=archive":"/article/new")}p(Yt=>({...Yt,status:$}))}catch(ye){console.error("Error saving article:",ye),K.error("Error saving article. Please try again.")}finally{d(!1)}};if(o||!t)return a.jsx("div",{className:"flex items-center justify-center min-h-64",children:a.jsx("div",{className:"animate-spin h-8 w-8 border-2 border-blue-500 border-t-transparent rounded-full"})});const we=()=>a.jsxs(a.Fragment,{children:[a.jsx("style",{children:`
        /* Typography styles for preview mode */
        .article-content h1 {
          font-size: 32px !important;
          font-weight: bold !important;
          margin: 16px 0 8px 0 !important;
          line-height: 48px !important;
        }
        .article-content h3 {
          font-size: 24px !important;
          font-weight: 600 !important;
          margin: 12px 0 6px 0 !important;
          line-height: 27.6px !important;
        }
        .article-content p {
          font-size: 16px !important;
          line-height: 18.4px !important;
          margin: 8px 0 !important;
        }
        .article-content {
          font-size: 16px !important;
          line-height: 18.4px !important;
        }
        /* List styles for preview mode */
        .article-content ul, .article-content ol {
          font-size: 16px !important;
          line-height: 18.4px !important;
          margin: 8px 0 !important;
          padding-left: 24px !important;
        }
        .article-content ul li, .article-content ol li {
          font-size: 16px !important;
          line-height: 18.4px !important;
          margin: 2px 0 !important;
          padding-left: 4px !important;
          position: relative !important;
          display: list-item !important;
          box-sizing: border-box !important;
          min-height: 1.2em !important;
        }
        .article-content ul {
          list-style-type: disc !important;
          position: relative !important;
          display: block !important;
          box-sizing: border-box !important;
        }
        .article-content ol {
          list-style-type: decimal !important;
          position: relative !important;
          display: block !important;
          box-sizing: border-box !important;
        }
        /* Stable list positioning for preview */
        .article-content ul, .article-content ol {
          transform: translateZ(0) !important;
          backface-visibility: hidden !important;
        }
        .article-content li {
          transform: translateZ(0) !important;
          backface-visibility: hidden !important;
        }
        .article-content li p {
          margin: 0 !important;
          padding: 0 !important;
          display: inline !important;
        }
        /* Custom Image Layout Styles for Preview */
        .article-content .custom-image {
          cursor: pointer;
          border-radius: 8px;
          transition: all 0.2s ease;
          height: auto;
        }

        /* Full Column Width Layout */
        .article-content .image-full-column {
          max-width: 100%;
          width: auto;
          display: block;
          margin: 16px auto;
        }

        /* Outset Layout - extends beyond column boundaries */
        .article-content .image-outset {
          max-width: 120%;
          width: auto;
          display: block;
          margin: 16px auto;
          margin-left: -10%;
          margin-right: -10%;
        }

        /* Full Screen Width Layout */
        .article-content .image-full-screen {
          width: 100vw;
          max-width: none;
          display: block;
          margin: 16px 0;
          margin-left: calc(-50vw + 50%);
          margin-right: calc(-50vw + 50%);
          padding: 0 20px;
          box-sizing: border-box;
        }

        /* Image Grid Layouts */
        .article-content .image-grid-item {
          display: inline-block;
          margin: 4px;
          border-radius: 8px;
          vertical-align: top;
        }

        /* 2-image grid */
        .article-content .image-grid-item:nth-child(2n) {
          width: calc(50% - 8px);
        }

        /* 3-image grid */
        .article-content .image-grid-item:nth-child(3n) {
          width: calc(33.333% - 8px);
        }

        /* 4+ image grid */
        .article-content .image-grid-item:nth-child(4n) {
          width: calc(25% - 8px);
        }

        /* Grid container */
        .article-content .image-grid-container {
          display: flex;
          flex-wrap: wrap;
          gap: 8px;
          margin: 16px 0;
          justify-content: center;
        }

        /* Responsive grid adjustments */
        @media (max-width: 768px) {
          .article-content .image-outset {
            max-width: 100%;
            margin-left: 0;
            margin-right: 0;
          }

          .article-content .image-full-screen {
            width: 100%;
            margin-left: 0;
            margin-right: 0;
            padding: 0;
          }

          .article-content .image-grid-item:nth-child(n) {
            width: calc(50% - 8px);
          }
        }

        @media (max-width: 480px) {
          .article-content .image-grid-item:nth-child(n) {
            width: 100%;
            margin: 4px 0;
          }
        }

        /* Image Caption Styles for Preview - now handled by JavaScript processor */
        .article-content .image-figure-container {
          margin: 16px auto !important;
          text-align: center !important;
          display: block !important;
        }

        .article-content .image-caption-text {
          margin-top: 12px !important;
          margin-bottom: 16px !important;
          font-size: 0.875rem !important;
          color: #6b7280 !important;
          font-style: italic !important;
          line-height: 1.5 !important;
          text-align: center !important;
          max-width: 600px !important;
          margin-left: auto !important;
          margin-right: auto !important;
          padding: 0 20px !important;
          box-sizing: border-box !important;
          font-family: inherit !important;
        }

        /* Enhanced text content styling for preview */
        .article-content {
          color: #374151;
          line-height: 1.75;
          max-width: none;
          margin: 0 auto;
        }

        .article-content p {
          margin-top: 1.25em !important;
          margin-bottom: 1.25em !important;
          color: #374151 !important;
          text-align: left !important;
          font-size: 16px !important;
          line-height: 1.75 !important;
        }

        .article-content h1, .article-content h2, .article-content h3, .article-content h4, .article-content h5, .article-content h6 {
          color: #111827 !important;
          font-weight: 600 !important;
          line-height: 1.25 !important;
          margin-top: 2em !important;
          margin-bottom: 1em !important;
        }

        .article-content ul, .article-content ol {
          margin-top: 1.25em !important;
          margin-bottom: 1.25em !important;
          padding-left: 1.625em !important;
          color: #374151 !important;
        }

        .article-content li {
          margin-top: 0.5em !important;
          margin-bottom: 0.5em !important;
        }

        .article-content blockquote {
          font-style: italic !important;
          border-left: 4px solid #e5e7eb !important;
          padding-left: 1em !important;
          margin: 1.6em 0 !important;
          color: #6b7280 !important;
        }

        .article-content code {
          background-color: #f3f4f6 !important;
          padding: 0.125em 0.25em !important;
          border-radius: 0.25em !important;
          font-size: 0.875em !important;
          color: #dc2626 !important;
        }

        .article-content pre {
          background-color: #1f2937 !important;
          color: #f9fafb !important;
          padding: 1em !important;
          border-radius: 0.5em !important;
          overflow-x: auto !important;
          margin: 1.5em 0 !important;
        }

        .article-content pre code {
          background-color: transparent !important;
          color: inherit !important;
          padding: 0 !important;
        }

        .article-content a {
          color: #2563eb !important;
          text-decoration: underline !important;
        }

        .article-content a:hover {
          color: #1d4ed8 !important;
        }

        .article-content strong {
          font-weight: 600 !important;
          color: #111827 !important;
        }

        .article-content em {
          font-style: italic !important;
        }

        /* Legacy image styles for backward compatibility */
        .article-content img:not(.custom-image) {
          border-radius: 8px;
          max-width: 100%;
          height: auto;
          display: block;
          margin: 8px auto;
        }
        .article-content img[style*="float: left"] {
          float: left !important;
          margin: 0 16px 8px 0 !important;
          max-width: 50% !important;
          display: inline !important;
        }
        .article-content img[style*="float: right"] {
          float: right !important;
          margin: 0 0 8px 16px !important;
          max-width: 50% !important;
          display: inline !important;
        }
        .article-content img[style*="margin: 16px auto"] {
          display: block !important;
          margin: 16px auto !important;
          max-width: 100% !important;
          float: none !important;
        }
        /* Clear floats after images */
        .article-content::after {
          content: "";
          display: table;
          clear: both;
        }
      `}),a.jsxs("div",{className:"max-w-4xl mx-auto bg-white rounded-2xl shadow-lg overflow-hidden",children:[f.coverImage&&a.jsx("div",{className:"w-full h-64 md:h-80 overflow-hidden",children:a.jsx("img",{src:f.coverImage,alt:"Cover",className:"w-full h-full object-cover"})}),a.jsx(af,{isOpen:L,onClose:()=>_(!1),articleId:r!=="new"?r:void 0}),Y&&a.jsx("div",{className:"bg-yellow-50 border-l-4 border-yellow-400 p-4 mx-8 mt-4",children:a.jsxs("div",{className:"flex items-center",children:[a.jsx("div",{className:"flex-shrink-0",children:a.jsx(rt,{className:"h-5 w-5 text-yellow-400 animate-pulse"})}),a.jsx("div",{className:"ml-3",children:a.jsxs("p",{className:"text-sm text-yellow-700",children:[a.jsx("strong",{children:"Files are uploading..."})," Please wait for all uploads to complete before saving or leaving this page."]})})]})}),a.jsxs("div",{className:"p-8",children:[a.jsx("h1",{className:"text-4xl font-bold text-gray-900 mb-4",children:f.title||"Untitled Article"}),a.jsxs("div",{className:"flex flex-wrap items-center gap-4 mb-6",children:[w&&a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(Mi,{className:"h-4 w-4 text-blue-600"}),a.jsx("span",{className:"bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-medium",children:w})]}),f.tags&&f.tags.length>0&&a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(hs,{className:"h-4 w-4 text-purple-600"}),a.jsx("div",{className:"flex flex-wrap gap-2",children:f.tags.map(($,T)=>a.jsx("span",{className:"bg-purple-100 text-purple-800 px-2 py-1 rounded-full text-xs font-medium",children:$},T))})]})]}),a.jsx("div",{className:"max-w-4xl mx-auto px-6",children:a.jsx("div",{className:"prose prose-lg max-w-none article-content",dangerouslySetInnerHTML:{__html:Um(f.content||"<p>Start writing your article...</p>")}})}),f.tags&&f.tags.length>0&&a.jsx("div",{className:"mt-8 pt-6 border-t border-gray-200",children:a.jsx("div",{className:"flex flex-wrap gap-2",children:f.tags.map(($,T)=>a.jsxs("span",{className:"bg-gray-100 text-gray-700 px-3 py-1 rounded-full text-sm hover:bg-gray-200 transition-colors",children:["#",$]},T))})}),f.attachments&&f.attachments.length>0&&a.jsxs("div",{className:"mt-8 pt-6 border-t border-gray-200",children:[a.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[a.jsx(Jc,{className:"h-5 w-5 mr-2"}),"Attachments"]}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:f.attachments.map(($,T)=>a.jsxs("a",{href:$,target:"_blank",rel:"noopener noreferrer",className:"flex items-center p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",children:[a.jsx(gt,{className:"h-5 w-5 text-gray-600 mr-3"}),a.jsx("span",{className:"text-sm text-gray-700 truncate",children:Yu($)||`Attachment ${T+1}`})]},T))})]})]})]})]});return a.jsxs("div",{className:"max-w-6xl mx-auto space-y-6",children:[m&&a.jsx(_b,{onRecover:Fr,onDismiss:()=>g(!1),currentArticleId:r==="new"?void 0:r}),a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx("button",{onClick:()=>ht("/dashboard"),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",title:"Back to Dashboard",children:a.jsx(Lt,{className:"h-5 w-5 text-gray-600"})}),a.jsxs("button",{onClick:()=>ht("/my-articles"),className:"flex items-center space-x-2 text-gray-600 hover:text-gray-900 transition-colors",children:[a.jsx(gt,{className:"h-4 w-4"}),a.jsx("span",{children:"Back to Articles"})]})]}),a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsxs("button",{onClick:()=>h(!u),className:`flex items-center space-x-2 px-4 py-2 rounded-lg transition-colors ${u?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-100 hover:bg-gray-200 text-gray-700"}`,children:[u?a.jsx(zs,{className:"h-4 w-4"}):a.jsx(us,{className:"h-4 w-4"}),a.jsx("span",{children:u?"Edit Mode":"Preview"})]}),a.jsxs("button",{onClick:()=>oe("draft"),disabled:c||Y,className:"flex items-center space-x-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors disabled:opacity-50",title:Y?"Please wait for uploads to complete":"",children:[a.jsx(Sh,{className:"h-4 w-4"}),a.jsx("span",{children:c?"Saving...":"Save Draft"})]}),a.jsxs("button",{onClick:()=>oe("archive"),disabled:c||Y,className:"flex items-center space-x-2 px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition-colors disabled:opacity-50",title:Y?"Please wait for uploads to complete":"",children:[a.jsx(gt,{className:"h-4 w-4"}),a.jsx("span",{children:"Archive"})]}),a.jsxs("button",{onClick:()=>oe("published"),disabled:c||Y,className:"flex items-center space-x-2 px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors disabled:opacity-50",title:Y?"Please wait for uploads to complete":"",children:[a.jsx(Sn,{className:"h-4 w-4"}),a.jsx("span",{children:"Publish"})]})]})]}),u?a.jsx(we,{}):a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[a.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[a.jsxs("div",{className:"bg-white rounded-2xl p-6 border border-gray-200",children:[a.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[a.jsx(_s,{className:"h-5 w-5 mr-2"}),"Cover Image (Optional)"]}),f.coverImage?a.jsxs("div",{className:"relative",children:[a.jsx("img",{src:f.coverImage,alt:"Cover",className:"w-full h-48 object-cover rounded-lg"}),a.jsx("button",{onClick:Gt,className:"absolute top-2 right-2 p-1 bg-red-600 text-white rounded-full hover:bg-red-700 transition-colors",children:a.jsx(et,{className:"h-4 w-4"})})]}):a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex space-x-1 bg-gray-100 rounded-lg p-1",children:[a.jsx("button",{onClick:()=>H("upload"),className:`flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors ${W==="upload"?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:"📁 Upload File"}),a.jsx("button",{onClick:()=>H("url"),className:`flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors ${W==="url"?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:"🔗 Image URL"})]}),W==="upload"&&a.jsx(Rl,{onUploadComplete:tn,onUploadError:$=>K.error($),accept:"image/*",useResumable:!0,articleId:r==="new"?void 0:r,className:"border-2 border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-blue-400 transition-colors",children:a.jsxs("div",{className:"flex flex-col items-center",children:[a.jsx(_s,{className:"h-12 w-12 text-gray-400 mb-4"}),a.jsx("p",{className:"text-gray-600 mb-2",children:"Click to upload cover image"}),a.jsx("p",{className:"text-sm text-gray-500",children:"PNG, JPG, GIF up to 10MB"})]})}),W==="url"&&a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"flex space-x-2",children:[a.jsx("input",{type:"url",value:I,onChange:$=>E($.target.value),placeholder:"Enter image URL (https://...)",className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),a.jsx("button",{onClick:lr,disabled:!I.trim(),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Add"})]}),I.trim()&&a.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[a.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Preview:"}),a.jsx("img",{src:I,alt:"Preview",className:"w-full h-32 object-cover rounded-lg",onError:$=>{$.currentTarget.style.display="none",$.currentTarget.nextElementSibling.style.display="block"}}),a.jsxs("div",{className:"hidden text-center py-8 text-gray-500",children:[a.jsx(_s,{className:"h-8 w-8 mx-auto mb-2 text-gray-400"}),a.jsx("p",{className:"text-sm",children:"Invalid image URL"})]})]})]})]})]}),a.jsxs("div",{className:"bg-white rounded-2xl p-6 border border-gray-200",children:[a.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Article Title"," ",a.jsx("span",{className:"text-s text-red-500 mr-0",children:"*"})]}),a.jsx("input",{type:"text",value:f.title||"",onChange:$=>p(T=>({...T,title:$.target.value})),onFocus:()=>te($=>({...$,title:""})),placeholder:"Article title...",className:`w-full text-3xl font-bold border-none outline-none bg-transparent placeholder-gray-400 resize-none ${J.title?"border-b-2 border-red-500":""}`,style:{minHeight:"1.2em"}}),J.title&&a.jsxs("p",{className:"text-red-500 text-sm mt-1 flex items-center",children:[a.jsx("span",{className:"mr-1",children:"⚠️"}),J.title]})]}),a.jsxs("div",{className:`bg-white rounded-2xl border overflow-hidden ${J.content?"border-red-500":"border-gray-200"}`,children:[a.jsxs("div",{className:"p-4 border-b border-gray-200",children:[a.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[a.jsx(gt,{className:"h-5 w-5 mr-2"}),"Article Content"," ",a.jsx("span",{className:"text-s text-red-500 mr-0",children:"*"})]}),J.content&&a.jsxs("p",{className:"text-red-500 text-sm mt-1 flex items-center",children:[a.jsx("span",{className:"mr-1",children:"⚠️"}),J.content]})]}),a.jsx("div",{className:"p-6",children:a.jsx(LE,{content:f.content||"",onChange:$=>{p(T=>({...T,content:$})),J.content&&te(T=>({...T,content:""}))},placeholder:"Start writing your article...",articleId:r!=="new"?r:void 0},y)})]})]}),a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:`bg-white rounded-2xl p-6 border ${J.category?"border-red-500":"border-gray-200"}`,children:[a.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[a.jsx(Mi,{className:"h-5 w-5 mr-2"}),"Category ",a.jsx("span",{className:"text-s text-red-500 mr-0",children:"*"})]}),a.jsxs("select",{value:w,onChange:$=>{Es($.target.value),J.category&&te(T=>({...T,category:""}))},className:`w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${J.category?"border-red-500":"border-gray-300"}`,children:[a.jsx("option",{value:"",children:"Select a category..."}),be.map($=>a.jsx("option",{value:$,children:$},$))]}),w==="Other"&&a.jsxs("div",{className:"mt-3",children:[a.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Enter Custom Category"," ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsx("input",{type:"text",value:P,onChange:$=>{O($.target.value),J.category&&te(T=>({...T,category:""})),p(T=>({...T,categories:[$.target.value]}))},placeholder:"Type your custom category...",className:`w-full p-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${J.category?"border-red-500":"border-gray-300"}`})]}),J.category&&a.jsxs("p",{className:"text-red-500 text-sm mt-2 flex items-center",children:[a.jsx("span",{className:"mr-1",children:"⚠️"}),J.category]}),w&&a.jsx("div",{className:"mt-3",children:a.jsxs("span",{className:"inline-flex items-center gap-1 px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm",children:[w==="Other"?P||"Other":w,a.jsx("button",{onClick:()=>Es(""),className:"hover:text-blue-600",children:a.jsx(et,{className:"h-3 w-3"})})]})})]}),a.jsxs("div",{className:`bg-white rounded-2xl p-6 border ${J.tags?"border-red-500":"border-gray-200"}`,children:[a.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[a.jsx(hs,{className:"h-5 w-5 mr-2"}),"Tags",a.jsx("span",{className:"text-s text-red-500 mr-0",children:"*"})]}),J.tags&&a.jsx("div",{className:"mb-3",children:a.jsxs("p",{className:"text-red-500 text-sm flex items-center",children:[a.jsx("span",{className:"mr-1",children:"⚠️"}),J.tags]})}),a.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:(at=f.tags)==null?void 0:at.map($=>a.jsxs("span",{className:"inline-flex items-center gap-1 px-3 py-1 bg-purple-100 text-purple-800 rounded-full text-sm",children:[$,a.jsx("button",{onClick:()=>en($),className:"hover:text-purple-600",children:a.jsx(et,{className:"h-3 w-3"})})]},$))}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx("input",{type:"text",value:D,onChange:$=>{C($.target.value),J.tags&&f.tags&&f.tags.length>0&&te(T=>({...T,tags:""}))},onKeyPress:$=>{$.key==="Enter"&&($.preventDefault(),Br())},placeholder:"Add a tag...",className:`flex-1 p-2 border rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent ${J.tags?"border-red-500":"border-gray-300"}`,disabled:f.tags&&f.tags.length>=4}),a.jsx("button",{onClick:()=>{Br(),J.tags&&D.trim()&&te($=>({...$,tags:""}))},disabled:!D.trim()||f.tags&&f.tags.length>=4,className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:a.jsx(Wa,{className:"h-4 w-4"})})]}),a.jsxs("p",{className:"text-xs text-gray-500 mt-2 flex items-center",children:[a.jsx("span",{className:"text-red-500 mr-1",children:"*"}),((pt=f.tags)==null?void 0:pt.length)||0,"/4 tags used",f.tags&&f.tags.length===0&&" - At least one tag is required"]})]}),a.jsxs("div",{className:"bg-white rounded-2xl p-6 border border-gray-200",children:[a.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[a.jsx(Jc,{className:"h-5 w-5 mr-2"}),"Attachments"]}),r==="new"?a.jsx("div",{className:"border-2 border-dashed border-yellow-300 rounded-lg p-4 text-center bg-yellow-50",children:a.jsxs("div",{className:"flex flex-col items-center",children:[a.jsx(rt,{className:"h-8 w-8 text-yellow-400 mb-2"}),a.jsx("p",{className:"text-sm text-yellow-700 mb-1 font-medium",children:"Save Article First"}),a.jsx("p",{className:"text-xs text-yellow-600",children:"Please save the article to enable file uploads"})]})}):a.jsx(Rl,{onUploadComplete:ot,onUploadError:$=>K.error($),accept:".pdf,.doc,.docx,.txt,.xls,.xlsx,.ppt,.pptx",useResumable:!0,articleId:r==="new"?void 0:r,className:"border-2 border-dashed border-gray-300 rounded-lg p-4 text-center hover:border-blue-400 transition-colors",children:a.jsxs("div",{className:"flex flex-col items-center",children:[a.jsx(rt,{className:"h-8 w-8 text-gray-400 mb-2"}),a.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Upload files"}),a.jsx("p",{className:"text-xs text-gray-500",children:"PDF, DOC, TXT, etc."})]})}),f.attachments&&f.attachments.length>0&&a.jsx("div",{className:"mt-4 space-y-2",children:f.attachments.map(($,T)=>a.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded-lg",children:[a.jsxs("div",{className:"flex items-center",children:[a.jsx(gt,{className:"h-4 w-4 text-gray-600 mr-2"}),a.jsx("span",{className:"text-sm text-gray-700 truncate",children:Yu($)||`Attachment ${T+1}`})]}),a.jsx("button",{onClick:()=>{var B;const M=((B=f.attachments)==null?void 0:B.filter((q,re)=>re!==T))||[];p(q=>({...q,attachments:M}))},className:"text-red-600 hover:text-red-800 transition-colors",children:a.jsx(Or,{className:"h-4 w-4"})})]},T))})]})]})]}),R&&a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:a.jsxs("div",{className:"bg-white rounded-lg max-w-md w-full p-6",children:[a.jsxs("div",{className:"flex items-center mb-4",children:[a.jsx(St,{className:"h-6 w-6 text-yellow-600 mr-3"}),a.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Unsaved Changes"})]}),a.jsx("p",{className:"text-gray-600 mb-6",children:"You have unsaved changes. Would you like to save them as a draft before leaving?"}),a.jsxs("div",{className:"flex items-center justify-end space-x-3",children:[a.jsx("button",{onClick:()=>j(!1),className:"px-4 py-2 text-gray-700 bg-gray-200 rounded-lg hover:bg-gray-300 transition-colors",children:"Cancel"}),a.jsx("button",{onClick:async()=>{if(j(!1),A(!1),r==="new"&&t)try{await ge.cleanupTempFiles(t.uid),console.log("🧹 Cleaned up temp files on leave without saving")}catch($){console.error("Error cleaning up temp files:",$)}e(-1)},className:"px-4 py-2 text-red-700 bg-red-100 rounded-lg hover:bg-red-200 transition-colors",children:"Leave Without Saving"}),a.jsx("button",{onClick:async()=>{j(!1),await oe("draft")},className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Save as Draft"})]})]})})]})},_E=({articleId:r,articleTitle:e,articleUrl:t,className:s="",showLabel:n=!1,size:i="md"})=>{const{userProfile:o}=ve(),[l,c]=b.useState(!1),[d,u]=b.useState(!1),h=t||`${window.location.origin}/article/${r}`,f=async g=>{try{switch(g){case"copy":{await Hh(h)?(u(!0),setTimeout(()=>u(!1),2e3),Ne.success("Link copied to clipboard!")):Ne.error("Failed to copy link");break}case"twitter":Bh(h,e);break;case"facebook":Uh(h);break;case"linkedin":zh(h,e);break;case"email":Wh(h,e);break}try{await Fh(r,g,o==null?void 0:o.uid)}catch(y){console.error("Failed to record share event (sharing still successful):",y)}c(!1)}catch(y){console.error("Error sharing article:",y),Ne.error("Failed to share article")}},p={sm:"h-4 w-4",md:"h-5 w-5",lg:"h-6 w-6"},m={sm:"p-1.5",md:"p-2",lg:"p-3"};return a.jsxs("div",{className:"relative",children:[a.jsxs("button",{onClick:()=>c(!l),className:`${m[i]} text-gray-600 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors flex items-center space-x-1 ${s}`,title:"Share Article",children:[a.jsx(Q0,{className:p[i]}),n&&a.jsx("span",{className:"text-sm",children:"Share"})]}),l&&a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>c(!1)}),a.jsx("div",{className:"absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-gray-200 z-20",children:a.jsxs("div",{className:"py-1",children:[a.jsxs("button",{onClick:()=>f("copy"),className:"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 flex items-center space-x-2",children:[d?a.jsx(Fl,{className:"h-4 w-4 text-green-600"}):a.jsx(R0,{className:"h-4 w-4"}),a.jsx("span",{children:d?"Copied!":"Copy Link"})]}),a.jsxs("button",{onClick:()=>f("twitter"),className:"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-blue-50 hover:text-blue-700 flex items-center space-x-2",children:[a.jsx(Vl,{className:"h-4 w-4"}),a.jsx("span",{children:"Share on Twitter"})]}),a.jsxs("button",{onClick:()=>f("facebook"),className:"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-blue-50 hover:text-blue-700 flex items-center space-x-2",children:[a.jsx(L0,{className:"h-4 w-4"}),a.jsx("span",{children:"Share on Facebook"})]}),a.jsxs("button",{onClick:()=>f("linkedin"),className:"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-blue-50 hover:text-blue-700 flex items-center space-x-2",children:[a.jsx(Ul,{className:"h-4 w-4"}),a.jsx("span",{children:"Share on LinkedIn"})]}),a.jsxs("button",{onClick:()=>f("email"),className:"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 flex items-center space-x-2",children:[a.jsx(Wt,{className:"h-4 w-4"}),a.jsx("span",{children:"Share via Email"})]})]})})]})]})},FE=async(r,e,t,s,n)=>{try{const i=pe(X,"articles",r,"comments"),o=new Date,l={articleId:r,userId:e,userName:t,userProfilePicture:s||null,content:n.trim(),createdAt:Le.fromDate(o),updatedAt:Le.fromDate(o),replyCount:0};console.log("Creating comment with data:",l);const c=await Ll(i,l);return console.log("Comment created successfully with ID:",c.id),c.id}catch(i){throw console.error("Error creating comment:",i),i}},BE=async(r,e,t,s,n,i)=>{try{const o=pe(X,"articles",r,"comments",e,"replies"),l={commentId:e,articleId:r,userId:t,userName:s,userProfilePicture:n||null,content:i.trim(),createdAt:Le.fromDate(new Date),updatedAt:Le.fromDate(new Date)},c=await Ll(o,l),d=ue(X,"articles",r,"comments",e);return await We(d,{replyCount:Sr(1)}),c.id}catch(o){throw console.error("Error creating reply:",o),o}},UE=async(r,e)=>{try{const t=pe(X,"articles",r,"comments",e,"replies"),n=(await vt(t)).docs.map(o=>Rt(o.ref));await Promise.all(n);const i=ue(X,"articles",r,"comments",e);await Rt(i)}catch(t){throw console.error("Error deleting comment:",t),t}},zE=async(r,e,t)=>{try{const s=ue(X,"articles",r,"comments",e,"replies",t);await Rt(s);const n=ue(X,"articles",r,"comments",e);await We(n,{replyCount:Sr(-1)})}catch(s){throw console.error("Error deleting reply:",s),s}},zm=(r,e)=>{const t=pe(X,"articles",r,"comments"),s=xe(t,Wn("createdAt","desc"));return Ee(s,n=>{console.log("Comments snapshot received:",n.docs.length,"comments");const i=[];n.docs.forEach(o=>{const l=o.data();i.push({id:o.id,articleId:l.articleId,userId:l.userId,userName:l.userName,userProfilePicture:l.userProfilePicture,content:l.content,createdAt:l.createdAt.toDate(),updatedAt:l.updatedAt.toDate(),replyCount:l.replyCount||0})}),e(i)},n=>{if(n.code==="permission-denied"){console.warn("Permission denied for comments subscription - user may not have access to this article"),e([]);return}console.error("Error in comments subscription:",n),e([])})},WE=(r,e,t)=>{const s=pe(X,"articles",r,"comments",e,"replies"),n=xe(s,Wn("createdAt","asc"));return Ee(n,i=>{const o=[];i.docs.forEach(l=>{const c=l.data();o.push({id:l.id,commentId:c.commentId,articleId:c.articleId,userId:c.userId,userName:c.userName,userProfilePicture:c.userProfilePicture,content:c.content,createdAt:c.createdAt.toDate(),updatedAt:c.updatedAt.toDate()})}),t(o)})},HE=({articleId:r,onCommentAdded:e,placeholder:t="Add a comment...",autoFocus:s=!1,className:n=""})=>{const{userProfile:i}=ve(),[o,l]=b.useState(""),[c,d]=b.useState(!1),u=b.useRef(null);b.useEffect(()=>{const p=u.current;p&&(p.style.height="auto",p.style.height=`${Math.min(p.scrollHeight,120)}px`)},[o]),b.useEffect(()=>{s&&u.current&&u.current.focus()},[s]);const h=async p=>{if(p.preventDefault(),!i){K.error("Please log in to comment");return}if(o.trim()){console.log("Submitting comment:",{articleId:r,userId:i.uid,userName:i.displayName||"Anonymous",userProfilePicture:i.profilePicture,content:o.trim()}),d(!0);try{await FE(r,i.uid,i.displayName||"Anonymous",i.profilePicture,o),l(""),K.success("Comment added!"),e==null||e()}catch(m){console.error("Error adding comment:",m),K.error("Failed to add comment")}finally{d(!1)}}},f=p=>{p.key==="Enter"&&!p.shiftKey&&(p.preventDefault(),h(p))};return i?a.jsxs("form",{onSubmit:h,className:`flex items-start space-x-3 ${n}`,children:[a.jsx("div",{className:"flex-shrink-0",children:i.profilePicture?a.jsx("img",{src:i.profilePicture,alt:i.displayName||"User",className:"w-8 h-8 rounded-full object-cover border-2 border-gray-200 hover:border-blue-300 transition-colors"}):a.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-r from-blue-500 to-purple-600 flex items-center justify-center shadow-md",children:a.jsx(_e,{className:"h-4 w-4 text-white"})})}),a.jsxs("div",{className:"flex-1 relative",children:[a.jsx("textarea",{ref:u,value:o,onChange:p=>l(p.target.value),onKeyDown:f,placeholder:t,disabled:c,className:"w-full px-4 py-3 pr-12 border border-gray-200 rounded-2xl resize-none focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-blue-300 disabled:opacity-50 disabled:cursor-not-allowed text-sm bg-gray-50/50 hover:bg-white transition-all duration-200 shadow-sm",style:{minHeight:"44px",maxHeight:"120px"}}),o.trim()&&a.jsx("button",{type:"submit",disabled:c,className:"absolute right-3 top-1/2 transform -translate-y-1/2 p-2 text-blue-600 hover:text-blue-700 hover:bg-blue-50 rounded-full disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 hover:scale-110",children:c?a.jsx("div",{className:"w-4 h-4 border-2 border-current border-t-transparent rounded-full animate-spin"}):a.jsx(Sn,{className:"h-4 w-4"})})]})]}):a.jsx("div",{className:`flex items-center justify-center p-4 bg-gray-50 rounded-lg ${n}`,children:a.jsx("p",{className:"text-gray-600 text-sm",children:"Please log in to comment"})})},VE=({articleId:r,commentId:e,onReplyAdded:t,onCancel:s,placeholder:n="Write a reply...",autoFocus:i=!0,className:o=""})=>{const{userProfile:l}=ve(),[c,d]=b.useState(""),[u,h]=b.useState(!1),f=b.useRef(null);b.useEffect(()=>{const g=f.current;g&&(g.style.height="auto",g.style.height=`${Math.min(g.scrollHeight,120)}px`)},[c]),b.useEffect(()=>{i&&f.current&&f.current.focus()},[i]);const p=async g=>{if(g.preventDefault(),!l){K.error("Please log in to reply");return}if(c.trim()){h(!0);try{await BE(r,e,l.uid,l.displayName||"Anonymous",l.profilePicture,c),d(""),K.success("Reply added!"),t==null||t()}catch(y){console.error("Error adding reply:",y),K.error("Failed to add reply")}finally{h(!1)}}},m=g=>{g.key==="Enter"&&!g.shiftKey?(g.preventDefault(),p(g)):g.key==="Escape"&&(s==null||s())};return l?a.jsx("div",{className:`mt-3 ${o}`,children:a.jsxs("form",{onSubmit:p,className:"flex items-start space-x-3",children:[a.jsx("div",{className:"flex-shrink-0",children:l.profilePicture?a.jsx("img",{src:l.profilePicture,alt:l.displayName||"User",className:"w-6 h-6 rounded-full object-cover border border-gray-200"}):a.jsx("div",{className:"w-6 h-6 rounded-full bg-gradient-to-r from-blue-500 to-purple-600 flex items-center justify-center",children:a.jsx(_e,{className:"h-3 w-3 text-white"})})}),a.jsxs("div",{className:"flex-1",children:[a.jsx("textarea",{ref:f,value:c,onChange:g=>d(g.target.value),onKeyDown:m,placeholder:n,disabled:u,className:"w-full px-3 py-2 border border-gray-200 rounded-lg resize-none focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:opacity-50 disabled:cursor-not-allowed text-sm",style:{minHeight:"36px",maxHeight:"120px"}}),a.jsxs("div",{className:"flex items-center justify-end space-x-2 mt-2",children:[a.jsx("button",{type:"button",onClick:s,className:"px-3 py-1 text-sm text-gray-600 hover:text-gray-800 transition-colors",children:"Cancel"}),a.jsx("button",{type:"submit",disabled:!c.trim()||u,className:"px-3 py-1 bg-blue-600 text-white text-sm rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:u?"Replying...":"Reply"})]})]})]})}):null},qE=({reply:r,articleId:e,onReplyDeleted:t})=>{const{userProfile:s,isAdmin:n}=ve(),[i,o]=b.useState(!1),l=s&&(s.uid===r.userId||n),c=async()=>{if(l&&window.confirm("Are you sure you want to delete this reply?")){o(!0);try{await zE(e,r.commentId,r.id),K.success("Reply deleted"),t==null||t()}catch(d){console.error("Error deleting reply:",d),K.error("Failed to delete reply")}finally{o(!1)}}};return a.jsxs("div",{className:"flex items-start space-x-3 py-3 hover:bg-gray-50/50 rounded-lg px-2 -mx-2 transition-colors duration-200",children:[a.jsx("div",{className:"flex-shrink-0",children:r.userProfilePicture?a.jsx("img",{src:r.userProfilePicture,alt:r.userName,className:"w-6 h-6 rounded-full object-cover border border-gray-200 hover:border-blue-300 transition-colors"}):a.jsx("div",{className:"w-6 h-6 rounded-full bg-gradient-to-r from-blue-500 to-purple-600 flex items-center justify-center shadow-sm",children:a.jsx(_e,{className:"h-3 w-3 text-white"})})}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[a.jsx("span",{className:"font-semibold text-sm text-gray-900 hover:text-blue-600 transition-colors cursor-pointer",children:r.userName}),a.jsxs("span",{className:"text-xs text-gray-500 bg-gray-100 px-2 py-0.5 rounded-full",children:[Ht(r.createdAt)," ago"]})]}),a.jsx("p",{className:"text-sm text-gray-800 break-words leading-relaxed",children:r.content})]}),l&&a.jsx("button",{onClick:c,disabled:i,className:"flex-shrink-0 p-1.5 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded-full transition-all duration-200 disabled:opacity-50 hover:scale-110",title:"Delete reply",children:i?a.jsx("div",{className:"w-3 h-3 border border-current border-t-transparent rounded-full animate-spin"}):a.jsx(Or,{className:"h-3 w-3"})})]})},KE=({comment:r,articleId:e,onCommentDeleted:t})=>{const{userProfile:s,isAdmin:n}=ve(),[i,o]=b.useState([]),[l,c]=b.useState(!1),[d,u]=b.useState(!1),[h,f]=b.useState(!1),[p,m]=b.useState(!1),g=s&&(s.uid===r.userId||n);b.useEffect(()=>l?(m(!0),WE(e,r.id,S=>{o(S),m(!1)})):void 0,[l,e,r.id]);const y=async()=>{if(g&&window.confirm("Are you sure you want to delete this comment and all its replies?")){f(!0);try{await UE(e,r.id),K.success("Comment deleted"),t==null||t()}catch(A){console.error("Error deleting comment:",A),K.error("Failed to delete comment")}finally{f(!1)}}},x=()=>{u(!1),l||c(!0)},N=()=>{c(!l)};return a.jsxs("div",{className:"py-4 border-b border-gray-100/60 last:border-b-0 hover:bg-gradient-to-r hover:from-blue-50/30 hover:to-purple-50/20 rounded-xl px-3 -mx-3 transition-all duration-300",children:[a.jsxs("div",{className:"flex items-start space-x-3",children:[a.jsx("div",{className:"flex-shrink-0",children:r.userProfilePicture?a.jsx("img",{src:r.userProfilePicture,alt:r.userName,className:"w-8 h-8 rounded-full object-cover border-2 border-gray-200 hover:border-blue-300 transition-colors shadow-sm"}):a.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-r from-blue-500 to-purple-600 flex items-center justify-center shadow-md hover:shadow-lg transition-shadow",children:a.jsx(_e,{className:"h-4 w-4 text-white"})})}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[a.jsx("span",{className:"font-semibold text-gray-900 hover:text-blue-600 transition-colors cursor-pointer",children:r.userName}),a.jsxs("span",{className:"text-sm text-gray-500 bg-gray-100 px-2 py-1 rounded-full",children:[Ht(r.createdAt)," ago"]})]}),a.jsx("p",{className:"text-gray-800 break-words mb-3 leading-relaxed",children:r.content}),a.jsxs("div",{className:"flex items-center space-x-4 text-sm",children:[a.jsx("button",{onClick:()=>u(!d),className:"text-gray-600 hover:text-blue-600 font-medium transition-colors hover:scale-105 transform",children:"Reply"}),r.replyCount>0&&a.jsxs("button",{onClick:N,className:"flex items-center space-x-1 text-gray-600 hover:text-blue-600 font-medium transition-all duration-200 hover:scale-105 transform",children:[a.jsx(Po,{className:"h-3 w-3"}),a.jsxs("span",{children:[r.replyCount," ",r.replyCount===1?"reply":"replies"]}),l?a.jsx(T0,{className:"h-3 w-3"}):a.jsx(Io,{className:"h-3 w-3"})]})]})]}),g&&a.jsx("button",{onClick:y,disabled:h,className:"flex-shrink-0 p-2 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded-full transition-all duration-200 disabled:opacity-50 hover:scale-110",title:"Delete comment",children:h?a.jsx("div",{className:"w-4 h-4 border border-current border-t-transparent rounded-full animate-spin"}):a.jsx(Or,{className:"h-4 w-4"})})]}),d&&a.jsx("div",{className:"ml-11 mt-3",children:a.jsx(VE,{articleId:e,commentId:r.id,onReplyAdded:x,onCancel:()=>u(!1)})}),l&&a.jsx("div",{className:"ml-11 mt-3 space-y-2",children:p?a.jsx("div",{className:"flex items-center justify-center py-4",children:a.jsx("div",{className:"w-5 h-5 border-2 border-blue-600 border-t-transparent rounded-full animate-spin"})}):i.length>0?i.map(A=>a.jsx(qE,{reply:A,articleId:e,onReplyDeleted:()=>{}},A.id)):a.jsx("p",{className:"text-sm text-gray-500 py-2",children:"No replies yet"})})]})},GE=({comments:r,articleId:e,loading:t=!1,onCommentDeleted:s})=>t?a.jsx("div",{className:"space-y-4",children:[...Array(3)].map((n,i)=>a.jsx("div",{className:"animate-pulse",children:a.jsxs("div",{className:"flex items-start space-x-3",children:[a.jsx("div",{className:"w-8 h-8 bg-gray-200 rounded-full"}),a.jsxs("div",{className:"flex-1 space-y-2",children:[a.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/4"}),a.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"})]})]})},i))}):r.length===0?a.jsxs("div",{className:"text-center py-8",children:[a.jsx(Po,{className:"h-12 w-12 text-gray-300 mx-auto mb-4"}),a.jsx("p",{className:"text-gray-500",children:"No comments yet. Be the first to comment!"})]}):a.jsx("div",{className:"space-y-0",children:r.map(n=>a.jsx(KE,{comment:n,articleId:e,onCommentDeleted:s},n.id))}),YE=({articleId:r,isOpen:e,onToggle:t,className:s=""})=>{const[n,i]=b.useState([]),[o,l]=b.useState(!0),[c,d]=b.useState(0),u=b.useRef(null);b.useEffect(()=>r?(console.log("Subscribing to comments for article:",r),l(!0),zm(r,m=>{console.log("Received comments:",m),i(m),d(m.length),l(!1)})):void 0,[r]),b.useEffect(()=>{if(e&&u.current){const g=u.current.getBoundingClientRect().top+window.pageYOffset-100;window.scrollTo({top:g,behavior:"smooth"})}},[e]);const h=()=>{},f=()=>{};return a.jsx("div",{ref:u,className:`transition-all duration-500 ease-out transform ${e?"opacity-100 max-h-screen translate-y-0 scale-100":"opacity-0 max-h-0 overflow-hidden translate-y-4 scale-95"} ${s}`,children:a.jsxs("div",{className:"bg-white/95 backdrop-blur-sm rounded-2xl border border-gray-200/50 shadow-lg shadow-gray-200/20",children:[a.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-100/80 bg-gradient-to-r from-blue-50/30 to-purple-50/30",children:[a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx("div",{className:"p-2 bg-gradient-to-r from-blue-500 to-purple-600 rounded-lg",children:a.jsx(Po,{className:"h-4 w-4 text-white"})}),a.jsxs("h3",{className:"text-lg font-semibold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:["Comments",c>0&&a.jsxs("span",{className:"ml-2 text-sm font-normal text-gray-500",children:["(",c,")"]})]})]}),a.jsx("button",{onClick:t,className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-white/60 rounded-lg transition-all duration-200 hover:scale-105",title:"Close comments",children:a.jsx(et,{className:"h-5 w-5"})})]}),a.jsx("div",{className:"p-6 border-b border-gray-100/80 bg-gradient-to-r from-gray-50/30 to-blue-50/20",children:a.jsx(HE,{articleId:r,onCommentAdded:h,placeholder:"Add a comment..."})}),a.jsx("div",{className:"p-6 max-h-96 overflow-y-auto scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100",children:a.jsx(GE,{comments:n,articleId:r,loading:o,onCommentDeleted:f})})]})})},JE=({commentCount:r,onClick:e,className:t=""})=>a.jsxs("button",{onClick:e,className:`group flex items-center space-x-2 px-3 py-2 text-gray-600 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-all duration-200 hover:scale-105 ${t}`,"data-comment-button":!0,children:[a.jsx(Po,{className:"h-4 w-4 group-hover:animate-pulse"}),a.jsx("span",{className:"text-sm font-medium",children:r>0?`${r} Comment${r!==1?"s":""}`:"Comment"})]}),XE=r=>{const[e,t]=b.useState(!1),[s,n]=b.useState(0);b.useEffect(()=>r?zm(r,d=>{n(d.length)}):void 0,[r]);const i=()=>{t(!e)},o=()=>{t(!0)},l=()=>{t(!1)};return b.useEffect(()=>{const c=d=>{const u=d.target;e&&!u.closest("[data-comment-section]")&&(u.closest("button[data-comment-button]")||l())};if(e)return document.addEventListener("mousedown",c),()=>document.removeEventListener("mousedown",c)},[e]),{isOpen:e,commentCount:s,toggle:i,open:o,close:l}},QE=r=>{try{let n=(decodeURIComponent(r).split("/").pop()||"").split("?")[0].replace(/^temp_/,"");const i=n.split("_");if(i.length>=2){const o=i[i.length-1];if(/^\d{13,}\.[\w]+$/.test(o)){let d=i.slice(0,-1).join("_");const u=o.split(".").pop();return d=d.replace(/_/g," ").replace(/\s+/g," ").trim(),`${d}.${u}`}}return n.replace(/_/g," ").replace(/\s+/g," ").trim()||"Download"}catch(e){return console.error("Error extracting filename:",e),"Download"}},ZE=()=>{var F,U,L;const{id:r}=Pl(),e=Tt();zn();const{userProfile:t,canEditArticle:s,canReadArticle:n,loading:i}=ve(),[o,l]=b.useState(null),[c,d]=b.useState(null),[u,h]=b.useState(!0),[f,p]=b.useState(!1),[m,g]=b.useState(!1),[y,x]=b.useState(0),[N,A]=b.useState(!1),[S,k]=b.useState(!1),[R,j]=b.useState(!1),[w,v]=b.useState(!1),[D,C]=b.useState(""),P=XE((o==null?void 0:o.id)||"");b.useEffect(()=>{r&&!i&&O(r)},[r,i]);const O=async _=>{var Y;h(!0);try{const Z=await Fo(_);if(Z){if(Z.status!=="published"){if(!t&&!i){K.error("Authentication required to view this article"),e("/dashboard");return}if(t&&!n(Z.status,Z.authorId)){K.error("Article not found or not accessible"),e("/dashboard");return}}if(l(Z),x(Z.likes||0),g(((Y=Z.likedBy)==null?void 0:Y.includes((t==null?void 0:t.uid)||""))||!1),!f&&Z.status==="published")try{const J=ue(X,"articles",_);await We(J,{views:Sr(1)}),p(!0)}catch(J){console.error("Error incrementing views:",J)}}else K.error("Article not found"),e("/dashboard")}catch{K.error("Error loading article"),e("/dashboard")}finally{h(!1)}};b.useEffect(()=>{if(!r)return;const _=ue(X,"articles",r),Y=Ee(_,Z=>{var J,te;if(Z.exists()){const be=Z.data(),ht={...be,createdAt:be.createdAt.toDate(),updatedAt:be.updatedAt.toDate(),publishedAt:(J=be.publishedAt)==null?void 0:J.toDate()};l(ht),x(ht.likes||0),g(((te=ht.likedBy)==null?void 0:te.includes((t==null?void 0:t.uid)||""))||!1)}else K.error("This article has been removed"),e("/dashboard")},Z=>{if(Z.code==="permission-denied"){console.warn("Permission denied for article subscription - article may be private or user not authenticated"),e("/dashboard");return}console.error("Error in article subscription:",Z),K.error("Error loading article"),e("/dashboard")});return()=>Y()},[r,t==null?void 0:t.uid]),b.useEffect(()=>{if(!(o!=null&&o.authorId))return;const _=ue(X,"users",o.authorId),Y=Ee(_,Z=>{var J,te;if(Z.exists()){const be=Z.data(),ht={uid:o.authorId,email:be.email||"",displayName:be.displayName||"",role:be.role||"user",emailVerified:be.emailVerified||!1,profilePicture:be.profilePicture||"",createdAt:(J=be.createdAt)==null?void 0:J.toDate(),updatedAt:(te=be.updatedAt)==null?void 0:te.toDate(),requestedWriterAccess:be.requestedWriterAccess||!1};d(ht)}else d(null)},Z=>{Z.code!=="permission-denied"&&console.error(`Error subscribing to author profile ${o.authorId}:`,Z),d(null)});return()=>Y()},[o==null?void 0:o.authorId]);const W=_=>t?s(_.authorId,_.status):!1,H=_=>t?t.role==="admin"||t.role==="infowriter"&&t.uid===_.authorId:!1,I=async()=>{if(!(!o||!t||!H(o))){v(!0);try{const Y=t.uid===o.authorId?"Article deleted by author":D.trim()||"Article removed by administrator",{deleteArticleByRole:Z}=await Fe(async()=>{const{deleteArticleByRole:J}=await Promise.resolve().then(()=>Ql);return{deleteArticleByRole:J}},void 0);await Z(o.id,t.role,t.uid,o.authorId,c==null?void 0:c.role,Y),K.success("Article deleted successfully"),j(!1),C(""),t.role==="admin"?e("/admin"):e("/my-articles")}catch(_){console.error("Error deleting article:",_),K.error("Failed to delete article")}finally{v(!1)}}},E=async()=>{if(!t){K.error("Please log in to like articles");return}if(!(!o||N)){A(!0);try{const _=ue(X,"articles",o.id),Y=t.uid,Z=o.likedBy||[];m?await We(_,{likes:Sr(-1),likedBy:Z.filter(J=>J!==Y)}):await We(_,{likes:Sr(1),likedBy:[...Z,Y]})}catch(_){console.error("Error toggling like:",_),K.error("Failed to update like")}finally{A(!1)}}};return u?a.jsx("div",{className:"flex items-center justify-center min-h-64",children:a.jsx("div",{className:"animate-spin h-8 w-8 border-2 border-blue-500 border-t-transparent rounded-full"})}):o?a.jsxs(a.Fragment,{children:[a.jsx("style",{children:`
        /* Custom Image Layout Styles for Article View */
        .prose .custom-image {
          cursor: pointer;
          border-radius: 8px;
          transition: all 0.2s ease;
          height: auto;
          box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .prose .custom-image:hover {
          transform: translateY(-2px);
          box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        /* Enhanced prose styling */
        .prose h2 {
          margin-top: 2.5rem;
          margin-bottom: 1.5rem;
          position: relative;
        }

        .prose h2::before {
          content: '';
          position: absolute;
          left: -1rem;
          top: 50%;
          transform: translateY(-50%);
          width: 4px;
          height: 1.5rem;
          background: linear-gradient(to bottom, #3b82f6, #8b5cf6);
          border-radius: 2px;
        }

        .prose p {
          margin-bottom: 1.5rem;
        }

        .prose ul, .prose ol {
          margin-bottom: 1.5rem;
        }

        .prose li {
          margin-bottom: 0.5rem;
        }

        /* Full Column Width Layout */
        .prose .image-full-column {
          max-width: calc(100% + 32px);
          width: auto;
          display: block;
          margin: 16px -16px;
          border-radius: 8px;
        }

        /* Outset Layout - extends beyond column boundaries */
        .prose .image-outset {
          max-width: 120%;
          width: auto;
          display: block;
          margin: 16px auto;
          margin-left: -10%;
          margin-right: -10%;
        }

        /* Full Screen Width Layout - Constrained to content area */
        .prose .image-full-screen {
          width: calc(100% + 32px);
          max-width: calc(100% + 32px);
          display: block;
          margin: 16px -16px;
          border-radius: 8px;
          box-sizing: border-box;
        }

        /* Image Grid Layouts */
        .prose .image-grid-item {
          display: inline-block;
          margin: 4px;
          border-radius: 8px;
          vertical-align: top;
        }

        /* 2-image grid */
        .prose .image-grid-item:nth-child(2n) {
          width: calc(50% - 8px);
        }

        /* 3-image grid */
        .prose .image-grid-item:nth-child(3n) {
          width: calc(33.333% - 8px);
        }

        /* 4+ image grid */
        .prose .image-grid-item:nth-child(4n) {
          width: calc(25% - 8px);
        }

        /* Grid container */
        .prose .image-grid-container {
          display: flex;
          flex-wrap: wrap;
          gap: 8px;
          margin: 16px 0;
          justify-content: center;
        }

        /* Responsive grid adjustments */
        @media (max-width: 768px) {
          .prose .image-outset {
            max-width: 100%;
            margin-left: 0;
            margin-right: 0;
          }

          .prose .image-full-screen {
            width: 100%;
            margin-left: 0;
            margin-right: 0;
            padding: 0;
          }

          .prose .image-grid-item:nth-child(n) {
            width: calc(50% - 8px);
          }
        }

        @media (max-width: 480px) {
          .prose .image-grid-item:nth-child(n) {
            width: 100%;
            margin: 4px 0;
          }
        }

        /* Professional Document Styling */
        .prose {
          font-family: 'Georgia', 'Times New Roman', serif;
          color: #1a1a1a;
          max-width: none;
          overflow-wrap: break-word;
          word-wrap: break-word;
          word-break: break-word;
        }

        .prose p {
          margin-bottom: 1.5em;
          text-align: left;
          line-height: 1.8;
          font-size: 18px;
        }

        .prose h1, .prose h2, .prose h3, .prose h4, .prose h5, .prose h6 {
          font-family: 'Helvetica Neue', 'Arial', sans-serif;
          font-weight: 600;
          color: #111827;
          margin-top: 2.5em;
          margin-bottom: 1em;
          line-height: 1.3;
        }

        .prose h1 {
          font-size: 2.25rem;
          border-bottom: 2px solid #e5e7eb;
          padding-bottom: 0.5rem;
        }

        .prose h2 {
          font-size: 1.875rem;
        }

        .prose h3 {
          font-size: 1.5rem;
        }

        .prose blockquote {
          border-left: 4px solid #3b82f6;
          padding-left: 1.5rem;
          margin: 2rem 0;
          font-style: italic;
          color: #4b5563;
          background-color: #f8fafc;
          padding: 1.5rem;
          border-radius: 0.5rem;
        }

        .prose ul, .prose ol {
          margin: 1.5rem 0;
          padding-left: 2rem;
        }

        .prose li {
          margin: 0.75rem 0;
          line-height: 1.7;
        }

        /* Image Caption Styles - now handled by JavaScript processor */
        .prose .image-figure-container {
          margin: 24px auto;
          text-align: center;
          display: block;
        }

        .prose .image-caption-text {
          margin-top: 16px;
          margin-bottom: 24px;
          font-size: 0.9rem;
          color: #6b7280;
          font-style: italic;
          line-height: 1.5;
          text-align: center;
          max-width: 700px;
          margin-left: auto;
          margin-right: auto;
          padding: 0 24px;
          box-sizing: border-box;
          font-family: 'Helvetica Neue', 'Arial', sans-serif;
        }

        /* Prose content styling for text visibility and alignment */
        .prose {
          color: #374151;
          line-height: 1.75;
          max-width: none;
          margin: 0 auto;
        }

        .prose p {
          margin-top: 1.25em;
          margin-bottom: 1.25em;
          color: #374151;
          text-align: left;
        }

        .prose h1, .prose h2, .prose h3, .prose h4, .prose h5, .prose h6 {
          color: #111827;
          font-weight: 600;
          line-height: 1.25;
          margin-top: 2em;
          margin-bottom: 1em;
        }

        .prose h1 { font-size: 2.25em; }
        .prose h2 { font-size: 1.875em; }
        .prose h3 { font-size: 1.5em; }
        .prose h4 { font-size: 1.25em; }

        .prose ul, .prose ol {
          margin-top: 1.25em;
          margin-bottom: 1.25em;
          padding-left: 1.625em;
          color: #374151;
        }

        .prose li {
          margin-top: 0.5em;
          margin-bottom: 0.5em;
        }

        .prose blockquote {
          font-style: italic;
          border-left: 4px solid #e5e7eb;
          padding-left: 1em;
          margin: 1.6em 0;
          color: #6b7280;
        }

        .prose code {
          background-color: #f3f4f6;
          padding: 0.125em 0.25em;
          border-radius: 0.25em;
          font-size: 0.875em;
          color: #dc2626;
        }

        .prose pre {
          background-color: #1f2937;
          color: #f9fafb;
          padding: 1em;
          border-radius: 0.5em;
          overflow-x: auto;
          margin: 1.5em 0;
        }

        .prose pre code {
          background-color: transparent;
          color: inherit;
          padding: 0;
        }

        .prose a {
          color: #2563eb;
          text-decoration: underline;
        }

        .prose a:hover {
          color: #1d4ed8;
        }

        .prose strong {
          font-weight: 600;
          color: #111827;
        }

        .prose em {
          font-style: italic;
        }

        /* Content Overflow Prevention */
        .prose * {
          max-width: 100%;
          overflow-wrap: break-word;
          word-wrap: break-word;
        }

        .prose img {
          max-width: 100% !important;
          height: auto !important;
          object-fit: contain;
        }

        .prose table {
          width: 100%;
          max-width: 100%;
          overflow-x: auto;
          display: block;
          white-space: nowrap;
        }

        .prose table tbody {
          display: table;
          width: 100%;
        }

        .prose pre {
          max-width: 100%;
          overflow-x: auto;
          white-space: pre-wrap;
          word-wrap: break-word;
        }

        .prose code {
          word-break: break-all;
          white-space: pre-wrap;
        }

        .prose iframe,
        .prose video,
        .prose embed,
        .prose object {
          max-width: 100% !important;
          height: auto !important;
        }

        /* Long URLs and links */
        .prose a {
          word-break: break-all;
          overflow-wrap: break-word;
        }

        /* Figure and image containers */
        .prose figure {
          max-width: 100%;
          overflow: hidden;
        }

        .prose figure img {
          max-width: 100%;
          height: auto;
        }

        /* Responsive Design for Mobile Devices */
        @media (max-width: 768px) {
          .prose {
            font-size: 16px;
            line-height: 1.7;
            overflow-x: hidden;
          }

          .prose h1 {
            font-size: 1.875rem;
          }

          .prose h2 {
            font-size: 1.5rem;
          }

          .prose h3 {
            font-size: 1.25rem;
          }

          .prose p {
            text-align: left;
            margin-bottom: 1.25em;
          }

          .prose blockquote {
            padding: 1rem;
            margin: 1.5rem 0;
          }

          .prose .image-caption-text {
            padding: 0 16px;
            font-size: 0.85rem;
          }

          .prose table {
            font-size: 14px;
            display: block;
            overflow-x: auto;
            white-space: nowrap;
            max-width: 100%;
          }

          .prose pre {
            font-size: 14px;
            padding: 0.75rem;
            overflow-x: auto;
            max-width: 100%;
          }

          .prose code {
            font-size: 13px;
            word-break: break-all;
          }
        }

        @media (max-width: 480px) {
          .prose {
            font-size: 15px;
            overflow-x: hidden;
            max-width: 100vw;
          }

          .prose h1 {
            font-size: 1.5rem;
            word-break: break-word;
          }

          .prose h2 {
            font-size: 1.25rem;
            word-break: break-word;
          }

          .prose .image-caption-text {
            padding: 0 12px;
          }

          .prose table {
            font-size: 12px;
            max-width: calc(100vw - 2rem);
          }

          .prose pre {
            font-size: 12px;
            max-width: calc(100vw - 2rem);
            padding: 0.5rem;
          }

          .prose img {
            max-width: calc(100vw - 2rem) !important;
          }

          .prose a {
            word-break: break-all;
            hyphens: auto;
          }
        }

        /* Legacy image styles for backward compatibility */
        .prose img:not(.custom-image) {
          border-radius: 8px;
          max-width: 100%;
          height: auto;
          display: block;
          margin: 12px auto;
        }
      `}),a.jsxs("div",{className:"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8",children:[a.jsxs("div",{className:"flex items-center justify-between mb-8",children:[a.jsxs("button",{onClick:()=>{window.history.length>1?e(-1):e("/")},className:"flex items-center space-x-2 text-gray-600 hover:text-gray-900 transition-colors hover:bg-gray-50 px-3 py-2 rounded-lg",children:[a.jsx(Lt,{className:"h-4 w-4"}),a.jsx("span",{children:"Back"})]}),a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx(cf,{article:o}),a.jsx(_E,{articleId:o.id,articleTitle:o.title,showLabel:!0}),W(o)&&a.jsxs(le,{to:`/article/edit/${o.id}`,className:"flex items-center space-x-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors",children:[a.jsx(Hl,{className:"h-4 w-4"}),a.jsx("span",{children:"Edit"})]}),H(o)&&a.jsxs("button",{onClick:()=>j(!0),className:"flex items-center space-x-2 px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg transition-colors",children:[a.jsx(Or,{className:"h-4 w-4"}),a.jsx("span",{children:"Delete"})]})]})]}),a.jsxs("article",{className:"bg-white/90 backdrop-blur-sm rounded-2xl overflow-hidden border border-gray-200 shadow-xl hover:shadow-2xl transition-shadow duration-300",children:[o.coverImage&&a.jsx("div",{className:"aspect-video bg-gray-100 overflow-hidden",children:a.jsx("img",{src:o.coverImage,alt:o.title,className:"w-full h-full object-cover"})}),a.jsxs("div",{className:"p-8 lg:p-12",children:[o.status!=="published"&&a.jsx("div",{className:"mb-6",children:a.jsx("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${o.status==="draft"?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:o.status==="draft"?"Draft":"Unpublished"})}),a.jsx("h1",{className:"text-5xl lg:text-6xl font-bold bg-gradient-to-r from-[#1D4ED8] via-[#7C3AED] to-[#EC4899] bg-clip-text text-transparent mb-8 leading-tight tracking-tight",children:o.title}),a.jsxs("div",{className:"flex items-start justify-between mb-8",children:[a.jsx("div",{className:"flex items-center space-x-4",children:a.jsxs(le,{to:`/author/${o.authorId}`,className:"flex items-center space-x-3 hover:bg-gray-50 rounded-lg p-2 -m-2 transition-colors group",children:[c!=null&&c.profilePicture?a.jsx("img",{src:c.profilePicture,alt:c.displayName||o.authorName,className:"w-12 h-12 rounded-full object-cover border-2 border-gray-200 group-hover:border-blue-300 transition-colors"}):a.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-r from-blue-500 to-purple-600 flex items-center justify-center group-hover:from-blue-600 group-hover:to-purple-700 transition-all",children:a.jsx(_e,{className:"h-6 w-6 text-white"})}),a.jsxs("div",{children:[a.jsx("p",{className:"font-medium text-gray-900 group-hover:text-blue-600 transition-colors",children:(c==null?void 0:c.displayName)||o.authorName}),a.jsx("p",{className:"text-sm text-gray-600 capitalize",children:c!=null&&c.role?c.role==="infowriter"||c.role==="admin"?"InfoWriter":c.role:"Author"})]})]})}),a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx(JE,{commentCount:P.commentCount,onClick:P.toggle,className:"data-comment-button"}),a.jsxs("button",{onClick:E,disabled:N,className:`flex items-center space-x-2 px-3 py-2 rounded-lg transition-colors ${m?"text-red-600 hover:text-red-700 hover:bg-red-50":"text-gray-600 hover:text-red-600 hover:bg-red-50"}`,children:[a.jsx(vh,{className:`h-4 w-4 ${m?"fill-current":""}`}),a.jsx("span",{className:"text-sm",children:y})]})]})]}),a.jsxs("div",{className:"flex flex-wrap items-center gap-6 mb-8 text-sm text-gray-600 bg-gray-50 rounded-lg p-4",children:[a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(Us,{className:"h-4 w-4"}),a.jsxs("span",{children:["Updated: ",Pi(o.updatedAt,"dd/MM/yyyy")]})]}),a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(us,{className:"h-4 w-4"}),a.jsxs("span",{children:[o.views||0," views"]})]})]}),(o.categories.length>0||o.tags.length>0)&&a.jsx("div",{className:"mb-6",children:a.jsxs("div",{className:"flex flex-wrap items-center gap-6",children:[o.categories.length>0&&a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(Mi,{className:"h-4 w-4 text-gray-500"}),a.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Categories:"})]}),a.jsx("div",{className:"flex flex-wrap gap-2",children:o.categories.map(_=>a.jsx("span",{className:"px-3 py-1 border border-[#1D4ED8] text-[#1D4ED8] rounded-full text-sm font-medium hover:text-[#1D4ED8]/80 transition-colors",children:_},_))})]}),o.tags.length>0&&a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(hs,{className:"h-4 w-4 text-gray-500"}),a.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Tags:"})]}),a.jsx("div",{className:"flex flex-wrap gap-2",children:o.tags.map(_=>a.jsxs("span",{className:"px-3 py-1 border border-[#7C3AED] text-[#7C3AED] rounded-full text-sm hover:text-[#7C3AED]/80 transition-colors",children:["#",_]},_))})]})]})}),a.jsx("div",{className:"w-full pt-4 pb-8 px-4 overflow-hidden",children:a.jsx("div",{className:"prose prose-lg max-w-none mx-auto prose-headings:text-gray-900 prose-p:text-gray-700 prose-strong:text-gray-900 prose-code:text-purple-600 prose-code:bg-purple-50 prose-pre:bg-gray-900 prose-blockquote:border-blue-500 prose-blockquote:bg-blue-50",style:{fontSize:"18px",lineHeight:"1.8",letterSpacing:"0.01em",overflowWrap:"break-word",wordWrap:"break-word",maxWidth:"100%"},dangerouslySetInnerHTML:{__html:Um(o.content)}})}),(o.attachments&&o.attachments.length>0||o.attachmentMetadata&&o.attachmentMetadata.length>0)&&a.jsxs("div",{className:"mt-8 pt-6 border-t border-gray-200",children:[a.jsxs("button",{onClick:()=>k(!S),className:"flex items-center justify-between w-full mb-4 p-2 -m-2 rounded-lg hover:bg-gray-50 focus:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 transition-all duration-200 group","aria-expanded":S,"aria-controls":"attachments-content","aria-label":`${S?"Collapse":"Expand"} attachments section`,children:[a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(gi,{className:"h-5 w-5 text-blue-600"}),a.jsxs("h3",{className:"text-lg font-semibold text-gray-900 group-hover:text-blue-700 transition-colors",children:["Attachments (",((F=o.attachmentMetadata)==null?void 0:F.length)||((U=o.attachments)==null?void 0:U.length)||0,")"]})]}),a.jsx(Io,{className:`h-5 w-5 text-gray-500 transition-transform duration-300 ease-in-out ${S?"rotate-180":"rotate-0"}`})]}),a.jsx("div",{id:"attachments-content",className:`overflow-hidden transition-all duration-300 ease-in-out ${S?"max-h-screen opacity-100":"max-h-0 opacity-0"}`,style:{transitionProperty:"max-height, opacity, margin",marginTop:"0"},children:a.jsx("div",{className:`space-y-3 transition-all duration-300 ease-in-out ${S?"pb-2 pt-1":"pb-0 pt-0"}`,children:o.attachmentMetadata&&o.attachmentMetadata.length>0?o.attachmentMetadata.map((_,Y)=>a.jsxs("a",{href:_.url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center space-x-3 p-4 bg-gradient-to-r from-blue-50 to-purple-50 hover:from-blue-100 hover:to-purple-100 rounded-xl border border-blue-100 hover:border-blue-200 transition-all duration-200 group",children:[a.jsx("div",{className:"flex-shrink-0 w-10 h-10 bg-gradient-to-r from-blue-500 to-purple-600 rounded-lg flex items-center justify-center group-hover:from-blue-600 group-hover:to-purple-700 transition-all",children:a.jsx(gi,{className:"h-5 w-5 text-white"})}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("span",{className:"text-sm font-medium text-gray-900 group-hover:text-blue-700 transition-colors block truncate",children:_.originalName}),a.jsxs("span",{className:"text-xs text-gray-500",children:[_.size?`${(_.size/1024/1024).toFixed(2)} MB • `:"","Click to download"]})]})]},Y)):(L=o.attachments)==null?void 0:L.map((_,Y)=>a.jsxs("a",{href:_,target:"_blank",rel:"noopener noreferrer",className:"flex items-center space-x-3 p-4 bg-gradient-to-r from-blue-50 to-purple-50 hover:from-blue-100 hover:to-purple-100 rounded-xl border border-blue-100 hover:border-blue-200 transition-all duration-200 group",children:[a.jsx("div",{className:"flex-shrink-0 w-10 h-10 bg-gradient-to-r from-blue-500 to-purple-600 rounded-lg flex items-center justify-center group-hover:from-blue-600 group-hover:to-purple-700 transition-all",children:a.jsx(gi,{className:"h-5 w-5 text-white"})}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("span",{className:"text-sm font-medium text-gray-900 group-hover:text-blue-700 transition-colors block truncate",children:QE(_)}),a.jsx("span",{className:"text-xs text-gray-500",children:"Click to download"})]})]},Y))})})]})]})]}),o&&a.jsx("div",{className:"mt-8","data-comment-section":!0,children:a.jsx(YE,{articleId:o.id,isOpen:P.isOpen,onToggle:P.toggle})})]}),R&&a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:a.jsxs("div",{className:"bg-white rounded-lg max-w-md w-full p-6",children:[a.jsxs("div",{className:"flex items-center mb-4",children:[a.jsx(Ci,{className:"h-6 w-6 text-red-600 mr-3"}),a.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Delete Article"})]}),a.jsxs("p",{className:"text-gray-600 mb-4",children:['Are you sure you want to delete "',o==null?void 0:o.title,'"? This action cannot be undone.']}),(t==null?void 0:t.role)==="admin"&&t.uid!==(o==null?void 0:o.authorId)&&a.jsxs("div",{className:"mb-4",children:[a.jsx("label",{htmlFor:"deleteNote",className:"block text-sm font-medium text-gray-700 mb-2",children:"Deletion Note (optional)"}),a.jsx("textarea",{id:"deleteNote",value:D,onChange:_=>C(_.target.value),placeholder:"Provide a reason for deletion (will be sent to the author)...",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500 resize-none",rows:3,maxLength:500}),a.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[D.length,"/500 characters"]})]}),a.jsxs("div",{className:"flex justify-end space-x-3",children:[a.jsx("button",{onClick:()=>{j(!1),C("")},disabled:w,className:"px-4 py-2 text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors disabled:opacity-50",children:"Cancel"}),a.jsxs("button",{onClick:I,disabled:w,className:"px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg transition-colors disabled:opacity-50 flex items-center space-x-2",children:[w?a.jsx("div",{className:"h-4 w-4 animate-spin border-2 border-white border-t-transparent rounded-full"}):a.jsx(Ci,{className:"h-4 w-4"}),a.jsx("span",{children:"Delete Article"})]})]})]})})]}):a.jsxs("div",{className:"text-center py-12",children:[a.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Article not found"}),a.jsx(le,{to:"/dashboard",className:"text-blue-600 hover:text-blue-700 font-medium",children:"Return to Dashboard"})]})},eA=()=>{const{userProfile:r,isInfoWriter:e,isAdmin:t,loading:s,canCreateArticles:n}=ve(),[i,o]=Zu(),l=Tt(),[c,d]=b.useState([]),[u,h]=b.useState([]),[f,p]=b.useState(!1),[m,g]=b.useState(""),[y,x]=b.useState("all"),[N,A]=b.useState(null),[S,k]=b.useState(null);b.useEffect(()=>{const O=i.get("status");O&&["draft","published","unpublished","archive"].includes(O)?x(O):x("all")},[i]);const R=s||!r&&!s,j=r&&!s&&n===!1,w=r&&!s&&n===!0;b.useEffect(()=>{if(!w||!(r!=null&&r.uid))return;p(!0);const O=xe(pe(X,"articles"),Oe("authorId","==",r.uid)),W=Ee(O,H=>{const I=[];H.forEach(E=>{var U,L,_;const F=E.data();I.push({id:E.id,...F,createdAt:((U=F.createdAt)==null?void 0:U.toDate())||new Date,updatedAt:((L=F.updatedAt)==null?void 0:L.toDate())||new Date,publishedAt:(_=F.publishedAt)==null?void 0:_.toDate()})}),I.sort((E,F)=>F.createdAt.getTime()-E.createdAt.getTime()),d(I),p(!1)},H=>{console.error("Error loading articles:",H),K.error("Error loading articles"),p(!1)});return()=>W()},[w,r==null?void 0:r.uid]),b.useEffect(()=>{v()},[c,m,y]),b.useEffect(()=>{const O=W=>{if(N){const H=W.target,I=document.querySelector(`[data-dropdown-id="${N}"]`),E=document.querySelector(`[data-dropdown-button="${N}"]`);I&&!I.contains(H)&&E&&!E.contains(H)&&A(null)}};return document.addEventListener("mousedown",O),()=>{document.removeEventListener("mousedown",O)}},[N]);const v=()=>{let O=c;if(y!=="all"&&(O=O.filter(W=>W.status===y)),m.trim()){const W=m.toLowerCase();O=O.filter(H=>H.title.toLowerCase().includes(W)||H.excerpt.toLowerCase().includes(W)||H.categories.some(I=>I.toLowerCase().includes(W))||H.tags.some(I=>I.toLowerCase().includes(W)))}h(O)},D=O=>{o(O==="all"?{}:{status:O})},C=async(O,W)=>{if(console.log(`Changing article ${O} status to ${W}`),!(r!=null&&r.uid)){K.error("You must be logged in to update articles");return}if(!n){K.error("You don't have permission to update articles");return}k(O);try{const H={status:W};W==="published"&&(H.publishedAt=new Date),console.log("Calling updateArticle with:",{id:O,updateData:H}),await _o(O,H),console.log("Article updated successfully, updating local state"),d(E=>E.map(F=>F.id===O?{...F,status:W,publishedAt:W==="published"?new Date:F.publishedAt}:F));const I=W==="published"?"published":W==="unpublished"?"marked as unpublished":W==="archive"?"archived":"saved as draft";K.success(`Article ${I} successfully`)}catch(H){console.error("Error updating article status:",H),K.error(`Error updating article status: ${H instanceof Error?H.message:"Unknown error"}`)}finally{k(null),A(null)}},P=O=>{A(N===O?null:O)};return R?a.jsx("div",{className:"min-h-screen flex items-center justify-center",children:a.jsxs("div",{className:"text-center",children:[a.jsxs("div",{className:"relative",children:[a.jsx(qe,{className:"h-16 w-16 text-blue-600 animate-spin mx-auto mb-6"}),a.jsx(Er,{className:"h-6 w-6 text-blue-400 absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2"})]}),a.jsx("h2",{className:"text-2xl font-semibold text-gray-900 mb-2",children:"Verifying Access"}),a.jsx("p",{className:"text-gray-600 max-w-md mx-auto",children:"Checking your InfoWriter permissions and loading your articles..."}),a.jsxs("div",{className:"mt-4 flex items-center justify-center space-x-2",children:[a.jsx("div",{className:"h-2 w-2 bg-blue-600 rounded-full animate-bounce",style:{animationDelay:"0ms"}}),a.jsx("div",{className:"h-2 w-2 bg-blue-600 rounded-full animate-bounce",style:{animationDelay:"150ms"}}),a.jsx("div",{className:"h-2 w-2 bg-blue-600 rounded-full animate-bounce",style:{animationDelay:"300ms"}})]})]})}):j?a.jsx("div",{className:"min-h-screen flex items-center justify-center",children:a.jsxs("div",{className:"text-center max-w-md mx-auto p-8",children:[a.jsx("div",{className:"bg-red-100 p-6 rounded-full w-20 h-20 mx-auto mb-6 flex items-center justify-center",children:a.jsx(St,{className:"h-10 w-10 text-red-600"})}),a.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"InfoWriter Access Required"}),a.jsxs("p",{className:"text-gray-600 mb-6",children:["You need InfoWriter privileges to create and manage articles.",(r==null?void 0:r.role)==="user"&&" Apply for InfoWriter access to get started."]}),a.jsxs("div",{className:"space-y-3",children:[(r==null?void 0:r.role)==="user"&&a.jsx(le,{to:"/writer-request",className:"block w-full px-6 py-3 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-xl font-medium hover:from-blue-700 hover:to-purple-700 transition-all",children:"Apply for InfoWriter Access"}),a.jsx(le,{to:"/dashboard",className:"block w-full px-6 py-3 bg-gray-100 text-gray-700 rounded-xl font-medium hover:bg-gray-200 transition-colors",children:"Return to Dashboard"})]})]})}):w?a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[a.jsx("button",{onClick:()=>l(e&&!t?"/":"/dashboard"),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",title:e&&!t?"Back to Home":"Back to Dashboard",children:a.jsx(Lt,{className:"h-5 w-5 text-gray-600"})}),a.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"My Articles"})]}),a.jsx("p",{className:"text-gray-600",children:"Create, edit, and manage your documentation"})]}),a.jsxs(le,{to:"/article/new",className:"flex items-center space-x-2 bg-gradient-to-r from-blue-600 to-purple-600 text-white px-6 py-3 rounded-xl font-medium hover:from-blue-700 hover:to-purple-700 transition-all shadow-lg hover:shadow-xl",children:[a.jsx(Wa,{className:"h-4 w-4"}),a.jsx("span",{children:"New Article"})]})]}),a.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl p-6 border border-gray-200",children:a.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[a.jsx("div",{className:"flex-1",children:a.jsx(vs,{variant:"minimal",placeholder:"Search my articles...",onResultClick:()=>{},filterByCurrentUser:!0})}),a.jsxs("div",{className:"relative",children:[a.jsx($0,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),a.jsxs("select",{value:y,onChange:O=>x(O.target.value),className:"pl-10 pr-8 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent appearance-none bg-white",children:[a.jsx("option",{value:"all",children:"All Status"}),a.jsx("option",{value:"draft",children:"Draft"}),a.jsx("option",{value:"published",children:"Published"}),a.jsx("option",{value:"unpublished",children:"Unpublished"}),a.jsx("option",{value:"archive",children:"Archive"})]})]})]})}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[a.jsxs("button",{onClick:()=>D("all"),className:`bg-white/80 backdrop-blur-sm rounded-xl p-4 border transition-all duration-200 text-left hover:shadow-md hover:scale-105 ${y==="all"?"border-blue-300 bg-blue-50":"border-gray-200"}`,children:[a.jsx("div",{className:"text-2xl font-bold text-gray-900",children:c.length}),a.jsx("div",{className:"text-sm text-gray-600",children:"Total Articles"})]}),a.jsxs("button",{onClick:()=>D("published"),className:`bg-white/80 backdrop-blur-sm rounded-xl p-4 border transition-all duration-200 text-left hover:shadow-md hover:scale-105 ${y==="published"?"border-green-300 bg-green-50":"border-green-200"}`,children:[a.jsx("div",{className:"text-2xl font-bold text-green-700",children:c.filter(O=>O.status==="published").length}),a.jsx("div",{className:"text-sm text-green-600",children:"Published"})]}),a.jsxs("button",{onClick:()=>D("draft"),className:`bg-white/80 backdrop-blur-sm rounded-xl p-4 border transition-all duration-200 text-left hover:shadow-md hover:scale-105 ${y==="draft"?"border-yellow-300 bg-yellow-50":"border-yellow-200"}`,children:[a.jsx("div",{className:"text-2xl font-bold text-yellow-700",children:c.filter(O=>O.status==="draft").length}),a.jsx("div",{className:"text-sm text-yellow-600",children:"Drafts"})]}),a.jsxs("button",{onClick:()=>D("unpublished"),className:`bg-white/80 backdrop-blur-sm rounded-xl p-4 border transition-all duration-200 text-left hover:shadow-md hover:scale-105 ${y==="unpublished"?"border-red-300 bg-red-50":"border-red-200"}`,children:[a.jsx("div",{className:"text-2xl font-bold text-red-700",children:c.filter(O=>O.status==="unpublished").length}),a.jsx("div",{className:"text-sm text-red-600",children:"Unpublished"})]}),a.jsxs("button",{onClick:()=>D("archive"),className:`bg-white/80 backdrop-blur-sm rounded-xl p-4 border transition-all duration-200 text-left hover:shadow-md hover:scale-105 ${y==="archive"?"border-purple-300 bg-purple-50":"border-purple-200"}`,children:[a.jsx("div",{className:"text-2xl font-bold text-purple-700",children:c.filter(O=>O.status==="archive").length}),a.jsx("div",{className:"text-sm text-purple-600",children:"Archive"})]})]}),f?a.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl p-12 border border-gray-200",children:a.jsxs("div",{className:"text-center",children:[a.jsx(qe,{className:"h-12 w-12 text-blue-600 animate-spin mx-auto mb-4"}),a.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Loading Your Articles"}),a.jsx("p",{className:"text-gray-600",children:"Fetching your latest articles and drafts..."})]})}):u.length===0?a.jsxs("div",{className:"text-center py-12 bg-white/80 backdrop-blur-sm rounded-2xl border border-gray-200",children:[a.jsx("div",{className:"text-6xl mb-4",children:"📝"}),a.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:c.length===0?"No articles yet":"No articles match your filters"}),a.jsx("p",{className:"text-gray-600 mb-6",children:c.length===0?"Start creating your first article to share knowledge with your team.":"Try adjusting your search or filter criteria."}),c.length===0&&a.jsxs(le,{to:"/article/new",className:"inline-flex items-center space-x-2 bg-gradient-to-r from-blue-600 to-purple-600 text-white px-6 py-3 rounded-xl font-medium hover:from-blue-700 hover:to-purple-700 transition-all",children:[a.jsx(Wa,{className:"h-4 w-4"}),a.jsx("span",{children:"Create First Article"})]})]}):a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:u.map(O=>a.jsxs("div",{className:"relative",children:[a.jsx(Ns,{article:O,variant:"default",showStatus:!0,showActions:!0,showEditButton:!0}),a.jsxs("div",{className:"absolute top-4 right-4 flex items-center space-x-2",children:[O.status==="draft"&&a.jsx("button",{onClick:()=>C(O.id,"published"),disabled:S===O.id,className:"p-2 text-gray-600 hover:text-green-600 hover:bg-green-50 rounded-lg transition-colors disabled:opacity-50 bg-white/90 backdrop-blur-sm shadow-sm",title:"Publish Article",children:S===O.id?a.jsx(jt,{className:"h-4 w-4 animate-spin"}):a.jsx(Sn,{className:"h-4 w-4"})}),a.jsxs("div",{className:"relative",children:[a.jsx("button",{onClick:()=>P(O.id),"data-dropdown-button":O.id,className:"p-2 text-gray-600 hover:text-gray-800 hover:bg-gray-50 rounded-lg transition-colors bg-white/90 backdrop-blur-sm shadow-sm",title:"More Actions",children:a.jsx(jh,{className:"h-4 w-4"})}),N===O.id&&a.jsx("div",{"data-dropdown-id":O.id,className:"absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-gray-200 z-10",children:a.jsxs("div",{className:"py-1",children:[O.status!=="published"&&a.jsxs("button",{onClick:W=>{W.stopPropagation(),C(O.id,"published")},disabled:S===O.id,className:"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-green-50 hover:text-green-700 flex items-center space-x-2 disabled:opacity-50",children:[a.jsx(Sn,{className:"h-4 w-4"}),a.jsx("span",{children:"Publish"})]}),O.status!=="draft"&&a.jsxs("button",{onClick:W=>{W.stopPropagation(),C(O.id,"draft")},disabled:S===O.id,className:"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-yellow-50 hover:text-yellow-700 flex items-center space-x-2 disabled:opacity-50",children:[a.jsx(gt,{className:"h-4 w-4"}),a.jsx("span",{children:"Save as Draft"})]}),O.status==="published"&&a.jsxs("button",{onClick:W=>{W.stopPropagation(),C(O.id,"unpublished")},disabled:S===O.id,className:"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-red-50 hover:text-red-700 flex items-center space-x-2 disabled:opacity-50",children:[a.jsx(zs,{className:"h-4 w-4"}),a.jsx("span",{children:"Unpublish"})]}),(O.status==="published"||O.status==="unpublished"||O.status==="draft")&&a.jsxs("button",{onClick:W=>{W.stopPropagation(),C(O.id,"archive")},disabled:S===O.id,className:"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-purple-50 hover:text-purple-700 flex items-center space-x-2 disabled:opacity-50",children:[a.jsx(gt,{className:"h-4 w-4"}),a.jsx("span",{children:"Archive"})]})]})})]})]})]},O.id))})]}):null},tA=()=>{const{isUser:r,isInfoWriter:e,isAdmin:t,loading:s}=ve(),n=Tt(),[i,o]=b.useState(null),[l,c]=b.useState([]),[d,u]=b.useState(!0),[h,f]=b.useState(""),[p,m]=b.useState(""),g=()=>{u(!0);const x=xe(pe(X,"articles"),Oe("status","==","published"));return Ee(x,A=>{try{const S=[];A.forEach(j=>{var D,C,P;const w=j.data(),v={id:j.id,...w,createdAt:((D=w.createdAt)==null?void 0:D.toDate())||new Date,updatedAt:(C=w.updatedAt)==null?void 0:C.toDate(),publishedAt:(P=w.publishedAt)==null?void 0:P.toDate()};S.push(v)});const k=new Set,R=new Set;S.forEach(j=>{j.categories.forEach(w=>k.add(w)),j.tags.forEach(w=>R.add(w))}),o({articles:S,categories:Array.from(k).sort(),tags:Array.from(R).sort()}),u(!1)}catch(S){console.error("Error loading articles:",S),K.error("Error loading articles"),u(!1)}})};b.useEffect(()=>{if(s)return;const x=g();return()=>x()},[s]),b.useEffect(()=>{if(!i)return;let x=i.articles;h&&(x=x.filter(N=>N.categories.includes(h))),p&&(x=x.filter(N=>N.tags.includes(p))),c(x)},[i,h,p]);const y=()=>{f(""),m("")};return d||s?a.jsx("div",{className:"flex items-center justify-center min-h-screen",children:a.jsxs("div",{className:"text-center",children:[a.jsx(qe,{className:"h-12 w-12 text-blue-600 animate-spin mx-auto mb-4"}),a.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Loading Knowledge Base"}),a.jsx("p",{className:"text-gray-600",children:s?"Authenticating...":"Loading articles and categories..."})]})}):i?a.jsxs("div",{className:"space-y-8",children:[a.jsxs("div",{className:"text-center",children:[(e||t)&&a.jsx("div",{className:"flex justify-start mb-6",children:a.jsx("button",{onClick:()=>n(t?"/my-articles":"/dashboard"),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",title:"Back to Dashboard",children:a.jsx(Lt,{className:"h-5 w-5 text-gray-600"})})}),a.jsx("h1",{className:"text-4xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent mb-4",children:"Knowledge Base"}),a.jsx("p",{className:"text-xl text-gray-600 max-w-2xl mx-auto",children:"Search and discover documentation, guides, and knowledge articles."})]}),a.jsx("div",{className:"max-w-2xl mx-auto",children:a.jsx(vs,{variant:"default",placeholder:"Search articles, categories, tags...",onResultClick:()=>{}})}),!r&&a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[a.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl p-6 border border-blue-100",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-blue-600",children:"Total Articles"}),a.jsx("p",{className:"text-2xl font-bold text-gray-900",children:i.articles.length})]}),a.jsx("div",{className:"bg-blue-100 p-3 rounded-xl",children:a.jsx(zt,{className:"h-6 w-6 text-blue-600"})})]})}),a.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl p-6 border border-purple-100",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-purple-600",children:"Categories"}),a.jsx("p",{className:"text-2xl font-bold text-gray-900",children:i.categories.length})]}),a.jsx("div",{className:"bg-purple-100 p-3 rounded-xl",children:a.jsx(Folder,{className:"h-6 w-6 text-purple-600"})})]})}),a.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl p-6 border border-green-100",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-green-600",children:"Tags"}),a.jsx("p",{className:"text-2xl font-bold text-gray-900",children:i.tags.length})]}),a.jsx("div",{className:"bg-green-100 p-3 rounded-xl",children:a.jsx(Tag,{className:"h-6 w-6 text-green-600"})})]})})]}),a.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl p-6 border border-gray-200",children:[a.jsxs("div",{className:"flex flex-col lg:flex-row gap-6",children:[a.jsxs("div",{className:"flex-1",children:[a.jsxs("h3",{className:"text-sm font-medium text-gray-700 mb-3 flex items-center",children:[a.jsx(Folder,{className:"h-4 w-4 mr-2"}),"Categories"]}),a.jsx("div",{className:"flex flex-wrap gap-2",children:i.categories.slice(0,10).map(x=>a.jsx("button",{onClick:()=>f(h===x?"":x),className:`px-3 py-1 rounded-full text-sm font-medium transition-colors ${h===x?"bg-blue-600 text-white":"bg-blue-100 text-blue-700 hover:bg-blue-200"}`,children:x},x))})]}),a.jsxs("div",{className:"flex-1",children:[a.jsxs("h3",{className:"text-sm font-medium text-gray-700 mb-3 flex items-center",children:[a.jsx(Tag,{className:"h-4 w-4 mr-2"}),"Tags"]}),a.jsx("div",{className:"flex flex-wrap gap-2",children:i.tags.slice(0,10).map(x=>a.jsxs("button",{onClick:()=>m(p===x?"":x),className:`px-3 py-1 rounded-full text-sm font-medium transition-colors ${p===x?"bg-gray-700 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:["#",x]},x))})]})]}),(h||p)&&a.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-600",children:[a.jsx("span",{children:"Filtering by:"}),h&&a.jsx("span",{className:"px-2 py-1 bg-blue-600 text-white rounded-full text-xs",children:h}),p&&a.jsxs("span",{className:"px-2 py-1 bg-gray-700 text-white rounded-full text-xs",children:["#",p]})]}),a.jsx("button",{onClick:y,className:"text-blue-600 hover:text-blue-700 text-sm font-medium",children:"Clear filters"})]})})]}),l.length===0?a.jsxs("div",{className:"text-center py-12 bg-white/80 backdrop-blur-sm rounded-2xl border border-gray-200",children:[a.jsx(zt,{className:"h-12 w-12 text-gray-300 mx-auto mb-4"}),a.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:i.articles.length===0?"No articles published yet":"No articles match your filters"}),a.jsx("p",{className:"text-gray-600",children:i.articles.length===0?"Check back later for new content.":"Try adjusting your filter criteria."}),(h||p)&&a.jsx("button",{onClick:y,className:"mt-4 text-blue-600 hover:text-blue-700 font-medium",children:"Clear all filters"})]}):a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:l.map(x=>a.jsx(Ns,{article:x,variant:"default",showActions:!0},x.id))})]}):a.jsx("div",{className:"flex items-center justify-center min-h-64",children:a.jsxs("div",{className:"text-center",children:[a.jsx(qe,{className:"h-8 w-8 text-blue-600 animate-spin mx-auto mb-4"}),a.jsx("p",{className:"text-gray-600",children:"Loading search data..."})]})})},rA=()=>{const r=Date.now().toString(36),e=Math.random().toString(36).substring(2,8);return`WR-${r}-${e}`.toUpperCase()},fi=r=>r.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"").replace(/<[^>]*>/g,"").trim(),sA=async r=>{const e=xe(pe(X,"writerRequests"),Oe("userId","==",r.userId),Oe("status","==","pending"));if(!(await vt(e)).empty)throw new Error("You already have a pending InfoWriter request. Please wait for admin review.");const s=ue(pe(X,"writerRequests")),n=rA(),i={...r,id:s.id,fullName:fi(r.fullName),qualifications:fi(r.qualifications),proposedTitle:fi(r.proposedTitle),briefDescription:fi(r.briefDescription),status:"pending",submittedAt:new Date,requestId:n};return await bs(s,{...i,submittedAt:Le.fromDate(i.submittedAt)}),n},nA=async r=>{let e=xe(pe(X,"writerRequests"));return e=xe(e,Wn("submittedAt","desc")),(await vt(e)).docs.map(n=>{var o;const i=n.data();return{...i,submittedAt:i.submittedAt.toDate(),processedAt:(o=i.processedAt)==null?void 0:o.toDate()}})},iA=async(r,e,t,s)=>{const n=ue(X,"writerRequests",r),i=await It(n);if(!i.exists())throw new Error("Request not found");const l=i.data().userId;await We(n,{status:e,processedAt:Le.fromDate(new Date),processedBy:t,adminNotes:s||""});try{const{createInfoWriterStatusNotification:c}=await Fe(async()=>{const{createInfoWriterStatusNotification:d}=await Promise.resolve().then(()=>Ro);return{createInfoWriterStatusNotification:d}},void 0);await c(l,e,s)}catch(c){console.error("Error creating InfoWriter status notification:",c)}},Wm=async r=>{const e=xe(pe(X,"writerRequests"),Oe("userId","==",r)),t=await vt(e);if(!t.empty){const s=t.docs.map(n=>{var o;const i=n.data();return{...i,submittedAt:i.submittedAt.toDate(),processedAt:(o=i.processedAt)==null?void 0:o.toDate()}});return s.sort((n,i)=>i.submittedAt.getTime()-n.submittedAt.getTime()),s[0]}return null},oA=["Technology & Software","Business & Management","Marketing & Sales","Finance & Accounting","Human Resources","Operations & Logistics","Customer Service","Legal & Compliance","Healthcare","Education & Training","Research & Development","Quality Assurance","Project Management","Data Analysis","Design & Creative","Other"],aA=[{value:"beginners",label:"Beginners (New to topic)"},{value:"intermediate",label:"Intermediate (Some experience)"},{value:"advanced",label:"Advanced (Expert level)"},{value:"all-levels",label:"All Levels"}],lA=({onClose:r})=>{const{userProfile:e}=ve(),[t,s]=b.useState(!1),[n,i]=b.useState(null),[o,l]=b.useState(!1),[c,d]=b.useState(null),[u,h]=b.useState({fullName:(e==null?void 0:e.displayName)||"",email:(e==null?void 0:e.email)||"",qualifications:"",areasOfInterest:[],proposedTitle:"",briefDescription:"",targetAudience:"all-levels"}),[f,p]=b.useState({}),[m,g]=b.useState(!1);b.useEffect(()=>{if(e){y();const k=e.displayName||e.email.split("@")[0]||"";h(R=>R.fullName!==k||R.email!==e.email?(console.log("🔄 Syncing profile data to request form"),R.fullName!==k&&R.fullName!==""&&(g(!0),setTimeout(()=>g(!1),2e3)),{...R,email:e.email,fullName:k}):R)}},[e]);const y=async()=>{if(e)try{const k=await Wm(e.uid);i(k),(!k||k.status!=="pending")&&l(!0)}catch(k){console.error("Error checking existing request:",k),l(!0)}},x=()=>{const k={};return u.qualifications.trim()||(k.qualifications="Qualifications are required"),u.areasOfInterest.length===0&&(k.areasOfInterest="Please select at least one area of interest"),u.proposedTitle.trim()||(k.proposedTitle="Proposed title is required"),u.briefDescription.trim()?u.briefDescription.length<250?k.briefDescription="Description must be at least 250 characters":u.briefDescription.length>500&&(k.briefDescription="Description must not exceed 500 characters"):k.briefDescription="Brief description is required",p(k),Object.keys(k).length===0},N=async k=>{if(k.preventDefault(),!(!e||!x())){s(!0);try{const R=await sA({...u,userId:e.uid});d(R),K.success("InfoWriter request submitted successfully!")}catch(R){K.error(R.message||"Error submitting request")}finally{s(!1)}}},A=k=>{h(R=>({...R,areasOfInterest:R.areasOfInterest.includes(k)?R.areasOfInterest.filter(j=>j!==k):[...R.areasOfInterest,k]}))},S=(k,R)=>{k==="fullName"||k==="email"||(h(j=>({...j,[k]:R})),f[k]&&p(j=>({...j,[k]:""})))};return c?a.jsx("div",{className:"max-w-2xl mx-auto bg-white/90 backdrop-blur-sm rounded-2xl p-8 border border-gray-200",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"bg-green-100 p-4 rounded-full w-16 h-16 mx-auto mb-6 flex items-center justify-center",children:a.jsx(sr,{className:"h-8 w-8 text-green-600"})}),a.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Request Submitted Successfully!"}),a.jsx("p",{className:"text-gray-600 mb-4",children:"Your InfoWriter request has been submitted and is now under review."}),a.jsxs("div",{className:"bg-blue-50 rounded-lg p-4 mb-6",children:[a.jsxs("p",{className:"text-sm text-blue-800",children:[a.jsx("strong",{children:"Request ID:"})," ",c]}),a.jsx("p",{className:"text-sm text-blue-600 mt-1",children:"Please save this ID for tracking your request status."})]}),a.jsx("button",{onClick:r,className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white px-6 py-3 rounded-xl font-medium hover:from-blue-700 hover:to-purple-700 transition-all",children:"Close"})]})}):n&&n.status==="pending"&&(e==null?void 0:e.role)!=="infowriter"?a.jsx("div",{className:"max-w-2xl mx-auto bg-white/90 backdrop-blur-sm rounded-2xl p-8 border border-gray-200",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"bg-yellow-100 p-4 rounded-full w-16 h-16 mx-auto mb-6 flex items-center justify-center",children:a.jsx(jt,{className:"h-8 w-8 text-yellow-600"})}),a.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Request Under Review"}),a.jsx("p",{className:"text-gray-600 mb-4",children:"You already have a pending InfoWriter request that is currently being reviewed by our admin team."}),a.jsxs("div",{className:"bg-yellow-50 rounded-lg p-4 mb-6",children:[a.jsxs("p",{className:"text-sm text-yellow-800",children:[a.jsx("strong",{children:"Request ID:"})," ",n.requestId]}),a.jsxs("p",{className:"text-sm text-yellow-600 mt-1",children:["Submitted on ",n.submittedAt.toLocaleDateString()]})]}),a.jsx("button",{onClick:r,className:"bg-gray-600 text-white px-6 py-3 rounded-xl font-medium hover:bg-gray-700 transition-all",children:"Close"})]})}):(e==null?void 0:e.role)==="infowriter"?a.jsx("div",{className:"max-w-2xl mx-auto bg-white/90 backdrop-blur-sm rounded-2xl p-8 border border-gray-200",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"bg-green-100 p-4 rounded-full w-16 h-16 mx-auto mb-6 flex items-center justify-center",children:a.jsx(sr,{className:"h-8 w-8 text-green-600"})}),a.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Already an InfoWriter"}),a.jsx("p",{className:"text-gray-600 mb-4",children:"You already have InfoWriter privileges and can create articles."}),a.jsx("button",{onClick:r,className:"bg-blue-600 text-white px-6 py-3 rounded-xl font-medium hover:bg-blue-700 transition-all",children:"Go to Dashboard"})]})}):o?a.jsxs("div",{className:"max-w-4xl mx-auto bg-white/90 backdrop-blur-sm rounded-2xl p-8 border border-gray-200",children:[a.jsxs("div",{className:"flex items-center justify-between mb-8",children:[a.jsxs("div",{children:[a.jsx("h2",{className:"text-3xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"InfoWriter Application"}),a.jsx("p",{className:"text-gray-600 mt-2",children:"Apply to become an InfoWriter and contribute to our knowledge base"})]}),r&&a.jsx("button",{onClick:r,className:"p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-lg transition-colors",children:a.jsx(et,{className:"h-5 w-5"})})]}),a.jsxs("form",{onSubmit:N,className:"space-y-8",children:[a.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-xl p-4 mb-6",children:a.jsxs("div",{className:"flex items-start space-x-3",children:[a.jsx("div",{className:"bg-blue-100 p-2 rounded-lg",children:a.jsx(Hr,{className:"h-5 w-5 text-blue-600"})}),a.jsxs("div",{children:[a.jsx("h4",{className:"text-sm font-semibold text-blue-900 mb-1",children:"Identity Verification"}),a.jsx("p",{className:"text-sm text-blue-800",children:"Your name and email address are automatically verified through your authenticated account. This ensures the integrity of the InfoWriter application process and prevents identity fraud."}),a.jsx("p",{className:"text-xs text-blue-600 mt-2",children:"💡 You can edit your display name in your Profile settings - changes will update here automatically in real-time."})]})]})}),a.jsxs("div",{className:"space-y-6",children:[a.jsxs("h3",{className:"text-xl font-semibold text-gray-900 flex items-center",children:[a.jsx(_e,{className:"h-5 w-5 mr-2 text-blue-600"}),"Personal Information"]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2 flex items-center",children:[a.jsx(_e,{className:"h-4 w-4 mr-1.5 text-gray-500"}),"Full Name *",a.jsxs("div",{className:"group relative ml-2",children:[a.jsx(Yc,{className:"h-4 w-4 text-gray-400 cursor-help"}),a.jsx("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-900 text-white text-xs rounded-lg opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none whitespace-nowrap z-10",children:"Automatically taken from your account"})]})]}),a.jsxs("div",{className:"relative",children:[a.jsx(Hr,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),a.jsx("input",{type:"text",value:u.fullName,readOnly:!0,disabled:!0,className:`w-full pl-10 pr-4 py-3 border border-gray-200 rounded-xl bg-gray-50 text-gray-600 cursor-not-allowed transition-all duration-300 ${m?"ring-2 ring-green-300 bg-green-50":""}`,placeholder:"Name from your account"}),m&&a.jsx("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:a.jsx("div",{className:"bg-green-100 text-green-600 text-xs px-2 py-1 rounded-full animate-pulse",children:"Updated"})})]}),a.jsxs("p",{className:"text-xs text-gray-500 mt-1 flex items-center",children:[a.jsx(Hr,{className:"h-3 w-3 mr-1"}),"This field is automatically populated from your authenticated account",m&&a.jsx("span",{className:"ml-2 text-green-600 font-medium",children:"• Name updated from profile"})]})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2 flex items-center",children:[a.jsx(Wt,{className:"h-4 w-4 mr-1.5 text-gray-500"}),"Email Address *",a.jsxs("div",{className:"group relative ml-2",children:[a.jsx(Yc,{className:"h-4 w-4 text-gray-400 cursor-help"}),a.jsx("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-900 text-white text-xs rounded-lg opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none whitespace-nowrap z-10",children:"Automatically taken from your account"})]})]}),a.jsxs("div",{className:"relative",children:[a.jsx(Hr,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),a.jsx("input",{type:"email",value:u.email,readOnly:!0,disabled:!0,className:"w-full pl-10 pr-4 py-3 border border-gray-200 rounded-xl bg-gray-50 text-gray-600 cursor-not-allowed",placeholder:"Email from your account"})]}),a.jsxs("p",{className:"text-xs text-gray-500 mt-1 flex items-center",children:[a.jsx(Hr,{className:"h-3 w-3 mr-1"}),"This field is automatically populated from your authenticated account"]})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Academic/Professional Qualifications *"}),a.jsxs("div",{className:"relative",children:[a.jsx(F0,{className:"absolute left-3 top-3 h-5 w-5 text-gray-400"}),a.jsx("textarea",{value:u.qualifications,onChange:k=>S("qualifications",k.target.value),rows:4,className:`w-full pl-10 pr-4 py-3 border rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all resize-none ${f.qualifications?"border-red-300 bg-red-50":"border-gray-300"}`,placeholder:"Describe your educational background, certifications, work experience, and relevant qualifications..."})]}),f.qualifications&&a.jsx("p",{className:"text-red-600 text-sm mt-1",children:f.qualifications})]})]}),a.jsxs("div",{className:"space-y-6",children:[a.jsxs("h3",{className:"text-xl font-semibold text-gray-900 flex items-center",children:[a.jsx(hs,{className:"h-5 w-5 mr-2 text-purple-600"}),"Areas of Interest/Expertise *"]}),a.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:oA.map(k=>a.jsx("button",{type:"button",onClick:()=>A(k),className:`p-3 text-sm rounded-lg border transition-all ${u.areasOfInterest.includes(k)?"bg-blue-100 border-blue-300 text-blue-700":"bg-white border-gray-300 text-gray-700 hover:border-blue-300 hover:bg-blue-50"}`,children:k},k))}),f.areasOfInterest&&a.jsx("p",{className:"text-red-600 text-sm",children:f.areasOfInterest})]}),a.jsxs("div",{className:"space-y-6",children:[a.jsxs("h3",{className:"text-xl font-semibold text-gray-900 flex items-center",children:[a.jsx(zt,{className:"h-5 w-5 mr-2 text-green-600"}),"Article Proposal"]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Proposed Article Title *"}),a.jsxs("div",{className:"relative",children:[a.jsx(gt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),a.jsx("input",{type:"text",value:u.proposedTitle,onChange:k=>S("proposedTitle",k.target.value),className:`w-full pl-10 pr-4 py-3 border rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all ${f.proposedTitle?"border-red-300 bg-red-50":"border-gray-300"}`,placeholder:"Enter your proposed article title"})]}),f.proposedTitle&&a.jsx("p",{className:"text-red-600 text-sm mt-1",children:f.proposedTitle})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Brief Description * (250-500 words)"}),a.jsx("textarea",{value:u.briefDescription,onChange:k=>S("briefDescription",k.target.value),rows:6,className:`w-full px-4 py-3 border rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all resize-none ${f.briefDescription?"border-red-300 bg-red-50":"border-gray-300"}`,placeholder:"Provide a detailed description of your proposed article, including key topics, objectives, and value it will bring to readers..."}),a.jsxs("div",{className:"flex justify-between items-center mt-2",children:[f.briefDescription&&a.jsx("p",{className:"text-red-600 text-sm",children:f.briefDescription}),a.jsxs("p",{className:`text-sm ml-auto ${u.briefDescription.length<250||u.briefDescription.length>500?"text-red-500":"text-green-600"}`,children:[u.briefDescription.length,"/500 words"]})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Target Audience *"}),a.jsxs("div",{className:"relative",children:[a.jsx(Eh,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),a.jsx("select",{value:u.targetAudience,onChange:k=>S("targetAudience",k.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all appearance-none bg-white",children:aA.map(k=>a.jsx("option",{value:k.value,children:k.label},k.value))})]})]})]}),a.jsx("div",{className:"pt-6 border-t border-gray-200",children:a.jsx("button",{type:"submit",disabled:t,className:"w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white py-4 rounded-xl font-semibold text-lg hover:from-blue-700 hover:to-purple-700 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:t?a.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[a.jsx("div",{className:"animate-spin h-5 w-5 border-2 border-white border-t-transparent rounded-full"}),a.jsx("span",{children:"Submitting Request..."})]}):"Submit InfoWriter Request"})})]})]}):a.jsx("div",{className:"flex items-center justify-center min-h-64",children:a.jsx("div",{className:"animate-spin h-8 w-8 border-2 border-blue-500 border-t-transparent rounded-full"})})},Xu=()=>{const{userProfile:r,isAuthenticated:e,isAdmin:t,loading:s}=ve(),n=Tt(),[i,o]=b.useState(null),[l,c]=b.useState([]),[d,u]=b.useState(!0),[h,f]=b.useState(null),[p,m]=b.useState(null),[g,y]=b.useState("");if(b.useEffect(()=>{if(s){u(!0);return}if(!e){u(!1);return}if(!r){u(!0);return}(async()=>{u(!0);try{await x(),t&&await N()}catch(w){console.error("Error loading requests:",w),K.error("Failed to load requests")}finally{u(!1)}})()},[e,r,t,s]),b.useEffect(()=>{if(!r)return;const j=xe(pe(X,"users"),Oe("uid","==",r.uid)),w=Ee(j,v=>{v.forEach(D=>{var P,O;const C=D.data();if(C.requestedWriterAccess){const W={id:D.id,userId:C.uid||D.id,displayName:C.displayName||"Unknown User",email:C.email||"",profilePicture:C.profilePicture,requestedAt:((P=C.requestedWriterAccessAt)==null?void 0:P.toDate())||new Date,status:C.role==="infowriter"?"approved":C.writerRequestRejected?"rejected":"pending",adminNote:C.adminNote,processedAt:(O=C.writerRequestProcessedAt)==null?void 0:O.toDate(),processedBy:C.writerRequestProcessedBy,source:"legacy"};o(W)}})},v=>{if(v.code==="permission-denied"){console.warn("Permission denied for legacy writer request subscription - user may not be authenticated");return}console.error("Error in legacy writer request subscription:",v)});return()=>w()},[r]),b.useEffect(()=>{if(!t)return;const j=xe(pe(X,"writerRequests")),w=Ee(j,async C=>{await N()},C=>{if(C.code==="permission-denied"){console.warn("Permission denied for new writer requests subscription - user may not be admin");return}console.error("Error in new writer requests subscription:",C)}),v=xe(pe(X,"users"),Oe("requestedWriterAccess","==",!0)),D=Ee(v,async C=>{await N()},C=>{if(C.code==="permission-denied"){console.warn("Permission denied for legacy writer requests subscription - user may not be admin");return}console.error("Error in legacy writer requests subscription:",C)});return()=>{w(),D()}},[t]),b.useEffect(()=>{!s&&!e&&n("/auth")},[e,n,s]),!s&&!e)return null;const x=async()=>{var j,w;if(r)try{const v=await Wm(r.uid);if(v){const P={id:v.id,userId:v.userId,displayName:v.fullName,email:v.email,requestedAt:v.submittedAt,status:v.status,adminNote:v.adminNotes,processedAt:v.processedAt,processedBy:v.processedBy,qualifications:v.qualifications,areasOfInterest:v.areasOfInterest,proposedTitle:v.proposedTitle,briefDescription:v.briefDescription,targetAudience:v.targetAudience,requestId:v.requestId,source:"new"};o(P);return}const D=ue(X,"users",r.uid),C=await It(D);if(C.exists()){const P=C.data();if(P.requestedWriterAccess){const O={id:C.id,userId:P.uid||C.id,displayName:P.displayName||"Unknown User",email:P.email||"",profilePicture:P.profilePicture,requestedAt:((j=P.requestedWriterAccessAt)==null?void 0:j.toDate())||new Date,status:P.role==="infowriter"?"approved":P.writerRequestRejected?"rejected":"pending",adminNote:P.adminNote,processedAt:(w=P.writerRequestProcessedAt)==null?void 0:w.toDate(),processedBy:P.writerRequestProcessedBy,source:"legacy"};o(O)}}}catch(v){console.error("Error loading current user request:",v)}},N=async()=>{if(t)try{const j=[];(await nA()).forEach(C=>{j.push({id:C.id,userId:C.userId,displayName:C.fullName,email:C.email,requestedAt:C.submittedAt,status:C.status,adminNote:C.adminNotes,processedAt:C.processedAt,processedBy:C.processedBy,qualifications:C.qualifications,areasOfInterest:C.areasOfInterest,proposedTitle:C.proposedTitle,briefDescription:C.briefDescription,targetAudience:C.targetAudience,requestId:C.requestId,source:"new"})});const v=xe(pe(X,"users"),Oe("requestedWriterAccess","==",!0));(await vt(v)).forEach(C=>{var W,H;const P=C.data();j.some(I=>I.userId===(P.uid||C.id))||j.push({id:C.id,userId:P.uid||C.id,displayName:P.displayName||"Unknown User",email:P.email||"",profilePicture:P.profilePicture,requestedAt:((W=P.requestedWriterAccessAt)==null?void 0:W.toDate())||new Date,status:P.role==="infowriter"?"approved":P.writerRequestRejected?"rejected":"pending",adminNote:P.adminNote,processedAt:(H=P.writerRequestProcessedAt)==null?void 0:H.toDate(),processedBy:P.writerRequestProcessedBy,source:"legacy"})}),j.sort((C,P)=>P.requestedAt.getTime()-C.requestedAt.getTime()),c(j)}catch(j){console.error("Error loading all requests:",j),K.error("Failed to load requests")}},A=async(j,w)=>{if(!(!r||!t)){f(j.id);try{if(j.source==="new"){if(await iA(j.id,w==="approve"?"approved":"rejected",r.uid,g),w==="approve"){await m0(j.userId);try{await Ai(j.userId)}catch(v){console.error("Failed to create notification:",v)}}}else{const v=ue(X,"users",j.id);if(w==="approve"){await We(v,{role:"infowriter",writerRequestProcessedAt:kn(),writerRequestProcessedBy:r.uid,adminNote:g,requestedWriterAccess:!1});try{await Ai(j.userId)}catch(D){console.error("Failed to create notification:",D)}}else await We(v,{writerRequestRejected:!0,writerRequestProcessedAt:kn(),writerRequestProcessedBy:r.uid,adminNote:g,requestedWriterAccess:!1})}await N(),await x(),m(null),y(""),K.success(`Request ${w}d successfully!`),window.dispatchEvent(new CustomEvent("writerRequestProcessed",{detail:{requestId:j.id,action:w,userId:j.userId}}))}catch(v){console.error(`Error ${w}ing request:`,v),K.error(`Failed to ${w} request`)}finally{f(null)}}},S=j=>{switch(j){case"pending":return a.jsx(jt,{className:"h-5 w-5 text-yellow-500"});case"approved":return a.jsx(sr,{className:"h-5 w-5 text-green-500"});case"rejected":return a.jsx(xi,{className:"h-5 w-5 text-red-500"});default:return a.jsx(St,{className:"h-5 w-5 text-gray-500"})}},k=j=>{switch(j){case"pending":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"approved":return"bg-green-100 text-green-800 border-green-200";case"rejected":return"bg-red-100 text-red-800 border-red-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},R=l.filter(j=>j.status==="pending");return d?a.jsx("div",{className:"min-h-screen py-8 px-4 sm:px-6 lg:px-8",style:{backgroundColor:"#EFEDFA"},children:a.jsx("div",{className:"max-w-7xl mx-auto",children:a.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:a.jsxs("div",{className:"text-center",children:[a.jsx(qe,{className:"h-8 w-8 animate-spin text-blue-600 mx-auto mb-4"}),a.jsx("p",{className:"text-gray-600",children:"Loading requests..."})]})})})}):a.jsx("div",{className:"min-h-screen py-8 px-4 sm:px-6 lg:px-8",style:{backgroundColor:"#EFEDFA"},children:a.jsxs("div",{className:"max-w-7xl mx-auto",children:[a.jsxs("div",{className:"mb-8",children:[a.jsxs("button",{onClick:()=>n("/dashboard"),className:"flex items-center space-x-2 text-gray-600 hover:text-gray-900 transition-colors mb-4",children:[a.jsx(Lt,{className:"h-4 w-4"}),a.jsx("span",{children:"Back to Dashboard"})]}),a.jsx("div",{children:a.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:t?"InfoWriter Requests":"InfoWriter Application"})})]}),!t&&a.jsx("div",{className:"mb-8",children:a.jsx(lA,{onClose:()=>n("/dashboard")})}),t&&a.jsx("div",{className:"space-y-6",children:a.jsx("div",{className:"space-y-4",children:R.length===0?a.jsxs("div",{className:"bg-white/90 backdrop-blur-sm rounded-2xl p-8 border border-gray-200 text-center",children:[a.jsx(St,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),a.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No pending requests"}),a.jsx("p",{className:"text-gray-600",children:"All requests have been processed."})]}):R.map(j=>a.jsx("div",{className:"bg-white/90 backdrop-blur-sm rounded-2xl p-6 border border-gray-200",children:a.jsxs("div",{className:"flex items-start justify-between",children:[a.jsxs("div",{className:"flex items-start space-x-4 flex-1",children:[a.jsx("div",{className:"flex-shrink-0",children:j.profilePicture?a.jsx("img",{className:"h-12 w-12 rounded-full object-cover",src:j.profilePicture,alt:j.displayName}):a.jsx("div",{className:"h-12 w-12 rounded-full bg-blue-100 flex items-center justify-center",children:a.jsx(_e,{className:"h-6 w-6 text-blue-600"})})}),a.jsxs("div",{className:"flex-1",children:[a.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:j.displayName}),a.jsxs("div",{className:`flex items-center space-x-1 px-2 py-1 rounded-full border text-xs ${k(j.status)}`,children:[S(j.status),a.jsx("span",{className:"font-medium capitalize",children:j.status})]}),a.jsx("span",{className:"text-xs text-gray-500 bg-gray-100 px-2 py-1 rounded",children:j.source==="new"?"New System":"Legacy"})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3 text-sm text-gray-600 mb-3",children:[a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(Wt,{className:"h-4 w-4"}),a.jsx("span",{children:j.email})]}),a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(Us,{className:"h-4 w-4"}),a.jsxs("span",{children:["Submitted"," ",Ht(j.requestedAt)," ago"]})]}),j.processedAt&&a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(jt,{className:"h-4 w-4"}),a.jsxs("span",{children:["Processed"," ",Ht(j.processedAt)," ago"]})]})]}),j.source==="new"&&a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm text-gray-600 mb-3",children:[j.proposedTitle&&a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(gt,{className:"h-4 w-4"}),a.jsx("span",{className:"truncate",children:j.proposedTitle})]}),j.targetAudience&&a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(Eh,{className:"h-4 w-4"}),a.jsx("span",{className:"capitalize",children:j.targetAudience.replace("-"," ")})]})]}),j.adminNote&&a.jsx("div",{className:"mt-3 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:a.jsxs("div",{className:"flex items-start space-x-2",children:[a.jsx(Nh,{className:"h-4 w-4 text-yellow-600 mt-0.5"}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-yellow-900",children:"Admin Note"}),a.jsx("p",{className:"text-sm text-yellow-800 mt-1",children:j.adminNote})]})]})})]})]}),a.jsxs("div",{className:"flex items-center space-x-2 ml-4",children:[a.jsxs("button",{onClick:()=>m(j),className:"flex items-center space-x-1 px-3 py-2 text-blue-600 hover:text-blue-800 hover:bg-blue-50 rounded-lg transition-colors",children:[a.jsx(us,{className:"h-4 w-4"}),a.jsx("span",{className:"text-sm",children:"View"})]}),j.status==="pending"&&a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsxs("button",{onClick:()=>A(j,"approve"),disabled:h===j.id,className:"flex items-center space-x-1 px-3 py-2 bg-green-600 text-white hover:bg-green-700 rounded-lg transition-colors disabled:opacity-50",children:[h===j.id?a.jsx(qe,{className:"h-4 w-4 animate-spin"}):a.jsx(sr,{className:"h-4 w-4"}),a.jsx("span",{className:"text-sm",children:"Approve"})]}),a.jsxs("button",{onClick:()=>A(j,"reject"),disabled:h===j.id,className:"flex items-center space-x-1 px-3 py-2 bg-red-600 text-white hover:bg-red-700 rounded-lg transition-colors disabled:opacity-50",children:[h===j.id?a.jsx(qe,{className:"h-4 w-4 animate-spin"}):a.jsx(xi,{className:"h-4 w-4"}),a.jsx("span",{className:"text-sm",children:"Reject"})]})]})]})]})},`${j.source}-${j.id}`))})}),p&&a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:a.jsx("div",{className:"bg-white rounded-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:a.jsxs("div",{className:"p-6",children:[a.jsxs("div",{className:"flex items-center justify-between mb-6",children:[a.jsx("h3",{className:"text-2xl font-bold text-gray-900",children:"Request Details"}),a.jsx("button",{onClick:()=>m(null),className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",children:a.jsx(et,{className:"h-6 w-6"})})]}),a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex items-center space-x-4 p-4 bg-gray-50 rounded-xl",children:[p.profilePicture?a.jsx("img",{className:"h-16 w-16 rounded-full object-cover",src:p.profilePicture,alt:p.displayName}):a.jsx("div",{className:"h-16 w-16 rounded-full bg-blue-100 flex items-center justify-center",children:a.jsx(_e,{className:"h-8 w-8 text-blue-600"})}),a.jsxs("div",{children:[a.jsx("h4",{className:"text-xl font-semibold text-gray-900",children:p.displayName}),a.jsx("p",{className:"text-gray-600",children:p.email}),a.jsxs("div",{className:"flex items-center space-x-3 mt-2",children:[a.jsxs("div",{className:`flex items-center space-x-1 px-2 py-1 rounded-full border text-sm ${k(p.status)}`,children:[S(p.status),a.jsx("span",{className:"font-medium capitalize",children:p.status})]}),a.jsx("span",{className:"text-sm text-gray-500 bg-gray-200 px-2 py-1 rounded",children:p.source==="new"?"New System":"Legacy System"})]})]})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[a.jsxs("div",{children:[a.jsx("h5",{className:"font-semibold text-gray-900 mb-3",children:"Request Information"}),a.jsxs("div",{className:"space-y-3 text-sm",children:[a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(Us,{className:"h-4 w-4 text-gray-500"}),a.jsxs("span",{children:["Submitted:"," ",Pi(p.requestedAt,"PPP")]})]}),p.processedAt&&a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(jt,{className:"h-4 w-4 text-gray-500"}),a.jsxs("span",{children:["Processed:"," ",Pi(p.processedAt,"PPP")]})]}),p.requestId&&a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(hs,{className:"h-4 w-4 text-gray-500"}),a.jsxs("span",{children:["Request ID: ",p.requestId]})]})]})]}),p.source==="new"&&a.jsxs("div",{children:[a.jsx("h5",{className:"font-semibold text-gray-900 mb-3",children:"Application Details"}),a.jsxs("div",{className:"space-y-3 text-sm",children:[p.qualifications&&a.jsxs("div",{children:[a.jsx("span",{className:"font-medium text-gray-700",children:"Qualifications:"}),a.jsx("div",{className:"mt-2 p-3 bg-gray-50 rounded-lg border border-gray-200",children:a.jsx("div",{className:"text-gray-600 text-sm leading-relaxed whitespace-pre-wrap overflow-y-auto max-h-32 prose prose-sm max-w-none",style:{wordWrap:"break-word",overflowWrap:"break-word",hyphens:"auto"},children:p.qualifications})})]}),p.proposedTitle&&a.jsxs("div",{children:[a.jsx("span",{className:"font-medium text-gray-700",children:"Proposed Title:"}),a.jsx("p",{className:"text-gray-600 mt-1",children:p.proposedTitle})]}),p.targetAudience&&a.jsxs("div",{children:[a.jsx("span",{className:"font-medium text-gray-700",children:"Target Audience:"}),a.jsx("p",{className:"text-gray-600 mt-1 capitalize",children:p.targetAudience.replace("-"," ")})]})]})]})]}),p.areasOfInterest&&p.areasOfInterest.length>0&&a.jsxs("div",{children:[a.jsx("h5",{className:"font-semibold text-gray-900 mb-3",children:"Areas of Interest"}),a.jsx("div",{className:"flex flex-wrap gap-2",children:p.areasOfInterest.map((j,w)=>a.jsx("span",{className:"px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm",children:j},w))})]}),p.briefDescription&&a.jsxs("div",{children:[a.jsx("h5",{className:"font-semibold text-gray-900 mb-3",children:"Brief Description"}),a.jsx("div",{className:"p-4 bg-gray-50 rounded-lg border border-gray-200",children:a.jsx("div",{className:"text-gray-700 text-sm leading-relaxed whitespace-pre-wrap overflow-y-auto max-h-48 prose prose-sm max-w-none",style:{wordWrap:"break-word",overflowWrap:"break-word",hyphens:"auto"},children:p.briefDescription})})]}),p.adminNote&&a.jsxs("div",{children:[a.jsx("h5",{className:"font-semibold text-gray-900 mb-3",children:"Admin Note"}),a.jsx("div",{className:"p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:a.jsx("div",{className:"text-yellow-800 text-sm leading-relaxed whitespace-pre-wrap overflow-y-auto max-h-32 prose prose-sm max-w-none",style:{wordWrap:"break-word",overflowWrap:"break-word",hyphens:"auto"},children:p.adminNote})})]}),p.status==="pending"&&a.jsxs("div",{className:"border-t pt-6",children:[a.jsx("h5",{className:"font-semibold text-gray-900 mb-3",children:"Admin Actions"}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Admin Notes (Optional)"}),a.jsx("textarea",{value:g,onChange:j=>y(j.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Add notes about your decision..."})]}),a.jsxs("div",{className:"flex items-center space-x-4",children:[a.jsxs("button",{onClick:()=>A(p,"approve"),disabled:h===p.id,className:"flex items-center space-x-2 px-6 py-3 bg-green-600 text-white hover:bg-green-700 rounded-lg transition-colors disabled:opacity-50",children:[h===p.id?a.jsx(qe,{className:"h-5 w-5 animate-spin"}):a.jsx(sr,{className:"h-5 w-5"}),a.jsx("span",{children:"Approve Request"})]}),a.jsxs("button",{onClick:()=>A(p,"reject"),disabled:h===p.id,className:"flex items-center space-x-2 px-6 py-3 bg-red-600 text-white hover:bg-red-700 rounded-lg transition-colors disabled:opacity-50",children:[h===p.id?a.jsx(qe,{className:"h-5 w-5 animate-spin"}):a.jsx(xi,{className:"h-5 w-5"}),a.jsx("span",{children:"Reject Request"})]})]})]})]})]})]})})})]})})},cA=r=>({id:r.articleId,title:r.articleTitle,content:"",excerpt:r.articleExcerpt||"",status:"published",authorId:r.articleAuthorId||"",authorName:r.articleAuthor,categories:r.articleCategories||[],tags:r.articleTags||[],createdAt:r.articleUpdatedAt||r.savedAt,updatedAt:r.articleUpdatedAt||r.savedAt,publishedAt:r.articlePublishedAt||r.articleUpdatedAt||r.savedAt,slug:"",coverImage:r.articleCoverImage,views:0,shareCount:0,attachments:[]}),dA=()=>{const{userProfile:r,loading:e}=ve();Tt();const[t,s]=b.useState([]),[n,i]=b.useState([]),[o,l]=b.useState(!0),[c,d]=b.useState(null),[u,h]=b.useState("");b.useEffect(()=>{if(e)return;if(!(r!=null&&r.uid)){l(!1);return}return Ob(r.uid,m=>{s(m),i(m),l(!1)})},[r==null?void 0:r.uid,e]),b.useEffect(()=>{if(!u.trim())i(t);else{const p=t.filter(m=>m.articleTitle.toLowerCase().includes(u.toLowerCase())||m.articleAuthor.toLowerCase().includes(u.toLowerCase())||(m.articleExcerpt||"").toLowerCase().includes(u.toLowerCase())||(m.articleCategories||[]).some(g=>g.toLowerCase().includes(u.toLowerCase()))||(m.articleTags||[]).some(g=>g.toLowerCase().includes(u.toLowerCase())));i(p)}},[u,t]);const f=async p=>{if(r!=null&&r.uid){d(p);try{await lf(r.uid,p),K.success("Article removed from saved articles")}catch{K.error("Failed to remove article")}finally{d(null)}}};return e||o?a.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50 flex items-center justify-center",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),a.jsx("p",{className:"mt-4 text-gray-600",children:e?"Loading...":"Loading saved articles..."})]})}):r?a.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50",children:a.jsx("div",{className:"max-w-6xl mx-auto px-4 py-8",children:a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[a.jsx(le,{to:"/dashboard",className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:a.jsx(Lt,{className:"h-5 w-5 text-gray-600"})}),a.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"Saved Articles"})]}),a.jsx("p",{className:"text-gray-600",children:"Your personal collection of saved articles"})]}),a.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl p-4 border border-purple-100",children:a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx("div",{className:"bg-purple-100 p-2 rounded-lg",children:a.jsx(br,{className:"h-5 w-5 text-purple-600"})}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-gray-600",children:"Total Saved"}),a.jsx("p",{className:"text-xl font-bold text-gray-900",children:t.length})]})]})})]}),t.length>0&&a.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl p-4 border border-gray-200",children:a.jsx(vs,{variant:"default",placeholder:"Search saved articles by title, author, category, or tag...",onResultClick:()=>{}})}),t.length===0?a.jsxs("div",{className:"text-center py-12 bg-white/80 backdrop-blur-sm rounded-2xl border border-gray-200",children:[a.jsx(br,{className:"h-12 w-12 text-gray-300 mx-auto mb-4"}),a.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No saved articles yet"}),a.jsx("p",{className:"text-gray-600 mb-4",children:"Start saving articles you want to read later or reference again."}),a.jsxs(le,{to:"/",className:"inline-flex items-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[a.jsx(zt,{className:"h-4 w-4"}),a.jsx("span",{children:"Browse Articles"})]})]}):n.length===0?a.jsxs("div",{className:"text-center py-12 bg-white/80 backdrop-blur-sm rounded-2xl border border-gray-200",children:[a.jsx(Ti,{className:"h-12 w-12 text-gray-300 mx-auto mb-4"}),a.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No articles found"}),a.jsx("p",{className:"text-gray-600 mb-4",children:"Try adjusting your search terms or browse all saved articles."}),a.jsxs("button",{onClick:()=>h(""),className:"inline-flex items-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[a.jsx(br,{className:"h-4 w-4"}),a.jsx("span",{children:"Show All Saved"})]})]}):a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:n.map(p=>a.jsxs("div",{className:"relative group",children:[a.jsx(Ns,{article:cA(p),variant:"default",showActions:!0,className:"hover:border-purple-200 pb-12"}),a.jsx("button",{onClick:()=>f(p.articleId),disabled:c===p.articleId,className:"absolute top-3 right-3 p-2 text-purple-600 hover:text-red-600 hover:bg-red-50 rounded-lg transition-all duration-200 disabled:opacity-50 bg-white/95 backdrop-blur-sm shadow-md border border-purple-200 hover:border-red-200 opacity-0 group-hover:opacity-100",title:"Remove from saved articles",children:c===p.articleId?a.jsx("div",{className:"h-4 w-4 border-2 border-red-600 border-t-transparent rounded-full animate-spin"}):a.jsx(C0,{className:"h-4 w-4"})}),a.jsx("div",{className:"absolute bottom-3 left-3 right-3",children:a.jsxs("div",{className:"bg-gradient-to-r from-purple-100 to-purple-200 text-purple-800 px-3 py-1.5 rounded-lg text-xs font-medium shadow-sm border border-purple-200 flex items-center justify-center",children:[a.jsx(br,{className:"h-3 w-3 mr-1.5"}),"Saved ",Ht(p.savedAt)," ago"]})})]},p.id))})]})})}):a.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50 flex items-center justify-center",children:a.jsxs("div",{className:"text-center",children:[a.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Access Denied"}),a.jsx("p",{className:"text-gray-600 mb-6",children:"Please log in to view your saved articles."}),a.jsx(le,{to:"/login",className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Go to Login"})]})})},uA=()=>{var W,H,I,E,F;const{userProfile:r,refreshProfile:e,loading:t}=ve(),[s,n]=b.useState({displayName:"",profilePicture:"",bio:"",socialLinks:{twitter:"",linkedin:"",github:"",website:""}}),[i,o]=b.useState(!1),[l,c]=b.useState(!1),[d,u]=b.useState(0),[h,f]=b.useState(null),[p,m]=b.useState(""),[g,y]=b.useState(!1),[x,N]=b.useState(""),[A,S]=b.useState(""),[k,R]=b.useState(!1);b.useEffect(()=>{if(!r)return;const U=Y=>{var Z,J,te,be;n({displayName:Y.displayName||"",profilePicture:Y.profilePicture||"",bio:Y.bio||"",socialLinks:{twitter:((Z=Y.socialLinks)==null?void 0:Z.twitter)||"",linkedin:((J=Y.socialLinks)==null?void 0:J.linkedin)||"",github:((te=Y.socialLinks)==null?void 0:te.github)||"",website:((be=Y.socialLinks)==null?void 0:be.website)||""}}),m(Y.profilePicture||""),N(Y.displayName||"")};U(r);const L=ue(X,"users",r.uid),_=Ee(L,Y=>{var Z;if(Y.exists()){const J=Y.data(),te={...r,displayName:J.displayName||"",profilePicture:J.profilePicture||"",bio:J.bio||"",socialLinks:J.socialLinks||{},updatedAt:(Z=J.updatedAt)==null?void 0:Z.toDate()};R(!0),setTimeout(()=>R(!1),2e3),!g&&!i?(U(te),console.log("📡 Real-time profile update received and applied")):console.log("📡 Real-time profile update received but not applied (user is editing)")}},Y=>{if(Y.code==="permission-denied"){console.warn("Permission denied for profile subscription - user may not be authenticated");return}console.error("Error in profile subscription:",Y)});return()=>_()},[r==null?void 0:r.uid]);const j=U=>{var Y;const L=(Y=U.target.files)==null?void 0:Y[0];if(!L||!L.type.startsWith("image/")||L.size>5*1024*1024)return;f(L);const _=new FileReader;_.onload=Z=>{var J;m((J=Z.target)==null?void 0:J.result)},_.readAsDataURL(L)},w=async()=>{if(!h||!r)return null;c(!0),u(0);try{return(await Kl(h,r.uid,"profiles",L=>u(L))).url}catch(U){return console.error("Error uploading profile picture:",U),null}finally{c(!1),u(0)}},v=async U=>{var L;if(U.preventDefault(),!!r&&s.displayName.trim()){o(!0);try{let _=s.profilePicture;const Y=r.profilePicture;if(h){const te=await w();if(te)_=te;else{o(!1);return}}console.log("🔄 Updating profile:",{userId:r.uid,displayName:s.displayName,bio:s.bio,socialLinks:s.socialLinks});const Z=ue(X,"users",r.uid),J={displayName:s.displayName.trim(),profilePicture:_,bio:((L=s.bio)==null?void 0:L.trim())||"",socialLinks:s.socialLinks,updatedAt:new Date};if(await We(Z,J),console.log("✅ Profile updated successfully in Firestore"),await e(),console.log("✅ Profile refresh completed"),h&&Y&&Y!==_)try{const te=Jl(Y);te&&te.startsWith("profiles/")&&(await Gl(te),console.log("✅ Deleted old profile picture:",te))}catch(te){console.error("⚠️ Failed to delete old profile picture:",te)}n(te=>({...te,profilePicture:_})),f(null),m("")}catch(_){console.error("❌ Error updating profile:",_)}finally{o(!1)}}},D=U=>{const L=U.trim();return L?L.length<2?"Display name must be at least 2 characters long":L.length>50?"Display name cannot exceed 50 characters":/^[a-zA-Z0-9\s\-_.]+$/.test(L)?"":"Display name can only contain letters, numbers, spaces, hyphens, underscores, and periods":"Display name cannot be empty"},C=()=>{if(!r){S("User not authenticated");return}const U=D(x);if(U){S(U);return}n(L=>({...L,displayName:x.trim()})),S(""),y(!1),console.log("✅ Display name updated locally, will save when 'Save Changes' is clicked")},P=()=>{N(s.displayName||""),y(!1),S("")},O=U=>{switch(U){case"admin":return"bg-red-100 text-red-800 border-red-200";case"infowriter":return"bg-purple-100 text-purple-800 border-purple-200";default:return"bg-blue-100 text-blue-800 border-blue-200"}};return t?a.jsx("div",{className:"flex items-center justify-center min-h-64",children:a.jsx("div",{className:"animate-spin h-8 w-8 border-2 border-blue-500 border-t-transparent rounded-full"})}):r?a.jsxs("div",{className:"max-w-4xl mx-auto",children:[a.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[a.jsxs(le,{to:"/",className:"flex items-center space-x-2 text-gray-600 hover:text-blue-600 transition-colors group",children:[a.jsx(Lt,{className:"h-5 w-5 group-hover:-translate-x-1 transition-transform"}),a.jsx("span",{className:"font-medium",children:"Back to Homepage"})]}),a.jsxs(le,{to:"/",className:"flex items-center space-x-2 text-gray-600 hover:text-blue-600 transition-colors group",children:[a.jsx(Bl,{className:"h-5 w-5"}),a.jsx("span",{className:"font-medium",children:"Home"})]})]}),a.jsxs("div",{className:"bg-white/80 backdrop-blur-md rounded-2xl shadow-xl border border-gray-100 overflow-hidden",children:[a.jsxs("div",{className:"bg-gradient-to-r from-[#1D4ED8] via-[#7C3AED] to-[#EC4899] px-8 py-6",children:[a.jsx("h1",{className:"text-2xl font-bold text-white",children:"My Profile"}),a.jsx("p",{className:"text-blue-100 mt-1",children:"Manage your account information and preferences"})]}),a.jsxs("div",{className:"p-8",children:[k&&a.jsxs("div",{className:"mb-6 p-3 bg-green-50 border border-green-200 rounded-lg flex items-center space-x-2 animate-pulse",children:[a.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-ping"}),a.jsx("span",{className:"text-green-700 text-sm font-medium",children:"Profile updated in real-time"})]}),a.jsxs("form",{onSubmit:v,className:"space-y-8",children:[a.jsxs("div",{className:"flex items-start space-x-6",children:[a.jsx("div",{className:"flex-shrink-0",children:a.jsxs("div",{className:"relative",children:[a.jsx("div",{className:"w-24 h-24 rounded-full overflow-hidden bg-gray-200 border-4 border-white shadow-lg",children:p||r!=null&&r.profilePicture?a.jsx("img",{src:p||(r==null?void 0:r.profilePicture)||"",alt:"Profile",className:"w-full h-full object-cover"}):a.jsx("div",{className:"w-full h-full flex items-center justify-center bg-gradient-to-r from-blue-500 to-purple-600",children:a.jsx(_e,{className:"h-10 w-10 text-white"})})}),a.jsxs("label",{className:"absolute bottom-0 right-0 bg-blue-600 hover:bg-blue-700 text-white p-2 rounded-full cursor-pointer transition-colors shadow-lg",children:[a.jsx(M0,{className:"h-4 w-4"}),a.jsx("input",{type:"file",accept:"image/*",onChange:j,className:"hidden"})]})]})}),a.jsxs("div",{className:"flex-1",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Profile Picture"}),a.jsx("p",{className:"text-gray-600 text-sm mb-4",children:"Upload a profile picture to personalize your account. Supported formats: JPG, PNG, GIF, WebP (max 5MB)"}),l&&a.jsxs("div",{className:"mb-4",children:[a.jsxs("div",{className:"flex items-center space-x-2 text-sm text-blue-600",children:[a.jsx(qe,{className:"h-4 w-4 animate-spin"}),a.jsxs("span",{children:["Uploading... ",d,"%"]})]}),a.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 mt-2",children:a.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${d}%`}})})]})]})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Display Name *"}),a.jsxs("div",{className:"relative",children:[a.jsx(_e,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),g?a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx("input",{type:"text",value:x,onChange:U=>{N(U.target.value),A&&S("")},className:`flex-1 pl-10 pr-4 py-3 border rounded-xl focus:ring-2 focus:border-transparent transition-all ${A?"border-red-300 focus:ring-red-500 bg-red-50":"border-blue-300 focus:ring-blue-500"}`,placeholder:"Enter your display name",autoFocus:!0,disabled:!1,maxLength:50}),a.jsx("button",{type:"button",onClick:C,disabled:!x.trim(),className:"p-2 text-green-600 hover:bg-green-50 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:a.jsx(Fl,{className:"h-4 w-4"})}),a.jsx("button",{type:"button",onClick:P,disabled:!1,className:"p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:a.jsx(et,{className:"h-4 w-4"})})]}),A&&a.jsxs("p",{className:"text-red-600 text-sm pl-10 flex items-center",children:[a.jsx(St,{className:"h-4 w-4 mr-1"}),A]}),a.jsxs("p",{className:"text-xs text-gray-500 pl-10",children:[x.length,"/50 characters"]})]}):a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex items-center",children:[a.jsx("input",{type:"text",value:s.displayName||"Not set",className:"flex-1 pl-10 pr-12 py-3 border border-gray-200 rounded-xl bg-gray-50 text-gray-700 cursor-not-allowed",disabled:!0}),a.jsx("button",{type:"button",onClick:()=>{N(s.displayName||""),y(!0)},className:"absolute right-3 p-1 text-gray-400 hover:text-blue-600 transition-colors",title:"Click to edit your display name",children:a.jsx(G0,{className:"h-4 w-4"})})]}),a.jsx("p",{className:"text-xs text-gray-500 pl-10",children:"💡 Click the edit icon to change your display name. Changes will update across the entire application in real-time."})]})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email Address"}),a.jsxs("div",{className:"relative",children:[a.jsx(Wt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),a.jsx("input",{type:"email",value:r.email,className:"w-full pl-10 pr-4 py-3 border border-gray-200 rounded-xl bg-gray-50 text-gray-500 cursor-not-allowed",disabled:!0})]}),a.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Email cannot be changed"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Role"}),a.jsxs("div",{className:"relative",children:[a.jsx(Er,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),a.jsx("div",{className:"w-full pl-10 pr-4 py-3 border border-gray-200 rounded-xl bg-gray-50 flex items-center",children:a.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium border ${O(r.role)}`,children:r.role.charAt(0).toUpperCase()+r.role.slice(1)})})]}),a.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Role is managed by administrators"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Bio"}),a.jsxs("div",{className:"relative",children:[a.jsx(Nh,{className:"absolute left-3 top-3 h-5 w-5 text-gray-400"}),a.jsx("textarea",{value:s.bio,onChange:U=>n({...s,bio:U.target.value}),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all resize-none",placeholder:"Tell others about yourself...",rows:3,maxLength:100})]}),a.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[((W=s.bio)==null?void 0:W.length)||0,"/100 characters"]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-4",children:"Social Links"}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Twitter"}),a.jsxs("div",{className:"relative",children:[a.jsx(Vl,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),a.jsx("input",{type:"url",value:((H=s.socialLinks)==null?void 0:H.twitter)||"",onChange:U=>n({...s,socialLinks:{...s.socialLinks,twitter:U.target.value}}),className:"w-full pl-10 pr-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all",placeholder:"https://twitter.com/username"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"LinkedIn"}),a.jsxs("div",{className:"relative",children:[a.jsx(Ul,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),a.jsx("input",{type:"url",value:((I=s.socialLinks)==null?void 0:I.linkedin)||"",onChange:U=>n({...s,socialLinks:{...s.socialLinks,linkedin:U.target.value}}),className:"w-full pl-10 pr-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all",placeholder:"https://linkedin.com/in/username"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"GitHub"}),a.jsxs("div",{className:"relative",children:[a.jsx(bh,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),a.jsx("input",{type:"url",value:((E=s.socialLinks)==null?void 0:E.github)||"",onChange:U=>n({...s,socialLinks:{...s.socialLinks,github:U.target.value}}),className:"w-full pl-10 pr-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all",placeholder:"https://github.com/username"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Website"}),a.jsxs("div",{className:"relative",children:[a.jsx(wh,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),a.jsx("input",{type:"url",value:((F=s.socialLinks)==null?void 0:F.website)||"",onChange:U=>n({...s,socialLinks:{...s.socialLinks,website:U.target.value}}),className:"w-full pl-10 pr-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all",placeholder:"https://yourwebsite.com"})]})]})]}),a.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Add your social media profiles and website (optional)"})]}),a.jsx("div",{className:"flex justify-end pt-6 border-t border-gray-200",children:a.jsx("button",{type:"submit",disabled:i||l,className:"flex items-center space-x-2 bg-gradient-to-r from-blue-600 to-purple-600 text-white px-6 py-3 rounded-xl font-medium hover:from-blue-700 hover:to-purple-700 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:i?a.jsxs(a.Fragment,{children:[a.jsx(qe,{className:"h-4 w-4 animate-spin"}),a.jsx("span",{children:"Updating..."})]}):a.jsxs(a.Fragment,{children:[a.jsx(Sh,{className:"h-4 w-4"}),a.jsx("span",{children:"Save Changes"})]})})})]})]})]})]}):a.jsxs("div",{className:"text-center py-12",children:[a.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Profile not found"}),a.jsx("p",{className:"text-gray-600",children:"Unable to load your profile information."})]})},hA=()=>{const{authorId:r}=Pl(),{userProfile:e}=ve(),t=N0(r),[s,n]=b.useState([]),[i,o]=b.useState(!0),[l,c]=b.useState(!0);b.useEffect(()=>{t&&o(!1)},[t]),b.useEffect(()=>{if(!r)return;c(!0);const u=xe(pe(X,"articles"),Oe("authorId","==",r),Oe("status","==","published")),h=Ee(u,f=>{const p=[];f.forEach(m=>{var y,x,N;const g=m.data();p.push({id:m.id,...g,createdAt:((y=g.createdAt)==null?void 0:y.toDate())||new Date,updatedAt:(x=g.updatedAt)==null?void 0:x.toDate(),publishedAt:(N=g.publishedAt)==null?void 0:N.toDate()})}),p.sort((m,g)=>{const y=m.publishedAt||m.createdAt||new Date(0);return(g.publishedAt||g.createdAt||new Date(0)).getTime()-y.getTime()}),n(p),c(!1)},f=>{console.error("Error loading author articles:",f),n([]),c(!1)});return()=>h()},[r]);const d=u=>{switch(u){case"twitter":return a.jsx(Vl,{className:"h-4 w-4"});case"linkedin":return a.jsx(Ul,{className:"h-4 w-4"});case"github":return a.jsx(bh,{className:"h-4 w-4"});case"website":return a.jsx(wh,{className:"h-4 w-4"});default:return null}};return i?a.jsx("div",{className:"flex items-center justify-center min-h-64",children:a.jsx("div",{className:"animate-spin h-8 w-8 border-2 border-blue-500 border-t-transparent rounded-full"})}):t?a.jsxs("div",{className:"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8",children:[a.jsx("div",{className:"mb-6",children:a.jsxs("button",{onClick:()=>window.history.back(),className:"flex items-center space-x-2 text-gray-600 hover:text-gray-900 transition-colors",children:[a.jsx(Lt,{className:"h-4 w-4"}),a.jsx("span",{children:"Back"})]})}),a.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl border border-gray-200 overflow-hidden mb-8",children:a.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 px-8 py-12",children:a.jsxs("div",{className:"flex flex-col md:flex-row items-center md:items-start space-y-4 md:space-y-0 md:space-x-6",children:[a.jsx("div",{className:"flex-shrink-0",children:a.jsx("div",{className:"w-24 h-24 rounded-full overflow-hidden border-4 border-white shadow-lg",children:t.profilePicture?a.jsx("img",{src:t.profilePicture,alt:t.displayName,className:"w-full h-full object-cover"}):a.jsx("div",{className:"w-full h-full bg-gradient-to-r from-blue-500 to-purple-600 flex items-center justify-center",children:a.jsx(_e,{className:"h-12 w-12 text-white"})})})}),a.jsxs("div",{className:"flex-1 text-center md:text-left",children:[a.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:t.displayName||"Unknown Author"}),a.jsx("div",{className:"flex flex-wrap items-center justify-center md:justify-start gap-3 mb-4",children:a.jsx("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium border ${t.role==="admin"||t.role==="infowriter"?"bg-blue-100 text-blue-800 border-blue-200":"bg-gray-100 text-gray-800 border-gray-200"} bg-white/90`,children:t.role==="infowriter"||t.role==="admin"?"InfoWriter":t.role})}),t.bio&&a.jsx("p",{className:"text-blue-100 text-lg mb-4 max-w-2xl",children:t.bio}),t.socialLinks&&Object.entries(t.socialLinks).some(([u,h])=>h)&&a.jsx("div",{className:"flex items-center justify-center md:justify-start space-x-3",children:Object.entries(t.socialLinks).map(([u,h])=>h?a.jsx("a",{href:h,target:"_blank",rel:"noopener noreferrer",className:"p-2 bg-white/20 hover:bg-white/30 rounded-lg transition-colors",title:`${u.charAt(0).toUpperCase()+u.slice(1)}`,children:d(u)},u):null)})]})]})})}),a.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl border border-gray-200 p-8",children:[a.jsx("div",{className:"flex items-center justify-between mb-6",children:a.jsxs("h2",{className:"text-2xl font-bold text-gray-900 flex items-center",children:[a.jsx(zt,{className:"h-6 w-6 mr-2"}),"Published Articles",a.jsxs("span",{className:"ml-2 text-lg font-normal text-gray-500",children:["(",s.length,")"]})]})}),l?a.jsxs("div",{className:"flex items-center justify-center py-12",children:[a.jsx("div",{className:"animate-spin h-8 w-8 border-2 border-blue-500 border-t-transparent rounded-full"}),a.jsx("p",{className:"ml-4 text-gray-600",children:"Loading articles..."})]}):s.length===0?a.jsxs("div",{className:"text-center py-12",children:[a.jsx(zt,{className:"h-12 w-12 text-gray-300 mx-auto mb-4"}),a.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No articles yet"}),a.jsx("p",{className:"text-gray-600",children:"This author hasn't published any articles yet."})]}):a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:s.map(u=>a.jsx(Ns,{article:u,variant:"default",showActions:!!e},u.id))}),!e&&s.length>0&&a.jsx("div",{className:"mt-6 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:a.jsxs("p",{className:"text-sm text-blue-700 text-center",children:[a.jsx(le,{to:"/auth",className:"font-medium hover:underline",children:"Sign in"})," ","to like and save articles"]})})]})]})]}):a.jsxs("div",{className:"text-center py-12",children:[a.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Author not found"}),a.jsx(le,{to:"/dashboard",className:"text-blue-600 hover:text-blue-700 font-medium",children:"Return to Dashboard"})]})},fA=()=>{const{userProfile:r,isAdmin:e}=ve(),[t,s]=b.useState([]),[n,i]=b.useState(!0),[o,l]=b.useState(null),[c,d]=b.useState(null),[u,h]=b.useState(null),[f,p]=b.useState(""),[m,g]=b.useState(null);b.useEffect(()=>{if(!r||!e)return;const x=[];let N={},A={};const S=xe(pe(X,"users"),Oe("role","==","infowriter")),k=Ee(S,v=>{N={},v.forEach(D=>{var P,O;const C=D.data();N[C.uid||D.id]={id:D.id,uid:C.uid||D.id,displayName:C.displayName||"Unknown Writer",email:C.email||"",profilePicture:C.profilePicture,joinedAt:((P=C.createdAt)==null?void 0:P.toDate())||new Date,lastActive:(O=C.lastActive)==null?void 0:O.toDate()}}),w()},v=>{if(v.code==="permission-denied"){console.warn("Permission denied for ActiveWriters subscription - user may not be admin"),i(!1);return}console.error("Error in ActiveWriters subscription:",v),i(!1)}),R=xe(pe(X,"articles"),Oe("status","==","published")),j=Ee(R,v=>{console.log(`📊 Real-time published articles update: ${v.docs.length} published articles found`),A={},v.forEach(P=>{const O=P.data();O.authorId&&(A[O.authorId]=(A[O.authorId]||0)+1)});const D=Object.keys(A).length,C=Object.values(A).reduce((P,O)=>P+O,0);console.log(`📈 Published article counts updated: ${D} authors, ${C} published articles`),w()},v=>{if(v.code==="permission-denied"){console.warn("Permission denied for articles subscription - user may not be authenticated");return}console.error("Error in articles subscription:",v)}),w=()=>{const v=[];Object.values(N).forEach(D=>{const C=A[D.uid]||0;v.push({...D,articleCount:C})}),v.sort((D,C)=>D.articleCount!==C.articleCount?C.articleCount-D.articleCount:C.joinedAt.getTime()-D.joinedAt.getTime()),console.log(`🔄 Updated writers list: ${v.length} writers with real-time published article counts`),s(v),i(!1)};return x.push(k,j),()=>{x.forEach(v=>v())}},[r,e]);const y=async(x,N)=>{if(!r){Ne.error("You must be logged in to perform this action");return}if(!N.trim()){Ne.error("Please provide a reason for removing writer privileges");return}l(x.id);try{const A=await g0(x.uid,r.uid,N.trim()),S=A.deletedArticlesCount>0?`InfoWriter privileges removed for ${x.displayName}. ${A.deletedArticlesCount} articles deleted.`:`InfoWriter privileges removed for ${x.displayName}. No articles to delete.`;Ne.success(S),g(null),p("")}catch(A){console.error("Error removing writer privileges:",A);const S=A instanceof Error?A.message:"An unexpected error occurred";Ne.error(`Failed to remove writer privileges: ${S}`)}finally{l(null)}};return e?n?a.jsx("div",{className:"min-h-screen bg-gradient-to-br from-green-50 to-emerald-50 flex items-center justify-center",children:a.jsxs("div",{className:"text-center",children:[a.jsx(qe,{className:"h-8 w-8 animate-spin text-green-600 mx-auto mb-4"}),a.jsx("p",{className:"text-gray-600",children:"Loading active writers..."})]})}):a.jsx("div",{className:"min-h-screen bg-gradient-to-br from-green-50 to-emerald-50 py-8",children:a.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[a.jsxs("div",{className:"mb-8",children:[a.jsx("div",{className:"flex items-center space-x-4 mb-4",children:a.jsxs(le,{to:"/admin/dashboard",className:"flex items-center space-x-2 text-gray-600 hover:text-gray-900 transition-colors",children:[a.jsx(Lt,{className:"h-5 w-5"}),a.jsx("span",{children:"Back to Dashboard"})]})}),a.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Active InfoWriters"}),a.jsx("p",{className:"text-gray-600",children:"Manage users with InfoWriter privileges and their published content."})]}),t.length===0?a.jsxs("div",{className:"bg-white rounded-lg p-8 text-center",children:[a.jsx(Ha,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),a.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Active Writers"}),a.jsx("p",{className:"text-gray-600",children:"There are currently no users with InfoWriter privileges."})]}):a.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[a.jsx("div",{className:"px-6 py-4 border-b border-gray-200 bg-gray-50",children:a.jsxs("h2",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[a.jsx(Ha,{className:"h-5 w-5 mr-2 text-green-600"}),"Active Writers (",t.length,")"]})}),a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[a.jsx("thead",{className:"bg-gray-50",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Writer"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Email"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Articles"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Joined"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),a.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:t.map(x=>a.jsxs("tr",{className:"hover:bg-gray-50",children:[a.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:a.jsxs("div",{className:"flex items-center",children:[a.jsx("div",{className:"flex-shrink-0 h-10 w-10",children:x.profilePicture?a.jsx("img",{className:"h-10 w-10 rounded-full object-cover",src:x.profilePicture,alt:x.displayName}):a.jsx("div",{className:"h-10 w-10 rounded-full bg-blue-100 flex items-center justify-center",children:a.jsx(_e,{className:"h-5 w-5 text-blue-600"})})}),a.jsxs("div",{className:"ml-4",children:[a.jsx("div",{className:"text-sm font-medium text-gray-900",children:x.displayName}),a.jsxs("div",{className:"text-sm text-gray-500",children:["ID: ",x.uid.slice(0,8),"..."]})]})]})}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:a.jsxs("div",{className:"flex items-center text-sm text-gray-900",children:[a.jsx(Wt,{className:"h-4 w-4 mr-2 text-gray-400"}),x.email]})}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:a.jsxs("div",{className:"flex items-center",children:[a.jsx(gt,{className:"h-4 w-4 mr-2 text-blue-600"}),x.articleCount>0?a.jsx(le,{to:`/author/${x.uid}`,className:"text-sm font-medium text-blue-600 hover:text-blue-800 hover:underline transition-colors cursor-pointer",title:`View ${x.articleCount} published articles by ${x.displayName}`,children:x.articleCount}):a.jsx("span",{className:"text-sm font-medium text-gray-500",children:x.articleCount})]})}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:a.jsxs("div",{className:"flex items-center text-sm text-gray-900",children:[a.jsx(Us,{className:"h-4 w-4 mr-2 text-gray-400"}),x.joinedAt.toLocaleDateString()]})}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx("button",{onClick:()=>h(x),className:"flex items-center space-x-1 text-blue-600 hover:text-blue-800",title:"View Writer Details",children:a.jsx(us,{className:"h-4 w-4"})}),a.jsxs("button",{onClick:()=>g(x),className:"flex items-center space-x-1 text-red-600 hover:text-red-800",children:[a.jsx(sa,{className:"h-4 w-4"}),a.jsx("span",{children:"Remove Privileges"})]})]})})]},x.id))})]})})]}),u&&a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:a.jsx("div",{className:"bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:a.jsxs("div",{className:"p-6",children:[a.jsxs("div",{className:"flex items-center justify-between mb-6",children:[a.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:"Writer Details"}),a.jsx("button",{onClick:()=>h(null),className:"text-gray-400 hover:text-gray-600",children:a.jsx(et,{className:"h-6 w-6"})})]}),a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex items-center space-x-4",children:[a.jsx("div",{className:"flex-shrink-0",children:u.profilePicture?a.jsx("img",{className:"h-16 w-16 rounded-full object-cover",src:u.profilePicture,alt:u.displayName}):a.jsx("div",{className:"h-16 w-16 rounded-full bg-blue-100 flex items-center justify-center",children:a.jsx(_e,{className:"h-8 w-8 text-blue-600"})})}),a.jsxs("div",{children:[a.jsx("h4",{className:"text-lg font-medium text-gray-900",children:u.displayName}),a.jsx("p",{className:"text-gray-600",children:u.email}),a.jsxs("p",{className:"text-sm text-gray-500",children:["ID: ",u.uid]})]})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsx("div",{className:"bg-blue-50 p-4 rounded-lg",children:a.jsxs("div",{className:"flex items-center",children:[a.jsx(gt,{className:"h-5 w-5 text-blue-600 mr-2"}),a.jsxs("div",{children:[u.articleCount>0?a.jsx(le,{to:`/author/${u.uid}`,className:"text-2xl font-bold text-blue-900 hover:text-blue-700 hover:underline transition-colors cursor-pointer",title:`View all ${u.articleCount} articles by ${u.displayName}`,onClick:()=>h(null),children:u.articleCount}):a.jsx("p",{className:"text-2xl font-bold text-gray-500",children:u.articleCount}),a.jsx("p",{className:"text-sm text-blue-600",children:"Published Articles"})]})]})}),a.jsx("div",{className:"bg-green-50 p-4 rounded-lg",children:a.jsxs("div",{className:"flex items-center",children:[a.jsx(Us,{className:"h-5 w-5 text-green-600 mr-2"}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-bold text-green-900",children:u.joinedAt.toLocaleDateString()}),a.jsx("p",{className:"text-sm text-green-600",children:"Member Since"})]})]})})]}),a.jsxs("div",{className:"flex items-center space-x-4 pt-4 border-t",children:[u.articleCount>0&&a.jsxs(le,{to:`/author/${u.uid}`,className:"flex items-center space-x-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",onClick:()=>h(null),children:[a.jsx(P0,{className:"h-4 w-4"}),a.jsx("span",{children:"View Articles"})]}),a.jsxs("button",{onClick:()=>{h(null),g(u)},className:"flex items-center space-x-2 bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition-colors",children:[a.jsx(sa,{className:"h-4 w-4"}),a.jsx("span",{children:"Remove Privileges"})]})]})]})]})})}),m&&a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:a.jsxs("div",{className:"bg-white rounded-lg max-w-md w-full p-6",children:[a.jsxs("div",{className:"flex items-center mb-4",children:[a.jsx(St,{className:"h-6 w-6 text-red-600 mr-3"}),a.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Remove Writer Privileges"})]}),a.jsxs("div",{className:"mb-4",children:[a.jsxs("p",{className:"text-gray-600 mb-2",children:["You are about to remove InfoWriter privileges for"," ",a.jsx("span",{className:"font-semibold",children:m.displayName}),"."]}),a.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3 mb-4",children:[a.jsx("p",{className:"text-red-800 text-sm font-medium",children:"⚠️ Warning: This action will:"}),a.jsxs("ul",{className:"text-red-700 text-sm mt-1 list-disc list-inside",children:[a.jsx("li",{children:"Remove their InfoWriter privileges"}),a.jsxs("li",{children:["Permanently delete ALL ",m.articleCount," of their articles"]}),a.jsx("li",{children:"Send them a notification with your reason"})]})]})]}),a.jsxs("div",{className:"mb-4",children:[a.jsx("label",{htmlFor:"adminNote",className:"block text-sm font-medium text-gray-700 mb-2",children:"Admin Note (Reason for removal) *"}),a.jsx("textarea",{id:"adminNote",value:f,onChange:x=>p(x.target.value),placeholder:"Please provide a reason for removing this writer's privileges...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500 resize-none",rows:3,required:!0})]}),a.jsxs("div",{className:"flex items-center justify-end space-x-3",children:[a.jsx("button",{onClick:()=>{g(null),p("")},className:"px-4 py-2 text-gray-700 bg-gray-200 rounded-lg hover:bg-gray-300 transition-colors",children:"Cancel"}),a.jsx("button",{onClick:()=>y(m,f),disabled:o===m.id||!f.trim(),className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center space-x-2",children:o===m.id?a.jsxs(a.Fragment,{children:[a.jsx(qe,{className:"h-4 w-4 animate-spin"}),a.jsx("span",{children:"Removing..."})]}):a.jsxs(a.Fragment,{children:[a.jsx(sa,{className:"h-4 w-4"}),a.jsx("span",{children:"Remove Privileges"})]})})]})]})})]})}):a.jsx("div",{className:"min-h-screen bg-gradient-to-br from-red-50 to-pink-50 flex items-center justify-center",children:a.jsxs("div",{className:"text-center",children:[a.jsx(St,{className:"h-16 w-16 text-red-500 mx-auto mb-4"}),a.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Access Denied"}),a.jsx("p",{className:"text-gray-600",children:"You don't have permission to access this page."})]})})},pA=()=>{const{userProfile:r,isAdmin:e}=ve(),[t,s]=b.useState([]),[n,i]=b.useState(!0),[o,l]=b.useState(null),[c,d]=b.useState(null);b.useEffect(()=>{if(!r||!e)return;const h=[],f=xe(pe(X,"users")),p=Ee(f,async m=>{const g=[],y=xe(pe(X,"articles")),x=Ee(y,N=>{const A={};N.forEach(S=>{var R;const k=S.data();(R=k.author)!=null&&R.uid&&(A[k.author.uid]=(A[k.author.uid]||0)+1)}),m.forEach(S=>{var R,j,w;const k=S.data();k.previousRoles&&k.previousRoles.includes(k.uid||S.id)&&k.role!=="infowriter"&&k.privilegesRemovedAt&&g.push({id:S.id,uid:k.uid||S.id,displayName:k.displayName||"Unknown Writer",email:k.email||"",profilePicture:k.profilePicture,joinedAt:((R=k.createdAt)==null?void 0:R.toDate())||new Date,removedAt:((j=k.privilegesRemovedAt)==null?void 0:j.toDate())||new Date,removedBy:k.privilegesRemovedBy||"Unknown",articleCount:k.articleCountAtRemoval||0,lastActive:(w=k.lastActive)==null?void 0:w.toDate(),adminNote:k.adminNote||"No reason provided"})}),g.sort((S,k)=>k.removedAt.getTime()-S.removedAt.getTime()),s(g),i(!1)});h.push(x)});return h.push(p),()=>{h.forEach(m=>m())}},[r,e]);const u=async h=>{if(!r){Ne.error("You must be logged in to perform this action");return}l(h.id);try{const f=ue(X,"users",h.id);await We(f,{role:"infowriter",privilegesRestoredAt:kn(),privilegesRestoredBy:r.uid,privilegesRemovedAt:null,privilegesRemovedBy:null}),await Ll(pe(X,"notifications"),{userId:h.uid,type:"writer_privileges_restored",title:"InfoWriter Privileges Restored! 🎉",message:`Your InfoWriter privileges have been restored by an administrator. You can now create and publish articles again. Note: ${h.articleCount} previously deleted articles cannot be recovered.`,read:!1,createdAt:kn(),actionUrl:"/dashboard"}),Ne.success(`InfoWriter privileges restored for ${h.displayName}. Note: ${h.articleCount} previously deleted articles cannot be recovered.`),d(null)}catch(f){console.error("Error restoring writer privileges:",f);const p=f instanceof Error?f.message:"An unexpected error occurred";Ne.error(`Failed to restore writer privileges: ${p}`)}finally{l(null)}};return e?n?a.jsx("div",{className:"min-h-screen bg-gradient-to-br from-red-50 to-pink-50 flex items-center justify-center",children:a.jsxs("div",{className:"text-center",children:[a.jsx(qe,{className:"h-8 w-8 animate-spin text-red-600 mx-auto mb-4"}),a.jsx("p",{className:"text-gray-600",children:"Loading removed writers..."})]})}):a.jsx("div",{className:"min-h-screen bg-gradient-to-br from-red-50 to-pink-50 py-8",children:a.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[a.jsxs("div",{className:"mb-8",children:[a.jsx("div",{className:"flex items-center space-x-4 mb-4",children:a.jsxs(le,{to:"/admin/dashboard",className:"flex items-center space-x-2 text-gray-600 hover:text-gray-900 transition-colors",children:[a.jsx(Lt,{className:"h-5 w-5"}),a.jsx("span",{children:"Back to Dashboard"})]})}),a.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Removed InfoWriters"}),a.jsx("p",{className:"text-gray-600",children:"Users who previously had InfoWriter privileges but have been demoted to regular users."})]}),t.length===0?a.jsxs("div",{className:"bg-white rounded-lg p-8 text-center",children:[a.jsx(Va,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),a.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Removed Writers"}),a.jsx("p",{className:"text-gray-600",children:"No InfoWriter privileges have been removed yet."})]}):a.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[a.jsx("div",{className:"px-6 py-4 border-b border-gray-200 bg-gray-50",children:a.jsxs("h2",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[a.jsx(Va,{className:"h-5 w-5 mr-2 text-red-600"}),"Removed Writers (",t.length,")"]})}),a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[a.jsx("thead",{className:"bg-gray-50",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Writer"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Email"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Articles"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Admin Note"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Removed"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),a.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:t.map(h=>a.jsxs("tr",{className:"hover:bg-gray-50",children:[a.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:a.jsxs("div",{className:"flex items-center",children:[a.jsx("div",{className:"flex-shrink-0 h-10 w-10",children:h.profilePicture?a.jsx("img",{className:"h-10 w-10 rounded-full object-cover opacity-75",src:h.profilePicture,alt:h.displayName}):a.jsx("div",{className:"h-10 w-10 rounded-full bg-red-100 flex items-center justify-center",children:a.jsx(_e,{className:"h-5 w-5 text-red-600"})})}),a.jsxs("div",{className:"ml-4",children:[a.jsx("div",{className:"text-sm font-medium text-gray-900",children:h.displayName}),a.jsxs("div",{className:"text-sm text-gray-500",children:["ID: ",h.uid.slice(0,8),"..."]})]})]})}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:a.jsxs("div",{className:"flex items-center text-sm text-gray-900",children:[a.jsx(Wt,{className:"h-4 w-4 mr-2 text-gray-400"}),h.email]})}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:a.jsxs("div",{className:"flex items-center",children:[a.jsx(gt,{className:"h-4 w-4 mr-2 text-gray-600"}),a.jsx("span",{className:"text-sm font-medium text-gray-900",children:h.articleCount}),a.jsx("span",{className:"ml-1 text-xs text-gray-500",children:"(deleted)"})]})}),a.jsx("td",{className:"px-6 py-4",children:a.jsx("div",{className:"max-w-xs",children:a.jsx("p",{className:"text-sm text-gray-900 truncate",title:h.adminNote,children:h.adminNote})})}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:a.jsxs("div",{className:"flex items-center text-sm text-gray-900",children:[a.jsx(Us,{className:"h-4 w-4 mr-2 text-gray-400"}),h.removedAt.toLocaleDateString()]})}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:c===h.id?a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx("button",{onClick:()=>u(h),disabled:o===h.id,className:"bg-green-600 text-white px-3 py-1 rounded text-xs hover:bg-green-700 disabled:opacity-50",children:o===h.id?a.jsx(qe,{className:"h-3 w-3 animate-spin"}):"Confirm"}),a.jsx("button",{onClick:()=>d(null),className:"bg-gray-300 text-gray-700 px-3 py-1 rounded text-xs hover:bg-gray-400",children:"Cancel"})]}):a.jsxs("button",{onClick:()=>d(h.id),className:"flex items-center space-x-1 text-green-600 hover:text-green-800",children:[a.jsx(Lo,{className:"h-4 w-4"}),a.jsx("span",{children:"Restore Privileges"})]})})]},h.id))})]})})]})]})}):a.jsx("div",{className:"min-h-screen bg-gradient-to-br from-red-50 to-pink-50 flex items-center justify-center",children:a.jsxs("div",{className:"text-center",children:[a.jsx(St,{className:"h-16 w-16 text-red-500 mx-auto mb-4"}),a.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Access Denied"}),a.jsx("p",{className:"text-gray-600",children:"You don't have permission to access this page."})]})})},Xr=class Xr{constructor(){Me(this,"pendingActions",new Map);Me(this,"STORAGE_KEY","infonest_offline_actions");Me(this,"MAX_RETRIES",3);Me(this,"isProcessing",!1);this.loadPendingActions(),this.setupNetworkListeners(),this.startSyncProcessor()}static getInstance(){return Xr.instance||(Xr.instance=new Xr),Xr.instance}setupNetworkListeners(){window.addEventListener("online",()=>{console.log("🔄 Network restored, starting offline sync"),this.processPendingActions()})}loadPendingActions(){try{const e=localStorage.getItem(this.STORAGE_KEY);e&&JSON.parse(e).forEach(s=>{this.pendingActions.set(s.id,s)})}catch(e){console.error("Failed to load pending actions:",e)}}persistActions(){try{const e=Array.from(this.pendingActions.values());localStorage.setItem(this.STORAGE_KEY,JSON.stringify(e))}catch(e){console.error("Failed to persist offline actions:",e)}}startSyncProcessor(){setInterval(()=>{navigator.onLine&&!this.isProcessing&&this.processPendingActions()},3e4)}addAction(e,t){const s=`action_${Date.now()}_${Math.random().toString(36).substring(2)}`,n={id:s,type:e,data:t,timestamp:Date.now(),retryCount:0};return this.pendingActions.set(s,n),this.persistActions(),navigator.onLine&&this.processPendingActions(),s}async processPendingActions(){if(this.isProcessing||!navigator.onLine)return;this.isProcessing=!0;const e=Array.from(this.pendingActions.values()).sort((t,s)=>t.timestamp-s.timestamp);for(const t of e)try{await this.processAction(t),this.pendingActions.delete(t.id)}catch(s){console.error("Failed to process action:",s),t.retryCount++,t.retryCount>=this.MAX_RETRIES&&this.pendingActions.delete(t.id)}this.persistActions(),this.isProcessing=!1}async processAction(e){switch(e.type){case"upload":await this.processUploadAction(e);break;case"article_save":await this.processArticleSaveAction(e);break;case"article_publish":await this.processArticlePublishAction(e);break;default:console.warn(`Unknown action type: ${e.type}`)}}async processUploadAction(e){const{uploadId:t}=e.data;t&&ge.resumeUpload(t)}async processArticleSaveAction(e){const{articleData:t}=e.data}async processArticlePublishAction(e){const{articleId:t}=e.data}getPendingActionsCount(){return this.pendingActions.size}getPendingActions(){return Array.from(this.pendingActions.values())}clearCompletedActions(){this.pendingActions.clear(),this.persistActions()}};Me(Xr,"instance");let Il=Xr;const mA=Il.getInstance(),gA=()=>{const[r,e]=b.useState(navigator.onLine),[t,s]=b.useState(0),[n,i]=b.useState(0);return b.useEffect(()=>{const o=()=>e(!0),l=()=>e(!1);window.addEventListener("online",o),window.addEventListener("offline",l);const c=setInterval(()=>{s(mA.getPendingActionsCount()),i(ge.getActiveUploads().length)},2e3);return()=>{window.removeEventListener("online",o),window.removeEventListener("offline",l),clearInterval(c)}},[]),r&&t===0&&n===0?null:a.jsx("div",{className:"fixed bottom-4 left-4 z-50",children:a.jsxs("div",{className:`flex items-center space-x-2 px-3 py-2 rounded-lg shadow-lg border text-sm ${r?"bg-yellow-50 text-yellow-800 border-yellow-200":"bg-red-50 text-red-800 border-red-200"}`,children:[r?a.jsxs(a.Fragment,{children:[a.jsx(Ah,{className:"h-4 w-4"}),a.jsx("span",{className:"font-medium",children:t>0||n>0?"Syncing...":"Online"})]}):a.jsxs(a.Fragment,{children:[a.jsx(fn,{className:"h-4 w-4"}),a.jsx("span",{className:"font-medium",children:"Offline"})]}),(t>0||n>0)&&a.jsx("span",{className:"text-xs bg-white/20 px-2 py-1 rounded",children:t+n})]})})},xA=()=>{const[r,e]=b.useState([]),[t,s]=b.useState([]);b.useEffect(()=>{const o=()=>{const u=ge.getUploadNotifications();e(u.slice(-3))},l=()=>{const u=ge.getActiveUploads();s(u)};o(),l();const c=u=>{const h=u.detail;e(f=>[...f.slice(-2),h]),Ne.success(h.message)};window.addEventListener("globalUploadComplete",c);const d=setInterval(()=>{l()},2e3);return()=>{window.removeEventListener("globalUploadComplete",c),clearInterval(d)}},[]);const n=o=>{e(d=>d.filter(u=>u.id!==o));const c=ge.getUploadNotifications().filter(d=>d.id!==o);localStorage.setItem("upload_notifications",JSON.stringify(c))},i=()=>{e([]),ge.clearUploadNotifications()};return r.length===0&&t.length===0?null:a.jsxs("div",{className:"fixed bottom-4 right-4 z-50 space-y-2 max-w-sm",children:[t.map(o=>a.jsx("div",{className:"bg-white border border-blue-200 rounded-lg shadow-lg p-4 animate-slide-up",children:a.jsxs("div",{className:"flex items-start space-x-3",children:[a.jsx("div",{className:"flex-shrink-0",children:a.jsx(rt,{className:"h-5 w-5 text-blue-600 animate-pulse"})}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsxs("p",{className:"text-sm font-medium text-gray-900 truncate",children:["Uploading ",o.fileName]}),a.jsxs("div",{className:"mt-1",children:[a.jsx("div",{className:"bg-gray-200 rounded-full h-2",children:a.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${o.percentage||0}%`}})}),a.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[Math.round(o.percentage||0),"% • ",o.speed?ge.formatSpeed(o.speed):"Calculating..."]})]})]})]})},o.id)),r.map(o=>{var l;return a.jsx("div",{className:"bg-white border border-green-200 rounded-lg shadow-lg p-4 animate-slide-up",children:a.jsxs("div",{className:"flex items-start space-x-3",children:[a.jsx("div",{className:"flex-shrink-0",children:a.jsx(sr,{className:"h-5 w-5 text-green-600"})}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("p",{className:"text-sm font-medium text-gray-900",children:o.title}),a.jsx("p",{className:"text-sm text-gray-600 truncate",children:o.message}),((l=o.context)==null?void 0:l.type)==="article"&&a.jsx("div",{className:"mt-2",children:a.jsxs("button",{onClick:()=>{var c;(c=o.context)!=null&&c.articleId&&(window.location.href=`/article/edit/${o.context.articleId}`)},className:"text-xs text-blue-600 hover:text-blue-800 flex items-center space-x-1",children:[a.jsx(gt,{className:"h-3 w-3"}),a.jsx("span",{children:"Go to Article"})]})})]}),a.jsx("button",{onClick:()=>n(o.id),className:"flex-shrink-0 text-gray-400 hover:text-gray-600",children:a.jsx(et,{className:"h-4 w-4"})})]})},o.id)}),r.length>1&&a.jsx("div",{className:"text-center",children:a.jsx("button",{onClick:i,className:"text-xs text-gray-500 hover:text-gray-700 underline",children:"Clear all notifications"})})]})},yA=()=>{ze.useEffect(()=>{const r=e=>{if((e.metaKey||e.ctrlKey)&&e.key==="k"){e.preventDefault();const t=new CustomEvent("openGlobalSearch");window.dispatchEvent(t)}};return document.addEventListener("keydown",r),()=>document.removeEventListener("keydown",r)},[])};function bA(){return yA(),a.jsx(Ym,{children:a.jsx(w0,{children:a.jsx(wA,{})})})}function wA(){const{loading:r,isAuthenticated:e,emailVerified:t}=ve();return a.jsx(b0,{children:r?a.jsx("div",{className:"min-h-screen flex items-center justify-center",style:{backgroundColor:"#EFEDFA"},children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"animate-spin h-8 w-8 border-2 border-blue-500 border-t-transparent rounded-full mx-auto mb-4"}),a.jsx("p",{className:"text-gray-600",children:"Loading..."})]})}):a.jsx(vA,{isAuthenticated:e,emailVerified:t})})}function vA({isAuthenticated:r,emailVerified:e}){return a.jsxs("div",{className:"App",style:{backgroundColor:"#EFEDFA",minHeight:"100vh"},children:[a.jsx(a0,{position:"top-right",toastOptions:{duration:4e3,style:{background:"#fff",color:"#374151",borderRadius:"12px",border:"1px solid #e5e7eb",boxShadow:"0 10px 15px -3px rgba(0, 0, 0, 0.1)"}}}),a.jsx(gA,{}),a.jsx(xA,{}),a.jsxs(Jm,{children:[a.jsx(me,{path:"/",element:a.jsx(Ib,{})}),a.jsx(me,{path:"/verify-email",element:a.jsx(Db,{})}),a.jsx(me,{path:"/auth",element:r?a.jsx($e,{to:"/",replace:!0}):a.jsx(Ab,{})}),a.jsx(me,{path:"/email-verify",element:a.jsx(Mb,{})}),a.jsx(me,{path:"/author/:authorId",element:a.jsx(hA,{})}),r&&e?a.jsxs(me,{path:"/*",element:a.jsx(pb,{}),children:[a.jsx(me,{path:"dashboard",element:a.jsx(rn,{children:a.jsx($b,{})})}),a.jsx(me,{path:"article/:id",element:a.jsx(rn,{children:a.jsx(ZE,{})})}),a.jsx(me,{path:"writer-request",element:a.jsx(rn,{children:a.jsx(Xu,{})})}),a.jsx(me,{path:"saved-articles",element:a.jsx(rn,{children:a.jsx(dA,{})})}),a.jsx(me,{path:"profile",element:a.jsx(rn,{children:a.jsx(uA,{})})}),a.jsx(me,{path:"search",element:a.jsx(Ps,{requiredRoles:["infowriter","admin"],children:a.jsx(tA,{})})}),a.jsx(me,{path:"article/new",element:a.jsx(Ps,{requiredRoles:["infowriter","admin"],children:a.jsx(Ju,{})})}),a.jsx(me,{path:"article/edit/:id",element:a.jsx(Ps,{requiredRoles:["infowriter","admin"],children:a.jsx(Ju,{})})}),a.jsx(me,{path:"my-articles",element:a.jsx(Ps,{requiredRoles:["infowriter","admin"],children:a.jsx(eA,{})})}),a.jsx(me,{path:"admin",element:a.jsx($e,{to:"/dashboard",replace:!0})}),a.jsx(me,{path:"admin/writer-requests",element:a.jsx(na,{children:a.jsx(Xu,{})})}),a.jsx(me,{path:"admin/active-writers",element:a.jsx(na,{children:a.jsx(fA,{})})}),a.jsx(me,{path:"admin/removed-writers",element:a.jsx(na,{children:a.jsx(pA,{})})}),a.jsx(me,{path:"*",element:a.jsx($e,{to:"/dashboard",replace:!0})})]}):r&&!e?a.jsxs(a.Fragment,{children:[a.jsx(me,{path:"/dashboard",element:a.jsx($e,{to:"/email-verify",replace:!0})}),a.jsx(me,{path:"/article/*",element:a.jsx($e,{to:"/email-verify",replace:!0})}),a.jsx(me,{path:"/profile",element:a.jsx($e,{to:"/email-verify",replace:!0})}),a.jsx(me,{path:"/saved-articles",element:a.jsx($e,{to:"/email-verify",replace:!0})}),a.jsx(me,{path:"/writer-request",element:a.jsx($e,{to:"/email-verify",replace:!0})}),a.jsx(me,{path:"/search",element:a.jsx($e,{to:"/email-verify",replace:!0})}),a.jsx(me,{path:"/my-articles",element:a.jsx($e,{to:"/email-verify",replace:!0})}),a.jsx(me,{path:"/admin/*",element:a.jsx($e,{to:"/email-verify",replace:!0})})]}):a.jsxs(a.Fragment,{children:[a.jsx(me,{path:"/dashboard",element:a.jsx($e,{to:"/auth",replace:!0})}),a.jsx(me,{path:"/article/*",element:a.jsx($e,{to:"/auth",replace:!0})}),a.jsx(me,{path:"/profile",element:a.jsx($e,{to:"/auth",replace:!0})}),a.jsx(me,{path:"/saved-articles",element:a.jsx($e,{to:"/auth",replace:!0})}),a.jsx(me,{path:"/writer-request",element:a.jsx($e,{to:"/auth",replace:!0})}),a.jsx(me,{path:"/search",element:a.jsx($e,{to:"/auth",replace:!0})}),a.jsx(me,{path:"/my-articles",element:a.jsx($e,{to:"/auth",replace:!0})}),a.jsx(me,{path:"/admin/*",element:a.jsx($e,{to:"/auth",replace:!0})})]})]})]})}nh(document.getElementById("root")).render(a.jsx(b.StrictMode,{children:a.jsx(bA,{})}));
