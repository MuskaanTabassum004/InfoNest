var Vm=Object.defineProperty;var qm=(r,e,t)=>e in r?Vm(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var Me=(r,e,t)=>qm(r,typeof e!="symbol"?e+"":e,t);import{r as b,a as Xu,b as ze,c as Km,g as Gm}from"./vendor-C733eHZ9-1754723551018.js";import{u as zn,N as $e,L as le,a as Tt,O as Uc,b as Qu,c as Il,H as Ym,R as Jm,d as me}from"./router-Vmp_VPGi-1754723551018.js";import{g as Xm,i as Qm,a as Zm,b as eg,c as tg,d as rg,s as Co,e as he,f as It,h as bs,j as sg,k as ng,u as ig,l as Zu,G as og,m as ag,n as qe,q as xe,o as pe,w as Oe,p as vt,r as kn,t as Ee,v as Mo,x as Wn,y as Rt,T as Le,z as Hn,A as Si,B as lg,C as eh,D as zc,E as cg,F as dg,H as ug,I as rs,J as Pl}from"./firebase-BWFbkFVW-1754723551018.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function t(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(n){if(n.ep)return;n.ep=!0;const i=t(n);fetch(n.href,i)}})();var th={exports:{}},Do={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hg=b,fg=Symbol.for("react.element"),pg=Symbol.for("react.fragment"),mg=Object.prototype.hasOwnProperty,gg=hg.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,xg={key:!0,ref:!0,__self:!0,__source:!0};function rh(r,e,t){var s,n={},i=null,a=null;t!==void 0&&(i=""+t),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(a=e.ref);for(s in e)mg.call(e,s)&&!xg.hasOwnProperty(s)&&(n[s]=e[s]);if(r&&r.defaultProps)for(s in e=r.defaultProps,e)n[s]===void 0&&(n[s]=e[s]);return{$$typeof:fg,type:r,key:i,ref:a,props:n,_owner:gg.current}}Do.Fragment=pg;Do.jsx=rh;Do.jsxs=rh;th.exports=Do;var o=th.exports,sh,Wc=Xu;sh=Wc.createRoot,Wc.hydrateRoot;let yg={data:""},bg=r=>typeof window=="object"?((r?r.querySelector("#_goober"):window._goober)||Object.assign((r||document.head).appendChild(document.createElement("style")),{innerHTML:" ",id:"_goober"})).firstChild:r||yg,wg=/(?:([\u0080-\uFFFF\w-%@]+) *:? *([^{;]+?);|([^;}{]*?) *{)|(}\s*)/g,vg=/\/\*[^]*?\*\/|  +/g,Hc=/\n+/g,gr=(r,e)=>{let t="",s="",n="";for(let i in r){let a=r[i];i[0]=="@"?i[1]=="i"?t=i+" "+a+";":s+=i[1]=="f"?gr(a,i):i+"{"+gr(a,i[1]=="k"?"":e)+"}":typeof a=="object"?s+=gr(a,e?e.replace(/([^,])+/g,l=>i.replace(/([^,]*:\S+\([^)]*\))|([^,])+/g,c=>/&/.test(c)?c.replace(/&/g,l):l?l+" "+c:c)):i):a!=null&&(i=/^--/.test(i)?i:i.replace(/[A-Z]/g,"-$&").toLowerCase(),n+=gr.p?gr.p(i,a):i+":"+a+";")}return t+(e&&n?e+"{"+n+"}":n)+s},Jt={},nh=r=>{if(typeof r=="object"){let e="";for(let t in r)e+=t+nh(r[t]);return e}return r},Ng=(r,e,t,s,n)=>{let i=nh(r),a=Jt[i]||(Jt[i]=(c=>{let d=0,u=11;for(;d<c.length;)u=101*u+c.charCodeAt(d++)>>>0;return"go"+u})(i));if(!Jt[a]){let c=i!==r?r:(d=>{let u,h,f=[{}];for(;u=wg.exec(d.replace(vg,""));)u[4]?f.shift():u[3]?(h=u[3].replace(Hc," ").trim(),f.unshift(f[0][h]=f[0][h]||{})):f[0][u[1]]=u[2].replace(Hc," ").trim();return f[0]})(r);Jt[a]=gr(n?{["@keyframes "+a]:c}:c,t?"":"."+a)}let l=t&&Jt.g?Jt.g:null;return t&&(Jt.g=Jt[a]),((c,d,u,h)=>{h?d.data=d.data.replace(h,c):d.data.indexOf(c)===-1&&(d.data=u?c+d.data:d.data+c)})(Jt[a],e,s,l),a},jg=(r,e,t)=>r.reduce((s,n,i)=>{let a=e[i];if(a&&a.call){let l=a(t),c=l&&l.props&&l.props.className||/^go/.test(l)&&l;a=c?"."+c:l&&typeof l=="object"?l.props?"":gr(l,""):l===!1?"":l}return s+n+(a??"")},"");function To(r){let e=this||{},t=r.call?r(e.p):r;return Ng(t.unshift?t.raw?jg(t,[].slice.call(arguments,1),e.p):t.reduce((s,n)=>Object.assign(s,n&&n.call?n(e.p):n),{}):t,bg(e.target),e.g,e.o,e.k)}let ih,Fa,Ba;To.bind({g:1});let or=To.bind({k:1});function kg(r,e,t,s){gr.p=e,ih=r,Fa=t,Ba=s}function Rr(r,e){let t=this||{};return function(){let s=arguments;function n(i,a){let l=Object.assign({},i),c=l.className||n.className;t.p=Object.assign({theme:Fa&&Fa()},l),t.o=/ *go\d+/.test(c),l.className=To.apply(t,s)+(c?" "+c:"");let d=r;return r[0]&&(d=l.as||r,delete l.as),Ba&&d[0]&&Ba(l),ih(d,l)}return n}}var Sg=r=>typeof r=="function",Ei=(r,e)=>Sg(r)?r(e):r,Eg=(()=>{let r=0;return()=>(++r).toString()})(),oh=(()=>{let r;return()=>{if(r===void 0&&typeof window<"u"){let e=matchMedia("(prefers-reduced-motion: reduce)");r=!e||e.matches}return r}})(),Ag=20,ah=(r,e)=>{switch(e.type){case 0:return{...r,toasts:[e.toast,...r.toasts].slice(0,Ag)};case 1:return{...r,toasts:r.toasts.map(i=>i.id===e.toast.id?{...i,...e.toast}:i)};case 2:let{toast:t}=e;return ah(r,{type:r.toasts.find(i=>i.id===t.id)?1:0,toast:t});case 3:let{toastId:s}=e;return{...r,toasts:r.toasts.map(i=>i.id===s||s===void 0?{...i,dismissed:!0,visible:!1}:i)};case 4:return e.toastId===void 0?{...r,toasts:[]}:{...r,toasts:r.toasts.filter(i=>i.id!==e.toastId)};case 5:return{...r,pausedAt:e.time};case 6:let n=e.time-(r.pausedAt||0);return{...r,pausedAt:void 0,toasts:r.toasts.map(i=>({...i,pauseDuration:i.pauseDuration+n}))}}},pi=[],Xr={toasts:[],pausedAt:void 0},ws=r=>{Xr=ah(Xr,r),pi.forEach(e=>{e(Xr)})},Cg={blank:4e3,error:4e3,success:2e3,loading:1/0,custom:4e3},Mg=(r={})=>{let[e,t]=b.useState(Xr),s=b.useRef(Xr);b.useEffect(()=>(s.current!==Xr&&t(Xr),pi.push(t),()=>{let i=pi.indexOf(t);i>-1&&pi.splice(i,1)}),[]);let n=e.toasts.map(i=>{var a,l,c;return{...r,...r[i.type],...i,removeDelay:i.removeDelay||((a=r[i.type])==null?void 0:a.removeDelay)||(r==null?void 0:r.removeDelay),duration:i.duration||((l=r[i.type])==null?void 0:l.duration)||(r==null?void 0:r.duration)||Cg[i.type],style:{...r.style,...(c=r[i.type])==null?void 0:c.style,...i.style}}});return{...e,toasts:n}},Dg=(r,e="blank",t)=>({createdAt:Date.now(),visible:!0,dismissed:!1,type:e,ariaProps:{role:"status","aria-live":"polite"},message:r,pauseDuration:0,...t,id:(t==null?void 0:t.id)||Eg()}),Vn=r=>(e,t)=>{let s=Dg(e,r,t);return ws({type:2,toast:s}),s.id},Ne=(r,e)=>Vn("blank")(r,e);Ne.error=Vn("error");Ne.success=Vn("success");Ne.loading=Vn("loading");Ne.custom=Vn("custom");Ne.dismiss=r=>{ws({type:3,toastId:r})};Ne.remove=r=>ws({type:4,toastId:r});Ne.promise=(r,e,t)=>{let s=Ne.loading(e.loading,{...t,...t==null?void 0:t.loading});return typeof r=="function"&&(r=r()),r.then(n=>{let i=e.success?Ei(e.success,n):void 0;return i?Ne.success(i,{id:s,...t,...t==null?void 0:t.success}):Ne.dismiss(s),n}).catch(n=>{let i=e.error?Ei(e.error,n):void 0;i?Ne.error(i,{id:s,...t,...t==null?void 0:t.error}):Ne.dismiss(s)}),r};var Tg=(r,e)=>{ws({type:1,toast:{id:r,height:e}})},Og=()=>{ws({type:5,time:Date.now()})},hn=new Map,Rg=1e3,Ig=(r,e=Rg)=>{if(hn.has(r))return;let t=setTimeout(()=>{hn.delete(r),ws({type:4,toastId:r})},e);hn.set(r,t)},Pg=r=>{let{toasts:e,pausedAt:t}=Mg(r);b.useEffect(()=>{if(t)return;let i=Date.now(),a=e.map(l=>{if(l.duration===1/0)return;let c=(l.duration||0)+l.pauseDuration-(i-l.createdAt);if(c<0){l.visible&&Ne.dismiss(l.id);return}return setTimeout(()=>Ne.dismiss(l.id),c)});return()=>{a.forEach(l=>l&&clearTimeout(l))}},[e,t]);let s=b.useCallback(()=>{t&&ws({type:6,time:Date.now()})},[t]),n=b.useCallback((i,a)=>{let{reverseOrder:l=!1,gutter:c=8,defaultPosition:d}=a||{},u=e.filter(p=>(p.position||d)===(i.position||d)&&p.height),h=u.findIndex(p=>p.id===i.id),f=u.filter((p,m)=>m<h&&p.visible).length;return u.filter(p=>p.visible).slice(...l?[f+1]:[0,f]).reduce((p,m)=>p+(m.height||0)+c,0)},[e]);return b.useEffect(()=>{e.forEach(i=>{if(i.dismissed)Ig(i.id,i.removeDelay);else{let a=hn.get(i.id);a&&(clearTimeout(a),hn.delete(i.id))}})},[e]),{toasts:e,handlers:{updateHeight:Tg,startPause:Og,endPause:s,calculateOffset:n}}},Lg=or`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
 transform: scale(1) rotate(45deg);
  opacity: 1;
}`,$g=or`
from {
  transform: scale(0);
  opacity: 0;
}
to {
  transform: scale(1);
  opacity: 1;
}`,_g=or`
from {
  transform: scale(0) rotate(90deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(90deg);
	opacity: 1;
}`,Fg=Rr("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${r=>r.primary||"#ff4b4b"};
  position: relative;
  transform: rotate(45deg);

  animation: ${Lg} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;

  &:after,
  &:before {
    content: '';
    animation: ${$g} 0.15s ease-out forwards;
    animation-delay: 150ms;
    position: absolute;
    border-radius: 3px;
    opacity: 0;
    background: ${r=>r.secondary||"#fff"};
    bottom: 9px;
    left: 4px;
    height: 2px;
    width: 12px;
  }

  &:before {
    animation: ${_g} 0.15s ease-out forwards;
    animation-delay: 180ms;
    transform: rotate(90deg);
  }
`,Bg=or`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
`,Ug=Rr("div")`
  width: 12px;
  height: 12px;
  box-sizing: border-box;
  border: 2px solid;
  border-radius: 100%;
  border-color: ${r=>r.secondary||"#e0e0e0"};
  border-right-color: ${r=>r.primary||"#616161"};
  animation: ${Bg} 1s linear infinite;
`,zg=or`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(45deg);
	opacity: 1;
}`,Wg=or`
0% {
	height: 0;
	width: 0;
	opacity: 0;
}
40% {
  height: 0;
	width: 6px;
	opacity: 1;
}
100% {
  opacity: 1;
  height: 10px;
}`,Hg=Rr("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${r=>r.primary||"#61d345"};
  position: relative;
  transform: rotate(45deg);

  animation: ${zg} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;
  &:after {
    content: '';
    box-sizing: border-box;
    animation: ${Wg} 0.2s ease-out forwards;
    opacity: 0;
    animation-delay: 200ms;
    position: absolute;
    border-right: 2px solid;
    border-bottom: 2px solid;
    border-color: ${r=>r.secondary||"#fff"};
    bottom: 6px;
    left: 6px;
    height: 10px;
    width: 6px;
  }
`,Vg=Rr("div")`
  position: absolute;
`,qg=Rr("div")`
  position: relative;
  display: flex;
  justify-content: center;
  align-items: center;
  min-width: 20px;
  min-height: 20px;
`,Kg=or`
from {
  transform: scale(0.6);
  opacity: 0.4;
}
to {
  transform: scale(1);
  opacity: 1;
}`,Gg=Rr("div")`
  position: relative;
  transform: scale(0.6);
  opacity: 0.4;
  min-width: 20px;
  animation: ${Kg} 0.3s 0.12s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
`,Yg=({toast:r})=>{let{icon:e,type:t,iconTheme:s}=r;return e!==void 0?typeof e=="string"?b.createElement(Gg,null,e):e:t==="blank"?null:b.createElement(qg,null,b.createElement(Ug,{...s}),t!=="loading"&&b.createElement(Vg,null,t==="error"?b.createElement(Fg,{...s}):b.createElement(Hg,{...s})))},Jg=r=>`
0% {transform: translate3d(0,${r*-200}%,0) scale(.6); opacity:.5;}
100% {transform: translate3d(0,0,0) scale(1); opacity:1;}
`,Xg=r=>`
0% {transform: translate3d(0,0,-1px) scale(1); opacity:1;}
100% {transform: translate3d(0,${r*-150}%,-1px) scale(.6); opacity:0;}
`,Qg="0%{opacity:0;} 100%{opacity:1;}",Zg="0%{opacity:1;} 100%{opacity:0;}",e0=Rr("div")`
  display: flex;
  align-items: center;
  background: #fff;
  color: #363636;
  line-height: 1.3;
  will-change: transform;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1), 0 3px 3px rgba(0, 0, 0, 0.05);
  max-width: 350px;
  pointer-events: auto;
  padding: 8px 10px;
  border-radius: 8px;
`,t0=Rr("div")`
  display: flex;
  justify-content: center;
  margin: 4px 10px;
  color: inherit;
  flex: 1 1 auto;
  white-space: pre-line;
`,r0=(r,e)=>{let t=r.includes("top")?1:-1,[s,n]=oh()?[Qg,Zg]:[Jg(t),Xg(t)];return{animation:e?`${or(s)} 0.35s cubic-bezier(.21,1.02,.73,1) forwards`:`${or(n)} 0.4s forwards cubic-bezier(.06,.71,.55,1)`}},s0=b.memo(({toast:r,position:e,style:t,children:s})=>{let n=r.height?r0(r.position||e||"top-center",r.visible):{opacity:0},i=b.createElement(Yg,{toast:r}),a=b.createElement(t0,{...r.ariaProps},Ei(r.message,r));return b.createElement(e0,{className:r.className,style:{...n,...t,...r.style}},typeof s=="function"?s({icon:i,message:a}):b.createElement(b.Fragment,null,i,a))});kg(b.createElement);var n0=({id:r,className:e,style:t,onHeightUpdate:s,children:n})=>{let i=b.useCallback(a=>{if(a){let l=()=>{let c=a.getBoundingClientRect().height;s(r,c)};l(),new MutationObserver(l).observe(a,{subtree:!0,childList:!0,characterData:!0})}},[r,s]);return b.createElement("div",{ref:i,className:e,style:t},n)},i0=(r,e)=>{let t=r.includes("top"),s=t?{top:0}:{bottom:0},n=r.includes("center")?{justifyContent:"center"}:r.includes("right")?{justifyContent:"flex-end"}:{};return{left:0,right:0,display:"flex",position:"absolute",transition:oh()?void 0:"all 230ms cubic-bezier(.21,1.02,.73,1)",transform:`translateY(${e*(t?1:-1)}px)`,...s,...n}},o0=To`
  z-index: 9999;
  > * {
    pointer-events: auto;
  }
`,Jn=16,a0=({reverseOrder:r,position:e="top-center",toastOptions:t,gutter:s,children:n,containerStyle:i,containerClassName:a})=>{let{toasts:l,handlers:c}=Pg(t);return b.createElement("div",{id:"_rht_toaster",style:{position:"fixed",zIndex:9999,top:Jn,left:Jn,right:Jn,bottom:Jn,pointerEvents:"none",...i},className:a,onMouseEnter:c.startPause,onMouseLeave:c.endPause},l.map(d=>{let u=d.position||e,h=c.calculateOffset(d,{reverseOrder:r,gutter:s,defaultPosition:e}),f=i0(u,h);return b.createElement(n0,{id:d.id,key:d.id,onHeightUpdate:c.updateHeight,className:d.visible?o0:"",style:f},d.type==="custom"?Ei(d.message,d):n?n(d):b.createElement(s0,{toast:d,position:u}))}))},K=Ne;const l0={apiKey:"AIzaSyBktW6-GVYs7_Qqskwj1I_RO0KBsYiSGtU",authDomain:"infonest-m0707.firebaseapp.com",projectId:"infonest-m0707",storageBucket:"infonest-m0707.firebasestorage.app",messagingSenderId:"351328466797",appId:"1:351328466797:web:e4295d17db2451128b8c64",measurementId:"G-DYCBMWR5EG"},Ll=Xm().length===0?Qm(l0):Zm(),ke=eg(Ll),X=tg(Ll),Xs=rg(Ll);typeof window<"u"&&ke.useDeviceLanguage();const c0=r=>(r==null?void 0:r.code)==="permission-denied"?!0:(console.error("Firestore error:",r),!1);if(typeof window<"u"){window.addEventListener("unhandledrejection",t=>{var s,n;(((s=t.reason)==null?void 0:s.code)==="permission-denied"||(n=t.reason)!=null&&n.message&&t.reason.message.includes("permission-denied"))&&(c0(t.reason),t.preventDefault())});const r=console.error,e=console.log;console.error=(...t)=>{const s=t.join(" ");s.includes("Failed to update share count")||s.includes("shareCount")||s.includes("permission-denied")&&s.includes("Firestore")||s.includes("Missing or insufficient permissions")||r.apply(console,t)},console.log=(...t)=>{const s=t.join(" ");s.includes("Recording share event:")||s.includes("Share event data:")||s.includes("Share event recorded successfully")||s.includes("📤")||s.includes("✅ Share event recorded")||e.apply(console,t)}}const Xn=Object.freeze(Object.defineProperty({__proto__:null,auth:ke,firestore:X,storage:Xs},Symbol.toStringTag,{value:"Module"})),d0="modulepreload",u0=function(r){return"/InfoNest/"+r},Vc={},Ue=function(e,t,s){let n=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),l=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));n=Promise.allSettled(t.map(c=>{if(c=u0(c),c in Vc)return;Vc[c]=!0;const d=c.endsWith(".css"),u=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${u}`))return;const h=document.createElement("link");if(h.rel=d?"stylesheet":d0,d||(h.as="script"),h.crossOrigin="",h.href=c,l&&h.setAttribute("nonce",l),document.head.appendChild(h),d)return new Promise((f,p)=>{h.addEventListener("load",f),h.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${c}`)))})}))}function i(a){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=a,window.dispatchEvent(l),!l.defaultPrevented)throw a}return n.then(a=>{for(const l of a||[])l.status==="rejected"&&i(l.reason);return e().catch(i)})},Kr=class Kr{constructor(){Me(this,"cache",new Map);Me(this,"CACHE_DURATION",30*60*1e3);Me(this,"STORAGE_KEY","infonest_auth_cache")}static getInstance(){return Kr.instance||(Kr.instance=new Kr),Kr.instance}generatePermissions(e){const{role:t}=e,s={canCreateArticles:!1,canManageUsers:!1,canEditAnyArticle:!1,canAccessAdmin:!1,canAccessInfoWriter:!1,canDeleteOwnArticles:!1,canDeleteInfowriterArticles:!1,canReadPublishedArticles:!0,canReadOwnArticles:!0,canReadAllArticles:!1,allowedRoutes:["/","/dashboard","/profile"],dashboardRoute:"/dashboard"};switch(t){case"admin":return{...s,canCreateArticles:!0,canManageUsers:!0,canEditAnyArticle:!1,canAccessAdmin:!0,canAccessInfoWriter:!0,canDeleteOwnArticles:!0,canDeleteInfowriterArticles:!0,canReadAllArticles:!0,allowedRoutes:[...s.allowedRoutes,"/admin","/admin/writer-requests","/admin/active-writers","/admin/removed-writers","/admin/system","/personal-dashboard","/article/new","/article/edit/:id","/article/:id","/my-articles","/search","/writer-request","/saved-articles"]};case"infowriter":return{...s,canCreateArticles:!0,canAccessInfoWriter:!0,canDeleteOwnArticles:!0,canDeleteInfowriterArticles:!1,allowedRoutes:[...s.allowedRoutes,"/article/new","/article/edit/:id","/article/:id","/my-articles","/search","/writer-request","/saved-articles"]};case"user":default:return{...s,allowedRoutes:[...s.allowedRoutes,"/article/:id","/writer-request","/saved-articles"]}}}cacheUserSession(e){const t=Date.now(),s=this.generatePermissions(e),n={userProfile:e,permissions:s,lastUpdated:t,expiresAt:t+this.CACHE_DURATION};return this.cache.set(e.uid,n),this.persistToStorage(e.uid,n),n}getCachedSession(e){let t=this.cache.get(e);return t||(t=this.loadFromStorage(e),t&&this.cache.set(e,t)),t&&Date.now()<t.expiresAt?t:(t&&this.clearUserSession(e),null)}hasRoutePermission(e,t){const s=this.getCachedSession(e);return s?s.permissions.allowedRoutes.some(n=>{if(n.includes(":")){const i=n.replace(/:[^/]+/g,"[^/]+");return new RegExp(`^${i}$`).test(t)}return t===n||t.startsWith(n+"/")}):!1}clearUserSession(e){this.cache.delete(e),localStorage.removeItem(`${this.STORAGE_KEY}_${e}`)}clearAllSessions(){this.cache.clear();try{Object.keys(localStorage).forEach(e=>{(e.startsWith(this.STORAGE_KEY)||e.startsWith("infonest_"))&&localStorage.removeItem(e)}),Object.keys(sessionStorage).forEach(e=>{(e.startsWith(this.STORAGE_KEY)||e.startsWith("infonest_"))&&sessionStorage.removeItem(e)})}catch(e){console.warn("Failed to clear storage:",e)}}persistToStorage(e,t){var s,n;try{localStorage.setItem(`${this.STORAGE_KEY}_${e}`,JSON.stringify({...t,userProfile:{...t.userProfile,createdAt:(s=t.userProfile.createdAt)==null?void 0:s.getTime(),updatedAt:(n=t.userProfile.updatedAt)==null?void 0:n.getTime()}}))}catch(i){console.warn("Failed to persist auth cache:",i)}}loadFromStorage(e){try{const t=localStorage.getItem(`${this.STORAGE_KEY}_${e}`);if(!t)return null;const s=JSON.parse(t);return{...s,userProfile:{...s.userProfile,createdAt:s.userProfile.createdAt?new Date(s.userProfile.createdAt):void 0,updatedAt:s.userProfile.updatedAt?new Date(s.userProfile.updatedAt):void 0}}}catch{return null}}};Me(Kr,"instance");let Ua=Kr;const ur=Ua.getInstance(),h0=async(r,e,t)=>{try{const s=await ng(ke,r,e);t&&await ig(s.user,{displayName:t});const i=`${window.location.origin}/#/verify-email`;return await Zu(s.user,{url:i,handleCodeInApp:!1}),{user:s.user,email:r,displayName:t}}catch(s){if(console.error("Signup error:",s),ke.currentUser)try{await ke.currentUser.delete()}catch(n){console.error("Failed to cleanup failed user creation:",n)}throw s}},f0=async r=>{var s;if(!r.emailVerified){try{await Co(ke)}catch(n){console.error("Failed to sign out unverified user:",n)}return}const e=he(X,"users",r.uid);if(!(await It(e)).exists()){const n={uid:r.uid,email:r.email,role:"user",displayName:r.displayName||((s=r.email)==null?void 0:s.split("@")[0])||"",createdAt:new Date,updatedAt:new Date,requestedWriterAccess:!1,emailVerified:!0};await bs(e,{...n,createdAt:new Date,updatedAt:new Date})}},p0=async(r,e)=>{const t=await sg(ke,r,e);if(await t.user.reload(),t.user.emailVerified||(await new Promise(s=>setTimeout(s,1e3)),await t.user.reload()),!t.user.emailVerified)throw await Co(ke),new Error("Please verify your email address before signing in. Check your inbox for the verification link.");return t},lh=async()=>{ur.clearAllSessions();try{localStorage.clear(),sessionStorage.clear()}catch(r){console.warn("Failed to clear storage:",r)}document.cookie.split(";").forEach(r=>{const e=r.indexOf("="),t=e>-1?r.substr(0,e):r;document.cookie=t+"=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/"}),await Co(ke),await new Promise(r=>setTimeout(r,100))},m0=async r=>{const e=he(X,"users",r);await qe(e,{role:"infowriter",requestedWriterAccess:!1,updatedAt:new Date})},g0=async(r,e,t)=>{console.log(`🗑️ Starting comprehensive InfoWriter privilege removal for: ${r}`);try{const{hardDeleteArticle:s,cleanupArticleRelatedData:n}=await Ue(async()=>{const{hardDeleteArticle:f,cleanupArticleRelatedData:p}=await Promise.resolve().then(()=>Xl);return{hardDeleteArticle:f,cleanupArticleRelatedData:p}},void 0),{deleteUserFolder:i}=await Ue(async()=>{const{deleteUserFolder:f}=await Promise.resolve().then(()=>Va);return{deleteUserFolder:f}},void 0),{createNotification:a}=await Ue(async()=>{const{createNotification:f}=await Promise.resolve().then(()=>$l);return{createNotification:f}},void 0);let l=0;console.log(`📄 Fetching ALL articles by user: ${r}`);const c=xe(pe(X,"articles"),Oe("authorId","==",r)),d=await vt(c);if(console.log(`📊 Found ${d.docs.length} articles to delete (all statuses: published, unpublished, draft, archive)`),!d.empty){const f=d.docs.map(async p=>{try{const m=p.id,g=p.data();console.log(`🗑️ Deleting article: ${g.title} (${m}) - Status: ${g.status}`),await s(m),l++,console.log(`✅ Successfully deleted article: ${m} (${g.status})`)}catch(m){console.error(`❌ Failed to delete article: ${p.id}`,m)}});await Promise.all(f),console.log(`✅ Completed article deletion: ${l} articles deleted (all statuses)`)}try{console.log(`🗑️ Deleting user storage folder: articles/${r}/`),await i(r),console.log("✅ Successfully deleted user storage folder")}catch(f){console.error("⚠️ Failed to delete user storage folder:",f)}console.log("👤 Updating user role from infowriter to user");const u=he(X,"users",r);await qe(u,{role:"user",previousRoles:[r],privilegesRemovedAt:kn(),privilegesRemovedBy:e,adminNote:t.trim(),articleCountAtRemoval:l,updatedAt:new Date}),console.log("✅ User role updated successfully");const h=`Your InfoWriter privileges have been removed by an administrator. Reason: ${t.trim()}. ${l>0?`All ${l} of your articles (published, unpublished, drafts, and archived) have been permanently removed from the database and storage.`:"You had no articles to remove."} Contact support if you have questions.`;return await a(r,"writer_privileges_removed","InfoWriter Privileges Removed",h),console.log("✅ Notification sent to user"),console.log("🎉 InfoWriter privilege removal completed successfully"),{deletedArticlesCount:l}}catch(s){throw console.error("Error during InfoWriter privilege removal:",s),s}},x0=async()=>{const r=new og,e=await ag(ke,r),t=he(X,"users",e.user.uid);if(!(await It(t)).exists()){const n={uid:e.user.uid,email:e.user.email,role:"user",displayName:e.user.displayName||"",emailVerified:!0,createdAt:new Date,updatedAt:new Date,requestedWriterAccess:!1};await bs(t,{...n,createdAt:new Date,updatedAt:new Date}),console.log("✅ Google user profile created")}return e},ve=()=>{const[r,e]=b.useState(null),[t,s]=b.useState(null),[n,i]=b.useState(null),[a,l]=b.useState(!0),[c,d]=b.useState(!1),u=async()=>{var N,w,v;if(ke.currentUser){d(!0);try{await ke.currentUser.reload();const M=ke.currentUser,E=he(X,"users",M.uid),L=await It(E);if(L.exists()){const I=L.data();s({uid:M.uid,email:M.email||"",displayName:I.displayName||M.displayName||((N=M.email)==null?void 0:N.split("@")[0])||"",role:I.role||"user",emailVerified:M.emailVerified,profilePicture:I.profilePicture||"",bio:I.bio||"",socialLinks:I.socialLinks||{},createdAt:(w=I.createdAt)==null?void 0:w.toDate(),updatedAt:(v=I.updatedAt)==null?void 0:v.toDate(),requestedWriterAccess:I.requestedWriterAccess})}}catch(M){console.error("Failed to refresh profile:",M)}finally{d(!1)}}},h=b.useCallback(async N=>{if(N.emailVerified){d(!0);try{const w=ur.getCachedSession(N.uid);if(w&&Date.now()-w.lastUpdated<5*60*1e3){s(w.userProfile),i(w.permissions),d(!1);return}const v=he(X,"users",N.uid);Ee(v,M=>{var E,L,I;if(M.exists()){const W=M.data(),H={uid:N.uid,email:N.email||"",displayName:W.displayName||N.displayName||((E=N.email)==null?void 0:E.split("@")[0])||"",role:W.role||"user",emailVerified:N.emailVerified,profilePicture:W.profilePicture||"",bio:W.bio||"",socialLinks:W.socialLinks||{},createdAt:(L=W.createdAt)==null?void 0:L.toDate(),updatedAt:(I=W.updatedAt)==null?void 0:I.toDate(),requestedWriterAccess:W.requestedWriterAccess},R=ur.cacheUserSession(H);s(H),i(R.permissions),d(!1)}else s(null),i(null),d(!1)},M=>{if(M.code==="permission-denied"){s(null),i(null),d(!1);return}console.error("Error in profile snapshot:",M),s(null),i(null),d(!1)})}catch(w){console.error("Error loading user profile:",w),s(null),i(null),d(!1)}}},[]);b.useEffect(()=>{const N=Mo(ke,async w=>{if(l(!0),e(w),w){try{await w.reload()}catch{}if(w.emailVerified)try{await f0(w),await h(w)}catch(v){v.code==="permission-denied"?(s(null),i(null),ur.clearAllSessions()):console.error("Error creating/loading user profile:",v)}else s(null),i(null),ur.clearAllSessions()}else{e(null),s(null),i(null),ur.clearAllSessions();try{localStorage.removeItem("infonest_auth_cache"),Object.keys(localStorage).forEach(v=>{v.startsWith("infonest_")&&localStorage.removeItem(v)})}catch(v){console.warn("Failed to clear auth storage:",v)}}l(!1)});return()=>N()},[]),b.useEffect(()=>{if(!r||!r.emailVerified)return;const N=he(X,"users",r.uid),w=Ee(N,v=>{var M,E,L;if(v.exists()){const I=v.data(),W={uid:r.uid,email:r.email||"",displayName:I.displayName||r.displayName||((M=r.email)==null?void 0:M.split("@")[0])||"",role:I.role||"user",emailVerified:r.emailVerified,profilePicture:I.profilePicture||"",bio:I.bio||"",socialLinks:I.socialLinks||{},createdAt:(E=I.createdAt)==null?void 0:E.toDate(),updatedAt:(L=I.updatedAt)==null?void 0:L.toDate(),requestedWriterAccess:I.requestedWriterAccess};s(W),W&&ur.cacheUserSession(W)}},v=>{v.code!=="permission-denied"&&console.error("Error in user profile subscription:",v)});return()=>w()},[r]);const f=b.useCallback(N=>(t==null?void 0:t.role)===N,[t]),p=b.useCallback(N=>t?N.includes(t.role):!1,[t]),m=b.useMemo(()=>(n==null?void 0:n.canCreateArticles)||!1,[n]),g=b.useMemo(()=>(n==null?void 0:n.canManageUsers)||!1,[n]),y=b.useCallback((N,w)=>!t||w==="archive"?!1:t.uid===N,[t]),x=b.useCallback((N,w)=>!t||!n?!1:t.uid===N?n.canDeleteOwnArticles:t.role==="admin"?n.canDeleteInfowriterArticles:!1,[t,n]),S=b.useCallback((N,w)=>N==="published"?!0:N==="archive"?t?t.uid===w||t.role==="admin":!1:t?t.uid===w:!1,[t]),C=b.useCallback(N=>r?ur.hasRoutePermission(r.uid,N):!1,[r]),k=b.useCallback(()=>(n==null?void 0:n.dashboardRoute)||"/dashboard",[n]),j=N=>(t==null?void 0:t.role)===N,O=N=>{if(!t)return!1;const w={user:1,infowriter:2,admin:3},v=w[t.role],M=w[N];return v>=M};return{user:r,userProfile:t,permissions:n,isAuthenticated:!!r&&!!t,emailVerified:(r==null?void 0:r.emailVerified)||!1,loading:a||c,profileLoading:c,isAdmin:(t==null?void 0:t.role)==="admin",isInfoWriter:(t==null?void 0:t.role)==="infowriter"||(t==null?void 0:t.role)==="admin",isUser:(t==null?void 0:t.role)==="user",hasRole:f,hasAnyRole:p,canCreateArticles:m,canManageUsers:g,canEditArticle:y,canDeleteArticle:x,canReadArticle:S,hasRoutePermission:C,getDashboardRoute:k,refreshProfile:u,isUserRole:j,hasMinimumRole:O}},Oo=async(r,e,t,s,n)=>{try{const i=he(pe(X,"notifications")),a={userId:r,type:e,title:t,message:s,isRead:!1,createdAt:Le.fromDate(new Date)};if(n!==void 0){const l={};Object.keys(n).forEach(c=>{n[c]!==void 0&&(l[c]=n[c])}),Object.keys(l).length>0&&(a.metadata=l)}await bs(i,a)}catch{throw new Error("Failed to create notification")}},ch=async(r,e="user")=>{await Oo(r,"role_approval","InfoWriter Request Approved!","Your InfoWriter request has been approved! You can now create and manage articles.",{previousRole:e,newRole:"infowriter"})},dh=async(r,e)=>{const t=e?`Your InfoWriter request has been rejected. Reason: ${e}. You can submit a new request after addressing the feedback.`:"Your InfoWriter request has been rejected. You can submit a new request in the future.",s={previousRole:"user",newRole:"user",status:"rejected"};e&&e.trim()&&(s.adminNote=e.trim()),await Oo(r,"role_approval","InfoWriter Request Update",t,s)},y0=async(r,e,t,s="user")=>{e==="approved"?await ch(r,s):await dh(r,t)},b0=async(r,e,t)=>{const s=t?`Your article "${e}" has been deleted by an administrator. Reason: ${t}. If you have questions about this action, please contact support.`:`Your article "${e}" has been deleted by an administrator. If you have questions about this action, please contact support.`,n={articleTitle:e,deletedBy:"admin"};t&&t.trim()&&(n.deleteReason=t.trim()),await Oo(r,"article_deleted","Article Deleted",s,n)},uh=(r,e)=>{const t=xe(pe(X,"notifications"),Oe("userId","==",r),Wn("createdAt","desc"));return Ee(t,s=>{const n=s.docs.map(i=>{var l;const a=i.data();return{id:i.id,...a,createdAt:a.createdAt.toDate(),readAt:(l=a.readAt)==null?void 0:l.toDate()}});e(n)},s=>{if(s.code==="permission-denied"){e([]);return}console.error("Error in notifications subscription:",s),e([])})},hh=async r=>{try{const e=he(X,"notifications",r);await qe(e,{isRead:!0,readAt:Le.now()})}catch(e){throw console.error("Error marking notification as read:",e),new Error("Failed to mark notification as read")}},fh=async r=>{try{const e=xe(pe(X,"notifications"),Oe("userId","==",r),Oe("isRead","==",!1)),s=(await vt(e)).docs.map(n=>qe(n.ref,{isRead:!0,readAt:Le.now()}));await Promise.all(s)}catch(e){throw console.error("Error marking all notifications as read:",e),new Error("Failed to mark all notifications as read")}},ph=async r=>{try{const e=he(X,"notifications",r);await Rt(e)}catch{throw new Error("Failed to delete notification")}},mh=r=>r.filter(e=>!e.isRead).length,$l=Object.freeze(Object.defineProperty({__proto__:null,createArticleDeletionNotification:b0,createInfoWriterApprovalNotification:ch,createInfoWriterRejectionNotification:dh,createInfoWriterStatusNotification:y0,createNotification:Oo,deleteNotification:ph,getUnreadNotificationCount:mh,markAllNotificationsAsRead:fh,markNotificationAsRead:hh,subscribeToUserNotifications:uh},Symbol.toStringTag,{value:"Module"})),gh=b.createContext(void 0),w0=({children:r})=>{const{userProfile:e}=ve(),[t,s]=b.useState([]),[n,i]=b.useState(!0),[a,l]=b.useState(new Set);b.useEffect(()=>{if(!(e!=null&&e.uid)){s([]),i(!1),l(new Set);return}return i(!0),uh(e.uid,g=>{i(!1);const y=g.filter(x=>!x.isRead&&x.type==="role_approval"&&!a.has(x.id));y.length>0&&"Notification"in window&&(Notification.permission==="granted"?(y.forEach(x=>{new Notification(x.title,{body:x.message,icon:"/InfoNest/ChatGPT Image Jul 22, 2025, 11_54_47 AM.png",tag:x.id})}),l(x=>{const S=new Set(x);return y.forEach(C=>S.add(C.id)),S})):Notification.permission!=="denied"&&Notification.requestPermission().then(x=>{x==="granted"&&(y.forEach(S=>{new Notification(S.title,{body:S.message,icon:"/InfoNest/ChatGPT Image Jul 22, 2025, 11_54_47 AM.png",tag:S.id})}),l(S=>{const C=new Set(S);return y.forEach(k=>C.add(k.id)),C}))})),s(g)})},[e==null?void 0:e.uid]);const c=async m=>{try{await hh(m)}catch(g){console.error("Error marking notification as read:",g)}},d=async()=>{if(e!=null&&e.uid)try{await fh(e.uid)}catch(m){console.error("Error marking all notifications as read:",m)}},u=async m=>{try{await ph(m)}catch(g){console.error("Error deleting notification:",g)}},h=()=>{},f=mh(t),p={notifications:t,unreadCount:f,loading:n,markAsRead:c,markAllAsRead:d,deleteNotification:u,refreshNotifications:h};return o.jsx(gh.Provider,{value:p,children:r})},xh=b.createContext(void 0),v0=({children:r})=>{const[e,t]=b.useState(new Map),[s,n]=b.useState(new Map),i=u=>e.get(u)||null,a=u=>{if(s.has(u))return;const h=he(X,"users",u),f=Ee(h,p=>{var m,g;if(p.exists()){const y=p.data(),x={uid:u,email:y.email||"",displayName:y.displayName||"",role:y.role||"user",emailVerified:y.emailVerified||!1,profilePicture:y.profilePicture||"",createdAt:(m=y.createdAt)==null?void 0:m.toDate(),updatedAt:(g=y.updatedAt)==null?void 0:g.toDate(),requestedWriterAccess:y.requestedWriterAccess||!1};t(S=>{const C=new Map(S);return C.set(u,x),C})}else t(y=>{const x=new Map(y);return x.delete(u),x})},p=>{if(p.code==="permission-denied"){t(m=>{const g=new Map(m);return g.delete(u),g}),n(m=>{const g=new Map(m);return g.delete(u),g});return}console.error(`Error subscribing to profile ${u}:`,p)});n(p=>{const m=new Map(p);return m.set(u,f),m})},l=u=>{const h=s.get(u);h&&(h(),n(f=>{const p=new Map(f);return p.delete(u),p}))},c=()=>{s.forEach(u=>{try{u()}catch(h){console.warn("Error unsubscribing from profile:",h)}}),n(new Map),t(new Map)};b.useEffect(()=>Mo(ke,h=>{h||c()}),[]),b.useEffect(()=>()=>{s.forEach(u=>u())},[]);const d={profiles:e,getProfile:i,subscribeToProfile:a,unsubscribeFromProfile:l,clearAllProfiles:c};return o.jsx(xh.Provider,{value:d,children:r})},N0=()=>{const r=b.useContext(xh);if(r===void 0)throw new Error("useProfileContext must be used within a ProfileProvider");return r},j0=r=>{const{profiles:e,subscribeToProfile:t}=N0(),[s,n]=b.useState(null);return b.useEffect(()=>{if(!r){n(null);return}t(r)},[r,t]),b.useEffect(()=>{if(!r){n(null);return}const i=e.get(r)||null;n(i)},[e,r]),s};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var k0={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const S0=r=>r.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),G=(r,e)=>{const t=b.forwardRef(({color:s="currentColor",size:n=24,strokeWidth:i=2,absoluteStrokeWidth:a,className:l="",children:c,...d},u)=>b.createElement("svg",{ref:u,...k0,width:n,height:n,stroke:s,strokeWidth:a?Number(i)*24/Number(n):i,className:["lucide",`lucide-${S0(r)}`,l].join(" "),...d},[...e.map(([h,f])=>b.createElement(h,f)),...Array.isArray(c)?c:[c]]));return t.displayName=`${r}`,t};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const St=G("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ai=G("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E0=G("AlignCenter",[["line",{x1:"21",x2:"3",y1:"6",y2:"6",key:"1fp77t"}],["line",{x1:"17",x2:"7",y1:"12",y2:"12",key:"rsh8ii"}],["line",{x1:"19",x2:"5",y1:"18",y2:"18",key:"1t0tuv"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lt=G("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mi=G("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qc=G("Award",[["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}],["path",{d:"M15.477 12.89 17 22l-5-3-5 3 1.523-9.11",key:"em7aur"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const A0=G("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qn=G("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const C0=G("Bold",[["path",{d:"M14 12a4 4 0 0 0 0-8H6v8",key:"v2sylx"}],["path",{d:"M15 20a4 4 0 0 0 0-8H6v8Z",key:"1ef5ya"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zt=G("BookOpen",[["path",{d:"M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z",key:"vv98re"}],["path",{d:"M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z",key:"1cyq3y"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kc=G("BookmarkCheck",[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2Z",key:"169p4p"}],["path",{d:"m9 10 2 2 4-4",key:"1gnqz4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const M0=G("BookmarkX",[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2Z",key:"169p4p"}],["path",{d:"m14.5 7.5-5 5",key:"3lb6iw"}],["path",{d:"m9.5 7.5 5 5",key:"ko136h"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const br=G("Bookmark",[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z",key:"1fy3hk"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Us=G("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D0=G("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const T0=G("CheckCheck",[["path",{d:"M18 6 7 17l-5-5",key:"116fxf"}],["path",{d:"m22 10-7.5 7.5L13 16",key:"ke71qq"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sr=G("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _l=G("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ro=G("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O0=G("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jt=G("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R0=G("Code",[["polyline",{points:"16 18 22 12 16 6",key:"z7tu5w"}],["polyline",{points:"8 6 2 12 8 18",key:"1eg1df"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const I0=G("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gi=G("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P0=G("Expand",[["path",{d:"m21 21-6-6m6 6v-4.8m0 4.8h-4.8",key:"1c15vz"}],["path",{d:"M3 16.2V21m0 0h4.8M3 21l6-6",key:"1fsnz2"}],["path",{d:"M21 7.8V3m0 0h-4.8M21 3l-6 6",key:"hawz9i"}],["path",{d:"M3 7.8V3m0 0h4.8M3 3l6 6",key:"u9ee12"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L0=G("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zs=G("EyeOff",[["path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24",key:"1jxqfv"}],["path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68",key:"9wicm4"}],["path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61",key:"1jreej"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const us=G("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $0=G("Facebook",[["path",{d:"M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z",key:"1jg4f8"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gt=G("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yh=G("File",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _0=G("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ci=G("Folder",[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F0=G("Fullscreen",[["path",{d:"M3 7V5a2 2 0 0 1 2-2h2",key:"aa7l1z"}],["path",{d:"M17 3h2a2 2 0 0 1 2 2v2",key:"4qcy5o"}],["path",{d:"M21 17v2a2 2 0 0 1-2 2h-2",key:"6vwrx8"}],["path",{d:"M7 21H5a2 2 0 0 1-2-2v-2",key:"ioqczr"}],["rect",{width:"10",height:"8",x:"7",y:"8",rx:"1",key:"vys8me"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bh=G("Github",[["path",{d:"M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4",key:"tonef"}],["path",{d:"M9 18c-4.51 2-5-2-7-2",key:"9comsn"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wh=G("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B0=G("GraduationCap",[["path",{d:"M21.42 10.922a1 1 0 0 0-.019-1.838L12.83 5.18a2 2 0 0 0-1.66 0L2.6 9.08a1 1 0 0 0 0 1.832l8.57 3.908a2 2 0 0 0 1.66 0z",key:"j76jl0"}],["path",{d:"M22 10v6",key:"1lu8f3"}],["path",{d:"M6 12.5V16a6 3 0 0 0 12 0v-3.5",key:"1r8lef"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vh=G("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fl=G("Home",[["path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"y5dka4"}],["polyline",{points:"9 22 9 12 15 12 15 22",key:"e2us08"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _s=G("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gc=G("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U0=G("Italic",[["line",{x1:"19",x2:"10",y1:"4",y2:"4",key:"15jd3p"}],["line",{x1:"14",x2:"5",y1:"20",y2:"20",key:"bu0au3"}],["line",{x1:"15",x2:"9",y1:"4",y2:"20",key:"uljnxc"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z0=G("Link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bl=G("Linkedin",[["path",{d:"M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z",key:"c2jq9f"}],["rect",{width:"4",height:"12",x:"2",y:"9",key:"mk3on5"}],["circle",{cx:"4",cy:"4",r:"2",key:"bt5ra8"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W0=G("ListOrdered",[["line",{x1:"10",x2:"21",y1:"6",y2:"6",key:"76qw6h"}],["line",{x1:"10",x2:"21",y1:"12",y2:"12",key:"16nom4"}],["line",{x1:"10",x2:"21",y1:"18",y2:"18",key:"u3jurt"}],["path",{d:"M4 6h1v4",key:"cnovpq"}],["path",{d:"M4 10h2",key:"16xx2s"}],["path",{d:"M6 18H4c0-1 2-2 2-3s-1-1.5-2-1",key:"m9a95d"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H0=G("List",[["line",{x1:"8",x2:"21",y1:"6",y2:"6",key:"7ey8pc"}],["line",{x1:"8",x2:"21",y1:"12",y2:"12",key:"rjfblc"}],["line",{x1:"8",x2:"21",y1:"18",y2:"18",key:"c3b1m8"}],["line",{x1:"3",x2:"3.01",y1:"6",y2:"6",key:"1g7gq3"}],["line",{x1:"3",x2:"3.01",y1:"12",y2:"12",key:"1pjlvk"}],["line",{x1:"3",x2:"3.01",y1:"18",y2:"18",key:"28t2mc"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ve=G("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wr=G("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V0=G("LogIn",[["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}],["polyline",{points:"10 17 15 12 10 7",key:"1ail0h"}],["line",{x1:"15",x2:"3",y1:"12",y2:"12",key:"v6grx8"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ul=G("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wt=G("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q0=G("Maximize2",[["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["polyline",{points:"9 21 3 21 3 15",key:"1avn1i"}],["line",{x1:"21",x2:"14",y1:"3",y2:"10",key:"ota7mn"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Io=G("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nh=G("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K0=G("Minimize2",[["polyline",{points:"4 14 10 14 10 20",key:"11kfnr"}],["polyline",{points:"20 10 14 10 14 4",key:"rlmsce"}],["line",{x1:"14",x2:"21",y1:"10",y2:"3",key:"o5lafz"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jh=G("MoreVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G0=G("Palette",[["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z",key:"12rzf8"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yc=G("Paperclip",[["path",{d:"m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l8.57-8.57A4 4 0 1 1 18 8.84l-8.59 8.57a2 2 0 0 1-2.83-2.83l8.49-8.48",key:"1u3ebp"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mi=G("Pause",[["rect",{width:"4",height:"16",x:"6",y:"4",key:"iffhe4"}],["rect",{width:"4",height:"16",x:"14",y:"4",key:"sjin7j"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y0=G("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z",key:"ymcmye"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zl=G("PenTool",[["path",{d:"m12 19 7-7 3 3-7 7-3-3z",key:"rklqx2"}],["path",{d:"m18 13-1.5-7.5L2 2l3.5 14.5L13 18l5-5z",key:"1et58u"}],["path",{d:"m2 2 7.586 7.586",key:"etlp93"}],["circle",{cx:"11",cy:"11",r:"2",key:"xmgehs"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kh=G("Play",[["polygon",{points:"5 3 19 12 5 21 5 3",key:"191637"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const za=G("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J0=G("Quote",[["path",{d:"M3 21c3 0 7-1 7-8V5c0-1.25-.756-2.017-2-2H4c-1.25 0-2 .75-2 1.972V11c0 1.25.75 2 2 2 1 0 1 0 1 1v1c0 1-1 2-2 2s-1 .008-1 1.031V20c0 1 0 1 1 1z",key:"4rm80e"}],["path",{d:"M15 21c3 0 7-1 7-8V5c0-1.25-.757-2.017-2-2h-4c-1.25 0-2 .75-2 1.972V11c0 1.25.75 2 2 2h.75c0 2.25.25 4-2.75 4v3c0 1 0 1 1 1z",key:"10za9r"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X0=G("Redo",[["path",{d:"M21 7v6h-6",key:"3ptur4"}],["path",{d:"M3 17a9 9 0 0 1 9-9 9 9 0 0 1 6 2.3l3 2.7",key:"1kgawr"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q0=G("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Po=G("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sh=G("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Di=G("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sn=G("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z0=G("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sr=G("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wl=G("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a2.121 2.121 0 1 1 3 3L12 15l-4 1 1-4Z",key:"1lpok0"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ex=G("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hs=G("Tag",[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tr=G("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hl=G("Twitter",[["path",{d:"M22 4s-.7 2.1-2 3.4c1.6 10-9.4 17.3-18 11.6 2.2.1 4.4-.6 6-2C3 15.5.5 9.6 3 5c2.2 2.6 5.6 4.1 9 4-.9-4.2 4-6.6 7-3.8 1.1 0 3-1.2 3-1.2z",key:"pff0z6"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tx=G("Undo",[["path",{d:"M3 7v6h6",key:"1v2h90"}],["path",{d:"M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13",key:"1r6uu6"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rt=G("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wa=G("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rx=G("UserCog",[["circle",{cx:"18",cy:"15",r:"3",key:"gjjjvw"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M10 15H6a4 4 0 0 0-4 4v2",key:"1nfge6"}],["path",{d:"m21.7 16.4-.9-.3",key:"12j9ji"}],["path",{d:"m15.2 13.9-.9-.3",key:"1fdjdi"}],["path",{d:"m16.6 18.7.3-.9",key:"heedtr"}],["path",{d:"m19.1 12.2.3-.9",key:"1af3ki"}],["path",{d:"m19.6 18.7-.4-1",key:"1x9vze"}],["path",{d:"m16.8 12.3-.4-1",key:"vqeiwj"}],["path",{d:"m14.3 16.6 1-.4",key:"1qlj63"}],["path",{d:"m20.7 13.8 1-.4",key:"1v5t8k"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ra=G("UserMinus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ha=G("UserX",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _e=G("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Eh=G("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fn=G("WifiOff",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}],["path",{d:"M5 12.859a10 10 0 0 1 5.17-2.69",key:"1dl1wf"}],["path",{d:"M19 12.859a10 10 0 0 0-2.007-1.523",key:"4k23kn"}],["path",{d:"M2 8.82a15 15 0 0 1 4.177-2.643",key:"1grhjp"}],["path",{d:"M22 8.82a15 15 0 0 0-11.288-3.764",key:"z3jwby"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ah=G("Wifi",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xi=G("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const et=G("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vl=G("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]),Ps=({children:r,requiredRole:e,requiredRoles:t,fallbackPath:s="/dashboard",showError:n=!0})=>{const{userProfile:i,loading:a,isAuthenticated:l,hasRole:c,hasAnyRole:d,hasRoutePermission:u}=ve(),h=zn();if(i&&t&&h.pathname==="/my-articles"){const m=i.role;if(m==="infowriter"||m==="admin")return o.jsx(o.Fragment,{children:r})}const f=b.useMemo(()=>i?e?c(e):t?d(t):!0:!1,[i,e,t,c,d]),p=b.useMemo(()=>i?u(h.pathname):!1,[u,h.pathname,i]);if(a&&!i)return h.pathname==="/dashboard"?o.jsx("div",{className:"flex items-center justify-center min-h-32",children:o.jsx("div",{className:"animate-spin h-6 w-6 border-2 border-blue-500 border-t-transparent rounded-full"})}):o.jsx("div",{className:"flex items-center justify-center min-h-64",children:o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"animate-spin h-8 w-8 border-2 border-blue-500 border-t-transparent rounded-full mx-auto mb-4"}),o.jsx("p",{className:"text-gray-600",children:"Verifying permissions..."})]})});if(!l)return o.jsx($e,{to:"/auth",state:{from:h},replace:!0});if(!i)return o.jsx("div",{className:"flex items-center justify-center min-h-64",children:o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"animate-spin h-8 w-8 border-2 border-blue-500 border-t-transparent rounded-full mx-auto mb-4"}),o.jsx("p",{className:"text-gray-600",children:"Loading user profile..."})]})});if(h.pathname==="/dashboard"&&(i==null?void 0:i.role)==="infowriter")return o.jsx(o.Fragment,{children:r});if(!f||!p){if(n){const m=e||(t==null?void 0:t.join(" or "));h.pathname.includes("/article/")&&(t!=null&&t.includes("user"))||K.error(`You need ${m} privileges to access this page`)}return o.jsx($e,{to:s,replace:!0})}return o.jsx(o.Fragment,{children:r})},sa=({children:r})=>o.jsx(Ps,{requiredRole:"admin",children:r}),rn=({children:r})=>o.jsx(Ps,{requiredRoles:["user","infowriter","admin"],children:r}),sx=({role:r})=>{const t=(n=>{switch(n){case"admin":return{color:"bg-red-100 text-red-700 border-red-200",icon:Sr,label:"Admin"};case"infowriter":return{color:"bg-blue-100 text-blue-700 border-blue-200",icon:Sr,label:"InfoWriter"};default:return{color:"bg-gray-100 text-gray-700 border-gray-200",icon:Sr,label:"User"}}})(r),s=t.icon;return o.jsxs("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium border ${t.color}`,children:[o.jsx(s,{className:"h-3 w-3 mr-1"}),t.label]})},Ch=["image/jpeg","image/jpg","image/png","image/gif","image/webp"],nx=["application/pdf","text/plain","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"],ix=[...Ch,...nx],ox=10*1024*1024,Lo=r=>ix.includes(r.type)?r.size>ox?{isValid:!1,error:"File size too large. Maximum size is 10MB."}:{isValid:!0}:{isValid:!1,error:"File type not supported. Please upload images (JPEG, PNG, GIF, WebP) or documents (PDF, TXT, DOC, DOCX)."},Mh=(r,e,t,s)=>{const n=Date.now(),a=r.replace(/[<>:"/\\|?*]/g,"_").replace(/\s+/g,"_").replace(/_{2,}/g,"_").replace(/^_+|_+$/g,"").split("."),l=a.pop()||"",d=`${a.join(".")||"file"}_${n}.${l}`;if(s==="articles"){if(!t)throw new Error("Article ID is required for article file uploads. Please save the article first to get an ID.");return`${e}/${t}/${d}`}else return`${e}/${d}`},ql=async(r,e,t="articles",s,n)=>{const i=Lo(r);if(!i.isValid)throw console.error("File validation failed:",i.error),new Error(i.error);const a=Mh(r.name,e,n,t),l=`${t}/${a}`,c=Hn(Xs,l);try{const d=await lg(c,r);return{url:await eh(d.ref),path:l,name:a.split("/").pop()||r.name,originalName:r.name,size:r.size,type:r.type}}catch(d){throw console.error("Upload failed:",d),d.code==="storage/unauthorized"?new Error("Permission denied. Please check your authentication and storage rules."):d.code==="storage/canceled"?new Error("Upload was canceled."):d.code==="storage/unknown"?new Error("Unknown error occurred. Please check your internet connection and try again."):d.code==="storage/invalid-format"?new Error("Invalid file format. Please check the file type."):d.code==="storage/object-not-found"?new Error("Storage location not found. Please contact support."):new Error(`Upload failed: ${d.message||"Unknown error"}`)}},Kl=async r=>{try{const e=Hn(Xs,r);await Si(e)}catch(e){if(console.error("Error deleting file:",e),(e==null?void 0:e.code)==="storage/object-not-found")return;throw new Error(`Failed to delete file: ${(e==null?void 0:e.message)||"Unknown error"}`)}},Gl=r=>Ch.includes(r),Yl=r=>{if(!r||typeof r!="string")return null;try{if(r.includes("firebasestorage.googleapis.com")){const t=new URL(r).pathname.match(/\/o\/(.+?)\?/);if(t)return decodeURIComponent(t[1])}return r.startsWith("gs://")?r.replace(/^gs:\/\/[^\/]+\//,""):null}catch(e){return console.error("Error extracting file path from URL:",r,e),null}},Dh=async(r,e)=>{console.log(`🗑️ Starting article folder deletion: articles/${r}/${e}`);try{const{listAll:t}=await Ue(async()=>{const{listAll:a}=await import("./firebase-BWFbkFVW-1754723551018.js").then(l=>l.L);return{listAll:a}},[]),s=`articles/${r}/${e}`,n=Hn(Xs,s);console.log(`📁 Listing files in folder: ${s}`);const i=await t(n);if(console.log(`📁 Found ${i.items.length} files in folder: ${s}`),i.items.length>0){console.log(`🗑️ Deleting ${i.items.length} files from folder: ${s}`);const a=i.items.map(async(u,h)=>{try{return console.log(`🗑️ Deleting file ${h+1}/${i.items.length}: ${u.fullPath}`),await Si(u),console.log(`✅ Successfully deleted file: ${u.fullPath}`),{success:!0,path:u.fullPath}}catch(f){return console.error(`❌ Failed to delete file: ${u.fullPath}`,f),{success:!1,path:u.fullPath,error:f.message}}}),l=await Promise.all(a),c=l.filter(u=>u.success).length,d=l.filter(u=>!u.success).length;if(console.log(`📊 File deletion summary for ${s}: ${c} successful, ${d} failed`),d>0){const u=l.filter(h=>!h.success);throw console.error(`❌ Failed to delete ${d} files:`,u),new Error(`Failed to delete ${d} out of ${i.items.length} files`)}console.log(`✅ Successfully deleted all ${c} files from folder: ${s}`)}else console.log(`📁 Article folder is empty or doesn't exist: ${s}`);try{const a=await t(n);if(a.items.length>0)throw console.error(`❌ Folder still contains ${a.items.length} files after deletion: ${s}`),new Error(`Folder cleanup incomplete: ${a.items.length} files remain`);console.log(`✅ Verified folder is empty: ${s}`)}catch(a){(a==null?void 0:a.code)==="storage/object-not-found"?console.log(`✅ Folder no longer exists (expected): ${s}`):console.error(`⚠️ Could not verify folder deletion: ${s}`,a)}console.log(`✅ Article folder deletion completed: ${s}`)}catch(t){if(console.error(`❌ Error deleting article folder: articles/${r}/${e}`,t),(t==null?void 0:t.code)==="storage/object-not-found"){console.log(`📁 Article folder already deleted: articles/${r}/${e}`);return}throw new Error(`Failed to delete article folder: ${(t==null?void 0:t.message)||"Unknown error"}`)}},ax=async r=>{console.log(`🗑️ Starting user folder deletion: articles/${r}/`);try{const{listAll:e}=await Ue(async()=>{const{listAll:d}=await import("./firebase-BWFbkFVW-1754723551018.js").then(u=>u.L);return{listAll:d}},[]),t=`articles/${r}`,s=Hn(Xs,t);console.log(`📁 Listing all content in user folder: ${t}`);const n=await e(s),i=n.items.length,a=n.prefixes.length;console.log(`📁 Found ${i} files and ${a} subfolders in user folder: ${t}`);let l=0,c=0;if(i>0){console.log(`🗑️ Deleting ${i} files from user folder: ${t}`);const d=n.items.map(async(u,h)=>{try{console.log(`🗑️ Deleting file ${h+1}/${i}: ${u.fullPath}`),await Si(u),console.log(`✅ Successfully deleted file: ${u.fullPath}`),l++}catch(f){console.error(`❌ Failed to delete file: ${u.fullPath}`,f),c++}});await Promise.all(d)}if(a>0){console.log(`🗑️ Deleting ${a} subfolders from user folder: ${t}`);const d=n.prefixes.map(async(u,h)=>{try{const f=u.fullPath;console.log(`🗑️ Deleting subfolder ${h+1}/${a}: ${f}`);const p=await e(u);if(p.items.length>0){const m=p.items.map(async g=>{try{await Si(g),console.log(`✅ Deleted subfolder file: ${g.fullPath}`),l++}catch(y){console.error(`❌ Failed to delete subfolder file: ${g.fullPath}`,y),c++}});await Promise.all(m)}console.log(`✅ Successfully processed subfolder: ${f}`)}catch(f){console.error(`❌ Failed to process subfolder: ${u.fullPath}`,f)}});await Promise.all(d)}console.log(`📊 User folder deletion summary: ${l} files deleted, ${c} files failed`),c>0&&console.warn(`⚠️ Some files could not be deleted: ${c} failures`);try{const d=await e(s);d.items.length>0||d.prefixes.length>0?console.warn(`⚠️ User folder still contains content after deletion: ${d.items.length} files, ${d.prefixes.length} folders`):console.log(`✅ Verified user folder is empty: ${t}`)}catch(d){(d==null?void 0:d.code)==="storage/object-not-found"?console.log(`✅ User folder no longer exists (expected): ${t}`):console.error(`⚠️ Could not verify user folder deletion: ${t}`,d)}console.log(`✅ User folder deletion completed: ${t}`)}catch(e){if(console.error(`❌ Error deleting user folder: articles/${r}`,e),(e==null?void 0:e.code)==="storage/object-not-found"){console.log(`📁 User folder already deleted: articles/${r}`);return}throw new Error(`Failed to delete user folder: ${(e==null?void 0:e.message)||"Unknown error"}`)}},Va=Object.freeze(Object.defineProperty({__proto__:null,deleteArticleFolder:Dh,deleteFile:Kl,deleteUserFolder:ax,extractFilePathFromUrl:Yl,generateFileName:Mh,isImageFile:Gl,uploadFile:ql,validateFile:Lo},Symbol.toStringTag,{value:"Module"})),Th=r=>r.toLowerCase().replace(/[^a-z0-9 -]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").trim(),Oh=async r=>{try{const e=he(pe(X,"articles")),t=Th(r.title),s={...r,id:e.id,slug:t,createdAt:new Date,updatedAt:new Date,likes:0,likedBy:[]},n={...s,createdAt:Le.fromDate(s.createdAt),updatedAt:Le.fromDate(s.updatedAt)};return s.publishedAt?n.publishedAt=Le.fromDate(s.publishedAt):n.publishedAt=null,await bs(e,n),e.id}catch(e){throw console.error("Error in createArticle:",e),e}},$o=async(r,e)=>{const t=he(X,"articles",r),s=await It(t);if(!s.exists())throw new Error("Article not found");const n=s.data(),i={updatedAt:Le.fromDate(new Date),slug:e.title?Th(e.title):n.slug};if(Object.keys(e).forEach(a=>{e[a]!==void 0&&(i[a]=e[a])}),e.status==="published"&&n.status!=="published"){const a=new Date;i.publishedAt=Le.fromDate(a),i.updatedAt=Le.fromDate(a)}else e.publishedAt?i.publishedAt=Le.fromDate(e.publishedAt):e.publishedAt===null&&(i.publishedAt=null);await qe(t,i)},Rh=async r=>{console.log(`🗑️ Starting article deletion: ${r}`);try{const e=he(X,"articles",r);console.log(`📄 Fetching article document: ${r}`);const t=await It(e);if(t.exists()){const s=t.data(),n=s.authorId;if(console.log(`📄 Article found - Author: ${n}, Title: ${s.title}`),console.log(`🗑️ Deleting article document from Firestore: ${r}`),await Rt(e),console.log(`✅ Article document deleted from Firestore: ${r}`),(await It(e)).exists())throw new Error(`❌ Article document still exists after deletion: ${r}`);if(console.log(`✅ Verified article document deletion: ${r}`),n)try{console.log(`🗑️ Starting folder cleanup: articles/${n}/${r}`),await Dh(n,r),console.log(`✅ Deleted article folder: articles/${n}/${r}`)}catch(a){console.error(`⚠️ Failed to delete article folder: articles/${n}/${r}`,a),console.log("⚠️ Article folder deletion failed, but article document was removed from database")}console.log(`✅ Article deletion completed successfully: ${r}`)}else{console.log(`📄 Article document not found: ${r}`);try{await Rt(e),console.log(`✅ Deleted empty article reference: ${r}`)}catch(s){console.error(`⚠️ Failed to delete article reference: ${r}`,s)}}}catch(e){throw console.error(`❌ Error during article deletion: ${r}`,e),e}},yi=async r=>{const e=Date.now();console.log(`🗑️ Starting comprehensive deletion of article: ${r}`);try{const t=Date.now();await Ih(r);const s=Date.now()-t;console.log(`✅ Related data cleanup completed in ${s}ms`);const n=Date.now();await Rh(r);const i=Date.now()-n;console.log(`✅ Article deletion completed in ${i}ms`);const a=Date.now()-e;console.log(`✅ Successfully deleted article and all related data: ${r} (Total time: ${a}ms)`)}catch(t){const s=Date.now()-e;throw console.error(`❌ Error during comprehensive article deletion: ${r} (Failed after ${s}ms)`,t),t}},Ih=async r=>{const e=Date.now();console.log(`🧹 Cleaning up related data for article: ${r}`);const t=[];t.push((async()=>{try{console.log(`🔍 Searching for saved article references for: ${r}`);const n=xe(pe(X,"savedArticles"),Oe("articleId","==",r)),i=await vt(n);if(i.empty)console.log(`📝 No saved article references found for: ${r}`);else{console.log(`🗑️ Found ${i.docs.length} saved article references to delete`);const a=i.docs.map(c=>c.data().userId||"unknown");console.log(`👥 Users who had this article saved: ${a.join(", ")}`);const l=i.docs.map(async c=>{try{await Rt(c.ref),console.log(`✅ Removed saved article reference: ${c.id}`)}catch(d){console.error(`❌ Failed to delete saved article reference: ${c.id}`,d)}});await Promise.all(l),console.log(`✅ Successfully deleted ${i.docs.length} saved article references`)}}catch(n){console.error("⚠️ Failed to clean up saved articles:",n)}})()),t.push((async()=>{try{const n=xe(pe(X,"shareEvents"),Oe("articleId","==",r)),i=await vt(n);if(!i.empty){const a=i.docs.map(l=>Rt(l.ref));await Promise.all(a),console.log(`✅ Deleted ${i.docs.length} share events`)}}catch(n){console.error("⚠️ Failed to clean up share events:",n)}})()),t.push((async()=>{try{const n=pe(X,"articles",r,"comments"),i=await vt(n);if(!i.empty){const a=[];for(const l of i.docs){const c=pe(l.ref,"replies"),d=await vt(c);d.empty||d.docs.forEach(u=>{a.push(Rt(u.ref))}),a.push(Rt(l.ref))}await Promise.all(a),console.log(`✅ Deleted ${i.docs.length} comments and their replies`)}}catch(n){console.error("⚠️ Failed to clean up comments:",n)}})()),await Promise.all(t);const s=Date.now()-e;console.log(`✅ Completed cleanup of related data for article: ${r} (Time: ${s}ms)`)},Ph=async(r,e,t,s,n,i)=>{let a=null;try{const l=he(X,"articles",r),c=await It(l);c.exists()&&(a=c.data())}catch{}if(t===s){await yi(r);return}if(e==="admin"&&t!==s){if(await yi(r),a&&n==="infowriter")try{const{createArticleDeletionNotification:l}=await Ue(async()=>{const{createArticleDeletionNotification:c}=await Promise.resolve().then(()=>$l);return{createArticleDeletionNotification:c}},void 0);await l(s,a.title||"Untitled Article",i)}catch{}return}if(e==="admin"){await yi(r);return}throw new Error("Unauthorized deletion attempt")},Lh=async()=>{var r,e;console.log("🔧 Starting article date fix process...");try{const t=xe(pe(X,"articles")),s=await vt(t);let n=0,i=s.docs.length;console.log(`📊 Found ${i} articles to check`);for(const a of s.docs){const l=a.data(),c=a.id,d=(r=l.publishedAt)==null?void 0:r.toDate(),u=(e=l.updatedAt)==null?void 0:e.toDate();if(d&&u&&d>u){console.log(`🔧 Fixing dates for article: ${l.title} (${c})`),console.log(`   Before: publishedAt=${d.toISOString()}, updatedAt=${u.toISOString()}`);const h=u,f=d;await qe(he(X,"articles",c),{publishedAt:Le.fromDate(h),updatedAt:Le.fromDate(f)}),console.log(`   After:  publishedAt=${h.toISOString()}, updatedAt=${f.toISOString()}`),n++}}console.log(`✅ Date fix completed: ${n} articles fixed out of ${i} total`)}catch(t){throw console.error("❌ Error fixing article dates:",t),t}};typeof window<"u"&&(window.fixArticleDates=Lh);const _o=async r=>{var s;const e=he(X,"articles",r),t=await It(e);if(t.exists()){const n=t.data();return{...n,createdAt:n.createdAt.toDate(),updatedAt:n.updatedAt.toDate(),publishedAt:(s=n.publishedAt)==null?void 0:s.toDate()}}return null},Jl=async(r={})=>{let e=xe(pe(X,"articles"));const t=[];r.status&&t.push(["status","==",r.status]),r.authorId&&t.push(["authorId","==",r.authorId]),r.categories&&r.categories.length>0&&t.push(["categories","array-contains-any",r.categories]),t.forEach(([i,a,l])=>{e=xe(e,Oe(i,a,l))}),r.authorId||r.status?r.limit&&(e=xe(e,zc(r.limit*2))):(e=xe(e,Wn("updatedAt","desc")),r.limit&&(e=xe(e,zc(r.limit))));let n=(await vt(e)).docs.map(i=>{var l,c,d;const a=i.data();return{...a,createdAt:((l=a.createdAt)==null?void 0:l.toDate())||new Date,updatedAt:((c=a.updatedAt)==null?void 0:c.toDate())||new Date,publishedAt:(d=a.publishedAt)==null?void 0:d.toDate()}});return(r.authorId||r.status)&&(n=n.sort((i,a)=>a.updatedAt.getTime()-i.updatedAt.getTime()),r.limit&&(n=n.slice(0,r.limit))),n},$h=async()=>Jl({status:"published"}),_h=async r=>Jl({authorId:r}),Fh=async(r,e,t)=>{try{const s={articleId:r,userId:t||null,shareMethod:e,sharedAt:Le.now(),userAgent:typeof navigator<"u"?navigator.userAgent:"Unknown"},n=he(pe(X,"shareEvents"));await bs(n,s)}catch(s){console.error("Failed to record share event:",s)}},Bh=(r,e)=>{const t=`https://twitter.com/intent/tweet?url=${encodeURIComponent(r)}&text=${encodeURIComponent(e)}`;window.open(t,"_blank","width=600,height=400")},Uh=r=>{const e=`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(r)}`;window.open(e,"_blank","width=600,height=400")},zh=(r,e)=>{const t=`https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(r)}&title=${encodeURIComponent(e)}`;window.open(t,"_blank","width=600,height=400")},Wh=(r,e)=>{const t=encodeURIComponent(`Check out this article: ${e}`),s=encodeURIComponent(`I thought you might find this article interesting:

${e}

${r}`);window.location.href=`mailto:?subject=${t}&body=${s}`},Hh=async r=>{try{return await navigator.clipboard.writeText(r),!0}catch{const t=document.createElement("textarea");t.value=r,document.body.appendChild(t),t.select();const s=document.execCommand("copy");return document.body.removeChild(t),s}},Xl=Object.freeze(Object.defineProperty({__proto__:null,cleanupArticleRelatedData:Ih,copyToClipboard:Hh,createArticle:Oh,deleteArticle:Rh,deleteArticleByRole:Ph,fixArticleDates:Lh,getArticle:_o,getArticles:Jl,getPublishedArticles:$h,getUserArticles:_h,hardDeleteArticle:yi,recordShareEvent:Fh,shareToFacebook:Uh,shareToLinkedIn:zh,shareToTwitter:Bh,shareViaEmail:Wh,updateArticle:$o},Symbol.toStringTag,{value:"Module"}));function Ti(r){"@babel/helpers - typeof";return Ti=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ti(r)}function fs(r){if(r===null||r===!0||r===!1)return NaN;var e=Number(r);return isNaN(e)?e:e<0?Math.ceil(e):Math.floor(e)}function Te(r,e){if(e.length<r)throw new TypeError(r+" argument"+(r>1?"s":"")+" required, but only "+e.length+" present")}function Ce(r){Te(1,arguments);var e=Object.prototype.toString.call(r);return r instanceof Date||Ti(r)==="object"&&e==="[object Date]"?new Date(r.getTime()):typeof r=="number"||e==="[object Number]"?new Date(r):((typeof r=="string"||e==="[object String]")&&typeof console<"u"&&(console.warn("Starting with v2.0.0-beta.1 date-fns doesn't accept strings as date arguments. Please use `parseISO` to parse strings. See: https://github.com/date-fns/date-fns/blob/master/docs/upgradeGuide.md#string-arguments"),console.warn(new Error().stack)),new Date(NaN))}function lx(r,e){Te(2,arguments);var t=Ce(r).getTime(),s=fs(e);return new Date(t+s)}var cx={};function qn(){return cx}function qa(r){var e=new Date(Date.UTC(r.getFullYear(),r.getMonth(),r.getDate(),r.getHours(),r.getMinutes(),r.getSeconds(),r.getMilliseconds()));return e.setUTCFullYear(r.getFullYear()),r.getTime()-e.getTime()}function bi(r,e){Te(2,arguments);var t=Ce(r),s=Ce(e),n=t.getTime()-s.getTime();return n<0?-1:n>0?1:n}function dx(r){return Te(1,arguments),r instanceof Date||Ti(r)==="object"&&Object.prototype.toString.call(r)==="[object Date]"}function ux(r){if(Te(1,arguments),!dx(r)&&typeof r!="number")return!1;var e=Ce(r);return!isNaN(Number(e))}function hx(r,e){Te(2,arguments);var t=Ce(r),s=Ce(e),n=t.getFullYear()-s.getFullYear(),i=t.getMonth()-s.getMonth();return n*12+i}function fx(r,e){return Te(2,arguments),Ce(r).getTime()-Ce(e).getTime()}var px={ceil:Math.ceil,round:Math.round,floor:Math.floor,trunc:function(e){return e<0?Math.ceil(e):Math.floor(e)}},mx="trunc";function gx(r){return px[mx]}function xx(r){Te(1,arguments);var e=Ce(r);return e.setHours(23,59,59,999),e}function yx(r){Te(1,arguments);var e=Ce(r),t=e.getMonth();return e.setFullYear(e.getFullYear(),t+1,0),e.setHours(23,59,59,999),e}function bx(r){Te(1,arguments);var e=Ce(r);return xx(e).getTime()===yx(e).getTime()}function wx(r,e){Te(2,arguments);var t=Ce(r),s=Ce(e),n=bi(t,s),i=Math.abs(hx(t,s)),a;if(i<1)a=0;else{t.getMonth()===1&&t.getDate()>27&&t.setDate(30),t.setMonth(t.getMonth()-n*i);var l=bi(t,s)===-n;bx(Ce(r))&&i===1&&bi(r,s)===1&&(l=!1),a=n*(i-Number(l))}return a===0?0:a}function vx(r,e,t){Te(2,arguments);var s=fx(r,e)/1e3;return gx()(s)}function Nx(r,e){Te(2,arguments);var t=fs(e);return lx(r,-t)}var jx=864e5;function kx(r){Te(1,arguments);var e=Ce(r),t=e.getTime();e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0);var s=e.getTime(),n=t-s;return Math.floor(n/jx)+1}function Oi(r){Te(1,arguments);var e=1,t=Ce(r),s=t.getUTCDay(),n=(s<e?7:0)+s-e;return t.setUTCDate(t.getUTCDate()-n),t.setUTCHours(0,0,0,0),t}function Vh(r){Te(1,arguments);var e=Ce(r),t=e.getUTCFullYear(),s=new Date(0);s.setUTCFullYear(t+1,0,4),s.setUTCHours(0,0,0,0);var n=Oi(s),i=new Date(0);i.setUTCFullYear(t,0,4),i.setUTCHours(0,0,0,0);var a=Oi(i);return e.getTime()>=n.getTime()?t+1:e.getTime()>=a.getTime()?t:t-1}function Sx(r){Te(1,arguments);var e=Vh(r),t=new Date(0);t.setUTCFullYear(e,0,4),t.setUTCHours(0,0,0,0);var s=Oi(t);return s}var Ex=6048e5;function Ax(r){Te(1,arguments);var e=Ce(r),t=Oi(e).getTime()-Sx(e).getTime();return Math.round(t/Ex)+1}function Ri(r,e){var t,s,n,i,a,l,c,d;Te(1,arguments);var u=qn(),h=fs((t=(s=(n=(i=e==null?void 0:e.weekStartsOn)!==null&&i!==void 0?i:e==null||(a=e.locale)===null||a===void 0||(l=a.options)===null||l===void 0?void 0:l.weekStartsOn)!==null&&n!==void 0?n:u.weekStartsOn)!==null&&s!==void 0?s:(c=u.locale)===null||c===void 0||(d=c.options)===null||d===void 0?void 0:d.weekStartsOn)!==null&&t!==void 0?t:0);if(!(h>=0&&h<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var f=Ce(r),p=f.getUTCDay(),m=(p<h?7:0)+p-h;return f.setUTCDate(f.getUTCDate()-m),f.setUTCHours(0,0,0,0),f}function qh(r,e){var t,s,n,i,a,l,c,d;Te(1,arguments);var u=Ce(r),h=u.getUTCFullYear(),f=qn(),p=fs((t=(s=(n=(i=e==null?void 0:e.firstWeekContainsDate)!==null&&i!==void 0?i:e==null||(a=e.locale)===null||a===void 0||(l=a.options)===null||l===void 0?void 0:l.firstWeekContainsDate)!==null&&n!==void 0?n:f.firstWeekContainsDate)!==null&&s!==void 0?s:(c=f.locale)===null||c===void 0||(d=c.options)===null||d===void 0?void 0:d.firstWeekContainsDate)!==null&&t!==void 0?t:1);if(!(p>=1&&p<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var m=new Date(0);m.setUTCFullYear(h+1,0,p),m.setUTCHours(0,0,0,0);var g=Ri(m,e),y=new Date(0);y.setUTCFullYear(h,0,p),y.setUTCHours(0,0,0,0);var x=Ri(y,e);return u.getTime()>=g.getTime()?h+1:u.getTime()>=x.getTime()?h:h-1}function Cx(r,e){var t,s,n,i,a,l,c,d;Te(1,arguments);var u=qn(),h=fs((t=(s=(n=(i=e==null?void 0:e.firstWeekContainsDate)!==null&&i!==void 0?i:e==null||(a=e.locale)===null||a===void 0||(l=a.options)===null||l===void 0?void 0:l.firstWeekContainsDate)!==null&&n!==void 0?n:u.firstWeekContainsDate)!==null&&s!==void 0?s:(c=u.locale)===null||c===void 0||(d=c.options)===null||d===void 0?void 0:d.firstWeekContainsDate)!==null&&t!==void 0?t:1),f=qh(r,e),p=new Date(0);p.setUTCFullYear(f,0,h),p.setUTCHours(0,0,0,0);var m=Ri(p,e);return m}var Mx=6048e5;function Dx(r,e){Te(1,arguments);var t=Ce(r),s=Ri(t,e).getTime()-Cx(t,e).getTime();return Math.round(s/Mx)+1}function Se(r,e){for(var t=r<0?"-":"",s=Math.abs(r).toString();s.length<e;)s="0"+s;return t+s}var cr={y:function(e,t){var s=e.getUTCFullYear(),n=s>0?s:1-s;return Se(t==="yy"?n%100:n,t.length)},M:function(e,t){var s=e.getUTCMonth();return t==="M"?String(s+1):Se(s+1,2)},d:function(e,t){return Se(e.getUTCDate(),t.length)},a:function(e,t){var s=e.getUTCHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return s.toUpperCase();case"aaa":return s;case"aaaaa":return s[0];case"aaaa":default:return s==="am"?"a.m.":"p.m."}},h:function(e,t){return Se(e.getUTCHours()%12||12,t.length)},H:function(e,t){return Se(e.getUTCHours(),t.length)},m:function(e,t){return Se(e.getUTCMinutes(),t.length)},s:function(e,t){return Se(e.getUTCSeconds(),t.length)},S:function(e,t){var s=t.length,n=e.getUTCMilliseconds(),i=Math.floor(n*Math.pow(10,s-3));return Se(i,t.length)}},As={midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},Tx={G:function(e,t,s){var n=e.getUTCFullYear()>0?1:0;switch(t){case"G":case"GG":case"GGG":return s.era(n,{width:"abbreviated"});case"GGGGG":return s.era(n,{width:"narrow"});case"GGGG":default:return s.era(n,{width:"wide"})}},y:function(e,t,s){if(t==="yo"){var n=e.getUTCFullYear(),i=n>0?n:1-n;return s.ordinalNumber(i,{unit:"year"})}return cr.y(e,t)},Y:function(e,t,s,n){var i=qh(e,n),a=i>0?i:1-i;if(t==="YY"){var l=a%100;return Se(l,2)}return t==="Yo"?s.ordinalNumber(a,{unit:"year"}):Se(a,t.length)},R:function(e,t){var s=Vh(e);return Se(s,t.length)},u:function(e,t){var s=e.getUTCFullYear();return Se(s,t.length)},Q:function(e,t,s){var n=Math.ceil((e.getUTCMonth()+1)/3);switch(t){case"Q":return String(n);case"QQ":return Se(n,2);case"Qo":return s.ordinalNumber(n,{unit:"quarter"});case"QQQ":return s.quarter(n,{width:"abbreviated",context:"formatting"});case"QQQQQ":return s.quarter(n,{width:"narrow",context:"formatting"});case"QQQQ":default:return s.quarter(n,{width:"wide",context:"formatting"})}},q:function(e,t,s){var n=Math.ceil((e.getUTCMonth()+1)/3);switch(t){case"q":return String(n);case"qq":return Se(n,2);case"qo":return s.ordinalNumber(n,{unit:"quarter"});case"qqq":return s.quarter(n,{width:"abbreviated",context:"standalone"});case"qqqqq":return s.quarter(n,{width:"narrow",context:"standalone"});case"qqqq":default:return s.quarter(n,{width:"wide",context:"standalone"})}},M:function(e,t,s){var n=e.getUTCMonth();switch(t){case"M":case"MM":return cr.M(e,t);case"Mo":return s.ordinalNumber(n+1,{unit:"month"});case"MMM":return s.month(n,{width:"abbreviated",context:"formatting"});case"MMMMM":return s.month(n,{width:"narrow",context:"formatting"});case"MMMM":default:return s.month(n,{width:"wide",context:"formatting"})}},L:function(e,t,s){var n=e.getUTCMonth();switch(t){case"L":return String(n+1);case"LL":return Se(n+1,2);case"Lo":return s.ordinalNumber(n+1,{unit:"month"});case"LLL":return s.month(n,{width:"abbreviated",context:"standalone"});case"LLLLL":return s.month(n,{width:"narrow",context:"standalone"});case"LLLL":default:return s.month(n,{width:"wide",context:"standalone"})}},w:function(e,t,s,n){var i=Dx(e,n);return t==="wo"?s.ordinalNumber(i,{unit:"week"}):Se(i,t.length)},I:function(e,t,s){var n=Ax(e);return t==="Io"?s.ordinalNumber(n,{unit:"week"}):Se(n,t.length)},d:function(e,t,s){return t==="do"?s.ordinalNumber(e.getUTCDate(),{unit:"date"}):cr.d(e,t)},D:function(e,t,s){var n=kx(e);return t==="Do"?s.ordinalNumber(n,{unit:"dayOfYear"}):Se(n,t.length)},E:function(e,t,s){var n=e.getUTCDay();switch(t){case"E":case"EE":case"EEE":return s.day(n,{width:"abbreviated",context:"formatting"});case"EEEEE":return s.day(n,{width:"narrow",context:"formatting"});case"EEEEEE":return s.day(n,{width:"short",context:"formatting"});case"EEEE":default:return s.day(n,{width:"wide",context:"formatting"})}},e:function(e,t,s,n){var i=e.getUTCDay(),a=(i-n.weekStartsOn+8)%7||7;switch(t){case"e":return String(a);case"ee":return Se(a,2);case"eo":return s.ordinalNumber(a,{unit:"day"});case"eee":return s.day(i,{width:"abbreviated",context:"formatting"});case"eeeee":return s.day(i,{width:"narrow",context:"formatting"});case"eeeeee":return s.day(i,{width:"short",context:"formatting"});case"eeee":default:return s.day(i,{width:"wide",context:"formatting"})}},c:function(e,t,s,n){var i=e.getUTCDay(),a=(i-n.weekStartsOn+8)%7||7;switch(t){case"c":return String(a);case"cc":return Se(a,t.length);case"co":return s.ordinalNumber(a,{unit:"day"});case"ccc":return s.day(i,{width:"abbreviated",context:"standalone"});case"ccccc":return s.day(i,{width:"narrow",context:"standalone"});case"cccccc":return s.day(i,{width:"short",context:"standalone"});case"cccc":default:return s.day(i,{width:"wide",context:"standalone"})}},i:function(e,t,s){var n=e.getUTCDay(),i=n===0?7:n;switch(t){case"i":return String(i);case"ii":return Se(i,t.length);case"io":return s.ordinalNumber(i,{unit:"day"});case"iii":return s.day(n,{width:"abbreviated",context:"formatting"});case"iiiii":return s.day(n,{width:"narrow",context:"formatting"});case"iiiiii":return s.day(n,{width:"short",context:"formatting"});case"iiii":default:return s.day(n,{width:"wide",context:"formatting"})}},a:function(e,t,s){var n=e.getUTCHours(),i=n/12>=1?"pm":"am";switch(t){case"a":case"aa":return s.dayPeriod(i,{width:"abbreviated",context:"formatting"});case"aaa":return s.dayPeriod(i,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return s.dayPeriod(i,{width:"narrow",context:"formatting"});case"aaaa":default:return s.dayPeriod(i,{width:"wide",context:"formatting"})}},b:function(e,t,s){var n=e.getUTCHours(),i;switch(n===12?i=As.noon:n===0?i=As.midnight:i=n/12>=1?"pm":"am",t){case"b":case"bb":return s.dayPeriod(i,{width:"abbreviated",context:"formatting"});case"bbb":return s.dayPeriod(i,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return s.dayPeriod(i,{width:"narrow",context:"formatting"});case"bbbb":default:return s.dayPeriod(i,{width:"wide",context:"formatting"})}},B:function(e,t,s){var n=e.getUTCHours(),i;switch(n>=17?i=As.evening:n>=12?i=As.afternoon:n>=4?i=As.morning:i=As.night,t){case"B":case"BB":case"BBB":return s.dayPeriod(i,{width:"abbreviated",context:"formatting"});case"BBBBB":return s.dayPeriod(i,{width:"narrow",context:"formatting"});case"BBBB":default:return s.dayPeriod(i,{width:"wide",context:"formatting"})}},h:function(e,t,s){if(t==="ho"){var n=e.getUTCHours()%12;return n===0&&(n=12),s.ordinalNumber(n,{unit:"hour"})}return cr.h(e,t)},H:function(e,t,s){return t==="Ho"?s.ordinalNumber(e.getUTCHours(),{unit:"hour"}):cr.H(e,t)},K:function(e,t,s){var n=e.getUTCHours()%12;return t==="Ko"?s.ordinalNumber(n,{unit:"hour"}):Se(n,t.length)},k:function(e,t,s){var n=e.getUTCHours();return n===0&&(n=24),t==="ko"?s.ordinalNumber(n,{unit:"hour"}):Se(n,t.length)},m:function(e,t,s){return t==="mo"?s.ordinalNumber(e.getUTCMinutes(),{unit:"minute"}):cr.m(e,t)},s:function(e,t,s){return t==="so"?s.ordinalNumber(e.getUTCSeconds(),{unit:"second"}):cr.s(e,t)},S:function(e,t){return cr.S(e,t)},X:function(e,t,s,n){var i=n._originalDate||e,a=i.getTimezoneOffset();if(a===0)return"Z";switch(t){case"X":return Xc(a);case"XXXX":case"XX":return zr(a);case"XXXXX":case"XXX":default:return zr(a,":")}},x:function(e,t,s,n){var i=n._originalDate||e,a=i.getTimezoneOffset();switch(t){case"x":return Xc(a);case"xxxx":case"xx":return zr(a);case"xxxxx":case"xxx":default:return zr(a,":")}},O:function(e,t,s,n){var i=n._originalDate||e,a=i.getTimezoneOffset();switch(t){case"O":case"OO":case"OOO":return"GMT"+Jc(a,":");case"OOOO":default:return"GMT"+zr(a,":")}},z:function(e,t,s,n){var i=n._originalDate||e,a=i.getTimezoneOffset();switch(t){case"z":case"zz":case"zzz":return"GMT"+Jc(a,":");case"zzzz":default:return"GMT"+zr(a,":")}},t:function(e,t,s,n){var i=n._originalDate||e,a=Math.floor(i.getTime()/1e3);return Se(a,t.length)},T:function(e,t,s,n){var i=n._originalDate||e,a=i.getTime();return Se(a,t.length)}};function Jc(r,e){var t=r>0?"-":"+",s=Math.abs(r),n=Math.floor(s/60),i=s%60;if(i===0)return t+String(n);var a=e;return t+String(n)+a+Se(i,2)}function Xc(r,e){if(r%60===0){var t=r>0?"-":"+";return t+Se(Math.abs(r)/60,2)}return zr(r,e)}function zr(r,e){var t=e||"",s=r>0?"-":"+",n=Math.abs(r),i=Se(Math.floor(n/60),2),a=Se(n%60,2);return s+i+t+a}var Qc=function(e,t){switch(e){case"P":return t.date({width:"short"});case"PP":return t.date({width:"medium"});case"PPP":return t.date({width:"long"});case"PPPP":default:return t.date({width:"full"})}},Kh=function(e,t){switch(e){case"p":return t.time({width:"short"});case"pp":return t.time({width:"medium"});case"ppp":return t.time({width:"long"});case"pppp":default:return t.time({width:"full"})}},Ox=function(e,t){var s=e.match(/(P+)(p+)?/)||[],n=s[1],i=s[2];if(!i)return Qc(e,t);var a;switch(n){case"P":a=t.dateTime({width:"short"});break;case"PP":a=t.dateTime({width:"medium"});break;case"PPP":a=t.dateTime({width:"long"});break;case"PPPP":default:a=t.dateTime({width:"full"});break}return a.replace("{{date}}",Qc(n,t)).replace("{{time}}",Kh(i,t))},Rx={p:Kh,P:Ox},Ix=["D","DD"],Px=["YY","YYYY"];function Lx(r){return Ix.indexOf(r)!==-1}function $x(r){return Px.indexOf(r)!==-1}function Zc(r,e,t){if(r==="YYYY")throw new RangeError("Use `yyyy` instead of `YYYY` (in `".concat(e,"`) for formatting years to the input `").concat(t,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if(r==="YY")throw new RangeError("Use `yy` instead of `YY` (in `".concat(e,"`) for formatting years to the input `").concat(t,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if(r==="D")throw new RangeError("Use `d` instead of `D` (in `".concat(e,"`) for formatting days of the month to the input `").concat(t,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if(r==="DD")throw new RangeError("Use `dd` instead of `DD` (in `".concat(e,"`) for formatting days of the month to the input `").concat(t,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"))}var _x={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},Fx=function(e,t,s){var n,i=_x[e];return typeof i=="string"?n=i:t===1?n=i.one:n=i.other.replace("{{count}}",t.toString()),s!=null&&s.addSuffix?s.comparison&&s.comparison>0?"in "+n:n+" ago":n};function na(r){return function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=e.width?String(e.width):r.defaultWidth,s=r.formats[t]||r.formats[r.defaultWidth];return s}}var Bx={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},Ux={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},zx={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},Wx={date:na({formats:Bx,defaultWidth:"full"}),time:na({formats:Ux,defaultWidth:"full"}),dateTime:na({formats:zx,defaultWidth:"full"})},Hx={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},Vx=function(e,t,s,n){return Hx[e]};function sn(r){return function(e,t){var s=t!=null&&t.context?String(t.context):"standalone",n;if(s==="formatting"&&r.formattingValues){var i=r.defaultFormattingWidth||r.defaultWidth,a=t!=null&&t.width?String(t.width):i;n=r.formattingValues[a]||r.formattingValues[i]}else{var l=r.defaultWidth,c=t!=null&&t.width?String(t.width):r.defaultWidth;n=r.values[c]||r.values[l]}var d=r.argumentCallback?r.argumentCallback(e):e;return n[d]}}var qx={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},Kx={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},Gx={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},Yx={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},Jx={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},Xx={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},Qx=function(e,t){var s=Number(e),n=s%100;if(n>20||n<10)switch(n%10){case 1:return s+"st";case 2:return s+"nd";case 3:return s+"rd"}return s+"th"},Zx={ordinalNumber:Qx,era:sn({values:qx,defaultWidth:"wide"}),quarter:sn({values:Kx,defaultWidth:"wide",argumentCallback:function(e){return e-1}}),month:sn({values:Gx,defaultWidth:"wide"}),day:sn({values:Yx,defaultWidth:"wide"}),dayPeriod:sn({values:Jx,defaultWidth:"wide",formattingValues:Xx,defaultFormattingWidth:"wide"})};function nn(r){return function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=t.width,n=s&&r.matchPatterns[s]||r.matchPatterns[r.defaultMatchWidth],i=e.match(n);if(!i)return null;var a=i[0],l=s&&r.parsePatterns[s]||r.parsePatterns[r.defaultParseWidth],c=Array.isArray(l)?ty(l,function(h){return h.test(a)}):ey(l,function(h){return h.test(a)}),d;d=r.valueCallback?r.valueCallback(c):c,d=t.valueCallback?t.valueCallback(d):d;var u=e.slice(a.length);return{value:d,rest:u}}}function ey(r,e){for(var t in r)if(r.hasOwnProperty(t)&&e(r[t]))return t}function ty(r,e){for(var t=0;t<r.length;t++)if(e(r[t]))return t}function ry(r){return function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=e.match(r.matchPattern);if(!s)return null;var n=s[0],i=e.match(r.parsePattern);if(!i)return null;var a=r.valueCallback?r.valueCallback(i[0]):i[0];a=t.valueCallback?t.valueCallback(a):a;var l=e.slice(n.length);return{value:a,rest:l}}}var sy=/^(\d+)(th|st|nd|rd)?/i,ny=/\d+/i,iy={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},oy={any:[/^b/i,/^(a|c)/i]},ay={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},ly={any:[/1/i,/2/i,/3/i,/4/i]},cy={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},dy={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},uy={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},hy={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},fy={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},py={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},my={ordinalNumber:ry({matchPattern:sy,parsePattern:ny,valueCallback:function(e){return parseInt(e,10)}}),era:nn({matchPatterns:iy,defaultMatchWidth:"wide",parsePatterns:oy,defaultParseWidth:"any"}),quarter:nn({matchPatterns:ay,defaultMatchWidth:"wide",parsePatterns:ly,defaultParseWidth:"any",valueCallback:function(e){return e+1}}),month:nn({matchPatterns:cy,defaultMatchWidth:"wide",parsePatterns:dy,defaultParseWidth:"any"}),day:nn({matchPatterns:uy,defaultMatchWidth:"wide",parsePatterns:hy,defaultParseWidth:"any"}),dayPeriod:nn({matchPatterns:fy,defaultMatchWidth:"any",parsePatterns:py,defaultParseWidth:"any"})},Gh={code:"en-US",formatDistance:Fx,formatLong:Wx,formatRelative:Vx,localize:Zx,match:my,options:{weekStartsOn:0,firstWeekContainsDate:1}},gy=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,xy=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,yy=/^'([^]*?)'?$/,by=/''/g,wy=/[a-zA-Z]/;function Ii(r,e,t){var s,n,i,a,l,c,d,u,h,f,p,m,g,y;Te(2,arguments);var x=String(e),S=qn(),C=(s=(n=void 0)!==null&&n!==void 0?n:S.locale)!==null&&s!==void 0?s:Gh,k=fs((i=(a=(l=(c=void 0)!==null&&c!==void 0?c:void 0)!==null&&l!==void 0?l:S.firstWeekContainsDate)!==null&&a!==void 0?a:(d=S.locale)===null||d===void 0||(u=d.options)===null||u===void 0?void 0:u.firstWeekContainsDate)!==null&&i!==void 0?i:1);if(!(k>=1&&k<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var j=fs((h=(f=(p=(m=void 0)!==null&&m!==void 0?m:void 0)!==null&&p!==void 0?p:S.weekStartsOn)!==null&&f!==void 0?f:(g=S.locale)===null||g===void 0||(y=g.options)===null||y===void 0?void 0:y.weekStartsOn)!==null&&h!==void 0?h:0);if(!(j>=0&&j<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");if(!C.localize)throw new RangeError("locale must contain localize property");if(!C.formatLong)throw new RangeError("locale must contain formatLong property");var O=Ce(r);if(!ux(O))throw new RangeError("Invalid time value");var N=qa(O),w=Nx(O,N),v={firstWeekContainsDate:k,weekStartsOn:j,locale:C,_originalDate:O},M=x.match(xy).map(function(E){var L=E[0];if(L==="p"||L==="P"){var I=Rx[L];return I(E,C.formatLong)}return E}).join("").match(gy).map(function(E){if(E==="''")return"'";var L=E[0];if(L==="'")return vy(E);var I=Tx[L];if(I)return $x(E)&&Zc(E,e,String(r)),Lx(E)&&Zc(E,e,String(r)),I(w,E,C.localize,v);if(L.match(wy))throw new RangeError("Format string contains an unescaped latin alphabet character `"+L+"`");return E}).join("");return M}function vy(r){var e=r.match(yy);return e?e[1].replace(by,"'"):r}function Yh(r,e){if(r==null)throw new TypeError("assign requires that input parameter not be null or undefined");for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(r[t]=e[t]);return r}function Ny(r){return Yh({},r)}var ed=1440,jy=2520,ia=43200,ky=86400;function Sy(r,e,t){var s,n;Te(2,arguments);var i=qn(),a=(s=(n=t==null?void 0:t.locale)!==null&&n!==void 0?n:i.locale)!==null&&s!==void 0?s:Gh;if(!a.formatDistance)throw new RangeError("locale must contain formatDistance property");var l=bi(r,e);if(isNaN(l))throw new RangeError("Invalid time value");var c=Yh(Ny(t),{addSuffix:!!(t!=null&&t.addSuffix),comparison:l}),d,u;l>0?(d=Ce(e),u=Ce(r)):(d=Ce(r),u=Ce(e));var h=vx(u,d),f=(qa(u)-qa(d))/1e3,p=Math.round((h-f)/60),m;if(p<2)return t!=null&&t.includeSeconds?h<5?a.formatDistance("lessThanXSeconds",5,c):h<10?a.formatDistance("lessThanXSeconds",10,c):h<20?a.formatDistance("lessThanXSeconds",20,c):h<40?a.formatDistance("halfAMinute",0,c):h<60?a.formatDistance("lessThanXMinutes",1,c):a.formatDistance("xMinutes",1,c):p===0?a.formatDistance("lessThanXMinutes",1,c):a.formatDistance("xMinutes",p,c);if(p<45)return a.formatDistance("xMinutes",p,c);if(p<90)return a.formatDistance("aboutXHours",1,c);if(p<ed){var g=Math.round(p/60);return a.formatDistance("aboutXHours",g,c)}else{if(p<jy)return a.formatDistance("xDays",1,c);if(p<ia){var y=Math.round(p/ed);return a.formatDistance("xDays",y,c)}else if(p<ky)return m=Math.round(p/ia),a.formatDistance("aboutXMonths",m,c)}if(m=wx(u,d),m<12){var x=Math.round(p/ia);return a.formatDistance("xMonths",x,c)}else{var S=m%12,C=Math.floor(m/12);return S<3?a.formatDistance("aboutXYears",C,c):S<9?a.formatDistance("overXYears",C,c):a.formatDistance("almostXYears",C+1,c)}}function Ht(r,e){return Te(1,arguments),Sy(r,Date.now(),e)}function ar(r){return Array.isArray?Array.isArray(r):Qh(r)==="[object Array]"}function Ey(r){if(typeof r=="string")return r;let e=r+"";return e=="0"&&1/r==-1/0?"-0":e}function Ay(r){return r==null?"":Ey(r)}function Bt(r){return typeof r=="string"}function Jh(r){return typeof r=="number"}function Cy(r){return r===!0||r===!1||My(r)&&Qh(r)=="[object Boolean]"}function Xh(r){return typeof r=="object"}function My(r){return Xh(r)&&r!==null}function bt(r){return r!=null}function oa(r){return!r.trim().length}function Qh(r){return r==null?r===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(r)}const Dy="Incorrect 'index' type",Ty=r=>`Invalid value for key ${r}`,Oy=r=>`Pattern length exceeds max of ${r}.`,Ry=r=>`Missing ${r} property in key`,Iy=r=>`Property 'weight' in key '${r}' must be a positive integer`,td=Object.prototype.hasOwnProperty;class Py{constructor(e){this._keys=[],this._keyMap={};let t=0;e.forEach(s=>{let n=Zh(s);this._keys.push(n),this._keyMap[n.id]=n,t+=n.weight}),this._keys.forEach(s=>{s.weight/=t})}get(e){return this._keyMap[e]}keys(){return this._keys}toJSON(){return JSON.stringify(this._keys)}}function Zh(r){let e=null,t=null,s=null,n=1,i=null;if(Bt(r)||ar(r))s=r,e=rd(r),t=Ka(r);else{if(!td.call(r,"name"))throw new Error(Ry("name"));const a=r.name;if(s=a,td.call(r,"weight")&&(n=r.weight,n<=0))throw new Error(Iy(a));e=rd(a),t=Ka(a),i=r.getFn}return{path:e,id:t,weight:n,src:s,getFn:i}}function rd(r){return ar(r)?r:r.split(".")}function Ka(r){return ar(r)?r.join("."):r}function Ly(r,e){let t=[],s=!1;const n=(i,a,l)=>{if(bt(i))if(!a[l])t.push(i);else{let c=a[l];const d=i[c];if(!bt(d))return;if(l===a.length-1&&(Bt(d)||Jh(d)||Cy(d)))t.push(Ay(d));else if(ar(d)){s=!0;for(let u=0,h=d.length;u<h;u+=1)n(d[u],a,l+1)}else a.length&&n(d,a,l+1)}};return n(r,Bt(e)?e.split("."):e,0),s?t:t[0]}const $y={includeMatches:!1,findAllMatches:!1,minMatchCharLength:1},_y={isCaseSensitive:!1,ignoreDiacritics:!1,includeScore:!1,keys:[],shouldSort:!0,sortFn:(r,e)=>r.score===e.score?r.idx<e.idx?-1:1:r.score<e.score?-1:1},Fy={location:0,threshold:.6,distance:100},By={useExtendedSearch:!1,getFn:Ly,ignoreLocation:!1,ignoreFieldNorm:!1,fieldNormWeight:1};var ae={..._y,...$y,...Fy,...By};const Uy=/[^ ]+/g;function zy(r=1,e=3){const t=new Map,s=Math.pow(10,e);return{get(n){const i=n.match(Uy).length;if(t.has(i))return t.get(i);const a=1/Math.pow(i,.5*r),l=parseFloat(Math.round(a*s)/s);return t.set(i,l),l},clear(){t.clear()}}}class Ql{constructor({getFn:e=ae.getFn,fieldNormWeight:t=ae.fieldNormWeight}={}){this.norm=zy(t,3),this.getFn=e,this.isCreated=!1,this.setIndexRecords()}setSources(e=[]){this.docs=e}setIndexRecords(e=[]){this.records=e}setKeys(e=[]){this.keys=e,this._keysMap={},e.forEach((t,s)=>{this._keysMap[t.id]=s})}create(){this.isCreated||!this.docs.length||(this.isCreated=!0,Bt(this.docs[0])?this.docs.forEach((e,t)=>{this._addString(e,t)}):this.docs.forEach((e,t)=>{this._addObject(e,t)}),this.norm.clear())}add(e){const t=this.size();Bt(e)?this._addString(e,t):this._addObject(e,t)}removeAt(e){this.records.splice(e,1);for(let t=e,s=this.size();t<s;t+=1)this.records[t].i-=1}getValueForItemAtKeyId(e,t){return e[this._keysMap[t]]}size(){return this.records.length}_addString(e,t){if(!bt(e)||oa(e))return;let s={v:e,i:t,n:this.norm.get(e)};this.records.push(s)}_addObject(e,t){let s={i:t,$:{}};this.keys.forEach((n,i)=>{let a=n.getFn?n.getFn(e):this.getFn(e,n.path);if(bt(a)){if(ar(a)){let l=[];const c=[{nestedArrIndex:-1,value:a}];for(;c.length;){const{nestedArrIndex:d,value:u}=c.pop();if(bt(u))if(Bt(u)&&!oa(u)){let h={v:u,i:d,n:this.norm.get(u)};l.push(h)}else ar(u)&&u.forEach((h,f)=>{c.push({nestedArrIndex:f,value:h})})}s.$[i]=l}else if(Bt(a)&&!oa(a)){let l={v:a,n:this.norm.get(a)};s.$[i]=l}}}),this.records.push(s)}toJSON(){return{keys:this.keys,records:this.records}}}function ef(r,e,{getFn:t=ae.getFn,fieldNormWeight:s=ae.fieldNormWeight}={}){const n=new Ql({getFn:t,fieldNormWeight:s});return n.setKeys(r.map(Zh)),n.setSources(e),n.create(),n}function Wy(r,{getFn:e=ae.getFn,fieldNormWeight:t=ae.fieldNormWeight}={}){const{keys:s,records:n}=r,i=new Ql({getFn:e,fieldNormWeight:t});return i.setKeys(s),i.setIndexRecords(n),i}function Zn(r,{errors:e=0,currentLocation:t=0,expectedLocation:s=0,distance:n=ae.distance,ignoreLocation:i=ae.ignoreLocation}={}){const a=e/r.length;if(i)return a;const l=Math.abs(s-t);return n?a+l/n:l?1:a}function Hy(r=[],e=ae.minMatchCharLength){let t=[],s=-1,n=-1,i=0;for(let a=r.length;i<a;i+=1){let l=r[i];l&&s===-1?s=i:!l&&s!==-1&&(n=i-1,n-s+1>=e&&t.push([s,n]),s=-1)}return r[i-1]&&i-s>=e&&t.push([s,i-1]),t}const Hr=32;function Vy(r,e,t,{location:s=ae.location,distance:n=ae.distance,threshold:i=ae.threshold,findAllMatches:a=ae.findAllMatches,minMatchCharLength:l=ae.minMatchCharLength,includeMatches:c=ae.includeMatches,ignoreLocation:d=ae.ignoreLocation}={}){if(e.length>Hr)throw new Error(Oy(Hr));const u=e.length,h=r.length,f=Math.max(0,Math.min(s,h));let p=i,m=f;const g=l>1||c,y=g?Array(h):[];let x;for(;(x=r.indexOf(e,m))>-1;){let N=Zn(e,{currentLocation:x,expectedLocation:f,distance:n,ignoreLocation:d});if(p=Math.min(N,p),m=x+u,g){let w=0;for(;w<u;)y[x+w]=1,w+=1}}m=-1;let S=[],C=1,k=u+h;const j=1<<u-1;for(let N=0;N<u;N+=1){let w=0,v=k;for(;w<v;)Zn(e,{errors:N,currentLocation:f+v,expectedLocation:f,distance:n,ignoreLocation:d})<=p?w=v:k=v,v=Math.floor((k-w)/2+w);k=v;let M=Math.max(1,f-v+1),E=a?h:Math.min(f+v,h)+u,L=Array(E+2);L[E+1]=(1<<N)-1;for(let W=E;W>=M;W-=1){let H=W-1,R=t[r.charAt(H)];if(g&&(y[H]=+!!R),L[W]=(L[W+1]<<1|1)&R,N&&(L[W]|=(S[W+1]|S[W])<<1|1|S[W+1]),L[W]&j&&(C=Zn(e,{errors:N,currentLocation:H,expectedLocation:f,distance:n,ignoreLocation:d}),C<=p)){if(p=C,m=H,m<=f)break;M=Math.max(1,2*f-m)}}if(Zn(e,{errors:N+1,currentLocation:f,expectedLocation:f,distance:n,ignoreLocation:d})>p)break;S=L}const O={isMatch:m>=0,score:Math.max(.001,C)};if(g){const N=Hy(y,l);N.length?c&&(O.indices=N):O.isMatch=!1}return O}function qy(r){let e={};for(let t=0,s=r.length;t<s;t+=1){const n=r.charAt(t);e[n]=(e[n]||0)|1<<s-t-1}return e}const Pi=String.prototype.normalize?r=>r.normalize("NFD").replace(/[\u0300-\u036F\u0483-\u0489\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u0711\u0730-\u074A\u07A6-\u07B0\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D3-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u09FE\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A70\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0AFA-\u0AFF\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B62\u0B63\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0C00-\u0C04\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0D00-\u0D03\u0D3B\u0D3C\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D82\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0EB1\u0EB4-\u0EB9\u0EBB\u0EBC\u0EC8-\u0ECD\u0F18\u0F19\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F\u109A-\u109D\u135D-\u135F\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u180B-\u180D\u1885\u1886\u18A9\u1920-\u192B\u1930-\u193B\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F\u1AB0-\u1ABE\u1B00-\u1B04\u1B34-\u1B44\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BE6-\u1BF3\u1C24-\u1C37\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF2-\u1CF4\u1CF7-\u1CF9\u1DC0-\u1DF9\u1DFB-\u1DFF\u20D0-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA66F-\uA672\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA880\uA881\uA8B4-\uA8C5\uA8E0-\uA8F1\uA8FF\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9E5\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F]/g,""):r=>r;class tf{constructor(e,{location:t=ae.location,threshold:s=ae.threshold,distance:n=ae.distance,includeMatches:i=ae.includeMatches,findAllMatches:a=ae.findAllMatches,minMatchCharLength:l=ae.minMatchCharLength,isCaseSensitive:c=ae.isCaseSensitive,ignoreDiacritics:d=ae.ignoreDiacritics,ignoreLocation:u=ae.ignoreLocation}={}){if(this.options={location:t,threshold:s,distance:n,includeMatches:i,findAllMatches:a,minMatchCharLength:l,isCaseSensitive:c,ignoreDiacritics:d,ignoreLocation:u},e=c?e:e.toLowerCase(),e=d?Pi(e):e,this.pattern=e,this.chunks=[],!this.pattern.length)return;const h=(p,m)=>{this.chunks.push({pattern:p,alphabet:qy(p),startIndex:m})},f=this.pattern.length;if(f>Hr){let p=0;const m=f%Hr,g=f-m;for(;p<g;)h(this.pattern.substr(p,Hr),p),p+=Hr;if(m){const y=f-Hr;h(this.pattern.substr(y),y)}}else h(this.pattern,0)}searchIn(e){const{isCaseSensitive:t,ignoreDiacritics:s,includeMatches:n}=this.options;if(e=t?e:e.toLowerCase(),e=s?Pi(e):e,this.pattern===e){let g={isMatch:!0,score:0};return n&&(g.indices=[[0,e.length-1]]),g}const{location:i,distance:a,threshold:l,findAllMatches:c,minMatchCharLength:d,ignoreLocation:u}=this.options;let h=[],f=0,p=!1;this.chunks.forEach(({pattern:g,alphabet:y,startIndex:x})=>{const{isMatch:S,score:C,indices:k}=Vy(e,g,y,{location:i+x,distance:a,threshold:l,findAllMatches:c,minMatchCharLength:d,includeMatches:n,ignoreLocation:u});S&&(p=!0),f+=C,S&&k&&(h=[...h,...k])});let m={isMatch:p,score:p?f/this.chunks.length:1};return p&&n&&(m.indices=h),m}}class Ir{constructor(e){this.pattern=e}static isMultiMatch(e){return sd(e,this.multiRegex)}static isSingleMatch(e){return sd(e,this.singleRegex)}search(){}}function sd(r,e){const t=r.match(e);return t?t[1]:null}class Ky extends Ir{constructor(e){super(e)}static get type(){return"exact"}static get multiRegex(){return/^="(.*)"$/}static get singleRegex(){return/^=(.*)$/}search(e){const t=e===this.pattern;return{isMatch:t,score:t?0:1,indices:[0,this.pattern.length-1]}}}class Gy extends Ir{constructor(e){super(e)}static get type(){return"inverse-exact"}static get multiRegex(){return/^!"(.*)"$/}static get singleRegex(){return/^!(.*)$/}search(e){const s=e.indexOf(this.pattern)===-1;return{isMatch:s,score:s?0:1,indices:[0,e.length-1]}}}class Yy extends Ir{constructor(e){super(e)}static get type(){return"prefix-exact"}static get multiRegex(){return/^\^"(.*)"$/}static get singleRegex(){return/^\^(.*)$/}search(e){const t=e.startsWith(this.pattern);return{isMatch:t,score:t?0:1,indices:[0,this.pattern.length-1]}}}class Jy extends Ir{constructor(e){super(e)}static get type(){return"inverse-prefix-exact"}static get multiRegex(){return/^!\^"(.*)"$/}static get singleRegex(){return/^!\^(.*)$/}search(e){const t=!e.startsWith(this.pattern);return{isMatch:t,score:t?0:1,indices:[0,e.length-1]}}}class Xy extends Ir{constructor(e){super(e)}static get type(){return"suffix-exact"}static get multiRegex(){return/^"(.*)"\$$/}static get singleRegex(){return/^(.*)\$$/}search(e){const t=e.endsWith(this.pattern);return{isMatch:t,score:t?0:1,indices:[e.length-this.pattern.length,e.length-1]}}}class Qy extends Ir{constructor(e){super(e)}static get type(){return"inverse-suffix-exact"}static get multiRegex(){return/^!"(.*)"\$$/}static get singleRegex(){return/^!(.*)\$$/}search(e){const t=!e.endsWith(this.pattern);return{isMatch:t,score:t?0:1,indices:[0,e.length-1]}}}class rf extends Ir{constructor(e,{location:t=ae.location,threshold:s=ae.threshold,distance:n=ae.distance,includeMatches:i=ae.includeMatches,findAllMatches:a=ae.findAllMatches,minMatchCharLength:l=ae.minMatchCharLength,isCaseSensitive:c=ae.isCaseSensitive,ignoreDiacritics:d=ae.ignoreDiacritics,ignoreLocation:u=ae.ignoreLocation}={}){super(e),this._bitapSearch=new tf(e,{location:t,threshold:s,distance:n,includeMatches:i,findAllMatches:a,minMatchCharLength:l,isCaseSensitive:c,ignoreDiacritics:d,ignoreLocation:u})}static get type(){return"fuzzy"}static get multiRegex(){return/^"(.*)"$/}static get singleRegex(){return/^(.*)$/}search(e){return this._bitapSearch.searchIn(e)}}class sf extends Ir{constructor(e){super(e)}static get type(){return"include"}static get multiRegex(){return/^'"(.*)"$/}static get singleRegex(){return/^'(.*)$/}search(e){let t=0,s;const n=[],i=this.pattern.length;for(;(s=e.indexOf(this.pattern,t))>-1;)t=s+i,n.push([s,t-1]);const a=!!n.length;return{isMatch:a,score:a?0:1,indices:n}}}const Ga=[Ky,sf,Yy,Jy,Qy,Xy,Gy,rf],nd=Ga.length,Zy=/ +(?=(?:[^\"]*\"[^\"]*\")*[^\"]*$)/,eb="|";function tb(r,e={}){return r.split(eb).map(t=>{let s=t.trim().split(Zy).filter(i=>i&&!!i.trim()),n=[];for(let i=0,a=s.length;i<a;i+=1){const l=s[i];let c=!1,d=-1;for(;!c&&++d<nd;){const u=Ga[d];let h=u.isMultiMatch(l);h&&(n.push(new u(h,e)),c=!0)}if(!c)for(d=-1;++d<nd;){const u=Ga[d];let h=u.isSingleMatch(l);if(h){n.push(new u(h,e));break}}}return n})}const rb=new Set([rf.type,sf.type]);class sb{constructor(e,{isCaseSensitive:t=ae.isCaseSensitive,ignoreDiacritics:s=ae.ignoreDiacritics,includeMatches:n=ae.includeMatches,minMatchCharLength:i=ae.minMatchCharLength,ignoreLocation:a=ae.ignoreLocation,findAllMatches:l=ae.findAllMatches,location:c=ae.location,threshold:d=ae.threshold,distance:u=ae.distance}={}){this.query=null,this.options={isCaseSensitive:t,ignoreDiacritics:s,includeMatches:n,minMatchCharLength:i,findAllMatches:l,ignoreLocation:a,location:c,threshold:d,distance:u},e=t?e:e.toLowerCase(),e=s?Pi(e):e,this.pattern=e,this.query=tb(this.pattern,this.options)}static condition(e,t){return t.useExtendedSearch}searchIn(e){const t=this.query;if(!t)return{isMatch:!1,score:1};const{includeMatches:s,isCaseSensitive:n,ignoreDiacritics:i}=this.options;e=n?e:e.toLowerCase(),e=i?Pi(e):e;let a=0,l=[],c=0;for(let d=0,u=t.length;d<u;d+=1){const h=t[d];l.length=0,a=0;for(let f=0,p=h.length;f<p;f+=1){const m=h[f],{isMatch:g,indices:y,score:x}=m.search(e);if(g){if(a+=1,c+=x,s){const S=m.constructor.type;rb.has(S)?l=[...l,...y]:l.push(y)}}else{c=0,a=0,l.length=0;break}}if(a){let f={isMatch:!0,score:c/a};return s&&(f.indices=l),f}}return{isMatch:!1,score:1}}}const Ya=[];function nb(...r){Ya.push(...r)}function Ja(r,e){for(let t=0,s=Ya.length;t<s;t+=1){let n=Ya[t];if(n.condition(r,e))return new n(r,e)}return new tf(r,e)}const Li={AND:"$and",OR:"$or"},Xa={PATH:"$path",PATTERN:"$val"},Qa=r=>!!(r[Li.AND]||r[Li.OR]),ib=r=>!!r[Xa.PATH],ob=r=>!ar(r)&&Xh(r)&&!Qa(r),id=r=>({[Li.AND]:Object.keys(r).map(e=>({[e]:r[e]}))});function nf(r,e,{auto:t=!0}={}){const s=n=>{let i=Object.keys(n);const a=ib(n);if(!a&&i.length>1&&!Qa(n))return s(id(n));if(ob(n)){const c=a?n[Xa.PATH]:i[0],d=a?n[Xa.PATTERN]:n[c];if(!Bt(d))throw new Error(Ty(c));const u={keyId:Ka(c),pattern:d};return t&&(u.searcher=Ja(d,e)),u}let l={children:[],operator:i[0]};return i.forEach(c=>{const d=n[c];ar(d)&&d.forEach(u=>{l.children.push(s(u))})}),l};return Qa(r)||(r=id(r)),s(r)}function ab(r,{ignoreFieldNorm:e=ae.ignoreFieldNorm}){r.forEach(t=>{let s=1;t.matches.forEach(({key:n,norm:i,score:a})=>{const l=n?n.weight:null;s*=Math.pow(a===0&&l?Number.EPSILON:a,(l||1)*(e?1:i))}),t.score=s})}function lb(r,e){const t=r.matches;e.matches=[],bt(t)&&t.forEach(s=>{if(!bt(s.indices)||!s.indices.length)return;const{indices:n,value:i}=s;let a={indices:n,value:i};s.key&&(a.key=s.key.src),s.idx>-1&&(a.refIndex=s.idx),e.matches.push(a)})}function cb(r,e){e.score=r.score}function db(r,e,{includeMatches:t=ae.includeMatches,includeScore:s=ae.includeScore}={}){const n=[];return t&&n.push(lb),s&&n.push(cb),r.map(i=>{const{idx:a}=i,l={item:e[a],refIndex:a};return n.length&&n.forEach(c=>{c(i,l)}),l})}class Qs{constructor(e,t={},s){this.options={...ae,...t},this.options.useExtendedSearch,this._keyStore=new Py(this.options.keys),this.setCollection(e,s)}setCollection(e,t){if(this._docs=e,t&&!(t instanceof Ql))throw new Error(Dy);this._myIndex=t||ef(this.options.keys,this._docs,{getFn:this.options.getFn,fieldNormWeight:this.options.fieldNormWeight})}add(e){bt(e)&&(this._docs.push(e),this._myIndex.add(e))}remove(e=()=>!1){const t=[];for(let s=0,n=this._docs.length;s<n;s+=1){const i=this._docs[s];e(i,s)&&(this.removeAt(s),s-=1,n-=1,t.push(i))}return t}removeAt(e){this._docs.splice(e,1),this._myIndex.removeAt(e)}getIndex(){return this._myIndex}search(e,{limit:t=-1}={}){const{includeMatches:s,includeScore:n,shouldSort:i,sortFn:a,ignoreFieldNorm:l}=this.options;let c=Bt(e)?Bt(this._docs[0])?this._searchStringList(e):this._searchObjectList(e):this._searchLogical(e);return ab(c,{ignoreFieldNorm:l}),i&&c.sort(a),Jh(t)&&t>-1&&(c=c.slice(0,t)),db(c,this._docs,{includeMatches:s,includeScore:n})}_searchStringList(e){const t=Ja(e,this.options),{records:s}=this._myIndex,n=[];return s.forEach(({v:i,i:a,n:l})=>{if(!bt(i))return;const{isMatch:c,score:d,indices:u}=t.searchIn(i);c&&n.push({item:i,idx:a,matches:[{score:d,value:i,norm:l,indices:u}]})}),n}_searchLogical(e){const t=nf(e,this.options),s=(l,c,d)=>{if(!l.children){const{keyId:h,searcher:f}=l,p=this._findMatches({key:this._keyStore.get(h),value:this._myIndex.getValueForItemAtKeyId(c,h),searcher:f});return p&&p.length?[{idx:d,item:c,matches:p}]:[]}const u=[];for(let h=0,f=l.children.length;h<f;h+=1){const p=l.children[h],m=s(p,c,d);if(m.length)u.push(...m);else if(l.operator===Li.AND)return[]}return u},n=this._myIndex.records,i={},a=[];return n.forEach(({$:l,i:c})=>{if(bt(l)){let d=s(t,l,c);d.length&&(i[c]||(i[c]={idx:c,item:l,matches:[]},a.push(i[c])),d.forEach(({matches:u})=>{i[c].matches.push(...u)}))}}),a}_searchObjectList(e){const t=Ja(e,this.options),{keys:s,records:n}=this._myIndex,i=[];return n.forEach(({$:a,i:l})=>{if(!bt(a))return;let c=[];s.forEach((d,u)=>{c.push(...this._findMatches({key:d,value:a[u],searcher:t}))}),c.length&&i.push({idx:l,item:a,matches:c})}),i}_findMatches({key:e,value:t,searcher:s}){if(!bt(t))return[];let n=[];if(ar(t))t.forEach(({v:i,i:a,n:l})=>{if(!bt(i))return;const{isMatch:c,score:d,indices:u}=s.searchIn(i);c&&n.push({score:d,key:e,value:i,idx:a,norm:l,indices:u})});else{const{v:i,n:a}=t,{isMatch:l,score:c,indices:d}=s.searchIn(i);l&&n.push({score:c,key:e,value:i,norm:a,indices:d})}return n}}Qs.version="7.1.0";Qs.createIndex=ef;Qs.parseIndex=Wy;Qs.config=ae;Qs.parseQuery=nf;nb(sb);const $i=r=>{if(!r)return"";const e=document.createElement("div");return e.innerHTML=r,e.textContent||e.innerText||""},of=r=>{const e=document.createElement("div");return e.innerHTML=r,e},ub=r=>{if(!r.trim())return"";const e=r.trim().split(/\s+/);if(e.length===1){const s=e[0];return`='${s}' | ${s}`}return e.map(s=>`(='${s}' | ${s})`).join(" ")},aa=(r,e)=>{if(!e.trim())return r;const t=$i(r),s=e.toLowerCase().trim().split(/\s+/);let n=t;return s.forEach(i=>{const a=new RegExp(`\\b(${i.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")})\\b`,"gi");n=n.replace(a,'<mark class="bg-yellow-200 px-0.5 rounded">$1</mark>')}),o.jsx("span",{dangerouslySetInnerHTML:{__html:n}})},hb=["Technology","Business","Tutorials","Science","News & Updates"],vs=({placeholder:r="Search articles...",className:e="",onResultClick:t,variant:s="default",filterByCurrentUser:n=!1,isHeaderSearch:i=!1})=>{const{userProfile:a}=ve(),[l,c]=b.useState(!1),[d,u]=b.useState(""),[h,f]=b.useState([]),[p,m]=b.useState(!1),[g,y]=b.useState([]),[x,S]=b.useState([]),[C,k]=b.useState(null),j=b.useRef(null),O=b.useRef(null);b.useEffect(()=>{(async()=>{try{let _;n&&(a!=null&&a.uid)?_=await _h(a.uid):_=await $h(),y(_);const Y=new Qs(_,{keys:[{name:"title",weight:.4},{name:"categories",weight:.3},{name:"tags",weight:.2},{name:"authorName",weight:.15},{name:"excerpt",weight:.1,getFn:Z=>$i(Z.excerpt||"")},{name:"content",weight:.05,getFn:Z=>$i(Z.content||"")}],includeScore:!0,includeMatches:!0,threshold:.3,ignoreLocation:!0,minMatchCharLength:1,useExtendedSearch:!0,shouldSort:!0});k(Y)}catch(_){console.error("Error loading articles:",_)}})(),v()},[n,a==null?void 0:a.uid]),b.useEffect(()=>{l&&j.current&&setTimeout(()=>{var P;(P=j.current)==null||P.focus()},150),v()},[l]),b.useEffect(()=>{a&&v()},[a]),b.useEffect(()=>{const P=_=>{O.current&&!O.current.contains(_.target)&&(c(!1),u(""),f([]))};return l&&document.addEventListener("mousedown",P),()=>{document.removeEventListener("mousedown",P)}},[l]);const N=b.useCallback(fb(P=>{if(!P.trim()||!C){f([]),m(!1);return}m(!0);try{const _=ub(P),Z=C.search(_).sort((J,te)=>(J.score||0)-(te.score||0)).map(J=>J.item).slice(0,6);f(Z)}catch(_){console.error("Search error:",_),f([])}m(!1)},300),[C]),w=P=>{const _=P.target.value;u(_),N(_)},v=()=>{try{const P=(a==null?void 0:a.uid)||"anonymous",_=localStorage.getItem(`recent_searches_${P}`);if(_){const Y=JSON.parse(_),Z=Date.now()-30*24*60*60*1e3,J=Y.filter(te=>te.timestamp>Z).slice(0,5);S(J),J.length!==Y.length&&localStorage.setItem(`recent_searches_${P}`,JSON.stringify(J))}}catch(P){console.error("Error loading recent searches:",P)}},M=P=>{if(P.trim())try{const _=(a==null?void 0:a.uid)||"anonymous",Y=localStorage.getItem(`recent_searches_${_}`);let Z=Y?JSON.parse(Y):[];Z=Z.filter(J=>J.query.toLowerCase()!==P.toLowerCase()),Z.unshift({query:P,timestamp:Date.now()}),Z=Z.slice(0,5),localStorage.setItem(`recent_searches_${_}`,JSON.stringify(Z)),S(Z)}catch(_){console.error("Error saving recent search:",_)}},E=P=>{M(d),t==null||t(),c(!1),u(""),f([])},L=P=>{u(P),N(P)},I=P=>{u(P),N(P)},W=()=>{u(""),f([])},H=()=>{l||c(!0)},R=()=>{switch(s){case"minimal":return"bg-gradient-to-r from-[#1D4ED8] via-[#7C3AED] to-[#EC4899] p-[1px] rounded-xl hover:shadow-md";case"hero":return"bg-gradient-to-r from-[#1D4ED8] via-[#7C3AED] to-[#EC4899] p-[2px] rounded-2xl shadow-lg hover:shadow-xl";default:return"bg-gradient-to-r from-[#1D4ED8] via-[#7C3AED] to-[#EC4899] p-[1px] rounded-xl hover:shadow-md"}},A=()=>{switch(s){case"minimal":return"bg-white/95 backdrop-blur-sm rounded-xl";case"hero":return"bg-white/95 backdrop-blur-sm rounded-2xl";default:return"bg-white/95 backdrop-blur-sm rounded-xl"}},F=()=>{switch(s){case"hero":return"px-6 py-5 text-lg";case"minimal":return"px-4 py-2";default:return"px-4 py-3"}},U=()=>{switch(s){case"hero":return"h-6 w-6";default:return"h-5 w-5"}};return o.jsxs("div",{ref:O,className:`w-full transition-all duration-300 ease-out ${i?"relative":""} ${e}`,style:{zIndex:l?9999:"auto"},children:[o.jsx("div",{onClick:H,className:`
          w-full cursor-pointer transition-all duration-300 ease-out
          ${R()}
          ${l?"shadow-xl transform scale-[1.01]":"shadow-sm hover:shadow-md"}
        `,style:{zIndex:l?9999:"auto"},children:o.jsxs("div",{className:`
          flex items-center space-x-3 transition-all duration-300 ease-out
          ${A()}
          ${F()}
        `,children:[o.jsx(Di,{className:`text-gray-400 flex-shrink-0 transition-all duration-300 ease-out ${U()} ${l?"text-blue-500":""}`}),o.jsx("input",{ref:j,type:"text",value:d,onChange:w,placeholder:r,className:"flex-1 bg-transparent outline-none text-gray-700 placeholder-gray-500 transition-all duration-300 ease-out"}),d&&o.jsx("button",{onClick:P=>{P.stopPropagation(),W()},className:"p-1 hover:bg-gray-100 rounded-full transition-all duration-200 flex-shrink-0 transform hover:scale-110",children:o.jsx(et,{className:"h-4 w-4 text-gray-400 hover:text-gray-600"})}),!l&&o.jsxs("div",{className:"hidden md:flex items-center space-x-1 text-xs text-gray-400 flex-shrink-0 transition-opacity duration-300",children:[o.jsx("kbd",{className:"px-2 py-1 bg-gray-100 rounded border text-xs transition-all duration-200 hover:bg-gray-200",children:"⌘"}),o.jsx("kbd",{className:"px-2 py-1 bg-gray-100 rounded border text-xs transition-all duration-200 hover:bg-gray-200",children:"K"})]})]})}),o.jsx("div",{className:`
          overflow-hidden
          bg-gradient-to-r from-[#1D4ED8] via-[#7C3AED] to-[#EC4899] p-[1px] rounded-b-xl
          transition-all duration-300 ease-out
          ${i?"absolute top-full left-0 right-0 mt-1":""}
          ${l?"opacity-100 shadow-2xl":"opacity-0 shadow-none pointer-events-none"}
          ${!i&&l?"mt-2":""}
          ${!i&&!l?"mt-0":""}
        `,style:{transformOrigin:"top center",transform:l?"scaleY(1)":"scaleY(0)",height:l?"auto":"0",zIndex:i?9998:"auto"},children:o.jsx("div",{className:"bg-white/95 backdrop-blur-sm rounded-b-xl transition-all duration-300 ease-out",children:o.jsxs("div",{className:"p-4 max-h-80 overflow-y-auto transition-all duration-300 ease-out",children:[!d&&o.jsxs("div",{className:"space-y-4",children:[x.length>0&&o.jsxs("div",{children:[o.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[o.jsx(jt,{className:"h-4 w-4 text-gray-400"}),o.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Recent"})]}),o.jsx("div",{className:"space-y-1",children:x.map((P,_)=>o.jsxs("button",{onClick:()=>L(P.query),className:"flex items-center justify-between w-full p-2 text-left hover:bg-gray-50 rounded-lg transition-colors group",children:[o.jsxs("div",{className:"flex items-center space-x-3",children:[o.jsx(jt,{className:"h-4 w-4 text-gray-400"}),o.jsx("span",{className:"text-gray-700 group-hover:text-gray-900",children:P.query})]}),o.jsxs("span",{className:"text-xs text-gray-400",children:[Ht(P.timestamp)," ago"]})]},_))})]}),o.jsx("div",{children:o.jsx("div",{className:"flex flex-wrap gap-2",children:hb.map(P=>o.jsxs("button",{onClick:()=>I(P),className:"inline-flex items-center space-x-1 px-3 py-1.5 bg-gray-100 hover:bg-blue-100 hover:text-blue-700 text-gray-700 rounded-full text-sm font-medium transition-all duration-200 hover:scale-105",children:[o.jsx(hs,{className:"h-3 w-3"}),o.jsx("span",{children:P})]},P))})})]}),d&&o.jsx("div",{children:p?o.jsxs("div",{className:"flex items-center justify-center py-6",children:[o.jsx("div",{className:"animate-spin h-5 w-5 border-2 border-blue-500 border-t-transparent rounded-full"}),o.jsx("span",{className:"ml-3 text-gray-600",children:"Searching..."})]}):h.length>0?o.jsxs("div",{className:"space-y-2",children:[o.jsxs("div",{className:"text-sm text-gray-500 mb-3",children:[h.length," result",h.length!==1?"s":""," ","found"]}),h.map(P=>o.jsx(le,{to:`/article/${P.id}`,onClick:()=>E(),className:"block p-3 hover:bg-gray-50 rounded-lg transition-colors group",children:o.jsxs("div",{className:"flex items-start space-x-3",children:[P.coverImage&&o.jsx("div",{className:"flex-shrink-0 w-12 h-12 bg-gray-100 rounded-lg overflow-hidden",children:o.jsx("img",{src:P.coverImage,alt:P.title,className:"w-full h-full object-cover group-hover:scale-105 transition-transform"})}),o.jsxs("div",{className:"flex-1 min-w-0",children:[o.jsx("h3",{className:"font-medium text-gray-900 group-hover:text-blue-700 transition-colors line-clamp-1",children:aa(P.title,d)}),o.jsx("p",{className:"text-sm text-gray-600 mt-1 line-clamp-2",children:aa(P.excerpt,d)}),o.jsxs("div",{className:"flex items-center space-x-3 mt-2 text-xs text-gray-500",children:[o.jsxs("span",{children:["By ",P.authorName]}),o.jsx("span",{children:"•"}),o.jsxs("span",{children:[Ht(P.publishedAt||P.createdAt)," ","ago"]})]}),P.tags.length>0&&o.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:P.tags.slice(0,2).map(_=>o.jsx("span",{className:"px-2 py-0.5 bg-blue-100 text-blue-700 text-xs rounded-full",children:aa(_,d)},_))})]}),o.jsx(mi,{className:"h-4 w-4 text-gray-400 group-hover:text-blue-600 transition-colors flex-shrink-0"})]})},P.id))]}):o.jsxs("div",{className:"text-center py-6",children:[o.jsx(Di,{className:"h-8 w-8 text-gray-300 mx-auto mb-2"}),o.jsx("h3",{className:"text-sm font-medium text-gray-900 mb-1",children:"No results found"}),o.jsx("p",{className:"text-xs text-gray-600",children:"Try adjusting your search terms or browse our recommended topics above."})]})})]})})})]})};function fb(r,e){let t;return(...s)=>{clearTimeout(t),t=setTimeout(()=>r(...s),e)}}const pb=()=>{const r=b.useContext(gh);if(!r)return o.jsx("div",{className:"relative",children:o.jsx("button",{className:"relative p-2 text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-lg transition-colors",title:"Notifications (Loading...)",disabled:!0,children:o.jsx(Qn,{className:"h-6 w-6"})})});const{notifications:e,unreadCount:t,markAsRead:s,markAllAsRead:n,deleteNotification:i}=r,[a,l]=b.useState(!1),c=b.useRef(null);b.useEffect(()=>{const m=g=>{c.current&&!c.current.contains(g.target)&&l(!1)};return document.addEventListener("mousedown",m),()=>{document.removeEventListener("mousedown",m)}},[]);const d=async(m,g)=>{g||await s(m)},u=async()=>{await n()},h=async(m,g)=>{g.stopPropagation(),await i(m)},f=m=>{switch(m){case"role_approval":return o.jsx(qc,{className:"h-5 w-5 text-blue-600"});case"system":return o.jsx(St,{className:"h-5 w-5 text-blue-600"});case"writer_privileges_removed":return o.jsx(St,{className:"h-5 w-5 text-red-600"});case"writer_privileges_restored":return o.jsx(qc,{className:"h-5 w-5 text-green-600"});default:return o.jsx(Qn,{className:"h-5 w-5 text-gray-600"})}},p=(m,g)=>{if(g)return"bg-gray-50";switch(m){case"role_approval":return"bg-blue-50 border-l-4 border-blue-500";case"system":return"bg-blue-50 border-l-4 border-blue-500";case"writer_privileges_removed":return"bg-red-50 border-l-4 border-red-500";case"writer_privileges_restored":return"bg-green-50 border-l-4 border-green-500";default:return"bg-white border-l-4 border-gray-300"}};return o.jsxs("div",{className:"relative",ref:c,children:[o.jsxs("button",{onClick:()=>l(!a),className:"relative p-2 text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-lg transition-colors",title:"Notifications",children:[o.jsx(Qn,{className:"h-6 w-6"}),t>0&&o.jsx("span",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center font-medium",children:t>9?"9+":t})]}),a&&o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>l(!1)}),o.jsxs("div",{className:"absolute right-0 mt-2 w-96 bg-white rounded-lg shadow-lg border border-gray-200 z-20 max-h-96 overflow-hidden",children:[o.jsxs("div",{className:"px-4 py-3 border-b border-gray-200 flex items-center justify-between",children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Notifications"}),t>0&&o.jsxs("button",{onClick:u,className:"text-sm text-blue-600 hover:text-blue-700 flex items-center space-x-1",children:[o.jsx(T0,{className:"h-4 w-4"}),o.jsx("span",{children:"Mark all read"})]})]}),o.jsx("div",{className:"max-h-80 overflow-y-auto",children:e.length===0?o.jsxs("div",{className:"px-4 py-8 text-center text-gray-500",children:[o.jsx(Qn,{className:"h-12 w-12 text-gray-300 mx-auto mb-3"}),o.jsx("p",{className:"text-sm",children:"No notifications yet"})]}):o.jsx("div",{className:"divide-y divide-gray-100",children:e.map(m=>o.jsx("div",{onClick:()=>d(m.id,m.isRead),className:`px-4 py-3 cursor-pointer hover:bg-gray-50 transition-colors ${p(m.type,m.isRead)}`,children:o.jsxs("div",{className:"flex items-start space-x-3",children:[o.jsx("div",{className:"flex-shrink-0 mt-1",children:f(m.type)}),o.jsx("div",{className:"flex-1 min-w-0",children:o.jsxs("div",{className:"flex items-start justify-between",children:[o.jsxs("div",{className:"flex-1",children:[o.jsx("p",{className:`text-sm font-medium ${m.isRead?"text-gray-700":"text-gray-900"}`,children:m.title}),o.jsx("p",{className:`text-sm mt-1 ${m.isRead?"text-gray-500":"text-gray-700"}`,children:m.message}),o.jsxs("p",{className:"text-xs text-gray-400 mt-2",children:[Ht(m.createdAt)," ","ago"]})]}),o.jsxs("div",{className:"flex items-center space-x-1 ml-2",children:[!m.isRead&&o.jsx("button",{onClick:g=>{g.stopPropagation(),s(m.id)},className:"p-1 text-gray-400 hover:text-green-600 transition-colors",title:"Mark as read",children:o.jsx(_l,{className:"h-4 w-4"})}),o.jsx("button",{onClick:g=>h(m.id,g),className:"p-1 text-gray-400 hover:text-red-600 transition-colors",title:"Delete notification",children:o.jsx(et,{className:"h-4 w-4"})})]})]})})]})},m.id))})}),e.length>0&&o.jsx("div",{className:"px-4 py-3 border-t border-gray-200 text-center",children:o.jsxs("p",{className:"text-xs text-gray-500",children:[e.length," notification",e.length!==1?"s":""," total"]})})]})]})]})},Gr=class Gr{constructor(){Me(this,"uploads",new Map);Me(this,"progressCallbacks",new Map);Me(this,"completionCallbacks",new Map);Me(this,"isOnline",navigator.onLine);Me(this,"STORAGE_KEY","infonest_uploads");Me(this,"MAX_CONCURRENT_UPLOADS",3);Me(this,"uploadQueue",[]);Me(this,"activeUploads",new Set);try{const e=localStorage.getItem(this.STORAGE_KEY);e&&e.length>2*1024*1024&&(console.warn("Clearing large upload data from localStorage"),localStorage.removeItem(this.STORAGE_KEY))}catch{console.warn("Clearing corrupted upload data from localStorage"),localStorage.removeItem(this.STORAGE_KEY)}this.isOnline=navigator.onLine,this.setupNetworkListeners(),this.loadPersistedUploads(),this.startUploadProcessor()}static getInstance(){return Gr.instance||(Gr.instance=new Gr),Gr.instance}setupNetworkListeners(){window.addEventListener("online",()=>{this.isOnline=!0,this.uploads.forEach((e,t)=>{e.state==="paused"&&e.uploadTask&&this.resumeUpload(t)})}),window.addEventListener("offline",()=>{this.isOnline=!1,this.uploads.forEach((e,t)=>{e.state==="running"&&this.pauseUpload(t)})}),setInterval(()=>{this.checkConnectivity()},2e3)}async checkConnectivity(){try{const e=this.isOnline;this.isOnline=navigator.onLine,!e&&this.isOnline?(console.log("🌐 Connection restored, resuming paused uploads..."),this.uploads.forEach((t,s)=>{t.state==="paused"&&(console.log(`📤 Resuming upload: ${t.fileName} (${t.bytesTransferred}/${t.totalBytes} bytes)`),this.resumeUpload(s))})):e&&!this.isOnline&&(console.log("🔌 Connection lost, pausing running uploads..."),this.uploads.forEach((t,s)=>{t.state==="running"&&(console.log(`⏸️ Pausing upload: ${t.fileName} (${t.bytesTransferred}/${t.totalBytes} bytes)`),this.pauseUpload(s))}))}catch{const t=this.isOnline;this.isOnline=!1,t&&this.uploads.forEach((s,n)=>{s.state==="running"&&this.pauseUpload(n)})}}loadPersistedUploads(){try{const e=localStorage.getItem(this.STORAGE_KEY);e&&JSON.parse(e).forEach(s=>{if(s.state==="running"||s.state==="paused"){if(s.state="paused",s.fileData&&s.fileType&&s.fileName)try{const n=this.base64ToArrayBuffer(s.fileData),i=new File([n],s.fileName,{type:s.fileType,lastModified:s.fileLastModified||Date.now()});s.file=i,s.fileData=n}catch(n){console.error("Failed to restore file for upload:",s.id,n);return}else{console.warn("Upload missing file data, skipping:",s.id);return}this.uploads.set(s.id,s),s.state==="paused"&&this.uploadQueue.push(s.id)}})}catch(e){console.error("Failed to load persisted uploads:",e)}}persistUploads(){try{const e=Array.from(this.uploads.values()).map(s=>({id:s.id,fileName:s.fileName,filePath:s.filePath,userId:s.userId,folder:s.folder,startTime:s.startTime,lastProgressTime:s.lastProgressTime,bytesTransferred:s.bytesTransferred,totalBytes:s.totalBytes,state:s.state,fileType:s.fileType,fileLastModified:s.fileLastModified,context:s.context,needsProcessing:s.needsProcessing,uploadTask:void 0,file:void 0,fileData:void 0})),t=JSON.stringify(e);if(t.length>4*1024*1024){console.warn("Upload data too large for localStorage, clearing old uploads"),this.clearCompletedUploads();return}localStorage.setItem(this.STORAGE_KEY,t)}catch(e){console.error("Failed to persist uploads:",e);try{this.clearCompletedUploads();const t=Array.from(this.uploads.values()).filter(s=>s.state==="uploading"||s.state==="paused").map(s=>({id:s.id,fileName:s.fileName,filePath:s.filePath,userId:s.userId,folder:s.folder,startTime:s.startTime,lastProgressTime:s.lastProgressTime,bytesTransferred:s.bytesTransferred,totalBytes:s.totalBytes,state:s.state,fileType:s.fileType,fileLastModified:s.fileLastModified,context:s.context,needsProcessing:s.needsProcessing}));localStorage.setItem(this.STORAGE_KEY,JSON.stringify(t))}catch(t){console.error("Failed to persist even active uploads:",t),localStorage.removeItem(this.STORAGE_KEY)}}}clearCompletedUploads(){const e=["completed","failed","cancelled"];for(const[t,s]of this.uploads.entries())e.includes(s.state)&&this.uploads.delete(t);console.log("Cleared completed uploads to free localStorage space")}startUploadProcessor(){setInterval(()=>{this.processUploadQueue()},1e3)}processUploadQueue(){if(this.isOnline)for(;this.activeUploads.size<this.MAX_CONCURRENT_UPLOADS&&this.uploadQueue.length>0;){const e=this.uploadQueue.shift();e&&this.uploads.has(e)&&this.startUpload(e)}}async addUpload(e,t,s="articles",n,i,a){const l=this.generateUploadId(),c=a==null?void 0:a.articleId;let d,u;try{const p=this.generateFileName(e.name,t,c,s);d=p.split("/").pop()||e.name,s==="articles"&&!c?u=`temp/${p}`:u=`${s}/${p}`}catch(p){throw console.error("Error generating filename:",p),p}const h=await e.arrayBuffer(),f={id:l,file:e,fileName:e.name,filePath:u,userId:t,folder:s,startTime:Date.now(),lastProgressTime:Date.now(),bytesTransferred:0,totalBytes:e.size,state:"paused",fileData:h,fileType:e.type,fileLastModified:e.lastModified,context:a||{type:"attachment",pageUrl:window.location.href,autoSave:!1},needsProcessing:!1};return this.uploads.set(l,f),n&&this.progressCallbacks.set(l,n),i&&this.completionCallbacks.set(l,i),this.uploadQueue.push(l),this.persistUploads(),l}async startUpload(e){const t=this.uploads.get(e);if(!t||!t.file){console.error("Upload not found or file missing");return}if(!this.isOnline){t.state="paused";return}if(t.uploadTask&&t.state==="paused"){this.resumeUpload(e);return}this.activeUploads.add(e),t.state="running",t.bytesTransferred===0&&(t.startTime=Date.now()),t.lastProgressTime=Date.now();try{console.log(`🚀 Starting upload: ${t.fileName} → ${t.filePath}`);const s=Hn(Xs,t.filePath),n=cg(s,t.file);t.uploadTask=n,t.uploadSessionUrl=n.snapshot.ref.fullPath,n.on("state_changed",i=>{this.handleUploadProgress(e,i)},i=>{this.handleUploadError(e,i)},async()=>{await this.handleUploadComplete(e,n)}),this.persistUploads()}catch(s){this.handleUploadError(e,s)}}handleUploadProgress(e,t){const s=this.uploads.get(e);if(!s)return;const n=Date.now(),i=(n-s.lastProgressTime)/1e3,a=t.bytesTransferred-s.bytesTransferred;s.bytesTransferred=t.bytesTransferred,s.lastProgressTime=n;const l=i>0?a/i:0,c=s.totalBytes-s.bytesTransferred,d=l>0?c/l:0,u={bytesTransferred:t.bytesTransferred,totalBytes:t.totalBytes,percentage:Math.round(t.bytesTransferred/t.totalBytes*100),speed:l,estimatedTimeRemaining:d,state:s.state},h=this.progressCallbacks.get(e);h&&h(u),(u.percentage%5===0||i>10)&&this.persistUploads()}handleUploadError(e,t){const s=this.uploads.get(e);if(s){if(console.error(`Upload error for ${s.filePath}:`,t),s.state="error",s.error=t.message,this.activeUploads.delete(e),this.isRetryableError(t))s.state="paused",this.uploadQueue.includes(e)||this.uploadQueue.push(e);else{const n=this.completionCallbacks.get(e);n&&n(t),this.cleanupUpload(e)}this.persistUploads()}}async handleUploadComplete(e,t){var n;const s=this.uploads.get(e);if(s)try{const i=await eh(t.snapshot.ref);s.state="success",s.downloadURL=i,s.completedAt=Date.now(),this.activeUploads.delete(e);const a={url:i,path:s.filePath,name:s.filePath.split("/").pop()||s.fileName,originalName:s.fileName,size:s.totalBytes,type:((n=s.file)==null?void 0:n.type)||"application/octet-stream",uploadId:e};await this.handleCrossPageCompletion(s,a);const l=this.completionCallbacks.get(e);l?l(a):(s.needsProcessing=!0,this.persistUploads(),this.showGlobalNotification(s,a)),setTimeout(()=>{this.cleanupUpload(e)},3e4)}catch(i){this.handleUploadError(e,i)}}isRetryableError(e){return["network-request-failed","timeout","server-file-wrong-size","unknown"].some(s=>e.message.toLowerCase().includes(s)||e.name.toLowerCase().includes(s))}pauseUpload(e){const t=this.uploads.get(e);t&&t.uploadTask&&t.state==="running"&&(console.log(`⏸️ Pausing upload: ${t.fileName} at ${t.bytesTransferred}/${t.totalBytes} bytes`),t.uploadTask.pause(),t.state="paused",this.activeUploads.delete(e),this.persistUploads())}resumeUpload(e){const t=this.uploads.get(e);if(t&&t.state==="paused"&&this.isOnline){if(t.uploadTask)try{console.log(`▶️ Resuming existing upload task: ${t.fileName} from ${t.bytesTransferred}/${t.totalBytes} bytes`),t.uploadTask.resume(),t.state="running",this.activeUploads.add(e),t.lastProgressTime=Date.now(),this.persistUploads();return}catch(s){console.error("Failed to resume existing upload task:",e,s)}if(!t.file&&t.fileData)try{t.file=new File([t.fileData],t.fileName,{type:t.fileType||"application/octet-stream",lastModified:t.fileLastModified||Date.now()})}catch(s){console.error("Failed to recreate file for upload resumption:",e,s);return}this.uploadQueue.includes(e)||this.uploadQueue.push(e),this.persistUploads()}}cancelUpload(e){const t=this.uploads.get(e);if(!t)return;t.uploadTask&&t.uploadTask.cancel(),t.state="canceled",this.activeUploads.delete(e);const s=this.uploadQueue.indexOf(e);s>-1&&this.uploadQueue.splice(s,1),this.cleanupUpload(e)}deleteCompletedUpload(e){const t=this.uploads.get(e);if(t){if(!["completed","failed","canceled"].includes(t.state)){console.warn("Cannot delete active upload");return}this.uploads.delete(e),this.persistUploads(),console.log(`Deleted upload record: ${e}`)}}getUploadStatus(e){return this.uploads.get(e)||null}getAllUploads(){return Array.from(this.uploads.values())}getActiveUploads(){return Array.from(this.uploads.values()).filter(e=>e.state==="running"||e.state==="paused")}cleanupUpload(e){this.uploads.delete(e),this.progressCallbacks.delete(e),this.completionCallbacks.delete(e),this.activeUploads.delete(e);const t=this.uploadQueue.indexOf(e);t>-1&&this.uploadQueue.splice(t,1),this.persistUploads()}cleanupCompletedUploads(){Array.from(this.uploads.entries()).filter(([t,s])=>s.state==="success"||s.state==="error").forEach(([t,s])=>{this.cleanupUpload(t)})}removeUpload(e){const t=this.uploads.get(e);t&&((t.state==="running"||t.state==="paused")&&this.cancelUpload(e),this.uploads.delete(e),this.persistUploads(),console.log(`🗑️ Removed upload: ${e}`))}generateUploadId(){return`upload_${Date.now()}_${Math.random().toString(36).substring(2,15)}`}generateFileName(e,t,s,n){const i=Date.now(),l=e.replace(/[<>:"/\\|?*]/g,"_").replace(/\s+/g,"_").replace(/_{2,}/g,"_").replace(/^_+|_+$/g,"").split("."),c=l.pop()||"",d=l.join(".")||"file";return n==="articles"?s?`${t}/${s}/${d}_${i}.${c}`:`${t}/${d}_${i}.${c}`:`${t}/${d}_${i}.${c}`}formatFileSize(e){if(e===0)return"0 Bytes";const t=1024,s=["Bytes","KB","MB","GB"],n=Math.floor(Math.log(e)/Math.log(t));return parseFloat((e/Math.pow(t,n)).toFixed(2))+" "+s[n]}arrayBufferToBase64(e){const t=new Uint8Array(e);let s="";for(let n=0;n<t.byteLength;n++)s+=String.fromCharCode(t[n]);return btoa(s)}base64ToArrayBuffer(e){const t=atob(e),s=new Uint8Array(t.length);for(let n=0;n<t.length;n++)s[n]=t.charCodeAt(n);return s.buffer}formatSpeed(e){return`${this.formatFileSize(e)}/s`}formatTime(e){if(e===1/0||isNaN(e))return"Unknown";const t=Math.floor(e/3600),s=Math.floor(e%3600/60),n=Math.floor(e%60);return t>0?`${t}h ${s}m ${n}s`:s>0?`${s}m ${n}s`:`${n}s`}async handleCrossPageCompletion(e,t){if(e.context)try{switch(e.context.type){case"article":await this.handleArticleUploadCompletion(e,t);break;case"profile":await this.handleProfileUploadCompletion(e,t);break;case"cover":await this.handleCoverImageCompletion(e,t);break;default:break}}catch(s){console.error("Error handling cross-page upload completion:",s)}}async handleArticleUploadCompletion(e,t){const s=e.context;if(s!=null&&s.articleId)try{const{updateArticle:n,getArticle:i}=await Ue(async()=>{const{updateArticle:a,getArticle:l}=await Promise.resolve().then(()=>Xl);return{updateArticle:a,getArticle:l}},void 0);if(s.targetField==="coverImage"){const a=await i(s.articleId),l=a==null?void 0:a.coverImage;if(await n(s.articleId,{coverImage:t.url}),l&&l!==t.url)try{const{deleteFile:c,extractFilePathFromUrl:d}=await Ue(async()=>{const{deleteFile:h,extractFilePathFromUrl:f}=await Promise.resolve().then(()=>Va);return{deleteFile:h,extractFilePathFromUrl:f}},void 0),u=d(l);u&&u.startsWith("articles/")&&(await c(u),console.log("✅ Deleted old cover image:",u))}catch(c){console.error("⚠️ Failed to delete old cover image:",c)}}else if(s.autoSave){const a=await i(s.articleId);if(a){const l=[...a.attachments||[],t.url];await n(s.articleId,{attachments:l,status:"draft"})}}}catch(n){console.error("Error updating article with upload:",n)}}async handleProfileUploadCompletion(e,t){var s;try{const{doc:n,updateDoc:i,getDoc:a}=await Ue(async()=>{const{doc:p,updateDoc:m,getDoc:g}=await import("./firebase-BWFbkFVW-1754723551018.js").then(y=>y.K);return{doc:p,updateDoc:m,getDoc:g}},[]),{firestore:l}=await Ue(async()=>{const{firestore:p}=await Promise.resolve().then(()=>Xn);return{firestore:p}},void 0),{deleteFile:c,extractFilePathFromUrl:d}=await Ue(async()=>{const{deleteFile:p,extractFilePathFromUrl:m}=await Promise.resolve().then(()=>Va);return{deleteFile:p,extractFilePathFromUrl:m}},void 0),u=n(l,"users",e.userId),h=await a(u),f=h.exists()?(s=h.data())==null?void 0:s.profilePicture:null;if(await i(u,{profilePicture:t.url,updatedAt:new Date}),f&&f!==t.url)try{const p=d(f);p&&p.startsWith("profiles/")&&(await c(p),console.log("✅ Deleted old profile picture:",p))}catch(p){console.error("⚠️ Failed to delete old profile picture:",p)}}catch(n){console.error("Error updating profile with upload:",n)}}async handleCoverImageCompletion(e,t){const s={uploadId:e.id,url:t.url,timestamp:Date.now(),context:e.context};localStorage.setItem("completed_cover_upload",JSON.stringify(s)),window.dispatchEvent(new CustomEvent("coverUploadCompleted",{detail:s}))}showGlobalNotification(e,t){const s={id:e.id,type:"upload_complete",title:"Upload Completed",message:`${e.fileName} has been uploaded successfully`,url:t.url,context:e.context,timestamp:Date.now()},n=JSON.parse(localStorage.getItem("upload_notifications")||"[]");n.push(s),n.length>10&&n.splice(0,n.length-10),localStorage.setItem("upload_notifications",JSON.stringify(n)),window.dispatchEvent(new CustomEvent("globalUploadComplete",{detail:s})),"Notification"in window&&Notification.permission==="granted"&&new Notification("Upload Completed",{body:s.message,icon:"/InfoNest/ChatGPT Image Jul 22, 2025, 11_54_47 AM.png"})}getCompletedUploads(){return Array.from(this.uploads.values()).filter(e=>e.state==="success"&&e.needsProcessing)}markAsProcessed(e){const t=this.uploads.get(e);t&&(t.needsProcessing=!1,this.persistUploads())}async updatePendingUploadsWithArticleId(e){const t=Array.from(this.uploads.entries()).filter(([s,n])=>{var i;return!((i=n.context)!=null&&i.articleId)&&n.folder==="articles"&&n.state==="success"&&n.filePath.includes("temp_")});if(t.length===0){console.log("No temp uploads to reorganize");return}console.log(`Moving ${t.length} temp files to organized structure`);for(const[s,n]of t)try{const i=this.generateFileName(n.fileName.replace(/^temp_\d+_[a-z0-9]+\./,"")||n.fileName,n.userId,e,n.folder),a=`${n.folder}/${i}`;await this.moveFileInStorage(n.filePath,a),n.context={...n.context,articleId:e},n.filePath=a,n.needsProcessing=!1,console.log(`✅ Moved: ${n.filePath} → ${a}`)}catch(i){console.error(`❌ Failed to move temp file ${n.filePath}:`,i)}this.persistUploads()}async moveFileInStorage(e,t){try{const{ref:s,uploadBytes:n,getDownloadURL:i,deleteObject:a}=await Ue(async()=>{const{ref:f,uploadBytes:p,getDownloadURL:m,deleteObject:g}=await import("./firebase-BWFbkFVW-1754723551018.js").then(y=>y.L);return{ref:f,uploadBytes:p,getDownloadURL:m,deleteObject:g}},[]),{storage:l}=await Ue(async()=>{const{storage:f}=await Promise.resolve().then(()=>Xn);return{storage:f}},void 0),c=s(l,e),u=await(await fetch(await i(c))).blob(),h=s(l,t);await n(h,u),await a(c),console.log(`📁 File moved: ${e} → ${t}`)}catch(s){throw console.error(`❌ Error moving file from ${e} to ${t}:`,s),s}}async cleanupTempFiles(e){const t=Array.from(this.uploads.entries()).filter(([s,n])=>{var i;return n.userId===e&&n.folder==="articles"&&n.filePath.includes("temp_")&&!((i=n.context)!=null&&i.articleId)});if(t.length!==0){console.log(`🧹 Cleaning up ${t.length} temp files for user ${e}`);for(const[s,n]of t)try{const{ref:i,deleteObject:a}=await Ue(async()=>{const{ref:d,deleteObject:u}=await import("./firebase-BWFbkFVW-1754723551018.js").then(h=>h.L);return{ref:d,deleteObject:u}},[]),{storage:l}=await Ue(async()=>{const{storage:d}=await Promise.resolve().then(()=>Xn);return{storage:d}},void 0),c=i(l,n.filePath);await a(c),this.uploads.delete(s),console.log(`🗑️ Deleted temp file: ${n.filePath}`)}catch(i){console.error(`❌ Failed to delete temp file ${n.filePath}:`,i)}this.persistUploads()}}async cleanupUnusedFiles(e,t,s,n,i){const a=Array.from(this.uploads.entries()).filter(([u,h])=>{var f;return h.userId===e&&((f=h.context)==null?void 0:f.articleId)===t&&h.state==="success"});if(a.length===0)return;const l=new Set;n&&l.add(n),i&&i.forEach(u=>l.add(u)),this.extractImageUrlsFromContent(s).forEach(u=>l.add(u));const d=a.filter(([u,h])=>h.downloadURL&&!l.has(h.downloadURL));if(d.length!==0){console.log(`🧹 Cleaning up ${d.length} unused files for article ${t}`);for(const[u,h]of d)try{const{ref:f,deleteObject:p}=await Ue(async()=>{const{ref:y,deleteObject:x}=await import("./firebase-BWFbkFVW-1754723551018.js").then(S=>S.L);return{ref:y,deleteObject:x}},[]),{storage:m}=await Ue(async()=>{const{storage:y}=await Promise.resolve().then(()=>Xn);return{storage:y}},void 0),g=f(m,h.filePath);await p(g),this.uploads.delete(u),console.log(`🗑️ Deleted unused file: ${h.filePath}`)}catch(f){console.error(`❌ Failed to delete unused file ${h.filePath}:`,f)}this.persistUploads()}}extractImageUrlsFromContent(e){const t=/<img[^>]+src=["']([^"']+)["'][^>]*>/gi,s=[];let n;for(;(n=t.exec(e))!==null;)s.push(n[1]);return s}getUploadNotifications(){return JSON.parse(localStorage.getItem("upload_notifications")||"[]")}clearUploadNotifications(){localStorage.removeItem("upload_notifications")}};Me(Gr,"instance");let Za=Gr;const ge=Za.getInstance(),af=({isOpen:r,onClose:e,className:t="",articleId:s})=>{const[n,i]=b.useState([]),[a,l]=b.useState([]),[c,d]=b.useState(navigator.onLine),[u,h]=b.useState(!1),[f,p]=b.useState("all");b.useEffect(()=>{if(s){const v=ge.getAllUploads().filter(M=>{var E;return((E=M.context)==null?void 0:E.articleId)===s||M.state==="success"&&M.downloadURL}).map(M=>{const E={bytesTransferred:M.bytesTransferred,totalBytes:M.totalBytes,percentage:Math.round(M.bytesTransferred/M.totalBytes*100),speed:0,estimatedTimeRemaining:0,state:M.state};return{id:M.id,metadata:M,progress:E}});l(v)}},[s]),b.useEffect(()=>{const w=()=>d(!0),v=()=>d(!1);return window.addEventListener("online",w),window.addEventListener("offline",v),()=>{window.removeEventListener("online",w),window.removeEventListener("offline",v)}},[]),b.useEffect(()=>{const w=setInterval(()=>{const M=ge.getAllUploads().map(L=>{const I={bytesTransferred:L.bytesTransferred,totalBytes:L.totalBytes,percentage:Math.round(L.bytesTransferred/L.totalBytes*100),speed:0,estimatedTimeRemaining:0,state:L.state};return{id:L.id,metadata:L,progress:I}});i(M);const E=M.filter(L=>L.metadata.state==="success"&&L.metadata.downloadURL);l(L=>{const I=new Set(L.map(R=>R.id)),W=E.filter(R=>!I.has(R.id));return[...L,...W]})},1e3);return()=>clearInterval(w)},[s]);const m=(w,v)=>{switch(v){case"pause":ge.pauseUpload(w);break;case"resume":case"retry":ge.resumeUpload(w);break;case"cancel":ge.cancelUpload(w);break}},g=()=>{n.filter(v=>v.progress.state==="error"||v.progress.state==="canceled").forEach(v=>{ge.removeUpload(v.id)}),i(v=>v.filter(M=>M.progress.state!=="error"&&M.progress.state!=="canceled")),l(v=>v.filter(M=>M.progress.state!=="error"&&M.progress.state!=="canceled"))},y=()=>{const w=[...a];switch(n.forEach(v=>{w.find(M=>M.id===v.id)||w.push(v)}),f){case"active":return w.filter(v=>v.progress.state==="running"||v.progress.state==="paused");case"completed":return w.filter(v=>v.progress.state==="success");case"failed":return w.filter(v=>v.progress.state==="error"||v.progress.state==="canceled");default:return w}},x=w=>{switch(w){case"running":return o.jsx(rt,{className:"h-4 w-4 text-blue-600 animate-pulse"});case"paused":return o.jsx(Mi,{className:"h-4 w-4 text-yellow-600"});case"success":return o.jsx(sr,{className:"h-4 w-4 text-green-600"});case"error":return o.jsx(St,{className:"h-4 w-4 text-red-600"});case"canceled":return o.jsx(et,{className:"h-4 w-4 text-gray-600"});default:return o.jsx(jt,{className:"h-4 w-4 text-gray-600"})}},S=w=>{switch(w){case"running":return"border-blue-200 bg-blue-50";case"paused":return"border-yellow-200 bg-yellow-50";case"success":return"border-green-200 bg-green-50";case"error":return"border-red-200 bg-red-50";case"canceled":return"border-gray-200 bg-gray-50";default:return"border-gray-200 bg-gray-50"}},C=y(),k=C,j=k.filter(w=>w.progress.state==="running"||w.progress.state==="paused").length,O=k.filter(w=>w.progress.state==="success").length,N=k.filter(w=>w.progress.state==="error"||w.progress.state==="canceled").length;return r?o.jsx("div",{className:`fixed bottom-4 right-4 z-50 ${t}`,children:o.jsxs("div",{className:"bg-white rounded-lg shadow-xl border border-gray-200 w-96 max-h-[600px] overflow-hidden",children:[o.jsxs("div",{className:"p-4 border-b border-gray-200 flex items-center justify-between bg-gradient-to-r from-blue-50 to-purple-50",children:[o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx(rt,{className:"h-5 w-5 text-blue-600"}),o.jsx("h3",{className:"font-semibold text-gray-900",children:"Upload Manager"}),!c&&o.jsxs("div",{className:"flex items-center space-x-1 text-red-600 bg-red-100 px-2 py-1 rounded-full",children:[o.jsx(fn,{className:"h-3 w-3"}),o.jsx("span",{className:"text-xs",children:"Offline"})]})]}),o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx("button",{onClick:()=>h(!u),className:"text-gray-400 hover:text-gray-600 p-1",title:u?"Maximize":"Minimize",children:u?o.jsx(q0,{className:"h-4 w-4"}):o.jsx(K0,{className:"h-4 w-4"})}),o.jsx("button",{onClick:e,className:"text-gray-400 hover:text-gray-600 p-1",title:"Close",children:o.jsx(et,{className:"h-4 w-4"})})]})]}),!u&&o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"p-4 border-b border-gray-200 bg-gray-50",children:[o.jsxs("div",{className:"grid grid-cols-4 gap-2 mb-3",children:[o.jsxs("button",{onClick:()=>p("all"),className:`text-center p-2 rounded text-xs ${f==="all"?"bg-blue-100 text-blue-800":"text-gray-600 hover:bg-gray-100"}`,children:[o.jsx("div",{className:"font-semibold",children:k.length}),o.jsx("div",{children:"All"})]}),o.jsxs("button",{onClick:()=>p("active"),className:`text-center p-2 rounded text-xs ${f==="active"?"bg-yellow-100 text-yellow-800":"text-gray-600 hover:bg-gray-100"}`,children:[o.jsx("div",{className:"font-semibold",children:j}),o.jsx("div",{children:"Active"})]}),o.jsxs("button",{onClick:()=>p("completed"),className:`text-center p-2 rounded text-xs ${f==="completed"?"bg-green-100 text-green-800":"text-gray-600 hover:bg-gray-100"}`,children:[o.jsx("div",{className:"font-semibold",children:O}),o.jsx("div",{children:"Done"})]}),o.jsxs("button",{onClick:()=>p("failed"),className:`text-center p-2 rounded text-xs ${f==="failed"?"bg-red-100 text-red-800":"text-gray-600 hover:bg-gray-100"}`,children:[o.jsx("div",{className:"font-semibold",children:N}),o.jsx("div",{children:"Failed"})]})]}),N>0&&o.jsx("button",{onClick:g,className:"w-full text-xs text-gray-600 hover:text-gray-800 hover:bg-gray-100 py-1 px-2 rounded",children:"Clear failed uploads"})]}),o.jsx("div",{className:"max-h-80 overflow-y-auto",children:C.length===0?o.jsxs("div",{className:"p-8 text-center text-gray-500",children:[o.jsx(rt,{className:"h-8 w-8 mx-auto mb-2 text-gray-300"}),o.jsx("p",{className:"text-sm",children:f==="all"?"No uploads yet":`No ${f} uploads`})]}):C.map(w=>{var v;return o.jsxs("div",{className:`p-4 border-b border-gray-100 ${S(w.progress.state)}`,children:[o.jsxs("div",{className:"flex items-start justify-between mb-2",children:[o.jsxs("div",{className:"flex items-center space-x-2 flex-1 min-w-0",children:[Gl(((v=w.metadata.file)==null?void 0:v.type)||"")?o.jsx(_s,{className:"h-4 w-4 text-blue-600 flex-shrink-0"}):o.jsx(yh,{className:"h-4 w-4 text-gray-600 flex-shrink-0"}),o.jsxs("div",{className:"flex-1 min-w-0",children:[o.jsx("div",{className:"text-sm font-medium text-gray-900 truncate",children:w.metadata.fileName}),o.jsxs("div",{className:"text-xs text-gray-500",children:[ge.formatFileSize(w.metadata.totalBytes),w.metadata.startTime&&o.jsxs("span",{className:"ml-2",children:["Started ",Ht(w.metadata.startTime)," ago"]})]})]}),x(w.progress.state)]}),o.jsxs("div",{className:"flex items-center space-x-1 ml-2",children:[w.progress.state==="running"&&o.jsx("button",{onClick:()=>m(w.id,"pause"),className:"p-1 text-yellow-600 hover:bg-yellow-100 rounded",title:"Pause upload",children:o.jsx(Mi,{className:"h-3 w-3"})}),w.progress.state==="paused"&&o.jsx("button",{onClick:()=>m(w.id,"resume"),className:"p-1 text-green-600 hover:bg-green-100 rounded",title:"Resume upload",children:o.jsx(kh,{className:"h-3 w-3"})}),w.progress.state==="error"&&o.jsx("button",{onClick:()=>m(w.id,"retry"),className:"p-1 text-blue-600 hover:bg-blue-100 rounded",title:"Retry upload",children:o.jsx(Po,{className:"h-3 w-3"})}),w.progress.state==="success"&&w.metadata.downloadURL&&o.jsxs(o.Fragment,{children:[o.jsx("a",{href:w.metadata.downloadURL,target:"_blank",rel:"noopener noreferrer",className:"p-1 text-blue-600 hover:bg-blue-100 rounded",title:"View file",children:o.jsx(us,{className:"h-3 w-3"})}),o.jsx("a",{href:w.metadata.downloadURL,download:w.metadata.fileName,className:"p-1 text-green-600 hover:bg-green-100 rounded",title:"Download file",children:o.jsx(gi,{className:"h-3 w-3"})})]}),w.progress.state!=="success"&&o.jsx("button",{onClick:()=>m(w.id,"cancel"),className:"p-1 text-red-600 hover:bg-red-100 rounded",title:"Cancel upload",children:o.jsx(Tr,{className:"h-3 w-3"})})]})]}),w.progress.state!=="success"&&w.progress.state!=="canceled"&&o.jsxs("div",{className:"mb-2",children:[o.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-600 mb-1",children:[o.jsxs("span",{children:[w.progress.percentage,"%"]}),o.jsxs("span",{children:[ge.formatFileSize(w.progress.bytesTransferred)," / ",ge.formatFileSize(w.progress.totalBytes)]})]}),o.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:o.jsx("div",{className:`h-2 rounded-full transition-all duration-300 ${w.progress.state==="running"?"bg-blue-600":w.progress.state==="paused"?"bg-yellow-500":w.progress.state==="error"?"bg-red-500":"bg-green-500"}`,style:{width:`${w.progress.percentage}%`}})})]}),w.progress.state==="running"&&o.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[o.jsxs("div",{className:"flex items-center space-x-1",children:[o.jsx(Vl,{className:"h-3 w-3"}),o.jsx("span",{children:ge.formatSpeed(w.progress.speed)})]}),o.jsxs("div",{className:"flex items-center space-x-1",children:[o.jsx(jt,{className:"h-3 w-3"}),o.jsx("span",{children:ge.formatTime(w.progress.estimatedTimeRemaining)})]})]}),w.progress.state==="paused"&&o.jsxs("div",{className:"text-xs text-yellow-600",children:["Upload paused ",c?"":"(offline)"]}),w.progress.state==="error"&&w.metadata.error&&o.jsxs("div",{className:"text-xs text-red-600",children:["Error: ",w.metadata.error]}),w.progress.state==="success"&&o.jsx("div",{className:"text-xs text-green-600",children:"Upload completed successfully"})]},w.id)})})]})]})}):null},mb=()=>{const{userProfile:r,isAuthenticated:e,isInfoWriter:t,isAdmin:s}=ve();zn();const n=Tt(),[i,a]=b.useState(!1),[l,c]=b.useState(!1),[d,u]=b.useState(!1);b.useEffect(()=>{const f=setInterval(()=>{const m=ge.getActiveUploads().length>0;u(m),m&&!l&&c(!0)},2e3);return()=>clearInterval(f)},[l]);const h=async()=>{try{n("/",{replace:!0}),await lh()}catch(f){console.error("Error logging out:",f),n("/",{replace:!0})}};return b.useEffect(()=>{const f=p=>{p.target.closest("[data-dropdown]")||a(!1)};return document.addEventListener("mousedown",f),()=>document.removeEventListener("mousedown",f)},[]),e?o.jsxs("div",{className:"min-h-screen",style:{backgroundColor:"#EFEDFA"},children:[o.jsx("nav",{className:"bg-white/80 backdrop-blur-md border-b border-gray-200/50 sticky top-0 z-50",children:o.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:o.jsxs("div",{className:"flex justify-between items-center h-16",children:[o.jsx(le,{to:"/",className:"flex items-center space-x-3",children:o.jsx("span",{className:"text-3xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"InfoNest"})}),o.jsx("div",{className:"hidden md:flex items-center space-x-6 flex-1 max-w-md mx-8",children:o.jsx(vs,{variant:"minimal",placeholder:"Search articles, guides, documentation...",onResultClick:()=>{},className:"w-full",isHeaderSearch:!0})}),o.jsxs("div",{className:"flex items-center space-x-4",children:[o.jsx(pb,{}),d&&o.jsxs("button",{onClick:()=>c(!l),className:"relative p-2 text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-lg transition-colors",title:"Upload Manager",children:[o.jsx(rt,{className:"h-5 w-5"}),o.jsx("span",{className:"absolute -top-1 -right-1 bg-blue-500 text-white text-xs rounded-full h-4 w-4 flex items-center justify-center font-medium",children:ge.getActiveUploads().length})]}),o.jsxs("div",{className:"relative","data-dropdown":!0,children:[o.jsxs("button",{onClick:()=>a(!i),className:"flex items-center space-x-3 p-2 rounded-lg hover:bg-gray-100 transition-colors",children:[o.jsxs("div",{className:"text-right",children:[o.jsx("div",{className:"text-sm font-medium text-gray-700",children:(r==null?void 0:r.displayName)||(r==null?void 0:r.email)}),o.jsx("div",{className:"flex items-center justify-end space-x-2",children:(r==null?void 0:r.role)&&o.jsx(sx,{role:r.role})})]}),r!=null&&r.profilePicture?o.jsx("img",{src:r.profilePicture,alt:"Profile",className:"w-8 h-8 rounded-full object-cover border-2 border-gray-200"}):o.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 p-2 rounded-full hover:from-blue-700 hover:to-purple-700 transition-all",children:o.jsx(_e,{className:"h-4 w-4 text-white"})})]}),i&&o.jsxs("div",{className:"absolute right-0 mt-2 w-56 bg-white rounded-lg shadow-lg border border-gray-200 py-2 z-50",children:[o.jsxs(le,{to:"/profile",onClick:()=>a(!1),className:"flex items-center space-x-3 px-4 py-2 text-gray-700 hover:bg-gray-50 transition-colors",children:[o.jsx(_e,{className:"h-4 w-4"}),o.jsx("span",{children:"Profile"})]}),o.jsxs(le,{to:"/dashboard",onClick:()=>a(!1),className:"flex items-center space-x-3 px-4 py-2 text-gray-700 hover:bg-gray-50 transition-colors",children:[o.jsx(Sr,{className:"h-4 w-4"}),o.jsx("span",{children:"Dashboard"})]}),o.jsxs(le,{to:"/saved-articles",onClick:()=>a(!1),className:"flex items-center space-x-3 px-4 py-2 text-gray-700 hover:bg-gray-50 transition-colors",children:[o.jsx(br,{className:"h-4 w-4"}),o.jsx("span",{children:"Saved Articles"})]}),s&&o.jsxs(le,{to:"/my-articles",onClick:()=>a(!1),className:"flex items-center space-x-3 px-4 py-2 text-gray-700 hover:bg-gray-50 transition-colors",children:[o.jsx(rx,{className:"h-4 w-4"}),o.jsx("span",{children:"My Articles"})]}),t&&!s&&o.jsxs(le,{to:"/article/new",onClick:()=>a(!1),className:"flex items-center space-x-3 px-4 py-2 text-gray-700 hover:bg-gray-50 transition-colors",children:[o.jsx(zl,{className:"h-4 w-4"}),o.jsx("span",{children:"Create New Article"})]}),o.jsx("hr",{className:"my-2"}),o.jsxs("button",{onClick:h,className:"flex items-center space-x-3 px-4 py-2 text-red-600 hover:bg-red-50 transition-colors w-full text-left",children:[o.jsx(Ul,{className:"h-4 w-4"}),o.jsx("span",{children:"Logout"})]})]})]})]})]})})}),o.jsxs("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[o.jsx(Uc,{})," "]}),o.jsx(af,{isOpen:l,onClose:()=>c(!1)})]}):o.jsxs("div",{className:"min-h-screen",style:{backgroundColor:"#EFEDFA"},children:[o.jsx(Uc,{})," "]})},gb={"gmial.com":"gmail.com","gmai.com":"gmail.com","gmal.com":"gmail.com","gmil.com":"gmail.com","gmail.co":"gmail.com","gmail.cm":"gmail.com","gmail.om":"gmail.com","gmaill.com":"gmail.com","gmails.com":"gmail.com","yaho.com":"yahoo.com","yahooo.com":"yahoo.com","yahoo.co":"yahoo.com","yahoo.cm":"yahoo.com","yahoo.om":"yahoo.com","ymail.co":"ymail.com","hotmial.com":"hotmail.com","hotmai.com":"hotmail.com","hotmal.com":"hotmail.com","hotmail.co":"hotmail.com","hotmail.cm":"hotmail.com","outlok.com":"outlook.com","outlook.co":"outlook.com","outlook.cm":"outlook.com","aol.co":"aol.com","aol.cm":"aol.com","icloud.co":"icloud.com","icloud.cm":"icloud.com","protonmail.co":"protonmail.com","protonmail.cm":"protonmail.com"},xb=new Set(["gmail.com","yahoo.com","hotmail.com","outlook.com","aol.com","icloud.com","protonmail.com","ymail.com","live.com","msn.com","comcast.net","verizon.net","att.net","sbcglobal.net","cox.net","charter.net","earthlink.net","juno.com","mail.com","zoho.com","fastmail.com","tutanota.com","mailbox.org","runbox.com","edu","ac.uk","edu.au","edu.ca","gov","mil","gov.uk","gov.au","gov.ca","company.com","corporation.com","business.com"]),yb=new Set(["tk","ml","ga","cf","gq","pw","top","click","download","stream","science","racing","review","faith","accountant","loan","win","cricket","date","party","trade","webcam"]),bb=new Set(["10minutemail.com","tempmail.org","guerrillamail.com","mailinator.com","throwaway.email","temp-mail.org","getnada.com","maildrop.cc","sharklasers.com","grr.la","guerrillamailblock.com","pokemail.net","spam4.me","bccto.me","chacuo.net","dispostable.com","fakeinbox.com"]);function wb(r){return/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/.test(r)}function vb(r){var s;const e=(s=r.split("@")[1])==null?void 0:s.toLowerCase();if(!e)return{hasTypo:!1};const t=gb[e];return t?{hasTypo:!0,suggestion:`${r.split("@")[0]}@${t}`}:{hasTypo:!1}}function Nb(r){var s;const e=(s=r.split("@")[1])==null?void 0:s.toLowerCase();if(!e)return!1;const t=e.split(".").pop();return t?yb.has(t):!1}function jb(r){var t;const e=(t=r.split("@")[1])==null?void 0:t.toLowerCase();return e?bb.has(e):!1}function kb(r){var i;const e=(i=r.split("@")[1])==null?void 0:i.toLowerCase();if(!e)return!1;if(xb.has(e))return!0;const t=e.split("."),s=t[t.length-1];return t.length>1&&t[t.length-2],s==="edu"||e.endsWith(".edu")||e.endsWith(".ac.uk")||e.endsWith(".edu.au")||e.endsWith(".edu.ca")||s==="gov"||e.endsWith(".gov")||e.endsWith(".gov.uk")||e.endsWith(".gov.au")||e.endsWith(".gov.ca")||s==="mil"?!0:["com","org","net","co","io","biz"].includes(s)&&t.length>=2?e.length>6&&!e.includes("test")&&!e.includes("example"):!1}function Sb(r){var a;const e=(a=r.split("@")[0])==null?void 0:a.toLowerCase();if(!e)return!1;if(e.length>20)return!0;const t=(e.match(/\d/g)||[]).length,s=(e.match(/[a-z]/g)||[]).length;return t>0&&s>0&&t/s>2||/(.)\1{3,}/.test(e)?!0:[/^[a-z]{1,3}\d{6,}$/,/^\d{6,}[a-z]{1,3}$/,/^[a-z]\d[a-z]\d[a-z]\d/,/^(test|temp|fake|dummy|sample)\d*$/i,/^[qwerty]{4,}$/i,/^[asdf]{4,}$/i].some(l=>l.test(e))}function Eb(r){var s;const e=(s=r.split("@")[0])==null?void 0:s.toLowerCase();return e?["noreply","no-reply","donotreply","do-not-reply","admin","administrator","root","system","daemon","test","testing","temp","temporary","fake","dummy","example","sample","demo","null","void","none"].some(n=>e.includes(n)):!1}function el(r){const e=r.trim().toLowerCase();if(!wb(e))return{isValid:!1,error:"Please enter a valid email address (e.g., user@example.com)"};const t=vb(e);return t.hasTypo?{isValid:!1,error:"Did you mean this email address?",suggestions:[t.suggestion]}:jb(e)?{isValid:!1,error:"Temporary or disposable email addresses are not allowed. Please use a permanent email address."}:Eb(e)?{isValid:!1,error:"This email address appears to be a system or test email. Please use your personal email address."}:Sb(e)?{isValid:!1,error:"This email address appears to be randomly generated. Please enter a valid email address."}:Nb(e)?{isValid:!1,error:"This email domain appears suspicious. Please use an email from a trusted provider."}:(kb(e),{isValid:!0})}function Ab(r){var t;if(!r.trim())return{isValid:!0};const e=r.trim().toLowerCase();return e.includes("@")&&((t=e.split("@")[1])!=null&&t.includes("."))?el(e):{isValid:!0}}const Cb=()=>{const{refreshProfile:r}=ve(),e=Tt(),[t,s]=b.useState(!0),[n,i]=b.useState({email:"",password:"",confirmPassword:"",displayName:""}),[a,l]=b.useState(!1),[c,d]=b.useState(!1),[u,h]=b.useState(!1),[f,p]=b.useState({isValid:!0}),[m,g]=b.useState(!1),[y,x]=b.useState(""),S=zn(),C=async w=>{w.preventDefault(),l(!0);try{const v=el(n.email);if(!v.isValid){K.error(v.error||"Please enter a valid email address"),l(!1);return}if(t)await p0(n.email,n.password),await r(),K.success("Welcome back!"),e("/");else{if(n.password!==n.confirmPassword){K.error("Passwords do not match"),l(!1);return}const M=await h0(n.email,n.password,n.displayName);K.success("Account created! Please check your email and verify your address from any device."),e("/email-verify",{state:{email:n.email,displayName:n.displayName}})}}catch(v){K.error(v.message||"An error occurred")}finally{l(!1)}},k=async()=>{l(!0);try{await x0(),await r(),K.success("Signed in with Google!"),e("/")}catch(w){K.error(w.message||"Google sign-in failed.")}finally{l(!1)}},j=w=>{const{name:v,value:M}=w.target;if(i(E=>({...E,[v]:M})),v==="email"){const E=Ab(M);p(E),!m&&M.trim()&&g(!0)}},O=()=>{if(g(!0),n.email.trim()){const w=el(n.email);p(w)}},N=w=>{i(v=>({...v,email:w})),p({isValid:!0})};return b.useEffect(()=>{const w=new URLSearchParams(S.search),v=w.get("mode"),M=w.get("oobCode");v==="verifyEmail"&&M&&e(`/verify-email?mode=${v}&oobCode=${M}`,{replace:!0});const E=S.state;E!=null&&E.message&&x(E.message),E!=null&&E.verifiedEmail&&i(L=>({...L,email:E.verifiedEmail})),E!=null&&E.showLogin&&s(!0),E&&e(S.pathname,{replace:!0,state:{}})},[S.search,S.state,e]),o.jsxs("div",{className:"min-h-screen flex flex-col px-4",style:{backgroundColor:"#EFEDFA"},children:[o.jsx("div",{className:"w-full max-w-7xl mx-auto py-4",children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs(le,{to:"/",className:"flex items-center space-x-2 text-gray-600 hover:text-blue-600 transition-colors group",children:[o.jsx(Lt,{className:"h-5 w-5 group-hover:-translate-x-1 transition-transform"}),o.jsx("span",{className:"font-medium",children:"Back to Homepage"})]}),o.jsxs(le,{to:"/",className:"flex items-center space-x-3 text-2xl font-bold bg-gradient-to-r from-[#1D4ED8] via-[#7C3AED] to-[#EC4899] bg-clip-text text-transparent hover:from-blue-700 hover:to-purple-700 transition-all duration-300",children:[o.jsx(Fl,{className:"h-6 w-6 text-blue-600"}),o.jsx("span",{children:"InfoNest"})]})]})}),o.jsx("div",{className:"flex-1 flex items-center justify-center",children:o.jsxs("div",{className:"max-w-md w-full",children:[o.jsxs("div",{className:"text-center mb-8",children:[o.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-[#1D4ED8] via-[#7C3AED] to-[#EC4899] bg-clip-text text-transparent mb-2",children:"Welcome to InfoNest"}),o.jsx("p",{className:"text-gray-600 mt-2",children:t?"Where Documentation Meets Efficiency":"Join the knowledge community"})]}),o.jsxs("div",{className:"bg-white/80 backdrop-blur-md rounded-2xl shadow-xl border border-gray-100 p-8",children:[y&&o.jsx("div",{className:"mb-6 p-4 bg-green-50 border border-green-200 rounded-lg",children:o.jsx("p",{className:"text-green-800 text-sm",children:y})}),o.jsxs("form",{onSubmit:C,className:"space-y-6",children:[!t&&o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Display Name *"}),o.jsxs("div",{className:"relative",children:[o.jsx(_e,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),o.jsx("input",{type:"text",name:"displayName",value:n.displayName,onChange:j,onBlur:O,className:`w-full pl-10 pr-4 py-3 border rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all ${m&&!f.isValid?"border-red-300 bg-red-50":"border-gray-200"}`,placeholder:"Enter your name",required:!t})]}),m&&!f.isValid&&o.jsxs("div",{className:"mt-2",children:[o.jsx("p",{className:"text-red-600 text-sm",children:f.error}),f.suggestions&&f.suggestions.length>0&&o.jsxs("div",{className:"mt-2",children:[o.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Did you mean:"}),f.suggestions.map((w,v)=>o.jsx("button",{type:"button",onClick:()=>N(w),className:"inline-block bg-blue-100 hover:bg-blue-200 text-blue-800 px-3 py-1 rounded-full text-sm mr-2 transition-colors",children:w},v))]})]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email Address *"}),o.jsxs("div",{className:"relative",children:[o.jsx(Wt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),o.jsx("input",{type:"email",name:"email",value:n.email,onChange:j,className:"w-full pl-10 pr-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all",placeholder:"Enter your email",required:!0})]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Password *"}),o.jsxs("div",{className:"relative",children:[o.jsx(Wr,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),o.jsx("input",{type:c?"text":"password",name:"password",value:n.password,onChange:j,className:"w-full pl-10 pr-12 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all",placeholder:"Enter your password",required:!0}),o.jsx("button",{type:"button",onClick:()=>d(!c),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:c?o.jsx(zs,{className:"h-5 w-5"}):o.jsx(us,{className:"h-5 w-5"})})]})]}),!t&&o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Confirm Password *"}),o.jsxs("div",{className:"relative",children:[o.jsx(Wr,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),o.jsx("input",{type:u?"text":"password",name:"confirmPassword",value:n.confirmPassword,onChange:j,className:`w-full pl-10 pr-12 py-3 border rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all ${n.confirmPassword&&n.password!==n.confirmPassword?"border-red-300 bg-red-50":"border-gray-200"}`,placeholder:"Confirm your password",required:!t}),o.jsx("button",{type:"button",onClick:()=>h(!u),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:u?o.jsx(zs,{className:"h-5 w-5"}):o.jsx(us,{className:"h-5 w-5"})})]}),n.confirmPassword&&n.password!==n.confirmPassword&&o.jsx("p",{className:"text-red-600 text-sm mt-1",children:"Passwords do not match"})]}),o.jsx("button",{type:"submit",disabled:a||!t&&n.password!==n.confirmPassword||m&&!f.isValid,className:"w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white py-3 rounded-xl font-medium hover:from-blue-700 hover:to-purple-700 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:a?"Please wait...":t?"Sign In":"Create Account"})]}),o.jsx("div",{className:"mt-4",children:o.jsxs("button",{onClick:k,className:"w-full flex items-center justify-center border border-gray-300 text-gray-700 bg-white py-2 rounded-xl font-medium hover:bg-gray-50 transition-all",disabled:a,children:[o.jsx(V0,{className:"h-5 w-5 mr-2"})," Continue with Google"]})}),o.jsx("div",{className:"mt-6 text-center",children:o.jsx("button",{onClick:()=>s(!t),className:"text-blue-600 hover:text-blue-700 font-medium",children:t?"Don't have an account? Sign up":"Already have an account? Sign in"})})]}),o.jsx("div",{className:"text-center mt-8 text-sm text-gray-500",children:o.jsx("p",{children:"Secure knowledge management platform"})}),!t&&o.jsxs("div",{className:"mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[o.jsx("h4",{className:"text-sm font-semibold text-blue-900 mb-2",children:"📧 Email Verification Required"}),o.jsx("p",{className:"text-sm text-blue-800",children:"After creating your account, you'll receive a verification email. You can verify your email from any device - the verification will work across all your devices automatically."})]})]})})]})},Mb=r=>{const[e,t]=b.useState(!1),[s,n]=b.useState(null),[i,a]=b.useState(!0);return b.useEffect(()=>{let l;const c=Mo(ke,async d=>{if(d){if(await d.reload(),(!r||d.email===r)&&d.emailVerified){t(!0),n(d),a(!1);return}n(d)}else n(null);a(!1)});return l=setInterval(async()=>{ke.currentUser&&(await ke.currentUser.reload(),(!r||ke.currentUser.email===r)&&ke.currentUser.emailVerified&&!e&&(t(!0),n(ke.currentUser)))},3e3),()=>{c(),l&&clearInterval(l)}},[r,e]),{isVerified:e,user:s,loading:i}},Db=()=>{const r=Tt(),e=zn(),[t,s]=b.useState(!1),[n,i]=b.useState(""),[a,l]=b.useState(""),[c,d]=b.useState(null),[u,h]=b.useState(""),{isVerified:f,user:p}=Mb(n);b.useEffect(()=>{const y=e.state;y!=null&&y.email?(i(y.email),l(y.displayName||"")):r("/auth")},[e.state,r]);const m=async()=>{if(!c){r("/auth");return}s(!0),h("");try{const x=`${window.location.origin}/#/verify-email`;await Zu(c,{url:x,handleCodeInApp:!1}),h("✅ Verification email sent! Please check your inbox.")}catch(y){y.code==="auth/too-many-requests"?h("⚠️ Too many requests. Please wait a few minutes before requesting another verification email."):y.code==="auth/user-not-found"?h("❌ User not found. Please sign up again."):h("❌ Failed to send verification email. Please try again later.")}finally{s(!1)}},g=async()=>{try{await Co(ke),r("/")}catch{}};return b.useEffect(()=>{const y=Mo(ke,async x=>{if(d(x),x)try{await x.reload()}catch{}else d(null)});return()=>{y()}},[]),b.useEffect(()=>{f&&p&&r("/auth",{replace:!0,state:{message:"Email verified successfully! Please log in to continue."}})},[f,p,r]),o.jsx("div",{className:"min-h-screen flex items-center justify-center px-4",style:{backgroundColor:"#EFEDFA"},children:o.jsxs("div",{className:"max-w-md w-full",children:[o.jsxs("div",{className:"text-center mb-8",children:[o.jsx("div",{className:"bg-blue-100 p-4 rounded-full w-20 h-20 mx-auto mb-6 flex items-center justify-center",children:o.jsx(Wt,{className:"h-10 w-10 text-blue-600"})}),o.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent mb-2",children:"Verify Your Email"}),o.jsx("p",{className:"text-gray-600",children:"We've sent a verification link to your email address."})]}),o.jsxs("div",{className:"bg-white/80 backdrop-blur-md rounded-2xl shadow-xl border border-gray-100 p-8",children:[o.jsxs("div",{className:"text-center mb-6",children:[o.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6",children:o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx(St,{className:"h-5 w-5 text-yellow-600"}),o.jsx("p",{className:"text-yellow-800 text-sm",children:"Please verify your email address to continue using InfoNest."})]})}),o.jsx("p",{className:"text-gray-700 mb-2",children:"We sent a verification email to:"}),o.jsx("p",{className:"font-semibold text-gray-900 mb-6",children:n}),o.jsx("p",{className:"text-sm text-gray-600 mb-6",children:"Click the verification link in your email to activate your account."}),o.jsx("p",{className:"text-sm text-gray-600 mb-6",children:"Don't see the email? Check your spam folder or request a new one."})]}),o.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6",children:[o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx("div",{className:"animate-pulse h-3 w-3 bg-blue-500 rounded-full"}),o.jsx("p",{className:"text-blue-800 text-sm font-medium",children:"Waiting for email verification... This will happen automatically when you click the link from any device."})]}),o.jsx("p",{className:"text-blue-700 text-xs mt-2",children:"💡 You can verify your email from any device - mobile, tablet, or computer. Once verified, this page will automatically update."})]}),o.jsxs("div",{className:"space-y-4",children:[o.jsx("button",{onClick:m,disabled:t||!c,className:"w-full flex items-center justify-center space-x-2 bg-gray-100 hover:bg-gray-200 text-gray-700 py-3 rounded-xl font-medium transition-all disabled:opacity-50",children:t?o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"animate-spin h-4 w-4 border-2 border-gray-600 border-t-transparent rounded-full"}),o.jsx("span",{children:"Sending..."})]}):o.jsxs(o.Fragment,{children:[o.jsx(Wt,{className:"h-4 w-4"}),o.jsx("span",{children:"Resend Verification Email"})]})}),u&&o.jsx("div",{className:`rounded-lg p-3 ${u.includes("✅")?"bg-green-50 border border-green-200":u.includes("⚠️")?"bg-yellow-50 border border-yellow-200":"bg-red-50 border border-red-200"}`,children:o.jsx("p",{className:`text-sm ${u.includes("✅")?"text-green-800":u.includes("⚠️")?"text-yellow-800":"text-red-800"}`,children:u})}),!c&&o.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3",children:o.jsx("p",{className:"text-yellow-800 text-sm",children:"⚠️ You've been signed out. Please sign in again to resend the verification email."})}),o.jsx("div",{className:"border-t border-gray-200 pt-4",children:o.jsxs("button",{onClick:g,className:"w-full flex items-center justify-center space-x-2 text-gray-600 hover:text-red-600 py-2 rounded-lg transition-colors",children:[o.jsx(Ul,{className:"h-4 w-4"}),o.jsx("span",{children:"Sign Out"})]})})]})]}),o.jsx("div",{className:"text-center mt-8 text-sm text-gray-500",children:o.jsx("p",{children:"Having trouble? You can verify your email from any device. Contact support if you need help."})})]})})},Tb=()=>{const[r]=Qu(),e=Tt(),[t,s]=b.useState("loading"),[n,i]=b.useState(""),[a,l]=b.useState(!1),[c,d]=b.useState(""),u=async()=>{l(!0),i("Please sign up again to receive a new verification email."),setTimeout(()=>{e("/auth",{replace:!0})},2e3),l(!1)};return b.useEffect(()=>{(async()=>{const f=r.get("mode"),p=r.get("oobCode");if(f!=="verifyEmail"||!p){s("error"),i("Invalid verification link. Please check your email for the correct link.");return}try{s("loading"),i("Verifying your email address...");const g=(await dg(ke,p)).data.email;d(g||""),await ug(ke,p),await new Promise(y=>setTimeout(y,1e3)),ke.currentUser&&ke.currentUser.email===g&&(await ke.currentUser.reload(),ke.currentUser.emailVerified||await ke.currentUser.reload()),s("success"),i("🎉 Email verified successfully! Your account is now active and you can sign in with your verified email."),setTimeout(()=>{e("/auth",{replace:!0,state:{message:"✅ Email verified successfully! Login to access the platform.",verifiedEmail:g,showLogin:!0}})},4e3)}catch(m){s("error"),m.code==="auth/invalid-action-code"?i("This verification link has expired or has already been used. Please sign up again to receive a new verification email."):m.code==="auth/expired-action-code"?i("This verification link has expired. Please sign up again to receive a new verification email."):m.code==="auth/user-disabled"?i("This account has been disabled. Please contact support."):m.code==="auth/user-not-found"?i("No account found for this verification link. Please sign up again."):i(`Email verification failed: ${m.message}. Please try signing up again.`)}})()},[r,e]),o.jsx("div",{className:"min-h-screen flex items-center justify-center px-4",style:{backgroundColor:"#EFEDFA"},children:o.jsxs("div",{className:"max-w-md w-full",children:[o.jsxs("div",{className:"bg-white/80 backdrop-blur-md rounded-2xl shadow-xl border border-gray-100 p-8 text-center",children:[t==="loading"&&o.jsxs(o.Fragment,{children:[o.jsx(Ve,{className:"h-16 w-16 text-blue-600 animate-spin mx-auto mb-6"}),o.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Verifying Email"}),o.jsx("p",{className:"text-gray-600",children:n})]}),t==="success"&&o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"bg-green-100 p-4 rounded-full w-20 h-20 mx-auto mb-6 flex items-center justify-center",children:o.jsx(sr,{className:"h-10 w-10 text-green-600"})}),o.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Email Verified!"}),o.jsx("p",{className:"text-gray-600 mb-4",children:n}),c&&o.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4",children:o.jsxs("p",{className:"text-blue-800 text-sm font-medium",children:["✅ Verified Email: ",c]})}),o.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 mb-6",children:o.jsx("p",{className:"text-green-800 text-sm",children:"🎉 Email verification complete! You can now login to access the platform."})}),o.jsxs("button",{onClick:()=>e("/auth",{replace:!0,state:{message:"✅ Email verified successfully! Please log in to continue.",verifiedEmail:c,showLogin:!0}}),className:"inline-flex items-center space-x-2 bg-gradient-to-r from-blue-600 to-purple-600 text-white px-6 py-3 rounded-xl font-medium hover:from-blue-700 hover:to-purple-700 transition-all",children:[o.jsx(Fl,{className:"h-4 w-4"}),o.jsx("span",{children:"Go to Login"})]})]}),t==="error"&&o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"bg-red-100 p-4 rounded-full w-20 h-20 mx-auto mb-6 flex items-center justify-center",children:o.jsx(xi,{className:"h-10 w-10 text-red-600"})}),o.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Verification Failed"}),o.jsx("p",{className:"text-gray-600 mb-6",children:n}),o.jsxs("div",{className:"space-y-3",children:[o.jsx("button",{onClick:u,disabled:a,className:"w-full bg-gradient-to-r from-green-600 to-blue-600 text-white px-6 py-3 rounded-xl font-medium hover:from-green-700 hover:to-blue-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2",children:a?o.jsxs(o.Fragment,{children:[o.jsx(Q0,{className:"h-4 w-4 animate-spin"}),o.jsx("span",{children:"Sending..."})]}):o.jsxs(o.Fragment,{children:[o.jsx(Wt,{className:"h-4 w-4"}),o.jsx("span",{children:"Get New Verification Email"})]})}),o.jsx("button",{onClick:()=>e("/auth",{replace:!0}),className:"w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white px-6 py-3 rounded-xl font-medium hover:from-blue-700 hover:to-purple-700 transition-all",children:"Sign Up Again"}),o.jsx("button",{onClick:()=>e("/",{replace:!0}),className:"w-full bg-gray-100 text-gray-700 px-6 py-3 rounded-xl font-medium hover:bg-gray-200 transition-colors",children:"Go to Homepage"})]})]})]}),o.jsx("div",{className:"text-center mt-8 text-sm text-gray-500",children:o.jsx("p",{children:"Having trouble? Contact support for assistance."})})]})})},od=async(r,e)=>{try{const t=`${r}_${e.id}`;console.log("💾 Saving article");const s=he(X,"savedArticles",t),n={id:t,userId:r,articleId:e.id,articleTitle:e.title,articleExcerpt:e.excerpt||"",articleAuthor:e.authorName||"Unknown",articleAuthorId:e.authorId||"",articleCategories:e.categories||[],articleTags:e.tags||[],articleCoverImage:e.coverImage||void 0,articleUpdatedAt:Le.fromDate(e.updatedAt),articlePublishedAt:e.publishedAt?Le.fromDate(e.publishedAt):null,savedAt:Le.now()};await bs(s,n)}catch(t){throw console.error("Error saving article:",t),new Error("Failed to save article")}},lf=async(r,e)=>{try{const t=he(X,"savedArticles",`${r}_${e}`);await Rt(t)}catch(t){throw console.error("Error removing saved article:",t),new Error("Failed to remove saved article")}},Ob=async(r,e)=>{try{const t=he(X,"savedArticles",`${r}_${e}`);return(await It(t)).exists()}catch(t){return console.error("Error checking if article is saved:",t),!1}},Rb=(r,e)=>{const t=xe(pe(X,"savedArticles"),Oe("userId","==",r));return Ee(t,s=>{const n=s.docs.map(i=>{var l,c;const a=i.data();return{...a,savedAt:a.savedAt.toDate(),articleUpdatedAt:((l=a.articleUpdatedAt)==null?void 0:l.toDate())||a.savedAt.toDate(),articlePublishedAt:(c=a.articlePublishedAt)==null?void 0:c.toDate()}});n.sort((i,a)=>a.savedAt.getTime()-i.savedAt.getTime()),e(n)},s=>{console.error("Error in saved articles subscription:",s),e([])})},cf=({article:r,articleId:e,articleTitle:t,articleAuthor:s,className:n="",showLabel:i=!1,size:a="md"})=>{const{userProfile:l,isAuthenticated:c}=ve(),[d,u]=b.useState(!1),[h,f]=b.useState(!1),[p,m]=b.useState(!0),g=(r==null?void 0:r.id)||e;b.useEffect(()=>{(async()=>{if(!(l!=null&&l.uid)||!c||!g){m(!1);return}try{const k=await Ob(l.uid,g);u(k)}catch(k){console.error("Error checking saved status:",k)}finally{m(!1)}})()},[l==null?void 0:l.uid,g,c]);const y=async()=>{if(!(l!=null&&l.uid)||!c||!g){K.error("Please login to save articles");return}f(!0);try{if(d)await lf(l.uid,g),u(!1),K.success("Article removed from saved articles");else{if(r)await od(l.uid,r);else{const C=await _o(g);if(C)await od(l.uid,C);else throw new Error("Article not found")}u(!0),K.success("Article saved successfully!")}}catch(C){console.error("Error toggling save status:",C),K.error(d?"Failed to remove article":"Failed to save article")}finally{f(!1)}};if(!c)return null;const x={sm:"h-4 w-4",md:"h-5 w-5",lg:"h-6 w-6"},S={sm:"p-1.5",md:"p-2",lg:"p-3"};return p?o.jsxs("div",{className:`flex items-center space-x-2 ${n}`,children:[o.jsx("div",{className:"h-4 w-4 border-2 border-purple-600 border-t-transparent rounded-full animate-spin"}),i&&o.jsx("span",{className:"text-sm text-gray-600",children:"Checking..."})]}):i?o.jsxs("button",{onClick:y,disabled:h,className:`
        flex items-center space-x-2 px-4 py-2 rounded-lg transition-all duration-200
        ${d?"bg-purple-100 text-purple-700 hover:bg-purple-200 border border-purple-200":"bg-white text-gray-700 hover:bg-purple-50 border border-gray-200 hover:border-purple-200"}
        disabled:opacity-50 disabled:cursor-not-allowed
        ${n}
      `,title:d?"Remove from saved articles":"Save article for later",children:[h?o.jsx("div",{className:"h-4 w-4 border-2 border-current border-t-transparent rounded-full animate-spin"}):d?o.jsx(Kc,{className:"h-4 w-4"}):o.jsx(br,{className:"h-4 w-4"}),o.jsx("span",{className:"text-sm font-medium",children:h?d?"Removing...":"Saving...":d?"Saved":"Save Article"})]}):o.jsx("button",{onClick:y,disabled:h||!l,className:`${S[a]} ${d?"text-purple-600 hover:text-purple-700 hover:bg-purple-50":"text-gray-600 hover:text-purple-600 hover:bg-purple-50"} rounded-lg transition-colors flex items-center space-x-1 disabled:opacity-50 disabled:cursor-not-allowed ${n}`,title:d?"Remove from saved":"Save article",children:h?o.jsx("div",{className:`${x[a]} border-2 border-current border-t-transparent rounded-full animate-spin`}):d?o.jsx(Kc,{className:`${x[a]} fill-current transition-all`}):o.jsx(br,{className:`${x[a]} transition-all`})})},Ib=({articleId:r,articleStatus:e,articleAuthorId:t,initialLikes:s=0,initialLikedBy:n=[],size:i="md",showLabel:a=!0,className:l=""})=>{const{userProfile:c}=ve(),[d,u]=b.useState(!1),[h,f]=b.useState(s),[p,m]=b.useState(!1),[g,y]=b.useState(n);b.useEffect(()=>{f(s),y(n),c!=null&&c.uid?u(n.includes(c.uid)):u(!1)},[s,n,c==null?void 0:c.uid]),b.useEffect(()=>{if(!r)return;if(!(c?e==="published"||c.uid===t||c.role==="admin":!1)){f(s),y(n),c!=null&&c.uid&&u(n.includes(c.uid));return}const O=he(X,"articles",r),N=Ee(O,w=>{if(w.exists()){const v=w.data(),M=v.likes||0,E=v.likedBy||[];f(M),y(E),c!=null&&c.uid?u(E.includes(c.uid)):u(!1)}},w=>{w.code!=="permission-denied"&&console.error("Error listening to article updates:",w)});return()=>N()},[r,c==null?void 0:c.uid,c==null?void 0:c.role,e,t,s,n]);const x=async j=>{if(j.preventDefault(),j.stopPropagation(),!c){K.error("Please log in to like articles");return}if(!p){m(!0);try{const O=he(X,"articles",r),N=c.uid;d?await qe(O,{likes:rs(-1),likedBy:g.filter(w=>w!==N)}):await qe(O,{likes:rs(1),likedBy:[...g,N]})}catch(O){console.error("Error toggling like:",O),K.error("Failed to update like. Please try again.")}finally{m(!1)}}},S={sm:"h-3 w-3",md:"h-4 w-4",lg:"h-5 w-5"},C={sm:"p-1.5",md:"p-2",lg:"p-2.5"},k={sm:"text-xs",md:"text-sm",lg:"text-base"};return o.jsxs("button",{onClick:x,disabled:p,className:`${C[i]} ${d?"text-red-600 hover:text-red-700 hover:bg-red-50":"text-gray-600 hover:text-red-600 hover:bg-red-50"} rounded-lg transition-colors flex items-center space-x-1 disabled:opacity-50 disabled:cursor-not-allowed ${l}`,title:d?"Unlike article":"Like article",children:[p?o.jsx("div",{className:`${S[i]} border-2 border-current border-t-transparent rounded-full animate-spin`}):o.jsx(vh,{className:`${S[i]} ${d?"fill-current":""}`}),a&&o.jsx("span",{className:k[i],children:h})]})},Ns=({article:r,showStatus:e=!1,showActions:t=!0,showEditButton:s=!1,showManagementMenu:n=!1,variant:i="default",className:a=""})=>{const{userProfile:l,canEditArticle:c,canDeleteArticle:d}=ve(),[u,h]=b.useState(!1),[f,p]=b.useState(r),[m,g]=b.useState(null),[y,x]=b.useState(!1),[S,C]=b.useState(!1),[k,j]=b.useState(!1),[O,N]=b.useState(!1);b.useEffect(()=>{const H=he(X,"articles",r.id),R=Ee(H,A=>{var F,U,P;if(A.exists()){const _=A.data(),Y={..._,id:A.id,createdAt:(F=_.createdAt)==null?void 0:F.toDate(),updatedAt:(U=_.updatedAt)==null?void 0:U.toDate(),publishedAt:(P=_.publishedAt)==null?void 0:P.toDate()};p(Y)}},A=>{A.code!=="permission-denied"&&console.error("Error in article card subscription:",A)});return()=>R()},[r.id]),b.useEffect(()=>{const H=R=>{if(k){const A=R.target,F=document.querySelector(`[data-dropdown-id="${f.id}"]`),U=document.querySelector(`[data-dropdown-button="${f.id}"]`);F&&!F.contains(A)&&U&&!U.contains(A)&&j(!1)}};return document.addEventListener("mousedown",H),()=>{document.removeEventListener("mousedown",H)}},[k,f.id]),b.useEffect(()=>{if(!r.authorId)return;const H=he(X,"users",r.authorId),R=Ee(H,A=>{var F,U;if(A.exists()){const P=A.data(),_={uid:r.authorId,email:P.email||"",displayName:P.displayName||"",role:P.role||"user",emailVerified:P.emailVerified||!1,profilePicture:P.profilePicture||"",createdAt:(F=P.createdAt)==null?void 0:F.toDate(),updatedAt:(U=P.updatedAt)==null?void 0:U.toDate(),requestedWriterAccess:P.requestedWriterAccess||!1};g(_),P.profilePicture&&h(!1)}else g(null)},A=>{A.code!=="permission-denied"&&console.error("Error in author profile subscription:",A)});return()=>R()},[r.authorId]);const w=H=>{switch(H){case"published":return"bg-green-100 text-green-700";case"draft":return"bg-yellow-100 text-yellow-700";case"unpublished":return"bg-gray-100 text-gray-700";default:return"bg-gray-100 text-gray-700"}},v=()=>l?c(f.authorId,f.status):!1,M=()=>l?d(f.authorId,m==null?void 0:m.role):!1,E=async()=>{if(!(!l||!M())){C(!0);try{await Ph(f.id,l.role,l.uid,f.authorId,m==null?void 0:m.role,"Article removed by administrator");const R=l.uid===f.authorId?"Article deleted successfully":"Article unpublished successfully";Ne.success(R),x(!1),window.location.reload()}catch(H){console.error("Error deleting article:",H),Ne.error("Failed to delete article")}finally{C(!1)}}},L=async H=>{if(!(l!=null&&l.uid)){Ne.error("You must be logged in to update articles");return}N(!0);try{const R={status:H};if(H==="published"){const U=new Date;R.publishedAt=U,R.updatedAt=U}await $o(f.id,R);const A=new Date;p(U=>({...U,status:H,publishedAt:H==="published"?A:U.publishedAt,updatedAt:A}));const F=H==="published"?"published":"unpublished";Ne.success(`Article ${F} successfully`)}catch(R){console.error("Error updating article status:",R),Ne.error(`Error updating article status: ${R instanceof Error?R.message:"Unknown error"}`)}finally{N(!1),j(!1)}},I=()=>{switch(i){case"compact":return"p-4";case"featured":return"p-8";default:return"p-6"}},W=()=>{switch(i){case"compact":return"aspect-video h-32";case"featured":return"aspect-video h-48";default:return"aspect-video h-40"}};return o.jsxs("div",{className:`bg-white/80 backdrop-blur-sm rounded-xl border border-gray-200 hover:border-transparent transition-all duration-300 hover:shadow-lg group flex flex-col h-full relative overflow-hidden ${I()} ${a}`,style:{background:"white"},onMouseEnter:H=>{H.currentTarget.style.background="linear-gradient(white, white) padding-box, linear-gradient(to right, #1D4ED8, #7C3AED, #EC4899) border-box",H.currentTarget.style.border="2px solid transparent"},onMouseLeave:H=>{H.currentTarget.style.background="white",H.currentTarget.style.border="1px solid #e5e7eb"},children:[o.jsxs(le,{to:`/article/${f.id}`,className:"flex-1 flex flex-col",children:[f.coverImage&&o.jsx("div",{className:`bg-gray-100 rounded-lg mb-4 overflow-hidden ${W()} flex-shrink-0`,children:o.jsx("img",{src:f.coverImage,alt:f.title,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-300",onError:H=>{const R=H.target;R.style.display="none"}})}),o.jsxs("div",{className:"flex items-start justify-between mb-3 min-h-[3rem]",children:[o.jsx("h3",{className:`font-semibold bg-gradient-to-r from-[#1D4ED8] via-[#7C3AED] to-[#EC4899] bg-clip-text text-transparent transition-colors line-clamp-2 ${i==="featured"?"text-2xl":i==="compact"?"text-lg":"text-xl"}`,children:f.title}),e&&o.jsx("span",{className:`ml-2 px-2 py-1 text-xs rounded-full font-medium flex-shrink-0 ${w(f.status)}`,children:f.status})]}),o.jsx("div",{className:"flex items-center space-x-3 mb-3 min-h-[2.5rem]",children:o.jsxs(le,{to:`/author/${f.authorId}`,className:"flex items-center space-x-2 hover:bg-gray-50 rounded-lg p-1 -m-1 transition-colors group",onClick:H=>H.stopPropagation(),children:[o.jsx("div",{className:"w-8 h-8 rounded-full overflow-hidden bg-gray-200 flex-shrink-0 relative group-hover:ring-2 group-hover:ring-blue-200 transition-all",children:!u&&(m!=null&&m.profilePicture)?o.jsx("img",{src:m.profilePicture,alt:`${(m==null?void 0:m.displayName)||f.authorName}'s profile`,className:"w-full h-full object-cover",onError:()=>h(!0)}):o.jsx("div",{className:"w-full h-full bg-gradient-to-br from-blue-100 to-blue-200 flex items-center justify-center group-hover:from-blue-200 group-hover:to-blue-300 transition-all",children:o.jsx("span",{className:"text-blue-700 text-xs font-semibold",children:((m==null?void 0:m.displayName)||f.authorName).charAt(0).toUpperCase()})})}),o.jsxs("div",{className:"flex flex-col",children:[o.jsx("span",{className:"text-sm font-medium text-gray-700 group-hover:text-blue-600 transition-colors",children:(m==null?void 0:m.displayName)||f.authorName}),(m==null?void 0:m.role)&&o.jsx("span",{className:"text-xs text-gray-500 capitalize",children:m.role==="infowriter"||m.role==="admin"?"InfoWriter":m.role})]})]})}),o.jsx("p",{className:`text-gray-600 mb-4 flex-grow text-sm ${f.coverImage?"line-clamp-3":"line-clamp-6"}`,style:{minHeight:f.coverImage?"3.75rem":"7.5rem"},children:f.excerpt||"No excerpt available"}),o.jsxs("div",{className:"flex items-center text-xs text-gray-500 mb-3",children:[o.jsx(jt,{className:"h-3 w-3 mr-1"}),o.jsxs("span",{children:["Updated: ",Ii(f.updatedAt,"dd/MM/yyyy")]})]}),o.jsx("div",{className:"mb-3 min-h-[1.5rem] flex items-center",children:f.categories.length>0&&o.jsxs(o.Fragment,{children:[o.jsx(Ci,{className:"h-3 w-3 text-gray-400 mr-1"}),o.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-700 text-xs rounded-full",children:f.categories[0]})]})}),o.jsx("div",{className:"mb-4 min-h-[2rem] flex items-start",children:f.tags.length>0&&o.jsxs("div",{className:"flex flex-wrap gap-1",children:[f.tags.slice(0,3).map(H=>o.jsxs("span",{className:"px-2 py-1 bg-gray-100 text-gray-600 text-xs rounded-full flex items-center",children:[o.jsx(hs,{className:"h-2 w-2 mr-1"}),H]},H)),f.tags.length>3&&o.jsxs("span",{className:"text-xs text-gray-500",children:["+",f.tags.length-3," more"]})]})})]}),o.jsxs("div",{className:"flex items-center justify-between mt-auto pt-2",children:[o.jsx("div",{className:"flex items-center space-x-2",children:t&&o.jsxs(ze.Fragment,{children:[o.jsx(cf,{articleId:f.id,articleTitle:f.title,articleAuthor:f.authorName,size:"sm"},`save-${f.id}`),o.jsx(Ib,{articleId:f.id,articleStatus:f.status,articleAuthorId:f.authorId,initialLikes:f.likes||0,initialLikedBy:f.likedBy||[],size:"sm",showLabel:!0},`like-${f.id}`)]},"article-actions")}),o.jsxs("div",{className:"flex items-center space-x-2",children:[s&&v()&&o.jsx(le,{to:`/article/edit/${f.id}`,className:"p-2 text-gray-600 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",title:"Edit Article",children:o.jsx(Wl,{className:"h-4 w-4"})}),n&&(M()||l&&(l.role==="admin"||l.role==="infowriter"))&&o.jsx("div",{className:"relative",children:y?o.jsxs("div",{className:"flex items-center space-x-1",children:[o.jsx("button",{onClick:E,disabled:S,className:"p-2 text-red-600 hover:text-red-700 hover:bg-red-50 rounded-lg transition-colors disabled:opacity-50",title:"Confirm Delete",children:S?o.jsx("div",{className:"h-4 w-4 animate-spin border-2 border-red-600 border-t-transparent rounded-full"}):o.jsx(Ai,{className:"h-4 w-4"})}),o.jsx("button",{onClick:()=>x(!1),className:"p-2 text-gray-600 hover:text-gray-700 hover:bg-gray-50 rounded-lg transition-colors",title:"Cancel",children:o.jsx(gt,{className:"h-4 w-4"})})]}):o.jsxs(o.Fragment,{children:[o.jsx("button",{onClick:()=>j(!k),"data-dropdown-button":f.id,className:"p-2 text-gray-600 hover:text-gray-800 hover:bg-gray-50 rounded-lg transition-colors",title:"More Actions",children:o.jsx(jh,{className:"h-4 w-4"})}),k&&o.jsx("div",{"data-dropdown-id":f.id,className:"absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-gray-200 z-10",children:o.jsxs("div",{className:"py-1",children:[f.status==="published"&&l&&(l.role==="admin"||l.uid===f.authorId)&&o.jsxs("button",{onClick:H=>{H.stopPropagation(),L("unpublished")},disabled:O,className:"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-red-50 hover:text-red-700 flex items-center space-x-2 disabled:opacity-50",children:[o.jsx(zs,{className:"h-4 w-4"}),o.jsx("span",{children:"Unpublish"})]}),f.status==="unpublished"&&l&&(l.role==="admin"||l.uid===f.authorId)&&o.jsxs("button",{onClick:H=>{H.stopPropagation(),L("published")},disabled:O,className:"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-green-50 hover:text-green-700 flex items-center space-x-2 disabled:opacity-50",children:[o.jsx(Sn,{className:"h-4 w-4"}),o.jsx("span",{children:"Publish"})]}),M()&&o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"border-t border-gray-100 my-1"}),o.jsxs("button",{onClick:()=>{x(!0),j(!1)},className:"w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-red-50 flex items-center space-x-2",children:[o.jsx(Tr,{className:"h-4 w-4"}),o.jsx("span",{children:"Delete"})]})]})]})})]})})]})]})]})},Pb=()=>{const r=Tt(),{isAuthenticated:e,userProfile:t,loading:s,isInfoWriter:n,isAdmin:i}=ve(),a=()=>(console.log("HomePage getDashboardRoute:",{userProfile:t==null?void 0:t.role,isInfoWriter:n,isAdmin:i,authLoading:s}),(t==null?void 0:t.role)==="infowriter"?(console.log("HomePage: Directing InfoWriter to My Articles"),"/my-articles"):(console.log("HomePage: Directing to Dashboard"),"/dashboard")),[l,c]=b.useState(null),[d,u]=b.useState(!0),[h,f]=b.useState(!1),p=()=>{u(!0);const x=xe(pe(X,"articles"),Oe("status","==","published"));return Ee(x,C=>{try{const k=[];C.forEach(M=>{var I,W,H;const E=M.data(),L={id:M.id,...E,createdAt:((I=E.createdAt)==null?void 0:I.toDate())||new Date,updatedAt:(W=E.updatedAt)==null?void 0:W.toDate(),publishedAt:(H=E.publishedAt)==null?void 0:H.toDate()};k.push(L)});const j=m(k),O=new Map,N=new Set;k.forEach(M=>{M.categories.forEach(E=>{O.set(E,(O.get(E)||0)+1)}),M.tags.forEach(E=>N.add(E))});const w=Array.from(O.entries()).map(([M,E])=>({name:M,count:E})).sort((M,E)=>E.count-M.count).slice(0,8),v=Array.from(N).slice(0,20);c({articles:k,featuredArticles:j,categories:w,tags:v}),u(!1)}catch(k){console.error("Error loading homepage data:",k),u(!1)}})},m=x=>{const S=["Technology","Business","Education","Health","Finance","Marketing","Development","Design","Management","Research"],C=k=>{let j=0;if(k.coverImage&&k.authorId&&(j+=1e4,j+=1e3),k.categories.some(N=>S.some(w=>N.toLowerCase().includes(w.toLowerCase())))){j+=5e3;const N=k.categories.filter(w=>S.some(v=>w.toLowerCase().includes(v.toLowerCase()))).length;j+=N*500}if(k.tags&&k.tags.length>0){j+=1e3,j+=Math.min(k.tags.length*100,500);const N=k.tags.filter(w=>w.length>2&&!w.includes(" "));j+=N.length*50}if(k.title&&k.title.trim().length>10){j+=500;const N=k.title.trim().length;N>=20&&N<=80&&(j+=200),["guide","tutorial","how to","best practices","tips"].some(M=>k.title.toLowerCase().includes(M))&&(j+=150)}if(k.content&&k.content.trim().length>100&&(j+=200,k.content.trim().length>=500&&(j+=100),k.content.trim().length>=1e3&&(j+=100)),k.publishedAt){const N=(Date.now()-k.publishedAt.getTime())/864e5;N<7?j+=300:N<30&&(j+=150)}return k.views&&k.views>0&&(j+=Math.min(k.views*.5,200)),k.likes&&k.likes>0&&(j+=Math.min(k.likes*2,100)),j};return x.map(k=>({article:k,priority:C(k)})).sort((k,j)=>j.priority-k.priority).slice(0,12).map(({article:k})=>k)};b.useEffect(()=>{const x=p();return()=>x()},[]);const g=x=>{e?x&&r(`/article/${x}`):r("/auth?redirect=dashboard")},y=async()=>{try{f(!1),r("/",{replace:!0}),await lh()}catch(x){console.error("Error logging out:",x),r("/",{replace:!0})}};return d||s?o.jsx("div",{className:"min-h-screen flex items-center justify-center",style:{backgroundColor:"#EFEDFA"},children:o.jsxs("div",{className:"text-center",children:[o.jsx(Ve,{className:"h-16 w-16 text-blue-600 animate-spin mx-auto mb-6"}),o.jsx("h2",{className:"text-2xl font-semibold text-gray-900 mb-2",children:"Loading InfoNest"}),o.jsx("p",{className:"text-gray-600",children:"Preparing your knowledge base..."})]})}):l?o.jsxs("div",{className:"min-h-screen",style:{backgroundColor:"#EFEDFA"},children:[o.jsx("header",{className:"backdrop-blur-md border-b border-gray-200/50 sticky top-0 z-50",style:{backgroundColor:"#EFEDFA"},children:o.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:o.jsxs("div",{className:"flex justify-between items-center h-16",children:[o.jsx("div",{className:"flex items-center space-x-3",children:o.jsx(le,{to:"/",className:"cursor-pointer flex items-center space-x-3",children:o.jsxs("div",{children:[o.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-[#1D4ED8] via-[#7C3AED] to-[#EC4899] bg-clip-text text-transparent",children:"InfoNest"}),o.jsx("p",{className:"text-xs text-gray-500 -mt-1",children:"Where Documentation Meets Efficiency"})]})})}),o.jsxs("nav",{className:"hidden md:flex items-center space-x-10 pr-8 ml-auto",children:[o.jsx("button",{type:"button",onClick:()=>{const x=document.getElementById("features");x&&x.scrollIntoView({behavior:"smooth"})},className:"text-gray-600 hover:text-blue-600 transition-colors bg-transparent border-none cursor-pointer",children:"Docs"}),o.jsx("button",{type:"button",onClick:()=>{const x=document.getElementById("about");x&&x.scrollIntoView({behavior:"smooth"})},className:"text-gray-600 hover:text-blue-600 transition-colors bg-transparent border-none cursor-pointer",children:"About"})]}),o.jsx("div",{className:"flex items-center space-x-4",children:e?o.jsxs("div",{className:"relative",children:[o.jsxs("button",{onClick:()=>f(!h),className:"flex items-center space-x-3 p-2 rounded-lg hover:bg-white/20 transition-colors",children:[o.jsxs("div",{className:"text-right",children:[o.jsx("div",{className:"text-sm font-medium text-gray-700",children:(t==null?void 0:t.displayName)||(t==null?void 0:t.email)}),o.jsx("div",{className:"text-xs text-gray-500 capitalize",children:t==null?void 0:t.role})]}),t!=null&&t.profilePicture?o.jsx("img",{src:t.profilePicture,alt:"Profile",className:"w-8 h-8 rounded-full object-cover border-2 border-white shadow-sm"}):o.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-purple-600 p-2 rounded-full",children:o.jsx(_e,{className:"h-4 w-4 text-white"})})]}),h&&o.jsxs("div",{className:"absolute right-0 mt-2 w-56 bg-white rounded-lg shadow-lg border border-gray-200 py-2 z-50",children:[o.jsxs(le,{to:"/profile",onClick:()=>f(!1),className:"flex items-center space-x-3 px-4 py-2 text-gray-700 hover:bg-gray-50 transition-colors",children:[o.jsx(_e,{className:"h-4 w-4"}),o.jsx("span",{children:"Profile"})]}),o.jsxs(le,{to:t?a():"/dashboard",onClick:()=>f(!1),className:"flex items-center space-x-3 px-4 py-2 text-gray-700 hover:bg-gray-50 transition-colors",children:[o.jsx(Sr,{className:"h-4 w-4"}),o.jsx("span",{children:(t==null?void 0:t.role)==="infowriter"?"My Articles":"Dashboard"})]}),o.jsxs(le,{to:"/saved-articles",onClick:()=>f(!1),className:"flex items-center space-x-3 px-4 py-2 text-gray-700 hover:bg-gray-50 transition-colors",children:[o.jsx(br,{className:"h-4 w-4"}),o.jsx("span",{children:"Saved Articles"})]}),o.jsx("div",{className:"border-t border-gray-200 my-2"}),o.jsxs("button",{onClick:y,className:"flex items-center space-x-3 px-4 py-2 text-red-600 hover:bg-red-50 transition-colors w-full text-left",children:[o.jsx(Ul,{className:"h-4 w-4"}),o.jsx("span",{children:"Logout"})]})]})]}):o.jsx(le,{to:"/auth",className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white px-6 py-2 rounded-xl font-medium hover:from-blue-700 hover:to-purple-700 transition-all",children:"Login"})})]})})}),o.jsx("section",{className:"relative py-20 px-4 sm:px-6 lg:px-8 bg-cover bg-center bg-no-repeat",style:{backgroundImage:"linear-gradient(rgba(0,0,0,0.1),rgba(0,0,0,0.1)),url('/InfoNest/image.png')",backgroundSize:"cover",backgroundPosition:"center"},children:o.jsxs("div",{className:"max-w-7xl mx-auto text-center relative z-10",children:[o.jsx("h1",{className:"text-4xl md:text-7xl font-bold text-white mb-6",style:{textShadow:"2px 2px 4px rgba(0,0,0,0.5)"},children:"Welcome to InfoNest"}),o.jsx("p",{className:"text-2xl md:text-3xl text-white mb-4 font-light",style:{textShadow:"1px 1px 2px rgba(0,0,0,0.5)"},children:"Where Documentation Meets Efficiency"}),o.jsx("p",{className:"text-xl text-white max-w-3xl mx-auto mb-12 leading-relaxed",style:{textShadow:"1px 1px 2px rgba(0,0,0,0.5)"},children:"Centralized knowledge hub for your organization's documentation. Discover, search, and access all your important documents in one secure, organized platform."}),o.jsx("div",{className:"mt-8",children:e?o.jsxs(le,{to:t?a():"/dashboard",className:"inline-flex items-center space-x-3 bg-gradient-to-r from-blue-600 to-purple-600 text-white px-8 py-4 rounded-2xl font-semibold text-lg hover:from-blue-700 hover:to-purple-700 transition-all shadow-lg hover:shadow-xl",children:[o.jsx("span",{children:(t==null?void 0:t.role)==="infowriter"?"Go to My Articles":"Go to Dashboard"}),o.jsx(mi,{className:"h-5 w-5"})]}):o.jsxs(le,{to:"/auth",className:"inline-flex items-center space-x-3 bg-gradient-to-r from-blue-600 to-purple-600 text-white px-8 py-4 rounded-2xl font-semibold text-lg hover:from-blue-700 hover:to-purple-700 transition-all shadow-lg hover:shadow-xl",children:[o.jsx("span",{children:"Login or Signup to Access Documents"}),o.jsx(mi,{className:"h-5 w-5"})]})})]})}),o.jsx("div",{className:"max-w-2xl mx-auto mb-8 mt-10 mb-16",children:o.jsx(vs,{variant:"hero",placeholder:"Search articles, guides, documentation...",onResultClick:()=>{}})}),o.jsx("section",{id:"features",className:"py-16 px-4 sm:px-6 lg:px-8 bg-white/50",children:o.jsxs("div",{className:"max-w-7xl mx-auto",children:[o.jsxs("div",{className:"text-center mb-12",children:[o.jsx("h2",{className:"text-3xl font-bold text-gray-900 mb-4",children:"Featured Articles"}),o.jsx("p",{className:"text-gray-600 text-lg max-w-2xl mx-auto",children:"Discover our top-quality articles, prioritized by content quality, categories, and community engagement"})]}),l.featuredArticles.length>0?o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 auto-rows-fr",children:l.featuredArticles.map((x,S)=>o.jsx("div",{className:`
                    ${S%3===0?"md:col-start-1":""}
                    ${S%3===1?"md:col-start-2":""}
                    ${S%3===2?"md:col-start-3":""}
                    cursor-pointer transition-transform hover:scale-105
                  `,onClick:()=>g(x.id),children:o.jsx(Ns,{article:x,variant:"featured",showActions:!0})},x.id))}):o.jsxs("div",{className:"text-center py-12",children:[o.jsx(zt,{className:"h-16 w-16 text-gray-300 mx-auto mb-4"}),o.jsx("p",{className:"text-gray-500",children:"No featured articles available yet."})]}),l.articles.length>l.featuredArticles.length&&o.jsx("div",{className:"text-center mt-12",children:o.jsxs("button",{onClick:()=>{if(e){const x=t?a():"/dashboard";r(x)}else r("/auth?redirect=dashboard")},className:"inline-flex items-center space-x-2 bg-gradient-to-r from-blue-600 to-purple-600 text-white px-8 py-3 rounded-xl font-medium hover:from-blue-700 hover:to-purple-700 transition-all shadow-lg hover:shadow-xl",children:[o.jsx("span",{children:"View All Articles"}),o.jsx(mi,{className:"h-5 w-5"})]})})]})}),o.jsx("section",{className:"py-16 px-4 sm:px-6 lg:px-8",children:o.jsxs("div",{className:"max-w-7xl mx-auto",children:[o.jsxs("div",{className:"text-center mb-16",children:[o.jsx("h2",{className:"text-3xl font-bold text-gray-900 mb-4",children:"Why Choose InfoNest?"}),o.jsx("p",{className:"text-gray-600 text-lg max-w-2xl mx-auto",children:"Powerful features designed to streamline your documentation workflow and enhance team collaboration"})]}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8",children:[o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"bg-gradient-to-r from-blue-100 to-blue-200 p-4 rounded-2xl w-16 h-16 mx-auto mb-6 flex items-center justify-center",children:o.jsx(Di,{className:"h-8 w-8 text-blue-600"})}),o.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Powerful Search"}),o.jsx("p",{className:"text-gray-600",children:"Find any document instantly with our advanced full-text search across titles, content, and metadata."})]}),o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"bg-gradient-to-r from-purple-100 to-purple-200 p-4 rounded-2xl w-16 h-16 mx-auto mb-6 flex items-center justify-center",children:o.jsx(Sr,{className:"h-8 w-8 text-purple-600"})}),o.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Role-Based Access"}),o.jsx("p",{className:"text-gray-600",children:"Secure permissions system with User, InfoWriter, and Admin roles to control access and editing rights."})]}),o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"bg-gradient-to-r from-green-100 to-green-200 p-4 rounded-2xl w-16 h-16 mx-auto mb-6 flex items-center justify-center",children:o.jsx(Vl,{className:"h-8 w-8 text-green-600"})}),o.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Real-time Updates"}),o.jsx("p",{className:"text-gray-600",children:"Stay current with live updates, version tracking, and instant notifications when content changes."})]})]})]})}),o.jsx("section",{id:"about",className:"py-16 px-4 sm:px-6 lg:px-8",children:o.jsxs("div",{className:"max-w-4xl mx-auto text-center",children:[o.jsx("h2",{className:"text-3xl font-bold text-gray-900 mb-6",children:"About InfoNest"}),o.jsx("p",{className:"text-lg text-gray-600 leading-relaxed mb-8",children:"InfoNest is a comprehensive documentation platform designed to centralize your organization's knowledge base. From SOPs and guides to FAQs and technical documentation, InfoNest provides a secure, searchable, and organized environment for all your important information."}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8 text-center",children:[o.jsxs("div",{children:[o.jsxs("div",{className:"text-3xl font-bold text-blue-600 mb-2",children:[l.articles.length,"+"]}),o.jsx("div",{className:"text-gray-600",children:"Documents Available"})]}),o.jsxs("div",{children:[o.jsxs("div",{className:"text-3xl font-bold text-purple-600 mb-2",children:[l.categories.length,"+"]}),o.jsx("div",{className:"text-gray-600",children:"Categories"})]}),o.jsxs("div",{children:[o.jsx("div",{className:"text-3xl font-bold text-green-600 mb-2",children:"24/7"}),o.jsx("div",{className:"text-gray-600",children:"Access Available"})]})]})]})}),o.jsx("footer",{className:"bg-gray-900 text-white py-12 px-4 sm:px-6 lg:px-8",children:o.jsxs("div",{className:"max-w-7xl mx-auto",children:[o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-8",children:[o.jsxs("div",{className:"col-span-1 md:col-span-2",children:[o.jsx("div",{className:"flex items-center space-x-3 mb-4",children:o.jsxs("div",{children:[o.jsx("h3",{className:"text-xl font-bold",children:"InfoNest"}),o.jsx("p",{className:"text-gray-400 text-sm",children:"Where Documentation Meets Efficiency"})]})}),o.jsx("p",{className:"text-gray-400 max-w-md",children:"Streamline your organization's knowledge management with our secure, searchable documentation platform."})]}),o.jsxs("div",{children:[o.jsx("h4",{className:"font-semibold mb-4",children:"Quick Links"}),o.jsxs("ul",{className:"space-y-2 text-gray-400",children:[o.jsx("li",{children:o.jsx("button",{type:"button",onClick:()=>{const x=document.getElementById("features");x&&x.scrollIntoView({behavior:"smooth"})},className:"hover:text-white transition-colors bg-transparent border-none cursor-pointer",children:"Docs"})}),o.jsx("li",{children:o.jsx("button",{type:"button",onClick:()=>{const x=document.getElementById("about");x&&x.scrollIntoView({behavior:"smooth"})},className:"hover:text-white transition-colors bg-transparent border-none cursor-pointer",children:"About"})}),o.jsx("li",{children:o.jsx(le,{to:"/auth",className:"hover:text-white transition-colors",children:"Login"})})]})]}),o.jsxs("div",{children:[o.jsx("h4",{className:"font-semibold mb-4",children:"Legal"}),o.jsxs("ul",{className:"space-y-2 text-gray-400",children:[o.jsx("li",{children:o.jsx("a",{href:"#",className:"hover:text-white transition-colors",children:"Privacy Policy"})}),o.jsx("li",{children:o.jsx("a",{href:"#",className:"hover:text-white transition-colors",children:"Terms of Service"})}),o.jsx("li",{children:o.jsx("a",{href:"#",className:"hover:text-white transition-colors",children:"Contact"})})]})]})]}),o.jsx("div",{className:"border-t border-gray-800 mt-8 pt-8 text-center text-gray-400",children:o.jsx("p",{children:"© 2025 InfoNest. All rights reserved."})})]})})]}):o.jsx("div",{className:"min-h-screen flex items-center justify-center",style:{backgroundColor:"#EFEDFA"},children:o.jsxs("div",{className:"text-center",children:[o.jsx(Ve,{className:"h-12 w-12 text-blue-600 animate-spin mx-auto mb-4"}),o.jsx("p",{className:"text-gray-600",children:"Loading content..."})]})})},Lb=()=>{const{userProfile:r}=ve(),[e,t]=b.useState(),[s,n]=b.useState(!0),[i,a]=b.useState([]),[l,c]=b.useState(!1),[d,u]=b.useState("");return b.useEffect(()=>{if(!r)return;const h=xe(pe(X,"articles"),Oe("status","==","published")),f=Ee(h,p=>{const m=[],g=new Set,y=new Map;p.forEach(k=>{var N,w,v,M,E;const j=k.data(),O={id:k.id,...j,createdAt:((N=j.createdAt)==null?void 0:N.toDate())||new Date,updatedAt:(w=j.updatedAt)==null?void 0:w.toDate(),publishedAt:(v=j.publishedAt)==null?void 0:v.toDate()};m.push(O),(M=O.categories)==null||M.forEach(L=>g.add(L)),(E=O.tags)==null||E.forEach(L=>{y.set(L,(y.get(L)||0)+1)})}),m.sort((k,j)=>j.createdAt.getTime()-k.createdAt.getTime());const x=Array.from(g).sort(),S=m.slice(0,6),C=Array.from(y.entries()).map(([k,j])=>({tag:k,count:j})).sort((k,j)=>j.count-k.count).slice(0,10);t({publishedArticles:m,availableCategories:x,recentArticles:S,topTags:C}),n(!1)},p=>{if(p.code==="permission-denied"){n(!1);return}console.error("Error in dashboard articles subscription:",p),n(!1)});return()=>f()},[r]),b.useEffect(()=>{if(!e)return;let h=e.publishedArticles;if(d.trim()){const f=d.toLowerCase();h=h.filter(p=>p.title.toLowerCase().includes(f)||p.content.toLowerCase().includes(f)||p.excerpt.toLowerCase().includes(f))}a(h.slice(0,6))},[e,d]),s?o.jsx("div",{className:"flex items-center justify-center min-h-64",children:o.jsx("div",{className:"animate-spin h-8 w-8 border-2 border-blue-500 border-t-transparent rounded-full"})}):e?o.jsxs("div",{className:"space-y-8",children:[o.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl p-6 border border-gray-200",children:o.jsx("div",{className:"space-y-4",children:o.jsx(vs,{variant:"default",placeholder:"Search articles...",onResultClick:()=>{}})})}),o.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl p-6 border border-gray-200",children:o.jsxs("div",{className:"space-y-4",children:[o.jsxs("button",{onClick:()=>c(!l),className:"flex items-center justify-between w-full p-4 bg-gradient-to-r from-blue-50 to-purple-50 rounded-xl hover:from-blue-100 hover:to-purple-100 transition-all duration-200",children:[o.jsxs("div",{className:"flex items-center space-x-3",children:[o.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-blue-700 p-2 rounded-lg",children:o.jsx(_e,{className:"h-5 w-5 text-white"})}),o.jsxs("div",{className:"text-left",children:[o.jsx("h3",{className:"font-medium text-gray-900",children:"Quick Actions"}),o.jsx("p",{className:"text-sm text-gray-600",children:"Access your saved content and features"})]})]}),o.jsx(Ro,{className:`h-5 w-5 text-gray-500 transition-transform duration-200 ${l?"rotate-180":""}`})]}),o.jsx("div",{className:`overflow-hidden transition-all duration-300 ease-in-out ${l?"max-h-96 opacity-100":"max-h-0 opacity-0"}`,children:o.jsx("div",{className:"bg-gray-50 rounded-xl border border-gray-200",children:o.jsxs("div",{className:"p-3 space-y-2",children:[o.jsxs(le,{to:"/saved-articles",className:"flex items-center space-x-3 p-3 hover:bg-white rounded-lg transition-colors duration-150 group",children:[o.jsx("div",{className:"bg-blue-100 p-2 rounded-lg group-hover:bg-blue-200 transition-colors",children:o.jsx(ex,{className:"h-4 w-4 text-blue-600"})}),o.jsxs("div",{children:[o.jsx("span",{className:"font-medium text-gray-900 group-hover:text-blue-700",children:"Saved Articles"}),o.jsx("p",{className:"text-xs text-gray-600",children:"View your bookmarked content"})]})]}),o.jsxs(le,{to:"/writer-request",className:"flex items-center space-x-3 p-3 hover:bg-white rounded-lg transition-colors duration-150 group",children:[o.jsx("div",{className:"bg-purple-100 p-2 rounded-lg group-hover:bg-purple-200 transition-colors",children:o.jsx(zl,{className:"h-4 w-4 text-purple-600"})}),o.jsxs("div",{children:[o.jsx("span",{className:"font-medium text-gray-900 group-hover:text-purple-700",children:"Apply for InfoWriter"}),o.jsx("p",{className:"text-xs text-gray-600",children:"Request content creation access"})]})]})]})})})]})}),o.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl p-6 border border-gray-200",children:i.length===0?o.jsxs("div",{className:"text-center py-12",children:[o.jsx(zt,{className:"h-12 w-12 text-gray-300 mx-auto mb-4"}),o.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No articles yet"}),o.jsx("p",{className:"text-gray-600",children:"Be the first to contribute to the knowledge base!"})]}):o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:i.map(h=>o.jsx(Ns,{article:h,variant:"default",showActions:!0,title:h.title,author:h.author,date:h.date},h.id))})})]}):o.jsxs("div",{className:"text-center py-12",children:[o.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Unable to load dashboard"}),o.jsx("p",{className:"text-gray-600",children:"Please try refreshing the page."})]})},$b=()=>{const{userProfile:r}=ve(),[e,t]=b.useState(null),[s,n]=b.useState(!0),[i,a]=b.useState(!1),[l,c]=b.useState("");return b.useEffect(()=>{const d=u=>{console.log("AdminDashboard: Writer request processed",u.detail)};return window.addEventListener("writerRequestProcessed",d),()=>{window.removeEventListener("writerRequestProcessed",d)}},[]),b.useEffect(()=>{if(!r)return;const d=xe(pe(X,"articles"),Oe("status","==","published")),u=Ee(d,h=>{const f=[],p=new Set,m=new Map;h.forEach(C=>{var O,N,w;const k=C.data(),j={id:C.id,...k,createdAt:((O=k.createdAt)==null?void 0:O.toDate())||new Date,updatedAt:(N=k.updatedAt)==null?void 0:N.toDate(),publishedAt:(w=k.publishedAt)==null?void 0:w.toDate()};f.push(j),k.category&&p.add(k.category),k.tags&&k.tags.forEach(v=>{m.set(v,(m.get(v)||0)+1)})}),f.sort((C,k)=>k.createdAt.getTime()-C.createdAt.getTime());const g=f.slice(0,6),y=Array.from(m.entries()).map(([C,k])=>({tag:C,count:k})).sort((C,k)=>k.count-C.count).slice(0,10),x=xe(pe(X,"users")),S=Ee(x,C=>{let k=0,j=0,O=0,N=0;C.forEach(M=>{k++;const E=M.data();E.requestedWriterAccess&&E.role==="user"&&j++,E.role==="infowriter"&&O++,E.previousRoles&&E.previousRoles.includes(E.uid||M.id)&&E.role!=="infowriter"&&E.privilegesRemovedAt&&N++});const w=xe(pe(X,"writerRequests"),Oe("status","==","pending")),v=Ee(w,M=>{const E=M.size,L=j+E;t({publishedArticles:f,totalUsers:k,pendingWriterRequests:L,activeWriters:O,removedWriters:N,totalArticles:f.length,recentArticles:g,availableCategories:Array.from(p),topTags:y,systemStats:{totalArticles:f.length,totalCategories:p.size,totalTags:m.size}}),n(!1)});return()=>v()});return()=>S()});return()=>u()},[r]),s?o.jsx("div",{className:"flex items-center justify-center min-h-64",children:o.jsx("div",{className:"animate-spin h-8 w-8 border-2 border-blue-500 border-t-transparent rounded-full"})}):e?o.jsxs("div",{className:"space-y-8",children:[o.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl p-6 border border-gray-200",children:o.jsx("div",{className:"space-y-4",children:o.jsx(vs,{variant:"default",placeholder:"Search articles...",onResultClick:()=>{}})})}),o.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl p-6 border border-gray-200",children:o.jsxs("div",{className:"space-y-4",children:[o.jsxs("button",{onClick:()=>a(!i),className:"flex items-center justify-between w-full p-4 bg-gradient-to-r from-blue-50 to-purple-50 rounded-xl hover:from-blue-100 hover:to-purple-100 transition-all duration-200",children:[o.jsxs("div",{className:"flex items-center space-x-3",children:[o.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-blue-700 p-2 rounded-lg",children:o.jsx(A0,{className:"h-5 w-5 text-white"})}),o.jsxs("div",{className:"text-left",children:[o.jsx("h3",{className:"font-medium text-gray-900",children:"Quick Actions"}),o.jsx("p",{className:"text-sm text-gray-600",children:"Manage platform and user administration"})]})]}),o.jsx(Ro,{className:`h-5 w-5 text-gray-500 transition-transform duration-200 ${i?"rotate-180":""}`})]}),o.jsx("div",{className:`overflow-hidden transition-all duration-300 ease-in-out ${i?"max-h-96 opacity-100":"max-h-0 opacity-0"}`,children:o.jsxs("div",{className:"space-y-3 pt-2",children:[o.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-blue-50 rounded-lg border border-blue-100",children:[o.jsx("div",{className:"bg-blue-100 p-2 rounded-lg",children:o.jsx(zt,{className:"h-4 w-4 text-blue-600"})}),o.jsxs("div",{className:"flex-1",children:[o.jsx("p",{className:"font-medium text-gray-900",children:"Total Articles"}),o.jsx("p",{className:"text-sm text-gray-600",children:"Published articles on the platform"})]}),o.jsx("span",{className:"bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-lg font-bold",children:(e==null?void 0:e.systemStats.totalArticles)||0})]}),o.jsxs(le,{to:"/admin/writer-requests",className:"flex items-center space-x-3 p-3 hover:bg-white rounded-lg transition-colors duration-150 group",children:[o.jsx("div",{className:"bg-orange-100 p-2 rounded-lg group-hover:bg-orange-200 transition-colors",children:o.jsx(zl,{className:"h-4 w-4 text-orange-600"})}),o.jsxs("div",{className:"flex-1",children:[o.jsx("p",{className:"font-medium text-gray-900",children:"InfoWriter Requests"}),o.jsx("p",{className:"text-sm text-gray-600",children:"Review and approve writer applications"})]}),o.jsx("span",{className:"bg-orange-100 text-orange-800 px-2 py-1 rounded-full text-sm font-medium",children:(e==null?void 0:e.pendingWriterRequests)||0})]}),o.jsxs(le,{to:"/admin/active-writers",className:"flex items-center space-x-3 p-3 hover:bg-white rounded-lg transition-colors duration-150 group",children:[o.jsx("div",{className:"bg-green-100 p-2 rounded-lg group-hover:bg-green-200 transition-colors",children:o.jsx(Wa,{className:"h-4 w-4 text-green-600"})}),o.jsxs("div",{className:"flex-1",children:[o.jsx("p",{className:"font-medium text-gray-900",children:"Active Writers"}),o.jsx("p",{className:"text-sm text-gray-600",children:"Manage current InfoWriter privileges"})]}),o.jsx("span",{className:"bg-green-100 text-green-800 px-2 py-1 rounded-full text-sm font-medium",children:(e==null?void 0:e.activeWriters)||0})]}),o.jsxs(le,{to:"/admin/removed-writers",className:"flex items-center space-x-3 p-3 hover:bg-white rounded-lg transition-colors duration-150 group",children:[o.jsx("div",{className:"bg-red-100 p-2 rounded-lg group-hover:bg-red-200 transition-colors",children:o.jsx(Ha,{className:"h-4 w-4 text-red-600"})}),o.jsxs("div",{className:"flex-1",children:[o.jsx("p",{className:"font-medium text-gray-900",children:"Removed Writers"}),o.jsx("p",{className:"text-sm text-gray-600",children:"View and restore writer privileges"})]}),o.jsx("span",{className:"bg-red-100 text-red-800 px-2 py-1 rounded-full text-sm font-medium",children:(e==null?void 0:e.removedWriters)||0})]}),o.jsxs(le,{to:"/my-articles",className:"flex items-center space-x-3 p-3 hover:bg-white rounded-lg transition-colors duration-150 group",children:[o.jsx("div",{className:"bg-purple-100 p-2 rounded-lg group-hover:bg-purple-200 transition-colors",children:o.jsx(Wl,{className:"h-4 w-4 text-purple-600"})}),o.jsxs("div",{children:[o.jsx("p",{className:"font-medium text-gray-900",children:"My Articles"}),o.jsx("p",{className:"text-sm text-gray-600",children:"Create and manage your own articles"})]})]}),o.jsxs(le,{to:"/my-articles?status=unpublished",className:"flex items-center space-x-3 p-3 hover:bg-white rounded-lg transition-colors duration-150 group",children:[o.jsx("div",{className:"bg-orange-100 p-2 rounded-lg group-hover:bg-orange-200 transition-colors",children:o.jsx(zs,{className:"h-4 w-4 text-orange-600"})}),o.jsxs("div",{children:[o.jsx("p",{className:"font-medium text-gray-900",children:"Unpublished Articles"}),o.jsx("p",{className:"text-sm text-gray-600",children:"View and manage unpublished content"})]})]})]})})]})}),o.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl p-6 border border-gray-200",children:!e.publishedArticles||e.publishedArticles.length===0?o.jsxs("div",{className:"text-center py-12",children:[o.jsx(zt,{className:"h-12 w-12 text-gray-300 mx-auto mb-4"}),o.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No articles yet"}),o.jsx("p",{className:"text-gray-600",children:"Articles will appear here once published."})]}):o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:e.publishedArticles.sort((d,u)=>(u.views||0)-(d.views||0)).slice(0,6).map(d=>o.jsx(Ns,{article:d,variant:"compact",showActions:!0},d.id))})})]}):o.jsxs("div",{className:"text-center py-12",children:[o.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Unable to load admin dashboard"}),o.jsx("p",{className:"text-gray-600",children:"Please try refreshing the page."})]})},_b=()=>{const{userProfile:r,isAdmin:e,isUser:t,loading:s}=ve(),n=Tt();b.useEffect(()=>{(r==null?void 0:r.role)==="infowriter"&&n("/my-articles",{replace:!0})},[r,n]);const i=b.useMemo(()=>r?e?$b:t?Lb:null:null,[r,e,t]);return(r==null?void 0:r.role)==="infowriter"?o.jsx("div",{className:"flex items-center justify-center min-h-32",children:o.jsx("div",{className:"animate-spin h-6 w-6 border-2 border-blue-500 border-t-transparent rounded-full"})}):s&&!r?o.jsx("div",{className:"flex items-center justify-center min-h-64",children:o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"animate-spin h-8 w-8 border-2 border-blue-500 border-t-transparent rounded-full mx-auto mb-4"}),o.jsx("p",{className:"text-gray-600",children:"Loading your dashboard..."})]})}):r?i?o.jsx(i,{}):o.jsxs("div",{className:"text-center py-12",children:[o.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Unknown Role"}),o.jsx("p",{className:"text-gray-600",children:"Your account role is not recognized. Please contact support."})]}):o.jsxs("div",{className:"text-center py-12",children:[o.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Access Denied"}),o.jsx("p",{className:"text-gray-600",children:"Please log in to access the dashboard."})]})},Fb=({onRecover:r,onDismiss:e,currentArticleId:t})=>{const[s,n]=b.useState([]),[i,a]=b.useState(!1);b.useEffect(()=>{const u=()=>{try{const h=[];for(let m=0;m<localStorage.length;m++){const g=localStorage.key(m);if(g!=null&&g.startsWith("autosave_draft_")){const y=localStorage.getItem(g);if(y)try{const x=JSON.parse(y);x.lastModified&&x.title&&x.content&&h.push({...x,lastModified:new Date(x.lastModified),id:g.replace("autosave_draft_","")})}catch(x){console.error("Error parsing draft:",x)}}}const f=new Date(Date.now()-7*24*60*60*1e3),p=h.filter(m=>{const g=!t||m.id!==t,y=m.lastModified>f,x=m.content.trim().length>50;return g&&y&&x});p.sort((m,g)=>g.lastModified.getTime()-m.lastModified.getTime()),n(p.slice(0,3)),a(p.length>0)}catch(h){console.error("Error checking for drafts:",h)}};return u(),window.addEventListener("storage",u),()=>{window.removeEventListener("storage",u)}},[t]);const l=u=>{r(u),localStorage.removeItem(`autosave_draft_${u.id}`),a(!1)},c=()=>{a(!1),e()},d=()=>{s.forEach(u=>{localStorage.removeItem(`autosave_draft_${u.id}`)}),a(!1),e()};return!i||s.length===0?null:o.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center p-4 z-50",children:o.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[80vh] overflow-hidden",children:[o.jsx("div",{className:"bg-gradient-to-r from-amber-500 to-orange-500 px-6 py-4",children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{className:"flex items-center space-x-3",children:[o.jsx("div",{className:"bg-white/20 p-2 rounded-lg",children:o.jsx(Ai,{className:"h-5 w-5 text-white"})}),o.jsxs("div",{children:[o.jsx("h2",{className:"text-lg font-semibold text-white",children:"Unsaved Drafts Found"}),o.jsxs("p",{className:"text-amber-100 text-sm",children:["We found ",s.length," unsaved draft",s.length!==1?"s":""," from previous sessions"]})]})]}),o.jsx("button",{onClick:c,className:"text-white/80 hover:text-white p-1 rounded-lg hover:bg-white/10 transition-colors",children:o.jsx(et,{className:"h-5 w-5"})})]})}),o.jsx("div",{className:"p-6 max-h-96 overflow-y-auto",children:o.jsx("div",{className:"space-y-4",children:s.map((u,h)=>o.jsxs("div",{className:"border border-gray-200 rounded-xl p-4 hover:border-amber-300 transition-colors",children:[o.jsxs("div",{className:"flex items-start justify-between mb-3",children:[o.jsxs("div",{className:"flex-1",children:[o.jsx("h3",{className:"font-medium text-gray-900 line-clamp-1",children:u.title||"Untitled Draft"}),o.jsxs("div",{className:"flex items-center space-x-4 mt-1 text-sm text-gray-500",children:[o.jsxs("div",{className:"flex items-center space-x-1",children:[o.jsx(jt,{className:"h-3 w-3"}),o.jsx("span",{children:Ht(u.lastModified,{addSuffix:!0})})]}),o.jsx("span",{children:"•"}),o.jsx("span",{children:u.deviceInfo||"Unknown device"})]})]}),o.jsxs("button",{onClick:()=>l(u),className:"flex items-center space-x-2 bg-amber-600 text-white px-4 py-2 rounded-lg hover:bg-amber-700 transition-colors",children:[o.jsx(Po,{className:"h-4 w-4"}),o.jsx("span",{children:"Recover"})]})]}),o.jsx("div",{className:"bg-gray-50 rounded-lg p-3",children:o.jsxs("p",{className:"text-sm text-gray-600 line-clamp-3",children:[u.content.replace(/<[^>]*>/g,"").substring(0,200),"..."]})})]},u.id))})}),o.jsxs("div",{className:"bg-gray-50 px-6 py-4 flex items-center justify-between",children:[o.jsx("button",{onClick:d,className:"text-sm text-gray-600 hover:text-gray-800 underline",children:"Clear all drafts"}),o.jsx("div",{className:"flex items-center space-x-3",children:o.jsx("button",{onClick:c,className:"px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors",children:"Continue without recovering"})})]})]})})},Yr=class Yr{constructor(){Me(this,"STORAGE_PREFIX","autosave_draft_");Me(this,"MAX_DRAFTS",10);Me(this,"CLEANUP_INTERVAL",24*60*60*1e3);this.setupPeriodicCleanup()}static getInstance(){return Yr.instance||(Yr.instance=new Yr),Yr.instance}saveDraft(e,t){try{const s=e||`new_${Date.now()}`,n=`${this.STORAGE_PREFIX}${s}`,i={title:t.title||"",content:t.content||"",excerpt:t.excerpt,categories:t.categories||[],tags:t.tags||[],coverImage:t.coverImage,lastModified:new Date,deviceInfo:this.getDeviceInfo(),userAgent:navigator.userAgent,articleId:e||void 0,...t};localStorage.setItem(n,JSON.stringify(i)),this.cleanupOldDrafts()}catch(s){console.error("Failed to save draft:",s),this.cleanupOldDrafts();try{const n=`${this.STORAGE_PREFIX}${e||`new_${Date.now()}`}`;localStorage.setItem(n,JSON.stringify(t))}catch(n){console.error("Failed to save draft after cleanup:",n)}}}loadDraft(e){try{const t=`${this.STORAGE_PREFIX}${e}`,s=localStorage.getItem(t);if(s){const n=JSON.parse(s);return{...n,lastModified:new Date(n.lastModified)}}}catch(t){console.error("Failed to load draft:",t)}return null}getAllDrafts(){const e=[];try{for(let t=0;t<localStorage.length;t++){const s=localStorage.key(t);if(s!=null&&s.startsWith(this.STORAGE_PREFIX)){const n=localStorage.getItem(s);if(n)try{const i=JSON.parse(n);e.push({...i,id:s.replace(this.STORAGE_PREFIX,""),lastModified:new Date(i.lastModified)})}catch(i){console.error("Failed to parse draft:",i),localStorage.removeItem(s)}}}}catch(t){console.error("Failed to get all drafts:",t)}return e.sort((t,s)=>s.lastModified.getTime()-t.lastModified.getTime())}deleteDraft(e){try{const t=`${this.STORAGE_PREFIX}${e}`;localStorage.removeItem(t)}catch(t){console.error("Failed to delete draft:",t)}}clearAllDrafts(){try{const e=[];for(let t=0;t<localStorage.length;t++){const s=localStorage.key(t);s!=null&&s.startsWith(this.STORAGE_PREFIX)&&e.push(s)}e.forEach(t=>localStorage.removeItem(t))}catch(e){console.error("Failed to clear all drafts:",e)}}cleanupOldDrafts(){try{const e=this.getAllDrafts(),t=new Date(Date.now()-7*24*60*60*1e3);e.forEach(n=>{n.lastModified<t&&this.deleteDraft(n.id)});const s=e.filter(n=>n.lastModified>=t);s.length>this.MAX_DRAFTS&&s.slice(this.MAX_DRAFTS).forEach(i=>this.deleteDraft(i.id))}catch(e){console.error("Failed to cleanup old drafts:",e)}}setupPeriodicCleanup(){setInterval(()=>{this.cleanupOldDrafts()},this.CLEANUP_INTERVAL)}getDeviceInfo(){const e=navigator.platform||"Unknown",t=/Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);return`${this.getBrowserName()} on ${e}${t?" (Mobile)":""}`}getBrowserName(){const e=navigator.userAgent;return e.includes("Chrome")?"Chrome":e.includes("Firefox")?"Firefox":e.includes("Safari")?"Safari":e.includes("Edge")?"Edge":e.includes("Opera")?"Opera":"Unknown Browser"}hasDraft(e){const t=`${this.STORAGE_PREFIX}${e}`;return localStorage.getItem(t)!==null}getStorageInfo(){try{let e=0;for(let n=0;n<localStorage.length;n++){const i=localStorage.key(n);if(i!=null&&i.startsWith(this.STORAGE_PREFIX)){const a=localStorage.getItem(i);a&&(e+=i.length+a.length)}}const t=5*1024*1024,s=e/t*100;return{used:e,available:t-e,percentage:Math.min(s,100)}}catch(e){return console.error("Failed to get storage info:",e),{used:0,available:0,percentage:0}}}};Me(Yr,"instance");let tl=Yr;const la=tl.getInstance();function Xe(r){this.content=r}Xe.prototype={constructor:Xe,find:function(r){for(var e=0;e<this.content.length;e+=2)if(this.content[e]===r)return e;return-1},get:function(r){var e=this.find(r);return e==-1?void 0:this.content[e+1]},update:function(r,e,t){var s=t&&t!=r?this.remove(t):this,n=s.find(r),i=s.content.slice();return n==-1?i.push(t||r,e):(i[n+1]=e,t&&(i[n]=t)),new Xe(i)},remove:function(r){var e=this.find(r);if(e==-1)return this;var t=this.content.slice();return t.splice(e,2),new Xe(t)},addToStart:function(r,e){return new Xe([r,e].concat(this.remove(r).content))},addToEnd:function(r,e){var t=this.remove(r).content.slice();return t.push(r,e),new Xe(t)},addBefore:function(r,e,t){var s=this.remove(e),n=s.content.slice(),i=s.find(r);return n.splice(i==-1?n.length:i,0,e,t),new Xe(n)},forEach:function(r){for(var e=0;e<this.content.length;e+=2)r(this.content[e],this.content[e+1])},prepend:function(r){return r=Xe.from(r),r.size?new Xe(r.content.concat(this.subtract(r).content)):this},append:function(r){return r=Xe.from(r),r.size?new Xe(this.subtract(r).content.concat(r.content)):this},subtract:function(r){var e=this;r=Xe.from(r);for(var t=0;t<r.content.length;t+=2)e=e.remove(r.content[t]);return e},toObject:function(){var r={};return this.forEach(function(e,t){r[e]=t}),r},get size(){return this.content.length>>1}};Xe.from=function(r){if(r instanceof Xe)return r;var e=[];if(r)for(var t in r)e.push(t,r[t]);return new Xe(e)};function df(r,e,t){for(let s=0;;s++){if(s==r.childCount||s==e.childCount)return r.childCount==e.childCount?null:t;let n=r.child(s),i=e.child(s);if(n==i){t+=n.nodeSize;continue}if(!n.sameMarkup(i))return t;if(n.isText&&n.text!=i.text){for(let a=0;n.text[a]==i.text[a];a++)t++;return t}if(n.content.size||i.content.size){let a=df(n.content,i.content,t+1);if(a!=null)return a}t+=n.nodeSize}}function uf(r,e,t,s){for(let n=r.childCount,i=e.childCount;;){if(n==0||i==0)return n==i?null:{a:t,b:s};let a=r.child(--n),l=e.child(--i),c=a.nodeSize;if(a==l){t-=c,s-=c;continue}if(!a.sameMarkup(l))return{a:t,b:s};if(a.isText&&a.text!=l.text){let d=0,u=Math.min(a.text.length,l.text.length);for(;d<u&&a.text[a.text.length-d-1]==l.text[l.text.length-d-1];)d++,t--,s--;return{a:t,b:s}}if(a.content.size||l.content.size){let d=uf(a.content,l.content,t-1,s-1);if(d)return d}t-=c,s-=c}}class z{constructor(e,t){if(this.content=e,this.size=t||0,t==null)for(let s=0;s<e.length;s++)this.size+=e[s].nodeSize}nodesBetween(e,t,s,n=0,i){for(let a=0,l=0;l<t;a++){let c=this.content[a],d=l+c.nodeSize;if(d>e&&s(c,n+l,i||null,a)!==!1&&c.content.size){let u=l+1;c.nodesBetween(Math.max(0,e-u),Math.min(c.content.size,t-u),s,n+u)}l=d}}descendants(e){this.nodesBetween(0,this.size,e)}textBetween(e,t,s,n){let i="",a=!0;return this.nodesBetween(e,t,(l,c)=>{let d=l.isText?l.text.slice(Math.max(e,c)-c,t-c):l.isLeaf?n?typeof n=="function"?n(l):n:l.type.spec.leafText?l.type.spec.leafText(l):"":"";l.isBlock&&(l.isLeaf&&d||l.isTextblock)&&s&&(a?a=!1:i+=s),i+=d},0),i}append(e){if(!e.size)return this;if(!this.size)return e;let t=this.lastChild,s=e.firstChild,n=this.content.slice(),i=0;for(t.isText&&t.sameMarkup(s)&&(n[n.length-1]=t.withText(t.text+s.text),i=1);i<e.content.length;i++)n.push(e.content[i]);return new z(n,this.size+e.size)}cut(e,t=this.size){if(e==0&&t==this.size)return this;let s=[],n=0;if(t>e)for(let i=0,a=0;a<t;i++){let l=this.content[i],c=a+l.nodeSize;c>e&&((a<e||c>t)&&(l.isText?l=l.cut(Math.max(0,e-a),Math.min(l.text.length,t-a)):l=l.cut(Math.max(0,e-a-1),Math.min(l.content.size,t-a-1))),s.push(l),n+=l.nodeSize),a=c}return new z(s,n)}cutByIndex(e,t){return e==t?z.empty:e==0&&t==this.content.length?this:new z(this.content.slice(e,t))}replaceChild(e,t){let s=this.content[e];if(s==t)return this;let n=this.content.slice(),i=this.size+t.nodeSize-s.nodeSize;return n[e]=t,new z(n,i)}addToStart(e){return new z([e].concat(this.content),this.size+e.nodeSize)}addToEnd(e){return new z(this.content.concat(e),this.size+e.nodeSize)}eq(e){if(this.content.length!=e.content.length)return!1;for(let t=0;t<this.content.length;t++)if(!this.content[t].eq(e.content[t]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(e){let t=this.content[e];if(!t)throw new RangeError("Index "+e+" out of range for "+this);return t}maybeChild(e){return this.content[e]||null}forEach(e){for(let t=0,s=0;t<this.content.length;t++){let n=this.content[t];e(n,s,t),s+=n.nodeSize}}findDiffStart(e,t=0){return df(this,e,t)}findDiffEnd(e,t=this.size,s=e.size){return uf(this,e,t,s)}findIndex(e,t=-1){if(e==0)return ei(0,e);if(e==this.size)return ei(this.content.length,e);if(e>this.size||e<0)throw new RangeError(`Position ${e} outside of fragment (${this})`);for(let s=0,n=0;;s++){let i=this.child(s),a=n+i.nodeSize;if(a>=e)return a==e||t>0?ei(s+1,a):ei(s,n);n=a}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map(e=>e.toJSON()):null}static fromJSON(e,t){if(!t)return z.empty;if(!Array.isArray(t))throw new RangeError("Invalid input for Fragment.fromJSON");return new z(t.map(e.nodeFromJSON))}static fromArray(e){if(!e.length)return z.empty;let t,s=0;for(let n=0;n<e.length;n++){let i=e[n];s+=i.nodeSize,n&&i.isText&&e[n-1].sameMarkup(i)?(t||(t=e.slice(0,n)),t[t.length-1]=i.withText(t[t.length-1].text+i.text)):t&&t.push(i)}return new z(t||e,s)}static from(e){if(!e)return z.empty;if(e instanceof z)return e;if(Array.isArray(e))return this.fromArray(e);if(e.attrs)return new z([e],e.nodeSize);throw new RangeError("Can not convert "+e+" to a Fragment"+(e.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}}z.empty=new z([],0);const ca={index:0,offset:0};function ei(r,e){return ca.index=r,ca.offset=e,ca}function _i(r,e){if(r===e)return!0;if(!(r&&typeof r=="object")||!(e&&typeof e=="object"))return!1;let t=Array.isArray(r);if(Array.isArray(e)!=t)return!1;if(t){if(r.length!=e.length)return!1;for(let s=0;s<r.length;s++)if(!_i(r[s],e[s]))return!1}else{for(let s in r)if(!(s in e)||!_i(r[s],e[s]))return!1;for(let s in e)if(!(s in r))return!1}return!0}let Ae=class rl{constructor(e,t){this.type=e,this.attrs=t}addToSet(e){let t,s=!1;for(let n=0;n<e.length;n++){let i=e[n];if(this.eq(i))return e;if(this.type.excludes(i.type))t||(t=e.slice(0,n));else{if(i.type.excludes(this.type))return e;!s&&i.type.rank>this.type.rank&&(t||(t=e.slice(0,n)),t.push(this),s=!0),t&&t.push(i)}}return t||(t=e.slice()),s||t.push(this),t}removeFromSet(e){for(let t=0;t<e.length;t++)if(this.eq(e[t]))return e.slice(0,t).concat(e.slice(t+1));return e}isInSet(e){for(let t=0;t<e.length;t++)if(this.eq(e[t]))return!0;return!1}eq(e){return this==e||this.type==e.type&&_i(this.attrs,e.attrs)}toJSON(){let e={type:this.type.name};for(let t in this.attrs){e.attrs=this.attrs;break}return e}static fromJSON(e,t){if(!t)throw new RangeError("Invalid input for Mark.fromJSON");let s=e.marks[t.type];if(!s)throw new RangeError(`There is no mark type ${t.type} in this schema`);let n=s.create(t.attrs);return s.checkAttrs(n.attrs),n}static sameSet(e,t){if(e==t)return!0;if(e.length!=t.length)return!1;for(let s=0;s<e.length;s++)if(!e[s].eq(t[s]))return!1;return!0}static setFrom(e){if(!e||Array.isArray(e)&&e.length==0)return rl.none;if(e instanceof rl)return[e];let t=e.slice();return t.sort((s,n)=>s.type.rank-n.type.rank),t}};Ae.none=[];class Fi extends Error{}class Q{constructor(e,t,s){this.content=e,this.openStart=t,this.openEnd=s}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(e,t){let s=ff(this.content,e+this.openStart,t);return s&&new Q(s,this.openStart,this.openEnd)}removeBetween(e,t){return new Q(hf(this.content,e+this.openStart,t+this.openStart),this.openStart,this.openEnd)}eq(e){return this.content.eq(e.content)&&this.openStart==e.openStart&&this.openEnd==e.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let e={content:this.content.toJSON()};return this.openStart>0&&(e.openStart=this.openStart),this.openEnd>0&&(e.openEnd=this.openEnd),e}static fromJSON(e,t){if(!t)return Q.empty;let s=t.openStart||0,n=t.openEnd||0;if(typeof s!="number"||typeof n!="number")throw new RangeError("Invalid input for Slice.fromJSON");return new Q(z.fromJSON(e,t.content),s,n)}static maxOpen(e,t=!0){let s=0,n=0;for(let i=e.firstChild;i&&!i.isLeaf&&(t||!i.type.spec.isolating);i=i.firstChild)s++;for(let i=e.lastChild;i&&!i.isLeaf&&(t||!i.type.spec.isolating);i=i.lastChild)n++;return new Q(e,s,n)}}Q.empty=new Q(z.empty,0,0);function hf(r,e,t){let{index:s,offset:n}=r.findIndex(e),i=r.maybeChild(s),{index:a,offset:l}=r.findIndex(t);if(n==e||i.isText){if(l!=t&&!r.child(a).isText)throw new RangeError("Removing non-flat range");return r.cut(0,e).append(r.cut(t))}if(s!=a)throw new RangeError("Removing non-flat range");return r.replaceChild(s,i.copy(hf(i.content,e-n-1,t-n-1)))}function ff(r,e,t,s){let{index:n,offset:i}=r.findIndex(e),a=r.maybeChild(n);if(i==e||a.isText)return r.cut(0,e).append(t).append(r.cut(e));let l=ff(a.content,e-i-1,t);return l&&r.replaceChild(n,a.copy(l))}function Bb(r,e,t){if(t.openStart>r.depth)throw new Fi("Inserted content deeper than insertion position");if(r.depth-t.openStart!=e.depth-t.openEnd)throw new Fi("Inconsistent open depths");return pf(r,e,t,0)}function pf(r,e,t,s){let n=r.index(s),i=r.node(s);if(n==e.index(s)&&s<r.depth-t.openStart){let a=pf(r,e,t,s+1);return i.copy(i.content.replaceChild(n,a))}else if(t.content.size)if(!t.openStart&&!t.openEnd&&r.depth==s&&e.depth==s){let a=r.parent,l=a.content;return ns(a,l.cut(0,r.parentOffset).append(t.content).append(l.cut(e.parentOffset)))}else{let{start:a,end:l}=Ub(t,r);return ns(i,gf(r,a,l,e,s))}else return ns(i,Bi(r,e,s))}function mf(r,e){if(!e.type.compatibleContent(r.type))throw new Fi("Cannot join "+e.type.name+" onto "+r.type.name)}function sl(r,e,t){let s=r.node(t);return mf(s,e.node(t)),s}function ss(r,e){let t=e.length-1;t>=0&&r.isText&&r.sameMarkup(e[t])?e[t]=r.withText(e[t].text+r.text):e.push(r)}function pn(r,e,t,s){let n=(e||r).node(t),i=0,a=e?e.index(t):n.childCount;r&&(i=r.index(t),r.depth>t?i++:r.textOffset&&(ss(r.nodeAfter,s),i++));for(let l=i;l<a;l++)ss(n.child(l),s);e&&e.depth==t&&e.textOffset&&ss(e.nodeBefore,s)}function ns(r,e){return r.type.checkContent(e),r.copy(e)}function gf(r,e,t,s,n){let i=r.depth>n&&sl(r,e,n+1),a=s.depth>n&&sl(t,s,n+1),l=[];return pn(null,r,n,l),i&&a&&e.index(n)==t.index(n)?(mf(i,a),ss(ns(i,gf(r,e,t,s,n+1)),l)):(i&&ss(ns(i,Bi(r,e,n+1)),l),pn(e,t,n,l),a&&ss(ns(a,Bi(t,s,n+1)),l)),pn(s,null,n,l),new z(l)}function Bi(r,e,t){let s=[];if(pn(null,r,t,s),r.depth>t){let n=sl(r,e,t+1);ss(ns(n,Bi(r,e,t+1)),s)}return pn(e,null,t,s),new z(s)}function Ub(r,e){let t=e.depth-r.openStart,n=e.node(t).copy(r.content);for(let i=t-1;i>=0;i--)n=e.node(i).copy(z.from(n));return{start:n.resolveNoCache(r.openStart+t),end:n.resolveNoCache(n.content.size-r.openEnd-t)}}class En{constructor(e,t,s){this.pos=e,this.path=t,this.parentOffset=s,this.depth=t.length/3-1}resolveDepth(e){return e==null?this.depth:e<0?this.depth+e:e}get parent(){return this.node(this.depth)}get doc(){return this.node(0)}node(e){return this.path[this.resolveDepth(e)*3]}index(e){return this.path[this.resolveDepth(e)*3+1]}indexAfter(e){return e=this.resolveDepth(e),this.index(e)+(e==this.depth&&!this.textOffset?0:1)}start(e){return e=this.resolveDepth(e),e==0?0:this.path[e*3-1]+1}end(e){return e=this.resolveDepth(e),this.start(e)+this.node(e).content.size}before(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position before the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]}after(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position after the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]+this.path[e*3].nodeSize}get textOffset(){return this.pos-this.path[this.path.length-1]}get nodeAfter(){let e=this.parent,t=this.index(this.depth);if(t==e.childCount)return null;let s=this.pos-this.path[this.path.length-1],n=e.child(t);return s?e.child(t).cut(s):n}get nodeBefore(){let e=this.index(this.depth),t=this.pos-this.path[this.path.length-1];return t?this.parent.child(e).cut(0,t):e==0?null:this.parent.child(e-1)}posAtIndex(e,t){t=this.resolveDepth(t);let s=this.path[t*3],n=t==0?0:this.path[t*3-1]+1;for(let i=0;i<e;i++)n+=s.child(i).nodeSize;return n}marks(){let e=this.parent,t=this.index();if(e.content.size==0)return Ae.none;if(this.textOffset)return e.child(t).marks;let s=e.maybeChild(t-1),n=e.maybeChild(t);if(!s){let l=s;s=n,n=l}let i=s.marks;for(var a=0;a<i.length;a++)i[a].type.spec.inclusive===!1&&(!n||!i[a].isInSet(n.marks))&&(i=i[a--].removeFromSet(i));return i}marksAcross(e){let t=this.parent.maybeChild(this.index());if(!t||!t.isInline)return null;let s=t.marks,n=e.parent.maybeChild(e.index());for(var i=0;i<s.length;i++)s[i].type.spec.inclusive===!1&&(!n||!s[i].isInSet(n.marks))&&(s=s[i--].removeFromSet(s));return s}sharedDepth(e){for(let t=this.depth;t>0;t--)if(this.start(t)<=e&&this.end(t)>=e)return t;return 0}blockRange(e=this,t){if(e.pos<this.pos)return e.blockRange(this);for(let s=this.depth-(this.parent.inlineContent||this.pos==e.pos?1:0);s>=0;s--)if(e.pos<=this.end(s)&&(!t||t(this.node(s))))return new Ui(this,e,s);return null}sameParent(e){return this.pos-this.parentOffset==e.pos-e.parentOffset}max(e){return e.pos>this.pos?e:this}min(e){return e.pos<this.pos?e:this}toString(){let e="";for(let t=1;t<=this.depth;t++)e+=(e?"/":"")+this.node(t).type.name+"_"+this.index(t-1);return e+":"+this.parentOffset}static resolve(e,t){if(!(t>=0&&t<=e.content.size))throw new RangeError("Position "+t+" out of range");let s=[],n=0,i=t;for(let a=e;;){let{index:l,offset:c}=a.content.findIndex(i),d=i-c;if(s.push(a,l,n+c),!d||(a=a.child(l),a.isText))break;i=d-1,n+=c+1}return new En(t,s,i)}static resolveCached(e,t){let s=ad.get(e);if(s)for(let i=0;i<s.elts.length;i++){let a=s.elts[i];if(a.pos==t)return a}else ad.set(e,s=new zb);let n=s.elts[s.i]=En.resolve(e,t);return s.i=(s.i+1)%Wb,n}}class zb{constructor(){this.elts=[],this.i=0}}const Wb=12,ad=new WeakMap;class Ui{constructor(e,t,s){this.$from=e,this.$to=t,this.depth=s}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}}const Hb=Object.create(null);let Er=class nl{constructor(e,t,s,n=Ae.none){this.type=e,this.attrs=t,this.marks=n,this.content=s||z.empty}get children(){return this.content.content}get nodeSize(){return this.isLeaf?1:2+this.content.size}get childCount(){return this.content.childCount}child(e){return this.content.child(e)}maybeChild(e){return this.content.maybeChild(e)}forEach(e){this.content.forEach(e)}nodesBetween(e,t,s,n=0){this.content.nodesBetween(e,t,s,n,this)}descendants(e){this.nodesBetween(0,this.content.size,e)}get textContent(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}textBetween(e,t,s,n){return this.content.textBetween(e,t,s,n)}get firstChild(){return this.content.firstChild}get lastChild(){return this.content.lastChild}eq(e){return this==e||this.sameMarkup(e)&&this.content.eq(e.content)}sameMarkup(e){return this.hasMarkup(e.type,e.attrs,e.marks)}hasMarkup(e,t,s){return this.type==e&&_i(this.attrs,t||e.defaultAttrs||Hb)&&Ae.sameSet(this.marks,s||Ae.none)}copy(e=null){return e==this.content?this:new nl(this.type,this.attrs,e,this.marks)}mark(e){return e==this.marks?this:new nl(this.type,this.attrs,this.content,e)}cut(e,t=this.content.size){return e==0&&t==this.content.size?this:this.copy(this.content.cut(e,t))}slice(e,t=this.content.size,s=!1){if(e==t)return Q.empty;let n=this.resolve(e),i=this.resolve(t),a=s?0:n.sharedDepth(t),l=n.start(a),d=n.node(a).content.cut(n.pos-l,i.pos-l);return new Q(d,n.depth-a,i.depth-a)}replace(e,t,s){return Bb(this.resolve(e),this.resolve(t),s)}nodeAt(e){for(let t=this;;){let{index:s,offset:n}=t.content.findIndex(e);if(t=t.maybeChild(s),!t)return null;if(n==e||t.isText)return t;e-=n+1}}childAfter(e){let{index:t,offset:s}=this.content.findIndex(e);return{node:this.content.maybeChild(t),index:t,offset:s}}childBefore(e){if(e==0)return{node:null,index:0,offset:0};let{index:t,offset:s}=this.content.findIndex(e);if(s<e)return{node:this.content.child(t),index:t,offset:s};let n=this.content.child(t-1);return{node:n,index:t-1,offset:s-n.nodeSize}}resolve(e){return En.resolveCached(this,e)}resolveNoCache(e){return En.resolve(this,e)}rangeHasMark(e,t,s){let n=!1;return t>e&&this.nodesBetween(e,t,i=>(s.isInSet(i.marks)&&(n=!0),!n)),n}get isBlock(){return this.type.isBlock}get isTextblock(){return this.type.isTextblock}get inlineContent(){return this.type.inlineContent}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return this.type.isLeaf}get isAtom(){return this.type.isAtom}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);let e=this.type.name;return this.content.size&&(e+="("+this.content.toStringInner()+")"),xf(this.marks,e)}contentMatchAt(e){let t=this.type.contentMatch.matchFragment(this.content,0,e);if(!t)throw new Error("Called contentMatchAt on a node with invalid content");return t}canReplace(e,t,s=z.empty,n=0,i=s.childCount){let a=this.contentMatchAt(e).matchFragment(s,n,i),l=a&&a.matchFragment(this.content,t);if(!l||!l.validEnd)return!1;for(let c=n;c<i;c++)if(!this.type.allowsMarks(s.child(c).marks))return!1;return!0}canReplaceWith(e,t,s,n){if(n&&!this.type.allowsMarks(n))return!1;let i=this.contentMatchAt(e).matchType(s),a=i&&i.matchFragment(this.content,t);return a?a.validEnd:!1}canAppend(e){return e.content.size?this.canReplace(this.childCount,this.childCount,e.content):this.type.compatibleContent(e.type)}check(){this.type.checkContent(this.content),this.type.checkAttrs(this.attrs);let e=Ae.none;for(let t=0;t<this.marks.length;t++){let s=this.marks[t];s.type.checkAttrs(s.attrs),e=s.addToSet(e)}if(!Ae.sameSet(e,this.marks))throw new RangeError(`Invalid collection of marks for node ${this.type.name}: ${this.marks.map(t=>t.type.name)}`);this.content.forEach(t=>t.check())}toJSON(){let e={type:this.type.name};for(let t in this.attrs){e.attrs=this.attrs;break}return this.content.size&&(e.content=this.content.toJSON()),this.marks.length&&(e.marks=this.marks.map(t=>t.toJSON())),e}static fromJSON(e,t){if(!t)throw new RangeError("Invalid input for Node.fromJSON");let s;if(t.marks){if(!Array.isArray(t.marks))throw new RangeError("Invalid mark data for Node.fromJSON");s=t.marks.map(e.markFromJSON)}if(t.type=="text"){if(typeof t.text!="string")throw new RangeError("Invalid text node in JSON");return e.text(t.text,s)}let n=z.fromJSON(e,t.content),i=e.nodeType(t.type).create(t.attrs,n,s);return i.type.checkAttrs(i.attrs),i}};Er.prototype.text=void 0;class zi extends Er{constructor(e,t,s,n){if(super(e,t,null,n),!s)throw new RangeError("Empty text nodes are not allowed");this.text=s}toString(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):xf(this.marks,JSON.stringify(this.text))}get textContent(){return this.text}textBetween(e,t){return this.text.slice(e,t)}get nodeSize(){return this.text.length}mark(e){return e==this.marks?this:new zi(this.type,this.attrs,this.text,e)}withText(e){return e==this.text?this:new zi(this.type,this.attrs,e,this.marks)}cut(e=0,t=this.text.length){return e==0&&t==this.text.length?this:this.withText(this.text.slice(e,t))}eq(e){return this.sameMarkup(e)&&this.text==e.text}toJSON(){let e=super.toJSON();return e.text=this.text,e}}function xf(r,e){for(let t=r.length-1;t>=0;t--)e=r[t].type.name+"("+e+")";return e}class ps{constructor(e){this.validEnd=e,this.next=[],this.wrapCache=[]}static parse(e,t){let s=new Vb(e,t);if(s.next==null)return ps.empty;let n=yf(s);s.next&&s.err("Unexpected trailing text");let i=Qb(Xb(n));return Zb(i,s),i}matchType(e){for(let t=0;t<this.next.length;t++)if(this.next[t].type==e)return this.next[t].next;return null}matchFragment(e,t=0,s=e.childCount){let n=this;for(let i=t;n&&i<s;i++)n=n.matchType(e.child(i).type);return n}get inlineContent(){return this.next.length!=0&&this.next[0].type.isInline}get defaultType(){for(let e=0;e<this.next.length;e++){let{type:t}=this.next[e];if(!(t.isText||t.hasRequiredAttrs()))return t}return null}compatible(e){for(let t=0;t<this.next.length;t++)for(let s=0;s<e.next.length;s++)if(this.next[t].type==e.next[s].type)return!0;return!1}fillBefore(e,t=!1,s=0){let n=[this];function i(a,l){let c=a.matchFragment(e,s);if(c&&(!t||c.validEnd))return z.from(l.map(d=>d.createAndFill()));for(let d=0;d<a.next.length;d++){let{type:u,next:h}=a.next[d];if(!(u.isText||u.hasRequiredAttrs())&&n.indexOf(h)==-1){n.push(h);let f=i(h,l.concat(u));if(f)return f}}return null}return i(this,[])}findWrapping(e){for(let s=0;s<this.wrapCache.length;s+=2)if(this.wrapCache[s]==e)return this.wrapCache[s+1];let t=this.computeWrapping(e);return this.wrapCache.push(e,t),t}computeWrapping(e){let t=Object.create(null),s=[{match:this,type:null,via:null}];for(;s.length;){let n=s.shift(),i=n.match;if(i.matchType(e)){let a=[];for(let l=n;l.type;l=l.via)a.push(l.type);return a.reverse()}for(let a=0;a<i.next.length;a++){let{type:l,next:c}=i.next[a];!l.isLeaf&&!l.hasRequiredAttrs()&&!(l.name in t)&&(!n.type||c.validEnd)&&(s.push({match:l.contentMatch,type:l,via:n}),t[l.name]=!0)}}return null}get edgeCount(){return this.next.length}edge(e){if(e>=this.next.length)throw new RangeError(`There's no ${e}th edge in this content match`);return this.next[e]}toString(){let e=[];function t(s){e.push(s);for(let n=0;n<s.next.length;n++)e.indexOf(s.next[n].next)==-1&&t(s.next[n].next)}return t(this),e.map((s,n)=>{let i=n+(s.validEnd?"*":" ")+" ";for(let a=0;a<s.next.length;a++)i+=(a?", ":"")+s.next[a].type.name+"->"+e.indexOf(s.next[a].next);return i}).join(`
`)}}ps.empty=new ps(!0);class Vb{constructor(e,t){this.string=e,this.nodeTypes=t,this.inline=null,this.pos=0,this.tokens=e.split(/\s*(?=\b|\W|$)/),this.tokens[this.tokens.length-1]==""&&this.tokens.pop(),this.tokens[0]==""&&this.tokens.shift()}get next(){return this.tokens[this.pos]}eat(e){return this.next==e&&(this.pos++||!0)}err(e){throw new SyntaxError(e+" (in content expression '"+this.string+"')")}}function yf(r){let e=[];do e.push(qb(r));while(r.eat("|"));return e.length==1?e[0]:{type:"choice",exprs:e}}function qb(r){let e=[];do e.push(Kb(r));while(r.next&&r.next!=")"&&r.next!="|");return e.length==1?e[0]:{type:"seq",exprs:e}}function Kb(r){let e=Jb(r);for(;;)if(r.eat("+"))e={type:"plus",expr:e};else if(r.eat("*"))e={type:"star",expr:e};else if(r.eat("?"))e={type:"opt",expr:e};else if(r.eat("{"))e=Gb(r,e);else break;return e}function ld(r){/\D/.test(r.next)&&r.err("Expected number, got '"+r.next+"'");let e=Number(r.next);return r.pos++,e}function Gb(r,e){let t=ld(r),s=t;return r.eat(",")&&(r.next!="}"?s=ld(r):s=-1),r.eat("}")||r.err("Unclosed braced range"),{type:"range",min:t,max:s,expr:e}}function Yb(r,e){let t=r.nodeTypes,s=t[e];if(s)return[s];let n=[];for(let i in t){let a=t[i];a.isInGroup(e)&&n.push(a)}return n.length==0&&r.err("No node type or group '"+e+"' found"),n}function Jb(r){if(r.eat("(")){let e=yf(r);return r.eat(")")||r.err("Missing closing paren"),e}else if(/\W/.test(r.next))r.err("Unexpected token '"+r.next+"'");else{let e=Yb(r,r.next).map(t=>(r.inline==null?r.inline=t.isInline:r.inline!=t.isInline&&r.err("Mixing inline and block content"),{type:"name",value:t}));return r.pos++,e.length==1?e[0]:{type:"choice",exprs:e}}}function Xb(r){let e=[[]];return n(i(r,0),t()),e;function t(){return e.push([])-1}function s(a,l,c){let d={term:c,to:l};return e[a].push(d),d}function n(a,l){a.forEach(c=>c.to=l)}function i(a,l){if(a.type=="choice")return a.exprs.reduce((c,d)=>c.concat(i(d,l)),[]);if(a.type=="seq")for(let c=0;;c++){let d=i(a.exprs[c],l);if(c==a.exprs.length-1)return d;n(d,l=t())}else if(a.type=="star"){let c=t();return s(l,c),n(i(a.expr,c),c),[s(c)]}else if(a.type=="plus"){let c=t();return n(i(a.expr,l),c),n(i(a.expr,c),c),[s(c)]}else{if(a.type=="opt")return[s(l)].concat(i(a.expr,l));if(a.type=="range"){let c=l;for(let d=0;d<a.min;d++){let u=t();n(i(a.expr,c),u),c=u}if(a.max==-1)n(i(a.expr,c),c);else for(let d=a.min;d<a.max;d++){let u=t();s(c,u),n(i(a.expr,c),u),c=u}return[s(c)]}else{if(a.type=="name")return[s(l,void 0,a.value)];throw new Error("Unknown expr type")}}}}function bf(r,e){return e-r}function cd(r,e){let t=[];return s(e),t.sort(bf);function s(n){let i=r[n];if(i.length==1&&!i[0].term)return s(i[0].to);t.push(n);for(let a=0;a<i.length;a++){let{term:l,to:c}=i[a];!l&&t.indexOf(c)==-1&&s(c)}}}function Qb(r){let e=Object.create(null);return t(cd(r,0));function t(s){let n=[];s.forEach(a=>{r[a].forEach(({term:l,to:c})=>{if(!l)return;let d;for(let u=0;u<n.length;u++)n[u][0]==l&&(d=n[u][1]);cd(r,c).forEach(u=>{d||n.push([l,d=[]]),d.indexOf(u)==-1&&d.push(u)})})});let i=e[s.join(",")]=new ps(s.indexOf(r.length-1)>-1);for(let a=0;a<n.length;a++){let l=n[a][1].sort(bf);i.next.push({type:n[a][0],next:e[l.join(",")]||t(l)})}return i}}function Zb(r,e){for(let t=0,s=[r];t<s.length;t++){let n=s[t],i=!n.validEnd,a=[];for(let l=0;l<n.next.length;l++){let{type:c,next:d}=n.next[l];a.push(c.name),i&&!(c.isText||c.hasRequiredAttrs())&&(i=!1),s.indexOf(d)==-1&&s.push(d)}i&&e.err("Only non-generatable nodes ("+a.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}function wf(r){let e=Object.create(null);for(let t in r){let s=r[t];if(!s.hasDefault)return null;e[t]=s.default}return e}function vf(r,e){let t=Object.create(null);for(let s in r){let n=e&&e[s];if(n===void 0){let i=r[s];if(i.hasDefault)n=i.default;else throw new RangeError("No value supplied for attribute "+s)}t[s]=n}return t}function Nf(r,e,t,s){for(let n in e)if(!(n in r))throw new RangeError(`Unsupported attribute ${n} for ${t} of type ${n}`);for(let n in r){let i=r[n];i.validate&&i.validate(e[n])}}function jf(r,e){let t=Object.create(null);if(e)for(let s in e)t[s]=new tw(r,s,e[s]);return t}let dd=class kf{constructor(e,t,s){this.name=e,this.schema=t,this.spec=s,this.markSet=null,this.groups=s.group?s.group.split(" "):[],this.attrs=jf(e,s.attrs),this.defaultAttrs=wf(this.attrs),this.contentMatch=null,this.inlineContent=null,this.isBlock=!(s.inline||e=="text"),this.isText=e=="text"}get isInline(){return!this.isBlock}get isTextblock(){return this.isBlock&&this.inlineContent}get isLeaf(){return this.contentMatch==ps.empty}get isAtom(){return this.isLeaf||!!this.spec.atom}isInGroup(e){return this.groups.indexOf(e)>-1}get whitespace(){return this.spec.whitespace||(this.spec.code?"pre":"normal")}hasRequiredAttrs(){for(let e in this.attrs)if(this.attrs[e].isRequired)return!0;return!1}compatibleContent(e){return this==e||this.contentMatch.compatible(e.contentMatch)}computeAttrs(e){return!e&&this.defaultAttrs?this.defaultAttrs:vf(this.attrs,e)}create(e=null,t,s){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new Er(this,this.computeAttrs(e),z.from(t),Ae.setFrom(s))}createChecked(e=null,t,s){return t=z.from(t),this.checkContent(t),new Er(this,this.computeAttrs(e),t,Ae.setFrom(s))}createAndFill(e=null,t,s){if(e=this.computeAttrs(e),t=z.from(t),t.size){let a=this.contentMatch.fillBefore(t);if(!a)return null;t=a.append(t)}let n=this.contentMatch.matchFragment(t),i=n&&n.fillBefore(z.empty,!0);return i?new Er(this,e,t.append(i),Ae.setFrom(s)):null}validContent(e){let t=this.contentMatch.matchFragment(e);if(!t||!t.validEnd)return!1;for(let s=0;s<e.childCount;s++)if(!this.allowsMarks(e.child(s).marks))return!1;return!0}checkContent(e){if(!this.validContent(e))throw new RangeError(`Invalid content for node ${this.name}: ${e.toString().slice(0,50)}`)}checkAttrs(e){Nf(this.attrs,e,"node",this.name)}allowsMarkType(e){return this.markSet==null||this.markSet.indexOf(e)>-1}allowsMarks(e){if(this.markSet==null)return!0;for(let t=0;t<e.length;t++)if(!this.allowsMarkType(e[t].type))return!1;return!0}allowedMarks(e){if(this.markSet==null)return e;let t;for(let s=0;s<e.length;s++)this.allowsMarkType(e[s].type)?t&&t.push(e[s]):t||(t=e.slice(0,s));return t?t.length?t:Ae.none:e}static compile(e,t){let s=Object.create(null);e.forEach((i,a)=>s[i]=new kf(i,t,a));let n=t.spec.topNode||"doc";if(!s[n])throw new RangeError("Schema is missing its top node type ('"+n+"')");if(!s.text)throw new RangeError("Every schema needs a 'text' type");for(let i in s.text.attrs)throw new RangeError("The text node type should not have attributes");return s}};function ew(r,e,t){let s=t.split("|");return n=>{let i=n===null?"null":typeof n;if(s.indexOf(i)<0)throw new RangeError(`Expected value of type ${s} for attribute ${e} on type ${r}, got ${i}`)}}class tw{constructor(e,t,s){this.hasDefault=Object.prototype.hasOwnProperty.call(s,"default"),this.default=s.default,this.validate=typeof s.validate=="string"?ew(e,t,s.validate):s.validate}get isRequired(){return!this.hasDefault}}class Fo{constructor(e,t,s,n){this.name=e,this.rank=t,this.schema=s,this.spec=n,this.attrs=jf(e,n.attrs),this.excluded=null;let i=wf(this.attrs);this.instance=i?new Ae(this,i):null}create(e=null){return!e&&this.instance?this.instance:new Ae(this,vf(this.attrs,e))}static compile(e,t){let s=Object.create(null),n=0;return e.forEach((i,a)=>s[i]=new Fo(i,n++,t,a)),s}removeFromSet(e){for(var t=0;t<e.length;t++)e[t].type==this&&(e=e.slice(0,t).concat(e.slice(t+1)),t--);return e}isInSet(e){for(let t=0;t<e.length;t++)if(e[t].type==this)return e[t]}checkAttrs(e){Nf(this.attrs,e,"mark",this.name)}excludes(e){return this.excluded.indexOf(e)>-1}}class Sf{constructor(e){this.linebreakReplacement=null,this.cached=Object.create(null);let t=this.spec={};for(let n in e)t[n]=e[n];t.nodes=Xe.from(e.nodes),t.marks=Xe.from(e.marks||{}),this.nodes=dd.compile(this.spec.nodes,this),this.marks=Fo.compile(this.spec.marks,this);let s=Object.create(null);for(let n in this.nodes){if(n in this.marks)throw new RangeError(n+" can not be both a node and a mark");let i=this.nodes[n],a=i.spec.content||"",l=i.spec.marks;if(i.contentMatch=s[a]||(s[a]=ps.parse(a,this.nodes)),i.inlineContent=i.contentMatch.inlineContent,i.spec.linebreakReplacement){if(this.linebreakReplacement)throw new RangeError("Multiple linebreak nodes defined");if(!i.isInline||!i.isLeaf)throw new RangeError("Linebreak replacement nodes must be inline leaf nodes");this.linebreakReplacement=i}i.markSet=l=="_"?null:l?ud(this,l.split(" ")):l==""||!i.inlineContent?[]:null}for(let n in this.marks){let i=this.marks[n],a=i.spec.excludes;i.excluded=a==null?[i]:a==""?[]:ud(this,a.split(" "))}this.nodeFromJSON=this.nodeFromJSON.bind(this),this.markFromJSON=this.markFromJSON.bind(this),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached.wrappings=Object.create(null)}node(e,t=null,s,n){if(typeof e=="string")e=this.nodeType(e);else if(e instanceof dd){if(e.schema!=this)throw new RangeError("Node type from different schema used ("+e.name+")")}else throw new RangeError("Invalid node type: "+e);return e.createChecked(t,s,n)}text(e,t){let s=this.nodes.text;return new zi(s,s.defaultAttrs,e,Ae.setFrom(t))}mark(e,t){return typeof e=="string"&&(e=this.marks[e]),e.create(t)}nodeFromJSON(e){return Er.fromJSON(this,e)}markFromJSON(e){return Ae.fromJSON(this,e)}nodeType(e){let t=this.nodes[e];if(!t)throw new RangeError("Unknown node type: "+e);return t}}function ud(r,e){let t=[];for(let s=0;s<e.length;s++){let n=e[s],i=r.marks[n],a=i;if(i)t.push(i);else for(let l in r.marks){let c=r.marks[l];(n=="_"||c.spec.group&&c.spec.group.split(" ").indexOf(n)>-1)&&t.push(a=c)}if(!a)throw new SyntaxError("Unknown mark type: '"+e[s]+"'")}return t}function rw(r){return r.tag!=null}function sw(r){return r.style!=null}class Ar{constructor(e,t){this.schema=e,this.rules=t,this.tags=[],this.styles=[];let s=this.matchedStyles=[];t.forEach(n=>{if(rw(n))this.tags.push(n);else if(sw(n)){let i=/[^=]*/.exec(n.style)[0];s.indexOf(i)<0&&s.push(i),this.styles.push(n)}}),this.normalizeLists=!this.tags.some(n=>{if(!/^(ul|ol)\b/.test(n.tag)||!n.node)return!1;let i=e.nodes[n.node];return i.contentMatch.matchType(i)})}parse(e,t={}){let s=new fd(this,t,!1);return s.addAll(e,Ae.none,t.from,t.to),s.finish()}parseSlice(e,t={}){let s=new fd(this,t,!0);return s.addAll(e,Ae.none,t.from,t.to),Q.maxOpen(s.finish())}matchTag(e,t,s){for(let n=s?this.tags.indexOf(s)+1:0;n<this.tags.length;n++){let i=this.tags[n];if(ow(e,i.tag)&&(i.namespace===void 0||e.namespaceURI==i.namespace)&&(!i.context||t.matchesContext(i.context))){if(i.getAttrs){let a=i.getAttrs(e);if(a===!1)continue;i.attrs=a||void 0}return i}}}matchStyle(e,t,s,n){for(let i=n?this.styles.indexOf(n)+1:0;i<this.styles.length;i++){let a=this.styles[i],l=a.style;if(!(l.indexOf(e)!=0||a.context&&!s.matchesContext(a.context)||l.length>e.length&&(l.charCodeAt(e.length)!=61||l.slice(e.length+1)!=t))){if(a.getAttrs){let c=a.getAttrs(t);if(c===!1)continue;a.attrs=c||void 0}return a}}}static schemaRules(e){let t=[];function s(n){let i=n.priority==null?50:n.priority,a=0;for(;a<t.length;a++){let l=t[a];if((l.priority==null?50:l.priority)<i)break}t.splice(a,0,n)}for(let n in e.marks){let i=e.marks[n].spec.parseDOM;i&&i.forEach(a=>{s(a=pd(a)),a.mark||a.ignore||a.clearMark||(a.mark=n)})}for(let n in e.nodes){let i=e.nodes[n].spec.parseDOM;i&&i.forEach(a=>{s(a=pd(a)),a.node||a.ignore||a.mark||(a.node=n)})}return t}static fromSchema(e){return e.cached.domParser||(e.cached.domParser=new Ar(e,Ar.schemaRules(e)))}}const Ef={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},nw={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},Af={ol:!0,ul:!0},An=1,il=2,mn=4;function hd(r,e,t){return e!=null?(e?An:0)|(e==="full"?il:0):r&&r.whitespace=="pre"?An|il:t&~mn}class ti{constructor(e,t,s,n,i,a){this.type=e,this.attrs=t,this.marks=s,this.solid=n,this.options=a,this.content=[],this.activeMarks=Ae.none,this.match=i||(a&mn?null:e.contentMatch)}findWrapping(e){if(!this.match){if(!this.type)return[];let t=this.type.contentMatch.fillBefore(z.from(e));if(t)this.match=this.type.contentMatch.matchFragment(t);else{let s=this.type.contentMatch,n;return(n=s.findWrapping(e.type))?(this.match=s,n):null}}return this.match.findWrapping(e.type)}finish(e){if(!(this.options&An)){let s=this.content[this.content.length-1],n;if(s&&s.isText&&(n=/[ \t\r\n\u000c]+$/.exec(s.text))){let i=s;s.text.length==n[0].length?this.content.pop():this.content[this.content.length-1]=i.withText(i.text.slice(0,i.text.length-n[0].length))}}let t=z.from(this.content);return!e&&this.match&&(t=t.append(this.match.fillBefore(z.empty,!0))),this.type?this.type.create(this.attrs,t,this.marks):t}inlineContext(e){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:e.parentNode&&!Ef.hasOwnProperty(e.parentNode.nodeName.toLowerCase())}}class fd{constructor(e,t,s){this.parser=e,this.options=t,this.isOpen=s,this.open=0,this.localPreserveWS=!1;let n=t.topNode,i,a=hd(null,t.preserveWhitespace,0)|(s?mn:0);n?i=new ti(n.type,n.attrs,Ae.none,!0,t.topMatch||n.type.contentMatch,a):s?i=new ti(null,null,Ae.none,!0,null,a):i=new ti(e.schema.topNodeType,null,Ae.none,!0,null,a),this.nodes=[i],this.find=t.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(e,t){e.nodeType==3?this.addTextNode(e,t):e.nodeType==1&&this.addElement(e,t)}addTextNode(e,t){let s=e.nodeValue,n=this.top,i=n.options&il?"full":this.localPreserveWS||(n.options&An)>0;if(i==="full"||n.inlineContext(e)||/[^ \t\r\n\u000c]/.test(s)){if(i)i!=="full"?s=s.replace(/\r?\n|\r/g," "):s=s.replace(/\r\n?/g,`
`);else if(s=s.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(s)&&this.open==this.nodes.length-1){let a=n.content[n.content.length-1],l=e.previousSibling;(!a||l&&l.nodeName=="BR"||a.isText&&/[ \t\r\n\u000c]$/.test(a.text))&&(s=s.slice(1))}s&&this.insertNode(this.parser.schema.text(s),t,!/\S/.test(s)),this.findInText(e)}else this.findInside(e)}addElement(e,t,s){let n=this.localPreserveWS,i=this.top;(e.tagName=="PRE"||/pre/.test(e.style&&e.style.whiteSpace))&&(this.localPreserveWS=!0);let a=e.nodeName.toLowerCase(),l;Af.hasOwnProperty(a)&&this.parser.normalizeLists&&iw(e);let c=this.options.ruleFromNode&&this.options.ruleFromNode(e)||(l=this.parser.matchTag(e,this,s));e:if(c?c.ignore:nw.hasOwnProperty(a))this.findInside(e),this.ignoreFallback(e,t);else if(!c||c.skip||c.closeParent){c&&c.closeParent?this.open=Math.max(0,this.open-1):c&&c.skip.nodeType&&(e=c.skip);let d,u=this.needsBlock;if(Ef.hasOwnProperty(a))i.content.length&&i.content[0].isInline&&this.open&&(this.open--,i=this.top),d=!0,i.type||(this.needsBlock=!0);else if(!e.firstChild){this.leafFallback(e,t);break e}let h=c&&c.skip?t:this.readStyles(e,t);h&&this.addAll(e,h),d&&this.sync(i),this.needsBlock=u}else{let d=this.readStyles(e,t);d&&this.addElementByRule(e,c,d,c.consuming===!1?l:void 0)}this.localPreserveWS=n}leafFallback(e,t){e.nodeName=="BR"&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(e.ownerDocument.createTextNode(`
`),t)}ignoreFallback(e,t){e.nodeName=="BR"&&(!this.top.type||!this.top.type.inlineContent)&&this.findPlace(this.parser.schema.text("-"),t,!0)}readStyles(e,t){let s=e.style;if(s&&s.length)for(let n=0;n<this.parser.matchedStyles.length;n++){let i=this.parser.matchedStyles[n],a=s.getPropertyValue(i);if(a)for(let l=void 0;;){let c=this.parser.matchStyle(i,a,this,l);if(!c)break;if(c.ignore)return null;if(c.clearMark?t=t.filter(d=>!c.clearMark(d)):t=t.concat(this.parser.schema.marks[c.mark].create(c.attrs)),c.consuming===!1)l=c;else break}}return t}addElementByRule(e,t,s,n){let i,a;if(t.node)if(a=this.parser.schema.nodes[t.node],a.isLeaf)this.insertNode(a.create(t.attrs),s,e.nodeName=="BR")||this.leafFallback(e,s);else{let c=this.enter(a,t.attrs||null,s,t.preserveWhitespace);c&&(i=!0,s=c)}else{let c=this.parser.schema.marks[t.mark];s=s.concat(c.create(t.attrs))}let l=this.top;if(a&&a.isLeaf)this.findInside(e);else if(n)this.addElement(e,s,n);else if(t.getContent)this.findInside(e),t.getContent(e,this.parser.schema).forEach(c=>this.insertNode(c,s,!1));else{let c=e;typeof t.contentElement=="string"?c=e.querySelector(t.contentElement):typeof t.contentElement=="function"?c=t.contentElement(e):t.contentElement&&(c=t.contentElement),this.findAround(e,c,!0),this.addAll(c,s),this.findAround(e,c,!1)}i&&this.sync(l)&&this.open--}addAll(e,t,s,n){let i=s||0;for(let a=s?e.childNodes[s]:e.firstChild,l=n==null?null:e.childNodes[n];a!=l;a=a.nextSibling,++i)this.findAtPoint(e,i),this.addDOM(a,t);this.findAtPoint(e,i)}findPlace(e,t,s){let n,i;for(let a=this.open,l=0;a>=0;a--){let c=this.nodes[a],d=c.findWrapping(e);if(d&&(!n||n.length>d.length+l)&&(n=d,i=c,!d.length))break;if(c.solid){if(s)break;l+=2}}if(!n)return null;this.sync(i);for(let a=0;a<n.length;a++)t=this.enterInner(n[a],null,t,!1);return t}insertNode(e,t,s){if(e.isInline&&this.needsBlock&&!this.top.type){let i=this.textblockFromContext();i&&(t=this.enterInner(i,null,t))}let n=this.findPlace(e,t,s);if(n){this.closeExtra();let i=this.top;i.match&&(i.match=i.match.matchType(e.type));let a=Ae.none;for(let l of n.concat(e.marks))(i.type?i.type.allowsMarkType(l.type):md(l.type,e.type))&&(a=l.addToSet(a));return i.content.push(e.mark(a)),!0}return!1}enter(e,t,s,n){let i=this.findPlace(e.create(t),s,!1);return i&&(i=this.enterInner(e,t,s,!0,n)),i}enterInner(e,t,s,n=!1,i){this.closeExtra();let a=this.top;a.match=a.match&&a.match.matchType(e);let l=hd(e,i,a.options);a.options&mn&&a.content.length==0&&(l|=mn);let c=Ae.none;return s=s.filter(d=>(a.type?a.type.allowsMarkType(d.type):md(d.type,e))?(c=d.addToSet(c),!1):!0),this.nodes.push(new ti(e,t,c,n,null,l)),this.open++,s}closeExtra(e=!1){let t=this.nodes.length-1;if(t>this.open){for(;t>this.open;t--)this.nodes[t-1].content.push(this.nodes[t].finish(e));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(!!(this.isOpen||this.options.topOpen))}sync(e){for(let t=this.open;t>=0;t--){if(this.nodes[t]==e)return this.open=t,!0;this.localPreserveWS&&(this.nodes[t].options|=An)}return!1}get currentPos(){this.closeExtra();let e=0;for(let t=this.open;t>=0;t--){let s=this.nodes[t].content;for(let n=s.length-1;n>=0;n--)e+=s[n].nodeSize;t&&e++}return e}findAtPoint(e,t){if(this.find)for(let s=0;s<this.find.length;s++)this.find[s].node==e&&this.find[s].offset==t&&(this.find[s].pos=this.currentPos)}findInside(e){if(this.find)for(let t=0;t<this.find.length;t++)this.find[t].pos==null&&e.nodeType==1&&e.contains(this.find[t].node)&&(this.find[t].pos=this.currentPos)}findAround(e,t,s){if(e!=t&&this.find)for(let n=0;n<this.find.length;n++)this.find[n].pos==null&&e.nodeType==1&&e.contains(this.find[n].node)&&t.compareDocumentPosition(this.find[n].node)&(s?2:4)&&(this.find[n].pos=this.currentPos)}findInText(e){if(this.find)for(let t=0;t<this.find.length;t++)this.find[t].node==e&&(this.find[t].pos=this.currentPos-(e.nodeValue.length-this.find[t].offset))}matchesContext(e){if(e.indexOf("|")>-1)return e.split(/\s*\|\s*/).some(this.matchesContext,this);let t=e.split("/"),s=this.options.context,n=!this.isOpen&&(!s||s.parent.type==this.nodes[0].type),i=-(s?s.depth+1:0)+(n?0:1),a=(l,c)=>{for(;l>=0;l--){let d=t[l];if(d==""){if(l==t.length-1||l==0)continue;for(;c>=i;c--)if(a(l-1,c))return!0;return!1}else{let u=c>0||c==0&&n?this.nodes[c].type:s&&c>=i?s.node(c-i).type:null;if(!u||u.name!=d&&!u.isInGroup(d))return!1;c--}}return!0};return a(t.length-1,this.open)}textblockFromContext(){let e=this.options.context;if(e)for(let t=e.depth;t>=0;t--){let s=e.node(t).contentMatchAt(e.indexAfter(t)).defaultType;if(s&&s.isTextblock&&s.defaultAttrs)return s}for(let t in this.parser.schema.nodes){let s=this.parser.schema.nodes[t];if(s.isTextblock&&s.defaultAttrs)return s}}}function iw(r){for(let e=r.firstChild,t=null;e;e=e.nextSibling){let s=e.nodeType==1?e.nodeName.toLowerCase():null;s&&Af.hasOwnProperty(s)&&t?(t.appendChild(e),e=t):s=="li"?t=e:s&&(t=null)}}function ow(r,e){return(r.matches||r.msMatchesSelector||r.webkitMatchesSelector||r.mozMatchesSelector).call(r,e)}function pd(r){let e={};for(let t in r)e[t]=r[t];return e}function md(r,e){let t=e.schema.nodes;for(let s in t){let n=t[s];if(!n.allowsMarkType(r))continue;let i=[],a=l=>{i.push(l);for(let c=0;c<l.edgeCount;c++){let{type:d,next:u}=l.edge(c);if(d==e||i.indexOf(u)<0&&a(u))return!0}};if(a(n.contentMatch))return!0}}class js{constructor(e,t){this.nodes=e,this.marks=t}serializeFragment(e,t={},s){s||(s=da(t).createDocumentFragment());let n=s,i=[];return e.forEach(a=>{if(i.length||a.marks.length){let l=0,c=0;for(;l<i.length&&c<a.marks.length;){let d=a.marks[c];if(!this.marks[d.type.name]){c++;continue}if(!d.eq(i[l][0])||d.type.spec.spanning===!1)break;l++,c++}for(;l<i.length;)n=i.pop()[1];for(;c<a.marks.length;){let d=a.marks[c++],u=this.serializeMark(d,a.isInline,t);u&&(i.push([d,n]),n.appendChild(u.dom),n=u.contentDOM||u.dom)}}n.appendChild(this.serializeNodeInner(a,t))}),s}serializeNodeInner(e,t){let{dom:s,contentDOM:n}=wi(da(t),this.nodes[e.type.name](e),null,e.attrs);if(n){if(e.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");this.serializeFragment(e.content,t,n)}return s}serializeNode(e,t={}){let s=this.serializeNodeInner(e,t);for(let n=e.marks.length-1;n>=0;n--){let i=this.serializeMark(e.marks[n],e.isInline,t);i&&((i.contentDOM||i.dom).appendChild(s),s=i.dom)}return s}serializeMark(e,t,s={}){let n=this.marks[e.type.name];return n&&wi(da(s),n(e,t),null,e.attrs)}static renderSpec(e,t,s=null,n){return wi(e,t,s,n)}static fromSchema(e){return e.cached.domSerializer||(e.cached.domSerializer=new js(this.nodesFromSchema(e),this.marksFromSchema(e)))}static nodesFromSchema(e){let t=gd(e.nodes);return t.text||(t.text=s=>s.text),t}static marksFromSchema(e){return gd(e.marks)}}function gd(r){let e={};for(let t in r){let s=r[t].spec.toDOM;s&&(e[t]=s)}return e}function da(r){return r.document||window.document}const xd=new WeakMap;function aw(r){let e=xd.get(r);return e===void 0&&xd.set(r,e=lw(r)),e}function lw(r){let e=null;function t(s){if(s&&typeof s=="object")if(Array.isArray(s))if(typeof s[0]=="string")e||(e=[]),e.push(s);else for(let n=0;n<s.length;n++)t(s[n]);else for(let n in s)t(s[n])}return t(r),e}function wi(r,e,t,s){if(typeof e=="string")return{dom:r.createTextNode(e)};if(e.nodeType!=null)return{dom:e};if(e.dom&&e.dom.nodeType!=null)return e;let n=e[0],i;if(typeof n!="string")throw new RangeError("Invalid array passed to renderSpec");if(s&&(i=aw(s))&&i.indexOf(e)>-1)throw new RangeError("Using an array from an attribute object as a DOM spec. This may be an attempted cross site scripting attack.");let a=n.indexOf(" ");a>0&&(t=n.slice(0,a),n=n.slice(a+1));let l,c=t?r.createElementNS(t,n):r.createElement(n),d=e[1],u=1;if(d&&typeof d=="object"&&d.nodeType==null&&!Array.isArray(d)){u=2;for(let h in d)if(d[h]!=null){let f=h.indexOf(" ");f>0?c.setAttributeNS(h.slice(0,f),h.slice(f+1),d[h]):c.setAttribute(h,d[h])}}for(let h=u;h<e.length;h++){let f=e[h];if(f===0){if(h<e.length-1||h>u)throw new RangeError("Content hole must be the only child of its parent node");return{dom:c,contentDOM:c}}else{let{dom:p,contentDOM:m}=wi(r,f,t,s);if(c.appendChild(p),m){if(l)throw new RangeError("Multiple content holes");l=m}}}return{dom:c,contentDOM:l}}const Cf=65535,Mf=Math.pow(2,16);function cw(r,e){return r+e*Mf}function yd(r){return r&Cf}function dw(r){return(r-(r&Cf))/Mf}const Df=1,Tf=2,vi=4,Of=8;class ol{constructor(e,t,s){this.pos=e,this.delInfo=t,this.recover=s}get deleted(){return(this.delInfo&Of)>0}get deletedBefore(){return(this.delInfo&(Df|vi))>0}get deletedAfter(){return(this.delInfo&(Tf|vi))>0}get deletedAcross(){return(this.delInfo&vi)>0}}class wt{constructor(e,t=!1){if(this.ranges=e,this.inverted=t,!e.length&&wt.empty)return wt.empty}recover(e){let t=0,s=yd(e);if(!this.inverted)for(let n=0;n<s;n++)t+=this.ranges[n*3+2]-this.ranges[n*3+1];return this.ranges[s*3]+t+dw(e)}mapResult(e,t=1){return this._map(e,t,!1)}map(e,t=1){return this._map(e,t,!0)}_map(e,t,s){let n=0,i=this.inverted?2:1,a=this.inverted?1:2;for(let l=0;l<this.ranges.length;l+=3){let c=this.ranges[l]-(this.inverted?n:0);if(c>e)break;let d=this.ranges[l+i],u=this.ranges[l+a],h=c+d;if(e<=h){let f=d?e==c?-1:e==h?1:t:t,p=c+n+(f<0?0:u);if(s)return p;let m=e==(t<0?c:h)?null:cw(l/3,e-c),g=e==c?Tf:e==h?Df:vi;return(t<0?e!=c:e!=h)&&(g|=Of),new ol(p,g,m)}n+=u-d}return s?e+n:new ol(e+n,0,null)}touches(e,t){let s=0,n=yd(t),i=this.inverted?2:1,a=this.inverted?1:2;for(let l=0;l<this.ranges.length;l+=3){let c=this.ranges[l]-(this.inverted?s:0);if(c>e)break;let d=this.ranges[l+i],u=c+d;if(e<=u&&l==n*3)return!0;s+=this.ranges[l+a]-d}return!1}forEach(e){let t=this.inverted?2:1,s=this.inverted?1:2;for(let n=0,i=0;n<this.ranges.length;n+=3){let a=this.ranges[n],l=a-(this.inverted?i:0),c=a+(this.inverted?0:i),d=this.ranges[n+t],u=this.ranges[n+s];e(l,l+d,c,c+u),i+=u-d}}invert(){return new wt(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(e){return e==0?wt.empty:new wt(e<0?[0,-e,0]:[0,0,e])}}wt.empty=new wt([]);class Cn{constructor(e,t,s=0,n=e?e.length:0){this.mirror=t,this.from=s,this.to=n,this._maps=e||[],this.ownData=!(e||t)}get maps(){return this._maps}slice(e=0,t=this.maps.length){return new Cn(this._maps,this.mirror,e,t)}appendMap(e,t){this.ownData||(this._maps=this._maps.slice(),this.mirror=this.mirror&&this.mirror.slice(),this.ownData=!0),this.to=this._maps.push(e),t!=null&&this.setMirror(this._maps.length-1,t)}appendMapping(e){for(let t=0,s=this._maps.length;t<e._maps.length;t++){let n=e.getMirror(t);this.appendMap(e._maps[t],n!=null&&n<t?s+n:void 0)}}getMirror(e){if(this.mirror){for(let t=0;t<this.mirror.length;t++)if(this.mirror[t]==e)return this.mirror[t+(t%2?-1:1)]}}setMirror(e,t){this.mirror||(this.mirror=[]),this.mirror.push(e,t)}appendMappingInverted(e){for(let t=e.maps.length-1,s=this._maps.length+e._maps.length;t>=0;t--){let n=e.getMirror(t);this.appendMap(e._maps[t].invert(),n!=null&&n>t?s-n-1:void 0)}}invert(){let e=new Cn;return e.appendMappingInverted(this),e}map(e,t=1){if(this.mirror)return this._map(e,t,!0);for(let s=this.from;s<this.to;s++)e=this._maps[s].map(e,t);return e}mapResult(e,t=1){return this._map(e,t,!1)}_map(e,t,s){let n=0;for(let i=this.from;i<this.to;i++){let a=this._maps[i],l=a.mapResult(e,t);if(l.recover!=null){let c=this.getMirror(i);if(c!=null&&c>i&&c<this.to){i=c,e=this._maps[c].recover(l.recover);continue}}n|=l.delInfo,e=l.pos}return s?e:new ol(e,n,null)}}const ua=Object.create(null);class it{getMap(){return wt.empty}merge(e){return null}static fromJSON(e,t){if(!t||!t.stepType)throw new RangeError("Invalid input for Step.fromJSON");let s=ua[t.stepType];if(!s)throw new RangeError(`No step type ${t.stepType} defined`);return s.fromJSON(e,t)}static jsonID(e,t){if(e in ua)throw new RangeError("Duplicate use of step JSON ID "+e);return ua[e]=t,t.prototype.jsonID=e,t}}class Be{constructor(e,t){this.doc=e,this.failed=t}static ok(e){return new Be(e,null)}static fail(e){return new Be(null,e)}static fromReplace(e,t,s,n){try{return Be.ok(e.replace(t,s,n))}catch(i){if(i instanceof Fi)return Be.fail(i.message);throw i}}}function Zl(r,e,t){let s=[];for(let n=0;n<r.childCount;n++){let i=r.child(n);i.content.size&&(i=i.copy(Zl(i.content,e,i))),i.isInline&&(i=e(i,t,n)),s.push(i)}return z.fromArray(s)}class wr extends it{constructor(e,t,s){super(),this.from=e,this.to=t,this.mark=s}apply(e){let t=e.slice(this.from,this.to),s=e.resolve(this.from),n=s.node(s.sharedDepth(this.to)),i=new Q(Zl(t.content,(a,l)=>!a.isAtom||!l.type.allowsMarkType(this.mark.type)?a:a.mark(this.mark.addToSet(a.marks)),n),t.openStart,t.openEnd);return Be.fromReplace(e,this.from,this.to,i)}invert(){return new Ut(this.from,this.to,this.mark)}map(e){let t=e.mapResult(this.from,1),s=e.mapResult(this.to,-1);return t.deleted&&s.deleted||t.pos>=s.pos?null:new wr(t.pos,s.pos,this.mark)}merge(e){return e instanceof wr&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new wr(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number")throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new wr(t.from,t.to,e.markFromJSON(t.mark))}}it.jsonID("addMark",wr);class Ut extends it{constructor(e,t,s){super(),this.from=e,this.to=t,this.mark=s}apply(e){let t=e.slice(this.from,this.to),s=new Q(Zl(t.content,n=>n.mark(this.mark.removeFromSet(n.marks)),e),t.openStart,t.openEnd);return Be.fromReplace(e,this.from,this.to,s)}invert(){return new wr(this.from,this.to,this.mark)}map(e){let t=e.mapResult(this.from,1),s=e.mapResult(this.to,-1);return t.deleted&&s.deleted||t.pos>=s.pos?null:new Ut(t.pos,s.pos,this.mark)}merge(e){return e instanceof Ut&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new Ut(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number")throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new Ut(t.from,t.to,e.markFromJSON(t.mark))}}it.jsonID("removeMark",Ut);class vr extends it{constructor(e,t){super(),this.pos=e,this.mark=t}apply(e){let t=e.nodeAt(this.pos);if(!t)return Be.fail("No node at mark step's position");let s=t.type.create(t.attrs,null,this.mark.addToSet(t.marks));return Be.fromReplace(e,this.pos,this.pos+1,new Q(z.from(s),0,t.isLeaf?0:1))}invert(e){let t=e.nodeAt(this.pos);if(t){let s=this.mark.addToSet(t.marks);if(s.length==t.marks.length){for(let n=0;n<t.marks.length;n++)if(!t.marks[n].isInSet(s))return new vr(this.pos,t.marks[n]);return new vr(this.pos,this.mark)}}return new ms(this.pos,this.mark)}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new vr(t.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,t){if(typeof t.pos!="number")throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new vr(t.pos,e.markFromJSON(t.mark))}}it.jsonID("addNodeMark",vr);class ms extends it{constructor(e,t){super(),this.pos=e,this.mark=t}apply(e){let t=e.nodeAt(this.pos);if(!t)return Be.fail("No node at mark step's position");let s=t.type.create(t.attrs,null,this.mark.removeFromSet(t.marks));return Be.fromReplace(e,this.pos,this.pos+1,new Q(z.from(s),0,t.isLeaf?0:1))}invert(e){let t=e.nodeAt(this.pos);return!t||!this.mark.isInSet(t.marks)?this:new vr(this.pos,this.mark)}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new ms(t.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,t){if(typeof t.pos!="number")throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new ms(t.pos,e.markFromJSON(t.mark))}}it.jsonID("removeNodeMark",ms);class He extends it{constructor(e,t,s,n=!1){super(),this.from=e,this.to=t,this.slice=s,this.structure=n}apply(e){return this.structure&&al(e,this.from,this.to)?Be.fail("Structure replace would overwrite content"):Be.fromReplace(e,this.from,this.to,this.slice)}getMap(){return new wt([this.from,this.to-this.from,this.slice.size])}invert(e){return new He(this.from,this.from+this.slice.size,e.slice(this.from,this.to))}map(e){let t=e.mapResult(this.from,1),s=e.mapResult(this.to,-1);return t.deletedAcross&&s.deletedAcross?null:new He(t.pos,Math.max(t.pos,s.pos),this.slice,this.structure)}merge(e){if(!(e instanceof He)||e.structure||this.structure)return null;if(this.from+this.slice.size==e.from&&!this.slice.openEnd&&!e.slice.openStart){let t=this.slice.size+e.slice.size==0?Q.empty:new Q(this.slice.content.append(e.slice.content),this.slice.openStart,e.slice.openEnd);return new He(this.from,this.to+(e.to-e.from),t,this.structure)}else if(e.to==this.from&&!this.slice.openStart&&!e.slice.openEnd){let t=this.slice.size+e.slice.size==0?Q.empty:new Q(e.slice.content.append(this.slice.content),e.slice.openStart,this.slice.openEnd);return new He(e.from,this.to,t,this.structure)}else return null}toJSON(){let e={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number")throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new He(t.from,t.to,Q.fromJSON(e,t.slice),!!t.structure)}}it.jsonID("replace",He);class Ke extends it{constructor(e,t,s,n,i,a,l=!1){super(),this.from=e,this.to=t,this.gapFrom=s,this.gapTo=n,this.slice=i,this.insert=a,this.structure=l}apply(e){if(this.structure&&(al(e,this.from,this.gapFrom)||al(e,this.gapTo,this.to)))return Be.fail("Structure gap-replace would overwrite content");let t=e.slice(this.gapFrom,this.gapTo);if(t.openStart||t.openEnd)return Be.fail("Gap is not a flat range");let s=this.slice.insertAt(this.insert,t.content);return s?Be.fromReplace(e,this.from,this.to,s):Be.fail("Content does not fit in gap")}getMap(){return new wt([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(e){let t=this.gapTo-this.gapFrom;return new Ke(this.from,this.from+this.slice.size+t,this.from+this.insert,this.from+this.insert+t,e.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(e){let t=e.mapResult(this.from,1),s=e.mapResult(this.to,-1),n=this.from==this.gapFrom?t.pos:e.map(this.gapFrom,-1),i=this.to==this.gapTo?s.pos:e.map(this.gapTo,1);return t.deletedAcross&&s.deletedAcross||n<t.pos||i>s.pos?null:new Ke(t.pos,s.pos,n,i,this.slice,this.insert,this.structure)}toJSON(){let e={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number"||typeof t.gapFrom!="number"||typeof t.gapTo!="number"||typeof t.insert!="number")throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new Ke(t.from,t.to,t.gapFrom,t.gapTo,Q.fromJSON(e,t.slice),t.insert,!!t.structure)}}it.jsonID("replaceAround",Ke);function al(r,e,t){let s=r.resolve(e),n=t-e,i=s.depth;for(;n>0&&i>0&&s.indexAfter(i)==s.node(i).childCount;)i--,n--;if(n>0){let a=s.node(i).maybeChild(s.indexAfter(i));for(;n>0;){if(!a||a.isLeaf)return!0;a=a.firstChild,n--}}return!1}function uw(r,e,t,s){let n=[],i=[],a,l;r.doc.nodesBetween(e,t,(c,d,u)=>{if(!c.isInline)return;let h=c.marks;if(!s.isInSet(h)&&u.type.allowsMarkType(s.type)){let f=Math.max(d,e),p=Math.min(d+c.nodeSize,t),m=s.addToSet(h);for(let g=0;g<h.length;g++)h[g].isInSet(m)||(a&&a.to==f&&a.mark.eq(h[g])?a.to=p:n.push(a=new Ut(f,p,h[g])));l&&l.to==f?l.to=p:i.push(l=new wr(f,p,s))}}),n.forEach(c=>r.step(c)),i.forEach(c=>r.step(c))}function hw(r,e,t,s){let n=[],i=0;r.doc.nodesBetween(e,t,(a,l)=>{if(!a.isInline)return;i++;let c=null;if(s instanceof Fo){let d=a.marks,u;for(;u=s.isInSet(d);)(c||(c=[])).push(u),d=u.removeFromSet(d)}else s?s.isInSet(a.marks)&&(c=[s]):c=a.marks;if(c&&c.length){let d=Math.min(l+a.nodeSize,t);for(let u=0;u<c.length;u++){let h=c[u],f;for(let p=0;p<n.length;p++){let m=n[p];m.step==i-1&&h.eq(n[p].style)&&(f=m)}f?(f.to=d,f.step=i):n.push({style:h,from:Math.max(l,e),to:d,step:i})}}}),n.forEach(a=>r.step(new Ut(a.from,a.to,a.style)))}function ec(r,e,t,s=t.contentMatch,n=!0){let i=r.doc.nodeAt(e),a=[],l=e+1;for(let c=0;c<i.childCount;c++){let d=i.child(c),u=l+d.nodeSize,h=s.matchType(d.type);if(!h)a.push(new He(l,u,Q.empty));else{s=h;for(let f=0;f<d.marks.length;f++)t.allowsMarkType(d.marks[f].type)||r.step(new Ut(l,u,d.marks[f]));if(n&&d.isText&&t.whitespace!="pre"){let f,p=/\r?\n|\r/g,m;for(;f=p.exec(d.text);)m||(m=new Q(z.from(t.schema.text(" ",t.allowedMarks(d.marks))),0,0)),a.push(new He(l+f.index,l+f.index+f[0].length,m))}}l=u}if(!s.validEnd){let c=s.fillBefore(z.empty,!0);r.replace(l,l,new Q(c,0,0))}for(let c=a.length-1;c>=0;c--)r.step(a[c])}function fw(r,e,t){return(e==0||r.canReplace(e,r.childCount))&&(t==r.childCount||r.canReplace(0,t))}function Zs(r){let t=r.parent.content.cutByIndex(r.startIndex,r.endIndex);for(let s=r.depth;;--s){let n=r.$from.node(s),i=r.$from.index(s),a=r.$to.indexAfter(s);if(s<r.depth&&n.canReplace(i,a,t))return s;if(s==0||n.type.spec.isolating||!fw(n,i,a))break}return null}function pw(r,e,t){let{$from:s,$to:n,depth:i}=e,a=s.before(i+1),l=n.after(i+1),c=a,d=l,u=z.empty,h=0;for(let m=i,g=!1;m>t;m--)g||s.index(m)>0?(g=!0,u=z.from(s.node(m).copy(u)),h++):c--;let f=z.empty,p=0;for(let m=i,g=!1;m>t;m--)g||n.after(m+1)<n.end(m)?(g=!0,f=z.from(n.node(m).copy(f)),p++):d++;r.step(new Ke(c,d,a,l,new Q(u.append(f),h,p),u.size-h,!0))}function tc(r,e,t=null,s=r){let n=mw(r,e),i=n&&gw(s,e);return i?n.map(bd).concat({type:e,attrs:t}).concat(i.map(bd)):null}function bd(r){return{type:r,attrs:null}}function mw(r,e){let{parent:t,startIndex:s,endIndex:n}=r,i=t.contentMatchAt(s).findWrapping(e);if(!i)return null;let a=i.length?i[0]:e;return t.canReplaceWith(s,n,a)?i:null}function gw(r,e){let{parent:t,startIndex:s,endIndex:n}=r,i=t.child(s),a=e.contentMatch.findWrapping(i.type);if(!a)return null;let c=(a.length?a[a.length-1]:e).contentMatch;for(let d=s;c&&d<n;d++)c=c.matchType(t.child(d).type);return!c||!c.validEnd?null:a}function xw(r,e,t){let s=z.empty;for(let a=t.length-1;a>=0;a--){if(s.size){let l=t[a].type.contentMatch.matchFragment(s);if(!l||!l.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}s=z.from(t[a].type.create(t[a].attrs,s))}let n=e.start,i=e.end;r.step(new Ke(n,i,n,i,new Q(s,0,0),t.length,!0))}function yw(r,e,t,s,n){if(!s.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");let i=r.steps.length;r.doc.nodesBetween(e,t,(a,l)=>{let c=typeof n=="function"?n(a):n;if(a.isTextblock&&!a.hasMarkup(s,c)&&bw(r.doc,r.mapping.slice(i).map(l),s)){let d=null;if(s.schema.linebreakReplacement){let p=s.whitespace=="pre",m=!!s.contentMatch.matchType(s.schema.linebreakReplacement);p&&!m?d=!1:!p&&m&&(d=!0)}d===!1&&If(r,a,l,i),ec(r,r.mapping.slice(i).map(l,1),s,void 0,d===null);let u=r.mapping.slice(i),h=u.map(l,1),f=u.map(l+a.nodeSize,1);return r.step(new Ke(h,f,h+1,f-1,new Q(z.from(s.create(c,null,a.marks)),0,0),1,!0)),d===!0&&Rf(r,a,l,i),!1}})}function Rf(r,e,t,s){e.forEach((n,i)=>{if(n.isText){let a,l=/\r?\n|\r/g;for(;a=l.exec(n.text);){let c=r.mapping.slice(s).map(t+1+i+a.index);r.replaceWith(c,c+1,e.type.schema.linebreakReplacement.create())}}})}function If(r,e,t,s){e.forEach((n,i)=>{if(n.type==n.type.schema.linebreakReplacement){let a=r.mapping.slice(s).map(t+1+i);r.replaceWith(a,a+1,e.type.schema.text(`
`))}})}function bw(r,e,t){let s=r.resolve(e),n=s.index();return s.parent.canReplaceWith(n,n+1,t)}function ww(r,e,t,s,n){let i=r.doc.nodeAt(e);if(!i)throw new RangeError("No node at given position");t||(t=i.type);let a=t.create(s,null,n||i.marks);if(i.isLeaf)return r.replaceWith(e,e+i.nodeSize,a);if(!t.validContent(i.content))throw new RangeError("Invalid content for node type "+t.name);r.step(new Ke(e,e+i.nodeSize,e+1,e+i.nodeSize-1,new Q(z.from(a),0,0),1,!0))}function nr(r,e,t=1,s){let n=r.resolve(e),i=n.depth-t,a=s&&s[s.length-1]||n.parent;if(i<0||n.parent.type.spec.isolating||!n.parent.canReplace(n.index(),n.parent.childCount)||!a.type.validContent(n.parent.content.cutByIndex(n.index(),n.parent.childCount)))return!1;for(let d=n.depth-1,u=t-2;d>i;d--,u--){let h=n.node(d),f=n.index(d);if(h.type.spec.isolating)return!1;let p=h.content.cutByIndex(f,h.childCount),m=s&&s[u+1];m&&(p=p.replaceChild(0,m.type.create(m.attrs)));let g=s&&s[u]||h;if(!h.canReplace(f+1,h.childCount)||!g.type.validContent(p))return!1}let l=n.indexAfter(i),c=s&&s[0];return n.node(i).canReplaceWith(l,l,c?c.type:n.node(i+1).type)}function vw(r,e,t=1,s){let n=r.doc.resolve(e),i=z.empty,a=z.empty;for(let l=n.depth,c=n.depth-t,d=t-1;l>c;l--,d--){i=z.from(n.node(l).copy(i));let u=s&&s[d];a=z.from(u?u.type.create(u.attrs,a):n.node(l).copy(a))}r.step(new He(e,e,new Q(i.append(a),t,t),!0))}function Pr(r,e){let t=r.resolve(e),s=t.index();return Pf(t.nodeBefore,t.nodeAfter)&&t.parent.canReplace(s,s+1)}function Nw(r,e){e.content.size||r.type.compatibleContent(e.type);let t=r.contentMatchAt(r.childCount),{linebreakReplacement:s}=r.type.schema;for(let n=0;n<e.childCount;n++){let i=e.child(n),a=i.type==s?r.type.schema.nodes.text:i.type;if(t=t.matchType(a),!t||!r.type.allowsMarks(i.marks))return!1}return t.validEnd}function Pf(r,e){return!!(r&&e&&!r.isLeaf&&Nw(r,e))}function Bo(r,e,t=-1){let s=r.resolve(e);for(let n=s.depth;;n--){let i,a,l=s.index(n);if(n==s.depth?(i=s.nodeBefore,a=s.nodeAfter):t>0?(i=s.node(n+1),l++,a=s.node(n).maybeChild(l)):(i=s.node(n).maybeChild(l-1),a=s.node(n+1)),i&&!i.isTextblock&&Pf(i,a)&&s.node(n).canReplace(l,l+1))return e;if(n==0)break;e=t<0?s.before(n):s.after(n)}}function jw(r,e,t){let s=null,{linebreakReplacement:n}=r.doc.type.schema,i=r.doc.resolve(e-t),a=i.node().type;if(n&&a.inlineContent){let u=a.whitespace=="pre",h=!!a.contentMatch.matchType(n);u&&!h?s=!1:!u&&h&&(s=!0)}let l=r.steps.length;if(s===!1){let u=r.doc.resolve(e+t);If(r,u.node(),u.before(),l)}a.inlineContent&&ec(r,e+t-1,a,i.node().contentMatchAt(i.index()),s==null);let c=r.mapping.slice(l),d=c.map(e-t);if(r.step(new He(d,c.map(e+t,-1),Q.empty,!0)),s===!0){let u=r.doc.resolve(d);Rf(r,u.node(),u.before(),r.steps.length)}return r}function kw(r,e,t){let s=r.resolve(e);if(s.parent.canReplaceWith(s.index(),s.index(),t))return e;if(s.parentOffset==0)for(let n=s.depth-1;n>=0;n--){let i=s.index(n);if(s.node(n).canReplaceWith(i,i,t))return s.before(n+1);if(i>0)return null}if(s.parentOffset==s.parent.content.size)for(let n=s.depth-1;n>=0;n--){let i=s.indexAfter(n);if(s.node(n).canReplaceWith(i,i,t))return s.after(n+1);if(i<s.node(n).childCount)return null}return null}function Lf(r,e,t){let s=r.resolve(e);if(!t.content.size)return e;let n=t.content;for(let i=0;i<t.openStart;i++)n=n.firstChild.content;for(let i=1;i<=(t.openStart==0&&t.size?2:1);i++)for(let a=s.depth;a>=0;a--){let l=a==s.depth?0:s.pos<=(s.start(a+1)+s.end(a+1))/2?-1:1,c=s.index(a)+(l>0?1:0),d=s.node(a),u=!1;if(i==1)u=d.canReplace(c,c,n);else{let h=d.contentMatchAt(c).findWrapping(n.firstChild.type);u=h&&d.canReplaceWith(c,c,h[0])}if(u)return l==0?s.pos:l<0?s.before(a+1):s.after(a+1)}return null}function Uo(r,e,t=e,s=Q.empty){if(e==t&&!s.size)return null;let n=r.resolve(e),i=r.resolve(t);return $f(n,i,s)?new He(e,t,s):new Sw(n,i,s).fit()}function $f(r,e,t){return!t.openStart&&!t.openEnd&&r.start()==e.start()&&r.parent.canReplace(r.index(),e.index(),t.content)}class Sw{constructor(e,t,s){this.$from=e,this.$to=t,this.unplaced=s,this.frontier=[],this.placed=z.empty;for(let n=0;n<=e.depth;n++){let i=e.node(n);this.frontier.push({type:i.type,match:i.contentMatchAt(e.indexAfter(n))})}for(let n=e.depth;n>0;n--)this.placed=z.from(e.node(n).copy(this.placed))}get depth(){return this.frontier.length-1}fit(){for(;this.unplaced.size;){let d=this.findFittable();d?this.placeNodes(d):this.openMore()||this.dropNode()}let e=this.mustMoveInline(),t=this.placed.size-this.depth-this.$from.depth,s=this.$from,n=this.close(e<0?this.$to:s.doc.resolve(e));if(!n)return null;let i=this.placed,a=s.depth,l=n.depth;for(;a&&l&&i.childCount==1;)i=i.firstChild.content,a--,l--;let c=new Q(i,a,l);return e>-1?new Ke(s.pos,e,this.$to.pos,this.$to.end(),c,t):c.size||s.pos!=this.$to.pos?new He(s.pos,n.pos,c):null}findFittable(){let e=this.unplaced.openStart;for(let t=this.unplaced.content,s=0,n=this.unplaced.openEnd;s<e;s++){let i=t.firstChild;if(t.childCount>1&&(n=0),i.type.spec.isolating&&n<=s){e=s;break}t=i.content}for(let t=1;t<=2;t++)for(let s=t==1?e:this.unplaced.openStart;s>=0;s--){let n,i=null;s?(i=ha(this.unplaced.content,s-1).firstChild,n=i.content):n=this.unplaced.content;let a=n.firstChild;for(let l=this.depth;l>=0;l--){let{type:c,match:d}=this.frontier[l],u,h=null;if(t==1&&(a?d.matchType(a.type)||(h=d.fillBefore(z.from(a),!1)):i&&c.compatibleContent(i.type)))return{sliceDepth:s,frontierDepth:l,parent:i,inject:h};if(t==2&&a&&(u=d.findWrapping(a.type)))return{sliceDepth:s,frontierDepth:l,parent:i,wrap:u};if(i&&d.matchType(i.type))break}}}openMore(){let{content:e,openStart:t,openEnd:s}=this.unplaced,n=ha(e,t);return!n.childCount||n.firstChild.isLeaf?!1:(this.unplaced=new Q(e,t+1,Math.max(s,n.size+t>=e.size-s?t+1:0)),!0)}dropNode(){let{content:e,openStart:t,openEnd:s}=this.unplaced,n=ha(e,t);if(n.childCount<=1&&t>0){let i=e.size-t<=t+n.size;this.unplaced=new Q(ln(e,t-1,1),t-1,i?t-1:s)}else this.unplaced=new Q(ln(e,t,1),t,s)}placeNodes({sliceDepth:e,frontierDepth:t,parent:s,inject:n,wrap:i}){for(;this.depth>t;)this.closeFrontierNode();if(i)for(let g=0;g<i.length;g++)this.openFrontierNode(i[g]);let a=this.unplaced,l=s?s.content:a.content,c=a.openStart-e,d=0,u=[],{match:h,type:f}=this.frontier[t];if(n){for(let g=0;g<n.childCount;g++)u.push(n.child(g));h=h.matchFragment(n)}let p=l.size+e-(a.content.size-a.openEnd);for(;d<l.childCount;){let g=l.child(d),y=h.matchType(g.type);if(!y)break;d++,(d>1||c==0||g.content.size)&&(h=y,u.push(_f(g.mark(f.allowedMarks(g.marks)),d==1?c:0,d==l.childCount?p:-1)))}let m=d==l.childCount;m||(p=-1),this.placed=cn(this.placed,t,z.from(u)),this.frontier[t].match=h,m&&p<0&&s&&s.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(let g=0,y=l;g<p;g++){let x=y.lastChild;this.frontier.push({type:x.type,match:x.contentMatchAt(x.childCount)}),y=x.content}this.unplaced=m?e==0?Q.empty:new Q(ln(a.content,e-1,1),e-1,p<0?a.openEnd:e-1):new Q(ln(a.content,e,d),a.openStart,a.openEnd)}mustMoveInline(){if(!this.$to.parent.isTextblock)return-1;let e=this.frontier[this.depth],t;if(!e.type.isTextblock||!fa(this.$to,this.$to.depth,e.type,e.match,!1)||this.$to.depth==this.depth&&(t=this.findCloseLevel(this.$to))&&t.depth==this.depth)return-1;let{depth:s}=this.$to,n=this.$to.after(s);for(;s>1&&n==this.$to.end(--s);)++n;return n}findCloseLevel(e){e:for(let t=Math.min(this.depth,e.depth);t>=0;t--){let{match:s,type:n}=this.frontier[t],i=t<e.depth&&e.end(t+1)==e.pos+(e.depth-(t+1)),a=fa(e,t,n,s,i);if(a){for(let l=t-1;l>=0;l--){let{match:c,type:d}=this.frontier[l],u=fa(e,l,d,c,!0);if(!u||u.childCount)continue e}return{depth:t,fit:a,move:i?e.doc.resolve(e.after(t+1)):e}}}}close(e){let t=this.findCloseLevel(e);if(!t)return null;for(;this.depth>t.depth;)this.closeFrontierNode();t.fit.childCount&&(this.placed=cn(this.placed,t.depth,t.fit)),e=t.move;for(let s=t.depth+1;s<=e.depth;s++){let n=e.node(s),i=n.type.contentMatch.fillBefore(n.content,!0,e.index(s));this.openFrontierNode(n.type,n.attrs,i)}return e}openFrontierNode(e,t=null,s){let n=this.frontier[this.depth];n.match=n.match.matchType(e),this.placed=cn(this.placed,this.depth,z.from(e.create(t,s))),this.frontier.push({type:e,match:e.contentMatch})}closeFrontierNode(){let t=this.frontier.pop().match.fillBefore(z.empty,!0);t.childCount&&(this.placed=cn(this.placed,this.frontier.length,t))}}function ln(r,e,t){return e==0?r.cutByIndex(t,r.childCount):r.replaceChild(0,r.firstChild.copy(ln(r.firstChild.content,e-1,t)))}function cn(r,e,t){return e==0?r.append(t):r.replaceChild(r.childCount-1,r.lastChild.copy(cn(r.lastChild.content,e-1,t)))}function ha(r,e){for(let t=0;t<e;t++)r=r.firstChild.content;return r}function _f(r,e,t){if(e<=0)return r;let s=r.content;return e>1&&(s=s.replaceChild(0,_f(s.firstChild,e-1,s.childCount==1?t-1:0))),e>0&&(s=r.type.contentMatch.fillBefore(s).append(s),t<=0&&(s=s.append(r.type.contentMatch.matchFragment(s).fillBefore(z.empty,!0)))),r.copy(s)}function fa(r,e,t,s,n){let i=r.node(e),a=n?r.indexAfter(e):r.index(e);if(a==i.childCount&&!t.compatibleContent(i.type))return null;let l=s.fillBefore(i.content,!0,a);return l&&!Ew(t,i.content,a)?l:null}function Ew(r,e,t){for(let s=t;s<e.childCount;s++)if(!r.allowsMarks(e.child(s).marks))return!0;return!1}function Aw(r){return r.spec.defining||r.spec.definingForContent}function Cw(r,e,t,s){if(!s.size)return r.deleteRange(e,t);let n=r.doc.resolve(e),i=r.doc.resolve(t);if($f(n,i,s))return r.step(new He(e,t,s));let a=Bf(n,r.doc.resolve(t));a[a.length-1]==0&&a.pop();let l=-(n.depth+1);a.unshift(l);for(let f=n.depth,p=n.pos-1;f>0;f--,p--){let m=n.node(f).type.spec;if(m.defining||m.definingAsContext||m.isolating)break;a.indexOf(f)>-1?l=f:n.before(f)==p&&a.splice(1,0,-f)}let c=a.indexOf(l),d=[],u=s.openStart;for(let f=s.content,p=0;;p++){let m=f.firstChild;if(d.push(m),p==s.openStart)break;f=m.content}for(let f=u-1;f>=0;f--){let p=d[f],m=Aw(p.type);if(m&&!p.sameMarkup(n.node(Math.abs(l)-1)))u=f;else if(m||!p.type.isTextblock)break}for(let f=s.openStart;f>=0;f--){let p=(f+u+1)%(s.openStart+1),m=d[p];if(m)for(let g=0;g<a.length;g++){let y=a[(g+c)%a.length],x=!0;y<0&&(x=!1,y=-y);let S=n.node(y-1),C=n.index(y-1);if(S.canReplaceWith(C,C,m.type,m.marks))return r.replace(n.before(y),x?i.after(y):t,new Q(Ff(s.content,0,s.openStart,p),p,s.openEnd))}}let h=r.steps.length;for(let f=a.length-1;f>=0&&(r.replace(e,t,s),!(r.steps.length>h));f--){let p=a[f];p<0||(e=n.before(p),t=i.after(p))}}function Ff(r,e,t,s,n){if(e<t){let i=r.firstChild;r=r.replaceChild(0,i.copy(Ff(i.content,e+1,t,s,i)))}if(e>s){let i=n.contentMatchAt(0),a=i.fillBefore(r).append(r);r=a.append(i.matchFragment(a).fillBefore(z.empty,!0))}return r}function Mw(r,e,t,s){if(!s.isInline&&e==t&&r.doc.resolve(e).parent.content.size){let n=kw(r.doc,e,s.type);n!=null&&(e=t=n)}r.replaceRange(e,t,new Q(z.from(s),0,0))}function Dw(r,e,t){let s=r.doc.resolve(e),n=r.doc.resolve(t),i=Bf(s,n);for(let a=0;a<i.length;a++){let l=i[a],c=a==i.length-1;if(c&&l==0||s.node(l).type.contentMatch.validEnd)return r.delete(s.start(l),n.end(l));if(l>0&&(c||s.node(l-1).canReplace(s.index(l-1),n.indexAfter(l-1))))return r.delete(s.before(l),n.after(l))}for(let a=1;a<=s.depth&&a<=n.depth;a++)if(e-s.start(a)==s.depth-a&&t>s.end(a)&&n.end(a)-t!=n.depth-a&&s.start(a-1)==n.start(a-1)&&s.node(a-1).canReplace(s.index(a-1),n.index(a-1)))return r.delete(s.before(a),t);r.delete(e,t)}function Bf(r,e){let t=[],s=Math.min(r.depth,e.depth);for(let n=s;n>=0;n--){let i=r.start(n);if(i<r.pos-(r.depth-n)||e.end(n)>e.pos+(e.depth-n)||r.node(n).type.spec.isolating||e.node(n).type.spec.isolating)break;(i==e.start(n)||n==r.depth&&n==e.depth&&r.parent.inlineContent&&e.parent.inlineContent&&n&&e.start(n-1)==i-1)&&t.push(n)}return t}class Fs extends it{constructor(e,t,s){super(),this.pos=e,this.attr=t,this.value=s}apply(e){let t=e.nodeAt(this.pos);if(!t)return Be.fail("No node at attribute step's position");let s=Object.create(null);for(let i in t.attrs)s[i]=t.attrs[i];s[this.attr]=this.value;let n=t.type.create(s,null,t.marks);return Be.fromReplace(e,this.pos,this.pos+1,new Q(z.from(n),0,t.isLeaf?0:1))}getMap(){return wt.empty}invert(e){return new Fs(this.pos,this.attr,e.nodeAt(this.pos).attrs[this.attr])}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new Fs(t.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(e,t){if(typeof t.pos!="number"||typeof t.attr!="string")throw new RangeError("Invalid input for AttrStep.fromJSON");return new Fs(t.pos,t.attr,t.value)}}it.jsonID("attr",Fs);class Mn extends it{constructor(e,t){super(),this.attr=e,this.value=t}apply(e){let t=Object.create(null);for(let n in e.attrs)t[n]=e.attrs[n];t[this.attr]=this.value;let s=e.type.create(t,e.content,e.marks);return Be.ok(s)}getMap(){return wt.empty}invert(e){return new Mn(this.attr,e.attrs[this.attr])}map(e){return this}toJSON(){return{stepType:"docAttr",attr:this.attr,value:this.value}}static fromJSON(e,t){if(typeof t.attr!="string")throw new RangeError("Invalid input for DocAttrStep.fromJSON");return new Mn(t.attr,t.value)}}it.jsonID("docAttr",Mn);let Ws=class extends Error{};Ws=function r(e){let t=Error.call(this,e);return t.__proto__=r.prototype,t};Ws.prototype=Object.create(Error.prototype);Ws.prototype.constructor=Ws;Ws.prototype.name="TransformError";class Uf{constructor(e){this.doc=e,this.steps=[],this.docs=[],this.mapping=new Cn}get before(){return this.docs.length?this.docs[0]:this.doc}step(e){let t=this.maybeStep(e);if(t.failed)throw new Ws(t.failed);return this}maybeStep(e){let t=e.apply(this.doc);return t.failed||this.addStep(e,t.doc),t}get docChanged(){return this.steps.length>0}addStep(e,t){this.docs.push(this.doc),this.steps.push(e),this.mapping.appendMap(e.getMap()),this.doc=t}replace(e,t=e,s=Q.empty){let n=Uo(this.doc,e,t,s);return n&&this.step(n),this}replaceWith(e,t,s){return this.replace(e,t,new Q(z.from(s),0,0))}delete(e,t){return this.replace(e,t,Q.empty)}insert(e,t){return this.replaceWith(e,e,t)}replaceRange(e,t,s){return Cw(this,e,t,s),this}replaceRangeWith(e,t,s){return Mw(this,e,t,s),this}deleteRange(e,t){return Dw(this,e,t),this}lift(e,t){return pw(this,e,t),this}join(e,t=1){return jw(this,e,t),this}wrap(e,t){return xw(this,e,t),this}setBlockType(e,t=e,s,n=null){return yw(this,e,t,s,n),this}setNodeMarkup(e,t,s=null,n){return ww(this,e,t,s,n),this}setNodeAttribute(e,t,s){return this.step(new Fs(e,t,s)),this}setDocAttribute(e,t){return this.step(new Mn(e,t)),this}addNodeMark(e,t){return this.step(new vr(e,t)),this}removeNodeMark(e,t){let s=this.doc.nodeAt(e);if(!s)throw new RangeError("No node at position "+e);if(t instanceof Ae)t.isInSet(s.marks)&&this.step(new ms(e,t));else{let n=s.marks,i,a=[];for(;i=t.isInSet(n);)a.push(new ms(e,i)),n=i.removeFromSet(n);for(let l=a.length-1;l>=0;l--)this.step(a[l])}return this}split(e,t=1,s){return vw(this,e,t,s),this}addMark(e,t,s){return uw(this,e,t,s),this}removeMark(e,t,s){return hw(this,e,t,s),this}clearIncompatible(e,t,s){return ec(this,e,t,s),this}}const pa=Object.create(null);class de{constructor(e,t,s){this.$anchor=e,this.$head=t,this.ranges=s||[new Tw(e.min(t),e.max(t))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let e=this.ranges;for(let t=0;t<e.length;t++)if(e[t].$from.pos!=e[t].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(e,t=Q.empty){let s=t.content.lastChild,n=null;for(let l=0;l<t.openEnd;l++)n=s,s=s.lastChild;let i=e.steps.length,a=this.ranges;for(let l=0;l<a.length;l++){let{$from:c,$to:d}=a[l],u=e.mapping.slice(i);e.replaceRange(u.map(c.pos),u.map(d.pos),l?Q.empty:t),l==0&&Nd(e,i,(s?s.isInline:n&&n.isTextblock)?-1:1)}}replaceWith(e,t){let s=e.steps.length,n=this.ranges;for(let i=0;i<n.length;i++){let{$from:a,$to:l}=n[i],c=e.mapping.slice(s),d=c.map(a.pos),u=c.map(l.pos);i?e.deleteRange(d,u):(e.replaceRangeWith(d,u,t),Nd(e,s,t.isInline?-1:1))}}static findFrom(e,t,s=!1){let n=e.parent.inlineContent?new ce(e):Os(e.node(0),e.parent,e.pos,e.index(),t,s);if(n)return n;for(let i=e.depth-1;i>=0;i--){let a=t<0?Os(e.node(0),e.node(i),e.before(i+1),e.index(i),t,s):Os(e.node(0),e.node(i),e.after(i+1),e.index(i)+1,t,s);if(a)return a}return null}static near(e,t=1){return this.findFrom(e,t)||this.findFrom(e,-t)||new kt(e.node(0))}static atStart(e){return Os(e,e,0,0,1)||new kt(e)}static atEnd(e){return Os(e,e,e.content.size,e.childCount,-1)||new kt(e)}static fromJSON(e,t){if(!t||!t.type)throw new RangeError("Invalid input for Selection.fromJSON");let s=pa[t.type];if(!s)throw new RangeError(`No selection type ${t.type} defined`);return s.fromJSON(e,t)}static jsonID(e,t){if(e in pa)throw new RangeError("Duplicate use of selection JSON ID "+e);return pa[e]=t,t.prototype.jsonID=e,t}getBookmark(){return ce.between(this.$anchor,this.$head).getBookmark()}}de.prototype.visible=!0;class Tw{constructor(e,t){this.$from=e,this.$to=t}}let wd=!1;function vd(r){!wd&&!r.parent.inlineContent&&(wd=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+r.parent.type.name+")"))}class ce extends de{constructor(e,t=e){vd(e),vd(t),super(e,t)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(e,t){let s=e.resolve(t.map(this.head));if(!s.parent.inlineContent)return de.near(s);let n=e.resolve(t.map(this.anchor));return new ce(n.parent.inlineContent?n:s,s)}replace(e,t=Q.empty){if(super.replace(e,t),t==Q.empty){let s=this.$from.marksAcross(this.$to);s&&e.ensureMarks(s)}}eq(e){return e instanceof ce&&e.anchor==this.anchor&&e.head==this.head}getBookmark(){return new zo(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(e,t){if(typeof t.anchor!="number"||typeof t.head!="number")throw new RangeError("Invalid input for TextSelection.fromJSON");return new ce(e.resolve(t.anchor),e.resolve(t.head))}static create(e,t,s=t){let n=e.resolve(t);return new this(n,s==t?n:e.resolve(s))}static between(e,t,s){let n=e.pos-t.pos;if((!s||n)&&(s=n>=0?1:-1),!t.parent.inlineContent){let i=de.findFrom(t,s,!0)||de.findFrom(t,-s,!0);if(i)t=i.$head;else return de.near(t,s)}return e.parent.inlineContent||(n==0?e=t:(e=(de.findFrom(e,-s,!0)||de.findFrom(e,s,!0)).$anchor,e.pos<t.pos!=n<0&&(e=t))),new ce(e,t)}}de.jsonID("text",ce);class zo{constructor(e,t){this.anchor=e,this.head=t}map(e){return new zo(e.map(this.anchor),e.map(this.head))}resolve(e){return ce.between(e.resolve(this.anchor),e.resolve(this.head))}}class se extends de{constructor(e){let t=e.nodeAfter,s=e.node(0).resolve(e.pos+t.nodeSize);super(e,s),this.node=t}map(e,t){let{deleted:s,pos:n}=t.mapResult(this.anchor),i=e.resolve(n);return s?de.near(i):new se(i)}content(){return new Q(z.from(this.node),0,0)}eq(e){return e instanceof se&&e.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new rc(this.anchor)}static fromJSON(e,t){if(typeof t.anchor!="number")throw new RangeError("Invalid input for NodeSelection.fromJSON");return new se(e.resolve(t.anchor))}static create(e,t){return new se(e.resolve(t))}static isSelectable(e){return!e.isText&&e.type.spec.selectable!==!1}}se.prototype.visible=!1;de.jsonID("node",se);class rc{constructor(e){this.anchor=e}map(e){let{deleted:t,pos:s}=e.mapResult(this.anchor);return t?new zo(s,s):new rc(s)}resolve(e){let t=e.resolve(this.anchor),s=t.nodeAfter;return s&&se.isSelectable(s)?new se(t):de.near(t)}}class kt extends de{constructor(e){super(e.resolve(0),e.resolve(e.content.size))}replace(e,t=Q.empty){if(t==Q.empty){e.delete(0,e.doc.content.size);let s=de.atStart(e.doc);s.eq(e.selection)||e.setSelection(s)}else super.replace(e,t)}toJSON(){return{type:"all"}}static fromJSON(e){return new kt(e)}map(e){return new kt(e)}eq(e){return e instanceof kt}getBookmark(){return Ow}}de.jsonID("all",kt);const Ow={map(){return this},resolve(r){return new kt(r)}};function Os(r,e,t,s,n,i=!1){if(e.inlineContent)return ce.create(r,t);for(let a=s-(n>0?0:1);n>0?a<e.childCount:a>=0;a+=n){let l=e.child(a);if(l.isAtom){if(!i&&se.isSelectable(l))return se.create(r,t-(n<0?l.nodeSize:0))}else{let c=Os(r,l,t+n,n<0?l.childCount:0,n,i);if(c)return c}t+=l.nodeSize*n}return null}function Nd(r,e,t){let s=r.steps.length-1;if(s<e)return;let n=r.steps[s];if(!(n instanceof He||n instanceof Ke))return;let i=r.mapping.maps[s],a;i.forEach((l,c,d,u)=>{a==null&&(a=u)}),r.setSelection(de.near(r.doc.resolve(a),t))}const jd=1,ri=2,kd=4;class Rw extends Uf{constructor(e){super(e.doc),this.curSelectionFor=0,this.updated=0,this.meta=Object.create(null),this.time=Date.now(),this.curSelection=e.selection,this.storedMarks=e.storedMarks}get selection(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection}setSelection(e){if(e.$from.doc!=this.doc)throw new RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=e,this.curSelectionFor=this.steps.length,this.updated=(this.updated|jd)&~ri,this.storedMarks=null,this}get selectionSet(){return(this.updated&jd)>0}setStoredMarks(e){return this.storedMarks=e,this.updated|=ri,this}ensureMarks(e){return Ae.sameSet(this.storedMarks||this.selection.$from.marks(),e)||this.setStoredMarks(e),this}addStoredMark(e){return this.ensureMarks(e.addToSet(this.storedMarks||this.selection.$head.marks()))}removeStoredMark(e){return this.ensureMarks(e.removeFromSet(this.storedMarks||this.selection.$head.marks()))}get storedMarksSet(){return(this.updated&ri)>0}addStep(e,t){super.addStep(e,t),this.updated=this.updated&~ri,this.storedMarks=null}setTime(e){return this.time=e,this}replaceSelection(e){return this.selection.replace(this,e),this}replaceSelectionWith(e,t=!0){let s=this.selection;return t&&(e=e.mark(this.storedMarks||(s.empty?s.$from.marks():s.$from.marksAcross(s.$to)||Ae.none))),s.replaceWith(this,e),this}deleteSelection(){return this.selection.replace(this),this}insertText(e,t,s){let n=this.doc.type.schema;if(t==null)return e?this.replaceSelectionWith(n.text(e),!0):this.deleteSelection();{if(s==null&&(s=t),s=s??t,!e)return this.deleteRange(t,s);let i=this.storedMarks;if(!i){let a=this.doc.resolve(t);i=s==t?a.marks():a.marksAcross(this.doc.resolve(s))}return this.replaceRangeWith(t,s,n.text(e,i)),this.selection.empty||this.setSelection(de.near(this.selection.$to)),this}}setMeta(e,t){return this.meta[typeof e=="string"?e:e.key]=t,this}getMeta(e){return this.meta[typeof e=="string"?e:e.key]}get isGeneric(){for(let e in this.meta)return!1;return!0}scrollIntoView(){return this.updated|=kd,this}get scrolledIntoView(){return(this.updated&kd)>0}}function Sd(r,e){return!e||!r?r:r.bind(e)}class dn{constructor(e,t,s){this.name=e,this.init=Sd(t.init,s),this.apply=Sd(t.apply,s)}}const Iw=[new dn("doc",{init(r){return r.doc||r.schema.topNodeType.createAndFill()},apply(r){return r.doc}}),new dn("selection",{init(r,e){return r.selection||de.atStart(e.doc)},apply(r){return r.selection}}),new dn("storedMarks",{init(r){return r.storedMarks||null},apply(r,e,t,s){return s.selection.$cursor?r.storedMarks:null}}),new dn("scrollToSelection",{init(){return 0},apply(r,e){return r.scrolledIntoView?e+1:e}})];class ma{constructor(e,t){this.schema=e,this.plugins=[],this.pluginsByKey=Object.create(null),this.fields=Iw.slice(),t&&t.forEach(s=>{if(this.pluginsByKey[s.key])throw new RangeError("Adding different instances of a keyed plugin ("+s.key+")");this.plugins.push(s),this.pluginsByKey[s.key]=s,s.spec.state&&this.fields.push(new dn(s.key,s.spec.state,s))})}}class Ls{constructor(e){this.config=e}get schema(){return this.config.schema}get plugins(){return this.config.plugins}apply(e){return this.applyTransaction(e).state}filterTransaction(e,t=-1){for(let s=0;s<this.config.plugins.length;s++)if(s!=t){let n=this.config.plugins[s];if(n.spec.filterTransaction&&!n.spec.filterTransaction.call(n,e,this))return!1}return!0}applyTransaction(e){if(!this.filterTransaction(e))return{state:this,transactions:[]};let t=[e],s=this.applyInner(e),n=null;for(;;){let i=!1;for(let a=0;a<this.config.plugins.length;a++){let l=this.config.plugins[a];if(l.spec.appendTransaction){let c=n?n[a].n:0,d=n?n[a].state:this,u=c<t.length&&l.spec.appendTransaction.call(l,c?t.slice(c):t,d,s);if(u&&s.filterTransaction(u,a)){if(u.setMeta("appendedTransaction",e),!n){n=[];for(let h=0;h<this.config.plugins.length;h++)n.push(h<a?{state:s,n:t.length}:{state:this,n:0})}t.push(u),s=s.applyInner(u),i=!0}n&&(n[a]={state:s,n:t.length})}}if(!i)return{state:s,transactions:t}}}applyInner(e){if(!e.before.eq(this.doc))throw new RangeError("Applying a mismatched transaction");let t=new Ls(this.config),s=this.config.fields;for(let n=0;n<s.length;n++){let i=s[n];t[i.name]=i.apply(e,this[i.name],this,t)}return t}get tr(){return new Rw(this)}static create(e){let t=new ma(e.doc?e.doc.type.schema:e.schema,e.plugins),s=new Ls(t);for(let n=0;n<t.fields.length;n++)s[t.fields[n].name]=t.fields[n].init(e,s);return s}reconfigure(e){let t=new ma(this.schema,e.plugins),s=t.fields,n=new Ls(t);for(let i=0;i<s.length;i++){let a=s[i].name;n[a]=this.hasOwnProperty(a)?this[a]:s[i].init(e,n)}return n}toJSON(e){let t={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(t.storedMarks=this.storedMarks.map(s=>s.toJSON())),e&&typeof e=="object")for(let s in e){if(s=="doc"||s=="selection")throw new RangeError("The JSON fields `doc` and `selection` are reserved");let n=e[s],i=n.spec.state;i&&i.toJSON&&(t[s]=i.toJSON.call(n,this[n.key]))}return t}static fromJSON(e,t,s){if(!t)throw new RangeError("Invalid input for EditorState.fromJSON");if(!e.schema)throw new RangeError("Required config field 'schema' missing");let n=new ma(e.schema,e.plugins),i=new Ls(n);return n.fields.forEach(a=>{if(a.name=="doc")i.doc=Er.fromJSON(e.schema,t.doc);else if(a.name=="selection")i.selection=de.fromJSON(i.doc,t.selection);else if(a.name=="storedMarks")t.storedMarks&&(i.storedMarks=t.storedMarks.map(e.schema.markFromJSON));else{if(s)for(let l in s){let c=s[l],d=c.spec.state;if(c.key==a.name&&d&&d.fromJSON&&Object.prototype.hasOwnProperty.call(t,l)){i[a.name]=d.fromJSON.call(c,e,t[l],i);return}}i[a.name]=a.init(e,i)}}),i}}function zf(r,e,t){for(let s in r){let n=r[s];n instanceof Function?n=n.bind(e):s=="handleDOMEvents"&&(n=zf(n,e,{})),t[s]=n}return t}class Je{constructor(e){this.spec=e,this.props={},e.props&&zf(e.props,this,this.props),this.key=e.key?e.key.key:Wf("plugin")}getState(e){return e[this.key]}}const ga=Object.create(null);function Wf(r){return r in ga?r+"$"+ ++ga[r]:(ga[r]=0,r+"$")}class yt{constructor(e="key"){this.key=Wf(e)}get(e){return e.config.pluginsByKey[this.key]}getState(e){return e[this.key]}}const Qe=function(r){for(var e=0;;e++)if(r=r.previousSibling,!r)return e},Hs=function(r){let e=r.assignedSlot||r.parentNode;return e&&e.nodeType==11?e.host:e};let ll=null;const tr=function(r,e,t){let s=ll||(ll=document.createRange());return s.setEnd(r,t??r.nodeValue.length),s.setStart(r,e||0),s},Pw=function(){ll=null},gs=function(r,e,t,s){return t&&(Ed(r,e,t,s,-1)||Ed(r,e,t,s,1))},Lw=/^(img|br|input|textarea|hr)$/i;function Ed(r,e,t,s,n){for(var i;;){if(r==t&&e==s)return!0;if(e==(n<0?0:Mt(r))){let a=r.parentNode;if(!a||a.nodeType!=1||Kn(r)||Lw.test(r.nodeName)||r.contentEditable=="false")return!1;e=Qe(r)+(n<0?0:1),r=a}else if(r.nodeType==1){let a=r.childNodes[e+(n<0?-1:0)];if(a.nodeType==1&&a.contentEditable=="false")if(!((i=a.pmViewDesc)===null||i===void 0)&&i.ignoreForSelection)e+=n;else return!1;else r=a,e=n<0?Mt(r):0}else return!1}}function Mt(r){return r.nodeType==3?r.nodeValue.length:r.childNodes.length}function $w(r,e){for(;;){if(r.nodeType==3&&e)return r;if(r.nodeType==1&&e>0){if(r.contentEditable=="false")return null;r=r.childNodes[e-1],e=Mt(r)}else if(r.parentNode&&!Kn(r))e=Qe(r),r=r.parentNode;else return null}}function _w(r,e){for(;;){if(r.nodeType==3&&e<r.nodeValue.length)return r;if(r.nodeType==1&&e<r.childNodes.length){if(r.contentEditable=="false")return null;r=r.childNodes[e],e=0}else if(r.parentNode&&!Kn(r))e=Qe(r)+1,r=r.parentNode;else return null}}function Fw(r,e,t){for(let s=e==0,n=e==Mt(r);s||n;){if(r==t)return!0;let i=Qe(r);if(r=r.parentNode,!r)return!1;s=s&&i==0,n=n&&i==Mt(r)}}function Kn(r){let e;for(let t=r;t&&!(e=t.pmViewDesc);t=t.parentNode);return e&&e.node&&e.node.isBlock&&(e.dom==r||e.contentDOM==r)}const Wo=function(r){return r.focusNode&&gs(r.focusNode,r.focusOffset,r.anchorNode,r.anchorOffset)};function Vr(r,e){let t=document.createEvent("Event");return t.initEvent("keydown",!0,!0),t.keyCode=r,t.key=t.code=e,t}function Bw(r){let e=r.activeElement;for(;e&&e.shadowRoot;)e=e.shadowRoot.activeElement;return e}function Uw(r,e,t){if(r.caretPositionFromPoint)try{let s=r.caretPositionFromPoint(e,t);if(s)return{node:s.offsetNode,offset:Math.min(Mt(s.offsetNode),s.offset)}}catch{}if(r.caretRangeFromPoint){let s=r.caretRangeFromPoint(e,t);if(s)return{node:s.startContainer,offset:Math.min(Mt(s.startContainer),s.startOffset)}}}const Vt=typeof navigator<"u"?navigator:null,Ad=typeof document<"u"?document:null,Lr=Vt&&Vt.userAgent||"",cl=/Edge\/(\d+)/.exec(Lr),Hf=/MSIE \d/.exec(Lr),dl=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(Lr),xt=!!(Hf||dl||cl),Cr=Hf?document.documentMode:dl?+dl[1]:cl?+cl[1]:0,Pt=!xt&&/gecko\/(\d+)/i.test(Lr);Pt&&+(/Firefox\/(\d+)/.exec(Lr)||[0,0])[1];const ul=!xt&&/Chrome\/(\d+)/.exec(Lr),st=!!ul,Vf=ul?+ul[1]:0,lt=!xt&&!!Vt&&/Apple Computer/.test(Vt.vendor),Vs=lt&&(/Mobile\/\w+/.test(Lr)||!!Vt&&Vt.maxTouchPoints>2),Ct=Vs||(Vt?/Mac/.test(Vt.platform):!1),zw=Vt?/Win/.test(Vt.platform):!1,rr=/Android \d/.test(Lr),Gn=!!Ad&&"webkitFontSmoothing"in Ad.documentElement.style,Ww=Gn?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0;function Hw(r){let e=r.defaultView&&r.defaultView.visualViewport;return e?{left:0,right:e.width,top:0,bottom:e.height}:{left:0,right:r.documentElement.clientWidth,top:0,bottom:r.documentElement.clientHeight}}function Xt(r,e){return typeof r=="number"?r:r[e]}function Vw(r){let e=r.getBoundingClientRect(),t=e.width/r.offsetWidth||1,s=e.height/r.offsetHeight||1;return{left:e.left,right:e.left+r.clientWidth*t,top:e.top,bottom:e.top+r.clientHeight*s}}function Cd(r,e,t){let s=r.someProp("scrollThreshold")||0,n=r.someProp("scrollMargin")||5,i=r.dom.ownerDocument;for(let a=t||r.dom;a;){if(a.nodeType!=1){a=Hs(a);continue}let l=a,c=l==i.body,d=c?Hw(i):Vw(l),u=0,h=0;if(e.top<d.top+Xt(s,"top")?h=-(d.top-e.top+Xt(n,"top")):e.bottom>d.bottom-Xt(s,"bottom")&&(h=e.bottom-e.top>d.bottom-d.top?e.top+Xt(n,"top")-d.top:e.bottom-d.bottom+Xt(n,"bottom")),e.left<d.left+Xt(s,"left")?u=-(d.left-e.left+Xt(n,"left")):e.right>d.right-Xt(s,"right")&&(u=e.right-d.right+Xt(n,"right")),u||h)if(c)i.defaultView.scrollBy(u,h);else{let p=l.scrollLeft,m=l.scrollTop;h&&(l.scrollTop+=h),u&&(l.scrollLeft+=u);let g=l.scrollLeft-p,y=l.scrollTop-m;e={left:e.left-g,top:e.top-y,right:e.right-g,bottom:e.bottom-y}}let f=c?"fixed":getComputedStyle(a).position;if(/^(fixed|sticky)$/.test(f))break;a=f=="absolute"?a.offsetParent:Hs(a)}}function qw(r){let e=r.dom.getBoundingClientRect(),t=Math.max(0,e.top),s,n;for(let i=(e.left+e.right)/2,a=t+1;a<Math.min(innerHeight,e.bottom);a+=5){let l=r.root.elementFromPoint(i,a);if(!l||l==r.dom||!r.dom.contains(l))continue;let c=l.getBoundingClientRect();if(c.top>=t-20){s=l,n=c.top;break}}return{refDOM:s,refTop:n,stack:qf(r.dom)}}function qf(r){let e=[],t=r.ownerDocument;for(let s=r;s&&(e.push({dom:s,top:s.scrollTop,left:s.scrollLeft}),r!=t);s=Hs(s));return e}function Kw({refDOM:r,refTop:e,stack:t}){let s=r?r.getBoundingClientRect().top:0;Kf(t,s==0?0:s-e)}function Kf(r,e){for(let t=0;t<r.length;t++){let{dom:s,top:n,left:i}=r[t];s.scrollTop!=n+e&&(s.scrollTop=n+e),s.scrollLeft!=i&&(s.scrollLeft=i)}}let Cs=null;function Gw(r){if(r.setActive)return r.setActive();if(Cs)return r.focus(Cs);let e=qf(r);r.focus(Cs==null?{get preventScroll(){return Cs={preventScroll:!0},!0}}:void 0),Cs||(Cs=!1,Kf(e,0))}function Gf(r,e){let t,s=2e8,n,i=0,a=e.top,l=e.top,c,d;for(let u=r.firstChild,h=0;u;u=u.nextSibling,h++){let f;if(u.nodeType==1)f=u.getClientRects();else if(u.nodeType==3)f=tr(u).getClientRects();else continue;for(let p=0;p<f.length;p++){let m=f[p];if(m.top<=a&&m.bottom>=l){a=Math.max(m.bottom,a),l=Math.min(m.top,l);let g=m.left>e.left?m.left-e.left:m.right<e.left?e.left-m.right:0;if(g<s){t=u,s=g,n=g&&t.nodeType==3?{left:m.right<e.left?m.right:m.left,top:e.top}:e,u.nodeType==1&&g&&(i=h+(e.left>=(m.left+m.right)/2?1:0));continue}}else m.top>e.top&&!c&&m.left<=e.left&&m.right>=e.left&&(c=u,d={left:Math.max(m.left,Math.min(m.right,e.left)),top:m.top});!t&&(e.left>=m.right&&e.top>=m.top||e.left>=m.left&&e.top>=m.bottom)&&(i=h+1)}}return!t&&c&&(t=c,n=d,s=0),t&&t.nodeType==3?Yw(t,n):!t||s&&t.nodeType==1?{node:r,offset:i}:Gf(t,n)}function Yw(r,e){let t=r.nodeValue.length,s=document.createRange();for(let n=0;n<t;n++){s.setEnd(r,n+1),s.setStart(r,n);let i=hr(s,1);if(i.top!=i.bottom&&sc(e,i))return{node:r,offset:n+(e.left>=(i.left+i.right)/2?1:0)}}return{node:r,offset:0}}function sc(r,e){return r.left>=e.left-1&&r.left<=e.right+1&&r.top>=e.top-1&&r.top<=e.bottom+1}function Jw(r,e){let t=r.parentNode;return t&&/^li$/i.test(t.nodeName)&&e.left<r.getBoundingClientRect().left?t:r}function Xw(r,e,t){let{node:s,offset:n}=Gf(e,t),i=-1;if(s.nodeType==1&&!s.firstChild){let a=s.getBoundingClientRect();i=a.left!=a.right&&t.left>(a.left+a.right)/2?1:-1}return r.docView.posFromDOM(s,n,i)}function Qw(r,e,t,s){let n=-1;for(let i=e,a=!1;i!=r.dom;){let l=r.docView.nearestDesc(i,!0),c;if(!l)return null;if(l.dom.nodeType==1&&(l.node.isBlock&&l.parent||!l.contentDOM)&&((c=l.dom.getBoundingClientRect()).width||c.height)&&(l.node.isBlock&&l.parent&&(!a&&c.left>s.left||c.top>s.top?n=l.posBefore:(!a&&c.right<s.left||c.bottom<s.top)&&(n=l.posAfter),a=!0),!l.contentDOM&&n<0&&!l.node.isText))return(l.node.isBlock?s.top<(c.top+c.bottom)/2:s.left<(c.left+c.right)/2)?l.posBefore:l.posAfter;i=l.dom.parentNode}return n>-1?n:r.docView.posFromDOM(e,t,-1)}function Yf(r,e,t){let s=r.childNodes.length;if(s&&t.top<t.bottom)for(let n=Math.max(0,Math.min(s-1,Math.floor(s*(e.top-t.top)/(t.bottom-t.top))-2)),i=n;;){let a=r.childNodes[i];if(a.nodeType==1){let l=a.getClientRects();for(let c=0;c<l.length;c++){let d=l[c];if(sc(e,d))return Yf(a,e,d)}}if((i=(i+1)%s)==n)break}return r}function Zw(r,e){let t=r.dom.ownerDocument,s,n=0,i=Uw(t,e.left,e.top);i&&({node:s,offset:n}=i);let a=(r.root.elementFromPoint?r.root:t).elementFromPoint(e.left,e.top),l;if(!a||!r.dom.contains(a.nodeType!=1?a.parentNode:a)){let d=r.dom.getBoundingClientRect();if(!sc(e,d)||(a=Yf(r.dom,e,d),!a))return null}if(lt)for(let d=a;s&&d;d=Hs(d))d.draggable&&(s=void 0);if(a=Jw(a,e),s){if(Pt&&s.nodeType==1&&(n=Math.min(n,s.childNodes.length),n<s.childNodes.length)){let u=s.childNodes[n],h;u.nodeName=="IMG"&&(h=u.getBoundingClientRect()).right<=e.left&&h.bottom>e.top&&n++}let d;Gn&&n&&s.nodeType==1&&(d=s.childNodes[n-1]).nodeType==1&&d.contentEditable=="false"&&d.getBoundingClientRect().top>=e.top&&n--,s==r.dom&&n==s.childNodes.length-1&&s.lastChild.nodeType==1&&e.top>s.lastChild.getBoundingClientRect().bottom?l=r.state.doc.content.size:(n==0||s.nodeType!=1||s.childNodes[n-1].nodeName!="BR")&&(l=Qw(r,s,n,e))}l==null&&(l=Xw(r,a,e));let c=r.docView.nearestDesc(a,!0);return{pos:l,inside:c?c.posAtStart-c.border:-1}}function Md(r){return r.top<r.bottom||r.left<r.right}function hr(r,e){let t=r.getClientRects();if(t.length){let s=t[e<0?0:t.length-1];if(Md(s))return s}return Array.prototype.find.call(t,Md)||r.getBoundingClientRect()}const ev=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;function Jf(r,e,t){let{node:s,offset:n,atom:i}=r.docView.domFromPos(e,t<0?-1:1),a=Gn||Pt;if(s.nodeType==3)if(a&&(ev.test(s.nodeValue)||(t<0?!n:n==s.nodeValue.length))){let c=hr(tr(s,n,n),t);if(Pt&&n&&/\s/.test(s.nodeValue[n-1])&&n<s.nodeValue.length){let d=hr(tr(s,n-1,n-1),-1);if(d.top==c.top){let u=hr(tr(s,n,n+1),-1);if(u.top!=c.top)return on(u,u.left<d.left)}}return c}else{let c=n,d=n,u=t<0?1:-1;return t<0&&!n?(d++,u=-1):t>=0&&n==s.nodeValue.length?(c--,u=1):t<0?c--:d++,on(hr(tr(s,c,d),u),u<0)}if(!r.state.doc.resolve(e-(i||0)).parent.inlineContent){if(i==null&&n&&(t<0||n==Mt(s))){let c=s.childNodes[n-1];if(c.nodeType==1)return xa(c.getBoundingClientRect(),!1)}if(i==null&&n<Mt(s)){let c=s.childNodes[n];if(c.nodeType==1)return xa(c.getBoundingClientRect(),!0)}return xa(s.getBoundingClientRect(),t>=0)}if(i==null&&n&&(t<0||n==Mt(s))){let c=s.childNodes[n-1],d=c.nodeType==3?tr(c,Mt(c)-(a?0:1)):c.nodeType==1&&(c.nodeName!="BR"||!c.nextSibling)?c:null;if(d)return on(hr(d,1),!1)}if(i==null&&n<Mt(s)){let c=s.childNodes[n];for(;c.pmViewDesc&&c.pmViewDesc.ignoreForCoords;)c=c.nextSibling;let d=c?c.nodeType==3?tr(c,0,a?0:1):c.nodeType==1?c:null:null;if(d)return on(hr(d,-1),!0)}return on(hr(s.nodeType==3?tr(s):s,-t),t>=0)}function on(r,e){if(r.width==0)return r;let t=e?r.left:r.right;return{top:r.top,bottom:r.bottom,left:t,right:t}}function xa(r,e){if(r.height==0)return r;let t=e?r.top:r.bottom;return{top:t,bottom:t,left:r.left,right:r.right}}function Xf(r,e,t){let s=r.state,n=r.root.activeElement;s!=e&&r.updateState(e),n!=r.dom&&r.focus();try{return t()}finally{s!=e&&r.updateState(s),n!=r.dom&&n&&n.focus()}}function tv(r,e,t){let s=e.selection,n=t=="up"?s.$from:s.$to;return Xf(r,e,()=>{let{node:i}=r.docView.domFromPos(n.pos,t=="up"?-1:1);for(;;){let l=r.docView.nearestDesc(i,!0);if(!l)break;if(l.node.isBlock){i=l.contentDOM||l.dom;break}i=l.dom.parentNode}let a=Jf(r,n.pos,1);for(let l=i.firstChild;l;l=l.nextSibling){let c;if(l.nodeType==1)c=l.getClientRects();else if(l.nodeType==3)c=tr(l,0,l.nodeValue.length).getClientRects();else continue;for(let d=0;d<c.length;d++){let u=c[d];if(u.bottom>u.top+1&&(t=="up"?a.top-u.top>(u.bottom-a.top)*2:u.bottom-a.bottom>(a.bottom-u.top)*2))return!1}}return!0})}const rv=/[\u0590-\u08ac]/;function sv(r,e,t){let{$head:s}=e.selection;if(!s.parent.isTextblock)return!1;let n=s.parentOffset,i=!n,a=n==s.parent.content.size,l=r.domSelection();return l?!rv.test(s.parent.textContent)||!l.modify?t=="left"||t=="backward"?i:a:Xf(r,e,()=>{let{focusNode:c,focusOffset:d,anchorNode:u,anchorOffset:h}=r.domSelectionRange(),f=l.caretBidiLevel;l.modify("move",t,"character");let p=s.depth?r.docView.domAfterPos(s.before()):r.dom,{focusNode:m,focusOffset:g}=r.domSelectionRange(),y=m&&!p.contains(m.nodeType==1?m:m.parentNode)||c==m&&d==g;try{l.collapse(u,h),c&&(c!=u||d!=h)&&l.extend&&l.extend(c,d)}catch{}return f!=null&&(l.caretBidiLevel=f),y}):s.pos==s.start()||s.pos==s.end()}let Dd=null,Td=null,Od=!1;function nv(r,e,t){return Dd==e&&Td==t?Od:(Dd=e,Td=t,Od=t=="up"||t=="down"?tv(r,e,t):sv(r,e,t))}const Dt=0,Rd=1,Qr=2,qt=3;class Yn{constructor(e,t,s,n){this.parent=e,this.children=t,this.dom=s,this.contentDOM=n,this.dirty=Dt,s.pmViewDesc=this}matchesWidget(e){return!1}matchesMark(e){return!1}matchesNode(e,t,s){return!1}matchesHack(e){return!1}parseRule(){return null}stopEvent(e){return!1}get size(){let e=0;for(let t=0;t<this.children.length;t++)e+=this.children[t].size;return e}get border(){return 0}destroy(){this.parent=void 0,this.dom.pmViewDesc==this&&(this.dom.pmViewDesc=void 0);for(let e=0;e<this.children.length;e++)this.children[e].destroy()}posBeforeChild(e){for(let t=0,s=this.posAtStart;;t++){let n=this.children[t];if(n==e)return s;s+=n.size}}get posBefore(){return this.parent.posBeforeChild(this)}get posAtStart(){return this.parent?this.parent.posBeforeChild(this)+this.border:0}get posAfter(){return this.posBefore+this.size}get posAtEnd(){return this.posAtStart+this.size-2*this.border}localPosFromDOM(e,t,s){if(this.contentDOM&&this.contentDOM.contains(e.nodeType==1?e:e.parentNode))if(s<0){let i,a;if(e==this.contentDOM)i=e.childNodes[t-1];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;i=e.previousSibling}for(;i&&!((a=i.pmViewDesc)&&a.parent==this);)i=i.previousSibling;return i?this.posBeforeChild(a)+a.size:this.posAtStart}else{let i,a;if(e==this.contentDOM)i=e.childNodes[t];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;i=e.nextSibling}for(;i&&!((a=i.pmViewDesc)&&a.parent==this);)i=i.nextSibling;return i?this.posBeforeChild(a):this.posAtEnd}let n;if(e==this.dom&&this.contentDOM)n=t>Qe(this.contentDOM);else if(this.contentDOM&&this.contentDOM!=this.dom&&this.dom.contains(this.contentDOM))n=e.compareDocumentPosition(this.contentDOM)&2;else if(this.dom.firstChild){if(t==0)for(let i=e;;i=i.parentNode){if(i==this.dom){n=!1;break}if(i.previousSibling)break}if(n==null&&t==e.childNodes.length)for(let i=e;;i=i.parentNode){if(i==this.dom){n=!0;break}if(i.nextSibling)break}}return n??s>0?this.posAtEnd:this.posAtStart}nearestDesc(e,t=!1){for(let s=!0,n=e;n;n=n.parentNode){let i=this.getDesc(n),a;if(i&&(!t||i.node))if(s&&(a=i.nodeDOM)&&!(a.nodeType==1?a.contains(e.nodeType==1?e:e.parentNode):a==e))s=!1;else return i}}getDesc(e){let t=e.pmViewDesc;for(let s=t;s;s=s.parent)if(s==this)return t}posFromDOM(e,t,s){for(let n=e;n;n=n.parentNode){let i=this.getDesc(n);if(i)return i.localPosFromDOM(e,t,s)}return-1}descAt(e){for(let t=0,s=0;t<this.children.length;t++){let n=this.children[t],i=s+n.size;if(s==e&&i!=s){for(;!n.border&&n.children.length;)for(let a=0;a<n.children.length;a++){let l=n.children[a];if(l.size){n=l;break}}return n}if(e<i)return n.descAt(e-s-n.border);s=i}}domFromPos(e,t){if(!this.contentDOM)return{node:this.dom,offset:0,atom:e+1};let s=0,n=0;for(let i=0;s<this.children.length;s++){let a=this.children[s],l=i+a.size;if(l>e||a instanceof Zf){n=e-i;break}i=l}if(n)return this.children[s].domFromPos(n-this.children[s].border,t);for(let i;s&&!(i=this.children[s-1]).size&&i instanceof Qf&&i.side>=0;s--);if(t<=0){let i,a=!0;for(;i=s?this.children[s-1]:null,!(!i||i.dom.parentNode==this.contentDOM);s--,a=!1);return i&&t&&a&&!i.border&&!i.domAtom?i.domFromPos(i.size,t):{node:this.contentDOM,offset:i?Qe(i.dom)+1:0}}else{let i,a=!0;for(;i=s<this.children.length?this.children[s]:null,!(!i||i.dom.parentNode==this.contentDOM);s++,a=!1);return i&&a&&!i.border&&!i.domAtom?i.domFromPos(0,t):{node:this.contentDOM,offset:i?Qe(i.dom):this.contentDOM.childNodes.length}}}parseRange(e,t,s=0){if(this.children.length==0)return{node:this.contentDOM,from:e,to:t,fromOffset:0,toOffset:this.contentDOM.childNodes.length};let n=-1,i=-1;for(let a=s,l=0;;l++){let c=this.children[l],d=a+c.size;if(n==-1&&e<=d){let u=a+c.border;if(e>=u&&t<=d-c.border&&c.node&&c.contentDOM&&this.contentDOM.contains(c.contentDOM))return c.parseRange(e,t,u);e=a;for(let h=l;h>0;h--){let f=this.children[h-1];if(f.size&&f.dom.parentNode==this.contentDOM&&!f.emptyChildAt(1)){n=Qe(f.dom)+1;break}e-=f.size}n==-1&&(n=0)}if(n>-1&&(d>t||l==this.children.length-1)){t=d;for(let u=l+1;u<this.children.length;u++){let h=this.children[u];if(h.size&&h.dom.parentNode==this.contentDOM&&!h.emptyChildAt(-1)){i=Qe(h.dom);break}t+=h.size}i==-1&&(i=this.contentDOM.childNodes.length);break}a=d}return{node:this.contentDOM,from:e,to:t,fromOffset:n,toOffset:i}}emptyChildAt(e){if(this.border||!this.contentDOM||!this.children.length)return!1;let t=this.children[e<0?0:this.children.length-1];return t.size==0||t.emptyChildAt(e)}domAfterPos(e){let{node:t,offset:s}=this.domFromPos(e,0);if(t.nodeType!=1||s==t.childNodes.length)throw new RangeError("No node after pos "+e);return t.childNodes[s]}setSelection(e,t,s,n=!1){let i=Math.min(e,t),a=Math.max(e,t);for(let p=0,m=0;p<this.children.length;p++){let g=this.children[p],y=m+g.size;if(i>m&&a<y)return g.setSelection(e-m-g.border,t-m-g.border,s,n);m=y}let l=this.domFromPos(e,e?-1:1),c=t==e?l:this.domFromPos(t,t?-1:1),d=s.root.getSelection(),u=s.domSelectionRange(),h=!1;if((Pt||lt)&&e==t){let{node:p,offset:m}=l;if(p.nodeType==3){if(h=!!(m&&p.nodeValue[m-1]==`
`),h&&m==p.nodeValue.length)for(let g=p,y;g;g=g.parentNode){if(y=g.nextSibling){y.nodeName=="BR"&&(l=c={node:y.parentNode,offset:Qe(y)+1});break}let x=g.pmViewDesc;if(x&&x.node&&x.node.isBlock)break}}else{let g=p.childNodes[m-1];h=g&&(g.nodeName=="BR"||g.contentEditable=="false")}}if(Pt&&u.focusNode&&u.focusNode!=c.node&&u.focusNode.nodeType==1){let p=u.focusNode.childNodes[u.focusOffset];p&&p.contentEditable=="false"&&(n=!0)}if(!(n||h&&lt)&&gs(l.node,l.offset,u.anchorNode,u.anchorOffset)&&gs(c.node,c.offset,u.focusNode,u.focusOffset))return;let f=!1;if((d.extend||e==t)&&!h){d.collapse(l.node,l.offset);try{e!=t&&d.extend(c.node,c.offset),f=!0}catch{}}if(!f){if(e>t){let m=l;l=c,c=m}let p=document.createRange();p.setEnd(c.node,c.offset),p.setStart(l.node,l.offset),d.removeAllRanges(),d.addRange(p)}}ignoreMutation(e){return!this.contentDOM&&e.type!="selection"}get contentLost(){return this.contentDOM&&this.contentDOM!=this.dom&&!this.dom.contains(this.contentDOM)}markDirty(e,t){for(let s=0,n=0;n<this.children.length;n++){let i=this.children[n],a=s+i.size;if(s==a?e<=a&&t>=s:e<a&&t>s){let l=s+i.border,c=a-i.border;if(e>=l&&t<=c){this.dirty=e==s||t==a?Qr:Rd,e==l&&t==c&&(i.contentLost||i.dom.parentNode!=this.contentDOM)?i.dirty=qt:i.markDirty(e-l,t-l);return}else i.dirty=i.dom==i.contentDOM&&i.dom.parentNode==this.contentDOM&&!i.children.length?Qr:qt}s=a}this.dirty=Qr}markParentsDirty(){let e=1;for(let t=this.parent;t;t=t.parent,e++){let s=e==1?Qr:Rd;t.dirty<s&&(t.dirty=s)}}get domAtom(){return!1}get ignoreForCoords(){return!1}get ignoreForSelection(){return!1}isText(e){return!1}}class Qf extends Yn{constructor(e,t,s,n){let i,a=t.type.toDOM;if(typeof a=="function"&&(a=a(s,()=>{if(!i)return n;if(i.parent)return i.parent.posBeforeChild(i)})),!t.type.spec.raw){if(a.nodeType!=1){let l=document.createElement("span");l.appendChild(a),a=l}a.contentEditable="false",a.classList.add("ProseMirror-widget")}super(e,[],a,null),this.widget=t,this.widget=t,i=this}matchesWidget(e){return this.dirty==Dt&&e.type.eq(this.widget.type)}parseRule(){return{ignore:!0}}stopEvent(e){let t=this.widget.spec.stopEvent;return t?t(e):!1}ignoreMutation(e){return e.type!="selection"||this.widget.spec.ignoreSelection}destroy(){this.widget.type.destroy(this.dom),super.destroy()}get domAtom(){return!0}get ignoreForSelection(){return!!this.widget.type.spec.relaxedSide}get side(){return this.widget.type.side}}class iv extends Yn{constructor(e,t,s,n){super(e,[],t,null),this.textDOM=s,this.text=n}get size(){return this.text.length}localPosFromDOM(e,t){return e!=this.textDOM?this.posAtStart+(t?this.size:0):this.posAtStart+t}domFromPos(e){return{node:this.textDOM,offset:e}}ignoreMutation(e){return e.type==="characterData"&&e.target.nodeValue==e.oldValue}}class xs extends Yn{constructor(e,t,s,n,i){super(e,[],s,n),this.mark=t,this.spec=i}static create(e,t,s,n){let i=n.nodeViews[t.type.name],a=i&&i(t,n,s);return(!a||!a.dom)&&(a=js.renderSpec(document,t.type.spec.toDOM(t,s),null,t.attrs)),new xs(e,t,a.dom,a.contentDOM||a.dom,a)}parseRule(){return this.dirty&qt||this.mark.type.spec.reparseInView?null:{mark:this.mark.type.name,attrs:this.mark.attrs,contentElement:this.contentDOM}}matchesMark(e){return this.dirty!=qt&&this.mark.eq(e)}markDirty(e,t){if(super.markDirty(e,t),this.dirty!=Dt){let s=this.parent;for(;!s.node;)s=s.parent;s.dirty<this.dirty&&(s.dirty=this.dirty),this.dirty=Dt}}slice(e,t,s){let n=xs.create(this.parent,this.mark,!0,s),i=this.children,a=this.size;t<a&&(i=fl(i,t,a,s)),e>0&&(i=fl(i,0,e,s));for(let l=0;l<i.length;l++)i[l].parent=n;return n.children=i,n}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}}class Mr extends Yn{constructor(e,t,s,n,i,a,l,c,d){super(e,[],i,a),this.node=t,this.outerDeco=s,this.innerDeco=n,this.nodeDOM=l}static create(e,t,s,n,i,a){let l=i.nodeViews[t.type.name],c,d=l&&l(t,i,()=>{if(!c)return a;if(c.parent)return c.parent.posBeforeChild(c)},s,n),u=d&&d.dom,h=d&&d.contentDOM;if(t.isText){if(!u)u=document.createTextNode(t.text);else if(u.nodeType!=3)throw new RangeError("Text must be rendered as a DOM text node")}else u||({dom:u,contentDOM:h}=js.renderSpec(document,t.type.spec.toDOM(t),null,t.attrs));!h&&!t.isText&&u.nodeName!="BR"&&(u.hasAttribute("contenteditable")||(u.contentEditable="false"),t.type.spec.draggable&&(u.draggable=!0));let f=u;return u=rp(u,s,t),d?c=new ov(e,t,s,n,u,h||null,f,d,i,a+1):t.isText?new Ho(e,t,s,n,u,f,i):new Mr(e,t,s,n,u,h||null,f,i,a+1)}parseRule(){if(this.node.type.spec.reparseInView)return null;let e={node:this.node.type.name,attrs:this.node.attrs};if(this.node.type.whitespace=="pre"&&(e.preserveWhitespace="full"),!this.contentDOM)e.getContent=()=>this.node.content;else if(!this.contentLost)e.contentElement=this.contentDOM;else{for(let t=this.children.length-1;t>=0;t--){let s=this.children[t];if(this.dom.contains(s.dom.parentNode)){e.contentElement=s.dom.parentNode;break}}e.contentElement||(e.getContent=()=>z.empty)}return e}matchesNode(e,t,s){return this.dirty==Dt&&e.eq(this.node)&&Wi(t,this.outerDeco)&&s.eq(this.innerDeco)}get size(){return this.node.nodeSize}get border(){return this.node.isLeaf?0:1}updateChildren(e,t){let s=this.node.inlineContent,n=t,i=e.composing?this.localCompositionInfo(e,t):null,a=i&&i.pos>-1?i:null,l=i&&i.pos<0,c=new lv(this,a&&a.node,e);uv(this.node,this.innerDeco,(d,u,h)=>{d.spec.marks?c.syncToMarks(d.spec.marks,s,e):d.type.side>=0&&!h&&c.syncToMarks(u==this.node.childCount?Ae.none:this.node.child(u).marks,s,e),c.placeWidget(d,e,n)},(d,u,h,f)=>{c.syncToMarks(d.marks,s,e);let p;c.findNodeMatch(d,u,h,f)||l&&e.state.selection.from>n&&e.state.selection.to<n+d.nodeSize&&(p=c.findIndexWithChild(i.node))>-1&&c.updateNodeAt(d,u,h,p,e)||c.updateNextNode(d,u,h,e,f,n)||c.addNode(d,u,h,e,n),n+=d.nodeSize}),c.syncToMarks([],s,e),this.node.isTextblock&&c.addTextblockHacks(),c.destroyRest(),(c.changed||this.dirty==Qr)&&(a&&this.protectLocalComposition(e,a),ep(this.contentDOM,this.children,e),Vs&&hv(this.dom))}localCompositionInfo(e,t){let{from:s,to:n}=e.state.selection;if(!(e.state.selection instanceof ce)||s<t||n>t+this.node.content.size)return null;let i=e.input.compositionNode;if(!i||!this.dom.contains(i.parentNode))return null;if(this.node.inlineContent){let a=i.nodeValue,l=fv(this.node.content,a,s-t,n-t);return l<0?null:{node:i,pos:l,text:a}}else return{node:i,pos:-1,text:""}}protectLocalComposition(e,{node:t,pos:s,text:n}){if(this.getDesc(t))return;let i=t;for(;i.parentNode!=this.contentDOM;i=i.parentNode){for(;i.previousSibling;)i.parentNode.removeChild(i.previousSibling);for(;i.nextSibling;)i.parentNode.removeChild(i.nextSibling);i.pmViewDesc&&(i.pmViewDesc=void 0)}let a=new iv(this,i,t,n);e.input.compositionNodes.push(a),this.children=fl(this.children,s,s+n.length,e,a)}update(e,t,s,n){return this.dirty==qt||!e.sameMarkup(this.node)?!1:(this.updateInner(e,t,s,n),!0)}updateInner(e,t,s,n){this.updateOuterDeco(t),this.node=e,this.innerDeco=s,this.contentDOM&&this.updateChildren(n,this.posAtStart),this.dirty=Dt}updateOuterDeco(e){if(Wi(e,this.outerDeco))return;let t=this.nodeDOM.nodeType!=1,s=this.dom;this.dom=tp(this.dom,this.nodeDOM,hl(this.outerDeco,this.node,t),hl(e,this.node,t)),this.dom!=s&&(s.pmViewDesc=void 0,this.dom.pmViewDesc=this),this.outerDeco=e}selectNode(){this.nodeDOM.nodeType==1&&this.nodeDOM.classList.add("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&(this.dom.draggable=!0)}deselectNode(){this.nodeDOM.nodeType==1&&(this.nodeDOM.classList.remove("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&this.dom.removeAttribute("draggable"))}get domAtom(){return this.node.isAtom}}function Id(r,e,t,s,n){rp(s,e,r);let i=new Mr(void 0,r,e,t,s,s,s,n,0);return i.contentDOM&&i.updateChildren(n,0),i}class Ho extends Mr{constructor(e,t,s,n,i,a,l){super(e,t,s,n,i,null,a,l,0)}parseRule(){let e=this.nodeDOM.parentNode;for(;e&&e!=this.dom&&!e.pmIsDeco;)e=e.parentNode;return{skip:e||!0}}update(e,t,s,n){return this.dirty==qt||this.dirty!=Dt&&!this.inParent()||!e.sameMarkup(this.node)?!1:(this.updateOuterDeco(t),(this.dirty!=Dt||e.text!=this.node.text)&&e.text!=this.nodeDOM.nodeValue&&(this.nodeDOM.nodeValue=e.text,n.trackWrites==this.nodeDOM&&(n.trackWrites=null)),this.node=e,this.dirty=Dt,!0)}inParent(){let e=this.parent.contentDOM;for(let t=this.nodeDOM;t;t=t.parentNode)if(t==e)return!0;return!1}domFromPos(e){return{node:this.nodeDOM,offset:e}}localPosFromDOM(e,t,s){return e==this.nodeDOM?this.posAtStart+Math.min(t,this.node.text.length):super.localPosFromDOM(e,t,s)}ignoreMutation(e){return e.type!="characterData"&&e.type!="selection"}slice(e,t,s){let n=this.node.cut(e,t),i=document.createTextNode(n.text);return new Ho(this.parent,n,this.outerDeco,this.innerDeco,i,i,s)}markDirty(e,t){super.markDirty(e,t),this.dom!=this.nodeDOM&&(e==0||t==this.nodeDOM.nodeValue.length)&&(this.dirty=qt)}get domAtom(){return!1}isText(e){return this.node.text==e}}class Zf extends Yn{parseRule(){return{ignore:!0}}matchesHack(e){return this.dirty==Dt&&this.dom.nodeName==e}get domAtom(){return!0}get ignoreForCoords(){return this.dom.nodeName=="IMG"}}class ov extends Mr{constructor(e,t,s,n,i,a,l,c,d,u){super(e,t,s,n,i,a,l,d,u),this.spec=c}update(e,t,s,n){if(this.dirty==qt)return!1;if(this.spec.update&&(this.node.type==e.type||this.spec.multiType)){let i=this.spec.update(e,t,s);return i&&this.updateInner(e,t,s,n),i}else return!this.contentDOM&&!e.isLeaf?!1:super.update(e,t,s,n)}selectNode(){this.spec.selectNode?this.spec.selectNode():super.selectNode()}deselectNode(){this.spec.deselectNode?this.spec.deselectNode():super.deselectNode()}setSelection(e,t,s,n){this.spec.setSelection?this.spec.setSelection(e,t,s.root):super.setSelection(e,t,s,n)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}stopEvent(e){return this.spec.stopEvent?this.spec.stopEvent(e):!1}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}}function ep(r,e,t){let s=r.firstChild,n=!1;for(let i=0;i<e.length;i++){let a=e[i],l=a.dom;if(l.parentNode==r){for(;l!=s;)s=Pd(s),n=!0;s=s.nextSibling}else n=!0,r.insertBefore(l,s);if(a instanceof xs){let c=s?s.previousSibling:r.lastChild;ep(a.contentDOM,a.children,t),s=c?c.nextSibling:r.firstChild}}for(;s;)s=Pd(s),n=!0;n&&t.trackWrites==r&&(t.trackWrites=null)}const gn=function(r){r&&(this.nodeName=r)};gn.prototype=Object.create(null);const Zr=[new gn];function hl(r,e,t){if(r.length==0)return Zr;let s=t?Zr[0]:new gn,n=[s];for(let i=0;i<r.length;i++){let a=r[i].type.attrs;if(a){a.nodeName&&n.push(s=new gn(a.nodeName));for(let l in a){let c=a[l];c!=null&&(t&&n.length==1&&n.push(s=new gn(e.isInline?"span":"div")),l=="class"?s.class=(s.class?s.class+" ":"")+c:l=="style"?s.style=(s.style?s.style+";":"")+c:l!="nodeName"&&(s[l]=c))}}}return n}function tp(r,e,t,s){if(t==Zr&&s==Zr)return e;let n=e;for(let i=0;i<s.length;i++){let a=s[i],l=t[i];if(i){let c;l&&l.nodeName==a.nodeName&&n!=r&&(c=n.parentNode)&&c.nodeName.toLowerCase()==a.nodeName||(c=document.createElement(a.nodeName),c.pmIsDeco=!0,c.appendChild(n),l=Zr[0]),n=c}av(n,l||Zr[0],a)}return n}function av(r,e,t){for(let s in e)s!="class"&&s!="style"&&s!="nodeName"&&!(s in t)&&r.removeAttribute(s);for(let s in t)s!="class"&&s!="style"&&s!="nodeName"&&t[s]!=e[s]&&r.setAttribute(s,t[s]);if(e.class!=t.class){let s=e.class?e.class.split(" ").filter(Boolean):[],n=t.class?t.class.split(" ").filter(Boolean):[];for(let i=0;i<s.length;i++)n.indexOf(s[i])==-1&&r.classList.remove(s[i]);for(let i=0;i<n.length;i++)s.indexOf(n[i])==-1&&r.classList.add(n[i]);r.classList.length==0&&r.removeAttribute("class")}if(e.style!=t.style){if(e.style){let s=/\s*([\w\-\xa1-\uffff]+)\s*:(?:"(?:\\.|[^"])*"|'(?:\\.|[^'])*'|\(.*?\)|[^;])*/g,n;for(;n=s.exec(e.style);)r.style.removeProperty(n[1])}t.style&&(r.style.cssText+=t.style)}}function rp(r,e,t){return tp(r,r,Zr,hl(e,t,r.nodeType!=1))}function Wi(r,e){if(r.length!=e.length)return!1;for(let t=0;t<r.length;t++)if(!r[t].type.eq(e[t].type))return!1;return!0}function Pd(r){let e=r.nextSibling;return r.parentNode.removeChild(r),e}class lv{constructor(e,t,s){this.lock=t,this.view=s,this.index=0,this.stack=[],this.changed=!1,this.top=e,this.preMatch=cv(e.node.content,e)}destroyBetween(e,t){if(e!=t){for(let s=e;s<t;s++)this.top.children[s].destroy();this.top.children.splice(e,t-e),this.changed=!0}}destroyRest(){this.destroyBetween(this.index,this.top.children.length)}syncToMarks(e,t,s){let n=0,i=this.stack.length>>1,a=Math.min(i,e.length);for(;n<a&&(n==i-1?this.top:this.stack[n+1<<1]).matchesMark(e[n])&&e[n].type.spec.spanning!==!1;)n++;for(;n<i;)this.destroyRest(),this.top.dirty=Dt,this.index=this.stack.pop(),this.top=this.stack.pop(),i--;for(;i<e.length;){this.stack.push(this.top,this.index+1);let l=-1;for(let c=this.index;c<Math.min(this.index+3,this.top.children.length);c++){let d=this.top.children[c];if(d.matchesMark(e[i])&&!this.isLocked(d.dom)){l=c;break}}if(l>-1)l>this.index&&(this.changed=!0,this.destroyBetween(this.index,l)),this.top=this.top.children[this.index];else{let c=xs.create(this.top,e[i],t,s);this.top.children.splice(this.index,0,c),this.top=c,this.changed=!0}this.index=0,i++}}findNodeMatch(e,t,s,n){let i=-1,a;if(n>=this.preMatch.index&&(a=this.preMatch.matches[n-this.preMatch.index]).parent==this.top&&a.matchesNode(e,t,s))i=this.top.children.indexOf(a,this.index);else for(let l=this.index,c=Math.min(this.top.children.length,l+5);l<c;l++){let d=this.top.children[l];if(d.matchesNode(e,t,s)&&!this.preMatch.matched.has(d)){i=l;break}}return i<0?!1:(this.destroyBetween(this.index,i),this.index++,!0)}updateNodeAt(e,t,s,n,i){let a=this.top.children[n];return a.dirty==qt&&a.dom==a.contentDOM&&(a.dirty=Qr),a.update(e,t,s,i)?(this.destroyBetween(this.index,n),this.index++,!0):!1}findIndexWithChild(e){for(;;){let t=e.parentNode;if(!t)return-1;if(t==this.top.contentDOM){let s=e.pmViewDesc;if(s){for(let n=this.index;n<this.top.children.length;n++)if(this.top.children[n]==s)return n}return-1}e=t}}updateNextNode(e,t,s,n,i,a){for(let l=this.index;l<this.top.children.length;l++){let c=this.top.children[l];if(c instanceof Mr){let d=this.preMatch.matched.get(c);if(d!=null&&d!=i)return!1;let u=c.dom,h,f=this.isLocked(u)&&!(e.isText&&c.node&&c.node.isText&&c.nodeDOM.nodeValue==e.text&&c.dirty!=qt&&Wi(t,c.outerDeco));if(!f&&c.update(e,t,s,n))return this.destroyBetween(this.index,l),c.dom!=u&&(this.changed=!0),this.index++,!0;if(!f&&(h=this.recreateWrapper(c,e,t,s,n,a)))return this.destroyBetween(this.index,l),this.top.children[this.index]=h,h.contentDOM&&(h.dirty=Qr,h.updateChildren(n,a+1),h.dirty=Dt),this.changed=!0,this.index++,!0;break}}return!1}recreateWrapper(e,t,s,n,i,a){if(e.dirty||t.isAtom||!e.children.length||!e.node.content.eq(t.content)||!Wi(s,e.outerDeco)||!n.eq(e.innerDeco))return null;let l=Mr.create(this.top,t,s,n,i,a);if(l.contentDOM){l.children=e.children,e.children=[];for(let c of l.children)c.parent=l}return e.destroy(),l}addNode(e,t,s,n,i){let a=Mr.create(this.top,e,t,s,n,i);a.contentDOM&&a.updateChildren(n,i+1),this.top.children.splice(this.index++,0,a),this.changed=!0}placeWidget(e,t,s){let n=this.index<this.top.children.length?this.top.children[this.index]:null;if(n&&n.matchesWidget(e)&&(e==n.widget||!n.widget.type.toDOM.parentNode))this.index++;else{let i=new Qf(this.top,e,t,s);this.top.children.splice(this.index++,0,i),this.changed=!0}}addTextblockHacks(){let e=this.top.children[this.index-1],t=this.top;for(;e instanceof xs;)t=e,e=t.children[t.children.length-1];(!e||!(e instanceof Ho)||/\n$/.test(e.node.text)||this.view.requiresGeckoHackNode&&/\s$/.test(e.node.text))&&((lt||st)&&e&&e.dom.contentEditable=="false"&&this.addHackNode("IMG",t),this.addHackNode("BR",this.top))}addHackNode(e,t){if(t==this.top&&this.index<t.children.length&&t.children[this.index].matchesHack(e))this.index++;else{let s=document.createElement(e);e=="IMG"&&(s.className="ProseMirror-separator",s.alt=""),e=="BR"&&(s.className="ProseMirror-trailingBreak");let n=new Zf(this.top,[],s,null);t!=this.top?t.children.push(n):t.children.splice(this.index++,0,n),this.changed=!0}}isLocked(e){return this.lock&&(e==this.lock||e.nodeType==1&&e.contains(this.lock.parentNode))}}function cv(r,e){let t=e,s=t.children.length,n=r.childCount,i=new Map,a=[];e:for(;n>0;){let l;for(;;)if(s){let d=t.children[s-1];if(d instanceof xs)t=d,s=d.children.length;else{l=d,s--;break}}else{if(t==e)break e;s=t.parent.children.indexOf(t),t=t.parent}let c=l.node;if(c){if(c!=r.child(n-1))break;--n,i.set(l,n),a.push(l)}}return{index:n,matched:i,matches:a.reverse()}}function dv(r,e){return r.type.side-e.type.side}function uv(r,e,t,s){let n=e.locals(r),i=0;if(n.length==0){for(let d=0;d<r.childCount;d++){let u=r.child(d);s(u,n,e.forChild(i,u),d),i+=u.nodeSize}return}let a=0,l=[],c=null;for(let d=0;;){let u,h;for(;a<n.length&&n[a].to==i;){let y=n[a++];y.widget&&(u?(h||(h=[u])).push(y):u=y)}if(u)if(h){h.sort(dv);for(let y=0;y<h.length;y++)t(h[y],d,!!c)}else t(u,d,!!c);let f,p;if(c)p=-1,f=c,c=null;else if(d<r.childCount)p=d,f=r.child(d++);else break;for(let y=0;y<l.length;y++)l[y].to<=i&&l.splice(y--,1);for(;a<n.length&&n[a].from<=i&&n[a].to>i;)l.push(n[a++]);let m=i+f.nodeSize;if(f.isText){let y=m;a<n.length&&n[a].from<y&&(y=n[a].from);for(let x=0;x<l.length;x++)l[x].to<y&&(y=l[x].to);y<m&&(c=f.cut(y-i),f=f.cut(0,y-i),m=y,p=-1)}else for(;a<n.length&&n[a].to<m;)a++;let g=f.isInline&&!f.isLeaf?l.filter(y=>!y.inline):l.slice();s(f,g,e.forChild(i,f),p),i=m}}function hv(r){if(r.nodeName=="UL"||r.nodeName=="OL"){let e=r.style.cssText;r.style.cssText=e+"; list-style: square !important",window.getComputedStyle(r).listStyle,r.style.cssText=e}}function fv(r,e,t,s){for(let n=0,i=0;n<r.childCount&&i<=s;){let a=r.child(n++),l=i;if(i+=a.nodeSize,!a.isText)continue;let c=a.text;for(;n<r.childCount;){let d=r.child(n++);if(i+=d.nodeSize,!d.isText)break;c+=d.text}if(i>=t){if(i>=s&&c.slice(s-e.length-l,s-l)==e)return s-e.length;let d=l<s?c.lastIndexOf(e,s-l-1):-1;if(d>=0&&d+e.length+l>=t)return l+d;if(t==s&&c.length>=s+e.length-l&&c.slice(s-l,s-l+e.length)==e)return s}}return-1}function fl(r,e,t,s,n){let i=[];for(let a=0,l=0;a<r.length;a++){let c=r[a],d=l,u=l+=c.size;d>=t||u<=e?i.push(c):(d<e&&i.push(c.slice(0,e-d,s)),n&&(i.push(n),n=void 0),u>t&&i.push(c.slice(t-d,c.size,s)))}return i}function nc(r,e=null){let t=r.domSelectionRange(),s=r.state.doc;if(!t.focusNode)return null;let n=r.docView.nearestDesc(t.focusNode),i=n&&n.size==0,a=r.docView.posFromDOM(t.focusNode,t.focusOffset,1);if(a<0)return null;let l=s.resolve(a),c,d;if(Wo(t)){for(c=a;n&&!n.node;)n=n.parent;let h=n.node;if(n&&h.isAtom&&se.isSelectable(h)&&n.parent&&!(h.isInline&&Fw(t.focusNode,t.focusOffset,n.dom))){let f=n.posBefore;d=new se(a==f?l:s.resolve(f))}}else{if(t instanceof r.dom.ownerDocument.defaultView.Selection&&t.rangeCount>1){let h=a,f=a;for(let p=0;p<t.rangeCount;p++){let m=t.getRangeAt(p);h=Math.min(h,r.docView.posFromDOM(m.startContainer,m.startOffset,1)),f=Math.max(f,r.docView.posFromDOM(m.endContainer,m.endOffset,-1))}if(h<0)return null;[c,a]=f==r.state.selection.anchor?[f,h]:[h,f],l=s.resolve(a)}else c=r.docView.posFromDOM(t.anchorNode,t.anchorOffset,1);if(c<0)return null}let u=s.resolve(c);if(!d){let h=e=="pointer"||r.state.selection.head<l.pos&&!i?1:-1;d=ic(r,u,l,h)}return d}function sp(r){return r.editable?r.hasFocus():ip(r)&&document.activeElement&&document.activeElement.contains(r.dom)}function ir(r,e=!1){let t=r.state.selection;if(np(r,t),!!sp(r)){if(!e&&r.input.mouseDown&&r.input.mouseDown.allowDefault&&st){let s=r.domSelectionRange(),n=r.domObserver.currentSelection;if(s.anchorNode&&n.anchorNode&&gs(s.anchorNode,s.anchorOffset,n.anchorNode,n.anchorOffset)){r.input.mouseDown.delayedSelectionSync=!0,r.domObserver.setCurSelection();return}}if(r.domObserver.disconnectSelection(),r.cursorWrapper)mv(r);else{let{anchor:s,head:n}=t,i,a;Ld&&!(t instanceof ce)&&(t.$from.parent.inlineContent||(i=$d(r,t.from)),!t.empty&&!t.$from.parent.inlineContent&&(a=$d(r,t.to))),r.docView.setSelection(s,n,r,e),Ld&&(i&&_d(i),a&&_d(a)),t.visible?r.dom.classList.remove("ProseMirror-hideselection"):(r.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&pv(r))}r.domObserver.setCurSelection(),r.domObserver.connectSelection()}}const Ld=lt||st&&Vf<63;function $d(r,e){let{node:t,offset:s}=r.docView.domFromPos(e,0),n=s<t.childNodes.length?t.childNodes[s]:null,i=s?t.childNodes[s-1]:null;if(lt&&n&&n.contentEditable=="false")return ya(n);if((!n||n.contentEditable=="false")&&(!i||i.contentEditable=="false")){if(n)return ya(n);if(i)return ya(i)}}function ya(r){return r.contentEditable="true",lt&&r.draggable&&(r.draggable=!1,r.wasDraggable=!0),r}function _d(r){r.contentEditable="false",r.wasDraggable&&(r.draggable=!0,r.wasDraggable=null)}function pv(r){let e=r.dom.ownerDocument;e.removeEventListener("selectionchange",r.input.hideSelectionGuard);let t=r.domSelectionRange(),s=t.anchorNode,n=t.anchorOffset;e.addEventListener("selectionchange",r.input.hideSelectionGuard=()=>{(t.anchorNode!=s||t.anchorOffset!=n)&&(e.removeEventListener("selectionchange",r.input.hideSelectionGuard),setTimeout(()=>{(!sp(r)||r.state.selection.visible)&&r.dom.classList.remove("ProseMirror-hideselection")},20))})}function mv(r){let e=r.domSelection(),t=document.createRange();if(!e)return;let s=r.cursorWrapper.dom,n=s.nodeName=="IMG";n?t.setStart(s.parentNode,Qe(s)+1):t.setStart(s,0),t.collapse(!0),e.removeAllRanges(),e.addRange(t),!n&&!r.state.selection.visible&&xt&&Cr<=11&&(s.disabled=!0,s.disabled=!1)}function np(r,e){if(e instanceof se){let t=r.docView.descAt(e.from);t!=r.lastSelectedViewDesc&&(Fd(r),t&&t.selectNode(),r.lastSelectedViewDesc=t)}else Fd(r)}function Fd(r){r.lastSelectedViewDesc&&(r.lastSelectedViewDesc.parent&&r.lastSelectedViewDesc.deselectNode(),r.lastSelectedViewDesc=void 0)}function ic(r,e,t,s){return r.someProp("createSelectionBetween",n=>n(r,e,t))||ce.between(e,t,s)}function Bd(r){return r.editable&&!r.hasFocus()?!1:ip(r)}function ip(r){let e=r.domSelectionRange();if(!e.anchorNode)return!1;try{return r.dom.contains(e.anchorNode.nodeType==3?e.anchorNode.parentNode:e.anchorNode)&&(r.editable||r.dom.contains(e.focusNode.nodeType==3?e.focusNode.parentNode:e.focusNode))}catch{return!1}}function gv(r){let e=r.docView.domFromPos(r.state.selection.anchor,0),t=r.domSelectionRange();return gs(e.node,e.offset,t.anchorNode,t.anchorOffset)}function pl(r,e){let{$anchor:t,$head:s}=r.selection,n=e>0?t.max(s):t.min(s),i=n.parent.inlineContent?n.depth?r.doc.resolve(e>0?n.after():n.before()):null:n;return i&&de.findFrom(i,e)}function fr(r,e){return r.dispatch(r.state.tr.setSelection(e).scrollIntoView()),!0}function Ud(r,e,t){let s=r.state.selection;if(s instanceof ce)if(t.indexOf("s")>-1){let{$head:n}=s,i=n.textOffset?null:e<0?n.nodeBefore:n.nodeAfter;if(!i||i.isText||!i.isLeaf)return!1;let a=r.state.doc.resolve(n.pos+i.nodeSize*(e<0?-1:1));return fr(r,new ce(s.$anchor,a))}else if(s.empty){if(r.endOfTextblock(e>0?"forward":"backward")){let n=pl(r.state,e);return n&&n instanceof se?fr(r,n):!1}else if(!(Ct&&t.indexOf("m")>-1)){let n=s.$head,i=n.textOffset?null:e<0?n.nodeBefore:n.nodeAfter,a;if(!i||i.isText)return!1;let l=e<0?n.pos-i.nodeSize:n.pos;return i.isAtom||(a=r.docView.descAt(l))&&!a.contentDOM?se.isSelectable(i)?fr(r,new se(e<0?r.state.doc.resolve(n.pos-i.nodeSize):n)):Gn?fr(r,new ce(r.state.doc.resolve(e<0?l:l+i.nodeSize))):!1:!1}}else return!1;else{if(s instanceof se&&s.node.isInline)return fr(r,new ce(e>0?s.$to:s.$from));{let n=pl(r.state,e);return n?fr(r,n):!1}}}function Hi(r){return r.nodeType==3?r.nodeValue.length:r.childNodes.length}function xn(r,e){let t=r.pmViewDesc;return t&&t.size==0&&(e<0||r.nextSibling||r.nodeName!="BR")}function Ms(r,e){return e<0?xv(r):yv(r)}function xv(r){let e=r.domSelectionRange(),t=e.focusNode,s=e.focusOffset;if(!t)return;let n,i,a=!1;for(Pt&&t.nodeType==1&&s<Hi(t)&&xn(t.childNodes[s],-1)&&(a=!0);;)if(s>0){if(t.nodeType!=1)break;{let l=t.childNodes[s-1];if(xn(l,-1))n=t,i=--s;else if(l.nodeType==3)t=l,s=t.nodeValue.length;else break}}else{if(op(t))break;{let l=t.previousSibling;for(;l&&xn(l,-1);)n=t.parentNode,i=Qe(l),l=l.previousSibling;if(l)t=l,s=Hi(t);else{if(t=t.parentNode,t==r.dom)break;s=0}}}a?ml(r,t,s):n&&ml(r,n,i)}function yv(r){let e=r.domSelectionRange(),t=e.focusNode,s=e.focusOffset;if(!t)return;let n=Hi(t),i,a;for(;;)if(s<n){if(t.nodeType!=1)break;let l=t.childNodes[s];if(xn(l,1))i=t,a=++s;else break}else{if(op(t))break;{let l=t.nextSibling;for(;l&&xn(l,1);)i=l.parentNode,a=Qe(l)+1,l=l.nextSibling;if(l)t=l,s=0,n=Hi(t);else{if(t=t.parentNode,t==r.dom)break;s=n=0}}}i&&ml(r,i,a)}function op(r){let e=r.pmViewDesc;return e&&e.node&&e.node.isBlock}function bv(r,e){for(;r&&e==r.childNodes.length&&!Kn(r);)e=Qe(r)+1,r=r.parentNode;for(;r&&e<r.childNodes.length;){let t=r.childNodes[e];if(t.nodeType==3)return t;if(t.nodeType==1&&t.contentEditable=="false")break;r=t,e=0}}function wv(r,e){for(;r&&!e&&!Kn(r);)e=Qe(r),r=r.parentNode;for(;r&&e;){let t=r.childNodes[e-1];if(t.nodeType==3)return t;if(t.nodeType==1&&t.contentEditable=="false")break;r=t,e=r.childNodes.length}}function ml(r,e,t){if(e.nodeType!=3){let i,a;(a=bv(e,t))?(e=a,t=0):(i=wv(e,t))&&(e=i,t=i.nodeValue.length)}let s=r.domSelection();if(!s)return;if(Wo(s)){let i=document.createRange();i.setEnd(e,t),i.setStart(e,t),s.removeAllRanges(),s.addRange(i)}else s.extend&&s.extend(e,t);r.domObserver.setCurSelection();let{state:n}=r;setTimeout(()=>{r.state==n&&ir(r)},50)}function zd(r,e){let t=r.state.doc.resolve(e);if(!(st||zw)&&t.parent.inlineContent){let n=r.coordsAtPos(e);if(e>t.start()){let i=r.coordsAtPos(e-1),a=(i.top+i.bottom)/2;if(a>n.top&&a<n.bottom&&Math.abs(i.left-n.left)>1)return i.left<n.left?"ltr":"rtl"}if(e<t.end()){let i=r.coordsAtPos(e+1),a=(i.top+i.bottom)/2;if(a>n.top&&a<n.bottom&&Math.abs(i.left-n.left)>1)return i.left>n.left?"ltr":"rtl"}}return getComputedStyle(r.dom).direction=="rtl"?"rtl":"ltr"}function Wd(r,e,t){let s=r.state.selection;if(s instanceof ce&&!s.empty||t.indexOf("s")>-1||Ct&&t.indexOf("m")>-1)return!1;let{$from:n,$to:i}=s;if(!n.parent.inlineContent||r.endOfTextblock(e<0?"up":"down")){let a=pl(r.state,e);if(a&&a instanceof se)return fr(r,a)}if(!n.parent.inlineContent){let a=e<0?n:i,l=s instanceof kt?de.near(a,e):de.findFrom(a,e);return l?fr(r,l):!1}return!1}function Hd(r,e){if(!(r.state.selection instanceof ce))return!0;let{$head:t,$anchor:s,empty:n}=r.state.selection;if(!t.sameParent(s))return!0;if(!n)return!1;if(r.endOfTextblock(e>0?"forward":"backward"))return!0;let i=!t.textOffset&&(e<0?t.nodeBefore:t.nodeAfter);if(i&&!i.isText){let a=r.state.tr;return e<0?a.delete(t.pos-i.nodeSize,t.pos):a.delete(t.pos,t.pos+i.nodeSize),r.dispatch(a),!0}return!1}function Vd(r,e,t){r.domObserver.stop(),e.contentEditable=t,r.domObserver.start()}function vv(r){if(!lt||r.state.selection.$head.parentOffset>0)return!1;let{focusNode:e,focusOffset:t}=r.domSelectionRange();if(e&&e.nodeType==1&&t==0&&e.firstChild&&e.firstChild.contentEditable=="false"){let s=e.firstChild;Vd(r,s,"true"),setTimeout(()=>Vd(r,s,"false"),20)}return!1}function Nv(r){let e="";return r.ctrlKey&&(e+="c"),r.metaKey&&(e+="m"),r.altKey&&(e+="a"),r.shiftKey&&(e+="s"),e}function jv(r,e){let t=e.keyCode,s=Nv(e);if(t==8||Ct&&t==72&&s=="c")return Hd(r,-1)||Ms(r,-1);if(t==46&&!e.shiftKey||Ct&&t==68&&s=="c")return Hd(r,1)||Ms(r,1);if(t==13||t==27)return!0;if(t==37||Ct&&t==66&&s=="c"){let n=t==37?zd(r,r.state.selection.from)=="ltr"?-1:1:-1;return Ud(r,n,s)||Ms(r,n)}else if(t==39||Ct&&t==70&&s=="c"){let n=t==39?zd(r,r.state.selection.from)=="ltr"?1:-1:1;return Ud(r,n,s)||Ms(r,n)}else{if(t==38||Ct&&t==80&&s=="c")return Wd(r,-1,s)||Ms(r,-1);if(t==40||Ct&&t==78&&s=="c")return vv(r)||Wd(r,1,s)||Ms(r,1);if(s==(Ct?"m":"c")&&(t==66||t==73||t==89||t==90))return!0}return!1}function oc(r,e){r.someProp("transformCopied",p=>{e=p(e,r)});let t=[],{content:s,openStart:n,openEnd:i}=e;for(;n>1&&i>1&&s.childCount==1&&s.firstChild.childCount==1;){n--,i--;let p=s.firstChild;t.push(p.type.name,p.attrs!=p.type.defaultAttrs?p.attrs:null),s=p.content}let a=r.someProp("clipboardSerializer")||js.fromSchema(r.state.schema),l=hp(),c=l.createElement("div");c.appendChild(a.serializeFragment(s,{document:l}));let d=c.firstChild,u,h=0;for(;d&&d.nodeType==1&&(u=up[d.nodeName.toLowerCase()]);){for(let p=u.length-1;p>=0;p--){let m=l.createElement(u[p]);for(;c.firstChild;)m.appendChild(c.firstChild);c.appendChild(m),h++}d=c.firstChild}d&&d.nodeType==1&&d.setAttribute("data-pm-slice",`${n} ${i}${h?` -${h}`:""} ${JSON.stringify(t)}`);let f=r.someProp("clipboardTextSerializer",p=>p(e,r))||e.content.textBetween(0,e.content.size,`

`);return{dom:c,text:f,slice:e}}function ap(r,e,t,s,n){let i=n.parent.type.spec.code,a,l;if(!t&&!e)return null;let c=e&&(s||i||!t);if(c){if(r.someProp("transformPastedText",f=>{e=f(e,i||s,r)}),i)return e?new Q(z.from(r.state.schema.text(e.replace(/\r\n?/g,`
`))),0,0):Q.empty;let h=r.someProp("clipboardTextParser",f=>f(e,n,s,r));if(h)l=h;else{let f=n.marks(),{schema:p}=r.state,m=js.fromSchema(p);a=document.createElement("div"),e.split(/(?:\r\n?|\n)+/).forEach(g=>{let y=a.appendChild(document.createElement("p"));g&&y.appendChild(m.serializeNode(p.text(g,f)))})}}else r.someProp("transformPastedHTML",h=>{t=h(t,r)}),a=Av(t),Gn&&Cv(a);let d=a&&a.querySelector("[data-pm-slice]"),u=d&&/^(\d+) (\d+)(?: -(\d+))? (.*)/.exec(d.getAttribute("data-pm-slice")||"");if(u&&u[3])for(let h=+u[3];h>0;h--){let f=a.firstChild;for(;f&&f.nodeType!=1;)f=f.nextSibling;if(!f)break;a=f}if(l||(l=(r.someProp("clipboardParser")||r.someProp("domParser")||Ar.fromSchema(r.state.schema)).parseSlice(a,{preserveWhitespace:!!(c||u),context:n,ruleFromNode(f){return f.nodeName=="BR"&&!f.nextSibling&&f.parentNode&&!kv.test(f.parentNode.nodeName)?{ignore:!0}:null}})),u)l=Mv(qd(l,+u[1],+u[2]),u[4]);else if(l=Q.maxOpen(Sv(l.content,n),!0),l.openStart||l.openEnd){let h=0,f=0;for(let p=l.content.firstChild;h<l.openStart&&!p.type.spec.isolating;h++,p=p.firstChild);for(let p=l.content.lastChild;f<l.openEnd&&!p.type.spec.isolating;f++,p=p.lastChild);l=qd(l,h,f)}return r.someProp("transformPasted",h=>{l=h(l,r)}),l}const kv=/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/i;function Sv(r,e){if(r.childCount<2)return r;for(let t=e.depth;t>=0;t--){let n=e.node(t).contentMatchAt(e.index(t)),i,a=[];if(r.forEach(l=>{if(!a)return;let c=n.findWrapping(l.type),d;if(!c)return a=null;if(d=a.length&&i.length&&cp(c,i,l,a[a.length-1],0))a[a.length-1]=d;else{a.length&&(a[a.length-1]=dp(a[a.length-1],i.length));let u=lp(l,c);a.push(u),n=n.matchType(u.type),i=c}}),a)return z.from(a)}return r}function lp(r,e,t=0){for(let s=e.length-1;s>=t;s--)r=e[s].create(null,z.from(r));return r}function cp(r,e,t,s,n){if(n<r.length&&n<e.length&&r[n]==e[n]){let i=cp(r,e,t,s.lastChild,n+1);if(i)return s.copy(s.content.replaceChild(s.childCount-1,i));if(s.contentMatchAt(s.childCount).matchType(n==r.length-1?t.type:r[n+1]))return s.copy(s.content.append(z.from(lp(t,r,n+1))))}}function dp(r,e){if(e==0)return r;let t=r.content.replaceChild(r.childCount-1,dp(r.lastChild,e-1)),s=r.contentMatchAt(r.childCount).fillBefore(z.empty,!0);return r.copy(t.append(s))}function gl(r,e,t,s,n,i){let a=e<0?r.firstChild:r.lastChild,l=a.content;return r.childCount>1&&(i=0),n<s-1&&(l=gl(l,e,t,s,n+1,i)),n>=t&&(l=e<0?a.contentMatchAt(0).fillBefore(l,i<=n).append(l):l.append(a.contentMatchAt(a.childCount).fillBefore(z.empty,!0))),r.replaceChild(e<0?0:r.childCount-1,a.copy(l))}function qd(r,e,t){return e<r.openStart&&(r=new Q(gl(r.content,-1,e,r.openStart,0,r.openEnd),e,r.openEnd)),t<r.openEnd&&(r=new Q(gl(r.content,1,t,r.openEnd,0,0),r.openStart,t)),r}const up={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]};let Kd=null;function hp(){return Kd||(Kd=document.implementation.createHTMLDocument("title"))}let ba=null;function Ev(r){let e=window.trustedTypes;return e?(ba||(ba=e.defaultPolicy||e.createPolicy("ProseMirrorClipboard",{createHTML:t=>t})),ba.createHTML(r)):r}function Av(r){let e=/^(\s*<meta [^>]*>)*/.exec(r);e&&(r=r.slice(e[0].length));let t=hp().createElement("div"),s=/<([a-z][^>\s]+)/i.exec(r),n;if((n=s&&up[s[1].toLowerCase()])&&(r=n.map(i=>"<"+i+">").join("")+r+n.map(i=>"</"+i+">").reverse().join("")),t.innerHTML=Ev(r),n)for(let i=0;i<n.length;i++)t=t.querySelector(n[i])||t;return t}function Cv(r){let e=r.querySelectorAll(st?"span:not([class]):not([style])":"span.Apple-converted-space");for(let t=0;t<e.length;t++){let s=e[t];s.childNodes.length==1&&s.textContent==" "&&s.parentNode&&s.parentNode.replaceChild(r.ownerDocument.createTextNode(" "),s)}}function Mv(r,e){if(!r.size)return r;let t=r.content.firstChild.type.schema,s;try{s=JSON.parse(e)}catch{return r}let{content:n,openStart:i,openEnd:a}=r;for(let l=s.length-2;l>=0;l-=2){let c=t.nodes[s[l]];if(!c||c.hasRequiredAttrs())break;n=z.from(c.create(s[l+1],n)),i++,a++}return new Q(n,i,a)}const ct={},dt={},Dv={touchstart:!0,touchmove:!0};class Tv{constructor(){this.shiftKey=!1,this.mouseDown=null,this.lastKeyCode=null,this.lastKeyCodeTime=0,this.lastClick={time:0,x:0,y:0,type:"",button:0},this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastIOSEnter=0,this.lastIOSEnterFallbackTimeout=-1,this.lastFocus=0,this.lastTouch=0,this.lastChromeDelete=0,this.composing=!1,this.compositionNode=null,this.composingTimeout=-1,this.compositionNodes=[],this.compositionEndedAt=-2e8,this.compositionID=1,this.compositionPendingChanges=0,this.domChangeCount=0,this.eventHandlers=Object.create(null),this.hideSelectionGuard=null}}function Ov(r){for(let e in ct){let t=ct[e];r.dom.addEventListener(e,r.input.eventHandlers[e]=s=>{Iv(r,s)&&!ac(r,s)&&(r.editable||!(s.type in dt))&&t(r,s)},Dv[e]?{passive:!0}:void 0)}lt&&r.dom.addEventListener("input",()=>null),xl(r)}function Nr(r,e){r.input.lastSelectionOrigin=e,r.input.lastSelectionTime=Date.now()}function Rv(r){r.domObserver.stop();for(let e in r.input.eventHandlers)r.dom.removeEventListener(e,r.input.eventHandlers[e]);clearTimeout(r.input.composingTimeout),clearTimeout(r.input.lastIOSEnterFallbackTimeout)}function xl(r){r.someProp("handleDOMEvents",e=>{for(let t in e)r.input.eventHandlers[t]||r.dom.addEventListener(t,r.input.eventHandlers[t]=s=>ac(r,s))})}function ac(r,e){return r.someProp("handleDOMEvents",t=>{let s=t[e.type];return s?s(r,e)||e.defaultPrevented:!1})}function Iv(r,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let t=e.target;t!=r.dom;t=t.parentNode)if(!t||t.nodeType==11||t.pmViewDesc&&t.pmViewDesc.stopEvent(e))return!1;return!0}function Pv(r,e){!ac(r,e)&&ct[e.type]&&(r.editable||!(e.type in dt))&&ct[e.type](r,e)}dt.keydown=(r,e)=>{let t=e;if(r.input.shiftKey=t.keyCode==16||t.shiftKey,!pp(r,t)&&(r.input.lastKeyCode=t.keyCode,r.input.lastKeyCodeTime=Date.now(),!(rr&&st&&t.keyCode==13)))if(t.keyCode!=229&&r.domObserver.forceFlush(),Vs&&t.keyCode==13&&!t.ctrlKey&&!t.altKey&&!t.metaKey){let s=Date.now();r.input.lastIOSEnter=s,r.input.lastIOSEnterFallbackTimeout=setTimeout(()=>{r.input.lastIOSEnter==s&&(r.someProp("handleKeyDown",n=>n(r,Vr(13,"Enter"))),r.input.lastIOSEnter=0)},200)}else r.someProp("handleKeyDown",s=>s(r,t))||jv(r,t)?t.preventDefault():Nr(r,"key")};dt.keyup=(r,e)=>{e.keyCode==16&&(r.input.shiftKey=!1)};dt.keypress=(r,e)=>{let t=e;if(pp(r,t)||!t.charCode||t.ctrlKey&&!t.altKey||Ct&&t.metaKey)return;if(r.someProp("handleKeyPress",n=>n(r,t))){t.preventDefault();return}let s=r.state.selection;if(!(s instanceof ce)||!s.$from.sameParent(s.$to)){let n=String.fromCharCode(t.charCode),i=()=>r.state.tr.insertText(n).scrollIntoView();!/[\r\n]/.test(n)&&!r.someProp("handleTextInput",a=>a(r,s.$from.pos,s.$to.pos,n,i))&&r.dispatch(i()),t.preventDefault()}};function Vo(r){return{left:r.clientX,top:r.clientY}}function Lv(r,e){let t=e.x-r.clientX,s=e.y-r.clientY;return t*t+s*s<100}function lc(r,e,t,s,n){if(s==-1)return!1;let i=r.state.doc.resolve(s);for(let a=i.depth+1;a>0;a--)if(r.someProp(e,l=>a>i.depth?l(r,t,i.nodeAfter,i.before(a),n,!0):l(r,t,i.node(a),i.before(a),n,!1)))return!0;return!1}function Bs(r,e,t){if(r.focused||r.focus(),r.state.selection.eq(e))return;let s=r.state.tr.setSelection(e);s.setMeta("pointer",!0),r.dispatch(s)}function $v(r,e){if(e==-1)return!1;let t=r.state.doc.resolve(e),s=t.nodeAfter;return s&&s.isAtom&&se.isSelectable(s)?(Bs(r,new se(t)),!0):!1}function _v(r,e){if(e==-1)return!1;let t=r.state.selection,s,n;t instanceof se&&(s=t.node);let i=r.state.doc.resolve(e);for(let a=i.depth+1;a>0;a--){let l=a>i.depth?i.nodeAfter:i.node(a);if(se.isSelectable(l)){s&&t.$from.depth>0&&a>=t.$from.depth&&i.before(t.$from.depth+1)==t.$from.pos?n=i.before(t.$from.depth):n=i.before(a);break}}return n!=null?(Bs(r,se.create(r.state.doc,n)),!0):!1}function Fv(r,e,t,s,n){return lc(r,"handleClickOn",e,t,s)||r.someProp("handleClick",i=>i(r,e,s))||(n?_v(r,t):$v(r,t))}function Bv(r,e,t,s){return lc(r,"handleDoubleClickOn",e,t,s)||r.someProp("handleDoubleClick",n=>n(r,e,s))}function Uv(r,e,t,s){return lc(r,"handleTripleClickOn",e,t,s)||r.someProp("handleTripleClick",n=>n(r,e,s))||zv(r,t,s)}function zv(r,e,t){if(t.button!=0)return!1;let s=r.state.doc;if(e==-1)return s.inlineContent?(Bs(r,ce.create(s,0,s.content.size)),!0):!1;let n=s.resolve(e);for(let i=n.depth+1;i>0;i--){let a=i>n.depth?n.nodeAfter:n.node(i),l=n.before(i);if(a.inlineContent)Bs(r,ce.create(s,l+1,l+1+a.content.size));else if(se.isSelectable(a))Bs(r,se.create(s,l));else continue;return!0}}function cc(r){return Vi(r)}const fp=Ct?"metaKey":"ctrlKey";ct.mousedown=(r,e)=>{let t=e;r.input.shiftKey=t.shiftKey;let s=cc(r),n=Date.now(),i="singleClick";n-r.input.lastClick.time<500&&Lv(t,r.input.lastClick)&&!t[fp]&&r.input.lastClick.button==t.button&&(r.input.lastClick.type=="singleClick"?i="doubleClick":r.input.lastClick.type=="doubleClick"&&(i="tripleClick")),r.input.lastClick={time:n,x:t.clientX,y:t.clientY,type:i,button:t.button};let a=r.posAtCoords(Vo(t));a&&(i=="singleClick"?(r.input.mouseDown&&r.input.mouseDown.done(),r.input.mouseDown=new Wv(r,a,t,!!s)):(i=="doubleClick"?Bv:Uv)(r,a.pos,a.inside,t)?t.preventDefault():Nr(r,"pointer"))};class Wv{constructor(e,t,s,n){this.view=e,this.pos=t,this.event=s,this.flushed=n,this.delayedSelectionSync=!1,this.mightDrag=null,this.startDoc=e.state.doc,this.selectNode=!!s[fp],this.allowDefault=s.shiftKey;let i,a;if(t.inside>-1)i=e.state.doc.nodeAt(t.inside),a=t.inside;else{let u=e.state.doc.resolve(t.pos);i=u.parent,a=u.depth?u.before():0}const l=n?null:s.target,c=l?e.docView.nearestDesc(l,!0):null;this.target=c&&c.dom.nodeType==1?c.dom:null;let{selection:d}=e.state;(s.button==0&&i.type.spec.draggable&&i.type.spec.selectable!==!1||d instanceof se&&d.from<=a&&d.to>a)&&(this.mightDrag={node:i,pos:a,addAttr:!!(this.target&&!this.target.draggable),setUneditable:!!(this.target&&Pt&&!this.target.hasAttribute("contentEditable"))}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout(()=>{this.view.input.mouseDown==this&&this.target.setAttribute("contentEditable","false")},20),this.view.domObserver.start()),e.root.addEventListener("mouseup",this.up=this.up.bind(this)),e.root.addEventListener("mousemove",this.move=this.move.bind(this)),Nr(e,"pointer")}done(){this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout(()=>ir(this.view)),this.view.input.mouseDown=null}up(e){if(this.done(),!this.view.dom.contains(e.target))return;let t=this.pos;this.view.state.doc!=this.startDoc&&(t=this.view.posAtCoords(Vo(e))),this.updateAllowDefault(e),this.allowDefault||!t?Nr(this.view,"pointer"):Fv(this.view,t.pos,t.inside,e,this.selectNode)?e.preventDefault():e.button==0&&(this.flushed||lt&&this.mightDrag&&!this.mightDrag.node.isAtom||st&&!this.view.state.selection.visible&&Math.min(Math.abs(t.pos-this.view.state.selection.from),Math.abs(t.pos-this.view.state.selection.to))<=2)?(Bs(this.view,de.near(this.view.state.doc.resolve(t.pos))),e.preventDefault()):Nr(this.view,"pointer")}move(e){this.updateAllowDefault(e),Nr(this.view,"pointer"),e.buttons==0&&this.done()}updateAllowDefault(e){!this.allowDefault&&(Math.abs(this.event.x-e.clientX)>4||Math.abs(this.event.y-e.clientY)>4)&&(this.allowDefault=!0)}}ct.touchstart=r=>{r.input.lastTouch=Date.now(),cc(r),Nr(r,"pointer")};ct.touchmove=r=>{r.input.lastTouch=Date.now(),Nr(r,"pointer")};ct.contextmenu=r=>cc(r);function pp(r,e){return r.composing?!0:lt&&Math.abs(e.timeStamp-r.input.compositionEndedAt)<500?(r.input.compositionEndedAt=-2e8,!0):!1}const Hv=rr?5e3:-1;dt.compositionstart=dt.compositionupdate=r=>{if(!r.composing){r.domObserver.flush();let{state:e}=r,t=e.selection.$to;if(e.selection instanceof ce&&(e.storedMarks||!t.textOffset&&t.parentOffset&&t.nodeBefore.marks.some(s=>s.type.spec.inclusive===!1)))r.markCursor=r.state.storedMarks||t.marks(),Vi(r,!0),r.markCursor=null;else if(Vi(r,!e.selection.empty),Pt&&e.selection.empty&&t.parentOffset&&!t.textOffset&&t.nodeBefore.marks.length){let s=r.domSelectionRange();for(let n=s.focusNode,i=s.focusOffset;n&&n.nodeType==1&&i!=0;){let a=i<0?n.lastChild:n.childNodes[i-1];if(!a)break;if(a.nodeType==3){let l=r.domSelection();l&&l.collapse(a,a.nodeValue.length);break}else n=a,i=-1}}r.input.composing=!0}mp(r,Hv)};dt.compositionend=(r,e)=>{r.composing&&(r.input.composing=!1,r.input.compositionEndedAt=e.timeStamp,r.input.compositionPendingChanges=r.domObserver.pendingRecords().length?r.input.compositionID:0,r.input.compositionNode=null,r.input.compositionPendingChanges&&Promise.resolve().then(()=>r.domObserver.flush()),r.input.compositionID++,mp(r,20))};function mp(r,e){clearTimeout(r.input.composingTimeout),e>-1&&(r.input.composingTimeout=setTimeout(()=>Vi(r),e))}function gp(r){for(r.composing&&(r.input.composing=!1,r.input.compositionEndedAt=qv());r.input.compositionNodes.length>0;)r.input.compositionNodes.pop().markParentsDirty()}function Vv(r){let e=r.domSelectionRange();if(!e.focusNode)return null;let t=$w(e.focusNode,e.focusOffset),s=_w(e.focusNode,e.focusOffset);if(t&&s&&t!=s){let n=s.pmViewDesc,i=r.domObserver.lastChangedTextNode;if(t==i||s==i)return i;if(!n||!n.isText(s.nodeValue))return s;if(r.input.compositionNode==s){let a=t.pmViewDesc;if(!(!a||!a.isText(t.nodeValue)))return s}}return t||s}function qv(){let r=document.createEvent("Event");return r.initEvent("event",!0,!0),r.timeStamp}function Vi(r,e=!1){if(!(rr&&r.domObserver.flushingSoon>=0)){if(r.domObserver.forceFlush(),gp(r),e||r.docView&&r.docView.dirty){let t=nc(r),s=r.state.selection;return t&&!t.eq(s)?r.dispatch(r.state.tr.setSelection(t)):(r.markCursor||e)&&!s.$from.node(s.$from.sharedDepth(s.to)).inlineContent?r.dispatch(r.state.tr.deleteSelection()):r.updateState(r.state),!0}return!1}}function Kv(r,e){if(!r.dom.parentNode)return;let t=r.dom.parentNode.appendChild(document.createElement("div"));t.appendChild(e),t.style.cssText="position: fixed; left: -10000px; top: 10px";let s=getSelection(),n=document.createRange();n.selectNodeContents(e),r.dom.blur(),s.removeAllRanges(),s.addRange(n),setTimeout(()=>{t.parentNode&&t.parentNode.removeChild(t),r.focus()},50)}const Dn=xt&&Cr<15||Vs&&Ww<604;ct.copy=dt.cut=(r,e)=>{let t=e,s=r.state.selection,n=t.type=="cut";if(s.empty)return;let i=Dn?null:t.clipboardData,a=s.content(),{dom:l,text:c}=oc(r,a);i?(t.preventDefault(),i.clearData(),i.setData("text/html",l.innerHTML),i.setData("text/plain",c)):Kv(r,l),n&&r.dispatch(r.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))};function Gv(r){return r.openStart==0&&r.openEnd==0&&r.content.childCount==1?r.content.firstChild:null}function Yv(r,e){if(!r.dom.parentNode)return;let t=r.input.shiftKey||r.state.selection.$from.parent.type.spec.code,s=r.dom.parentNode.appendChild(document.createElement(t?"textarea":"div"));t||(s.contentEditable="true"),s.style.cssText="position: fixed; left: -10000px; top: 10px",s.focus();let n=r.input.shiftKey&&r.input.lastKeyCode!=45;setTimeout(()=>{r.focus(),s.parentNode&&s.parentNode.removeChild(s),t?Tn(r,s.value,null,n,e):Tn(r,s.textContent,s.innerHTML,n,e)},50)}function Tn(r,e,t,s,n){let i=ap(r,e,t,s,r.state.selection.$from);if(r.someProp("handlePaste",c=>c(r,n,i||Q.empty)))return!0;if(!i)return!1;let a=Gv(i),l=a?r.state.tr.replaceSelectionWith(a,s):r.state.tr.replaceSelection(i);return r.dispatch(l.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}function xp(r){let e=r.getData("text/plain")||r.getData("Text");if(e)return e;let t=r.getData("text/uri-list");return t?t.replace(/\r?\n/g," "):""}dt.paste=(r,e)=>{let t=e;if(r.composing&&!rr)return;let s=Dn?null:t.clipboardData,n=r.input.shiftKey&&r.input.lastKeyCode!=45;s&&Tn(r,xp(s),s.getData("text/html"),n,t)?t.preventDefault():Yv(r,t)};class yp{constructor(e,t,s){this.slice=e,this.move=t,this.node=s}}const Jv=Ct?"altKey":"ctrlKey";function bp(r,e){let t=r.someProp("dragCopies",s=>!s(e));return t??!e[Jv]}ct.dragstart=(r,e)=>{let t=e,s=r.input.mouseDown;if(s&&s.done(),!t.dataTransfer)return;let n=r.state.selection,i=n.empty?null:r.posAtCoords(Vo(t)),a;if(!(i&&i.pos>=n.from&&i.pos<=(n instanceof se?n.to-1:n.to))){if(s&&s.mightDrag)a=se.create(r.state.doc,s.mightDrag.pos);else if(t.target&&t.target.nodeType==1){let h=r.docView.nearestDesc(t.target,!0);h&&h.node.type.spec.draggable&&h!=r.docView&&(a=se.create(r.state.doc,h.posBefore))}}let l=(a||r.state.selection).content(),{dom:c,text:d,slice:u}=oc(r,l);(!t.dataTransfer.files.length||!st||Vf>120)&&t.dataTransfer.clearData(),t.dataTransfer.setData(Dn?"Text":"text/html",c.innerHTML),t.dataTransfer.effectAllowed="copyMove",Dn||t.dataTransfer.setData("text/plain",d),r.dragging=new yp(u,bp(r,t),a)};ct.dragend=r=>{let e=r.dragging;window.setTimeout(()=>{r.dragging==e&&(r.dragging=null)},50)};dt.dragover=dt.dragenter=(r,e)=>e.preventDefault();dt.drop=(r,e)=>{let t=e,s=r.dragging;if(r.dragging=null,!t.dataTransfer)return;let n=r.posAtCoords(Vo(t));if(!n)return;let i=r.state.doc.resolve(n.pos),a=s&&s.slice;a?r.someProp("transformPasted",m=>{a=m(a,r)}):a=ap(r,xp(t.dataTransfer),Dn?null:t.dataTransfer.getData("text/html"),!1,i);let l=!!(s&&bp(r,t));if(r.someProp("handleDrop",m=>m(r,t,a||Q.empty,l))){t.preventDefault();return}if(!a)return;t.preventDefault();let c=a?Lf(r.state.doc,i.pos,a):i.pos;c==null&&(c=i.pos);let d=r.state.tr;if(l){let{node:m}=s;m?m.replace(d):d.deleteSelection()}let u=d.mapping.map(c),h=a.openStart==0&&a.openEnd==0&&a.content.childCount==1,f=d.doc;if(h?d.replaceRangeWith(u,u,a.content.firstChild):d.replaceRange(u,u,a),d.doc.eq(f))return;let p=d.doc.resolve(u);if(h&&se.isSelectable(a.content.firstChild)&&p.nodeAfter&&p.nodeAfter.sameMarkup(a.content.firstChild))d.setSelection(new se(p));else{let m=d.mapping.map(c);d.mapping.maps[d.mapping.maps.length-1].forEach((g,y,x,S)=>m=S),d.setSelection(ic(r,p,d.doc.resolve(m)))}r.focus(),r.dispatch(d.setMeta("uiEvent","drop"))};ct.focus=r=>{r.input.lastFocus=Date.now(),r.focused||(r.domObserver.stop(),r.dom.classList.add("ProseMirror-focused"),r.domObserver.start(),r.focused=!0,setTimeout(()=>{r.docView&&r.hasFocus()&&!r.domObserver.currentSelection.eq(r.domSelectionRange())&&ir(r)},20))};ct.blur=(r,e)=>{let t=e;r.focused&&(r.domObserver.stop(),r.dom.classList.remove("ProseMirror-focused"),r.domObserver.start(),t.relatedTarget&&r.dom.contains(t.relatedTarget)&&r.domObserver.currentSelection.clear(),r.focused=!1)};ct.beforeinput=(r,e)=>{if(st&&rr&&e.inputType=="deleteContentBackward"){r.domObserver.flushSoon();let{domChangeCount:s}=r.input;setTimeout(()=>{if(r.input.domChangeCount!=s||(r.dom.blur(),r.focus(),r.someProp("handleKeyDown",i=>i(r,Vr(8,"Backspace")))))return;let{$cursor:n}=r.state.selection;n&&n.pos>0&&r.dispatch(r.state.tr.delete(n.pos-1,n.pos).scrollIntoView())},50)}};for(let r in dt)ct[r]=dt[r];function On(r,e){if(r==e)return!0;for(let t in r)if(r[t]!==e[t])return!1;for(let t in e)if(!(t in r))return!1;return!0}class qi{constructor(e,t){this.toDOM=e,this.spec=t||is,this.side=this.spec.side||0}map(e,t,s,n){let{pos:i,deleted:a}=e.mapResult(t.from+n,this.side<0?-1:1);return a?null:new Nt(i-s,i-s,this)}valid(){return!0}eq(e){return this==e||e instanceof qi&&(this.spec.key&&this.spec.key==e.spec.key||this.toDOM==e.toDOM&&On(this.spec,e.spec))}destroy(e){this.spec.destroy&&this.spec.destroy(e)}}class Dr{constructor(e,t){this.attrs=e,this.spec=t||is}map(e,t,s,n){let i=e.map(t.from+n,this.spec.inclusiveStart?-1:1)-s,a=e.map(t.to+n,this.spec.inclusiveEnd?1:-1)-s;return i>=a?null:new Nt(i,a,this)}valid(e,t){return t.from<t.to}eq(e){return this==e||e instanceof Dr&&On(this.attrs,e.attrs)&&On(this.spec,e.spec)}static is(e){return e.type instanceof Dr}destroy(){}}class dc{constructor(e,t){this.attrs=e,this.spec=t||is}map(e,t,s,n){let i=e.mapResult(t.from+n,1);if(i.deleted)return null;let a=e.mapResult(t.to+n,-1);return a.deleted||a.pos<=i.pos?null:new Nt(i.pos-s,a.pos-s,this)}valid(e,t){let{index:s,offset:n}=e.content.findIndex(t.from),i;return n==t.from&&!(i=e.child(s)).isText&&n+i.nodeSize==t.to}eq(e){return this==e||e instanceof dc&&On(this.attrs,e.attrs)&&On(this.spec,e.spec)}destroy(){}}class Nt{constructor(e,t,s){this.from=e,this.to=t,this.type=s}copy(e,t){return new Nt(e,t,this.type)}eq(e,t=0){return this.type.eq(e.type)&&this.from+t==e.from&&this.to+t==e.to}map(e,t,s){return this.type.map(e,this,t,s)}static widget(e,t,s){return new Nt(e,e,new qi(t,s))}static inline(e,t,s,n){return new Nt(e,t,new Dr(s,n))}static node(e,t,s,n){return new Nt(e,t,new dc(s,n))}get spec(){return this.type.spec}get inline(){return this.type instanceof Dr}get widget(){return this.type instanceof qi}}const Rs=[],is={};class Fe{constructor(e,t){this.local=e.length?e:Rs,this.children=t.length?t:Rs}static create(e,t){return t.length?Ki(t,e,0,is):tt}find(e,t,s){let n=[];return this.findInner(e??0,t??1e9,n,0,s),n}findInner(e,t,s,n,i){for(let a=0;a<this.local.length;a++){let l=this.local[a];l.from<=t&&l.to>=e&&(!i||i(l.spec))&&s.push(l.copy(l.from+n,l.to+n))}for(let a=0;a<this.children.length;a+=3)if(this.children[a]<t&&this.children[a+1]>e){let l=this.children[a]+1;this.children[a+2].findInner(e-l,t-l,s,n+l,i)}}map(e,t,s){return this==tt||e.maps.length==0?this:this.mapInner(e,t,0,0,s||is)}mapInner(e,t,s,n,i){let a;for(let l=0;l<this.local.length;l++){let c=this.local[l].map(e,s,n);c&&c.type.valid(t,c)?(a||(a=[])).push(c):i.onRemove&&i.onRemove(this.local[l].spec)}return this.children.length?Xv(this.children,a||[],e,t,s,n,i):a?new Fe(a.sort(as),Rs):tt}add(e,t){return t.length?this==tt?Fe.create(e,t):this.addInner(e,t,0):this}addInner(e,t,s){let n,i=0;e.forEach((l,c)=>{let d=c+s,u;if(u=vp(t,l,d)){for(n||(n=this.children.slice());i<n.length&&n[i]<c;)i+=3;n[i]==c?n[i+2]=n[i+2].addInner(l,u,d+1):n.splice(i,0,c,c+l.nodeSize,Ki(u,l,d+1,is)),i+=3}});let a=wp(i?Np(t):t,-s);for(let l=0;l<a.length;l++)a[l].type.valid(e,a[l])||a.splice(l--,1);return new Fe(a.length?this.local.concat(a).sort(as):this.local,n||this.children)}remove(e){return e.length==0||this==tt?this:this.removeInner(e,0)}removeInner(e,t){let s=this.children,n=this.local;for(let i=0;i<s.length;i+=3){let a,l=s[i]+t,c=s[i+1]+t;for(let u=0,h;u<e.length;u++)(h=e[u])&&h.from>l&&h.to<c&&(e[u]=null,(a||(a=[])).push(h));if(!a)continue;s==this.children&&(s=this.children.slice());let d=s[i+2].removeInner(a,l+1);d!=tt?s[i+2]=d:(s.splice(i,3),i-=3)}if(n.length){for(let i=0,a;i<e.length;i++)if(a=e[i])for(let l=0;l<n.length;l++)n[l].eq(a,t)&&(n==this.local&&(n=this.local.slice()),n.splice(l--,1))}return s==this.children&&n==this.local?this:n.length||s.length?new Fe(n,s):tt}forChild(e,t){if(this==tt)return this;if(t.isLeaf)return Fe.empty;let s,n;for(let l=0;l<this.children.length;l+=3)if(this.children[l]>=e){this.children[l]==e&&(s=this.children[l+2]);break}let i=e+1,a=i+t.content.size;for(let l=0;l<this.local.length;l++){let c=this.local[l];if(c.from<a&&c.to>i&&c.type instanceof Dr){let d=Math.max(i,c.from)-i,u=Math.min(a,c.to)-i;d<u&&(n||(n=[])).push(c.copy(d,u))}}if(n){let l=new Fe(n.sort(as),Rs);return s?new xr([l,s]):l}return s||tt}eq(e){if(this==e)return!0;if(!(e instanceof Fe)||this.local.length!=e.local.length||this.children.length!=e.children.length)return!1;for(let t=0;t<this.local.length;t++)if(!this.local[t].eq(e.local[t]))return!1;for(let t=0;t<this.children.length;t+=3)if(this.children[t]!=e.children[t]||this.children[t+1]!=e.children[t+1]||!this.children[t+2].eq(e.children[t+2]))return!1;return!0}locals(e){return uc(this.localsInner(e))}localsInner(e){if(this==tt)return Rs;if(e.inlineContent||!this.local.some(Dr.is))return this.local;let t=[];for(let s=0;s<this.local.length;s++)this.local[s].type instanceof Dr||t.push(this.local[s]);return t}forEachSet(e){e(this)}}Fe.empty=new Fe([],[]);Fe.removeOverlap=uc;const tt=Fe.empty;class xr{constructor(e){this.members=e}map(e,t){const s=this.members.map(n=>n.map(e,t,is));return xr.from(s)}forChild(e,t){if(t.isLeaf)return Fe.empty;let s=[];for(let n=0;n<this.members.length;n++){let i=this.members[n].forChild(e,t);i!=tt&&(i instanceof xr?s=s.concat(i.members):s.push(i))}return xr.from(s)}eq(e){if(!(e instanceof xr)||e.members.length!=this.members.length)return!1;for(let t=0;t<this.members.length;t++)if(!this.members[t].eq(e.members[t]))return!1;return!0}locals(e){let t,s=!0;for(let n=0;n<this.members.length;n++){let i=this.members[n].localsInner(e);if(i.length)if(!t)t=i;else{s&&(t=t.slice(),s=!1);for(let a=0;a<i.length;a++)t.push(i[a])}}return t?uc(s?t:t.sort(as)):Rs}static from(e){switch(e.length){case 0:return tt;case 1:return e[0];default:return new xr(e.every(t=>t instanceof Fe)?e:e.reduce((t,s)=>t.concat(s instanceof Fe?s:s.members),[]))}}forEachSet(e){for(let t=0;t<this.members.length;t++)this.members[t].forEachSet(e)}}function Xv(r,e,t,s,n,i,a){let l=r.slice();for(let d=0,u=i;d<t.maps.length;d++){let h=0;t.maps[d].forEach((f,p,m,g)=>{let y=g-m-(p-f);for(let x=0;x<l.length;x+=3){let S=l[x+1];if(S<0||f>S+u-h)continue;let C=l[x]+u-h;p>=C?l[x+1]=f<=C?-2:-1:f>=u&&y&&(l[x]+=y,l[x+1]+=y)}h+=y}),u=t.maps[d].map(u,-1)}let c=!1;for(let d=0;d<l.length;d+=3)if(l[d+1]<0){if(l[d+1]==-2){c=!0,l[d+1]=-1;continue}let u=t.map(r[d]+i),h=u-n;if(h<0||h>=s.content.size){c=!0;continue}let f=t.map(r[d+1]+i,-1),p=f-n,{index:m,offset:g}=s.content.findIndex(h),y=s.maybeChild(m);if(y&&g==h&&g+y.nodeSize==p){let x=l[d+2].mapInner(t,y,u+1,r[d]+i+1,a);x!=tt?(l[d]=h,l[d+1]=p,l[d+2]=x):(l[d+1]=-2,c=!0)}else c=!0}if(c){let d=Qv(l,r,e,t,n,i,a),u=Ki(d,s,0,a);e=u.local;for(let h=0;h<l.length;h+=3)l[h+1]<0&&(l.splice(h,3),h-=3);for(let h=0,f=0;h<u.children.length;h+=3){let p=u.children[h];for(;f<l.length&&l[f]<p;)f+=3;l.splice(f,0,u.children[h],u.children[h+1],u.children[h+2])}}return new Fe(e.sort(as),l)}function wp(r,e){if(!e||!r.length)return r;let t=[];for(let s=0;s<r.length;s++){let n=r[s];t.push(new Nt(n.from+e,n.to+e,n.type))}return t}function Qv(r,e,t,s,n,i,a){function l(c,d){for(let u=0;u<c.local.length;u++){let h=c.local[u].map(s,n,d);h?t.push(h):a.onRemove&&a.onRemove(c.local[u].spec)}for(let u=0;u<c.children.length;u+=3)l(c.children[u+2],c.children[u]+d+1)}for(let c=0;c<r.length;c+=3)r[c+1]==-1&&l(r[c+2],e[c]+i+1);return t}function vp(r,e,t){if(e.isLeaf)return null;let s=t+e.nodeSize,n=null;for(let i=0,a;i<r.length;i++)(a=r[i])&&a.from>t&&a.to<s&&((n||(n=[])).push(a),r[i]=null);return n}function Np(r){let e=[];for(let t=0;t<r.length;t++)r[t]!=null&&e.push(r[t]);return e}function Ki(r,e,t,s){let n=[],i=!1;e.forEach((l,c)=>{let d=vp(r,l,c+t);if(d){i=!0;let u=Ki(d,l,t+c+1,s);u!=tt&&n.push(c,c+l.nodeSize,u)}});let a=wp(i?Np(r):r,-t).sort(as);for(let l=0;l<a.length;l++)a[l].type.valid(e,a[l])||(s.onRemove&&s.onRemove(a[l].spec),a.splice(l--,1));return a.length||n.length?new Fe(a,n):tt}function as(r,e){return r.from-e.from||r.to-e.to}function uc(r){let e=r;for(let t=0;t<e.length-1;t++){let s=e[t];if(s.from!=s.to)for(let n=t+1;n<e.length;n++){let i=e[n];if(i.from==s.from){i.to!=s.to&&(e==r&&(e=r.slice()),e[n]=i.copy(i.from,s.to),Gd(e,n+1,i.copy(s.to,i.to)));continue}else{i.from<s.to&&(e==r&&(e=r.slice()),e[t]=s.copy(s.from,i.from),Gd(e,n,s.copy(i.from,s.to)));break}}}return e}function Gd(r,e,t){for(;e<r.length&&as(t,r[e])>0;)e++;r.splice(e,0,t)}function wa(r){let e=[];return r.someProp("decorations",t=>{let s=t(r.state);s&&s!=tt&&e.push(s)}),r.cursorWrapper&&e.push(Fe.create(r.state.doc,[r.cursorWrapper.deco])),xr.from(e)}const Zv={childList:!0,characterData:!0,characterDataOldValue:!0,attributes:!0,attributeOldValue:!0,subtree:!0},e1=xt&&Cr<=11;class t1{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}set(e){this.anchorNode=e.anchorNode,this.anchorOffset=e.anchorOffset,this.focusNode=e.focusNode,this.focusOffset=e.focusOffset}clear(){this.anchorNode=this.focusNode=null}eq(e){return e.anchorNode==this.anchorNode&&e.anchorOffset==this.anchorOffset&&e.focusNode==this.focusNode&&e.focusOffset==this.focusOffset}}class r1{constructor(e,t){this.view=e,this.handleDOMChange=t,this.queue=[],this.flushingSoon=-1,this.observer=null,this.currentSelection=new t1,this.onCharData=null,this.suppressingSelectionUpdates=!1,this.lastChangedTextNode=null,this.observer=window.MutationObserver&&new window.MutationObserver(s=>{for(let n=0;n<s.length;n++)this.queue.push(s[n]);xt&&Cr<=11&&s.some(n=>n.type=="childList"&&n.removedNodes.length||n.type=="characterData"&&n.oldValue.length>n.target.nodeValue.length)?this.flushSoon():this.flush()}),e1&&(this.onCharData=s=>{this.queue.push({target:s.target,type:"characterData",oldValue:s.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this)}flushSoon(){this.flushingSoon<0&&(this.flushingSoon=window.setTimeout(()=>{this.flushingSoon=-1,this.flush()},20))}forceFlush(){this.flushingSoon>-1&&(window.clearTimeout(this.flushingSoon),this.flushingSoon=-1,this.flush())}start(){this.observer&&(this.observer.takeRecords(),this.observer.observe(this.view.dom,Zv)),this.onCharData&&this.view.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.connectSelection()}stop(){if(this.observer){let e=this.observer.takeRecords();if(e.length){for(let t=0;t<e.length;t++)this.queue.push(e[t]);window.setTimeout(()=>this.flush(),20)}this.observer.disconnect()}this.onCharData&&this.view.dom.removeEventListener("DOMCharacterDataModified",this.onCharData),this.disconnectSelection()}connectSelection(){this.view.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}disconnectSelection(){this.view.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange)}suppressSelectionUpdates(){this.suppressingSelectionUpdates=!0,setTimeout(()=>this.suppressingSelectionUpdates=!1,50)}onSelectionChange(){if(Bd(this.view)){if(this.suppressingSelectionUpdates)return ir(this.view);if(xt&&Cr<=11&&!this.view.state.selection.empty){let e=this.view.domSelectionRange();if(e.focusNode&&gs(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset))return this.flushSoon()}this.flush()}}setCurSelection(){this.currentSelection.set(this.view.domSelectionRange())}ignoreSelectionChange(e){if(!e.focusNode)return!0;let t=new Set,s;for(let i=e.focusNode;i;i=Hs(i))t.add(i);for(let i=e.anchorNode;i;i=Hs(i))if(t.has(i)){s=i;break}let n=s&&this.view.docView.nearestDesc(s);if(n&&n.ignoreMutation({type:"selection",target:s.nodeType==3?s.parentNode:s}))return this.setCurSelection(),!0}pendingRecords(){if(this.observer)for(let e of this.observer.takeRecords())this.queue.push(e);return this.queue}flush(){let{view:e}=this;if(!e.docView||this.flushingSoon>-1)return;let t=this.pendingRecords();t.length&&(this.queue=[]);let s=e.domSelectionRange(),n=!this.suppressingSelectionUpdates&&!this.currentSelection.eq(s)&&Bd(e)&&!this.ignoreSelectionChange(s),i=-1,a=-1,l=!1,c=[];if(e.editable)for(let u=0;u<t.length;u++){let h=this.registerMutation(t[u],c);h&&(i=i<0?h.from:Math.min(h.from,i),a=a<0?h.to:Math.max(h.to,a),h.typeOver&&(l=!0))}if(Pt&&c.length){let u=c.filter(h=>h.nodeName=="BR");if(u.length==2){let[h,f]=u;h.parentNode&&h.parentNode.parentNode==f.parentNode?f.remove():h.remove()}else{let{focusNode:h}=this.currentSelection;for(let f of u){let p=f.parentNode;p&&p.nodeName=="LI"&&(!h||i1(e,h)!=p)&&f.remove()}}}let d=null;i<0&&n&&e.input.lastFocus>Date.now()-200&&Math.max(e.input.lastTouch,e.input.lastClick.time)<Date.now()-300&&Wo(s)&&(d=nc(e))&&d.eq(de.near(e.state.doc.resolve(0),1))?(e.input.lastFocus=0,ir(e),this.currentSelection.set(s),e.scrollToSelection()):(i>-1||n)&&(i>-1&&(e.docView.markDirty(i,a),s1(e)),this.handleDOMChange(i,a,l,c),e.docView&&e.docView.dirty?e.updateState(e.state):this.currentSelection.eq(s)||ir(e),this.currentSelection.set(s))}registerMutation(e,t){if(t.indexOf(e.target)>-1)return null;let s=this.view.docView.nearestDesc(e.target);if(e.type=="attributes"&&(s==this.view.docView||e.attributeName=="contenteditable"||e.attributeName=="style"&&!e.oldValue&&!e.target.getAttribute("style"))||!s||s.ignoreMutation(e))return null;if(e.type=="childList"){for(let u=0;u<e.addedNodes.length;u++){let h=e.addedNodes[u];t.push(h),h.nodeType==3&&(this.lastChangedTextNode=h)}if(s.contentDOM&&s.contentDOM!=s.dom&&!s.contentDOM.contains(e.target))return{from:s.posBefore,to:s.posAfter};let n=e.previousSibling,i=e.nextSibling;if(xt&&Cr<=11&&e.addedNodes.length)for(let u=0;u<e.addedNodes.length;u++){let{previousSibling:h,nextSibling:f}=e.addedNodes[u];(!h||Array.prototype.indexOf.call(e.addedNodes,h)<0)&&(n=h),(!f||Array.prototype.indexOf.call(e.addedNodes,f)<0)&&(i=f)}let a=n&&n.parentNode==e.target?Qe(n)+1:0,l=s.localPosFromDOM(e.target,a,-1),c=i&&i.parentNode==e.target?Qe(i):e.target.childNodes.length,d=s.localPosFromDOM(e.target,c,1);return{from:l,to:d}}else return e.type=="attributes"?{from:s.posAtStart-s.border,to:s.posAtEnd+s.border}:(this.lastChangedTextNode=e.target,{from:s.posAtStart,to:s.posAtEnd,typeOver:e.target.nodeValue==e.oldValue})}}let Yd=new WeakMap,Jd=!1;function s1(r){if(!Yd.has(r)&&(Yd.set(r,null),["normal","nowrap","pre-line"].indexOf(getComputedStyle(r.dom).whiteSpace)!==-1)){if(r.requiresGeckoHackNode=Pt,Jd)return;console.warn("ProseMirror expects the CSS white-space property to be set, preferably to 'pre-wrap'. It is recommended to load style/prosemirror.css from the prosemirror-view package."),Jd=!0}}function Xd(r,e){let t=e.startContainer,s=e.startOffset,n=e.endContainer,i=e.endOffset,a=r.domAtPos(r.state.selection.anchor);return gs(a.node,a.offset,n,i)&&([t,s,n,i]=[n,i,t,s]),{anchorNode:t,anchorOffset:s,focusNode:n,focusOffset:i}}function n1(r,e){if(e.getComposedRanges){let n=e.getComposedRanges(r.root)[0];if(n)return Xd(r,n)}let t;function s(n){n.preventDefault(),n.stopImmediatePropagation(),t=n.getTargetRanges()[0]}return r.dom.addEventListener("beforeinput",s,!0),document.execCommand("indent"),r.dom.removeEventListener("beforeinput",s,!0),t?Xd(r,t):null}function i1(r,e){for(let t=e.parentNode;t&&t!=r.dom;t=t.parentNode){let s=r.docView.nearestDesc(t,!0);if(s&&s.node.isBlock)return t}return null}function o1(r,e,t){let{node:s,fromOffset:n,toOffset:i,from:a,to:l}=r.docView.parseRange(e,t),c=r.domSelectionRange(),d,u=c.anchorNode;if(u&&r.dom.contains(u.nodeType==1?u:u.parentNode)&&(d=[{node:u,offset:c.anchorOffset}],Wo(c)||d.push({node:c.focusNode,offset:c.focusOffset})),st&&r.input.lastKeyCode===8)for(let y=i;y>n;y--){let x=s.childNodes[y-1],S=x.pmViewDesc;if(x.nodeName=="BR"&&!S){i=y;break}if(!S||S.size)break}let h=r.state.doc,f=r.someProp("domParser")||Ar.fromSchema(r.state.schema),p=h.resolve(a),m=null,g=f.parse(s,{topNode:p.parent,topMatch:p.parent.contentMatchAt(p.index()),topOpen:!0,from:n,to:i,preserveWhitespace:p.parent.type.whitespace=="pre"?"full":!0,findPositions:d,ruleFromNode:a1,context:p});if(d&&d[0].pos!=null){let y=d[0].pos,x=d[1]&&d[1].pos;x==null&&(x=y),m={anchor:y+a,head:x+a}}return{doc:g,sel:m,from:a,to:l}}function a1(r){let e=r.pmViewDesc;if(e)return e.parseRule();if(r.nodeName=="BR"&&r.parentNode){if(lt&&/^(ul|ol)$/i.test(r.parentNode.nodeName)){let t=document.createElement("div");return t.appendChild(document.createElement("li")),{skip:t}}else if(r.parentNode.lastChild==r||lt&&/^(tr|table)$/i.test(r.parentNode.nodeName))return{ignore:!0}}else if(r.nodeName=="IMG"&&r.getAttribute("mark-placeholder"))return{ignore:!0};return null}const l1=/^(a|abbr|acronym|b|bd[io]|big|br|button|cite|code|data(list)?|del|dfn|em|i|ins|kbd|label|map|mark|meter|output|q|ruby|s|samp|small|span|strong|su[bp]|time|u|tt|var)$/i;function c1(r,e,t,s,n){let i=r.input.compositionPendingChanges||(r.composing?r.input.compositionID:0);if(r.input.compositionPendingChanges=0,e<0){let w=r.input.lastSelectionTime>Date.now()-50?r.input.lastSelectionOrigin:null,v=nc(r,w);if(v&&!r.state.selection.eq(v)){if(st&&rr&&r.input.lastKeyCode===13&&Date.now()-100<r.input.lastKeyCodeTime&&r.someProp("handleKeyDown",E=>E(r,Vr(13,"Enter"))))return;let M=r.state.tr.setSelection(v);w=="pointer"?M.setMeta("pointer",!0):w=="key"&&M.scrollIntoView(),i&&M.setMeta("composition",i),r.dispatch(M)}return}let a=r.state.doc.resolve(e),l=a.sharedDepth(t);e=a.before(l+1),t=r.state.doc.resolve(t).after(l+1);let c=r.state.selection,d=o1(r,e,t),u=r.state.doc,h=u.slice(d.from,d.to),f,p;r.input.lastKeyCode===8&&Date.now()-100<r.input.lastKeyCodeTime?(f=r.state.selection.to,p="end"):(f=r.state.selection.from,p="start"),r.input.lastKeyCode=null;let m=h1(h.content,d.doc.content,d.from,f,p);if(m&&r.input.domChangeCount++,(Vs&&r.input.lastIOSEnter>Date.now()-225||rr)&&n.some(w=>w.nodeType==1&&!l1.test(w.nodeName))&&(!m||m.endA>=m.endB)&&r.someProp("handleKeyDown",w=>w(r,Vr(13,"Enter")))){r.input.lastIOSEnter=0;return}if(!m)if(s&&c instanceof ce&&!c.empty&&c.$head.sameParent(c.$anchor)&&!r.composing&&!(d.sel&&d.sel.anchor!=d.sel.head))m={start:c.from,endA:c.to,endB:c.to};else{if(d.sel){let w=Qd(r,r.state.doc,d.sel);if(w&&!w.eq(r.state.selection)){let v=r.state.tr.setSelection(w);i&&v.setMeta("composition",i),r.dispatch(v)}}return}r.state.selection.from<r.state.selection.to&&m.start==m.endB&&r.state.selection instanceof ce&&(m.start>r.state.selection.from&&m.start<=r.state.selection.from+2&&r.state.selection.from>=d.from?m.start=r.state.selection.from:m.endA<r.state.selection.to&&m.endA>=r.state.selection.to-2&&r.state.selection.to<=d.to&&(m.endB+=r.state.selection.to-m.endA,m.endA=r.state.selection.to)),xt&&Cr<=11&&m.endB==m.start+1&&m.endA==m.start&&m.start>d.from&&d.doc.textBetween(m.start-d.from-1,m.start-d.from+1)=="  "&&(m.start--,m.endA--,m.endB--);let g=d.doc.resolveNoCache(m.start-d.from),y=d.doc.resolveNoCache(m.endB-d.from),x=u.resolve(m.start),S=g.sameParent(y)&&g.parent.inlineContent&&x.end()>=m.endA,C;if((Vs&&r.input.lastIOSEnter>Date.now()-225&&(!S||n.some(w=>w.nodeName=="DIV"||w.nodeName=="P"))||!S&&g.pos<d.doc.content.size&&(!g.sameParent(y)||!g.parent.inlineContent)&&!/\S/.test(d.doc.textBetween(g.pos,y.pos,"",""))&&(C=de.findFrom(d.doc.resolve(g.pos+1),1,!0))&&C.head>g.pos)&&r.someProp("handleKeyDown",w=>w(r,Vr(13,"Enter")))){r.input.lastIOSEnter=0;return}if(r.state.selection.anchor>m.start&&u1(u,m.start,m.endA,g,y)&&r.someProp("handleKeyDown",w=>w(r,Vr(8,"Backspace")))){rr&&st&&r.domObserver.suppressSelectionUpdates();return}st&&m.endB==m.start&&(r.input.lastChromeDelete=Date.now()),rr&&!S&&g.start()!=y.start()&&y.parentOffset==0&&g.depth==y.depth&&d.sel&&d.sel.anchor==d.sel.head&&d.sel.head==m.endA&&(m.endB-=2,y=d.doc.resolveNoCache(m.endB-d.from),setTimeout(()=>{r.someProp("handleKeyDown",function(w){return w(r,Vr(13,"Enter"))})},20));let k=m.start,j=m.endA,O=w=>{let v=w||r.state.tr.replace(k,j,d.doc.slice(m.start-d.from,m.endB-d.from));if(d.sel){let M=Qd(r,v.doc,d.sel);M&&!(st&&r.composing&&M.empty&&(m.start!=m.endB||r.input.lastChromeDelete<Date.now()-100)&&(M.head==k||M.head==v.mapping.map(j)-1)||xt&&M.empty&&M.head==k)&&v.setSelection(M)}return i&&v.setMeta("composition",i),v.scrollIntoView()},N;if(S){if(g.pos==y.pos){xt&&Cr<=11&&g.parentOffset==0&&(r.domObserver.suppressSelectionUpdates(),setTimeout(()=>ir(r),20));let w=O(r.state.tr.delete(k,j)),v=u.resolve(m.start).marksAcross(u.resolve(m.endA));v&&w.ensureMarks(v),r.dispatch(w)}else if(m.endA==m.endB&&(N=d1(g.parent.content.cut(g.parentOffset,y.parentOffset),x.parent.content.cut(x.parentOffset,m.endA-x.start())))){let w=O(r.state.tr);N.type=="add"?w.addMark(k,j,N.mark):w.removeMark(k,j,N.mark),r.dispatch(w)}else if(g.parent.child(g.index()).isText&&g.index()==y.index()-(y.textOffset?0:1)){let w=g.parent.textBetween(g.parentOffset,y.parentOffset),v=()=>O(r.state.tr.insertText(w,k,j));r.someProp("handleTextInput",M=>M(r,k,j,w,v))||r.dispatch(v())}}else r.dispatch(O())}function Qd(r,e,t){return Math.max(t.anchor,t.head)>e.content.size?null:ic(r,e.resolve(t.anchor),e.resolve(t.head))}function d1(r,e){let t=r.firstChild.marks,s=e.firstChild.marks,n=t,i=s,a,l,c;for(let u=0;u<s.length;u++)n=s[u].removeFromSet(n);for(let u=0;u<t.length;u++)i=t[u].removeFromSet(i);if(n.length==1&&i.length==0)l=n[0],a="add",c=u=>u.mark(l.addToSet(u.marks));else if(n.length==0&&i.length==1)l=i[0],a="remove",c=u=>u.mark(l.removeFromSet(u.marks));else return null;let d=[];for(let u=0;u<e.childCount;u++)d.push(c(e.child(u)));if(z.from(d).eq(r))return{mark:l,type:a}}function u1(r,e,t,s,n){if(t-e<=n.pos-s.pos||va(s,!0,!1)<n.pos)return!1;let i=r.resolve(e);if(!s.parent.isTextblock){let l=i.nodeAfter;return l!=null&&t==e+l.nodeSize}if(i.parentOffset<i.parent.content.size||!i.parent.isTextblock)return!1;let a=r.resolve(va(i,!0,!0));return!a.parent.isTextblock||a.pos>t||va(a,!0,!1)<t?!1:s.parent.content.cut(s.parentOffset).eq(a.parent.content)}function va(r,e,t){let s=r.depth,n=e?r.end():r.pos;for(;s>0&&(e||r.indexAfter(s)==r.node(s).childCount);)s--,n++,e=!1;if(t){let i=r.node(s).maybeChild(r.indexAfter(s));for(;i&&!i.isLeaf;)i=i.firstChild,n++}return n}function h1(r,e,t,s,n){let i=r.findDiffStart(e,t);if(i==null)return null;let{a,b:l}=r.findDiffEnd(e,t+r.size,t+e.size);if(n=="end"){let c=Math.max(0,i-Math.min(a,l));s-=a+c-i}if(a<i&&r.size<e.size){let c=s<=i&&s>=a?i-s:0;i-=c,i&&i<e.size&&Zd(e.textBetween(i-1,i+1))&&(i+=c?1:-1),l=i+(l-a),a=i}else if(l<i){let c=s<=i&&s>=l?i-s:0;i-=c,i&&i<r.size&&Zd(r.textBetween(i-1,i+1))&&(i+=c?1:-1),a=i+(a-l),l=i}return{start:i,endA:a,endB:l}}function Zd(r){if(r.length!=2)return!1;let e=r.charCodeAt(0),t=r.charCodeAt(1);return e>=56320&&e<=57343&&t>=55296&&t<=56319}class jp{constructor(e,t){this._root=null,this.focused=!1,this.trackWrites=null,this.mounted=!1,this.markCursor=null,this.cursorWrapper=null,this.lastSelectedViewDesc=void 0,this.input=new Tv,this.prevDirectPlugins=[],this.pluginViews=[],this.requiresGeckoHackNode=!1,this.dragging=null,this._props=t,this.state=t.state,this.directPlugins=t.plugins||[],this.directPlugins.forEach(nu),this.dispatch=this.dispatch.bind(this),this.dom=e&&e.mount||document.createElement("div"),e&&(e.appendChild?e.appendChild(this.dom):typeof e=="function"?e(this.dom):e.mount&&(this.mounted=!0)),this.editable=ru(this),tu(this),this.nodeViews=su(this),this.docView=Id(this.state.doc,eu(this),wa(this),this.dom,this),this.domObserver=new r1(this,(s,n,i,a)=>c1(this,s,n,i,a)),this.domObserver.start(),Ov(this),this.updatePluginViews()}get composing(){return this.input.composing}get props(){if(this._props.state!=this.state){let e=this._props;this._props={};for(let t in e)this._props[t]=e[t];this._props.state=this.state}return this._props}update(e){e.handleDOMEvents!=this._props.handleDOMEvents&&xl(this);let t=this._props;this._props=e,e.plugins&&(e.plugins.forEach(nu),this.directPlugins=e.plugins),this.updateStateInner(e.state,t)}setProps(e){let t={};for(let s in this._props)t[s]=this._props[s];t.state=this.state;for(let s in e)t[s]=e[s];this.update(t)}updateState(e){this.updateStateInner(e,this._props)}updateStateInner(e,t){var s;let n=this.state,i=!1,a=!1;e.storedMarks&&this.composing&&(gp(this),a=!0),this.state=e;let l=n.plugins!=e.plugins||this._props.plugins!=t.plugins;if(l||this._props.plugins!=t.plugins||this._props.nodeViews!=t.nodeViews){let p=su(this);p1(p,this.nodeViews)&&(this.nodeViews=p,i=!0)}(l||t.handleDOMEvents!=this._props.handleDOMEvents)&&xl(this),this.editable=ru(this),tu(this);let c=wa(this),d=eu(this),u=n.plugins!=e.plugins&&!n.doc.eq(e.doc)?"reset":e.scrollToSelection>n.scrollToSelection?"to selection":"preserve",h=i||!this.docView.matchesNode(e.doc,d,c);(h||!e.selection.eq(n.selection))&&(a=!0);let f=u=="preserve"&&a&&this.dom.style.overflowAnchor==null&&qw(this);if(a){this.domObserver.stop();let p=h&&(xt||st)&&!this.composing&&!n.selection.empty&&!e.selection.empty&&f1(n.selection,e.selection);if(h){let m=st?this.trackWrites=this.domSelectionRange().focusNode:null;this.composing&&(this.input.compositionNode=Vv(this)),(i||!this.docView.update(e.doc,d,c,this))&&(this.docView.updateOuterDeco(d),this.docView.destroy(),this.docView=Id(e.doc,d,c,this.dom,this)),m&&!this.trackWrites&&(p=!0)}p||!(this.input.mouseDown&&this.domObserver.currentSelection.eq(this.domSelectionRange())&&gv(this))?ir(this,p):(np(this,e.selection),this.domObserver.setCurSelection()),this.domObserver.start()}this.updatePluginViews(n),!((s=this.dragging)===null||s===void 0)&&s.node&&!n.doc.eq(e.doc)&&this.updateDraggedNode(this.dragging,n),u=="reset"?this.dom.scrollTop=0:u=="to selection"?this.scrollToSelection():f&&Kw(f)}scrollToSelection(){let e=this.domSelectionRange().focusNode;if(!(!e||!this.dom.contains(e.nodeType==1?e:e.parentNode))){if(!this.someProp("handleScrollToSelection",t=>t(this)))if(this.state.selection instanceof se){let t=this.docView.domAfterPos(this.state.selection.from);t.nodeType==1&&Cd(this,t.getBoundingClientRect(),e)}else Cd(this,this.coordsAtPos(this.state.selection.head,1),e)}}destroyPluginViews(){let e;for(;e=this.pluginViews.pop();)e.destroy&&e.destroy()}updatePluginViews(e){if(!e||e.plugins!=this.state.plugins||this.directPlugins!=this.prevDirectPlugins){this.prevDirectPlugins=this.directPlugins,this.destroyPluginViews();for(let t=0;t<this.directPlugins.length;t++){let s=this.directPlugins[t];s.spec.view&&this.pluginViews.push(s.spec.view(this))}for(let t=0;t<this.state.plugins.length;t++){let s=this.state.plugins[t];s.spec.view&&this.pluginViews.push(s.spec.view(this))}}else for(let t=0;t<this.pluginViews.length;t++){let s=this.pluginViews[t];s.update&&s.update(this,e)}}updateDraggedNode(e,t){let s=e.node,n=-1;if(this.state.doc.nodeAt(s.from)==s.node)n=s.from;else{let i=s.from+(this.state.doc.content.size-t.doc.content.size);(i>0&&this.state.doc.nodeAt(i))==s.node&&(n=i)}this.dragging=new yp(e.slice,e.move,n<0?void 0:se.create(this.state.doc,n))}someProp(e,t){let s=this._props&&this._props[e],n;if(s!=null&&(n=t?t(s):s))return n;for(let a=0;a<this.directPlugins.length;a++){let l=this.directPlugins[a].props[e];if(l!=null&&(n=t?t(l):l))return n}let i=this.state.plugins;if(i)for(let a=0;a<i.length;a++){let l=i[a].props[e];if(l!=null&&(n=t?t(l):l))return n}}hasFocus(){if(xt){let e=this.root.activeElement;if(e==this.dom)return!0;if(!e||!this.dom.contains(e))return!1;for(;e&&this.dom!=e&&this.dom.contains(e);){if(e.contentEditable=="false")return!1;e=e.parentElement}return!0}return this.root.activeElement==this.dom}focus(){this.domObserver.stop(),this.editable&&Gw(this.dom),ir(this),this.domObserver.start()}get root(){let e=this._root;if(e==null){for(let t=this.dom.parentNode;t;t=t.parentNode)if(t.nodeType==9||t.nodeType==11&&t.host)return t.getSelection||(Object.getPrototypeOf(t).getSelection=()=>t.ownerDocument.getSelection()),this._root=t}return e||document}updateRoot(){this._root=null}posAtCoords(e){return Zw(this,e)}coordsAtPos(e,t=1){return Jf(this,e,t)}domAtPos(e,t=0){return this.docView.domFromPos(e,t)}nodeDOM(e){let t=this.docView.descAt(e);return t?t.nodeDOM:null}posAtDOM(e,t,s=-1){let n=this.docView.posFromDOM(e,t,s);if(n==null)throw new RangeError("DOM position not inside the editor");return n}endOfTextblock(e,t){return nv(this,t||this.state,e)}pasteHTML(e,t){return Tn(this,"",e,!1,t||new ClipboardEvent("paste"))}pasteText(e,t){return Tn(this,e,null,!0,t||new ClipboardEvent("paste"))}serializeForClipboard(e){return oc(this,e)}destroy(){this.docView&&(Rv(this),this.destroyPluginViews(),this.mounted?(this.docView.update(this.state.doc,[],wa(this),this),this.dom.textContent=""):this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.docView.destroy(),this.docView=null,Pw())}get isDestroyed(){return this.docView==null}dispatchEvent(e){return Pv(this,e)}domSelectionRange(){let e=this.domSelection();return e?lt&&this.root.nodeType===11&&Bw(this.dom.ownerDocument)==this.dom&&n1(this,e)||e:{focusNode:null,focusOffset:0,anchorNode:null,anchorOffset:0}}domSelection(){return this.root.getSelection()}}jp.prototype.dispatch=function(r){let e=this._props.dispatchTransaction;e?e.call(this,r):this.updateState(this.state.apply(r))};function eu(r){let e=Object.create(null);return e.class="ProseMirror",e.contenteditable=String(r.editable),r.someProp("attributes",t=>{if(typeof t=="function"&&(t=t(r.state)),t)for(let s in t)s=="class"?e.class+=" "+t[s]:s=="style"?e.style=(e.style?e.style+";":"")+t[s]:!e[s]&&s!="contenteditable"&&s!="nodeName"&&(e[s]=String(t[s]))}),e.translate||(e.translate="no"),[Nt.node(0,r.state.doc.content.size,e)]}function tu(r){if(r.markCursor){let e=document.createElement("img");e.className="ProseMirror-separator",e.setAttribute("mark-placeholder","true"),e.setAttribute("alt",""),r.cursorWrapper={dom:e,deco:Nt.widget(r.state.selection.from,e,{raw:!0,marks:r.markCursor})}}else r.cursorWrapper=null}function ru(r){return!r.someProp("editable",e=>e(r.state)===!1)}function f1(r,e){let t=Math.min(r.$anchor.sharedDepth(r.head),e.$anchor.sharedDepth(e.head));return r.$anchor.start(t)!=e.$anchor.start(t)}function su(r){let e=Object.create(null);function t(s){for(let n in s)Object.prototype.hasOwnProperty.call(e,n)||(e[n]=s[n])}return r.someProp("nodeViews",t),r.someProp("markViews",t),e}function p1(r,e){let t=0,s=0;for(let n in r){if(r[n]!=e[n])return!0;t++}for(let n in e)s++;return t!=s}function nu(r){if(r.spec.state||r.spec.filterTransaction||r.spec.appendTransaction)throw new RangeError("Plugins passed directly to the view must not have a state component")}var Or={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},Gi={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},m1=typeof navigator<"u"&&/Mac/.test(navigator.platform),g1=typeof navigator<"u"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent);for(var Ze=0;Ze<10;Ze++)Or[48+Ze]=Or[96+Ze]=String(Ze);for(var Ze=1;Ze<=24;Ze++)Or[Ze+111]="F"+Ze;for(var Ze=65;Ze<=90;Ze++)Or[Ze]=String.fromCharCode(Ze+32),Gi[Ze]=String.fromCharCode(Ze);for(var Na in Or)Gi.hasOwnProperty(Na)||(Gi[Na]=Or[Na]);function x1(r){var e=m1&&r.metaKey&&r.shiftKey&&!r.ctrlKey&&!r.altKey||g1&&r.shiftKey&&r.key&&r.key.length==1||r.key=="Unidentified",t=!e&&r.key||(r.shiftKey?Gi:Or)[r.keyCode]||r.key||"Unidentified";return t=="Esc"&&(t="Escape"),t=="Del"&&(t="Delete"),t=="Left"&&(t="ArrowLeft"),t=="Up"&&(t="ArrowUp"),t=="Right"&&(t="ArrowRight"),t=="Down"&&(t="ArrowDown"),t}const y1=typeof navigator<"u"&&/Mac|iP(hone|[oa]d)/.test(navigator.platform),b1=typeof navigator<"u"&&/Win/.test(navigator.platform);function w1(r){let e=r.split(/-(?!$)/),t=e[e.length-1];t=="Space"&&(t=" ");let s,n,i,a;for(let l=0;l<e.length-1;l++){let c=e[l];if(/^(cmd|meta|m)$/i.test(c))a=!0;else if(/^a(lt)?$/i.test(c))s=!0;else if(/^(c|ctrl|control)$/i.test(c))n=!0;else if(/^s(hift)?$/i.test(c))i=!0;else if(/^mod$/i.test(c))y1?a=!0:n=!0;else throw new Error("Unrecognized modifier name: "+c)}return s&&(t="Alt-"+t),n&&(t="Ctrl-"+t),a&&(t="Meta-"+t),i&&(t="Shift-"+t),t}function v1(r){let e=Object.create(null);for(let t in r)e[w1(t)]=r[t];return e}function ja(r,e,t=!0){return e.altKey&&(r="Alt-"+r),e.ctrlKey&&(r="Ctrl-"+r),e.metaKey&&(r="Meta-"+r),t&&e.shiftKey&&(r="Shift-"+r),r}function N1(r){return new Je({props:{handleKeyDown:kp(r)}})}function kp(r){let e=v1(r);return function(t,s){let n=x1(s),i,a=e[ja(n,s)];if(a&&a(t.state,t.dispatch,t))return!0;if(n.length==1&&n!=" "){if(s.shiftKey){let l=e[ja(n,s,!1)];if(l&&l(t.state,t.dispatch,t))return!0}if((s.altKey||s.metaKey||s.ctrlKey)&&!(b1&&s.ctrlKey&&s.altKey)&&(i=Or[s.keyCode])&&i!=n){let l=e[ja(i,s)];if(l&&l(t.state,t.dispatch,t))return!0}}return!1}}const hc=(r,e)=>r.selection.empty?!1:(e&&e(r.tr.deleteSelection().scrollIntoView()),!0);function Sp(r,e){let{$cursor:t}=r.selection;return!t||(e?!e.endOfTextblock("backward",r):t.parentOffset>0)?null:t}const Ep=(r,e,t)=>{let s=Sp(r,t);if(!s)return!1;let n=fc(s);if(!n){let a=s.blockRange(),l=a&&Zs(a);return l==null?!1:(e&&e(r.tr.lift(a,l).scrollIntoView()),!0)}let i=n.nodeBefore;if(Pp(r,n,e,-1))return!0;if(s.parent.content.size==0&&(qs(i,"end")||se.isSelectable(i)))for(let a=s.depth;;a--){let l=Uo(r.doc,s.before(a),s.after(a),Q.empty);if(l&&l.slice.size<l.to-l.from){if(e){let c=r.tr.step(l);c.setSelection(qs(i,"end")?de.findFrom(c.doc.resolve(c.mapping.map(n.pos,-1)),-1):se.create(c.doc,n.pos-i.nodeSize)),e(c.scrollIntoView())}return!0}if(a==1||s.node(a-1).childCount>1)break}return i.isAtom&&n.depth==s.depth-1?(e&&e(r.tr.delete(n.pos-i.nodeSize,n.pos).scrollIntoView()),!0):!1},j1=(r,e,t)=>{let s=Sp(r,t);if(!s)return!1;let n=fc(s);return n?Ap(r,n,e):!1},k1=(r,e,t)=>{let s=Mp(r,t);if(!s)return!1;let n=pc(s);return n?Ap(r,n,e):!1};function Ap(r,e,t){let s=e.nodeBefore,n=s,i=e.pos-1;for(;!n.isTextblock;i--){if(n.type.spec.isolating)return!1;let u=n.lastChild;if(!u)return!1;n=u}let a=e.nodeAfter,l=a,c=e.pos+1;for(;!l.isTextblock;c++){if(l.type.spec.isolating)return!1;let u=l.firstChild;if(!u)return!1;l=u}let d=Uo(r.doc,i,c,Q.empty);if(!d||d.from!=i||d instanceof He&&d.slice.size>=c-i)return!1;if(t){let u=r.tr.step(d);u.setSelection(ce.create(u.doc,i)),t(u.scrollIntoView())}return!0}function qs(r,e,t=!1){for(let s=r;s;s=e=="start"?s.firstChild:s.lastChild){if(s.isTextblock)return!0;if(t&&s.childCount!=1)return!1}return!1}const Cp=(r,e,t)=>{let{$head:s,empty:n}=r.selection,i=s;if(!n)return!1;if(s.parent.isTextblock){if(t?!t.endOfTextblock("backward",r):s.parentOffset>0)return!1;i=fc(s)}let a=i&&i.nodeBefore;return!a||!se.isSelectable(a)?!1:(e&&e(r.tr.setSelection(se.create(r.doc,i.pos-a.nodeSize)).scrollIntoView()),!0)};function fc(r){if(!r.parent.type.spec.isolating)for(let e=r.depth-1;e>=0;e--){if(r.index(e)>0)return r.doc.resolve(r.before(e+1));if(r.node(e).type.spec.isolating)break}return null}function Mp(r,e){let{$cursor:t}=r.selection;return!t||(e?!e.endOfTextblock("forward",r):t.parentOffset<t.parent.content.size)?null:t}const Dp=(r,e,t)=>{let s=Mp(r,t);if(!s)return!1;let n=pc(s);if(!n)return!1;let i=n.nodeAfter;if(Pp(r,n,e,1))return!0;if(s.parent.content.size==0&&(qs(i,"start")||se.isSelectable(i))){let a=Uo(r.doc,s.before(),s.after(),Q.empty);if(a&&a.slice.size<a.to-a.from){if(e){let l=r.tr.step(a);l.setSelection(qs(i,"start")?de.findFrom(l.doc.resolve(l.mapping.map(n.pos)),1):se.create(l.doc,l.mapping.map(n.pos))),e(l.scrollIntoView())}return!0}}return i.isAtom&&n.depth==s.depth-1?(e&&e(r.tr.delete(n.pos,n.pos+i.nodeSize).scrollIntoView()),!0):!1},Tp=(r,e,t)=>{let{$head:s,empty:n}=r.selection,i=s;if(!n)return!1;if(s.parent.isTextblock){if(t?!t.endOfTextblock("forward",r):s.parentOffset<s.parent.content.size)return!1;i=pc(s)}let a=i&&i.nodeAfter;return!a||!se.isSelectable(a)?!1:(e&&e(r.tr.setSelection(se.create(r.doc,i.pos)).scrollIntoView()),!0)};function pc(r){if(!r.parent.type.spec.isolating)for(let e=r.depth-1;e>=0;e--){let t=r.node(e);if(r.index(e)+1<t.childCount)return r.doc.resolve(r.after(e+1));if(t.type.spec.isolating)break}return null}const S1=(r,e)=>{let t=r.selection,s=t instanceof se,n;if(s){if(t.node.isTextblock||!Pr(r.doc,t.from))return!1;n=t.from}else if(n=Bo(r.doc,t.from,-1),n==null)return!1;if(e){let i=r.tr.join(n);s&&i.setSelection(se.create(i.doc,n-r.doc.resolve(n).nodeBefore.nodeSize)),e(i.scrollIntoView())}return!0},E1=(r,e)=>{let t=r.selection,s;if(t instanceof se){if(t.node.isTextblock||!Pr(r.doc,t.to))return!1;s=t.to}else if(s=Bo(r.doc,t.to,1),s==null)return!1;return e&&e(r.tr.join(s).scrollIntoView()),!0},A1=(r,e)=>{let{$from:t,$to:s}=r.selection,n=t.blockRange(s),i=n&&Zs(n);return i==null?!1:(e&&e(r.tr.lift(n,i).scrollIntoView()),!0)},Op=(r,e)=>{let{$head:t,$anchor:s}=r.selection;return!t.parent.type.spec.code||!t.sameParent(s)?!1:(e&&e(r.tr.insertText(`
`).scrollIntoView()),!0)};function mc(r){for(let e=0;e<r.edgeCount;e++){let{type:t}=r.edge(e);if(t.isTextblock&&!t.hasRequiredAttrs())return t}return null}const C1=(r,e)=>{let{$head:t,$anchor:s}=r.selection;if(!t.parent.type.spec.code||!t.sameParent(s))return!1;let n=t.node(-1),i=t.indexAfter(-1),a=mc(n.contentMatchAt(i));if(!a||!n.canReplaceWith(i,i,a))return!1;if(e){let l=t.after(),c=r.tr.replaceWith(l,l,a.createAndFill());c.setSelection(de.near(c.doc.resolve(l),1)),e(c.scrollIntoView())}return!0},Rp=(r,e)=>{let t=r.selection,{$from:s,$to:n}=t;if(t instanceof kt||s.parent.inlineContent||n.parent.inlineContent)return!1;let i=mc(n.parent.contentMatchAt(n.indexAfter()));if(!i||!i.isTextblock)return!1;if(e){let a=(!s.parentOffset&&n.index()<n.parent.childCount?s:n).pos,l=r.tr.insert(a,i.createAndFill());l.setSelection(ce.create(l.doc,a+1)),e(l.scrollIntoView())}return!0},Ip=(r,e)=>{let{$cursor:t}=r.selection;if(!t||t.parent.content.size)return!1;if(t.depth>1&&t.after()!=t.end(-1)){let i=t.before();if(nr(r.doc,i))return e&&e(r.tr.split(i).scrollIntoView()),!0}let s=t.blockRange(),n=s&&Zs(s);return n==null?!1:(e&&e(r.tr.lift(s,n).scrollIntoView()),!0)};function M1(r){return(e,t)=>{let{$from:s,$to:n}=e.selection;if(e.selection instanceof se&&e.selection.node.isBlock)return!s.parentOffset||!nr(e.doc,s.pos)?!1:(t&&t(e.tr.split(s.pos).scrollIntoView()),!0);if(!s.depth)return!1;let i=[],a,l,c=!1,d=!1;for(let p=s.depth;;p--)if(s.node(p).isBlock){c=s.end(p)==s.pos+(s.depth-p),d=s.start(p)==s.pos-(s.depth-p),l=mc(s.node(p-1).contentMatchAt(s.indexAfter(p-1))),i.unshift(c&&l?{type:l}:null),a=p;break}else{if(p==1)return!1;i.unshift(null)}let u=e.tr;(e.selection instanceof ce||e.selection instanceof kt)&&u.deleteSelection();let h=u.mapping.map(s.pos),f=nr(u.doc,h,i.length,i);if(f||(i[0]=l?{type:l}:null,f=nr(u.doc,h,i.length,i)),!f)return!1;if(u.split(h,i.length,i),!c&&d&&s.node(a).type!=l){let p=u.mapping.map(s.before(a)),m=u.doc.resolve(p);l&&s.node(a-1).canReplaceWith(m.index(),m.index()+1,l)&&u.setNodeMarkup(u.mapping.map(s.before(a)),l)}return t&&t(u.scrollIntoView()),!0}}const D1=M1(),T1=(r,e)=>{let{$from:t,to:s}=r.selection,n,i=t.sharedDepth(s);return i==0?!1:(n=t.before(i),e&&e(r.tr.setSelection(se.create(r.doc,n))),!0)};function O1(r,e,t){let s=e.nodeBefore,n=e.nodeAfter,i=e.index();return!s||!n||!s.type.compatibleContent(n.type)?!1:!s.content.size&&e.parent.canReplace(i-1,i)?(t&&t(r.tr.delete(e.pos-s.nodeSize,e.pos).scrollIntoView()),!0):!e.parent.canReplace(i,i+1)||!(n.isTextblock||Pr(r.doc,e.pos))?!1:(t&&t(r.tr.join(e.pos).scrollIntoView()),!0)}function Pp(r,e,t,s){let n=e.nodeBefore,i=e.nodeAfter,a,l,c=n.type.spec.isolating||i.type.spec.isolating;if(!c&&O1(r,e,t))return!0;let d=!c&&e.parent.canReplace(e.index(),e.index()+1);if(d&&(a=(l=n.contentMatchAt(n.childCount)).findWrapping(i.type))&&l.matchType(a[0]||i.type).validEnd){if(t){let p=e.pos+i.nodeSize,m=z.empty;for(let x=a.length-1;x>=0;x--)m=z.from(a[x].create(null,m));m=z.from(n.copy(m));let g=r.tr.step(new Ke(e.pos-1,p,e.pos,p,new Q(m,1,0),a.length,!0)),y=g.doc.resolve(p+2*a.length);y.nodeAfter&&y.nodeAfter.type==n.type&&Pr(g.doc,y.pos)&&g.join(y.pos),t(g.scrollIntoView())}return!0}let u=i.type.spec.isolating||s>0&&c?null:de.findFrom(e,1),h=u&&u.$from.blockRange(u.$to),f=h&&Zs(h);if(f!=null&&f>=e.depth)return t&&t(r.tr.lift(h,f).scrollIntoView()),!0;if(d&&qs(i,"start",!0)&&qs(n,"end")){let p=n,m=[];for(;m.push(p),!p.isTextblock;)p=p.lastChild;let g=i,y=1;for(;!g.isTextblock;g=g.firstChild)y++;if(p.canReplace(p.childCount,p.childCount,g.content)){if(t){let x=z.empty;for(let C=m.length-1;C>=0;C--)x=z.from(m[C].copy(x));let S=r.tr.step(new Ke(e.pos-m.length,e.pos+i.nodeSize,e.pos+y,e.pos+i.nodeSize-y,new Q(x,m.length,0),0,!0));t(S.scrollIntoView())}return!0}}return!1}function Lp(r){return function(e,t){let s=e.selection,n=r<0?s.$from:s.$to,i=n.depth;for(;n.node(i).isInline;){if(!i)return!1;i--}return n.node(i).isTextblock?(t&&t(e.tr.setSelection(ce.create(e.doc,r<0?n.start(i):n.end(i)))),!0):!1}}const R1=Lp(-1),I1=Lp(1);function P1(r,e=null){return function(t,s){let{$from:n,$to:i}=t.selection,a=n.blockRange(i),l=a&&tc(a,r,e);return l?(s&&s(t.tr.wrap(a,l).scrollIntoView()),!0):!1}}function iu(r,e=null){return function(t,s){let n=!1;for(let i=0;i<t.selection.ranges.length&&!n;i++){let{$from:{pos:a},$to:{pos:l}}=t.selection.ranges[i];t.doc.nodesBetween(a,l,(c,d)=>{if(n)return!1;if(!(!c.isTextblock||c.hasMarkup(r,e)))if(c.type==r)n=!0;else{let u=t.doc.resolve(d),h=u.index();n=u.parent.canReplaceWith(h,h+1,r)}})}if(!n)return!1;if(s){let i=t.tr;for(let a=0;a<t.selection.ranges.length;a++){let{$from:{pos:l},$to:{pos:c}}=t.selection.ranges[a];i.setBlockType(l,c,r,e)}s(i.scrollIntoView())}return!0}}function gc(...r){return function(e,t,s){for(let n=0;n<r.length;n++)if(r[n](e,t,s))return!0;return!1}}gc(hc,Ep,Cp);gc(hc,Dp,Tp);gc(Op,Rp,Ip,D1);typeof navigator<"u"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):typeof os<"u"&&os.platform&&os.platform()=="darwin";function L1(r,e=null){return function(t,s){let{$from:n,$to:i}=t.selection,a=n.blockRange(i);if(!a)return!1;let l=s?t.tr:null;return $1(l,a,r,e)?(s&&s(l.scrollIntoView()),!0):!1}}function $1(r,e,t,s=null){let n=!1,i=e,a=e.$from.doc;if(e.depth>=2&&e.$from.node(e.depth-1).type.compatibleContent(t)&&e.startIndex==0){if(e.$from.index(e.depth-1)==0)return!1;let c=a.resolve(e.start-2);i=new Ui(c,c,e.depth),e.endIndex<e.parent.childCount&&(e=new Ui(e.$from,a.resolve(e.$to.end(e.depth)),e.depth)),n=!0}let l=tc(i,t,s,e);return l?(r&&_1(r,e,l,n,t),!0):!1}function _1(r,e,t,s,n){let i=z.empty;for(let u=t.length-1;u>=0;u--)i=z.from(t[u].type.create(t[u].attrs,i));r.step(new Ke(e.start-(s?2:0),e.end,e.start,e.end,new Q(i,0,0),t.length,!0));let a=0;for(let u=0;u<t.length;u++)t[u].type==n&&(a=u+1);let l=t.length-a,c=e.start+t.length-(s?2:0),d=e.parent;for(let u=e.startIndex,h=e.endIndex,f=!0;u<h;u++,f=!1)!f&&nr(r.doc,c,l)&&(r.split(c,l),c+=2*l),c+=d.child(u).nodeSize;return r}function F1(r){return function(e,t){let{$from:s,$to:n}=e.selection,i=s.blockRange(n,a=>a.childCount>0&&a.firstChild.type==r);return i?t?s.node(i.depth-1).type==r?B1(e,t,r,i):U1(e,t,i):!0:!1}}function B1(r,e,t,s){let n=r.tr,i=s.end,a=s.$to.end(s.depth);i<a&&(n.step(new Ke(i-1,a,i,a,new Q(z.from(t.create(null,s.parent.copy())),1,0),1,!0)),s=new Ui(n.doc.resolve(s.$from.pos),n.doc.resolve(a),s.depth));const l=Zs(s);if(l==null)return!1;n.lift(s,l);let c=n.doc.resolve(n.mapping.map(i,-1)-1);return Pr(n.doc,c.pos)&&c.nodeBefore.type==c.nodeAfter.type&&n.join(c.pos),e(n.scrollIntoView()),!0}function U1(r,e,t){let s=r.tr,n=t.parent;for(let p=t.end,m=t.endIndex-1,g=t.startIndex;m>g;m--)p-=n.child(m).nodeSize,s.delete(p-1,p+1);let i=s.doc.resolve(t.start),a=i.nodeAfter;if(s.mapping.map(t.end)!=t.start+i.nodeAfter.nodeSize)return!1;let l=t.startIndex==0,c=t.endIndex==n.childCount,d=i.node(-1),u=i.index(-1);if(!d.canReplace(u+(l?0:1),u+1,a.content.append(c?z.empty:z.from(n))))return!1;let h=i.pos,f=h+a.nodeSize;return s.step(new Ke(h-(l?1:0),f+(c?1:0),h+1,f-1,new Q((l?z.empty:z.from(n.copy(z.empty))).append(c?z.empty:z.from(n.copy(z.empty))),l?0:1,c?0:1),l?0:1)),e(s.scrollIntoView()),!0}function z1(r){return function(e,t){let{$from:s,$to:n}=e.selection,i=s.blockRange(n,d=>d.childCount>0&&d.firstChild.type==r);if(!i)return!1;let a=i.startIndex;if(a==0)return!1;let l=i.parent,c=l.child(a-1);if(c.type!=r)return!1;if(t){let d=c.lastChild&&c.lastChild.type==l.type,u=z.from(d?r.create():null),h=new Q(z.from(r.create(null,z.from(l.type.create(null,u)))),d?3:1,0),f=i.start,p=i.end;t(e.tr.step(new Ke(f-(d?3:1),p,f,p,h,1,!0)).scrollIntoView())}return!0}}function qo(r){const{state:e,transaction:t}=r;let{selection:s}=t,{doc:n}=t,{storedMarks:i}=t;return{...e,apply:e.apply.bind(e),applyTransaction:e.applyTransaction.bind(e),plugins:e.plugins,schema:e.schema,reconfigure:e.reconfigure.bind(e),toJSON:e.toJSON.bind(e),get storedMarks(){return i},get selection(){return s},get doc(){return n},get tr(){return s=t.selection,n=t.doc,i=t.storedMarks,t}}}class Ko{constructor(e){this.editor=e.editor,this.rawCommands=this.editor.extensionManager.commands,this.customState=e.state}get hasCustomState(){return!!this.customState}get state(){return this.customState||this.editor.state}get commands(){const{rawCommands:e,editor:t,state:s}=this,{view:n}=t,{tr:i}=s,a=this.buildProps(i);return Object.fromEntries(Object.entries(e).map(([l,c])=>[l,(...u)=>{const h=c(...u)(a);return!i.getMeta("preventDispatch")&&!this.hasCustomState&&n.dispatch(i),h}]))}get chain(){return()=>this.createChain()}get can(){return()=>this.createCan()}createChain(e,t=!0){const{rawCommands:s,editor:n,state:i}=this,{view:a}=n,l=[],c=!!e,d=e||i.tr,u=()=>(!c&&t&&!d.getMeta("preventDispatch")&&!this.hasCustomState&&a.dispatch(d),l.every(f=>f===!0)),h={...Object.fromEntries(Object.entries(s).map(([f,p])=>[f,(...g)=>{const y=this.buildProps(d,t),x=p(...g)(y);return l.push(x),h}])),run:u};return h}createCan(e){const{rawCommands:t,state:s}=this,n=!1,i=e||s.tr,a=this.buildProps(i,n);return{...Object.fromEntries(Object.entries(t).map(([c,d])=>[c,(...u)=>d(...u)({...a,dispatch:void 0})])),chain:()=>this.createChain(i,n)}}buildProps(e,t=!0){const{rawCommands:s,editor:n,state:i}=this,{view:a}=n,l={tr:e,editor:n,view:a,state:qo({state:i,transaction:e}),dispatch:t?()=>{}:void 0,chain:()=>this.createChain(e,t),can:()=>this.createCan(e),get commands(){return Object.fromEntries(Object.entries(s).map(([c,d])=>[c,(...u)=>d(...u)(l)]))}};return l}}class W1{constructor(){this.callbacks={}}on(e,t){return this.callbacks[e]||(this.callbacks[e]=[]),this.callbacks[e].push(t),this}emit(e,...t){const s=this.callbacks[e];return s&&s.forEach(n=>n.apply(this,t)),this}off(e,t){const s=this.callbacks[e];return s&&(t?this.callbacks[e]=s.filter(n=>n!==t):delete this.callbacks[e]),this}once(e,t){const s=(...n)=>{this.off(e,s),t.apply(this,n)};return this.on(e,s)}removeAllListeners(){this.callbacks={}}}function ee(r,e,t){return r.config[e]===void 0&&r.parent?ee(r.parent,e,t):typeof r.config[e]=="function"?r.config[e].bind({...t,parent:r.parent?ee(r.parent,e,t):null}):r.config[e]}function Go(r){const e=r.filter(n=>n.type==="extension"),t=r.filter(n=>n.type==="node"),s=r.filter(n=>n.type==="mark");return{baseExtensions:e,nodeExtensions:t,markExtensions:s}}function $p(r){const e=[],{nodeExtensions:t,markExtensions:s}=Go(r),n=[...t,...s],i={default:null,rendered:!0,renderHTML:null,parseHTML:null,keepOnSplit:!0,isRequired:!1};return r.forEach(a=>{const l={name:a.name,options:a.options,storage:a.storage,extensions:n},c=ee(a,"addGlobalAttributes",l);if(!c)return;c().forEach(u=>{u.types.forEach(h=>{Object.entries(u.attributes).forEach(([f,p])=>{e.push({type:h,name:f,attribute:{...i,...p}})})})})}),n.forEach(a=>{const l={name:a.name,options:a.options,storage:a.storage},c=ee(a,"addAttributes",l);if(!c)return;const d=c();Object.entries(d).forEach(([u,h])=>{const f={...i,...h};typeof(f==null?void 0:f.default)=="function"&&(f.default=f.default()),f!=null&&f.isRequired&&(f==null?void 0:f.default)===void 0&&delete f.default,e.push({type:a.name,name:u,attribute:f})})}),e}function Ye(r,e){if(typeof r=="string"){if(!e.nodes[r])throw Error(`There is no node type named '${r}'. Maybe you forgot to add the extension?`);return e.nodes[r]}return r}function We(...r){return r.filter(e=>!!e).reduce((e,t)=>{const s={...e};return Object.entries(t).forEach(([n,i])=>{if(!s[n]){s[n]=i;return}if(n==="class"){const l=i?String(i).split(" "):[],c=s[n]?s[n].split(" "):[],d=l.filter(u=>!c.includes(u));s[n]=[...c,...d].join(" ")}else if(n==="style"){const l=i?i.split(";").map(u=>u.trim()).filter(Boolean):[],c=s[n]?s[n].split(";").map(u=>u.trim()).filter(Boolean):[],d=new Map;c.forEach(u=>{const[h,f]=u.split(":").map(p=>p.trim());d.set(h,f)}),l.forEach(u=>{const[h,f]=u.split(":").map(p=>p.trim());d.set(h,f)}),s[n]=Array.from(d.entries()).map(([u,h])=>`${u}: ${h}`).join("; ")}else s[n]=i}),s},{})}function Yi(r,e){return e.filter(t=>t.type===r.type.name).filter(t=>t.attribute.rendered).map(t=>t.attribute.renderHTML?t.attribute.renderHTML(r.attrs)||{}:{[t.name]:r.attrs[t.name]}).reduce((t,s)=>We(t,s),{})}function _p(r){return typeof r=="function"}function fe(r,e=void 0,...t){return _p(r)?e?r.bind(e)(...t):r(...t):r}function H1(r={}){return Object.keys(r).length===0&&r.constructor===Object}function V1(r){return typeof r!="string"?r:r.match(/^[+-]?(?:\d*\.)?\d+$/)?Number(r):r==="true"?!0:r==="false"?!1:r}function ou(r,e){return"style"in r?r:{...r,getAttrs:t=>{const s=r.getAttrs?r.getAttrs(t):r.attrs;if(s===!1)return!1;const n=e.reduce((i,a)=>{const l=a.attribute.parseHTML?a.attribute.parseHTML(t):V1(t.getAttribute(a.name));return l==null?i:{...i,[a.name]:l}},{});return{...s,...n}}}}function au(r){return Object.fromEntries(Object.entries(r).filter(([e,t])=>e==="attrs"&&H1(t)?!1:t!=null))}function q1(r,e){var t;const s=$p(r),{nodeExtensions:n,markExtensions:i}=Go(r),a=(t=n.find(d=>ee(d,"topNode")))===null||t===void 0?void 0:t.name,l=Object.fromEntries(n.map(d=>{const u=s.filter(x=>x.type===d.name),h={name:d.name,options:d.options,storage:d.storage,editor:e},f=r.reduce((x,S)=>{const C=ee(S,"extendNodeSchema",h);return{...x,...C?C(d):{}}},{}),p=au({...f,content:fe(ee(d,"content",h)),marks:fe(ee(d,"marks",h)),group:fe(ee(d,"group",h)),inline:fe(ee(d,"inline",h)),atom:fe(ee(d,"atom",h)),selectable:fe(ee(d,"selectable",h)),draggable:fe(ee(d,"draggable",h)),code:fe(ee(d,"code",h)),whitespace:fe(ee(d,"whitespace",h)),linebreakReplacement:fe(ee(d,"linebreakReplacement",h)),defining:fe(ee(d,"defining",h)),isolating:fe(ee(d,"isolating",h)),attrs:Object.fromEntries(u.map(x=>{var S;return[x.name,{default:(S=x==null?void 0:x.attribute)===null||S===void 0?void 0:S.default}]}))}),m=fe(ee(d,"parseHTML",h));m&&(p.parseDOM=m.map(x=>ou(x,u)));const g=ee(d,"renderHTML",h);g&&(p.toDOM=x=>g({node:x,HTMLAttributes:Yi(x,u)}));const y=ee(d,"renderText",h);return y&&(p.toText=y),[d.name,p]})),c=Object.fromEntries(i.map(d=>{const u=s.filter(y=>y.type===d.name),h={name:d.name,options:d.options,storage:d.storage,editor:e},f=r.reduce((y,x)=>{const S=ee(x,"extendMarkSchema",h);return{...y,...S?S(d):{}}},{}),p=au({...f,inclusive:fe(ee(d,"inclusive",h)),excludes:fe(ee(d,"excludes",h)),group:fe(ee(d,"group",h)),spanning:fe(ee(d,"spanning",h)),code:fe(ee(d,"code",h)),attrs:Object.fromEntries(u.map(y=>{var x;return[y.name,{default:(x=y==null?void 0:y.attribute)===null||x===void 0?void 0:x.default}]}))}),m=fe(ee(d,"parseHTML",h));m&&(p.parseDOM=m.map(y=>ou(y,u)));const g=ee(d,"renderHTML",h);return g&&(p.toDOM=y=>g({mark:y,HTMLAttributes:Yi(y,u)})),[d.name,p]}));return new Sf({topNode:a,nodes:l,marks:c})}function ka(r,e){return e.nodes[r]||e.marks[r]||null}function lu(r,e){return Array.isArray(e)?e.some(t=>(typeof t=="string"?t:t.name)===r.name):e}function xc(r,e){const t=js.fromSchema(e).serializeFragment(r),n=document.implementation.createHTMLDocument().createElement("div");return n.appendChild(t),n.innerHTML}const K1=(r,e=500)=>{let t="";const s=r.parentOffset;return r.parent.nodesBetween(Math.max(0,s-e),s,(n,i,a,l)=>{var c,d;const u=((d=(c=n.type.spec).toText)===null||d===void 0?void 0:d.call(c,{node:n,pos:i,parent:a,index:l}))||n.textContent||"%leaf%";t+=n.isAtom&&!n.isText?u:u.slice(0,Math.max(0,s-i))}),t};function yc(r){return Object.prototype.toString.call(r)==="[object RegExp]"}class Yo{constructor(e){this.find=e.find,this.handler=e.handler}}const G1=(r,e)=>{if(yc(e))return e.exec(r);const t=e(r);if(!t)return null;const s=[t.text];return s.index=t.index,s.input=r,s.data=t.data,t.replaceWith&&(t.text.includes(t.replaceWith)||console.warn('[tiptap warn]: "inputRuleMatch.replaceWith" must be part of "inputRuleMatch.text".'),s.push(t.replaceWith)),s};function si(r){var e;const{editor:t,from:s,to:n,text:i,rules:a,plugin:l}=r,{view:c}=t;if(c.composing)return!1;const d=c.state.doc.resolve(s);if(d.parent.type.spec.code||!((e=d.nodeBefore||d.nodeAfter)===null||e===void 0)&&e.marks.find(f=>f.type.spec.code))return!1;let u=!1;const h=K1(d)+i;return a.forEach(f=>{if(u)return;const p=G1(h,f.find);if(!p)return;const m=c.state.tr,g=qo({state:c.state,transaction:m}),y={from:s-(p[0].length-i.length),to:n},{commands:x,chain:S,can:C}=new Ko({editor:t,state:g});f.handler({state:g,range:y,match:p,commands:x,chain:S,can:C})===null||!m.steps.length||(m.setMeta(l,{transform:m,from:s,to:n,text:i}),c.dispatch(m),u=!0)}),u}function Y1(r){const{editor:e,rules:t}=r,s=new Je({state:{init(){return null},apply(n,i,a){const l=n.getMeta(s);if(l)return l;const c=n.getMeta("applyInputRules");return!!c&&setTimeout(()=>{let{text:u}=c;typeof u=="string"?u=u:u=xc(z.from(u),a.schema);const{from:h}=c,f=h+u.length;si({editor:e,from:h,to:f,text:u,rules:t,plugin:s})}),n.selectionSet||n.docChanged?null:i}},props:{handleTextInput(n,i,a,l){return si({editor:e,from:i,to:a,text:l,rules:t,plugin:s})},handleDOMEvents:{compositionend:n=>(setTimeout(()=>{const{$cursor:i}=n.state.selection;i&&si({editor:e,from:i.pos,to:i.pos,text:"",rules:t,plugin:s})}),!1)},handleKeyDown(n,i){if(i.key!=="Enter")return!1;const{$cursor:a}=n.state.selection;return a?si({editor:e,from:a.pos,to:a.pos,text:`
`,rules:t,plugin:s}):!1}},isInputRules:!0});return s}function J1(r){return Object.prototype.toString.call(r).slice(8,-1)}function ni(r){return J1(r)!=="Object"?!1:r.constructor===Object&&Object.getPrototypeOf(r)===Object.prototype}function Jo(r,e){const t={...r};return ni(r)&&ni(e)&&Object.keys(e).forEach(s=>{ni(e[s])&&ni(r[s])?t[s]=Jo(r[s],e[s]):t[s]=e[s]}),t}class Kt{constructor(e={}){this.type="mark",this.name="mark",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...e},this.name=this.config.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=fe(ee(this,"addOptions",{name:this.name}))),this.storage=fe(ee(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new Kt(e)}configure(e={}){const t=this.extend({...this.config,addOptions:()=>Jo(this.options,e)});return t.name=this.name,t.parent=this.parent,t}extend(e={}){const t=new Kt(e);return t.parent=this,this.child=t,t.name=e.name?e.name:t.parent.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${t.name}".`),t.options=fe(ee(t,"addOptions",{name:t.name})),t.storage=fe(ee(t,"addStorage",{name:t.name,options:t.options})),t}static handleExit({editor:e,mark:t}){const{tr:s}=e.state,n=e.state.selection.$from;if(n.pos===n.end()){const a=n.marks();if(!!!a.find(d=>(d==null?void 0:d.type.name)===t.name))return!1;const c=a.find(d=>(d==null?void 0:d.type.name)===t.name);return c&&s.removeStoredMark(c),s.insertText(" ",n.pos),e.view.dispatch(s),!0}return!1}}function X1(r){return typeof r=="number"}class Q1{constructor(e){this.find=e.find,this.handler=e.handler}}const Z1=(r,e,t)=>{if(yc(e))return[...r.matchAll(e)];const s=e(r,t);return s?s.map(n=>{const i=[n.text];return i.index=n.index,i.input=r,i.data=n.data,n.replaceWith&&(n.text.includes(n.replaceWith)||console.warn('[tiptap warn]: "pasteRuleMatch.replaceWith" must be part of "pasteRuleMatch.text".'),i.push(n.replaceWith)),i}):[]};function eN(r){const{editor:e,state:t,from:s,to:n,rule:i,pasteEvent:a,dropEvent:l}=r,{commands:c,chain:d,can:u}=new Ko({editor:e,state:t}),h=[];return t.doc.nodesBetween(s,n,(p,m)=>{if(!p.isTextblock||p.type.spec.code)return;const g=Math.max(s,m),y=Math.min(n,m+p.content.size),x=p.textBetween(g-m,y-m,void 0,"￼");Z1(x,i.find,a).forEach(C=>{if(C.index===void 0)return;const k=g+C.index+1,j=k+C[0].length,O={from:t.tr.mapping.map(k),to:t.tr.mapping.map(j)},N=i.handler({state:t,range:O,match:C,commands:c,chain:d,can:u,pasteEvent:a,dropEvent:l});h.push(N)})}),h.every(p=>p!==null)}let ii=null;const tN=r=>{var e;const t=new ClipboardEvent("paste",{clipboardData:new DataTransfer});return(e=t.clipboardData)===null||e===void 0||e.setData("text/html",r),t};function rN(r){const{editor:e,rules:t}=r;let s=null,n=!1,i=!1,a=typeof ClipboardEvent<"u"?new ClipboardEvent("paste"):null,l;try{l=typeof DragEvent<"u"?new DragEvent("drop"):null}catch{l=null}const c=({state:u,from:h,to:f,rule:p,pasteEvt:m})=>{const g=u.tr,y=qo({state:u,transaction:g});if(!(!eN({editor:e,state:y,from:Math.max(h-1,0),to:f.b-1,rule:p,pasteEvent:m,dropEvent:l})||!g.steps.length)){try{l=typeof DragEvent<"u"?new DragEvent("drop"):null}catch{l=null}return a=typeof ClipboardEvent<"u"?new ClipboardEvent("paste"):null,g}};return t.map(u=>new Je({view(h){const f=m=>{var g;s=!((g=h.dom.parentElement)===null||g===void 0)&&g.contains(m.target)?h.dom.parentElement:null,s&&(ii=e)},p=()=>{ii&&(ii=null)};return window.addEventListener("dragstart",f),window.addEventListener("dragend",p),{destroy(){window.removeEventListener("dragstart",f),window.removeEventListener("dragend",p)}}},props:{handleDOMEvents:{drop:(h,f)=>{if(i=s===h.dom.parentElement,l=f,!i){const p=ii;p!=null&&p.isEditable&&setTimeout(()=>{const m=p.state.selection;m&&p.commands.deleteRange({from:m.from,to:m.to})},10)}return!1},paste:(h,f)=>{var p;const m=(p=f.clipboardData)===null||p===void 0?void 0:p.getData("text/html");return a=f,n=!!(m!=null&&m.includes("data-pm-slice")),!1}}},appendTransaction:(h,f,p)=>{const m=h[0],g=m.getMeta("uiEvent")==="paste"&&!n,y=m.getMeta("uiEvent")==="drop"&&!i,x=m.getMeta("applyPasteRules"),S=!!x;if(!g&&!y&&!S)return;if(S){let{text:j}=x;typeof j=="string"?j=j:j=xc(z.from(j),p.schema);const{from:O}=x,N=O+j.length,w=tN(j);return c({rule:u,state:p,from:O,to:{b:N},pasteEvt:w})}const C=f.doc.content.findDiffStart(p.doc.content),k=f.doc.content.findDiffEnd(p.doc.content);if(!(!X1(C)||!k||C===k.b))return c({rule:u,state:p,from:C,to:k,pasteEvt:a})}}))}function sN(r){const e=r.filter((t,s)=>r.indexOf(t)!==s);return Array.from(new Set(e))}class $s{constructor(e,t){this.splittableMarks=[],this.editor=t,this.extensions=$s.resolve(e),this.schema=q1(this.extensions,t),this.setupExtensions()}static resolve(e){const t=$s.sort($s.flatten(e)),s=sN(t.map(n=>n.name));return s.length&&console.warn(`[tiptap warn]: Duplicate extension names found: [${s.map(n=>`'${n}'`).join(", ")}]. This can lead to issues.`),t}static flatten(e){return e.map(t=>{const s={name:t.name,options:t.options,storage:t.storage},n=ee(t,"addExtensions",s);return n?[t,...this.flatten(n())]:t}).flat(10)}static sort(e){return e.sort((s,n)=>{const i=ee(s,"priority")||100,a=ee(n,"priority")||100;return i>a?-1:i<a?1:0})}get commands(){return this.extensions.reduce((e,t)=>{const s={name:t.name,options:t.options,storage:t.storage,editor:this.editor,type:ka(t.name,this.schema)},n=ee(t,"addCommands",s);return n?{...e,...n()}:e},{})}get plugins(){const{editor:e}=this,t=$s.sort([...this.extensions].reverse()),s=[],n=[],i=t.map(a=>{const l={name:a.name,options:a.options,storage:a.storage,editor:e,type:ka(a.name,this.schema)},c=[],d=ee(a,"addKeyboardShortcuts",l);let u={};if(a.type==="mark"&&ee(a,"exitable",l)&&(u.ArrowRight=()=>Kt.handleExit({editor:e,mark:a})),d){const g=Object.fromEntries(Object.entries(d()).map(([y,x])=>[y,()=>x({editor:e})]));u={...u,...g}}const h=N1(u);c.push(h);const f=ee(a,"addInputRules",l);lu(a,e.options.enableInputRules)&&f&&s.push(...f());const p=ee(a,"addPasteRules",l);lu(a,e.options.enablePasteRules)&&p&&n.push(...p());const m=ee(a,"addProseMirrorPlugins",l);if(m){const g=m();c.push(...g)}return c}).flat();return[Y1({editor:e,rules:s}),...rN({editor:e,rules:n}),...i]}get attributes(){return $p(this.extensions)}get nodeViews(){const{editor:e}=this,{nodeExtensions:t}=Go(this.extensions);return Object.fromEntries(t.filter(s=>!!ee(s,"addNodeView")).map(s=>{const n=this.attributes.filter(c=>c.type===s.name),i={name:s.name,options:s.options,storage:s.storage,editor:e,type:Ye(s.name,this.schema)},a=ee(s,"addNodeView",i);if(!a)return[];const l=(c,d,u,h,f)=>{const p=Yi(c,n);return a()({node:c,view:d,getPos:u,decorations:h,innerDecorations:f,editor:e,extension:s,HTMLAttributes:p})};return[s.name,l]}))}setupExtensions(){this.extensions.forEach(e=>{var t;this.editor.extensionStorage[e.name]=e.storage;const s={name:e.name,options:e.options,storage:e.storage,editor:this.editor,type:ka(e.name,this.schema)};e.type==="mark"&&(!((t=fe(ee(e,"keepOnSplit",s)))!==null&&t!==void 0)||t)&&this.splittableMarks.push(e.name);const n=ee(e,"onBeforeCreate",s),i=ee(e,"onCreate",s),a=ee(e,"onUpdate",s),l=ee(e,"onSelectionUpdate",s),c=ee(e,"onTransaction",s),d=ee(e,"onFocus",s),u=ee(e,"onBlur",s),h=ee(e,"onDestroy",s);n&&this.editor.on("beforeCreate",n),i&&this.editor.on("create",i),a&&this.editor.on("update",a),l&&this.editor.on("selectionUpdate",l),c&&this.editor.on("transaction",c),d&&this.editor.on("focus",d),u&&this.editor.on("blur",u),h&&this.editor.on("destroy",h)})}}class nt{constructor(e={}){this.type="extension",this.name="extension",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...e},this.name=this.config.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=fe(ee(this,"addOptions",{name:this.name}))),this.storage=fe(ee(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new nt(e)}configure(e={}){const t=this.extend({...this.config,addOptions:()=>Jo(this.options,e)});return t.name=this.name,t.parent=this.parent,t}extend(e={}){const t=new nt({...this.config,...e});return t.parent=this,this.child=t,t.name=e.name?e.name:t.parent.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${t.name}".`),t.options=fe(ee(t,"addOptions",{name:t.name})),t.storage=fe(ee(t,"addStorage",{name:t.name,options:t.options})),t}}function Fp(r,e,t){const{from:s,to:n}=e,{blockSeparator:i=`

`,textSerializers:a={}}=t||{};let l="";return r.nodesBetween(s,n,(c,d,u,h)=>{var f;c.isBlock&&d>s&&(l+=i);const p=a==null?void 0:a[c.type.name];if(p)return u&&(l+=p({node:c,pos:d,parent:u,index:h,range:e})),!1;c.isText&&(l+=(f=c==null?void 0:c.text)===null||f===void 0?void 0:f.slice(Math.max(s,d)-d,n-d))}),l}function Bp(r){return Object.fromEntries(Object.entries(r.nodes).filter(([,e])=>e.spec.toText).map(([e,t])=>[e,t.spec.toText]))}const nN=nt.create({name:"clipboardTextSerializer",addOptions(){return{blockSeparator:void 0}},addProseMirrorPlugins(){return[new Je({key:new yt("clipboardTextSerializer"),props:{clipboardTextSerializer:()=>{const{editor:r}=this,{state:e,schema:t}=r,{doc:s,selection:n}=e,{ranges:i}=n,a=Math.min(...i.map(u=>u.$from.pos)),l=Math.max(...i.map(u=>u.$to.pos)),c=Bp(t);return Fp(s,{from:a,to:l},{...this.options.blockSeparator!==void 0?{blockSeparator:this.options.blockSeparator}:{},textSerializers:c})}}})]}}),iN=()=>({editor:r,view:e})=>(requestAnimationFrame(()=>{var t;r.isDestroyed||(e.dom.blur(),(t=window==null?void 0:window.getSelection())===null||t===void 0||t.removeAllRanges())}),!0),oN=(r=!1)=>({commands:e})=>e.setContent("",r),aN=()=>({state:r,tr:e,dispatch:t})=>{const{selection:s}=e,{ranges:n}=s;return t&&n.forEach(({$from:i,$to:a})=>{r.doc.nodesBetween(i.pos,a.pos,(l,c)=>{if(l.type.isText)return;const{doc:d,mapping:u}=e,h=d.resolve(u.map(c)),f=d.resolve(u.map(c+l.nodeSize)),p=h.blockRange(f);if(!p)return;const m=Zs(p);if(l.type.isTextblock){const{defaultType:g}=h.parent.contentMatchAt(h.index());e.setNodeMarkup(p.start,g)}(m||m===0)&&e.lift(p,m)})}),!0},lN=r=>e=>r(e),cN=()=>({state:r,dispatch:e})=>Rp(r,e),dN=(r,e)=>({editor:t,tr:s})=>{const{state:n}=t,i=n.doc.slice(r.from,r.to);s.deleteRange(r.from,r.to);const a=s.mapping.map(e);return s.insert(a,i.content),s.setSelection(new ce(s.doc.resolve(a-1))),!0},uN=()=>({tr:r,dispatch:e})=>{const{selection:t}=r,s=t.$anchor.node();if(s.content.size>0)return!1;const n=r.selection.$anchor;for(let i=n.depth;i>0;i-=1)if(n.node(i).type===s.type){if(e){const l=n.before(i),c=n.after(i);r.delete(l,c).scrollIntoView()}return!0}return!1},hN=r=>({tr:e,state:t,dispatch:s})=>{const n=Ye(r,t.schema),i=e.selection.$anchor;for(let a=i.depth;a>0;a-=1)if(i.node(a).type===n){if(s){const c=i.before(a),d=i.after(a);e.delete(c,d).scrollIntoView()}return!0}return!1},fN=r=>({tr:e,dispatch:t})=>{const{from:s,to:n}=r;return t&&e.delete(s,n),!0},pN=()=>({state:r,dispatch:e})=>hc(r,e),mN=()=>({commands:r})=>r.keyboardShortcut("Enter"),gN=()=>({state:r,dispatch:e})=>C1(r,e);function Ji(r,e,t={strict:!0}){const s=Object.keys(e);return s.length?s.every(n=>t.strict?e[n]===r[n]:yc(e[n])?e[n].test(r[n]):e[n]===r[n]):!0}function Up(r,e,t={}){return r.find(s=>s.type===e&&Ji(Object.fromEntries(Object.keys(t).map(n=>[n,s.attrs[n]])),t))}function cu(r,e,t={}){return!!Up(r,e,t)}function bc(r,e,t){var s;if(!r||!e)return;let n=r.parent.childAfter(r.parentOffset);if((!n.node||!n.node.marks.some(u=>u.type===e))&&(n=r.parent.childBefore(r.parentOffset)),!n.node||!n.node.marks.some(u=>u.type===e)||(t=t||((s=n.node.marks[0])===null||s===void 0?void 0:s.attrs),!Up([...n.node.marks],e,t)))return;let a=n.index,l=r.start()+n.offset,c=a+1,d=l+n.node.nodeSize;for(;a>0&&cu([...r.parent.child(a-1).marks],e,t);)a-=1,l-=r.parent.child(a).nodeSize;for(;c<r.parent.childCount&&cu([...r.parent.child(c).marks],e,t);)d+=r.parent.child(c).nodeSize,c+=1;return{from:l,to:d}}function $r(r,e){if(typeof r=="string"){if(!e.marks[r])throw Error(`There is no mark type named '${r}'. Maybe you forgot to add the extension?`);return e.marks[r]}return r}const xN=(r,e={})=>({tr:t,state:s,dispatch:n})=>{const i=$r(r,s.schema),{doc:a,selection:l}=t,{$from:c,from:d,to:u}=l;if(n){const h=bc(c,i,e);if(h&&h.from<=d&&h.to>=u){const f=ce.create(a,h.from,h.to);t.setSelection(f)}}return!0},yN=r=>e=>{const t=typeof r=="function"?r(e):r;for(let s=0;s<t.length;s+=1)if(t[s](e))return!0;return!1};function zp(r){return r instanceof ce}function es(r=0,e=0,t=0){return Math.min(Math.max(r,e),t)}function Wp(r,e=null){if(!e)return null;const t=de.atStart(r),s=de.atEnd(r);if(e==="start"||e===!0)return t;if(e==="end")return s;const n=t.from,i=s.to;return e==="all"?ce.create(r,es(0,n,i),es(r.content.size,n,i)):ce.create(r,es(e,n,i),es(e,n,i))}function Hp(){return navigator.platform==="Android"||/android/i.test(navigator.userAgent)}function Xo(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}const bN=(r=null,e={})=>({editor:t,view:s,tr:n,dispatch:i})=>{e={scrollIntoView:!0,...e};const a=()=>{(Xo()||Hp())&&s.dom.focus(),requestAnimationFrame(()=>{t.isDestroyed||(s.focus(),e!=null&&e.scrollIntoView&&t.commands.scrollIntoView())})};if(s.hasFocus()&&r===null||r===!1)return!0;if(i&&r===null&&!zp(t.state.selection))return a(),!0;const l=Wp(n.doc,r)||t.state.selection,c=t.state.selection.eq(l);return i&&(c||n.setSelection(l),c&&n.storedMarks&&n.setStoredMarks(n.storedMarks),a()),!0},wN=(r,e)=>t=>r.every((s,n)=>e(s,{...t,index:n})),vN=(r,e)=>({tr:t,commands:s})=>s.insertContentAt({from:t.selection.from,to:t.selection.to},r,e),Vp=r=>{const e=r.childNodes;for(let t=e.length-1;t>=0;t-=1){const s=e[t];s.nodeType===3&&s.nodeValue&&/^(\n\s\s|\n)$/.test(s.nodeValue)?r.removeChild(s):s.nodeType===1&&Vp(s)}return r};function oi(r){const e=`<body>${r}</body>`,t=new window.DOMParser().parseFromString(e,"text/html").body;return Vp(t)}function Rn(r,e,t){if(r instanceof Er||r instanceof z)return r;t={slice:!0,parseOptions:{},...t};const s=typeof r=="object"&&r!==null,n=typeof r=="string";if(s)try{if(Array.isArray(r)&&r.length>0)return z.fromArray(r.map(l=>e.nodeFromJSON(l)));const a=e.nodeFromJSON(r);return t.errorOnInvalidContent&&a.check(),a}catch(i){if(t.errorOnInvalidContent)throw new Error("[tiptap error]: Invalid JSON content",{cause:i});return console.warn("[tiptap warn]: Invalid content.","Passed value:",r,"Error:",i),Rn("",e,t)}if(n){if(t.errorOnInvalidContent){let a=!1,l="";const c=new Sf({topNode:e.spec.topNode,marks:e.spec.marks,nodes:e.spec.nodes.append({__tiptap__private__unknown__catch__all__node:{content:"inline*",group:"block",parseDOM:[{tag:"*",getAttrs:d=>(a=!0,l=typeof d=="string"?d:d.outerHTML,null)}]}})});if(t.slice?Ar.fromSchema(c).parseSlice(oi(r),t.parseOptions):Ar.fromSchema(c).parse(oi(r),t.parseOptions),t.errorOnInvalidContent&&a)throw new Error("[tiptap error]: Invalid HTML content",{cause:new Error(`Invalid element found: ${l}`)})}const i=Ar.fromSchema(e);return t.slice?i.parseSlice(oi(r),t.parseOptions).content:i.parse(oi(r),t.parseOptions)}return Rn("",e,t)}function NN(r,e,t){const s=r.steps.length-1;if(s<e)return;const n=r.steps[s];if(!(n instanceof He||n instanceof Ke))return;const i=r.mapping.maps[s];let a=0;i.forEach((l,c,d,u)=>{a===0&&(a=u)}),r.setSelection(de.near(r.doc.resolve(a),t))}const jN=r=>!("type"in r),kN=(r,e,t)=>({tr:s,dispatch:n,editor:i})=>{var a;if(n){t={parseOptions:i.options.parseOptions,updateSelection:!0,applyInputRules:!1,applyPasteRules:!1,...t};let l;const c=y=>{i.emit("contentError",{editor:i,error:y,disableCollaboration:()=>{i.storage.collaboration&&(i.storage.collaboration.isDisabled=!0)}})},d={preserveWhitespace:"full",...t.parseOptions};if(!t.errorOnInvalidContent&&!i.options.enableContentCheck&&i.options.emitContentError)try{Rn(e,i.schema,{parseOptions:d,errorOnInvalidContent:!0})}catch(y){c(y)}try{l=Rn(e,i.schema,{parseOptions:d,errorOnInvalidContent:(a=t.errorOnInvalidContent)!==null&&a!==void 0?a:i.options.enableContentCheck})}catch(y){return c(y),!1}let{from:u,to:h}=typeof r=="number"?{from:r,to:r}:{from:r.from,to:r.to},f=!0,p=!0;if((jN(l)?l:[l]).forEach(y=>{y.check(),f=f?y.isText&&y.marks.length===0:!1,p=p?y.isBlock:!1}),u===h&&p){const{parent:y}=s.doc.resolve(u);y.isTextblock&&!y.type.spec.code&&!y.childCount&&(u-=1,h+=1)}let g;if(f){if(Array.isArray(e))g=e.map(y=>y.text||"").join("");else if(e instanceof z){let y="";e.forEach(x=>{x.text&&(y+=x.text)}),g=y}else typeof e=="object"&&e&&e.text?g=e.text:g=e;s.insertText(g,u,h)}else g=l,s.replaceWith(u,h,g);t.updateSelection&&NN(s,s.steps.length-1,-1),t.applyInputRules&&s.setMeta("applyInputRules",{from:u,text:g}),t.applyPasteRules&&s.setMeta("applyPasteRules",{from:u,text:g})}return!0},SN=()=>({state:r,dispatch:e})=>S1(r,e),EN=()=>({state:r,dispatch:e})=>E1(r,e),AN=()=>({state:r,dispatch:e})=>Ep(r,e),CN=()=>({state:r,dispatch:e})=>Dp(r,e),MN=()=>({state:r,dispatch:e,tr:t})=>{try{const s=Bo(r.doc,r.selection.$from.pos,-1);return s==null?!1:(t.join(s,2),e&&e(t),!0)}catch{return!1}},DN=()=>({state:r,dispatch:e,tr:t})=>{try{const s=Bo(r.doc,r.selection.$from.pos,1);return s==null?!1:(t.join(s,2),e&&e(t),!0)}catch{return!1}},TN=()=>({state:r,dispatch:e})=>j1(r,e),ON=()=>({state:r,dispatch:e})=>k1(r,e);function qp(){return typeof navigator<"u"?/Mac/.test(navigator.platform):!1}function RN(r){const e=r.split(/-(?!$)/);let t=e[e.length-1];t==="Space"&&(t=" ");let s,n,i,a;for(let l=0;l<e.length-1;l+=1){const c=e[l];if(/^(cmd|meta|m)$/i.test(c))a=!0;else if(/^a(lt)?$/i.test(c))s=!0;else if(/^(c|ctrl|control)$/i.test(c))n=!0;else if(/^s(hift)?$/i.test(c))i=!0;else if(/^mod$/i.test(c))Xo()||qp()?a=!0:n=!0;else throw new Error(`Unrecognized modifier name: ${c}`)}return s&&(t=`Alt-${t}`),n&&(t=`Ctrl-${t}`),a&&(t=`Meta-${t}`),i&&(t=`Shift-${t}`),t}const IN=r=>({editor:e,view:t,tr:s,dispatch:n})=>{const i=RN(r).split(/-(?!$)/),a=i.find(d=>!["Alt","Ctrl","Meta","Shift"].includes(d)),l=new KeyboardEvent("keydown",{key:a==="Space"?" ":a,altKey:i.includes("Alt"),ctrlKey:i.includes("Ctrl"),metaKey:i.includes("Meta"),shiftKey:i.includes("Shift"),bubbles:!0,cancelable:!0}),c=e.captureTransaction(()=>{t.someProp("handleKeyDown",d=>d(t,l))});return c==null||c.steps.forEach(d=>{const u=d.map(s.mapping);u&&n&&s.maybeStep(u)}),!0};function In(r,e,t={}){const{from:s,to:n,empty:i}=r.selection,a=e?Ye(e,r.schema):null,l=[];r.doc.nodesBetween(s,n,(h,f)=>{if(h.isText)return;const p=Math.max(s,f),m=Math.min(n,f+h.nodeSize);l.push({node:h,from:p,to:m})});const c=n-s,d=l.filter(h=>a?a.name===h.node.type.name:!0).filter(h=>Ji(h.node.attrs,t,{strict:!1}));return i?!!d.length:d.reduce((h,f)=>h+f.to-f.from,0)>=c}const PN=(r,e={})=>({state:t,dispatch:s})=>{const n=Ye(r,t.schema);return In(t,n,e)?A1(t,s):!1},LN=()=>({state:r,dispatch:e})=>Ip(r,e),$N=r=>({state:e,dispatch:t})=>{const s=Ye(r,e.schema);return F1(s)(e,t)},_N=()=>({state:r,dispatch:e})=>Op(r,e);function Qo(r,e){return e.nodes[r]?"node":e.marks[r]?"mark":null}function du(r,e){const t=typeof e=="string"?[e]:e;return Object.keys(r).reduce((s,n)=>(t.includes(n)||(s[n]=r[n]),s),{})}const FN=(r,e)=>({tr:t,state:s,dispatch:n})=>{let i=null,a=null;const l=Qo(typeof r=="string"?r:r.name,s.schema);return l?(l==="node"&&(i=Ye(r,s.schema)),l==="mark"&&(a=$r(r,s.schema)),n&&t.selection.ranges.forEach(c=>{s.doc.nodesBetween(c.$from.pos,c.$to.pos,(d,u)=>{i&&i===d.type&&t.setNodeMarkup(u,void 0,du(d.attrs,e)),a&&d.marks.length&&d.marks.forEach(h=>{a===h.type&&t.addMark(u,u+d.nodeSize,a.create(du(h.attrs,e)))})})}),!0):!1},BN=()=>({tr:r,dispatch:e})=>(e&&r.scrollIntoView(),!0),UN=()=>({tr:r,dispatch:e})=>{if(e){const t=new kt(r.doc);r.setSelection(t)}return!0},zN=()=>({state:r,dispatch:e})=>Cp(r,e),WN=()=>({state:r,dispatch:e})=>Tp(r,e),HN=()=>({state:r,dispatch:e})=>T1(r,e),VN=()=>({state:r,dispatch:e})=>I1(r,e),qN=()=>({state:r,dispatch:e})=>R1(r,e);function yl(r,e,t={},s={}){return Rn(r,e,{slice:!1,parseOptions:t,errorOnInvalidContent:s.errorOnInvalidContent})}const KN=(r,e=!1,t={},s={})=>({editor:n,tr:i,dispatch:a,commands:l})=>{var c,d;const{doc:u}=i;if(t.preserveWhitespace!=="full"){const h=yl(r,n.schema,t,{errorOnInvalidContent:(c=s.errorOnInvalidContent)!==null&&c!==void 0?c:n.options.enableContentCheck});return a&&i.replaceWith(0,u.content.size,h).setMeta("preventUpdate",!e),!0}return a&&i.setMeta("preventUpdate",!e),l.insertContentAt({from:0,to:u.content.size},r,{parseOptions:t,errorOnInvalidContent:(d=s.errorOnInvalidContent)!==null&&d!==void 0?d:n.options.enableContentCheck})};function Kp(r,e){const t=$r(e,r.schema),{from:s,to:n,empty:i}=r.selection,a=[];i?(r.storedMarks&&a.push(...r.storedMarks),a.push(...r.selection.$head.marks())):r.doc.nodesBetween(s,n,c=>{a.push(...c.marks)});const l=a.find(c=>c.type.name===t.name);return l?{...l.attrs}:{}}function GN(r,e){const t=new Uf(r);return e.forEach(s=>{s.steps.forEach(n=>{t.step(n)})}),t}function YN(r){for(let e=0;e<r.edgeCount;e+=1){const{type:t}=r.edge(e);if(t.isTextblock&&!t.hasRequiredAttrs())return t}return null}function bl(r,e){const t=[];return r.descendants((s,n)=>{e(s)&&t.push({node:s,pos:n})}),t}function JN(r,e,t){const s=[];return r.nodesBetween(e.from,e.to,(n,i)=>{t(n)&&s.push({node:n,pos:i})}),s}function XN(r,e){for(let t=r.depth;t>0;t-=1){const s=r.node(t);if(e(s))return{pos:t>0?r.before(t):0,start:r.start(t),depth:t,node:s}}}function wc(r){return e=>XN(e.$from,r)}function QN(r,e){const t={from:0,to:r.content.size};return Fp(r,t,e)}function ZN(r,e){const t=Ye(e,r.schema),{from:s,to:n}=r.selection,i=[];r.doc.nodesBetween(s,n,l=>{i.push(l)});const a=i.reverse().find(l=>l.type.name===t.name);return a?{...a.attrs}:{}}function Gp(r,e){const t=Qo(typeof e=="string"?e:e.name,r.schema);return t==="node"?ZN(r,e):t==="mark"?Kp(r,e):{}}function ej(r,e=JSON.stringify){const t={};return r.filter(s=>{const n=e(s);return Object.prototype.hasOwnProperty.call(t,n)?!1:t[n]=!0})}function tj(r){const e=ej(r);return e.length===1?e:e.filter((t,s)=>!e.filter((i,a)=>a!==s).some(i=>t.oldRange.from>=i.oldRange.from&&t.oldRange.to<=i.oldRange.to&&t.newRange.from>=i.newRange.from&&t.newRange.to<=i.newRange.to))}function rj(r){const{mapping:e,steps:t}=r,s=[];return e.maps.forEach((n,i)=>{const a=[];if(n.ranges.length)n.forEach((l,c)=>{a.push({from:l,to:c})});else{const{from:l,to:c}=t[i];if(l===void 0||c===void 0)return;a.push({from:l,to:c})}a.forEach(({from:l,to:c})=>{const d=e.slice(i).map(l,-1),u=e.slice(i).map(c),h=e.invert().map(d,-1),f=e.invert().map(u);s.push({oldRange:{from:h,to:f},newRange:{from:d,to:u}})})}),tj(s)}function vc(r,e,t){const s=[];return r===e?t.resolve(r).marks().forEach(n=>{const i=t.resolve(r),a=bc(i,n.type);a&&s.push({mark:n,...a})}):t.nodesBetween(r,e,(n,i)=>{!n||(n==null?void 0:n.nodeSize)===void 0||s.push(...n.marks.map(a=>({from:i,to:i+n.nodeSize,mark:a})))}),s}function Ni(r,e,t){return Object.fromEntries(Object.entries(t).filter(([s])=>{const n=r.find(i=>i.type===e&&i.name===s);return n?n.attribute.keepOnSplit:!1}))}function wl(r,e,t={}){const{empty:s,ranges:n}=r.selection,i=e?$r(e,r.schema):null;if(s)return!!(r.storedMarks||r.selection.$from.marks()).filter(h=>i?i.name===h.type.name:!0).find(h=>Ji(h.attrs,t,{strict:!1}));let a=0;const l=[];if(n.forEach(({$from:h,$to:f})=>{const p=h.pos,m=f.pos;r.doc.nodesBetween(p,m,(g,y)=>{if(!g.isText&&!g.marks.length)return;const x=Math.max(p,y),S=Math.min(m,y+g.nodeSize),C=S-x;a+=C,l.push(...g.marks.map(k=>({mark:k,from:x,to:S})))})}),a===0)return!1;const c=l.filter(h=>i?i.name===h.mark.type.name:!0).filter(h=>Ji(h.mark.attrs,t,{strict:!1})).reduce((h,f)=>h+f.to-f.from,0),d=l.filter(h=>i?h.mark.type!==i&&h.mark.type.excludes(i):!0).reduce((h,f)=>h+f.to-f.from,0);return(c>0?c+d:c)>=a}function sj(r,e,t={}){if(!e)return In(r,null,t)||wl(r,null,t);const s=Qo(e,r.schema);return s==="node"?In(r,e,t):s==="mark"?wl(r,e,t):!1}function uu(r,e){const{nodeExtensions:t}=Go(e),s=t.find(a=>a.name===r);if(!s)return!1;const n={name:s.name,options:s.options,storage:s.storage},i=fe(ee(s,"group",n));return typeof i!="string"?!1:i.split(" ").includes("list")}function Nc(r,{checkChildren:e=!0,ignoreWhitespace:t=!1}={}){var s;if(t){if(r.type.name==="hardBreak")return!0;if(r.isText)return/^\s*$/m.test((s=r.text)!==null&&s!==void 0?s:"")}if(r.isText)return!r.text;if(r.isAtom||r.isLeaf)return!1;if(r.content.childCount===0)return!0;if(e){let n=!0;return r.content.forEach(i=>{n!==!1&&(Nc(i,{ignoreWhitespace:t,checkChildren:e})||(n=!1))}),n}return!1}function nj(r){return r instanceof se}function ij(r,e,t){var s;const{selection:n}=e;let i=null;if(zp(n)&&(i=n.$cursor),i){const l=(s=r.storedMarks)!==null&&s!==void 0?s:i.marks();return!!t.isInSet(l)||!l.some(c=>c.type.excludes(t))}const{ranges:a}=n;return a.some(({$from:l,$to:c})=>{let d=l.depth===0?r.doc.inlineContent&&r.doc.type.allowsMarkType(t):!1;return r.doc.nodesBetween(l.pos,c.pos,(u,h,f)=>{if(d)return!1;if(u.isInline){const p=!f||f.type.allowsMarkType(t),m=!!t.isInSet(u.marks)||!u.marks.some(g=>g.type.excludes(t));d=p&&m}return!d}),d})}const oj=(r,e={})=>({tr:t,state:s,dispatch:n})=>{const{selection:i}=t,{empty:a,ranges:l}=i,c=$r(r,s.schema);if(n)if(a){const d=Kp(s,c);t.addStoredMark(c.create({...d,...e}))}else l.forEach(d=>{const u=d.$from.pos,h=d.$to.pos;s.doc.nodesBetween(u,h,(f,p)=>{const m=Math.max(p,u),g=Math.min(p+f.nodeSize,h);f.marks.find(x=>x.type===c)?f.marks.forEach(x=>{c===x.type&&t.addMark(m,g,c.create({...x.attrs,...e}))}):t.addMark(m,g,c.create(e))})});return ij(s,t,c)},aj=(r,e)=>({tr:t})=>(t.setMeta(r,e),!0),lj=(r,e={})=>({state:t,dispatch:s,chain:n})=>{const i=Ye(r,t.schema);let a;return t.selection.$anchor.sameParent(t.selection.$head)&&(a=t.selection.$anchor.parent.attrs),i.isTextblock?n().command(({commands:l})=>iu(i,{...a,...e})(t)?!0:l.clearNodes()).command(({state:l})=>iu(i,{...a,...e})(l,s)).run():(console.warn('[tiptap warn]: Currently "setNode()" only supports text block nodes.'),!1)},cj=r=>({tr:e,dispatch:t})=>{if(t){const{doc:s}=e,n=es(r,0,s.content.size),i=se.create(s,n);e.setSelection(i)}return!0},dj=r=>({tr:e,dispatch:t})=>{if(t){const{doc:s}=e,{from:n,to:i}=typeof r=="number"?{from:r,to:r}:r,a=ce.atStart(s).from,l=ce.atEnd(s).to,c=es(n,a,l),d=es(i,a,l),u=ce.create(s,c,d);e.setSelection(u)}return!0},uj=r=>({state:e,dispatch:t})=>{const s=Ye(r,e.schema);return z1(s)(e,t)};function hu(r,e){const t=r.storedMarks||r.selection.$to.parentOffset&&r.selection.$from.marks();if(t){const s=t.filter(n=>e==null?void 0:e.includes(n.type.name));r.tr.ensureMarks(s)}}const hj=({keepMarks:r=!0}={})=>({tr:e,state:t,dispatch:s,editor:n})=>{const{selection:i,doc:a}=e,{$from:l,$to:c}=i,d=n.extensionManager.attributes,u=Ni(d,l.node().type.name,l.node().attrs);if(i instanceof se&&i.node.isBlock)return!l.parentOffset||!nr(a,l.pos)?!1:(s&&(r&&hu(t,n.extensionManager.splittableMarks),e.split(l.pos).scrollIntoView()),!0);if(!l.parent.isBlock)return!1;const h=c.parentOffset===c.parent.content.size,f=l.depth===0?void 0:YN(l.node(-1).contentMatchAt(l.indexAfter(-1)));let p=h&&f?[{type:f,attrs:u}]:void 0,m=nr(e.doc,e.mapping.map(l.pos),1,p);if(!p&&!m&&nr(e.doc,e.mapping.map(l.pos),1,f?[{type:f}]:void 0)&&(m=!0,p=f?[{type:f,attrs:u}]:void 0),s){if(m&&(i instanceof ce&&e.deleteSelection(),e.split(e.mapping.map(l.pos),1,p),f&&!h&&!l.parentOffset&&l.parent.type!==f)){const g=e.mapping.map(l.before()),y=e.doc.resolve(g);l.node(-1).canReplaceWith(y.index(),y.index()+1,f)&&e.setNodeMarkup(e.mapping.map(l.before()),f)}r&&hu(t,n.extensionManager.splittableMarks),e.scrollIntoView()}return m},fj=(r,e={})=>({tr:t,state:s,dispatch:n,editor:i})=>{var a;const l=Ye(r,s.schema),{$from:c,$to:d}=s.selection,u=s.selection.node;if(u&&u.isBlock||c.depth<2||!c.sameParent(d))return!1;const h=c.node(-1);if(h.type!==l)return!1;const f=i.extensionManager.attributes;if(c.parent.content.size===0&&c.node(-1).childCount===c.indexAfter(-1)){if(c.depth===2||c.node(-3).type!==l||c.index(-2)!==c.node(-2).childCount-1)return!1;if(n){let x=z.empty;const S=c.index(-1)?1:c.index(-2)?2:3;for(let w=c.depth-S;w>=c.depth-3;w-=1)x=z.from(c.node(w).copy(x));const C=c.indexAfter(-1)<c.node(-2).childCount?1:c.indexAfter(-2)<c.node(-3).childCount?2:3,k={...Ni(f,c.node().type.name,c.node().attrs),...e},j=((a=l.contentMatch.defaultType)===null||a===void 0?void 0:a.createAndFill(k))||void 0;x=x.append(z.from(l.createAndFill(null,j)||void 0));const O=c.before(c.depth-(S-1));t.replace(O,c.after(-C),new Q(x,4-S,0));let N=-1;t.doc.nodesBetween(O,t.doc.content.size,(w,v)=>{if(N>-1)return!1;w.isTextblock&&w.content.size===0&&(N=v+1)}),N>-1&&t.setSelection(ce.near(t.doc.resolve(N))),t.scrollIntoView()}return!0}const p=d.pos===c.end()?h.contentMatchAt(0).defaultType:null,m={...Ni(f,h.type.name,h.attrs),...e},g={...Ni(f,c.node().type.name,c.node().attrs),...e};t.delete(c.pos,d.pos);const y=p?[{type:l,attrs:m},{type:p,attrs:g}]:[{type:l,attrs:m}];if(!nr(t.doc,c.pos,2))return!1;if(n){const{selection:x,storedMarks:S}=s,{splittableMarks:C}=i.extensionManager,k=S||x.$to.parentOffset&&x.$from.marks();if(t.split(c.pos,2,y).scrollIntoView(),!k||!n)return!0;const j=k.filter(O=>C.includes(O.type.name));t.ensureMarks(j)}return!0},Sa=(r,e)=>{const t=wc(a=>a.type===e)(r.selection);if(!t)return!0;const s=r.doc.resolve(Math.max(0,t.pos-1)).before(t.depth);if(s===void 0)return!0;const n=r.doc.nodeAt(s);return t.node.type===(n==null?void 0:n.type)&&Pr(r.doc,t.pos)&&r.join(t.pos),!0},Ea=(r,e)=>{const t=wc(a=>a.type===e)(r.selection);if(!t)return!0;const s=r.doc.resolve(t.start).after(t.depth);if(s===void 0)return!0;const n=r.doc.nodeAt(s);return t.node.type===(n==null?void 0:n.type)&&Pr(r.doc,s)&&r.join(s),!0},pj=(r,e,t,s={})=>({editor:n,tr:i,state:a,dispatch:l,chain:c,commands:d,can:u})=>{const{extensions:h,splittableMarks:f}=n.extensionManager,p=Ye(r,a.schema),m=Ye(e,a.schema),{selection:g,storedMarks:y}=a,{$from:x,$to:S}=g,C=x.blockRange(S),k=y||g.$to.parentOffset&&g.$from.marks();if(!C)return!1;const j=wc(O=>uu(O.type.name,h))(g);if(C.depth>=1&&j&&C.depth-j.depth<=1){if(j.node.type===p)return d.liftListItem(m);if(uu(j.node.type.name,h)&&p.validContent(j.node.content)&&l)return c().command(()=>(i.setNodeMarkup(j.pos,p),!0)).command(()=>Sa(i,p)).command(()=>Ea(i,p)).run()}return!t||!k||!l?c().command(()=>u().wrapInList(p,s)?!0:d.clearNodes()).wrapInList(p,s).command(()=>Sa(i,p)).command(()=>Ea(i,p)).run():c().command(()=>{const O=u().wrapInList(p,s),N=k.filter(w=>f.includes(w.type.name));return i.ensureMarks(N),O?!0:d.clearNodes()}).wrapInList(p,s).command(()=>Sa(i,p)).command(()=>Ea(i,p)).run()},mj=(r,e={},t={})=>({state:s,commands:n})=>{const{extendEmptyMarkRange:i=!1}=t,a=$r(r,s.schema);return wl(s,a,e)?n.unsetMark(a,{extendEmptyMarkRange:i}):n.setMark(a,e)},gj=(r,e,t={})=>({state:s,commands:n})=>{const i=Ye(r,s.schema),a=Ye(e,s.schema),l=In(s,i,t);let c;return s.selection.$anchor.sameParent(s.selection.$head)&&(c=s.selection.$anchor.parent.attrs),l?n.setNode(a,c):n.setNode(i,{...c,...t})},xj=(r,e={})=>({state:t,commands:s})=>{const n=Ye(r,t.schema);return In(t,n,e)?s.lift(n):s.wrapIn(n,e)},yj=()=>({state:r,dispatch:e})=>{const t=r.plugins;for(let s=0;s<t.length;s+=1){const n=t[s];let i;if(n.spec.isInputRules&&(i=n.getState(r))){if(e){const a=r.tr,l=i.transform;for(let c=l.steps.length-1;c>=0;c-=1)a.step(l.steps[c].invert(l.docs[c]));if(i.text){const c=a.doc.resolve(i.from).marks();a.replaceWith(i.from,i.to,r.schema.text(i.text,c))}else a.delete(i.from,i.to)}return!0}}return!1},bj=()=>({tr:r,dispatch:e})=>{const{selection:t}=r,{empty:s,ranges:n}=t;return s||e&&n.forEach(i=>{r.removeMark(i.$from.pos,i.$to.pos)}),!0},wj=(r,e={})=>({tr:t,state:s,dispatch:n})=>{var i;const{extendEmptyMarkRange:a=!1}=e,{selection:l}=t,c=$r(r,s.schema),{$from:d,empty:u,ranges:h}=l;if(!n)return!0;if(u&&a){let{from:f,to:p}=l;const m=(i=d.marks().find(y=>y.type===c))===null||i===void 0?void 0:i.attrs,g=bc(d,c,m);g&&(f=g.from,p=g.to),t.removeMark(f,p,c)}else h.forEach(f=>{t.removeMark(f.$from.pos,f.$to.pos,c)});return t.removeStoredMark(c),!0},vj=(r,e={})=>({tr:t,state:s,dispatch:n})=>{let i=null,a=null;const l=Qo(typeof r=="string"?r:r.name,s.schema);return l?(l==="node"&&(i=Ye(r,s.schema)),l==="mark"&&(a=$r(r,s.schema)),n&&t.selection.ranges.forEach(c=>{const d=c.$from.pos,u=c.$to.pos;let h,f,p,m;t.selection.empty?s.doc.nodesBetween(d,u,(g,y)=>{i&&i===g.type&&(p=Math.max(y,d),m=Math.min(y+g.nodeSize,u),h=y,f=g)}):s.doc.nodesBetween(d,u,(g,y)=>{y<d&&i&&i===g.type&&(p=Math.max(y,d),m=Math.min(y+g.nodeSize,u),h=y,f=g),y>=d&&y<=u&&(i&&i===g.type&&t.setNodeMarkup(y,void 0,{...g.attrs,...e}),a&&g.marks.length&&g.marks.forEach(x=>{if(a===x.type){const S=Math.max(y,d),C=Math.min(y+g.nodeSize,u);t.addMark(S,C,a.create({...x.attrs,...e}))}}))}),f&&(h!==void 0&&t.setNodeMarkup(h,void 0,{...f.attrs,...e}),a&&f.marks.length&&f.marks.forEach(g=>{a===g.type&&t.addMark(p,m,a.create({...g.attrs,...e}))}))}),!0):!1},Nj=(r,e={})=>({state:t,dispatch:s})=>{const n=Ye(r,t.schema);return P1(n,e)(t,s)},jj=(r,e={})=>({state:t,dispatch:s})=>{const n=Ye(r,t.schema);return L1(n,e)(t,s)};var kj=Object.freeze({__proto__:null,blur:iN,clearContent:oN,clearNodes:aN,command:lN,createParagraphNear:cN,cut:dN,deleteCurrentNode:uN,deleteNode:hN,deleteRange:fN,deleteSelection:pN,enter:mN,exitCode:gN,extendMarkRange:xN,first:yN,focus:bN,forEach:wN,insertContent:vN,insertContentAt:kN,joinBackward:AN,joinDown:EN,joinForward:CN,joinItemBackward:MN,joinItemForward:DN,joinTextblockBackward:TN,joinTextblockForward:ON,joinUp:SN,keyboardShortcut:IN,lift:PN,liftEmptyBlock:LN,liftListItem:$N,newlineInCode:_N,resetAttributes:FN,scrollIntoView:BN,selectAll:UN,selectNodeBackward:zN,selectNodeForward:WN,selectParentNode:HN,selectTextblockEnd:VN,selectTextblockStart:qN,setContent:KN,setMark:oj,setMeta:aj,setNode:lj,setNodeSelection:cj,setTextSelection:dj,sinkListItem:uj,splitBlock:hj,splitListItem:fj,toggleList:pj,toggleMark:mj,toggleNode:gj,toggleWrap:xj,undoInputRule:yj,unsetAllMarks:bj,unsetMark:wj,updateAttributes:vj,wrapIn:Nj,wrapInList:jj});const Sj=nt.create({name:"commands",addCommands(){return{...kj}}}),Ej=nt.create({name:"drop",addProseMirrorPlugins(){return[new Je({key:new yt("tiptapDrop"),props:{handleDrop:(r,e,t,s)=>{this.editor.emit("drop",{editor:this.editor,event:e,slice:t,moved:s})}}})]}}),Aj=nt.create({name:"editable",addProseMirrorPlugins(){return[new Je({key:new yt("editable"),props:{editable:()=>this.editor.options.editable}})]}}),Cj=new yt("focusEvents"),Mj=nt.create({name:"focusEvents",addProseMirrorPlugins(){const{editor:r}=this;return[new Je({key:Cj,props:{handleDOMEvents:{focus:(e,t)=>{r.isFocused=!0;const s=r.state.tr.setMeta("focus",{event:t}).setMeta("addToHistory",!1);return e.dispatch(s),!1},blur:(e,t)=>{r.isFocused=!1;const s=r.state.tr.setMeta("blur",{event:t}).setMeta("addToHistory",!1);return e.dispatch(s),!1}}}})]}}),Dj=nt.create({name:"keymap",addKeyboardShortcuts(){const r=()=>this.editor.commands.first(({commands:a})=>[()=>a.undoInputRule(),()=>a.command(({tr:l})=>{const{selection:c,doc:d}=l,{empty:u,$anchor:h}=c,{pos:f,parent:p}=h,m=h.parent.isTextblock&&f>0?l.doc.resolve(f-1):h,g=m.parent.type.spec.isolating,y=h.pos-h.parentOffset,x=g&&m.parent.childCount===1?y===h.pos:de.atStart(d).from===f;return!u||!p.type.isTextblock||p.textContent.length||!x||x&&h.parent.type.name==="paragraph"?!1:a.clearNodes()}),()=>a.deleteSelection(),()=>a.joinBackward(),()=>a.selectNodeBackward()]),e=()=>this.editor.commands.first(({commands:a})=>[()=>a.deleteSelection(),()=>a.deleteCurrentNode(),()=>a.joinForward(),()=>a.selectNodeForward()]),s={Enter:()=>this.editor.commands.first(({commands:a})=>[()=>a.newlineInCode(),()=>a.createParagraphNear(),()=>a.liftEmptyBlock(),()=>a.splitBlock()]),"Mod-Enter":()=>this.editor.commands.exitCode(),Backspace:r,"Mod-Backspace":r,"Shift-Backspace":r,Delete:e,"Mod-Delete":e,"Mod-a":()=>this.editor.commands.selectAll()},n={...s},i={...s,"Ctrl-h":r,"Alt-Backspace":r,"Ctrl-d":e,"Ctrl-Alt-Backspace":e,"Alt-Delete":e,"Alt-d":e,"Ctrl-a":()=>this.editor.commands.selectTextblockStart(),"Ctrl-e":()=>this.editor.commands.selectTextblockEnd()};return Xo()||qp()?i:n},addProseMirrorPlugins(){return[new Je({key:new yt("clearDocument"),appendTransaction:(r,e,t)=>{if(r.some(g=>g.getMeta("composition")))return;const s=r.some(g=>g.docChanged)&&!e.doc.eq(t.doc),n=r.some(g=>g.getMeta("preventClearDocument"));if(!s||n)return;const{empty:i,from:a,to:l}=e.selection,c=de.atStart(e.doc).from,d=de.atEnd(e.doc).to;if(i||!(a===c&&l===d)||!Nc(t.doc))return;const f=t.tr,p=qo({state:t,transaction:f}),{commands:m}=new Ko({editor:this.editor,state:p});if(m.clearNodes(),!!f.steps.length)return f}})]}}),Tj=nt.create({name:"paste",addProseMirrorPlugins(){return[new Je({key:new yt("tiptapPaste"),props:{handlePaste:(r,e,t)=>{this.editor.emit("paste",{editor:this.editor,event:e,slice:t})}}})]}}),Oj=nt.create({name:"tabindex",addProseMirrorPlugins(){return[new Je({key:new yt("tabindex"),props:{attributes:()=>this.editor.isEditable?{tabindex:"0"}:{}}})]}});class qr{get name(){return this.node.type.name}constructor(e,t,s=!1,n=null){this.currentNode=null,this.actualDepth=null,this.isBlock=s,this.resolvedPos=e,this.editor=t,this.currentNode=n}get node(){return this.currentNode||this.resolvedPos.node()}get element(){return this.editor.view.domAtPos(this.pos).node}get depth(){var e;return(e=this.actualDepth)!==null&&e!==void 0?e:this.resolvedPos.depth}get pos(){return this.resolvedPos.pos}get content(){return this.node.content}set content(e){let t=this.from,s=this.to;if(this.isBlock){if(this.content.size===0){console.error(`You can’t set content on a block node. Tried to set content on ${this.name} at ${this.pos}`);return}t=this.from+1,s=this.to-1}this.editor.commands.insertContentAt({from:t,to:s},e)}get attributes(){return this.node.attrs}get textContent(){return this.node.textContent}get size(){return this.node.nodeSize}get from(){return this.isBlock?this.pos:this.resolvedPos.start(this.resolvedPos.depth)}get range(){return{from:this.from,to:this.to}}get to(){return this.isBlock?this.pos+this.size:this.resolvedPos.end(this.resolvedPos.depth)+(this.node.isText?0:1)}get parent(){if(this.depth===0)return null;const e=this.resolvedPos.start(this.resolvedPos.depth-1),t=this.resolvedPos.doc.resolve(e);return new qr(t,this.editor)}get before(){let e=this.resolvedPos.doc.resolve(this.from-(this.isBlock?1:2));return e.depth!==this.depth&&(e=this.resolvedPos.doc.resolve(this.from-3)),new qr(e,this.editor)}get after(){let e=this.resolvedPos.doc.resolve(this.to+(this.isBlock?2:1));return e.depth!==this.depth&&(e=this.resolvedPos.doc.resolve(this.to+3)),new qr(e,this.editor)}get children(){const e=[];return this.node.content.forEach((t,s)=>{const n=t.isBlock&&!t.isTextblock,i=t.isAtom&&!t.isText,a=this.pos+s+(i?0:1);if(a<0||a>this.resolvedPos.doc.nodeSize-2)return;const l=this.resolvedPos.doc.resolve(a);if(!n&&l.depth<=this.depth)return;const c=new qr(l,this.editor,n,n?t:null);n&&(c.actualDepth=this.depth+1),e.push(new qr(l,this.editor,n,n?t:null))}),e}get firstChild(){return this.children[0]||null}get lastChild(){const e=this.children;return e[e.length-1]||null}closest(e,t={}){let s=null,n=this.parent;for(;n&&!s;){if(n.node.type.name===e)if(Object.keys(t).length>0){const i=n.node.attrs,a=Object.keys(t);for(let l=0;l<a.length;l+=1){const c=a[l];if(i[c]!==t[c])break}}else s=n;n=n.parent}return s}querySelector(e,t={}){return this.querySelectorAll(e,t,!0)[0]||null}querySelectorAll(e,t={},s=!1){let n=[];if(!this.children||this.children.length===0)return n;const i=Object.keys(t);return this.children.forEach(a=>{s&&n.length>0||(a.node.type.name===e&&i.every(c=>t[c]===a.node.attrs[c])&&n.push(a),!(s&&n.length>0)&&(n=n.concat(a.querySelectorAll(e,t,s))))}),n}setAttribute(e){const{tr:t}=this.editor.state;t.setNodeMarkup(this.from,void 0,{...this.node.attrs,...e}),this.editor.view.dispatch(t)}}const Rj=`.ProseMirror {
  position: relative;
}

.ProseMirror {
  word-wrap: break-word;
  white-space: pre-wrap;
  white-space: break-spaces;
  -webkit-font-variant-ligatures: none;
  font-variant-ligatures: none;
  font-feature-settings: "liga" 0; /* the above doesn't seem to work in Edge */
}

.ProseMirror [contenteditable="false"] {
  white-space: normal;
}

.ProseMirror [contenteditable="false"] [contenteditable="true"] {
  white-space: pre-wrap;
}

.ProseMirror pre {
  white-space: pre-wrap;
}

img.ProseMirror-separator {
  display: inline !important;
  border: none !important;
  margin: 0 !important;
  width: 0 !important;
  height: 0 !important;
}

.ProseMirror-gapcursor {
  display: none;
  pointer-events: none;
  position: absolute;
  margin: 0;
}

.ProseMirror-gapcursor:after {
  content: "";
  display: block;
  position: absolute;
  top: -2px;
  width: 20px;
  border-top: 1px solid black;
  animation: ProseMirror-cursor-blink 1.1s steps(2, start) infinite;
}

@keyframes ProseMirror-cursor-blink {
  to {
    visibility: hidden;
  }
}

.ProseMirror-hideselection *::selection {
  background: transparent;
}

.ProseMirror-hideselection *::-moz-selection {
  background: transparent;
}

.ProseMirror-hideselection * {
  caret-color: transparent;
}

.ProseMirror-focused .ProseMirror-gapcursor {
  display: block;
}

.tippy-box[data-animation=fade][data-state=hidden] {
  opacity: 0
}`;function Ij(r,e,t){const s=document.querySelector("style[data-tiptap-style]");if(s!==null)return s;const n=document.createElement("style");return e&&n.setAttribute("nonce",e),n.setAttribute("data-tiptap-style",""),n.innerHTML=r,document.getElementsByTagName("head")[0].appendChild(n),n}class Pj extends W1{constructor(e={}){super(),this.isFocused=!1,this.isInitialized=!1,this.extensionStorage={},this.options={element:document.createElement("div"),content:"",injectCSS:!0,injectNonce:void 0,extensions:[],autofocus:!1,editable:!0,editorProps:{},parseOptions:{},coreExtensionOptions:{},enableInputRules:!0,enablePasteRules:!0,enableCoreExtensions:!0,enableContentCheck:!1,emitContentError:!1,onBeforeCreate:()=>null,onCreate:()=>null,onUpdate:()=>null,onSelectionUpdate:()=>null,onTransaction:()=>null,onFocus:()=>null,onBlur:()=>null,onDestroy:()=>null,onContentError:({error:t})=>{throw t},onPaste:()=>null,onDrop:()=>null},this.isCapturingTransaction=!1,this.capturedTransaction=null,this.setOptions(e),this.createExtensionManager(),this.createCommandManager(),this.createSchema(),this.on("beforeCreate",this.options.onBeforeCreate),this.emit("beforeCreate",{editor:this}),this.on("contentError",this.options.onContentError),this.createView(),this.injectCSS(),this.on("create",this.options.onCreate),this.on("update",this.options.onUpdate),this.on("selectionUpdate",this.options.onSelectionUpdate),this.on("transaction",this.options.onTransaction),this.on("focus",this.options.onFocus),this.on("blur",this.options.onBlur),this.on("destroy",this.options.onDestroy),this.on("drop",({event:t,slice:s,moved:n})=>this.options.onDrop(t,s,n)),this.on("paste",({event:t,slice:s})=>this.options.onPaste(t,s)),window.setTimeout(()=>{this.isDestroyed||(this.commands.focus(this.options.autofocus),this.emit("create",{editor:this}),this.isInitialized=!0)},0)}get storage(){return this.extensionStorage}get commands(){return this.commandManager.commands}chain(){return this.commandManager.chain()}can(){return this.commandManager.can()}injectCSS(){this.options.injectCSS&&document&&(this.css=Ij(Rj,this.options.injectNonce))}setOptions(e={}){this.options={...this.options,...e},!(!this.view||!this.state||this.isDestroyed)&&(this.options.editorProps&&this.view.setProps(this.options.editorProps),this.view.updateState(this.state))}setEditable(e,t=!0){this.setOptions({editable:e}),t&&this.emit("update",{editor:this,transaction:this.state.tr})}get isEditable(){return this.options.editable&&this.view&&this.view.editable}get state(){return this.view.state}registerPlugin(e,t){const s=_p(t)?t(e,[...this.state.plugins]):[...this.state.plugins,e],n=this.state.reconfigure({plugins:s});return this.view.updateState(n),n}unregisterPlugin(e){if(this.isDestroyed)return;const t=this.state.plugins;let s=t;if([].concat(e).forEach(i=>{const a=typeof i=="string"?`${i}$`:i.key;s=s.filter(l=>!l.key.startsWith(a))}),t.length===s.length)return;const n=this.state.reconfigure({plugins:s});return this.view.updateState(n),n}createExtensionManager(){var e,t;const n=[...this.options.enableCoreExtensions?[Aj,nN.configure({blockSeparator:(t=(e=this.options.coreExtensionOptions)===null||e===void 0?void 0:e.clipboardTextSerializer)===null||t===void 0?void 0:t.blockSeparator}),Sj,Mj,Dj,Oj,Ej,Tj].filter(i=>typeof this.options.enableCoreExtensions=="object"?this.options.enableCoreExtensions[i.name]!==!1:!0):[],...this.options.extensions].filter(i=>["extension","node","mark"].includes(i==null?void 0:i.type));this.extensionManager=new $s(n,this)}createCommandManager(){this.commandManager=new Ko({editor:this})}createSchema(){this.schema=this.extensionManager.schema}createView(){var e;let t;try{t=yl(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:this.options.enableContentCheck})}catch(a){if(!(a instanceof Error)||!["[tiptap error]: Invalid JSON content","[tiptap error]: Invalid HTML content"].includes(a.message))throw a;this.emit("contentError",{editor:this,error:a,disableCollaboration:()=>{this.storage.collaboration&&(this.storage.collaboration.isDisabled=!0),this.options.extensions=this.options.extensions.filter(l=>l.name!=="collaboration"),this.createExtensionManager()}}),t=yl(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:!1})}const s=Wp(t,this.options.autofocus);this.view=new jp(this.options.element,{...this.options.editorProps,attributes:{role:"textbox",...(e=this.options.editorProps)===null||e===void 0?void 0:e.attributes},dispatchTransaction:this.dispatchTransaction.bind(this),state:Ls.create({doc:t,selection:s||void 0})});const n=this.state.reconfigure({plugins:this.extensionManager.plugins});this.view.updateState(n),this.createNodeViews(),this.prependClass();const i=this.view.dom;i.editor=this}createNodeViews(){this.view.isDestroyed||this.view.setProps({nodeViews:this.extensionManager.nodeViews})}prependClass(){this.view.dom.className=`tiptap ${this.view.dom.className}`}captureTransaction(e){this.isCapturingTransaction=!0,e(),this.isCapturingTransaction=!1;const t=this.capturedTransaction;return this.capturedTransaction=null,t}dispatchTransaction(e){if(this.view.isDestroyed)return;if(this.isCapturingTransaction){if(!this.capturedTransaction){this.capturedTransaction=e;return}e.steps.forEach(a=>{var l;return(l=this.capturedTransaction)===null||l===void 0?void 0:l.step(a)});return}const t=this.state.apply(e),s=!this.state.selection.eq(t.selection);this.emit("beforeTransaction",{editor:this,transaction:e,nextState:t}),this.view.updateState(t),this.emit("transaction",{editor:this,transaction:e}),s&&this.emit("selectionUpdate",{editor:this,transaction:e});const n=e.getMeta("focus"),i=e.getMeta("blur");n&&this.emit("focus",{editor:this,event:n.event,transaction:e}),i&&this.emit("blur",{editor:this,event:i.event,transaction:e}),!(!e.docChanged||e.getMeta("preventUpdate"))&&this.emit("update",{editor:this,transaction:e})}getAttributes(e){return Gp(this.state,e)}isActive(e,t){const s=typeof e=="string"?e:null,n=typeof e=="string"?t:e;return sj(this.state,s,n)}getJSON(){return this.state.doc.toJSON()}getHTML(){return xc(this.state.doc.content,this.schema)}getText(e){const{blockSeparator:t=`

`,textSerializers:s={}}=e||{};return QN(this.state.doc,{blockSeparator:t,textSerializers:{...Bp(this.schema),...s}})}get isEmpty(){return Nc(this.state.doc)}getCharacterCount(){return console.warn('[tiptap warn]: "editor.getCharacterCount()" is deprecated. Please use "editor.storage.characterCount.characters()" instead.'),this.state.doc.content.size-2}destroy(){if(this.emit("destroy"),this.view){const e=this.view.dom;e&&e.editor&&delete e.editor,this.view.destroy()}this.removeAllListeners()}get isDestroyed(){var e;return!(!((e=this.view)===null||e===void 0)&&e.docView)}$node(e,t){var s;return((s=this.$doc)===null||s===void 0?void 0:s.querySelector(e,t))||null}$nodes(e,t){var s;return((s=this.$doc)===null||s===void 0?void 0:s.querySelectorAll(e,t))||null}$pos(e){const t=this.state.doc.resolve(e);return new qr(t,this)}get $doc(){return this.$pos(0)}}function Ks(r){return new Yo({find:r.find,handler:({state:e,range:t,match:s})=>{const n=fe(r.getAttributes,void 0,s);if(n===!1||n===null)return null;const{tr:i}=e,a=s[s.length-1],l=s[0];if(a){const c=l.search(/\S/),d=t.from+l.indexOf(a),u=d+a.length;if(vc(t.from,t.to,e.doc).filter(p=>p.mark.type.excluded.find(g=>g===r.type&&g!==p.mark.type)).filter(p=>p.to>d).length)return null;u<t.to&&i.delete(u,t.to),d>t.from&&i.delete(t.from+c,d);const f=t.from+c+a.length;i.addMark(t.from+c,f,r.type.create(n||{})),i.removeStoredMark(r.type)}}})}function Lj(r){return new Yo({find:r.find,handler:({state:e,range:t,match:s})=>{const n=fe(r.getAttributes,void 0,s)||{},{tr:i}=e,a=t.from;let l=t.to;const c=r.type.create(n);if(s[1]){const d=s[0].lastIndexOf(s[1]);let u=a+d;u>l?u=l:l=u+s[1].length;const h=s[0][s[0].length-1];i.insertText(h,a+s[0].length-1),i.replaceWith(u,l,c)}else if(s[0]){const d=r.type.isInline?a:a-1;i.insert(d,r.type.create(n)).delete(i.mapping.map(a),i.mapping.map(l))}i.scrollIntoView()}})}function vl(r){return new Yo({find:r.find,handler:({state:e,range:t,match:s})=>{const n=e.doc.resolve(t.from),i=fe(r.getAttributes,void 0,s)||{};if(!n.node(-1).canReplaceWith(n.index(-1),n.indexAfter(-1),r.type))return null;e.tr.delete(t.from,t.to).setBlockType(t.from,t.from,r.type,i)}})}function Pn(r){return new Yo({find:r.find,handler:({state:e,range:t,match:s,chain:n})=>{const i=fe(r.getAttributes,void 0,s)||{},a=e.tr.delete(t.from,t.to),c=a.doc.resolve(t.from).blockRange(),d=c&&tc(c,r.type,i);if(!d)return null;if(a.wrap(c,d),r.keepMarks&&r.editor){const{selection:h,storedMarks:f}=e,{splittableMarks:p}=r.editor.extensionManager,m=f||h.$to.parentOffset&&h.$from.marks();if(m){const g=m.filter(y=>p.includes(y.type.name));a.ensureMarks(g)}}if(r.keepAttributes){const h=r.type.name==="bulletList"||r.type.name==="orderedList"?"listItem":"taskList";n().updateAttributes(h,i).run()}const u=a.doc.resolve(t.from-1).nodeBefore;u&&u.type===r.type&&Pr(a.doc,t.from-1)&&(!r.joinPredicate||r.joinPredicate(s,u))&&a.join(t.from-1)}})}class ut{constructor(e={}){this.type="node",this.name="node",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...e},this.name=this.config.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=fe(ee(this,"addOptions",{name:this.name}))),this.storage=fe(ee(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new ut(e)}configure(e={}){const t=this.extend({...this.config,addOptions:()=>Jo(this.options,e)});return t.name=this.name,t.parent=this.parent,t}extend(e={}){const t=new ut(e);return t.parent=this,this.child=t,t.name=e.name?e.name:t.parent.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${t.name}".`),t.options=fe(ee(t,"addOptions",{name:t.name})),t.storage=fe(ee(t,"addStorage",{name:t.name,options:t.options})),t}}class $j{constructor(e,t,s){this.isDragging=!1,this.component=e,this.editor=t.editor,this.options={stopEvent:null,ignoreMutation:null,...s},this.extension=t.extension,this.node=t.node,this.decorations=t.decorations,this.innerDecorations=t.innerDecorations,this.view=t.view,this.HTMLAttributes=t.HTMLAttributes,this.getPos=t.getPos,this.mount()}mount(){}get dom(){return this.editor.view.dom}get contentDOM(){return null}onDragStart(e){var t,s,n,i,a,l,c;const{view:d}=this.editor,u=e.target,h=u.nodeType===3?(t=u.parentElement)===null||t===void 0?void 0:t.closest("[data-drag-handle]"):u.closest("[data-drag-handle]");if(!this.dom||!((s=this.contentDOM)===null||s===void 0)&&s.contains(u)||!h)return;let f=0,p=0;if(this.dom!==h){const S=this.dom.getBoundingClientRect(),C=h.getBoundingClientRect(),k=(n=e.offsetX)!==null&&n!==void 0?n:(i=e.nativeEvent)===null||i===void 0?void 0:i.offsetX,j=(a=e.offsetY)!==null&&a!==void 0?a:(l=e.nativeEvent)===null||l===void 0?void 0:l.offsetY;f=C.x-S.x+k,p=C.y-S.y+j}const m=this.dom.cloneNode(!0);(c=e.dataTransfer)===null||c===void 0||c.setDragImage(m,f,p);const g=this.getPos();if(typeof g!="number")return;const y=se.create(d.state.doc,g),x=d.state.tr.setSelection(y);d.dispatch(x)}stopEvent(e){var t;if(!this.dom)return!1;if(typeof this.options.stopEvent=="function")return this.options.stopEvent({event:e});const s=e.target;if(!(this.dom.contains(s)&&!(!((t=this.contentDOM)===null||t===void 0)&&t.contains(s))))return!1;const i=e.type.startsWith("drag"),a=e.type==="drop";if((["INPUT","BUTTON","SELECT","TEXTAREA"].includes(s.tagName)||s.isContentEditable)&&!a&&!i)return!0;const{isEditable:c}=this.editor,{isDragging:d}=this,u=!!this.node.type.spec.draggable,h=se.isSelectable(this.node),f=e.type==="copy",p=e.type==="paste",m=e.type==="cut",g=e.type==="mousedown";if(!u&&h&&i&&e.target===this.dom&&e.preventDefault(),u&&i&&!d&&e.target===this.dom)return e.preventDefault(),!1;if(u&&c&&!d&&g){const y=s.closest("[data-drag-handle]");y&&(this.dom===y||this.dom.contains(y))&&(this.isDragging=!0,document.addEventListener("dragend",()=>{this.isDragging=!1},{once:!0}),document.addEventListener("drop",()=>{this.isDragging=!1},{once:!0}),document.addEventListener("mouseup",()=>{this.isDragging=!1},{once:!0}))}return!(d||a||f||p||m||g&&h)}ignoreMutation(e){return!this.dom||!this.contentDOM?!0:typeof this.options.ignoreMutation=="function"?this.options.ignoreMutation({mutation:e}):this.node.isLeaf||this.node.isAtom?!0:e.type==="selection"||this.dom.contains(e.target)&&e.type==="childList"&&(Xo()||Hp())&&this.editor.isFocused&&[...Array.from(e.addedNodes),...Array.from(e.removedNodes)].every(s=>s.isContentEditable)?!1:this.contentDOM===e.target&&e.type==="attributes"?!0:!this.contentDOM.contains(e.target)}updateAttributes(e){this.editor.commands.command(({tr:t})=>{const s=this.getPos();return typeof s!="number"?!1:(t.setNodeMarkup(s,void 0,{...this.node.attrs,...e}),!0)})}deleteNode(){const e=this.getPos();if(typeof e!="number")return;const t=e+this.node.nodeSize;this.editor.commands.deleteRange({from:e,to:t})}}function ys(r){return new Q1({find:r.find,handler:({state:e,range:t,match:s,pasteEvent:n})=>{const i=fe(r.getAttributes,void 0,s,n);if(i===!1||i===null)return null;const{tr:a}=e,l=s[s.length-1],c=s[0];let d=t.to;if(l){const u=c.search(/\S/),h=t.from+c.indexOf(l),f=h+l.length;if(vc(t.from,t.to,e.doc).filter(m=>m.mark.type.excluded.find(y=>y===r.type&&y!==m.mark.type)).filter(m=>m.to>h).length)return null;f<t.to&&a.delete(f,t.to),h>t.from&&a.delete(t.from+u,h),d=t.from+u+l.length,a.addMark(t.from+u,d,r.type.create(i||{})),a.removeStoredMark(r.type)}}})}function _j(r,e){const{selection:t}=r,{$from:s}=t;if(t instanceof se){const i=s.index();return s.parent.canReplaceWith(i,i+1,e)}let n=s.depth;for(;n>=0;){const i=s.index(n);if(s.node(n).contentMatchAt(i).matchType(e))return!0;n-=1}return!1}function Fj(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var Yp={exports:{}},Aa={};/**
 * @license React
 * use-sync-external-store-shim.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var fu;function Bj(){if(fu)return Aa;fu=1;var r=ze;function e(h,f){return h===f&&(h!==0||1/h===1/f)||h!==h&&f!==f}var t=typeof Object.is=="function"?Object.is:e,s=r.useState,n=r.useEffect,i=r.useLayoutEffect,a=r.useDebugValue;function l(h,f){var p=f(),m=s({inst:{value:p,getSnapshot:f}}),g=m[0].inst,y=m[1];return i(function(){g.value=p,g.getSnapshot=f,c(g)&&y({inst:g})},[h,p,f]),n(function(){return c(g)&&y({inst:g}),h(function(){c(g)&&y({inst:g})})},[h]),a(p),p}function c(h){var f=h.getSnapshot;h=h.value;try{var p=f();return!t(h,p)}catch{return!0}}function d(h,f){return f()}var u=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?d:l;return Aa.useSyncExternalStore=r.useSyncExternalStore!==void 0?r.useSyncExternalStore:u,Aa}Yp.exports=Bj();var jc=Yp.exports;const Uj=(...r)=>e=>{r.forEach(t=>{typeof t=="function"?t(e):t&&(t.current=e)})},zj=({contentComponent:r})=>{const e=jc.useSyncExternalStore(r.subscribe,r.getSnapshot,r.getServerSnapshot);return ze.createElement(ze.Fragment,null,Object.values(e))};function Wj(){const r=new Set;let e={};return{subscribe(t){return r.add(t),()=>{r.delete(t)}},getSnapshot(){return e},getServerSnapshot(){return e},setRenderer(t,s){e={...e,[t]:Km.createPortal(s.reactElement,s.element,t)},r.forEach(n=>n())},removeRenderer(t){const s={...e};delete s[t],e=s,r.forEach(n=>n())}}}class Hj extends ze.Component{constructor(e){var t;super(e),this.editorContentRef=ze.createRef(),this.initialized=!1,this.state={hasContentComponentInitialized:!!(!((t=e.editor)===null||t===void 0)&&t.contentComponent)}}componentDidMount(){this.init()}componentDidUpdate(){this.init()}init(){const e=this.props.editor;if(e&&!e.isDestroyed&&e.options.element){if(e.contentComponent)return;const t=this.editorContentRef.current;t.append(...e.options.element.childNodes),e.setOptions({element:t}),e.contentComponent=Wj(),this.state.hasContentComponentInitialized||(this.unsubscribeToContentComponent=e.contentComponent.subscribe(()=>{this.setState(s=>s.hasContentComponentInitialized?s:{hasContentComponentInitialized:!0}),this.unsubscribeToContentComponent&&this.unsubscribeToContentComponent()})),e.createNodeViews(),this.initialized=!0}}componentWillUnmount(){const e=this.props.editor;if(!e||(this.initialized=!1,e.isDestroyed||e.view.setProps({nodeViews:{}}),this.unsubscribeToContentComponent&&this.unsubscribeToContentComponent(),e.contentComponent=null,!e.options.element.firstChild))return;const t=document.createElement("div");t.append(...e.options.element.childNodes),e.setOptions({element:t})}render(){const{editor:e,innerRef:t,...s}=this.props;return ze.createElement(ze.Fragment,null,ze.createElement("div",{ref:Uj(t,this.editorContentRef),...s}),(e==null?void 0:e.contentComponent)&&ze.createElement(zj,{contentComponent:e.contentComponent}))}}const Vj=b.forwardRef((r,e)=>{const t=ze.useMemo(()=>Math.floor(Math.random()*4294967295).toString(),[r.editor]);return ze.createElement(Hj,{key:t,innerRef:e,...r})}),qj=ze.memo(Vj);var Kj=function r(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){if(e.constructor!==t.constructor)return!1;var s,n,i;if(Array.isArray(e)){if(s=e.length,s!=t.length)return!1;for(n=s;n--!==0;)if(!r(e[n],t[n]))return!1;return!0}if(e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(n of e.entries())if(!t.has(n[0]))return!1;for(n of e.entries())if(!r(n[1],t.get(n[0])))return!1;return!0}if(e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(n of e.entries())if(!t.has(n[0]))return!1;return!0}if(ArrayBuffer.isView(e)&&ArrayBuffer.isView(t)){if(s=e.length,s!=t.length)return!1;for(n=s;n--!==0;)if(e[n]!==t[n])return!1;return!0}if(e.constructor===RegExp)return e.source===t.source&&e.flags===t.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===t.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===t.toString();if(i=Object.keys(e),s=i.length,s!==Object.keys(t).length)return!1;for(n=s;n--!==0;)if(!Object.prototype.hasOwnProperty.call(t,i[n]))return!1;for(n=s;n--!==0;){var a=i[n];if(!(a==="_owner"&&e.$$typeof)&&!r(e[a],t[a]))return!1}return!0}return e!==e&&t!==t},Gj=Fj(Kj),Jp={exports:{}},Ca={};/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var pu;function Yj(){if(pu)return Ca;pu=1;var r=ze,e=jc;function t(d,u){return d===u&&(d!==0||1/d===1/u)||d!==d&&u!==u}var s=typeof Object.is=="function"?Object.is:t,n=e.useSyncExternalStore,i=r.useRef,a=r.useEffect,l=r.useMemo,c=r.useDebugValue;return Ca.useSyncExternalStoreWithSelector=function(d,u,h,f,p){var m=i(null);if(m.current===null){var g={hasValue:!1,value:null};m.current=g}else g=m.current;m=l(function(){function x(O){if(!S){if(S=!0,C=O,O=f(O),p!==void 0&&g.hasValue){var N=g.value;if(p(N,O))return k=N}return k=O}if(N=k,s(C,O))return N;var w=f(O);return p!==void 0&&p(N,w)?N:(C=O,k=w)}var S=!1,C,k,j=h===void 0?null:h;return[function(){return x(u())},j===null?void 0:function(){return x(j())}]},[u,h,f,p]);var y=n(d,m[0],m[1]);return a(function(){g.hasValue=!0,g.value=y},[y]),c(y),y},Ca}Jp.exports=Yj();var Jj=Jp.exports;const Xj=typeof window<"u"?b.useLayoutEffect:b.useEffect;class Qj{constructor(e){this.transactionNumber=0,this.lastTransactionNumber=0,this.subscribers=new Set,this.editor=e,this.lastSnapshot={editor:e,transactionNumber:0},this.getSnapshot=this.getSnapshot.bind(this),this.getServerSnapshot=this.getServerSnapshot.bind(this),this.watch=this.watch.bind(this),this.subscribe=this.subscribe.bind(this)}getSnapshot(){return this.transactionNumber===this.lastTransactionNumber?this.lastSnapshot:(this.lastTransactionNumber=this.transactionNumber,this.lastSnapshot={editor:this.editor,transactionNumber:this.transactionNumber},this.lastSnapshot)}getServerSnapshot(){return{editor:null,transactionNumber:0}}subscribe(e){return this.subscribers.add(e),()=>{this.subscribers.delete(e)}}watch(e){if(this.editor=e,this.editor){const t=()=>{this.transactionNumber+=1,this.subscribers.forEach(n=>n())},s=this.editor;return s.on("transaction",t),()=>{s.off("transaction",t)}}}}function Zj(r){var e;const[t]=b.useState(()=>new Qj(r.editor)),s=Jj.useSyncExternalStoreWithSelector(t.subscribe,t.getSnapshot,t.getServerSnapshot,r.selector,(e=r.equalityFn)!==null&&e!==void 0?e:Gj);return Xj(()=>t.watch(r.editor),[r.editor,t]),b.useDebugValue(s),s}const ek=!1,Nl=typeof window>"u",tk=Nl||!!(typeof window<"u"&&window.next);class kc{constructor(e){this.editor=null,this.subscriptions=new Set,this.isComponentMounted=!1,this.previousDeps=null,this.instanceId="",this.options=e,this.subscriptions=new Set,this.setEditor(this.getInitialEditor()),this.scheduleDestroy(),this.getEditor=this.getEditor.bind(this),this.getServerSnapshot=this.getServerSnapshot.bind(this),this.subscribe=this.subscribe.bind(this),this.refreshEditorInstance=this.refreshEditorInstance.bind(this),this.scheduleDestroy=this.scheduleDestroy.bind(this),this.onRender=this.onRender.bind(this),this.createEditor=this.createEditor.bind(this)}setEditor(e){this.editor=e,this.instanceId=Math.random().toString(36).slice(2,9),this.subscriptions.forEach(t=>t())}getInitialEditor(){return this.options.current.immediatelyRender===void 0?Nl||tk?null:this.createEditor():(this.options.current.immediatelyRender,this.options.current.immediatelyRender?this.createEditor():null)}createEditor(){const e={...this.options.current,onBeforeCreate:(...s)=>{var n,i;return(i=(n=this.options.current).onBeforeCreate)===null||i===void 0?void 0:i.call(n,...s)},onBlur:(...s)=>{var n,i;return(i=(n=this.options.current).onBlur)===null||i===void 0?void 0:i.call(n,...s)},onCreate:(...s)=>{var n,i;return(i=(n=this.options.current).onCreate)===null||i===void 0?void 0:i.call(n,...s)},onDestroy:(...s)=>{var n,i;return(i=(n=this.options.current).onDestroy)===null||i===void 0?void 0:i.call(n,...s)},onFocus:(...s)=>{var n,i;return(i=(n=this.options.current).onFocus)===null||i===void 0?void 0:i.call(n,...s)},onSelectionUpdate:(...s)=>{var n,i;return(i=(n=this.options.current).onSelectionUpdate)===null||i===void 0?void 0:i.call(n,...s)},onTransaction:(...s)=>{var n,i;return(i=(n=this.options.current).onTransaction)===null||i===void 0?void 0:i.call(n,...s)},onUpdate:(...s)=>{var n,i;return(i=(n=this.options.current).onUpdate)===null||i===void 0?void 0:i.call(n,...s)},onContentError:(...s)=>{var n,i;return(i=(n=this.options.current).onContentError)===null||i===void 0?void 0:i.call(n,...s)},onDrop:(...s)=>{var n,i;return(i=(n=this.options.current).onDrop)===null||i===void 0?void 0:i.call(n,...s)},onPaste:(...s)=>{var n,i;return(i=(n=this.options.current).onPaste)===null||i===void 0?void 0:i.call(n,...s)}};return new Pj(e)}getEditor(){return this.editor}getServerSnapshot(){return null}subscribe(e){return this.subscriptions.add(e),()=>{this.subscriptions.delete(e)}}static compareOptions(e,t){return Object.keys(e).every(s=>["onCreate","onBeforeCreate","onDestroy","onUpdate","onTransaction","onFocus","onBlur","onSelectionUpdate","onContentError","onDrop","onPaste"].includes(s)?!0:s==="extensions"&&e.extensions&&t.extensions?e.extensions.length!==t.extensions.length?!1:e.extensions.every((n,i)=>{var a;return n===((a=t.extensions)===null||a===void 0?void 0:a[i])}):e[s]===t[s])}onRender(e){return()=>(this.isComponentMounted=!0,clearTimeout(this.scheduledDestructionTimeout),this.editor&&!this.editor.isDestroyed&&e.length===0?kc.compareOptions(this.options.current,this.editor.options)||this.editor.setOptions({...this.options.current,editable:this.editor.isEditable}):this.refreshEditorInstance(e),()=>{this.isComponentMounted=!1,this.scheduleDestroy()})}refreshEditorInstance(e){if(this.editor&&!this.editor.isDestroyed){if(this.previousDeps===null){this.previousDeps=e;return}if(this.previousDeps.length===e.length&&this.previousDeps.every((s,n)=>s===e[n]))return}this.editor&&!this.editor.isDestroyed&&this.editor.destroy(),this.setEditor(this.createEditor()),this.previousDeps=e}scheduleDestroy(){const e=this.instanceId,t=this.editor;this.scheduledDestructionTimeout=setTimeout(()=>{if(this.isComponentMounted&&this.instanceId===e){t&&t.setOptions(this.options.current);return}t&&!t.isDestroyed&&(t.destroy(),this.instanceId===e&&this.setEditor(null))},1)}}function rk(r={},e=[]){const t=b.useRef(r);t.current=r;const[s]=b.useState(()=>new kc(t)),n=jc.useSyncExternalStore(s.subscribe,s.getEditor,s.getServerSnapshot);return b.useDebugValue(n),b.useEffect(s.onRender(e)),Zj({editor:n,selector:({transactionNumber:i})=>r.shouldRerenderOnTransaction===!1?null:r.immediatelyRender&&i===0?0:i+1}),n}const sk=b.createContext({editor:null});sk.Consumer;const Xp=b.createContext({onDragStart:void 0}),nk=()=>b.useContext(Xp),ik=ze.forwardRef((r,e)=>{const{onDragStart:t}=nk(),s=r.as||"div";return ze.createElement(s,{...r,ref:e,"data-node-view-wrapper":"",onDragStart:t,style:{whiteSpace:"normal",...r.style}})});function mu(r){return!!(typeof r=="function"&&r.prototype&&r.prototype.isReactComponent)}function gu(r){return!!(typeof r=="object"&&r.$$typeof&&(r.$$typeof.toString()==="Symbol(react.forward_ref)"||r.$$typeof.description==="react.forward_ref"))}function ok(r){return!!(typeof r=="object"&&r.$$typeof&&(r.$$typeof.toString()==="Symbol(react.memo)"||r.$$typeof.description==="react.memo"))}function ak(r){if(mu(r)||gu(r))return!0;if(ok(r)){const e=r.type;if(e)return mu(e)||gu(e)}return!1}function lk(){try{if(b.version)return parseInt(b.version.split(".")[0],10)>=19}catch{}return!1}class ck{constructor(e,{editor:t,props:s={},as:n="div",className:i=""}){this.ref=null,this.id=Math.floor(Math.random()*4294967295).toString(),this.component=e,this.editor=t,this.props=s,this.element=document.createElement(n),this.element.classList.add("react-renderer"),i&&this.element.classList.add(...i.split(" ")),this.editor.isInitialized?Xu.flushSync(()=>{this.render()}):this.render()}render(){var e;const t=this.component,s=this.props,n=this.editor,i=lk(),a=ak(t),l={...s};l.ref&&!(i||a)&&delete l.ref,!l.ref&&(i||a)&&(l.ref=c=>{this.ref=c}),this.reactElement=ze.createElement(t,{...l}),(e=n==null?void 0:n.contentComponent)===null||e===void 0||e.setRenderer(this.id,this)}updateProps(e={}){this.props={...this.props,...e},this.render()}destroy(){var e;const t=this.editor;(e=t==null?void 0:t.contentComponent)===null||e===void 0||e.removeRenderer(this.id)}updateAttributes(e){Object.keys(e).forEach(t=>{this.element.setAttribute(t,e[t])})}}class dk extends $j{mount(){const e={editor:this.editor,node:this.node,decorations:this.decorations,innerDecorations:this.innerDecorations,view:this.view,selected:!1,extension:this.extension,HTMLAttributes:this.HTMLAttributes,getPos:()=>this.getPos(),updateAttributes:(d={})=>this.updateAttributes(d),deleteNode:()=>this.deleteNode(),ref:b.createRef()};if(!this.component.displayName){const d=u=>u.charAt(0).toUpperCase()+u.substring(1);this.component.displayName=d(this.extension.name)}const n={onDragStart:this.onDragStart.bind(this),nodeViewContentRef:d=>{d&&this.contentDOMElement&&d.firstChild!==this.contentDOMElement&&d.appendChild(this.contentDOMElement)}},i=this.component,a=b.memo(d=>ze.createElement(Xp.Provider,{value:n},b.createElement(i,d)));a.displayName="ReactNodeView",this.node.isLeaf?this.contentDOMElement=null:this.options.contentDOMElementTag?this.contentDOMElement=document.createElement(this.options.contentDOMElementTag):this.contentDOMElement=document.createElement(this.node.isInline?"span":"div"),this.contentDOMElement&&(this.contentDOMElement.dataset.nodeViewContentReact="",this.contentDOMElement.style.whiteSpace="inherit");let l=this.node.isInline?"span":"div";this.options.as&&(l=this.options.as);const{className:c=""}=this.options;this.handleSelectionUpdate=this.handleSelectionUpdate.bind(this),this.renderer=new ck(a,{editor:this.editor,props:e,as:l,className:`node-${this.node.type.name} ${c}`.trim()}),this.editor.on("selectionUpdate",this.handleSelectionUpdate),this.updateElementAttributes()}get dom(){var e;if(this.renderer.element.firstElementChild&&!(!((e=this.renderer.element.firstElementChild)===null||e===void 0)&&e.hasAttribute("data-node-view-wrapper")))throw Error("Please use the NodeViewWrapper component for your node view.");return this.renderer.element}get contentDOM(){return this.node.isLeaf?null:this.contentDOMElement}handleSelectionUpdate(){const{from:e,to:t}=this.editor.state.selection,s=this.getPos();if(typeof s=="number")if(e<=s&&t>=s+this.node.nodeSize){if(this.renderer.props.selected)return;this.selectNode()}else{if(!this.renderer.props.selected)return;this.deselectNode()}}update(e,t,s){const n=i=>{this.renderer.updateProps(i),typeof this.options.attrs=="function"&&this.updateElementAttributes()};if(e.type!==this.node.type)return!1;if(typeof this.options.update=="function"){const i=this.node,a=this.decorations,l=this.innerDecorations;return this.node=e,this.decorations=t,this.innerDecorations=s,this.options.update({oldNode:i,oldDecorations:a,newNode:e,newDecorations:t,oldInnerDecorations:l,innerDecorations:s,updateProps:()=>n({node:e,decorations:t,innerDecorations:s})})}return e===this.node&&this.decorations===t&&this.innerDecorations===s||(this.node=e,this.decorations=t,this.innerDecorations=s,n({node:e,decorations:t,innerDecorations:s})),!0}selectNode(){this.renderer.updateProps({selected:!0}),this.renderer.element.classList.add("ProseMirror-selectednode")}deselectNode(){this.renderer.updateProps({selected:!1}),this.renderer.element.classList.remove("ProseMirror-selectednode")}destroy(){this.renderer.destroy(),this.editor.off("selectionUpdate",this.handleSelectionUpdate),this.contentDOMElement=null}updateElementAttributes(){if(this.options.attrs){let e={};if(typeof this.options.attrs=="function"){const t=this.editor.extensionManager.attributes,s=Yi(this.node,t);e=this.options.attrs({node:this.node,HTMLAttributes:s})}else e=this.options.attrs;this.renderer.updateAttributes(e)}}}function uk(r,e){return t=>t.editor.contentComponent?new dk(r,t,e):{}}const hk=/^\s*>\s$/,fk=ut.create({name:"blockquote",addOptions(){return{HTMLAttributes:{}}},content:"block+",group:"block",defining:!0,parseHTML(){return[{tag:"blockquote"}]},renderHTML({HTMLAttributes:r}){return["blockquote",We(this.options.HTMLAttributes,r),0]},addCommands(){return{setBlockquote:()=>({commands:r})=>r.wrapIn(this.name),toggleBlockquote:()=>({commands:r})=>r.toggleWrap(this.name),unsetBlockquote:()=>({commands:r})=>r.lift(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-b":()=>this.editor.commands.toggleBlockquote()}},addInputRules(){return[Pn({find:hk,type:this.type})]}}),pk=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))$/,mk=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))/g,gk=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))$/,xk=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))/g,yk=Kt.create({name:"bold",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"strong"},{tag:"b",getAttrs:r=>r.style.fontWeight!=="normal"&&null},{style:"font-weight=400",clearMark:r=>r.type.name===this.name},{style:"font-weight",getAttrs:r=>/^(bold(er)?|[5-9]\d{2,})$/.test(r)&&null}]},renderHTML({HTMLAttributes:r}){return["strong",We(this.options.HTMLAttributes,r),0]},addCommands(){return{setBold:()=>({commands:r})=>r.setMark(this.name),toggleBold:()=>({commands:r})=>r.toggleMark(this.name),unsetBold:()=>({commands:r})=>r.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-b":()=>this.editor.commands.toggleBold(),"Mod-B":()=>this.editor.commands.toggleBold()}},addInputRules(){return[Ks({find:pk,type:this.type}),Ks({find:gk,type:this.type})]},addPasteRules(){return[ys({find:mk,type:this.type}),ys({find:xk,type:this.type})]}}),bk="listItem",xu="textStyle",yu=/^\s*([-+*])\s$/,Qp=ut.create({name:"bulletList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:"ul"}]},renderHTML({HTMLAttributes:r}){return["ul",We(this.options.HTMLAttributes,r),0]},addCommands(){return{toggleBulletList:()=>({commands:r,chain:e})=>this.options.keepAttributes?e().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(bk,this.editor.getAttributes(xu)).run():r.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-8":()=>this.editor.commands.toggleBulletList()}},addInputRules(){let r=Pn({find:yu,type:this.type});return(this.options.keepMarks||this.options.keepAttributes)&&(r=Pn({find:yu,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:()=>this.editor.getAttributes(xu),editor:this.editor})),[r]}}),wk=/(^|[^`])`([^`]+)`(?!`)/,vk=/(^|[^`])`([^`]+)`(?!`)/g,Nk=Kt.create({name:"code",addOptions(){return{HTMLAttributes:{}}},excludes:"_",code:!0,exitable:!0,parseHTML(){return[{tag:"code"}]},renderHTML({HTMLAttributes:r}){return["code",We(this.options.HTMLAttributes,r),0]},addCommands(){return{setCode:()=>({commands:r})=>r.setMark(this.name),toggleCode:()=>({commands:r})=>r.toggleMark(this.name),unsetCode:()=>({commands:r})=>r.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-e":()=>this.editor.commands.toggleCode()}},addInputRules(){return[Ks({find:wk,type:this.type})]},addPasteRules(){return[ys({find:vk,type:this.type})]}}),jk=/^```([a-z]+)?[\s\n]$/,kk=/^~~~([a-z]+)?[\s\n]$/,Zp=ut.create({name:"codeBlock",addOptions(){return{languageClassPrefix:"language-",exitOnTripleEnter:!0,exitOnArrowDown:!0,defaultLanguage:null,HTMLAttributes:{}}},content:"text*",marks:"",group:"block",code:!0,defining:!0,addAttributes(){return{language:{default:this.options.defaultLanguage,parseHTML:r=>{var e;const{languageClassPrefix:t}=this.options,i=[...((e=r.firstElementChild)===null||e===void 0?void 0:e.classList)||[]].filter(a=>a.startsWith(t)).map(a=>a.replace(t,""))[0];return i||null},rendered:!1}}},parseHTML(){return[{tag:"pre",preserveWhitespace:"full"}]},renderHTML({node:r,HTMLAttributes:e}){return["pre",We(this.options.HTMLAttributes,e),["code",{class:r.attrs.language?this.options.languageClassPrefix+r.attrs.language:null},0]]},addCommands(){return{setCodeBlock:r=>({commands:e})=>e.setNode(this.name,r),toggleCodeBlock:r=>({commands:e})=>e.toggleNode(this.name,"paragraph",r)}},addKeyboardShortcuts(){return{"Mod-Alt-c":()=>this.editor.commands.toggleCodeBlock(),Backspace:()=>{const{empty:r,$anchor:e}=this.editor.state.selection,t=e.pos===1;return!r||e.parent.type.name!==this.name?!1:t||!e.parent.textContent.length?this.editor.commands.clearNodes():!1},Enter:({editor:r})=>{if(!this.options.exitOnTripleEnter)return!1;const{state:e}=r,{selection:t}=e,{$from:s,empty:n}=t;if(!n||s.parent.type!==this.type)return!1;const i=s.parentOffset===s.parent.nodeSize-2,a=s.parent.textContent.endsWith(`

`);return!i||!a?!1:r.chain().command(({tr:l})=>(l.delete(s.pos-2,s.pos),!0)).exitCode().run()},ArrowDown:({editor:r})=>{if(!this.options.exitOnArrowDown)return!1;const{state:e}=r,{selection:t,doc:s}=e,{$from:n,empty:i}=t;if(!i||n.parent.type!==this.type||!(n.parentOffset===n.parent.nodeSize-2))return!1;const l=n.after();return l===void 0?!1:s.nodeAt(l)?r.commands.command(({tr:d})=>(d.setSelection(de.near(s.resolve(l))),!0)):r.commands.exitCode()}}},addInputRules(){return[vl({find:jk,type:this.type,getAttributes:r=>({language:r[1]})}),vl({find:kk,type:this.type,getAttributes:r=>({language:r[1]})})]},addProseMirrorPlugins(){return[new Je({key:new yt("codeBlockVSCodeHandler"),props:{handlePaste:(r,e)=>{if(!e.clipboardData||this.editor.isActive(this.type.name))return!1;const t=e.clipboardData.getData("text/plain"),s=e.clipboardData.getData("vscode-editor-data"),n=s?JSON.parse(s):void 0,i=n==null?void 0:n.mode;if(!t||!i)return!1;const{tr:a,schema:l}=r.state,c=l.text(t.replace(/\r\n?/g,`
`));return a.replaceSelectionWith(this.type.create({language:i},c)),a.selection.$from.parent.type!==this.type&&a.setSelection(ce.near(a.doc.resolve(Math.max(0,a.selection.from-2)))),a.setMeta("paste",!0),r.dispatch(a),!0}}})]}}),Sk=ut.create({name:"doc",topNode:!0,content:"block+"});function Ek(r={}){return new Je({view(e){return new Ak(e,r)}})}class Ak{constructor(e,t){var s;this.editorView=e,this.cursorPos=null,this.element=null,this.timeout=-1,this.width=(s=t.width)!==null&&s!==void 0?s:1,this.color=t.color===!1?void 0:t.color||"black",this.class=t.class,this.handlers=["dragover","dragend","drop","dragleave"].map(n=>{let i=a=>{this[n](a)};return e.dom.addEventListener(n,i),{name:n,handler:i}})}destroy(){this.handlers.forEach(({name:e,handler:t})=>this.editorView.dom.removeEventListener(e,t))}update(e,t){this.cursorPos!=null&&t.doc!=e.state.doc&&(this.cursorPos>e.state.doc.content.size?this.setCursor(null):this.updateOverlay())}setCursor(e){e!=this.cursorPos&&(this.cursorPos=e,e==null?(this.element.parentNode.removeChild(this.element),this.element=null):this.updateOverlay())}updateOverlay(){let e=this.editorView.state.doc.resolve(this.cursorPos),t=!e.parent.inlineContent,s,n=this.editorView.dom,i=n.getBoundingClientRect(),a=i.width/n.offsetWidth,l=i.height/n.offsetHeight;if(t){let h=e.nodeBefore,f=e.nodeAfter;if(h||f){let p=this.editorView.nodeDOM(this.cursorPos-(h?h.nodeSize:0));if(p){let m=p.getBoundingClientRect(),g=h?m.bottom:m.top;h&&f&&(g=(g+this.editorView.nodeDOM(this.cursorPos).getBoundingClientRect().top)/2);let y=this.width/2*l;s={left:m.left,right:m.right,top:g-y,bottom:g+y}}}}if(!s){let h=this.editorView.coordsAtPos(this.cursorPos),f=this.width/2*a;s={left:h.left-f,right:h.left+f,top:h.top,bottom:h.bottom}}let c=this.editorView.dom.offsetParent;this.element||(this.element=c.appendChild(document.createElement("div")),this.class&&(this.element.className=this.class),this.element.style.cssText="position: absolute; z-index: 50; pointer-events: none;",this.color&&(this.element.style.backgroundColor=this.color)),this.element.classList.toggle("prosemirror-dropcursor-block",t),this.element.classList.toggle("prosemirror-dropcursor-inline",!t);let d,u;if(!c||c==document.body&&getComputedStyle(c).position=="static")d=-pageXOffset,u=-pageYOffset;else{let h=c.getBoundingClientRect(),f=h.width/c.offsetWidth,p=h.height/c.offsetHeight;d=h.left-c.scrollLeft*f,u=h.top-c.scrollTop*p}this.element.style.left=(s.left-d)/a+"px",this.element.style.top=(s.top-u)/l+"px",this.element.style.width=(s.right-s.left)/a+"px",this.element.style.height=(s.bottom-s.top)/l+"px"}scheduleRemoval(e){clearTimeout(this.timeout),this.timeout=setTimeout(()=>this.setCursor(null),e)}dragover(e){if(!this.editorView.editable)return;let t=this.editorView.posAtCoords({left:e.clientX,top:e.clientY}),s=t&&t.inside>=0&&this.editorView.state.doc.nodeAt(t.inside),n=s&&s.type.spec.disableDropCursor,i=typeof n=="function"?n(this.editorView,t,e):n;if(t&&!i){let a=t.pos;if(this.editorView.dragging&&this.editorView.dragging.slice){let l=Lf(this.editorView.state.doc,a,this.editorView.dragging.slice);l!=null&&(a=l)}this.setCursor(a),this.scheduleRemoval(5e3)}}dragend(){this.scheduleRemoval(20)}drop(){this.scheduleRemoval(20)}dragleave(e){this.editorView.dom.contains(e.relatedTarget)||this.setCursor(null)}}const Ck=nt.create({name:"dropCursor",addOptions(){return{color:"currentColor",width:1,class:void 0}},addProseMirrorPlugins(){return[Ek(this.options)]}});class Pe extends de{constructor(e){super(e,e)}map(e,t){let s=e.resolve(t.map(this.head));return Pe.valid(s)?new Pe(s):de.near(s)}content(){return Q.empty}eq(e){return e instanceof Pe&&e.head==this.head}toJSON(){return{type:"gapcursor",pos:this.head}}static fromJSON(e,t){if(typeof t.pos!="number")throw new RangeError("Invalid input for GapCursor.fromJSON");return new Pe(e.resolve(t.pos))}getBookmark(){return new Sc(this.anchor)}static valid(e){let t=e.parent;if(t.isTextblock||!Mk(e)||!Dk(e))return!1;let s=t.type.spec.allowGapCursor;if(s!=null)return s;let n=t.contentMatchAt(e.index()).defaultType;return n&&n.isTextblock}static findGapCursorFrom(e,t,s=!1){e:for(;;){if(!s&&Pe.valid(e))return e;let n=e.pos,i=null;for(let a=e.depth;;a--){let l=e.node(a);if(t>0?e.indexAfter(a)<l.childCount:e.index(a)>0){i=l.child(t>0?e.indexAfter(a):e.index(a)-1);break}else if(a==0)return null;n+=t;let c=e.doc.resolve(n);if(Pe.valid(c))return c}for(;;){let a=t>0?i.firstChild:i.lastChild;if(!a){if(i.isAtom&&!i.isText&&!se.isSelectable(i)){e=e.doc.resolve(n+i.nodeSize*t),s=!1;continue e}break}i=a,n+=t;let l=e.doc.resolve(n);if(Pe.valid(l))return l}return null}}}Pe.prototype.visible=!1;Pe.findFrom=Pe.findGapCursorFrom;de.jsonID("gapcursor",Pe);class Sc{constructor(e){this.pos=e}map(e){return new Sc(e.map(this.pos))}resolve(e){let t=e.resolve(this.pos);return Pe.valid(t)?new Pe(t):de.near(t)}}function Mk(r){for(let e=r.depth;e>=0;e--){let t=r.index(e),s=r.node(e);if(t==0){if(s.type.spec.isolating)return!0;continue}for(let n=s.child(t-1);;n=n.lastChild){if(n.childCount==0&&!n.inlineContent||n.isAtom||n.type.spec.isolating)return!0;if(n.inlineContent)return!1}}return!0}function Dk(r){for(let e=r.depth;e>=0;e--){let t=r.indexAfter(e),s=r.node(e);if(t==s.childCount){if(s.type.spec.isolating)return!0;continue}for(let n=s.child(t);;n=n.firstChild){if(n.childCount==0&&!n.inlineContent||n.isAtom||n.type.spec.isolating)return!0;if(n.inlineContent)return!1}}return!0}function Tk(){return new Je({props:{decorations:Pk,createSelectionBetween(r,e,t){return e.pos==t.pos&&Pe.valid(t)?new Pe(t):null},handleClick:Rk,handleKeyDown:Ok,handleDOMEvents:{beforeinput:Ik}}})}const Ok=kp({ArrowLeft:ai("horiz",-1),ArrowRight:ai("horiz",1),ArrowUp:ai("vert",-1),ArrowDown:ai("vert",1)});function ai(r,e){const t=r=="vert"?e>0?"down":"up":e>0?"right":"left";return function(s,n,i){let a=s.selection,l=e>0?a.$to:a.$from,c=a.empty;if(a instanceof ce){if(!i.endOfTextblock(t)||l.depth==0)return!1;c=!1,l=s.doc.resolve(e>0?l.after():l.before())}let d=Pe.findGapCursorFrom(l,e,c);return d?(n&&n(s.tr.setSelection(new Pe(d))),!0):!1}}function Rk(r,e,t){if(!r||!r.editable)return!1;let s=r.state.doc.resolve(e);if(!Pe.valid(s))return!1;let n=r.posAtCoords({left:t.clientX,top:t.clientY});return n&&n.inside>-1&&se.isSelectable(r.state.doc.nodeAt(n.inside))?!1:(r.dispatch(r.state.tr.setSelection(new Pe(s))),!0)}function Ik(r,e){if(e.inputType!="insertCompositionText"||!(r.state.selection instanceof Pe))return!1;let{$from:t}=r.state.selection,s=t.parent.contentMatchAt(t.index()).findWrapping(r.state.schema.nodes.text);if(!s)return!1;let n=z.empty;for(let a=s.length-1;a>=0;a--)n=z.from(s[a].createAndFill(null,n));let i=r.state.tr.replace(t.pos,t.pos,new Q(n,0,0));return i.setSelection(ce.near(i.doc.resolve(t.pos+1))),r.dispatch(i),!1}function Pk(r){if(!(r.selection instanceof Pe))return null;let e=document.createElement("div");return e.className="ProseMirror-gapcursor",Fe.create(r.doc,[Nt.widget(r.selection.head,e,{key:"gapcursor"})])}const Lk=nt.create({name:"gapCursor",addProseMirrorPlugins(){return[Tk()]},extendNodeSchema(r){var e;const t={name:r.name,options:r.options,storage:r.storage};return{allowGapCursor:(e=fe(ee(r,"allowGapCursor",t)))!==null&&e!==void 0?e:null}}}),$k=ut.create({name:"hardBreak",addOptions(){return{keepMarks:!0,HTMLAttributes:{}}},inline:!0,group:"inline",selectable:!1,linebreakReplacement:!0,parseHTML(){return[{tag:"br"}]},renderHTML({HTMLAttributes:r}){return["br",We(this.options.HTMLAttributes,r)]},renderText(){return`
`},addCommands(){return{setHardBreak:()=>({commands:r,chain:e,state:t,editor:s})=>r.first([()=>r.exitCode(),()=>r.command(()=>{const{selection:n,storedMarks:i}=t;if(n.$from.parent.type.spec.isolating)return!1;const{keepMarks:a}=this.options,{splittableMarks:l}=s.extensionManager,c=i||n.$to.parentOffset&&n.$from.marks();return e().insertContent({type:this.name}).command(({tr:d,dispatch:u})=>{if(u&&c&&a){const h=c.filter(f=>l.includes(f.type.name));d.ensureMarks(h)}return!0}).run()})])}},addKeyboardShortcuts(){return{"Mod-Enter":()=>this.editor.commands.setHardBreak(),"Shift-Enter":()=>this.editor.commands.setHardBreak()}}}),_k=ut.create({name:"heading",addOptions(){return{levels:[1,2,3,4,5,6],HTMLAttributes:{}}},content:"inline*",group:"block",defining:!0,addAttributes(){return{level:{default:1,rendered:!1}}},parseHTML(){return this.options.levels.map(r=>({tag:`h${r}`,attrs:{level:r}}))},renderHTML({node:r,HTMLAttributes:e}){return[`h${this.options.levels.includes(r.attrs.level)?r.attrs.level:this.options.levels[0]}`,We(this.options.HTMLAttributes,e),0]},addCommands(){return{setHeading:r=>({commands:e})=>this.options.levels.includes(r.level)?e.setNode(this.name,r):!1,toggleHeading:r=>({commands:e})=>this.options.levels.includes(r.level)?e.toggleNode(this.name,"paragraph",r):!1}},addKeyboardShortcuts(){return this.options.levels.reduce((r,e)=>({...r,[`Mod-Alt-${e}`]:()=>this.editor.commands.toggleHeading({level:e})}),{})},addInputRules(){return this.options.levels.map(r=>vl({find:new RegExp(`^(#{${Math.min(...this.options.levels)},${r}})\\s$`),type:this.type,getAttributes:{level:r}}))}});var Xi=200,Ge=function(){};Ge.prototype.append=function(e){return e.length?(e=Ge.from(e),!this.length&&e||e.length<Xi&&this.leafAppend(e)||this.length<Xi&&e.leafPrepend(this)||this.appendInner(e)):this};Ge.prototype.prepend=function(e){return e.length?Ge.from(e).append(this):this};Ge.prototype.appendInner=function(e){return new Fk(this,e)};Ge.prototype.slice=function(e,t){return e===void 0&&(e=0),t===void 0&&(t=this.length),e>=t?Ge.empty:this.sliceInner(Math.max(0,e),Math.min(this.length,t))};Ge.prototype.get=function(e){if(!(e<0||e>=this.length))return this.getInner(e)};Ge.prototype.forEach=function(e,t,s){t===void 0&&(t=0),s===void 0&&(s=this.length),t<=s?this.forEachInner(e,t,s,0):this.forEachInvertedInner(e,t,s,0)};Ge.prototype.map=function(e,t,s){t===void 0&&(t=0),s===void 0&&(s=this.length);var n=[];return this.forEach(function(i,a){return n.push(e(i,a))},t,s),n};Ge.from=function(e){return e instanceof Ge?e:e&&e.length?new em(e):Ge.empty};var em=function(r){function e(s){r.call(this),this.values=s}r&&(e.__proto__=r),e.prototype=Object.create(r&&r.prototype),e.prototype.constructor=e;var t={length:{configurable:!0},depth:{configurable:!0}};return e.prototype.flatten=function(){return this.values},e.prototype.sliceInner=function(n,i){return n==0&&i==this.length?this:new e(this.values.slice(n,i))},e.prototype.getInner=function(n){return this.values[n]},e.prototype.forEachInner=function(n,i,a,l){for(var c=i;c<a;c++)if(n(this.values[c],l+c)===!1)return!1},e.prototype.forEachInvertedInner=function(n,i,a,l){for(var c=i-1;c>=a;c--)if(n(this.values[c],l+c)===!1)return!1},e.prototype.leafAppend=function(n){if(this.length+n.length<=Xi)return new e(this.values.concat(n.flatten()))},e.prototype.leafPrepend=function(n){if(this.length+n.length<=Xi)return new e(n.flatten().concat(this.values))},t.length.get=function(){return this.values.length},t.depth.get=function(){return 0},Object.defineProperties(e.prototype,t),e}(Ge);Ge.empty=new em([]);var Fk=function(r){function e(t,s){r.call(this),this.left=t,this.right=s,this.length=t.length+s.length,this.depth=Math.max(t.depth,s.depth)+1}return r&&(e.__proto__=r),e.prototype=Object.create(r&&r.prototype),e.prototype.constructor=e,e.prototype.flatten=function(){return this.left.flatten().concat(this.right.flatten())},e.prototype.getInner=function(s){return s<this.left.length?this.left.get(s):this.right.get(s-this.left.length)},e.prototype.forEachInner=function(s,n,i,a){var l=this.left.length;if(n<l&&this.left.forEachInner(s,n,Math.min(i,l),a)===!1||i>l&&this.right.forEachInner(s,Math.max(n-l,0),Math.min(this.length,i)-l,a+l)===!1)return!1},e.prototype.forEachInvertedInner=function(s,n,i,a){var l=this.left.length;if(n>l&&this.right.forEachInvertedInner(s,n-l,Math.max(i,l)-l,a+l)===!1||i<l&&this.left.forEachInvertedInner(s,Math.min(n,l),i,a)===!1)return!1},e.prototype.sliceInner=function(s,n){if(s==0&&n==this.length)return this;var i=this.left.length;return n<=i?this.left.slice(s,n):s>=i?this.right.slice(s-i,n-i):this.left.slice(s,i).append(this.right.slice(0,n-i))},e.prototype.leafAppend=function(s){var n=this.right.leafAppend(s);if(n)return new e(this.left,n)},e.prototype.leafPrepend=function(s){var n=this.left.leafPrepend(s);if(n)return new e(n,this.right)},e.prototype.appendInner=function(s){return this.left.depth>=Math.max(this.right.depth,s.depth)+1?new e(this.left,new e(this.right,s)):new e(this,s)},e}(Ge);const Bk=500;class Ot{constructor(e,t){this.items=e,this.eventCount=t}popEvent(e,t){if(this.eventCount==0)return null;let s=this.items.length;for(;;s--)if(this.items.get(s-1).selection){--s;break}let n,i;t&&(n=this.remapping(s,this.items.length),i=n.maps.length);let a=e.tr,l,c,d=[],u=[];return this.items.forEach((h,f)=>{if(!h.step){n||(n=this.remapping(s,f+1),i=n.maps.length),i--,u.push(h);return}if(n){u.push(new $t(h.map));let p=h.step.map(n.slice(i)),m;p&&a.maybeStep(p).doc&&(m=a.mapping.maps[a.mapping.maps.length-1],d.push(new $t(m,void 0,void 0,d.length+u.length))),i--,m&&n.appendMap(m,i)}else a.maybeStep(h.step);if(h.selection)return l=n?h.selection.map(n.slice(i)):h.selection,c=new Ot(this.items.slice(0,s).append(u.reverse().concat(d)),this.eventCount-1),!1},this.items.length,0),{remaining:c,transform:a,selection:l}}addTransform(e,t,s,n){let i=[],a=this.eventCount,l=this.items,c=!n&&l.length?l.get(l.length-1):null;for(let u=0;u<e.steps.length;u++){let h=e.steps[u].invert(e.docs[u]),f=new $t(e.mapping.maps[u],h,t),p;(p=c&&c.merge(f))&&(f=p,u?i.pop():l=l.slice(0,l.length-1)),i.push(f),t&&(a++,t=void 0),n||(c=f)}let d=a-s.depth;return d>zk&&(l=Uk(l,d),a-=d),new Ot(l.append(i),a)}remapping(e,t){let s=new Cn;return this.items.forEach((n,i)=>{let a=n.mirrorOffset!=null&&i-n.mirrorOffset>=e?s.maps.length-n.mirrorOffset:void 0;s.appendMap(n.map,a)},e,t),s}addMaps(e){return this.eventCount==0?this:new Ot(this.items.append(e.map(t=>new $t(t))),this.eventCount)}rebased(e,t){if(!this.eventCount)return this;let s=[],n=Math.max(0,this.items.length-t),i=e.mapping,a=e.steps.length,l=this.eventCount;this.items.forEach(f=>{f.selection&&l--},n);let c=t;this.items.forEach(f=>{let p=i.getMirror(--c);if(p==null)return;a=Math.min(a,p);let m=i.maps[p];if(f.step){let g=e.steps[p].invert(e.docs[p]),y=f.selection&&f.selection.map(i.slice(c+1,p));y&&l++,s.push(new $t(m,g,y))}else s.push(new $t(m))},n);let d=[];for(let f=t;f<a;f++)d.push(new $t(i.maps[f]));let u=this.items.slice(0,n).append(d).append(s),h=new Ot(u,l);return h.emptyItemCount()>Bk&&(h=h.compress(this.items.length-s.length)),h}emptyItemCount(){let e=0;return this.items.forEach(t=>{t.step||e++}),e}compress(e=this.items.length){let t=this.remapping(0,e),s=t.maps.length,n=[],i=0;return this.items.forEach((a,l)=>{if(l>=e)n.push(a),a.selection&&i++;else if(a.step){let c=a.step.map(t.slice(s)),d=c&&c.getMap();if(s--,d&&t.appendMap(d,s),c){let u=a.selection&&a.selection.map(t.slice(s));u&&i++;let h=new $t(d.invert(),c,u),f,p=n.length-1;(f=n.length&&n[p].merge(h))?n[p]=f:n.push(h)}}else a.map&&s--},this.items.length,0),new Ot(Ge.from(n.reverse()),i)}}Ot.empty=new Ot(Ge.empty,0);function Uk(r,e){let t;return r.forEach((s,n)=>{if(s.selection&&e--==0)return t=n,!1}),r.slice(t)}class $t{constructor(e,t,s,n){this.map=e,this.step=t,this.selection=s,this.mirrorOffset=n}merge(e){if(this.step&&e.step&&!e.selection){let t=e.step.merge(this.step);if(t)return new $t(t.getMap().invert(),t,this.selection)}}}class pr{constructor(e,t,s,n,i){this.done=e,this.undone=t,this.prevRanges=s,this.prevTime=n,this.prevComposition=i}}const zk=20;function Wk(r,e,t,s){let n=t.getMeta(ls),i;if(n)return n.historyState;t.getMeta(qk)&&(r=new pr(r.done,r.undone,null,0,-1));let a=t.getMeta("appendedTransaction");if(t.steps.length==0)return r;if(a&&a.getMeta(ls))return a.getMeta(ls).redo?new pr(r.done.addTransform(t,void 0,s,ji(e)),r.undone,bu(t.mapping.maps),r.prevTime,r.prevComposition):new pr(r.done,r.undone.addTransform(t,void 0,s,ji(e)),null,r.prevTime,r.prevComposition);if(t.getMeta("addToHistory")!==!1&&!(a&&a.getMeta("addToHistory")===!1)){let l=t.getMeta("composition"),c=r.prevTime==0||!a&&r.prevComposition!=l&&(r.prevTime<(t.time||0)-s.newGroupDelay||!Hk(t,r.prevRanges)),d=a?Ma(r.prevRanges,t.mapping):bu(t.mapping.maps);return new pr(r.done.addTransform(t,c?e.selection.getBookmark():void 0,s,ji(e)),Ot.empty,d,t.time,l??r.prevComposition)}else return(i=t.getMeta("rebased"))?new pr(r.done.rebased(t,i),r.undone.rebased(t,i),Ma(r.prevRanges,t.mapping),r.prevTime,r.prevComposition):new pr(r.done.addMaps(t.mapping.maps),r.undone.addMaps(t.mapping.maps),Ma(r.prevRanges,t.mapping),r.prevTime,r.prevComposition)}function Hk(r,e){if(!e)return!1;if(!r.docChanged)return!0;let t=!1;return r.mapping.maps[0].forEach((s,n)=>{for(let i=0;i<e.length;i+=2)s<=e[i+1]&&n>=e[i]&&(t=!0)}),t}function bu(r){let e=[];for(let t=r.length-1;t>=0&&e.length==0;t--)r[t].forEach((s,n,i,a)=>e.push(i,a));return e}function Ma(r,e){if(!r)return null;let t=[];for(let s=0;s<r.length;s+=2){let n=e.map(r[s],1),i=e.map(r[s+1],-1);n<=i&&t.push(n,i)}return t}function Vk(r,e,t){let s=ji(e),n=ls.get(e).spec.config,i=(t?r.undone:r.done).popEvent(e,s);if(!i)return null;let a=i.selection.resolve(i.transform.doc),l=(t?r.done:r.undone).addTransform(i.transform,e.selection.getBookmark(),n,s),c=new pr(t?l:i.remaining,t?i.remaining:l,null,0,-1);return i.transform.setSelection(a).setMeta(ls,{redo:t,historyState:c})}let Da=!1,wu=null;function ji(r){let e=r.plugins;if(wu!=e){Da=!1,wu=e;for(let t=0;t<e.length;t++)if(e[t].spec.historyPreserveItems){Da=!0;break}}return Da}const ls=new yt("history"),qk=new yt("closeHistory");function Kk(r={}){return r={depth:r.depth||100,newGroupDelay:r.newGroupDelay||500},new Je({key:ls,state:{init(){return new pr(Ot.empty,Ot.empty,null,0,-1)},apply(e,t,s){return Wk(t,s,e,r)}},config:r,props:{handleDOMEvents:{beforeinput(e,t){let s=t.inputType,n=s=="historyUndo"?rm:s=="historyRedo"?sm:null;return n?(t.preventDefault(),n(e.state,e.dispatch)):!1}}}})}function tm(r,e){return(t,s)=>{let n=ls.getState(t);if(!n||(r?n.undone:n.done).eventCount==0)return!1;if(s){let i=Vk(n,t,r);i&&s(e?i.scrollIntoView():i)}return!0}}const rm=tm(!1,!0),sm=tm(!0,!0),Gk=nt.create({name:"history",addOptions(){return{depth:100,newGroupDelay:500}},addCommands(){return{undo:()=>({state:r,dispatch:e})=>rm(r,e),redo:()=>({state:r,dispatch:e})=>sm(r,e)}},addProseMirrorPlugins(){return[Kk(this.options)]},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Shift-Mod-z":()=>this.editor.commands.redo(),"Mod-y":()=>this.editor.commands.redo(),"Mod-я":()=>this.editor.commands.undo(),"Shift-Mod-я":()=>this.editor.commands.redo()}}}),Yk=ut.create({name:"horizontalRule",addOptions(){return{HTMLAttributes:{}}},group:"block",parseHTML(){return[{tag:"hr"}]},renderHTML({HTMLAttributes:r}){return["hr",We(this.options.HTMLAttributes,r)]},addCommands(){return{setHorizontalRule:()=>({chain:r,state:e})=>{if(!_j(e,e.schema.nodes[this.name]))return!1;const{selection:t}=e,{$from:s,$to:n}=t,i=r();return s.parentOffset===0?i.insertContentAt({from:Math.max(s.pos-1,0),to:n.pos},{type:this.name}):nj(t)?i.insertContentAt(n.pos,{type:this.name}):i.insertContent({type:this.name}),i.command(({tr:a,dispatch:l})=>{var c;if(l){const{$to:d}=a.selection,u=d.end();if(d.nodeAfter)d.nodeAfter.isTextblock?a.setSelection(ce.create(a.doc,d.pos+1)):d.nodeAfter.isBlock?a.setSelection(se.create(a.doc,d.pos)):a.setSelection(ce.create(a.doc,d.pos));else{const h=(c=d.parent.type.contentMatch.defaultType)===null||c===void 0?void 0:c.create();h&&(a.insert(u,h),a.setSelection(ce.create(a.doc,u+1)))}a.scrollIntoView()}return!0}).run()}}},addInputRules(){return[Lj({find:/^(?:---|—-|___\s|\*\*\*\s)$/,type:this.type})]}}),Jk=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))$/,Xk=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))/g,Qk=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))$/,Zk=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))/g,e2=Kt.create({name:"italic",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"em"},{tag:"i",getAttrs:r=>r.style.fontStyle!=="normal"&&null},{style:"font-style=normal",clearMark:r=>r.type.name===this.name},{style:"font-style=italic"}]},renderHTML({HTMLAttributes:r}){return["em",We(this.options.HTMLAttributes,r),0]},addCommands(){return{setItalic:()=>({commands:r})=>r.setMark(this.name),toggleItalic:()=>({commands:r})=>r.toggleMark(this.name),unsetItalic:()=>({commands:r})=>r.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-i":()=>this.editor.commands.toggleItalic(),"Mod-I":()=>this.editor.commands.toggleItalic()}},addInputRules(){return[Ks({find:Jk,type:this.type}),Ks({find:Qk,type:this.type})]},addPasteRules(){return[ys({find:Xk,type:this.type}),ys({find:Zk,type:this.type})]}}),jl=ut.create({name:"listItem",addOptions(){return{HTMLAttributes:{},bulletListTypeName:"bulletList",orderedListTypeName:"orderedList"}},content:"paragraph block*",defining:!0,parseHTML(){return[{tag:"li"}]},renderHTML({HTMLAttributes:r}){return["li",We(this.options.HTMLAttributes,r),0]},addKeyboardShortcuts(){return{Enter:()=>this.editor.commands.splitListItem(this.name),Tab:()=>this.editor.commands.sinkListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)}}}),t2="listItem",vu="textStyle",Nu=/^(\d+)\.\s$/,nm=ut.create({name:"orderedList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},addAttributes(){return{start:{default:1,parseHTML:r=>r.hasAttribute("start")?parseInt(r.getAttribute("start")||"",10):1},type:{default:null,parseHTML:r=>r.getAttribute("type")}}},parseHTML(){return[{tag:"ol"}]},renderHTML({HTMLAttributes:r}){const{start:e,...t}=r;return e===1?["ol",We(this.options.HTMLAttributes,t),0]:["ol",We(this.options.HTMLAttributes,r),0]},addCommands(){return{toggleOrderedList:()=>({commands:r,chain:e})=>this.options.keepAttributes?e().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(t2,this.editor.getAttributes(vu)).run():r.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-7":()=>this.editor.commands.toggleOrderedList()}},addInputRules(){let r=Pn({find:Nu,type:this.type,getAttributes:e=>({start:+e[1]}),joinPredicate:(e,t)=>t.childCount+t.attrs.start===+e[1]});return(this.options.keepMarks||this.options.keepAttributes)&&(r=Pn({find:Nu,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:e=>({start:+e[1],...this.editor.getAttributes(vu)}),joinPredicate:(e,t)=>t.childCount+t.attrs.start===+e[1],editor:this.editor})),[r]}}),r2=ut.create({name:"paragraph",priority:1e3,addOptions(){return{HTMLAttributes:{}}},group:"block",content:"inline*",parseHTML(){return[{tag:"p"}]},renderHTML({HTMLAttributes:r}){return["p",We(this.options.HTMLAttributes,r),0]},addCommands(){return{setParagraph:()=>({commands:r})=>r.setNode(this.name)}},addKeyboardShortcuts(){return{"Mod-Alt-0":()=>this.editor.commands.setParagraph()}}}),s2=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))$/,n2=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))/g,i2=Kt.create({name:"strike",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"s"},{tag:"del"},{tag:"strike"},{style:"text-decoration",consuming:!1,getAttrs:r=>r.includes("line-through")?{}:!1}]},renderHTML({HTMLAttributes:r}){return["s",We(this.options.HTMLAttributes,r),0]},addCommands(){return{setStrike:()=>({commands:r})=>r.setMark(this.name),toggleStrike:()=>({commands:r})=>r.toggleMark(this.name),unsetStrike:()=>({commands:r})=>r.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-s":()=>this.editor.commands.toggleStrike()}},addInputRules(){return[Ks({find:s2,type:this.type})]},addPasteRules(){return[ys({find:n2,type:this.type})]}}),o2=ut.create({name:"text",group:"inline"}),a2=nt.create({name:"starterKit",addExtensions(){const r=[];return this.options.bold!==!1&&r.push(yk.configure(this.options.bold)),this.options.blockquote!==!1&&r.push(fk.configure(this.options.blockquote)),this.options.bulletList!==!1&&r.push(Qp.configure(this.options.bulletList)),this.options.code!==!1&&r.push(Nk.configure(this.options.code)),this.options.codeBlock!==!1&&r.push(Zp.configure(this.options.codeBlock)),this.options.document!==!1&&r.push(Sk.configure(this.options.document)),this.options.dropcursor!==!1&&r.push(Ck.configure(this.options.dropcursor)),this.options.gapcursor!==!1&&r.push(Lk.configure(this.options.gapcursor)),this.options.hardBreak!==!1&&r.push($k.configure(this.options.hardBreak)),this.options.heading!==!1&&r.push(_k.configure(this.options.heading)),this.options.history!==!1&&r.push(Gk.configure(this.options.history)),this.options.horizontalRule!==!1&&r.push(Yk.configure(this.options.horizontalRule)),this.options.italic!==!1&&r.push(e2.configure(this.options.italic)),this.options.listItem!==!1&&r.push(jl.configure(this.options.listItem)),this.options.orderedList!==!1&&r.push(nm.configure(this.options.orderedList)),this.options.paragraph!==!1&&r.push(r2.configure(this.options.paragraph)),this.options.strike!==!1&&r.push(i2.configure(this.options.strike)),this.options.text!==!1&&r.push(o2.configure(this.options.text)),r}}),l2="aaa1rp3bb0ott3vie4c1le2ogado5udhabi7c0ademy5centure6ountant0s9o1tor4d0s1ult4e0g1ro2tna4f0l1rica5g0akhan5ency5i0g1rbus3force5tel5kdn3l0ibaba4pay4lfinanz6state5y2sace3tom5m0azon4ericanexpress7family11x2fam3ica3sterdam8nalytics7droid5quan4z2o0l2partments8p0le4q0uarelle8r0ab1mco4chi3my2pa2t0e3s0da2ia2sociates9t0hleta5torney7u0ction5di0ble3o3spost5thor3o0s4w0s2x0a2z0ure5ba0by2idu3namex4d1k2r0celona5laycard4s5efoot5gains6seball5ketball8uhaus5yern5b0c1t1va3cg1n2d1e0ats2uty4er2rlin4st0buy5t2f1g1h0arti5i0ble3d1ke2ng0o3o1z2j1lack0friday9ockbuster8g1omberg7ue3m0s1w2n0pparibas9o0ats3ehringer8fa2m1nd2o0k0ing5sch2tik2on4t1utique6x2r0adesco6idgestone9oadway5ker3ther5ussels7s1t1uild0ers6siness6y1zz3v1w1y1z0h3ca0b1fe2l0l1vinklein9m0era3p2non3petown5ital0one8r0avan4ds2e0er0s4s2sa1e1h1ino4t0ering5holic7ba1n1re3c1d1enter4o1rn3f0a1d2g1h0anel2nel4rity4se2t2eap3intai5ristmas6ome4urch5i0priani6rcle4sco3tadel4i0c2y3k1l0aims4eaning6ick2nic1que6othing5ud3ub0med6m1n1o0ach3des3ffee4llege4ogne5m0mbank4unity6pany2re3uter5sec4ndos3struction8ulting7tact3ractors9oking4l1p2rsica5untry4pon0s4rses6pa2r0edit0card4union9icket5own3s1uise0s6u0isinella9v1w1x1y0mru3ou3z2dad1nce3ta1e1ing3sun4y2clk3ds2e0al0er2s3gree4livery5l1oitte5ta3mocrat6ntal2ist5si0gn4v2hl2iamonds6et2gital5rect0ory7scount3ver5h2y2j1k1m1np2o0cs1tor4g1mains5t1wnload7rive4tv2ubai3nlop4pont4rban5vag2r2z2earth3t2c0o2deka3u0cation8e1g1mail3erck5nergy4gineer0ing9terprises10pson4quipment8r0icsson6ni3s0q1tate5t1u0rovision8s2vents5xchange6pert3osed4ress5traspace10fage2il1rwinds6th3mily4n0s2rm0ers5shion4t3edex3edback6rrari3ero6i0delity5o2lm2nal1nce1ial7re0stone6mdale6sh0ing5t0ness6j1k1lickr3ghts4r2orist4wers5y2m1o0o0d1tball6rd1ex2sale4um3undation8x2r0ee1senius7l1ogans4ntier7tr2ujitsu5n0d2rniture7tbol5yi3ga0l0lery3o1up4me0s3p1rden4y2b0iz3d0n2e0a1nt0ing5orge5f1g0ee3h1i0ft0s3ves2ing5l0ass3e1obal2o4m0ail3bh2o1x2n1odaddy5ld0point6f2o0dyear5g0le4p1t1v2p1q1r0ainger5phics5tis4een3ipe3ocery4up4s1t1u0cci3ge2ide2tars5ru3w1y2hair2mburg5ngout5us3bo2dfc0bank7ealth0care8lp1sinki6re1mes5iphop4samitsu7tachi5v2k0t2m1n1ockey4ldings5iday5medepot5goods5s0ense7nda3rse3spital5t0ing5t0els3mail5use3w2r1sbc3t1u0ghes5yatt3undai7ibm2cbc2e1u2d1e0ee3fm2kano4l1m0amat4db2mo0bilien9n0c1dustries8finiti5o2g1k1stitute6urance4e4t0ernational10uit4vestments10o1piranga7q1r0ish4s0maili5t0anbul7t0au2v3jaguar4va3cb2e0ep2tzt3welry6io2ll2m0p2nj2o0bs1urg4t1y2p0morgan6rs3uegos4niper7kaufen5ddi3e0rryhotels6properties14fh2g1h1i0a1ds2m1ndle4tchen5wi3m1n1oeln3matsu5sher5p0mg2n2r0d1ed3uokgroup8w1y0oto4z2la0caixa5mborghini8er3nd0rover6xess5salle5t0ino3robe5w0yer5b1c1ds2ease3clerc5frak4gal2o2xus4gbt3i0dl2fe0insurance9style7ghting6ke2lly3mited4o2ncoln4k2ve1ing5k1lc1p2oan0s3cker3us3l1ndon4tte1o3ve3pl0financial11r1s1t0d0a3u0ndbeck6xe1ury5v1y2ma0drid4if1son4keup4n0agement7go3p1rket0ing3s4riott5shalls7ttel5ba2c0kinsey7d1e0d0ia3et2lbourne7me1orial6n0u2rckmsd7g1h1iami3crosoft7l1ni1t2t0subishi9k1l0b1s2m0a2n1o0bi0le4da2e1i1m1nash3ey2ster5rmon3tgage6scow4to0rcycles9v0ie4p1q1r1s0d2t0n1r2u0seum3ic4v1w1x1y1z2na0b1goya4me2vy3ba2c1e0c1t0bank4flix4work5ustar5w0s2xt0direct7us4f0l2g0o2hk2i0co2ke1on3nja3ssan1y5l1o0kia3rton4w0ruz3tv4p1r0a1w2tt2u1yc2z2obi1server7ffice5kinawa6layan0group9lo3m0ega4ne1g1l0ine5oo2pen3racle3nge4g0anic5igins6saka4tsuka4t2vh3pa0ge2nasonic7ris2s1tners4s1y3y2ccw3e0t2f0izer5g1h0armacy6d1ilips5one2to0graphy6s4ysio5ics1tet2ures6d1n0g1k2oneer5zza4k1l0ace2y0station9umbing5s3m1n0c2ohl2ker3litie5rn2st3r0america6xi3ess3ime3o0d0uctions8f1gressive8mo2perties3y5tection8u0dential9s1t1ub2w0c2y2qa1pon3uebec3st5racing4dio4e0ad1lestate6tor2y4cipes5d0stone5umbrella9hab3ise0n3t2liance6n0t0als5pair3ort3ublican8st0aurant8view0s5xroth6ich0ardli6oh3l1o1p2o0cks3deo3gers4om3s0vp3u0gby3hr2n2w0e2yukyu6sa0arland6fe0ty4kura4le1on3msclub4ung5ndvik0coromant12ofi4p1rl2s1ve2xo3b0i1s2c0b1haeffler7midt4olarships8ol3ule3warz5ience5ot3d1e0arch3t2cure1ity6ek2lect4ner3rvices6ven3w1x0y3fr2g1h0angrila6rp3ell3ia1ksha5oes2p0ping5uji3w3i0lk2na1gles5te3j1k0i0n2y0pe4l0ing4m0art3ile4n0cf3o0ccer3ial4ftbank4ware6hu2lar2utions7ng1y2y2pa0ce3ort2t3r0l2s1t0ada2ples4r1tebank4farm7c0group6ockholm6rage3e3ream4udio2y3yle4u0cks3pplies3y2ort5rf1gery5zuki5v1watch4iss4x1y0dney4stems6z2tab1ipei4lk2obao4rget4tamotors6r2too4x0i3c0i2d0k2eam2ch0nology8l1masek5nnis4va3f1g1h0d1eater2re6iaa2ckets5enda4ps2res2ol4j0maxx4x2k0maxx5l1m0all4n1o0day3kyo3ols3p1ray3shiba5tal3urs3wn2yota3s3r0ade1ing4ining5vel0ers0insurance16ust3v2t1ube2i1nes3shu4v0s2w1z2ua1bank3s2g1k1nicom3versity8o2ol2ps2s1y1z2va0cations7na1guard7c1e0gas3ntures6risign5mögensberater2ung14sicherung10t2g1i0ajes4deo3g1king4llas4n1p1rgin4sa1ion4va1o3laanderen9n1odka3lvo3te1ing3o2yage5u2wales2mart4ter4ng0gou5tch0es6eather0channel12bcam3er2site5d0ding5ibo2r3f1hoswho6ien2ki2lliamhill9n0dows4e1ners6me2olterskluwer11odside6rk0s2ld3w2s1tc1f3xbox3erox4ihuan4n2xx2yz3yachts4hoo3maxun5ndex5e1odobashi7ga2kohama6u0tube6t1un3za0ppos4ra3ero3ip2m1one3uerich6w2",c2="ελ1υ2бг1ел3дети4ею2католик6ом3мкд2он1сква6онлайн5рг3рус2ф2сайт3рб3укр3қаз3հայ3ישראל5קום3ابوظبي5رامكو5لاردن4بحرين5جزائر5سعودية6عليان5مغرب5مارات5یران5بارت2زار4يتك3ھارت5تونس4سودان3رية5شبكة4عراق2ب2مان4فلسطين6قطر3كاثوليك6وم3مصر2ليسيا5وريتانيا7قع4همراه5پاکستان7ڀارت4कॉम3नेट3भारत0म्3ोत5संगठन5বাংলা5ভারত2ৰত4ਭਾਰਤ4ભારત4ଭାରତ4இந்தியா6லங்கை6சிங்கப்பூர்11భారత్5ಭಾರತ4ഭാരതം5ලංකා4คอม3ไทย3ລາວ3გე2みんな3アマゾン4クラウド4グーグル4コム2ストア3セール3ファッション6ポイント4世界2中信1国1國1文网3亚马逊3企业2佛山2信息2健康2八卦2公司1益2台湾1灣2商城1店1标2嘉里0大酒店5在线2大拿2天主教3娱乐2家電2广东2微博2慈善2我爱你3手机2招聘2政务1府2新加坡2闻2时尚2書籍2机构2淡马锡3游戏2澳門2点看2移动2组织机构4网址1店1站1络2联通2谷歌2购物2通販2集团2電訊盈科4飞利浦3食品2餐厅2香格里拉3港2닷넷1컴2삼성2한국2",Gs=(r,e)=>{for(const t in e)r[t]=e[t];return r},kl="numeric",Sl="ascii",El="alpha",yn="asciinumeric",un="alphanumeric",Al="domain",im="emoji",d2="scheme",u2="slashscheme",Ta="whitespace";function h2(r,e){return r in e||(e[r]=[]),e[r]}function ts(r,e,t){e[kl]&&(e[yn]=!0,e[un]=!0),e[Sl]&&(e[yn]=!0,e[El]=!0),e[yn]&&(e[un]=!0),e[El]&&(e[un]=!0),e[un]&&(e[Al]=!0),e[im]&&(e[Al]=!0);for(const s in e){const n=h2(s,t);n.indexOf(r)<0&&n.push(r)}}function f2(r,e){const t={};for(const s in e)e[s].indexOf(r)>=0&&(t[s]=!0);return t}function mt(r=null){this.j={},this.jr=[],this.jd=null,this.t=r}mt.groups={};mt.prototype={accepts(){return!!this.t},go(r){const e=this,t=e.j[r];if(t)return t;for(let s=0;s<e.jr.length;s++){const n=e.jr[s][0],i=e.jr[s][1];if(i&&n.test(r))return i}return e.jd},has(r,e=!1){return e?r in this.j:!!this.go(r)},ta(r,e,t,s){for(let n=0;n<r.length;n++)this.tt(r[n],e,t,s)},tr(r,e,t,s){s=s||mt.groups;let n;return e&&e.j?n=e:(n=new mt(e),t&&s&&ts(e,t,s)),this.jr.push([r,n]),n},ts(r,e,t,s){let n=this;const i=r.length;if(!i)return n;for(let a=0;a<i-1;a++)n=n.tt(r[a]);return n.tt(r[i-1],e,t,s)},tt(r,e,t,s){s=s||mt.groups;const n=this;if(e&&e.j)return n.j[r]=e,e;const i=e;let a,l=n.go(r);if(l?(a=new mt,Gs(a.j,l.j),a.jr.push.apply(a.jr,l.jr),a.jd=l.jd,a.t=l.t):a=new mt,i){if(s)if(a.t&&typeof a.t=="string"){const c=Gs(f2(a.t,s),t);ts(i,c,s)}else t&&ts(i,t,s);a.t=i}return n.j[r]=a,a}};const ue=(r,e,t,s,n)=>r.ta(e,t,s,n),Ie=(r,e,t,s,n)=>r.tr(e,t,s,n),ju=(r,e,t,s,n)=>r.ts(e,t,s,n),V=(r,e,t,s,n)=>r.tt(e,t,s,n),er="WORD",Cl="UWORD",om="ASCIINUMERICAL",am="ALPHANUMERICAL",Ln="LOCALHOST",Ml="TLD",Dl="UTLD",ki="SCHEME",Is="SLASH_SCHEME",Ec="NUM",Tl="WS",Ac="NL",bn="OPENBRACE",wn="CLOSEBRACE",Qi="OPENBRACKET",Zi="CLOSEBRACKET",eo="OPENPAREN",to="CLOSEPAREN",ro="OPENANGLEBRACKET",so="CLOSEANGLEBRACKET",no="FULLWIDTHLEFTPAREN",io="FULLWIDTHRIGHTPAREN",oo="LEFTCORNERBRACKET",ao="RIGHTCORNERBRACKET",lo="LEFTWHITECORNERBRACKET",co="RIGHTWHITECORNERBRACKET",uo="FULLWIDTHLESSTHAN",ho="FULLWIDTHGREATERTHAN",fo="AMPERSAND",po="APOSTROPHE",mo="ASTERISK",mr="AT",go="BACKSLASH",xo="BACKTICK",yo="CARET",yr="COLON",Cc="COMMA",bo="DOLLAR",_t="DOT",wo="EQUALS",Mc="EXCLAMATION",At="HYPHEN",vn="PERCENT",vo="PIPE",No="PLUS",jo="POUND",Nn="QUERY",Dc="QUOTE",lm="FULLWIDTHMIDDLEDOT",Tc="SEMI",Ft="SLASH",jn="TILDE",ko="UNDERSCORE",cm="EMOJI",So="SYM";var dm=Object.freeze({__proto__:null,ALPHANUMERICAL:am,AMPERSAND:fo,APOSTROPHE:po,ASCIINUMERICAL:om,ASTERISK:mo,AT:mr,BACKSLASH:go,BACKTICK:xo,CARET:yo,CLOSEANGLEBRACKET:so,CLOSEBRACE:wn,CLOSEBRACKET:Zi,CLOSEPAREN:to,COLON:yr,COMMA:Cc,DOLLAR:bo,DOT:_t,EMOJI:cm,EQUALS:wo,EXCLAMATION:Mc,FULLWIDTHGREATERTHAN:ho,FULLWIDTHLEFTPAREN:no,FULLWIDTHLESSTHAN:uo,FULLWIDTHMIDDLEDOT:lm,FULLWIDTHRIGHTPAREN:io,HYPHEN:At,LEFTCORNERBRACKET:oo,LEFTWHITECORNERBRACKET:lo,LOCALHOST:Ln,NL:Ac,NUM:Ec,OPENANGLEBRACKET:ro,OPENBRACE:bn,OPENBRACKET:Qi,OPENPAREN:eo,PERCENT:vn,PIPE:vo,PLUS:No,POUND:jo,QUERY:Nn,QUOTE:Dc,RIGHTCORNERBRACKET:ao,RIGHTWHITECORNERBRACKET:co,SCHEME:ki,SEMI:Tc,SLASH:Ft,SLASH_SCHEME:Is,SYM:So,TILDE:jn,TLD:Ml,UNDERSCORE:ko,UTLD:Dl,UWORD:Cl,WORD:er,WS:Tl});const Qt=/[a-z]/,an=new RegExp("\\p{L}","u"),Oa=new RegExp("\\p{Emoji}","u"),Zt=/\d/,Ra=/\s/,ku="\r",Ia=`
`,p2="️",m2="‍",Pa="￼";let li=null,ci=null;function g2(r=[]){const e={};mt.groups=e;const t=new mt;li==null&&(li=Su(l2)),ci==null&&(ci=Su(c2)),V(t,"'",po),V(t,"{",bn),V(t,"}",wn),V(t,"[",Qi),V(t,"]",Zi),V(t,"(",eo),V(t,")",to),V(t,"<",ro),V(t,">",so),V(t,"（",no),V(t,"）",io),V(t,"「",oo),V(t,"」",ao),V(t,"『",lo),V(t,"』",co),V(t,"＜",uo),V(t,"＞",ho),V(t,"&",fo),V(t,"*",mo),V(t,"@",mr),V(t,"`",xo),V(t,"^",yo),V(t,":",yr),V(t,",",Cc),V(t,"$",bo),V(t,".",_t),V(t,"=",wo),V(t,"!",Mc),V(t,"-",At),V(t,"%",vn),V(t,"|",vo),V(t,"+",No),V(t,"#",jo),V(t,"?",Nn),V(t,'"',Dc),V(t,"/",Ft),V(t,";",Tc),V(t,"~",jn),V(t,"_",ko),V(t,"\\",go),V(t,"・",lm);const s=Ie(t,Zt,Ec,{[kl]:!0});Ie(s,Zt,s);const n=Ie(s,Qt,om,{[yn]:!0}),i=Ie(s,an,am,{[un]:!0}),a=Ie(t,Qt,er,{[Sl]:!0});Ie(a,Zt,n),Ie(a,Qt,a),Ie(n,Zt,n),Ie(n,Qt,n);const l=Ie(t,an,Cl,{[El]:!0});Ie(l,Qt),Ie(l,Zt,i),Ie(l,an,l),Ie(i,Zt,i),Ie(i,Qt),Ie(i,an,i);const c=V(t,Ia,Ac,{[Ta]:!0}),d=V(t,ku,Tl,{[Ta]:!0}),u=Ie(t,Ra,Tl,{[Ta]:!0});V(t,Pa,u),V(d,Ia,c),V(d,Pa,u),Ie(d,Ra,u),V(u,ku),V(u,Ia),Ie(u,Ra,u),V(u,Pa,u);const h=Ie(t,Oa,cm,{[im]:!0});V(h,"#"),Ie(h,Oa,h),V(h,p2,h);const f=V(h,m2);V(f,"#"),Ie(f,Oa,h);const p=[[Qt,a],[Zt,n]],m=[[Qt,null],[an,l],[Zt,i]];for(let g=0;g<li.length;g++)dr(t,li[g],Ml,er,p);for(let g=0;g<ci.length;g++)dr(t,ci[g],Dl,Cl,m);ts(Ml,{tld:!0,ascii:!0},e),ts(Dl,{utld:!0,alpha:!0},e),dr(t,"file",ki,er,p),dr(t,"mailto",ki,er,p),dr(t,"http",Is,er,p),dr(t,"https",Is,er,p),dr(t,"ftp",Is,er,p),dr(t,"ftps",Is,er,p),ts(ki,{scheme:!0,ascii:!0},e),ts(Is,{slashscheme:!0,ascii:!0},e),r=r.sort((g,y)=>g[0]>y[0]?1:-1);for(let g=0;g<r.length;g++){const y=r[g][0],S=r[g][1]?{[d2]:!0}:{[u2]:!0};y.indexOf("-")>=0?S[Al]=!0:Qt.test(y)?Zt.test(y)?S[yn]=!0:S[Sl]=!0:S[kl]=!0,ju(t,y,y,S)}return ju(t,"localhost",Ln,{ascii:!0}),t.jd=new mt(So),{start:t,tokens:Gs({groups:e},dm)}}function um(r,e){const t=x2(e.replace(/[A-Z]/g,l=>l.toLowerCase())),s=t.length,n=[];let i=0,a=0;for(;a<s;){let l=r,c=null,d=0,u=null,h=-1,f=-1;for(;a<s&&(c=l.go(t[a]));)l=c,l.accepts()?(h=0,f=0,u=l):h>=0&&(h+=t[a].length,f++),d+=t[a].length,i+=t[a].length,a++;i-=h,a-=f,d-=h,n.push({t:u.t,v:e.slice(i-d,i),s:i-d,e:i})}return n}function x2(r){const e=[],t=r.length;let s=0;for(;s<t;){let n=r.charCodeAt(s),i,a=n<55296||n>56319||s+1===t||(i=r.charCodeAt(s+1))<56320||i>57343?r[s]:r.slice(s,s+2);e.push(a),s+=a.length}return e}function dr(r,e,t,s,n){let i;const a=e.length;for(let l=0;l<a-1;l++){const c=e[l];r.j[c]?i=r.j[c]:(i=new mt(s),i.jr=n.slice(),r.j[c]=i),r=i}return i=new mt(t),i.jr=n.slice(),r.j[e[a-1]]=i,i}function Su(r){const e=[],t=[];let s=0,n="0123456789";for(;s<r.length;){let i=0;for(;n.indexOf(r[s+i])>=0;)i++;if(i>0){e.push(t.join(""));for(let a=parseInt(r.substring(s,s+i),10);a>0;a--)t.pop();s+=i}else t.push(r[s]),s++}return e}const $n={defaultProtocol:"http",events:null,format:Eu,formatHref:Eu,nl2br:!1,tagName:"a",target:null,rel:null,validate:!0,truncate:1/0,className:null,attributes:null,ignoreTags:[],render:null};function Oc(r,e=null){let t=Gs({},$n);r&&(t=Gs(t,r instanceof Oc?r.o:r));const s=t.ignoreTags,n=[];for(let i=0;i<s.length;i++)n.push(s[i].toUpperCase());this.o=t,e&&(this.defaultRender=e),this.ignoreTags=n}Oc.prototype={o:$n,ignoreTags:[],defaultRender(r){return r},check(r){return this.get("validate",r.toString(),r)},get(r,e,t){const s=e!=null;let n=this.o[r];return n&&(typeof n=="object"?(n=t.t in n?n[t.t]:$n[r],typeof n=="function"&&s&&(n=n(e,t))):typeof n=="function"&&s&&(n=n(e,t.t,t)),n)},getObj(r,e,t){let s=this.o[r];return typeof s=="function"&&e!=null&&(s=s(e,t.t,t)),s},render(r){const e=r.render(this);return(this.get("render",null,r)||this.defaultRender)(e,r.t,r)}};function Eu(r){return r}function hm(r,e){this.t="token",this.v=r,this.tk=e}hm.prototype={isLink:!1,toString(){return this.v},toHref(r){return this.toString()},toFormattedString(r){const e=this.toString(),t=r.get("truncate",e,this),s=r.get("format",e,this);return t&&s.length>t?s.substring(0,t)+"…":s},toFormattedHref(r){return r.get("formatHref",this.toHref(r.get("defaultProtocol")),this)},startIndex(){return this.tk[0].s},endIndex(){return this.tk[this.tk.length-1].e},toObject(r=$n.defaultProtocol){return{type:this.t,value:this.toString(),isLink:this.isLink,href:this.toHref(r),start:this.startIndex(),end:this.endIndex()}},toFormattedObject(r){return{type:this.t,value:this.toFormattedString(r),isLink:this.isLink,href:this.toFormattedHref(r),start:this.startIndex(),end:this.endIndex()}},validate(r){return r.get("validate",this.toString(),this)},render(r){const e=this,t=this.toHref(r.get("defaultProtocol")),s=r.get("formatHref",t,this),n=r.get("tagName",t,e),i=this.toFormattedString(r),a={},l=r.get("className",t,e),c=r.get("target",t,e),d=r.get("rel",t,e),u=r.getObj("attributes",t,e),h=r.getObj("events",t,e);return a.href=s,l&&(a.class=l),c&&(a.target=c),d&&(a.rel=d),u&&Gs(a,u),{tagName:n,attributes:a,content:i,eventListeners:h}}};function Zo(r,e){class t extends hm{constructor(n,i){super(n,i),this.t=r}}for(const s in e)t.prototype[s]=e[s];return t.t=r,t}const Au=Zo("email",{isLink:!0,toHref(){return"mailto:"+this.toString()}}),Cu=Zo("text"),y2=Zo("nl"),di=Zo("url",{isLink:!0,toHref(r=$n.defaultProtocol){return this.hasProtocol()?this.v:`${r}://${this.v}`},hasProtocol(){const r=this.tk;return r.length>=2&&r[0].t!==Ln&&r[1].t===yr}}),Et=r=>new mt(r);function b2({groups:r}){const e=r.domain.concat([fo,mo,mr,go,xo,yo,bo,wo,At,Ec,vn,vo,No,jo,Ft,So,jn,ko]),t=[po,yr,Cc,_t,Mc,vn,Nn,Dc,Tc,ro,so,bn,wn,Zi,Qi,eo,to,no,io,oo,ao,lo,co,uo,ho],s=[fo,po,mo,go,xo,yo,bo,wo,At,bn,wn,vn,vo,No,jo,Nn,Ft,So,jn,ko],n=Et(),i=V(n,jn);ue(i,s,i),ue(i,r.domain,i);const a=Et(),l=Et(),c=Et();ue(n,r.domain,a),ue(n,r.scheme,l),ue(n,r.slashscheme,c),ue(a,s,i),ue(a,r.domain,a);const d=V(a,mr);V(i,mr,d),V(l,mr,d),V(c,mr,d);const u=V(i,_t);ue(u,s,i),ue(u,r.domain,i);const h=Et();ue(d,r.domain,h),ue(h,r.domain,h);const f=V(h,_t);ue(f,r.domain,h);const p=Et(Au);ue(f,r.tld,p),ue(f,r.utld,p),V(d,Ln,p);const m=V(h,At);V(m,At,m),ue(m,r.domain,h),ue(p,r.domain,h),V(p,_t,f),V(p,At,m);const g=V(p,yr);ue(g,r.numeric,Au);const y=V(a,At),x=V(a,_t);V(y,At,y),ue(y,r.domain,a),ue(x,s,i),ue(x,r.domain,a);const S=Et(di);ue(x,r.tld,S),ue(x,r.utld,S),ue(S,r.domain,a),ue(S,s,i),V(S,_t,x),V(S,At,y),V(S,mr,d);const C=V(S,yr),k=Et(di);ue(C,r.numeric,k);const j=Et(di),O=Et();ue(j,e,j),ue(j,t,O),ue(O,e,j),ue(O,t,O),V(S,Ft,j),V(k,Ft,j);const N=V(l,yr),w=V(c,yr),v=V(w,Ft),M=V(v,Ft);ue(l,r.domain,a),V(l,_t,x),V(l,At,y),ue(c,r.domain,a),V(c,_t,x),V(c,At,y),ue(N,r.domain,j),V(N,Ft,j),V(N,Nn,j),ue(M,r.domain,j),ue(M,e,j),V(M,Ft,j);const E=[[bn,wn],[Qi,Zi],[eo,to],[ro,so],[no,io],[oo,ao],[lo,co],[uo,ho]];for(let L=0;L<E.length;L++){const[I,W]=E[L],H=V(j,I);V(O,I,H),V(H,W,j);const R=Et(di);ue(H,e,R);const A=Et();ue(H,t),ue(R,e,R),ue(R,t,A),ue(A,e,R),ue(A,t,A),V(R,W,j),V(A,W,j)}return V(n,Ln,S),V(n,Ac,y2),{start:n,tokens:dm}}function w2(r,e,t){let s=t.length,n=0,i=[],a=[];for(;n<s;){let l=r,c=null,d=null,u=0,h=null,f=-1;for(;n<s&&!(c=l.go(t[n].t));)a.push(t[n++]);for(;n<s&&(d=c||l.go(t[n].t));)c=null,l=d,l.accepts()?(f=0,h=l):f>=0&&f++,n++,u++;if(f<0)n-=u,n<s&&(a.push(t[n]),n++);else{a.length>0&&(i.push(La(Cu,e,a)),a=[]),n-=f,u-=f;const p=h.t,m=t.slice(n-u,n);i.push(La(p,e,m))}}return a.length>0&&i.push(La(Cu,e,a)),i}function La(r,e,t){const s=t[0].s,n=t[t.length-1].e,i=e.slice(s,n);return new r(i,t)}const v2=typeof console<"u"&&console&&console.warn||(()=>{}),N2="until manual call of linkify.init(). Register all schemes and plugins before invoking linkify the first time.",De={scanner:null,parser:null,tokenQueue:[],pluginQueue:[],customSchemes:[],initialized:!1};function j2(){return mt.groups={},De.scanner=null,De.parser=null,De.tokenQueue=[],De.pluginQueue=[],De.customSchemes=[],De.initialized=!1,De}function Mu(r,e=!1){if(De.initialized&&v2(`linkifyjs: already initialized - will not register custom scheme "${r}" ${N2}`),!/^[0-9a-z]+(-[0-9a-z]+)*$/.test(r))throw new Error(`linkifyjs: incorrect scheme format.
1. Must only contain digits, lowercase ASCII letters or "-"
2. Cannot start or end with "-"
3. "-" cannot repeat`);De.customSchemes.push([r,e])}function k2(){De.scanner=g2(De.customSchemes);for(let r=0;r<De.tokenQueue.length;r++)De.tokenQueue[r][1]({scanner:De.scanner});De.parser=b2(De.scanner.tokens);for(let r=0;r<De.pluginQueue.length;r++)De.pluginQueue[r][1]({scanner:De.scanner,parser:De.parser});return De.initialized=!0,De}function Rc(r){return De.initialized||k2(),w2(De.parser.start,r,um(De.scanner.start,r))}Rc.scan=um;function fm(r,e=null,t=null){if(e&&typeof e=="object"){if(t)throw Error(`linkifyjs: Invalid link type ${e}; must be a string`);t=e,e=null}const s=new Oc(t),n=Rc(r),i=[];for(let a=0;a<n.length;a++){const l=n[a];l.isLink&&(!e||l.t===e)&&s.check(l)&&i.push(l.toFormattedObject(s))}return i}function S2(r){return r.length===1?r[0].isLink:r.length===3&&r[1].isLink?["()","[]"].includes(r[0].value+r[2].value):!1}function E2(r){return new Je({key:new yt("autolink"),appendTransaction:(e,t,s)=>{const n=e.some(d=>d.docChanged)&&!t.doc.eq(s.doc),i=e.some(d=>d.getMeta("preventAutolink"));if(!n||i)return;const{tr:a}=s,l=GN(t.doc,[...e]);if(rj(l).forEach(({newRange:d})=>{const u=JN(s.doc,d,p=>p.isTextblock);let h,f;if(u.length>1?(h=u[0],f=s.doc.textBetween(h.pos,h.pos+h.node.nodeSize,void 0," ")):u.length&&s.doc.textBetween(d.from,d.to," "," ").endsWith(" ")&&(h=u[0],f=s.doc.textBetween(h.pos,d.to,void 0," ")),h&&f){const p=f.split(" ").filter(x=>x!=="");if(p.length<=0)return!1;const m=p[p.length-1],g=h.pos+f.lastIndexOf(m);if(!m)return!1;const y=Rc(m).map(x=>x.toObject(r.defaultProtocol));if(!S2(y))return!1;y.filter(x=>x.isLink).map(x=>({...x,from:g+x.start+1,to:g+x.end+1})).filter(x=>s.schema.marks.code?!s.doc.rangeHasMark(x.from,x.to,s.schema.marks.code):!0).filter(x=>r.validate(x.value)).filter(x=>r.shouldAutoLink(x.value)).forEach(x=>{vc(x.from,x.to,s.doc).some(S=>S.mark.type===r.type)||a.addMark(x.from,x.to,r.type.create({href:x.href}))})}}),!!a.steps.length)return a}})}function A2(r){return new Je({key:new yt("handleClickLink"),props:{handleClick:(e,t,s)=>{var n,i;if(s.button!==0||!e.editable)return!1;let a=s.target;const l=[];for(;a.nodeName!=="DIV";)l.push(a),a=a.parentNode;if(!l.find(f=>f.nodeName==="A"))return!1;const c=Gp(e.state,r.type.name),d=s.target,u=(n=d==null?void 0:d.href)!==null&&n!==void 0?n:c.href,h=(i=d==null?void 0:d.target)!==null&&i!==void 0?i:c.target;return d&&u?(window.open(u,h),!0):!1}}})}function C2(r){return new Je({key:new yt("handlePasteLink"),props:{handlePaste:(e,t,s)=>{const{state:n}=e,{selection:i}=n,{empty:a}=i;if(a)return!1;let l="";s.content.forEach(d=>{l+=d.textContent});const c=fm(l,{defaultProtocol:r.defaultProtocol}).find(d=>d.isLink&&d.value===l);return!l||!c?!1:r.editor.commands.setMark(r.type,{href:c.href})}}})}const M2=/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g;function Ur(r,e){const t=["http","https","ftp","ftps","mailto","tel","callto","sms","cid","xmpp"];return e&&e.forEach(s=>{const n=typeof s=="string"?s:s.scheme;n&&t.push(n)}),!r||r.replace(M2,"").match(new RegExp(`^(?:(?:${t.join("|")}):|[^a-z]|[a-z0-9+.-]+(?:[^a-z+.-:]|$))`,"i"))}const D2=Kt.create({name:"link",priority:1e3,keepOnSplit:!1,exitable:!0,onCreate(){this.options.validate&&!this.options.shouldAutoLink&&(this.options.shouldAutoLink=this.options.validate,console.warn("The `validate` option is deprecated. Rename to the `shouldAutoLink` option instead.")),this.options.protocols.forEach(r=>{if(typeof r=="string"){Mu(r);return}Mu(r.scheme,r.optionalSlashes)})},onDestroy(){j2()},inclusive(){return this.options.autolink},addOptions(){return{openOnClick:!0,linkOnPaste:!0,autolink:!0,protocols:[],defaultProtocol:"http",HTMLAttributes:{target:"_blank",rel:"noopener noreferrer nofollow",class:null},isAllowedUri:(r,e)=>!!Ur(r,e.protocols),validate:r=>!!r,shouldAutoLink:r=>!!r}},addAttributes(){return{href:{default:null,parseHTML(r){return r.getAttribute("href")}},target:{default:this.options.HTMLAttributes.target},rel:{default:this.options.HTMLAttributes.rel},class:{default:this.options.HTMLAttributes.class}}},parseHTML(){return[{tag:"a[href]",getAttrs:r=>{const e=r.getAttribute("href");return!e||!this.options.isAllowedUri(e,{defaultValidate:t=>!!Ur(t,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?!1:null}}]},renderHTML({HTMLAttributes:r}){return this.options.isAllowedUri(r.href,{defaultValidate:e=>!!Ur(e,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?["a",We(this.options.HTMLAttributes,r),0]:["a",We(this.options.HTMLAttributes,{...r,href:""}),0]},addCommands(){return{setLink:r=>({chain:e})=>{const{href:t}=r;return this.options.isAllowedUri(t,{defaultValidate:s=>!!Ur(s,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?e().setMark(this.name,r).setMeta("preventAutolink",!0).run():!1},toggleLink:r=>({chain:e})=>{const{href:t}=r;return this.options.isAllowedUri(t,{defaultValidate:s=>!!Ur(s,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?e().toggleMark(this.name,r,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run():!1},unsetLink:()=>({chain:r})=>r().unsetMark(this.name,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()}},addPasteRules(){return[ys({find:r=>{const e=[];if(r){const{protocols:t,defaultProtocol:s}=this.options,n=fm(r).filter(i=>i.isLink&&this.options.isAllowedUri(i.value,{defaultValidate:a=>!!Ur(a,t),protocols:t,defaultProtocol:s}));n.length&&n.forEach(i=>e.push({text:i.value,data:{href:i.href},index:i.start}))}return e},type:this.type,getAttributes:r=>{var e;return{href:(e=r.data)===null||e===void 0?void 0:e.href}}})]},addProseMirrorPlugins(){const r=[],{protocols:e,defaultProtocol:t}=this.options;return this.options.autolink&&r.push(E2({type:this.type,defaultProtocol:this.options.defaultProtocol,validate:s=>this.options.isAllowedUri(s,{defaultValidate:n=>!!Ur(n,e),protocols:e,defaultProtocol:t}),shouldAutoLink:this.options.shouldAutoLink})),this.options.openOnClick===!0&&r.push(A2({type:this.type})),this.options.linkOnPaste&&r.push(C2({editor:this.editor,defaultProtocol:this.options.defaultProtocol,type:this.type})),r}});function T2(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function pm(r){return r instanceof Map?r.clear=r.delete=r.set=function(){throw new Error("map is read-only")}:r instanceof Set&&(r.add=r.clear=r.delete=function(){throw new Error("set is read-only")}),Object.freeze(r),Object.getOwnPropertyNames(r).forEach(e=>{const t=r[e],s=typeof t;(s==="object"||s==="function")&&!Object.isFrozen(t)&&pm(t)}),r}let Du=class{constructor(e){e.data===void 0&&(e.data={}),this.data=e.data,this.isMatchIgnored=!1}ignoreMatch(){this.isMatchIgnored=!0}};function mm(r){return r.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;")}function jr(r,...e){const t=Object.create(null);for(const s in r)t[s]=r[s];return e.forEach(function(s){for(const n in s)t[n]=s[n]}),t}const O2="</span>",Tu=r=>!!r.scope,R2=(r,{prefix:e})=>{if(r.startsWith("language:"))return r.replace("language:","language-");if(r.includes(".")){const t=r.split(".");return[`${e}${t.shift()}`,...t.map((s,n)=>`${s}${"_".repeat(n+1)}`)].join(" ")}return`${e}${r}`};let I2=class{constructor(e,t){this.buffer="",this.classPrefix=t.classPrefix,e.walk(this)}addText(e){this.buffer+=mm(e)}openNode(e){if(!Tu(e))return;const t=R2(e.scope,{prefix:this.classPrefix});this.span(t)}closeNode(e){Tu(e)&&(this.buffer+=O2)}value(){return this.buffer}span(e){this.buffer+=`<span class="${e}">`}};const Ou=(r={})=>{const e={children:[]};return Object.assign(e,r),e};let P2=class gm{constructor(){this.rootNode=Ou(),this.stack=[this.rootNode]}get top(){return this.stack[this.stack.length-1]}get root(){return this.rootNode}add(e){this.top.children.push(e)}openNode(e){const t=Ou({scope:e});this.add(t),this.stack.push(t)}closeNode(){if(this.stack.length>1)return this.stack.pop()}closeAllNodes(){for(;this.closeNode(););}toJSON(){return JSON.stringify(this.rootNode,null,4)}walk(e){return this.constructor._walk(e,this.rootNode)}static _walk(e,t){return typeof t=="string"?e.addText(t):t.children&&(e.openNode(t),t.children.forEach(s=>this._walk(e,s)),e.closeNode(t)),e}static _collapse(e){typeof e!="string"&&e.children&&(e.children.every(t=>typeof t=="string")?e.children=[e.children.join("")]:e.children.forEach(t=>{gm._collapse(t)}))}},L2=class extends P2{constructor(e){super(),this.options=e}addText(e){e!==""&&this.add(e)}startScope(e){this.openNode(e)}endScope(){this.closeNode()}__addSublanguage(e,t){const s=e.root;t&&(s.scope=`language:${t}`),this.add(s)}toHTML(){return new I2(this,this.options).value()}finalize(){return this.closeAllNodes(),!0}};function _n(r){return r?typeof r=="string"?r:r.source:null}function xm(r){return ks("(?=",r,")")}function $2(r){return ks("(?:",r,")*")}function _2(r){return ks("(?:",r,")?")}function ks(...r){return r.map(t=>_n(t)).join("")}function F2(r){const e=r[r.length-1];return typeof e=="object"&&e.constructor===Object?(r.splice(r.length-1,1),e):{}}function Ic(...r){return"("+(F2(r).capture?"":"?:")+r.map(s=>_n(s)).join("|")+")"}function ym(r){return new RegExp(r.toString()+"|").exec("").length-1}function B2(r,e){const t=r&&r.exec(e);return t&&t.index===0}const U2=/\[(?:[^\\\]]|\\.)*\]|\(\??|\\([1-9][0-9]*)|\\./;function Pc(r,{joinWith:e}){let t=0;return r.map(s=>{t+=1;const n=t;let i=_n(s),a="";for(;i.length>0;){const l=U2.exec(i);if(!l){a+=i;break}a+=i.substring(0,l.index),i=i.substring(l.index+l[0].length),l[0][0]==="\\"&&l[1]?a+="\\"+String(Number(l[1])+n):(a+=l[0],l[0]==="("&&t++)}return a}).map(s=>`(${s})`).join(e)}const z2=/\b\B/,bm="[a-zA-Z]\\w*",Lc="[a-zA-Z_]\\w*",wm="\\b\\d+(\\.\\d+)?",vm="(-?)(\\b0[xX][a-fA-F0-9]+|(\\b\\d+(\\.\\d*)?|\\.\\d+)([eE][-+]?\\d+)?)",Nm="\\b(0b[01]+)",W2="!|!=|!==|%|%=|&|&&|&=|\\*|\\*=|\\+|\\+=|,|-|-=|/=|/|:|;|<<|<<=|<=|<|===|==|=|>>>=|>>=|>=|>>>|>>|>|\\?|\\[|\\{|\\(|\\^|\\^=|\\||\\|=|\\|\\||~",H2=(r={})=>{const e=/^#![ ]*\//;return r.binary&&(r.begin=ks(e,/.*\b/,r.binary,/\b.*/)),jr({scope:"meta",begin:e,end:/$/,relevance:0,"on:begin":(t,s)=>{t.index!==0&&s.ignoreMatch()}},r)},Fn={begin:"\\\\[\\s\\S]",relevance:0},V2={scope:"string",begin:"'",end:"'",illegal:"\\n",contains:[Fn]},q2={scope:"string",begin:'"',end:'"',illegal:"\\n",contains:[Fn]},K2={begin:/\b(a|an|the|are|I'm|isn't|don't|doesn't|won't|but|just|should|pretty|simply|enough|gonna|going|wtf|so|such|will|you|your|they|like|more)\b/},ea=function(r,e,t={}){const s=jr({scope:"comment",begin:r,end:e,contains:[]},t);s.contains.push({scope:"doctag",begin:"[ ]*(?=(TODO|FIXME|NOTE|BUG|OPTIMIZE|HACK|XXX):)",end:/(TODO|FIXME|NOTE|BUG|OPTIMIZE|HACK|XXX):/,excludeBegin:!0,relevance:0});const n=Ic("I","a","is","so","us","to","at","if","in","it","on",/[A-Za-z]+['](d|ve|re|ll|t|s|n)/,/[A-Za-z]+[-][a-z]+/,/[A-Za-z][a-z]{2,}/);return s.contains.push({begin:ks(/[ ]+/,"(",n,/[.]?[:]?([.][ ]|[ ])/,"){3}")}),s},G2=ea("//","$"),Y2=ea("/\\*","\\*/"),J2=ea("#","$"),X2={scope:"number",begin:wm,relevance:0},Q2={scope:"number",begin:vm,relevance:0},Z2={scope:"number",begin:Nm,relevance:0},eS={scope:"regexp",begin:/\/(?=[^/\n]*\/)/,end:/\/[gimuy]*/,contains:[Fn,{begin:/\[/,end:/\]/,relevance:0,contains:[Fn]}]},tS={scope:"title",begin:bm,relevance:0},rS={scope:"title",begin:Lc,relevance:0},sS={begin:"\\.\\s*"+Lc,relevance:0},nS=function(r){return Object.assign(r,{"on:begin":(e,t)=>{t.data._beginMatch=e[1]},"on:end":(e,t)=>{t.data._beginMatch!==e[1]&&t.ignoreMatch()}})};var ui=Object.freeze({__proto__:null,APOS_STRING_MODE:V2,BACKSLASH_ESCAPE:Fn,BINARY_NUMBER_MODE:Z2,BINARY_NUMBER_RE:Nm,COMMENT:ea,C_BLOCK_COMMENT_MODE:Y2,C_LINE_COMMENT_MODE:G2,C_NUMBER_MODE:Q2,C_NUMBER_RE:vm,END_SAME_AS_BEGIN:nS,HASH_COMMENT_MODE:J2,IDENT_RE:bm,MATCH_NOTHING_RE:z2,METHOD_GUARD:sS,NUMBER_MODE:X2,NUMBER_RE:wm,PHRASAL_WORDS_MODE:K2,QUOTE_STRING_MODE:q2,REGEXP_MODE:eS,RE_STARTERS_RE:W2,SHEBANG:H2,TITLE_MODE:tS,UNDERSCORE_IDENT_RE:Lc,UNDERSCORE_TITLE_MODE:rS});function iS(r,e){r.input[r.index-1]==="."&&e.ignoreMatch()}function oS(r,e){r.className!==void 0&&(r.scope=r.className,delete r.className)}function aS(r,e){e&&r.beginKeywords&&(r.begin="\\b("+r.beginKeywords.split(" ").join("|")+")(?!\\.)(?=\\b|\\s)",r.__beforeBegin=iS,r.keywords=r.keywords||r.beginKeywords,delete r.beginKeywords,r.relevance===void 0&&(r.relevance=0))}function lS(r,e){Array.isArray(r.illegal)&&(r.illegal=Ic(...r.illegal))}function cS(r,e){if(r.match){if(r.begin||r.end)throw new Error("begin & end are not supported with match");r.begin=r.match,delete r.match}}function dS(r,e){r.relevance===void 0&&(r.relevance=1)}const uS=(r,e)=>{if(!r.beforeMatch)return;if(r.starts)throw new Error("beforeMatch cannot be used with starts");const t=Object.assign({},r);Object.keys(r).forEach(s=>{delete r[s]}),r.keywords=t.keywords,r.begin=ks(t.beforeMatch,xm(t.begin)),r.starts={relevance:0,contains:[Object.assign(t,{endsParent:!0})]},r.relevance=0,delete t.beforeMatch},hS=["of","and","for","in","not","or","if","then","parent","list","value"],fS="keyword";function jm(r,e,t=fS){const s=Object.create(null);return typeof r=="string"?n(t,r.split(" ")):Array.isArray(r)?n(t,r):Object.keys(r).forEach(function(i){Object.assign(s,jm(r[i],e,i))}),s;function n(i,a){e&&(a=a.map(l=>l.toLowerCase())),a.forEach(function(l){const c=l.split("|");s[c[0]]=[i,pS(c[0],c[1])]})}}function pS(r,e){return e?Number(e):mS(r)?0:1}function mS(r){return hS.includes(r.toLowerCase())}const Ru={},cs=r=>{console.error(r)},Iu=(r,...e)=>{console.log(`WARN: ${r}`,...e)},Ds=(r,e)=>{Ru[`${r}/${e}`]||(console.log(`Deprecated as of ${r}. ${e}`),Ru[`${r}/${e}`]=!0)},Eo=new Error;function km(r,e,{key:t}){let s=0;const n=r[t],i={},a={};for(let l=1;l<=e.length;l++)a[l+s]=n[l],i[l+s]=!0,s+=ym(e[l-1]);r[t]=a,r[t]._emit=i,r[t]._multi=!0}function gS(r){if(Array.isArray(r.begin)){if(r.skip||r.excludeBegin||r.returnBegin)throw cs("skip, excludeBegin, returnBegin not compatible with beginScope: {}"),Eo;if(typeof r.beginScope!="object"||r.beginScope===null)throw cs("beginScope must be object"),Eo;km(r,r.begin,{key:"beginScope"}),r.begin=Pc(r.begin,{joinWith:""})}}function xS(r){if(Array.isArray(r.end)){if(r.skip||r.excludeEnd||r.returnEnd)throw cs("skip, excludeEnd, returnEnd not compatible with endScope: {}"),Eo;if(typeof r.endScope!="object"||r.endScope===null)throw cs("endScope must be object"),Eo;km(r,r.end,{key:"endScope"}),r.end=Pc(r.end,{joinWith:""})}}function yS(r){r.scope&&typeof r.scope=="object"&&r.scope!==null&&(r.beginScope=r.scope,delete r.scope)}function bS(r){yS(r),typeof r.beginScope=="string"&&(r.beginScope={_wrap:r.beginScope}),typeof r.endScope=="string"&&(r.endScope={_wrap:r.endScope}),gS(r),xS(r)}function wS(r){function e(a,l){return new RegExp(_n(a),"m"+(r.case_insensitive?"i":"")+(r.unicodeRegex?"u":"")+(l?"g":""))}class t{constructor(){this.matchIndexes={},this.regexes=[],this.matchAt=1,this.position=0}addRule(l,c){c.position=this.position++,this.matchIndexes[this.matchAt]=c,this.regexes.push([c,l]),this.matchAt+=ym(l)+1}compile(){this.regexes.length===0&&(this.exec=()=>null);const l=this.regexes.map(c=>c[1]);this.matcherRe=e(Pc(l,{joinWith:"|"}),!0),this.lastIndex=0}exec(l){this.matcherRe.lastIndex=this.lastIndex;const c=this.matcherRe.exec(l);if(!c)return null;const d=c.findIndex((h,f)=>f>0&&h!==void 0),u=this.matchIndexes[d];return c.splice(0,d),Object.assign(c,u)}}class s{constructor(){this.rules=[],this.multiRegexes=[],this.count=0,this.lastIndex=0,this.regexIndex=0}getMatcher(l){if(this.multiRegexes[l])return this.multiRegexes[l];const c=new t;return this.rules.slice(l).forEach(([d,u])=>c.addRule(d,u)),c.compile(),this.multiRegexes[l]=c,c}resumingScanAtSamePosition(){return this.regexIndex!==0}considerAll(){this.regexIndex=0}addRule(l,c){this.rules.push([l,c]),c.type==="begin"&&this.count++}exec(l){const c=this.getMatcher(this.regexIndex);c.lastIndex=this.lastIndex;let d=c.exec(l);if(this.resumingScanAtSamePosition()&&!(d&&d.index===this.lastIndex)){const u=this.getMatcher(0);u.lastIndex=this.lastIndex+1,d=u.exec(l)}return d&&(this.regexIndex+=d.position+1,this.regexIndex===this.count&&this.considerAll()),d}}function n(a){const l=new s;return a.contains.forEach(c=>l.addRule(c.begin,{rule:c,type:"begin"})),a.terminatorEnd&&l.addRule(a.terminatorEnd,{type:"end"}),a.illegal&&l.addRule(a.illegal,{type:"illegal"}),l}function i(a,l){const c=a;if(a.isCompiled)return c;[oS,cS,bS,uS].forEach(u=>u(a,l)),r.compilerExtensions.forEach(u=>u(a,l)),a.__beforeBegin=null,[aS,lS,dS].forEach(u=>u(a,l)),a.isCompiled=!0;let d=null;return typeof a.keywords=="object"&&a.keywords.$pattern&&(a.keywords=Object.assign({},a.keywords),d=a.keywords.$pattern,delete a.keywords.$pattern),d=d||/\w+/,a.keywords&&(a.keywords=jm(a.keywords,r.case_insensitive)),c.keywordPatternRe=e(d,!0),l&&(a.begin||(a.begin=/\B|\b/),c.beginRe=e(c.begin),!a.end&&!a.endsWithParent&&(a.end=/\B|\b/),a.end&&(c.endRe=e(c.end)),c.terminatorEnd=_n(c.end)||"",a.endsWithParent&&l.terminatorEnd&&(c.terminatorEnd+=(a.end?"|":"")+l.terminatorEnd)),a.illegal&&(c.illegalRe=e(a.illegal)),a.contains||(a.contains=[]),a.contains=[].concat(...a.contains.map(function(u){return vS(u==="self"?a:u)})),a.contains.forEach(function(u){i(u,c)}),a.starts&&i(a.starts,l),c.matcher=n(c),c}if(r.compilerExtensions||(r.compilerExtensions=[]),r.contains&&r.contains.includes("self"))throw new Error("ERR: contains `self` is not supported at the top-level of a language.  See documentation.");return r.classNameAliases=jr(r.classNameAliases||{}),i(r)}function Sm(r){return r?r.endsWithParent||Sm(r.starts):!1}function vS(r){return r.variants&&!r.cachedVariants&&(r.cachedVariants=r.variants.map(function(e){return jr(r,{variants:null},e)})),r.cachedVariants?r.cachedVariants:Sm(r)?jr(r,{starts:r.starts?jr(r.starts):null}):Object.isFrozen(r)?jr(r):r}var NS="11.10.0";let jS=class extends Error{constructor(e,t){super(e),this.name="HTMLInjectionError",this.html=t}};const $a=mm,Pu=jr,Lu=Symbol("nomatch"),kS=7,Em=function(r){const e=Object.create(null),t=Object.create(null),s=[];let n=!0;const i="Could not find the language '{}', did you forget to load/include a language module?",a={disableAutodetect:!0,name:"Plain text",contains:[]};let l={ignoreUnescapedHTML:!1,throwUnescapedHTML:!1,noHighlightRe:/^(no-?highlight)$/i,languageDetectRe:/\blang(?:uage)?-([\w-]+)\b/i,classPrefix:"hljs-",cssSelector:"pre code",languages:null,__emitter:L2};function c(A){return l.noHighlightRe.test(A)}function d(A){let F=A.className+" ";F+=A.parentNode?A.parentNode.className:"";const U=l.languageDetectRe.exec(F);if(U){const P=v(U[1]);return P||(Iu(i.replace("{}",U[1])),Iu("Falling back to no-highlight mode for this block.",A)),P?U[1]:"no-highlight"}return F.split(/\s+/).find(P=>c(P)||v(P))}function u(A,F,U){let P="",_="";typeof F=="object"?(P=A,U=F.ignoreIllegals,_=F.language):(Ds("10.7.0","highlight(lang, code, ...args) has been deprecated."),Ds("10.7.0",`Please use highlight(code, options) instead.
https://github.com/highlightjs/highlight.js/issues/2277`),_=A,P=F),U===void 0&&(U=!0);const Y={code:P,language:_};H("before:highlight",Y);const Z=Y.result?Y.result:h(Y.language,Y.code,U);return Z.code=Y.code,H("after:highlight",Z),Z}function h(A,F,U,P){const _=Object.create(null);function Y(D,B){return D.keywords[B]}function Z(){if(!ie.keywords){oe.addText(we);return}let D=0;ie.keywordPatternRe.lastIndex=0;let B=ie.keywordPatternRe.exec(we),q="";for(;B;){q+=we.substring(D,B.index);const re=ft.case_insensitive?B[0].toLowerCase():B[0],ye=Y(ie,re);if(ye){const[je,Yt]=ye;if(oe.addText(q),q="",_[re]=(_[re]||0)+1,_[re]<=kS&&(at+=Yt),je.startsWith("_"))q+=B[0];else{const Hm=ft.classNameAliases[je]||je;be(B[0],Hm)}}else q+=B[0];D=ie.keywordPatternRe.lastIndex,B=ie.keywordPatternRe.exec(we)}q+=we.substring(D),oe.addText(q)}function J(){if(we==="")return;let D=null;if(typeof ie.subLanguage=="string"){if(!e[ie.subLanguage]){oe.addText(we);return}D=h(ie.subLanguage,we,!0,Re[ie.subLanguage]),Re[ie.subLanguage]=D._top}else D=p(we,ie.subLanguage.length?ie.subLanguage:null);ie.relevance>0&&(at+=D.relevance),oe.__addSublanguage(D._emitter,D.language)}function te(){ie.subLanguage!=null?J():Z(),we=""}function be(D,B){D!==""&&(oe.startScope(B),oe.addText(D),oe.endScope())}function ht(D,B){let q=1;const re=B.length-1;for(;q<=re;){if(!D._emit[q]){q++;continue}const ye=ft.classNameAliases[D[q]]||D[q],je=B[q];ye?be(je,ye):(we=je,Z(),we=""),q++}}function _r(D,B){return D.scope&&typeof D.scope=="string"&&oe.openNode(ft.classNameAliases[D.scope]||D.scope),D.beginScope&&(D.beginScope._wrap?(be(we,ft.classNameAliases[D.beginScope._wrap]||D.beginScope._wrap),we=""):D.beginScope._multi&&(ht(D.beginScope,B),we="")),ie=Object.create(D,{parent:{value:ie}}),ie}function Fr(D,B,q){let re=B2(D.endRe,q);if(re){if(D["on:end"]){const ye=new Du(D);D["on:end"](B,ye),ye.isMatchIgnored&&(re=!1)}if(re){for(;D.endsParent&&D.parent;)D=D.parent;return D}}if(D.endsWithParent)return Fr(D.parent,B,q)}function en(D){return ie.matcher.regexIndex===0?(we+=D[0],1):(T=!0,0)}function Es(D){const B=D[0],q=D.rule,re=new Du(q),ye=[q.__beforeBegin,q["on:begin"]];for(const je of ye)if(je&&(je(D,re),re.isMatchIgnored))return en(B);return q.skip?we+=B:(q.excludeBegin&&(we+=B),te(),!q.returnBegin&&!q.excludeBegin&&(we=B)),_r(q,D),q.returnBegin?0:B.length}function tn(D){const B=D[0],q=F.substring(D.index),re=Fr(ie,D,q);if(!re)return Lu;const ye=ie;ie.endScope&&ie.endScope._wrap?(te(),be(B,ie.endScope._wrap)):ie.endScope&&ie.endScope._multi?(te(),ht(ie.endScope,D)):ye.skip?we+=B:(ye.returnEnd||ye.excludeEnd||(we+=B),te(),ye.excludeEnd&&(we=B));do ie.scope&&oe.closeNode(),!ie.skip&&!ie.subLanguage&&(at+=ie.relevance),ie=ie.parent;while(ie!==re.parent);return re.starts&&_r(re.starts,D),ye.returnEnd?0:B.length}function lr(){const D=[];for(let B=ie;B!==ft;B=B.parent)B.scope&&D.unshift(B.scope);D.forEach(B=>oe.openNode(B))}let Gt={};function ot(D,B){const q=B&&B[0];if(we+=D,q==null)return te(),0;if(Gt.type==="begin"&&B.type==="end"&&Gt.index===B.index&&q===""){if(we+=F.slice(B.index,B.index+1),!n){const re=new Error(`0 width match regex (${A})`);throw re.languageName=A,re.badRule=Gt.rule,re}return 1}if(Gt=B,B.type==="begin")return Es(B);if(B.type==="illegal"&&!U){const re=new Error('Illegal lexeme "'+q+'" for mode "'+(ie.scope||"<unnamed>")+'"');throw re.mode=ie,re}else if(B.type==="end"){const re=tn(B);if(re!==Lu)return re}if(B.type==="illegal"&&q==="")return 1;if($>1e5&&$>B.index*3)throw new Error("potential infinite loop, way more iterations than matches");return we+=q,q.length}const ft=v(A);if(!ft)throw cs(i.replace("{}",A)),new Error('Unknown language: "'+A+'"');const Br=wS(ft);let ne="",ie=P||Br;const Re={},oe=new l.__emitter(l);lr();let we="",at=0,pt=0,$=0,T=!1;try{if(ft.__emitTokens)ft.__emitTokens(F,oe);else{for(ie.matcher.considerAll();;){$++,T?T=!1:ie.matcher.considerAll(),ie.matcher.lastIndex=pt;const D=ie.matcher.exec(F);if(!D)break;const B=F.substring(pt,D.index),q=ot(B,D);pt=D.index+q}ot(F.substring(pt))}return oe.finalize(),ne=oe.toHTML(),{language:A,value:ne,relevance:at,illegal:!1,_emitter:oe,_top:ie}}catch(D){if(D.message&&D.message.includes("Illegal"))return{language:A,value:$a(F),illegal:!0,relevance:0,_illegalBy:{message:D.message,index:pt,context:F.slice(pt-100,pt+100),mode:D.mode,resultSoFar:ne},_emitter:oe};if(n)return{language:A,value:$a(F),illegal:!1,relevance:0,errorRaised:D,_emitter:oe,_top:ie};throw D}}function f(A){const F={value:$a(A),illegal:!1,relevance:0,_top:a,_emitter:new l.__emitter(l)};return F._emitter.addText(A),F}function p(A,F){F=F||l.languages||Object.keys(e);const U=f(A),P=F.filter(v).filter(E).map(te=>h(te,A,!1));P.unshift(U);const _=P.sort((te,be)=>{if(te.relevance!==be.relevance)return be.relevance-te.relevance;if(te.language&&be.language){if(v(te.language).supersetOf===be.language)return 1;if(v(be.language).supersetOf===te.language)return-1}return 0}),[Y,Z]=_,J=Y;return J.secondBest=Z,J}function m(A,F,U){const P=F&&t[F]||U;A.classList.add("hljs"),A.classList.add(`language-${P}`)}function g(A){let F=null;const U=d(A);if(c(U))return;if(H("before:highlightElement",{el:A,language:U}),A.dataset.highlighted){console.log("Element previously highlighted. To highlight again, first unset `dataset.highlighted`.",A);return}if(A.children.length>0&&(l.ignoreUnescapedHTML||(console.warn("One of your code blocks includes unescaped HTML. This is a potentially serious security risk."),console.warn("https://github.com/highlightjs/highlight.js/wiki/security"),console.warn("The element with unescaped HTML:"),console.warn(A)),l.throwUnescapedHTML))throw new jS("One of your code blocks includes unescaped HTML.",A.innerHTML);F=A;const P=F.textContent,_=U?u(P,{language:U,ignoreIllegals:!0}):p(P);A.innerHTML=_.value,A.dataset.highlighted="yes",m(A,U,_.language),A.result={language:_.language,re:_.relevance,relevance:_.relevance},_.secondBest&&(A.secondBest={language:_.secondBest.language,relevance:_.secondBest.relevance}),H("after:highlightElement",{el:A,result:_,text:P})}function y(A){l=Pu(l,A)}const x=()=>{k(),Ds("10.6.0","initHighlighting() deprecated.  Use highlightAll() now.")};function S(){k(),Ds("10.6.0","initHighlightingOnLoad() deprecated.  Use highlightAll() now.")}let C=!1;function k(){if(document.readyState==="loading"){C=!0;return}document.querySelectorAll(l.cssSelector).forEach(g)}function j(){C&&k()}typeof window<"u"&&window.addEventListener&&window.addEventListener("DOMContentLoaded",j,!1);function O(A,F){let U=null;try{U=F(r)}catch(P){if(cs("Language definition for '{}' could not be registered.".replace("{}",A)),n)cs(P);else throw P;U=a}U.name||(U.name=A),e[A]=U,U.rawDefinition=F.bind(null,r),U.aliases&&M(U.aliases,{languageName:A})}function N(A){delete e[A];for(const F of Object.keys(t))t[F]===A&&delete t[F]}function w(){return Object.keys(e)}function v(A){return A=(A||"").toLowerCase(),e[A]||e[t[A]]}function M(A,{languageName:F}){typeof A=="string"&&(A=[A]),A.forEach(U=>{t[U.toLowerCase()]=F})}function E(A){const F=v(A);return F&&!F.disableAutodetect}function L(A){A["before:highlightBlock"]&&!A["before:highlightElement"]&&(A["before:highlightElement"]=F=>{A["before:highlightBlock"](Object.assign({block:F.el},F))}),A["after:highlightBlock"]&&!A["after:highlightElement"]&&(A["after:highlightElement"]=F=>{A["after:highlightBlock"](Object.assign({block:F.el},F))})}function I(A){L(A),s.push(A)}function W(A){const F=s.indexOf(A);F!==-1&&s.splice(F,1)}function H(A,F){const U=A;s.forEach(function(P){P[U]&&P[U](F)})}function R(A){return Ds("10.7.0","highlightBlock will be removed entirely in v12.0"),Ds("10.7.0","Please use highlightElement now."),g(A)}Object.assign(r,{highlight:u,highlightAuto:p,highlightAll:k,highlightElement:g,highlightBlock:R,configure:y,initHighlighting:x,initHighlightingOnLoad:S,registerLanguage:O,unregisterLanguage:N,listLanguages:w,getLanguage:v,registerAliases:M,autoDetection:E,inherit:Pu,addPlugin:I,removePlugin:W}),r.debugMode=function(){n=!1},r.safeMode=function(){n=!0},r.versionString=NS,r.regex={concat:ks,lookahead:xm,either:Ic,optional:_2,anyNumberOfTimes:$2};for(const A in ui)typeof ui[A]=="object"&&pm(ui[A]);return Object.assign(r,ui),r},Ys=Em({});Ys.newInstance=()=>Em({});var SS=Ys;Ys.HighlightJS=Ys;Ys.default=Ys;var ES=T2(SS);function Am(r,e=[]){return r.map(t=>{const s=[...e,...t.properties?t.properties.className:[]];return t.children?Am(t.children,s):{text:t.value,classes:s}}).flat()}function $u(r){return r.value||r.children||[]}function AS(r){return!!ES.getLanguage(r)}function _u({doc:r,name:e,lowlight:t,defaultLanguage:s}){const n=[];return bl(r,i=>i.type.name===e).forEach(i=>{var a;let l=i.pos+1;const c=i.node.attrs.language||s,d=t.listLanguages(),u=c&&(d.includes(c)||AS(c)||!((a=t.registered)===null||a===void 0)&&a.call(t,c))?$u(t.highlight(c,i.node.textContent)):$u(t.highlightAuto(i.node.textContent));Am(u).forEach(h=>{const f=l+h.text.length;if(h.classes.length){const p=Nt.inline(l,f,{class:h.classes.join(" ")});n.push(p)}l=f})}),Fe.create(r,n)}function CS(r){return typeof r=="function"}function MS({name:r,lowlight:e,defaultLanguage:t}){if(!["highlight","highlightAuto","listLanguages"].every(n=>CS(e[n])))throw Error("You should provide an instance of lowlight to use the code-block-lowlight extension");const s=new Je({key:new yt("lowlight"),state:{init:(n,{doc:i})=>_u({doc:i,name:r,lowlight:e,defaultLanguage:t}),apply:(n,i,a,l)=>{const c=a.selection.$head.parent.type.name,d=l.selection.$head.parent.type.name,u=bl(a.doc,f=>f.type.name===r),h=bl(l.doc,f=>f.type.name===r);return n.docChanged&&([c,d].includes(r)||h.length!==u.length||n.steps.some(f=>f.from!==void 0&&f.to!==void 0&&u.some(p=>p.pos>=f.from&&p.pos+p.node.nodeSize<=f.to)))?_u({doc:n.doc,name:r,lowlight:e,defaultLanguage:t}):i.map(n.mapping,n.doc)}},props:{decorations(n){return s.getState(n)}}});return s}const DS=Zp.extend({addOptions(){var r;return{...(r=this.parent)===null||r===void 0?void 0:r.call(this),lowlight:{},languageClassPrefix:"language-",exitOnTripleEnter:!0,exitOnArrowDown:!0,defaultLanguage:null,HTMLAttributes:{}}},addProseMirrorPlugins(){var r;return[...((r=this.parent)===null||r===void 0?void 0:r.call(this))||[],MS({name:this.name,lowlight:this.options.lowlight,defaultLanguage:this.options.defaultLanguage})]}}),TS=r=>{if(!r.children.length)return;const e=r.querySelectorAll("span");e&&e.forEach(t=>{var s,n;const i=t.getAttribute("style"),a=(n=(s=t.parentElement)===null||s===void 0?void 0:s.closest("span"))===null||n===void 0?void 0:n.getAttribute("style");t.setAttribute("style",`${a};${i}`)})},Fu=Kt.create({name:"textStyle",priority:101,addOptions(){return{HTMLAttributes:{},mergeNestedSpanStyles:!1}},parseHTML(){return[{tag:"span",getAttrs:r=>r.hasAttribute("style")?(this.options.mergeNestedSpanStyles&&TS(r),{}):!1}]},renderHTML({HTMLAttributes:r}){return["span",We(this.options.HTMLAttributes,r),0]},addCommands(){return{removeEmptyTextStyle:()=>({tr:r})=>{const{selection:e}=r;return r.doc.nodesBetween(e.from,e.to,(t,s)=>{if(t.isTextblock)return!0;t.marks.filter(n=>n.type===this.type).some(n=>Object.values(n.attrs).some(i=>!!i))||r.removeMark(s,s+t.nodeSize,this.type)}),!0}}}}),OS=nt.create({name:"color",addOptions(){return{types:["textStyle"]}},addGlobalAttributes(){return[{types:this.options.types,attributes:{color:{default:null,parseHTML:r=>{var e;return(e=r.style.color)===null||e===void 0?void 0:e.replace(/['"]+/g,"")},renderHTML:r=>r.color?{style:`color: ${r.color}`}:{}}}}]},addCommands(){return{setColor:r=>({chain:e})=>e().setMark("textStyle",{color:r}).run(),unsetColor:()=>({chain:r})=>r().setMark("textStyle",{color:null}).removeEmptyTextStyle().run()}}});function Cm(r){return r instanceof Map?r.clear=r.delete=r.set=function(){throw new Error("map is read-only")}:r instanceof Set&&(r.add=r.clear=r.delete=function(){throw new Error("set is read-only")}),Object.freeze(r),Object.getOwnPropertyNames(r).forEach(e=>{const t=r[e],s=typeof t;(s==="object"||s==="function")&&!Object.isFrozen(t)&&Cm(t)}),r}class Bu{constructor(e){e.data===void 0&&(e.data={}),this.data=e.data,this.isMatchIgnored=!1}ignoreMatch(){this.isMatchIgnored=!0}}function Mm(r){return r.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;")}function kr(r,...e){const t=Object.create(null);for(const s in r)t[s]=r[s];return e.forEach(function(s){for(const n in s)t[n]=s[n]}),t}const RS="</span>",Uu=r=>!!r.scope,IS=(r,{prefix:e})=>{if(r.startsWith("language:"))return r.replace("language:","language-");if(r.includes(".")){const t=r.split(".");return[`${e}${t.shift()}`,...t.map((s,n)=>`${s}${"_".repeat(n+1)}`)].join(" ")}return`${e}${r}`};class PS{constructor(e,t){this.buffer="",this.classPrefix=t.classPrefix,e.walk(this)}addText(e){this.buffer+=Mm(e)}openNode(e){if(!Uu(e))return;const t=IS(e.scope,{prefix:this.classPrefix});this.span(t)}closeNode(e){Uu(e)&&(this.buffer+=RS)}value(){return this.buffer}span(e){this.buffer+=`<span class="${e}">`}}const zu=(r={})=>{const e={children:[]};return Object.assign(e,r),e};class $c{constructor(){this.rootNode=zu(),this.stack=[this.rootNode]}get top(){return this.stack[this.stack.length-1]}get root(){return this.rootNode}add(e){this.top.children.push(e)}openNode(e){const t=zu({scope:e});this.add(t),this.stack.push(t)}closeNode(){if(this.stack.length>1)return this.stack.pop()}closeAllNodes(){for(;this.closeNode(););}toJSON(){return JSON.stringify(this.rootNode,null,4)}walk(e){return this.constructor._walk(e,this.rootNode)}static _walk(e,t){return typeof t=="string"?e.addText(t):t.children&&(e.openNode(t),t.children.forEach(s=>this._walk(e,s)),e.closeNode(t)),e}static _collapse(e){typeof e!="string"&&e.children&&(e.children.every(t=>typeof t=="string")?e.children=[e.children.join("")]:e.children.forEach(t=>{$c._collapse(t)}))}}class LS extends $c{constructor(e){super(),this.options=e}addText(e){e!==""&&this.add(e)}startScope(e){this.openNode(e)}endScope(){this.closeNode()}__addSublanguage(e,t){const s=e.root;t&&(s.scope=`language:${t}`),this.add(s)}toHTML(){return new PS(this,this.options).value()}finalize(){return this.closeAllNodes(),!0}}function Bn(r){return r?typeof r=="string"?r:r.source:null}function Dm(r){return Ss("(?=",r,")")}function $S(r){return Ss("(?:",r,")*")}function _S(r){return Ss("(?:",r,")?")}function Ss(...r){return r.map(t=>Bn(t)).join("")}function FS(r){const e=r[r.length-1];return typeof e=="object"&&e.constructor===Object?(r.splice(r.length-1,1),e):{}}function _c(...r){return"("+(FS(r).capture?"":"?:")+r.map(s=>Bn(s)).join("|")+")"}function Tm(r){return new RegExp(r.toString()+"|").exec("").length-1}function BS(r,e){const t=r&&r.exec(e);return t&&t.index===0}const US=/\[(?:[^\\\]]|\\.)*\]|\(\??|\\([1-9][0-9]*)|\\./;function Fc(r,{joinWith:e}){let t=0;return r.map(s=>{t+=1;const n=t;let i=Bn(s),a="";for(;i.length>0;){const l=US.exec(i);if(!l){a+=i;break}a+=i.substring(0,l.index),i=i.substring(l.index+l[0].length),l[0][0]==="\\"&&l[1]?a+="\\"+String(Number(l[1])+n):(a+=l[0],l[0]==="("&&t++)}return a}).map(s=>`(${s})`).join(e)}const zS=/\b\B/,Om="[a-zA-Z]\\w*",Bc="[a-zA-Z_]\\w*",Rm="\\b\\d+(\\.\\d+)?",Im="(-?)(\\b0[xX][a-fA-F0-9]+|(\\b\\d+(\\.\\d*)?|\\.\\d+)([eE][-+]?\\d+)?)",Pm="\\b(0b[01]+)",WS="!|!=|!==|%|%=|&|&&|&=|\\*|\\*=|\\+|\\+=|,|-|-=|/=|/|:|;|<<|<<=|<=|<|===|==|=|>>>=|>>=|>=|>>>|>>|>|\\?|\\[|\\{|\\(|\\^|\\^=|\\||\\|=|\\|\\||~",HS=(r={})=>{const e=/^#![ ]*\//;return r.binary&&(r.begin=Ss(e,/.*\b/,r.binary,/\b.*/)),kr({scope:"meta",begin:e,end:/$/,relevance:0,"on:begin":(t,s)=>{t.index!==0&&s.ignoreMatch()}},r)},Un={begin:"\\\\[\\s\\S]",relevance:0},VS={scope:"string",begin:"'",end:"'",illegal:"\\n",contains:[Un]},qS={scope:"string",begin:'"',end:'"',illegal:"\\n",contains:[Un]},KS={begin:/\b(a|an|the|are|I'm|isn't|don't|doesn't|won't|but|just|should|pretty|simply|enough|gonna|going|wtf|so|such|will|you|your|they|like|more)\b/},ta=function(r,e,t={}){const s=kr({scope:"comment",begin:r,end:e,contains:[]},t);s.contains.push({scope:"doctag",begin:"[ ]*(?=(TODO|FIXME|NOTE|BUG|OPTIMIZE|HACK|XXX):)",end:/(TODO|FIXME|NOTE|BUG|OPTIMIZE|HACK|XXX):/,excludeBegin:!0,relevance:0});const n=_c("I","a","is","so","us","to","at","if","in","it","on",/[A-Za-z]+['](d|ve|re|ll|t|s|n)/,/[A-Za-z]+[-][a-z]+/,/[A-Za-z][a-z]{2,}/);return s.contains.push({begin:Ss(/[ ]+/,"(",n,/[.]?[:]?([.][ ]|[ ])/,"){3}")}),s},GS=ta("//","$"),YS=ta("/\\*","\\*/"),JS=ta("#","$"),XS={scope:"number",begin:Rm,relevance:0},QS={scope:"number",begin:Im,relevance:0},ZS={scope:"number",begin:Pm,relevance:0},eE={scope:"regexp",begin:/\/(?=[^/\n]*\/)/,end:/\/[gimuy]*/,contains:[Un,{begin:/\[/,end:/\]/,relevance:0,contains:[Un]}]},tE={scope:"title",begin:Om,relevance:0},rE={scope:"title",begin:Bc,relevance:0},sE={begin:"\\.\\s*"+Bc,relevance:0},nE=function(r){return Object.assign(r,{"on:begin":(e,t)=>{t.data._beginMatch=e[1]},"on:end":(e,t)=>{t.data._beginMatch!==e[1]&&t.ignoreMatch()}})};var hi=Object.freeze({__proto__:null,APOS_STRING_MODE:VS,BACKSLASH_ESCAPE:Un,BINARY_NUMBER_MODE:ZS,BINARY_NUMBER_RE:Pm,COMMENT:ta,C_BLOCK_COMMENT_MODE:YS,C_LINE_COMMENT_MODE:GS,C_NUMBER_MODE:QS,C_NUMBER_RE:Im,END_SAME_AS_BEGIN:nE,HASH_COMMENT_MODE:JS,IDENT_RE:Om,MATCH_NOTHING_RE:zS,METHOD_GUARD:sE,NUMBER_MODE:XS,NUMBER_RE:Rm,PHRASAL_WORDS_MODE:KS,QUOTE_STRING_MODE:qS,REGEXP_MODE:eE,RE_STARTERS_RE:WS,SHEBANG:HS,TITLE_MODE:tE,UNDERSCORE_IDENT_RE:Bc,UNDERSCORE_TITLE_MODE:rE});function iE(r,e){r.input[r.index-1]==="."&&e.ignoreMatch()}function oE(r,e){r.className!==void 0&&(r.scope=r.className,delete r.className)}function aE(r,e){e&&r.beginKeywords&&(r.begin="\\b("+r.beginKeywords.split(" ").join("|")+")(?!\\.)(?=\\b|\\s)",r.__beforeBegin=iE,r.keywords=r.keywords||r.beginKeywords,delete r.beginKeywords,r.relevance===void 0&&(r.relevance=0))}function lE(r,e){Array.isArray(r.illegal)&&(r.illegal=_c(...r.illegal))}function cE(r,e){if(r.match){if(r.begin||r.end)throw new Error("begin & end are not supported with match");r.begin=r.match,delete r.match}}function dE(r,e){r.relevance===void 0&&(r.relevance=1)}const uE=(r,e)=>{if(!r.beforeMatch)return;if(r.starts)throw new Error("beforeMatch cannot be used with starts");const t=Object.assign({},r);Object.keys(r).forEach(s=>{delete r[s]}),r.keywords=t.keywords,r.begin=Ss(t.beforeMatch,Dm(t.begin)),r.starts={relevance:0,contains:[Object.assign(t,{endsParent:!0})]},r.relevance=0,delete t.beforeMatch},hE=["of","and","for","in","not","or","if","then","parent","list","value"],fE="keyword";function Lm(r,e,t=fE){const s=Object.create(null);return typeof r=="string"?n(t,r.split(" ")):Array.isArray(r)?n(t,r):Object.keys(r).forEach(function(i){Object.assign(s,Lm(r[i],e,i))}),s;function n(i,a){e&&(a=a.map(l=>l.toLowerCase())),a.forEach(function(l){const c=l.split("|");s[c[0]]=[i,pE(c[0],c[1])]})}}function pE(r,e){return e?Number(e):mE(r)?0:1}function mE(r){return hE.includes(r.toLowerCase())}const Wu={},ds=r=>{console.error(r)},Hu=(r,...e)=>{console.log(`WARN: ${r}`,...e)},Ts=(r,e)=>{Wu[`${r}/${e}`]||(console.log(`Deprecated as of ${r}. ${e}`),Wu[`${r}/${e}`]=!0)},Ao=new Error;function $m(r,e,{key:t}){let s=0;const n=r[t],i={},a={};for(let l=1;l<=e.length;l++)a[l+s]=n[l],i[l+s]=!0,s+=Tm(e[l-1]);r[t]=a,r[t]._emit=i,r[t]._multi=!0}function gE(r){if(Array.isArray(r.begin)){if(r.skip||r.excludeBegin||r.returnBegin)throw ds("skip, excludeBegin, returnBegin not compatible with beginScope: {}"),Ao;if(typeof r.beginScope!="object"||r.beginScope===null)throw ds("beginScope must be object"),Ao;$m(r,r.begin,{key:"beginScope"}),r.begin=Fc(r.begin,{joinWith:""})}}function xE(r){if(Array.isArray(r.end)){if(r.skip||r.excludeEnd||r.returnEnd)throw ds("skip, excludeEnd, returnEnd not compatible with endScope: {}"),Ao;if(typeof r.endScope!="object"||r.endScope===null)throw ds("endScope must be object"),Ao;$m(r,r.end,{key:"endScope"}),r.end=Fc(r.end,{joinWith:""})}}function yE(r){r.scope&&typeof r.scope=="object"&&r.scope!==null&&(r.beginScope=r.scope,delete r.scope)}function bE(r){yE(r),typeof r.beginScope=="string"&&(r.beginScope={_wrap:r.beginScope}),typeof r.endScope=="string"&&(r.endScope={_wrap:r.endScope}),gE(r),xE(r)}function wE(r){function e(a,l){return new RegExp(Bn(a),"m"+(r.case_insensitive?"i":"")+(r.unicodeRegex?"u":"")+(l?"g":""))}class t{constructor(){this.matchIndexes={},this.regexes=[],this.matchAt=1,this.position=0}addRule(l,c){c.position=this.position++,this.matchIndexes[this.matchAt]=c,this.regexes.push([c,l]),this.matchAt+=Tm(l)+1}compile(){this.regexes.length===0&&(this.exec=()=>null);const l=this.regexes.map(c=>c[1]);this.matcherRe=e(Fc(l,{joinWith:"|"}),!0),this.lastIndex=0}exec(l){this.matcherRe.lastIndex=this.lastIndex;const c=this.matcherRe.exec(l);if(!c)return null;const d=c.findIndex((h,f)=>f>0&&h!==void 0),u=this.matchIndexes[d];return c.splice(0,d),Object.assign(c,u)}}class s{constructor(){this.rules=[],this.multiRegexes=[],this.count=0,this.lastIndex=0,this.regexIndex=0}getMatcher(l){if(this.multiRegexes[l])return this.multiRegexes[l];const c=new t;return this.rules.slice(l).forEach(([d,u])=>c.addRule(d,u)),c.compile(),this.multiRegexes[l]=c,c}resumingScanAtSamePosition(){return this.regexIndex!==0}considerAll(){this.regexIndex=0}addRule(l,c){this.rules.push([l,c]),c.type==="begin"&&this.count++}exec(l){const c=this.getMatcher(this.regexIndex);c.lastIndex=this.lastIndex;let d=c.exec(l);if(this.resumingScanAtSamePosition()&&!(d&&d.index===this.lastIndex)){const u=this.getMatcher(0);u.lastIndex=this.lastIndex+1,d=u.exec(l)}return d&&(this.regexIndex+=d.position+1,this.regexIndex===this.count&&this.considerAll()),d}}function n(a){const l=new s;return a.contains.forEach(c=>l.addRule(c.begin,{rule:c,type:"begin"})),a.terminatorEnd&&l.addRule(a.terminatorEnd,{type:"end"}),a.illegal&&l.addRule(a.illegal,{type:"illegal"}),l}function i(a,l){const c=a;if(a.isCompiled)return c;[oE,cE,bE,uE].forEach(u=>u(a,l)),r.compilerExtensions.forEach(u=>u(a,l)),a.__beforeBegin=null,[aE,lE,dE].forEach(u=>u(a,l)),a.isCompiled=!0;let d=null;return typeof a.keywords=="object"&&a.keywords.$pattern&&(a.keywords=Object.assign({},a.keywords),d=a.keywords.$pattern,delete a.keywords.$pattern),d=d||/\w+/,a.keywords&&(a.keywords=Lm(a.keywords,r.case_insensitive)),c.keywordPatternRe=e(d,!0),l&&(a.begin||(a.begin=/\B|\b/),c.beginRe=e(c.begin),!a.end&&!a.endsWithParent&&(a.end=/\B|\b/),a.end&&(c.endRe=e(c.end)),c.terminatorEnd=Bn(c.end)||"",a.endsWithParent&&l.terminatorEnd&&(c.terminatorEnd+=(a.end?"|":"")+l.terminatorEnd)),a.illegal&&(c.illegalRe=e(a.illegal)),a.contains||(a.contains=[]),a.contains=[].concat(...a.contains.map(function(u){return vE(u==="self"?a:u)})),a.contains.forEach(function(u){i(u,c)}),a.starts&&i(a.starts,l),c.matcher=n(c),c}if(r.compilerExtensions||(r.compilerExtensions=[]),r.contains&&r.contains.includes("self"))throw new Error("ERR: contains `self` is not supported at the top-level of a language.  See documentation.");return r.classNameAliases=kr(r.classNameAliases||{}),i(r)}function _m(r){return r?r.endsWithParent||_m(r.starts):!1}function vE(r){return r.variants&&!r.cachedVariants&&(r.cachedVariants=r.variants.map(function(e){return kr(r,{variants:null},e)})),r.cachedVariants?r.cachedVariants:_m(r)?kr(r,{starts:r.starts?kr(r.starts):null}):Object.isFrozen(r)?kr(r):r}var NE="11.11.1";class jE extends Error{constructor(e,t){super(e),this.name="HTMLInjectionError",this.html=t}}const _a=Mm,Vu=kr,qu=Symbol("nomatch"),kE=7,Fm=function(r){const e=Object.create(null),t=Object.create(null),s=[];let n=!0;const i="Could not find the language '{}', did you forget to load/include a language module?",a={disableAutodetect:!0,name:"Plain text",contains:[]};let l={ignoreUnescapedHTML:!1,throwUnescapedHTML:!1,noHighlightRe:/^(no-?highlight)$/i,languageDetectRe:/\blang(?:uage)?-([\w-]+)\b/i,classPrefix:"hljs-",cssSelector:"pre code",languages:null,__emitter:LS};function c(R){return l.noHighlightRe.test(R)}function d(R){let A=R.className+" ";A+=R.parentNode?R.parentNode.className:"";const F=l.languageDetectRe.exec(A);if(F){const U=w(F[1]);return U||(Hu(i.replace("{}",F[1])),Hu("Falling back to no-highlight mode for this block.",R)),U?F[1]:"no-highlight"}return A.split(/\s+/).find(U=>c(U)||w(U))}function u(R,A,F){let U="",P="";typeof A=="object"?(U=R,F=A.ignoreIllegals,P=A.language):(Ts("10.7.0","highlight(lang, code, ...args) has been deprecated."),Ts("10.7.0",`Please use highlight(code, options) instead.
https://github.com/highlightjs/highlight.js/issues/2277`),P=R,U=A),F===void 0&&(F=!0);const _={code:U,language:P};W("before:highlight",_);const Y=_.result?_.result:h(_.language,_.code,F);return Y.code=_.code,W("after:highlight",Y),Y}function h(R,A,F,U){const P=Object.create(null);function _(T,D){return T.keywords[D]}function Y(){if(!ne.keywords){Re.addText(oe);return}let T=0;ne.keywordPatternRe.lastIndex=0;let D=ne.keywordPatternRe.exec(oe),B="";for(;D;){B+=oe.substring(T,D.index);const q=ot.case_insensitive?D[0].toLowerCase():D[0],re=_(ne,q);if(re){const[ye,je]=re;if(Re.addText(B),B="",P[q]=(P[q]||0)+1,P[q]<=kE&&(we+=je),ye.startsWith("_"))B+=D[0];else{const Yt=ot.classNameAliases[ye]||ye;te(D[0],Yt)}}else B+=D[0];T=ne.keywordPatternRe.lastIndex,D=ne.keywordPatternRe.exec(oe)}B+=oe.substring(T),Re.addText(B)}function Z(){if(oe==="")return;let T=null;if(typeof ne.subLanguage=="string"){if(!e[ne.subLanguage]){Re.addText(oe);return}T=h(ne.subLanguage,oe,!0,ie[ne.subLanguage]),ie[ne.subLanguage]=T._top}else T=p(oe,ne.subLanguage.length?ne.subLanguage:null);ne.relevance>0&&(we+=T.relevance),Re.__addSublanguage(T._emitter,T.language)}function J(){ne.subLanguage!=null?Z():Y(),oe=""}function te(T,D){T!==""&&(Re.startScope(D),Re.addText(T),Re.endScope())}function be(T,D){let B=1;const q=D.length-1;for(;B<=q;){if(!T._emit[B]){B++;continue}const re=ot.classNameAliases[T[B]]||T[B],ye=D[B];re?te(ye,re):(oe=ye,Y(),oe=""),B++}}function ht(T,D){return T.scope&&typeof T.scope=="string"&&Re.openNode(ot.classNameAliases[T.scope]||T.scope),T.beginScope&&(T.beginScope._wrap?(te(oe,ot.classNameAliases[T.beginScope._wrap]||T.beginScope._wrap),oe=""):T.beginScope._multi&&(be(T.beginScope,D),oe="")),ne=Object.create(T,{parent:{value:ne}}),ne}function _r(T,D,B){let q=BS(T.endRe,B);if(q){if(T["on:end"]){const re=new Bu(T);T["on:end"](D,re),re.isMatchIgnored&&(q=!1)}if(q){for(;T.endsParent&&T.parent;)T=T.parent;return T}}if(T.endsWithParent)return _r(T.parent,D,B)}function Fr(T){return ne.matcher.regexIndex===0?(oe+=T[0],1):($=!0,0)}function en(T){const D=T[0],B=T.rule,q=new Bu(B),re=[B.__beforeBegin,B["on:begin"]];for(const ye of re)if(ye&&(ye(T,q),q.isMatchIgnored))return Fr(D);return B.skip?oe+=D:(B.excludeBegin&&(oe+=D),J(),!B.returnBegin&&!B.excludeBegin&&(oe=D)),ht(B,T),B.returnBegin?0:D.length}function Es(T){const D=T[0],B=A.substring(T.index),q=_r(ne,T,B);if(!q)return qu;const re=ne;ne.endScope&&ne.endScope._wrap?(J(),te(D,ne.endScope._wrap)):ne.endScope&&ne.endScope._multi?(J(),be(ne.endScope,T)):re.skip?oe+=D:(re.returnEnd||re.excludeEnd||(oe+=D),J(),re.excludeEnd&&(oe=D));do ne.scope&&Re.closeNode(),!ne.skip&&!ne.subLanguage&&(we+=ne.relevance),ne=ne.parent;while(ne!==q.parent);return q.starts&&ht(q.starts,T),re.returnEnd?0:D.length}function tn(){const T=[];for(let D=ne;D!==ot;D=D.parent)D.scope&&T.unshift(D.scope);T.forEach(D=>Re.openNode(D))}let lr={};function Gt(T,D){const B=D&&D[0];if(oe+=T,B==null)return J(),0;if(lr.type==="begin"&&D.type==="end"&&lr.index===D.index&&B===""){if(oe+=A.slice(D.index,D.index+1),!n){const q=new Error(`0 width match regex (${R})`);throw q.languageName=R,q.badRule=lr.rule,q}return 1}if(lr=D,D.type==="begin")return en(D);if(D.type==="illegal"&&!F){const q=new Error('Illegal lexeme "'+B+'" for mode "'+(ne.scope||"<unnamed>")+'"');throw q.mode=ne,q}else if(D.type==="end"){const q=Es(D);if(q!==qu)return q}if(D.type==="illegal"&&B==="")return oe+=`
`,1;if(pt>1e5&&pt>D.index*3)throw new Error("potential infinite loop, way more iterations than matches");return oe+=B,B.length}const ot=w(R);if(!ot)throw ds(i.replace("{}",R)),new Error('Unknown language: "'+R+'"');const ft=wE(ot);let Br="",ne=U||ft;const ie={},Re=new l.__emitter(l);tn();let oe="",we=0,at=0,pt=0,$=!1;try{if(ot.__emitTokens)ot.__emitTokens(A,Re);else{for(ne.matcher.considerAll();;){pt++,$?$=!1:ne.matcher.considerAll(),ne.matcher.lastIndex=at;const T=ne.matcher.exec(A);if(!T)break;const D=A.substring(at,T.index),B=Gt(D,T);at=T.index+B}Gt(A.substring(at))}return Re.finalize(),Br=Re.toHTML(),{language:R,value:Br,relevance:we,illegal:!1,_emitter:Re,_top:ne}}catch(T){if(T.message&&T.message.includes("Illegal"))return{language:R,value:_a(A),illegal:!0,relevance:0,_illegalBy:{message:T.message,index:at,context:A.slice(at-100,at+100),mode:T.mode,resultSoFar:Br},_emitter:Re};if(n)return{language:R,value:_a(A),illegal:!1,relevance:0,errorRaised:T,_emitter:Re,_top:ne};throw T}}function f(R){const A={value:_a(R),illegal:!1,relevance:0,_top:a,_emitter:new l.__emitter(l)};return A._emitter.addText(R),A}function p(R,A){A=A||l.languages||Object.keys(e);const F=f(R),U=A.filter(w).filter(M).map(J=>h(J,R,!1));U.unshift(F);const P=U.sort((J,te)=>{if(J.relevance!==te.relevance)return te.relevance-J.relevance;if(J.language&&te.language){if(w(J.language).supersetOf===te.language)return 1;if(w(te.language).supersetOf===J.language)return-1}return 0}),[_,Y]=P,Z=_;return Z.secondBest=Y,Z}function m(R,A,F){const U=A&&t[A]||F;R.classList.add("hljs"),R.classList.add(`language-${U}`)}function g(R){let A=null;const F=d(R);if(c(F))return;if(W("before:highlightElement",{el:R,language:F}),R.dataset.highlighted){console.log("Element previously highlighted. To highlight again, first unset `dataset.highlighted`.",R);return}if(R.children.length>0&&(l.ignoreUnescapedHTML||(console.warn("One of your code blocks includes unescaped HTML. This is a potentially serious security risk."),console.warn("https://github.com/highlightjs/highlight.js/wiki/security"),console.warn("The element with unescaped HTML:"),console.warn(R)),l.throwUnescapedHTML))throw new jE("One of your code blocks includes unescaped HTML.",R.innerHTML);A=R;const U=A.textContent,P=F?u(U,{language:F,ignoreIllegals:!0}):p(U);R.innerHTML=P.value,R.dataset.highlighted="yes",m(R,F,P.language),R.result={language:P.language,re:P.relevance,relevance:P.relevance},P.secondBest&&(R.secondBest={language:P.secondBest.language,relevance:P.secondBest.relevance}),W("after:highlightElement",{el:R,result:P,text:U})}function y(R){l=Vu(l,R)}const x=()=>{k(),Ts("10.6.0","initHighlighting() deprecated.  Use highlightAll() now.")};function S(){k(),Ts("10.6.0","initHighlightingOnLoad() deprecated.  Use highlightAll() now.")}let C=!1;function k(){function R(){k()}if(document.readyState==="loading"){C||window.addEventListener("DOMContentLoaded",R,!1),C=!0;return}document.querySelectorAll(l.cssSelector).forEach(g)}function j(R,A){let F=null;try{F=A(r)}catch(U){if(ds("Language definition for '{}' could not be registered.".replace("{}",R)),n)ds(U);else throw U;F=a}F.name||(F.name=R),e[R]=F,F.rawDefinition=A.bind(null,r),F.aliases&&v(F.aliases,{languageName:R})}function O(R){delete e[R];for(const A of Object.keys(t))t[A]===R&&delete t[A]}function N(){return Object.keys(e)}function w(R){return R=(R||"").toLowerCase(),e[R]||e[t[R]]}function v(R,{languageName:A}){typeof R=="string"&&(R=[R]),R.forEach(F=>{t[F.toLowerCase()]=A})}function M(R){const A=w(R);return A&&!A.disableAutodetect}function E(R){R["before:highlightBlock"]&&!R["before:highlightElement"]&&(R["before:highlightElement"]=A=>{R["before:highlightBlock"](Object.assign({block:A.el},A))}),R["after:highlightBlock"]&&!R["after:highlightElement"]&&(R["after:highlightElement"]=A=>{R["after:highlightBlock"](Object.assign({block:A.el},A))})}function L(R){E(R),s.push(R)}function I(R){const A=s.indexOf(R);A!==-1&&s.splice(A,1)}function W(R,A){const F=R;s.forEach(function(U){U[F]&&U[F](A)})}function H(R){return Ts("10.7.0","highlightBlock will be removed entirely in v12.0"),Ts("10.7.0","Please use highlightElement now."),g(R)}Object.assign(r,{highlight:u,highlightAuto:p,highlightAll:k,highlightElement:g,highlightBlock:H,configure:y,initHighlighting:x,initHighlightingOnLoad:S,registerLanguage:j,unregisterLanguage:O,listLanguages:N,getLanguage:w,registerAliases:v,autoDetection:M,inherit:Vu,addPlugin:L,removePlugin:I}),r.debugMode=function(){n=!1},r.safeMode=function(){n=!0},r.versionString=NE,r.regex={concat:Ss,lookahead:Dm,either:_c,optional:_S,anyNumberOfTimes:$S};for(const R in hi)typeof hi[R]=="object"&&Cm(hi[R]);return Object.assign(r,hi),r},Js=Fm({});Js.newInstance=()=>Fm({});var SE=Js;Js.HighlightJS=Js;Js.default=Js;const EE=Gm(SE),Ku={},AE="hljs-";function CE(r){const e=EE.newInstance();return{highlight:t,highlightAuto:s,listLanguages:n,register:i,registerAlias:a,registered:l};function t(c,d,u){const h=u||Ku,f=typeof h.prefix=="string"?h.prefix:AE;if(!e.getLanguage(c))throw new Error("Unknown language: `"+c+"` is not registered");e.configure({__emitter:ME,classPrefix:f});const p=e.highlight(d,{ignoreIllegals:!0,language:c});if(p.errorRaised)throw new Error("Could not highlight with `Highlight.js`",{cause:p.errorRaised});const m=p._emitter.root,g=m.data;return g.language=p.language,g.relevance=p.relevance,m}function s(c,d){const h=(d||Ku).subset||n();let f=-1,p=0,m;for(;++f<h.length;){const g=h[f];if(!e.getLanguage(g))continue;const y=t(g,c,d);y.data&&y.data.relevance!==void 0&&y.data.relevance>p&&(p=y.data.relevance,m=y)}return m||{type:"root",children:[],data:{language:void 0,relevance:p}}}function n(){return e.listLanguages()}function i(c,d){if(typeof c=="string")e.registerLanguage(c,d);else{let u;for(u in c)Object.hasOwn(c,u)&&e.registerLanguage(u,c[u])}}function a(c,d){if(typeof c=="string")e.registerAliases(typeof d=="string"?d:[...d],{languageName:c});else{let u;for(u in c)if(Object.hasOwn(c,u)){const h=c[u];e.registerAliases(typeof h=="string"?h:[...h],{languageName:u})}}}function l(c){return!!e.getLanguage(c)}}class ME{constructor(e){this.options=e,this.root={type:"root",children:[],data:{language:void 0,relevance:0}},this.stack=[this.root]}addText(e){if(e==="")return;const t=this.stack[this.stack.length-1],s=t.children[t.children.length-1];s&&s.type==="text"?s.value+=e:t.children.push({type:"text",value:e})}startScope(e){this.openNode(String(e))}endScope(){this.closeNode()}__addSublanguage(e,t){const s=this.stack[this.stack.length-1],n=e.root.children;t?s.children.push({type:"element",tagName:"span",properties:{className:[t]},children:n}):s.children.push(...n)}openNode(e){const t=this,s=e.split(".").map(function(a,l){return l?a+"_".repeat(l):t.options.classPrefix+a}),n=this.stack[this.stack.length-1],i={type:"element",tagName:"span",properties:{className:s},children:[]};n.children.push(i),this.stack.push(i)}closeNode(){this.stack.pop()}finalize(){}toHTML(){return""}}const Bm=({onUploadComplete:r,onUploadError:e,accept:t="image/*,.pdf,.txt,.doc,.docx",folder:s="articles",className:n="",children:i,showUploadManager:a=!0,articleId:l})=>{const{userProfile:c}=ve(),[d,u]=b.useState(!1),[h,f]=b.useState([]),[p,m]=b.useState(navigator.onLine),[g,y]=b.useState(!1),x=b.useRef(null);b.useEffect(()=>{const v=()=>m(!0),M=()=>m(!1);return window.addEventListener("online",v),window.addEventListener("offline",M),()=>{window.removeEventListener("online",v),window.removeEventListener("offline",M)}},[]),b.useEffect(()=>{const v=setInterval(()=>{const E=ge.getActiveUploads().map(L=>{const I={bytesTransferred:L.bytesTransferred,totalBytes:L.totalBytes,percentage:Math.round(L.bytesTransferred/L.totalBytes*100),speed:0,estimatedTimeRemaining:0,state:L.state};return{id:L.id,metadata:L,progress:I}});f(E)},1e3);return()=>clearInterval(v)},[]);const S=b.useCallback(async v=>{if(!v||v.length===0)return;if(!c){K.error("Please login to upload files"),e==null||e("Please login to upload files");return}const M=v[0],E=Lo(M);if(!E.isValid){const L=E.error||"Invalid file";console.error("File validation failed:",L),K.error(L),e==null||e(L);return}try{console.log(`📤 Starting upload: ${M.name}`);const L=await ge.addUpload(M,c.uid,s,I=>{f(W=>W.map(H=>H.id===L?{...H,progress:I}:H))},I=>{I instanceof Error?(console.error("Upload failed:",I.message),K.error(`Upload failed: ${I.message}`),e==null||e(I.message)):(console.log(`✅ File uploaded: ${M.name} → ${I.url}`),K.success("File uploaded successfully!"),r(I)),f(W=>W.filter(H=>H.id!==L))},l?{articleId:l,type:"article",targetField:t!=null&&t.includes("image")?"coverImage":"attachment"}:void 0);K.success(`Upload started: ${M.name}`)}catch(L){const I=L instanceof Error?L.message:"Upload failed";console.error("Upload error:",I),K.error(I),e==null||e(I)}},[c,s,r,e,l]),C=b.useCallback(v=>{v.preventDefault(),v.stopPropagation(),v.type==="dragenter"||v.type==="dragover"?u(!0):v.type==="dragleave"&&u(!1)},[]),k=b.useCallback(v=>{v.preventDefault(),v.stopPropagation(),u(!1),v.dataTransfer.files&&v.dataTransfer.files[0]&&S(v.dataTransfer.files)},[S]),j=b.useCallback(()=>{var v;(v=x.current)==null||v.click()},[]),O=b.useCallback((v,M)=>{switch(M){case"pause":ge.pauseUpload(v),K.info("Upload paused");break;case"resume":ge.resumeUpload(v),K.info("Upload resumed");break;case"cancel":ge.cancelUpload(v),K.info("Upload canceled"),f(E=>E.filter(L=>L.id!==v));break;case"delete":ge.deleteCompletedUpload(v),K.success("Upload record deleted"),f(E=>E.filter(L=>L.id!==v));break}},[]),N=v=>{switch(v){case"running":return o.jsx(rt,{className:"h-4 w-4 text-blue-600 animate-pulse"});case"paused":return o.jsx(Mi,{className:"h-4 w-4 text-yellow-600"});case"success":return o.jsx(sr,{className:"h-4 w-4 text-green-600"});case"error":return o.jsx(St,{className:"h-4 w-4 text-red-600"});case"canceled":return o.jsx(et,{className:"h-4 w-4 text-gray-600"});default:return o.jsx(jt,{className:"h-4 w-4 text-gray-600"})}},w=v=>{switch(v){case"running":return"border-blue-200 bg-blue-50";case"paused":return"border-yellow-200 bg-yellow-50";case"success":return"border-green-200 bg-green-50";case"error":return"border-red-200 bg-red-50";case"canceled":return"border-gray-200 bg-gray-50";default:return"border-gray-200 bg-gray-50"}};return i?o.jsxs(o.Fragment,{children:[o.jsx("div",{onClick:j,className:"cursor-pointer",children:i}),o.jsx("input",{ref:x,type:"file",accept:t,onChange:v=>S(v.target.files),className:"hidden"}),a&&h.length>0&&o.jsx("div",{className:"fixed bottom-4 right-4 z-50",children:o.jsxs("div",{className:"bg-white rounded-lg shadow-xl border border-gray-200 w-96 max-h-96 overflow-hidden",children:[o.jsxs("div",{className:"p-4 border-b border-gray-200 flex items-center justify-between",children:[o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx(rt,{className:"h-5 w-5 text-blue-600"}),o.jsxs("div",{className:"flex flex-col",children:[o.jsx("h3",{className:"font-semibold text-gray-900",children:"File Uploads"}),o.jsxs("div",{className:"flex items-center space-x-3 text-xs text-gray-600",children:[o.jsxs("span",{children:[h.filter(v=>v.progress.state==="success").length," ","completed"]}),o.jsxs("span",{children:[h.filter(v=>["running","paused"].includes(v.progress.state)).length," ","active"]}),o.jsxs("span",{children:[h.filter(v=>v.progress.state==="error").length," ","failed"]})]})]}),!p&&o.jsxs("div",{className:"flex items-center space-x-1 text-red-600",children:[o.jsx(fn,{className:"h-4 w-4"}),o.jsx("span",{className:"text-xs",children:"Offline"})]})]}),o.jsx("button",{onClick:()=>y(!g),className:"text-gray-400 hover:text-gray-600",children:g?o.jsx(et,{className:"h-4 w-4"}):o.jsx(rt,{className:"h-4 w-4"})})]}),g&&o.jsx("div",{className:"max-h-64 overflow-y-auto",children:h.map(v=>{var M;return o.jsxs("div",{className:`p-4 border-b border-gray-100 ${w(v.progress.state)}`,children:[o.jsxs("div",{className:"flex items-start justify-between mb-2",children:[o.jsxs("div",{className:"flex items-center space-x-2 flex-1 min-w-0",children:[Gl(((M=v.metadata.file)==null?void 0:M.type)||"")?o.jsx(_s,{className:"h-4 w-4 text-blue-600 flex-shrink-0"}):o.jsx(yh,{className:"h-4 w-4 text-gray-600 flex-shrink-0"}),o.jsx("span",{className:"text-sm font-medium text-gray-900 truncate",children:v.metadata.fileName}),N(v.progress.state)]}),o.jsxs("div",{className:"flex items-center space-x-1 ml-2",children:[v.progress.state==="running"&&o.jsx("button",{onClick:()=>O(v.id,"pause"),className:"p-1 text-yellow-600 hover:bg-yellow-100 rounded",title:"Pause upload",children:o.jsx(Mi,{className:"h-3 w-3"})}),v.progress.state==="paused"&&o.jsx("button",{onClick:()=>O(v.id,"resume"),className:"p-1 text-green-600 hover:bg-green-100 rounded",title:"Resume upload",children:o.jsx(kh,{className:"h-3 w-3"})}),v.progress.state==="error"&&o.jsx("button",{onClick:()=>O(v.id,"resume"),className:"p-1 text-blue-600 hover:bg-blue-100 rounded",title:"Retry upload",children:o.jsx(Po,{className:"h-3 w-3"})}),v.progress.state==="success"&&o.jsx("button",{onClick:()=>O(v.id,"delete"),className:"p-1 text-green-600 hover:bg-green-100 rounded",title:"Remove from list",children:o.jsx(Tr,{className:"h-3 w-3"})}),["running","paused","error"].includes(v.progress.state)&&o.jsx("button",{onClick:()=>O(v.id,"cancel"),className:"p-1 text-red-600 hover:bg-red-100 rounded",title:"Cancel upload",children:o.jsx(Tr,{className:"h-3 w-3"})}),v.progress.state==="error"&&o.jsx("button",{onClick:()=>O(v.id,"delete"),className:"p-1 text-gray-600 hover:bg-gray-100 rounded ml-1",title:"Remove failed upload",children:o.jsx(et,{className:"h-3 w-3"})})]})]}),o.jsxs("div",{className:"mb-2",children:[o.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-600 mb-1",children:[o.jsxs("span",{children:[v.progress.percentage,"%"]}),o.jsxs("span",{children:[ge.formatFileSize(v.progress.bytesTransferred)," ","/"," ",ge.formatFileSize(v.progress.totalBytes)]})]}),o.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:o.jsx("div",{className:`h-2 rounded-full transition-all duration-300 ${v.progress.state==="running"?"bg-blue-600":v.progress.state==="paused"?"bg-yellow-500":v.progress.state==="error"?"bg-red-500":"bg-green-500"}`,style:{width:`${v.progress.percentage}%`}})})]}),v.progress.state==="running"&&o.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[o.jsxs("div",{className:"flex items-center space-x-1",children:[o.jsx(Vl,{className:"h-3 w-3"}),o.jsx("span",{children:ge.formatSpeed(v.progress.speed)})]}),o.jsxs("div",{className:"flex items-center space-x-1",children:[o.jsx(jt,{className:"h-3 w-3"}),o.jsx("span",{children:ge.formatTime(v.progress.estimatedTimeRemaining)})]})]}),v.progress.state==="paused"&&o.jsxs("div",{className:"text-xs text-yellow-600",children:["Upload paused ",p?"":"(offline)"]}),v.progress.state==="error"&&v.metadata.error&&o.jsxs("div",{className:"text-xs text-red-600",children:["Error: ",v.metadata.error]})]},v.id)})})]})})]}):o.jsxs("div",{className:`relative ${n}`,children:[o.jsxs("div",{className:`border-2 border-dashed rounded-lg p-6 text-center transition-all ${d?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-blue-400 hover:bg-blue-50"}`,onDragEnter:C,onDragLeave:C,onDragOver:C,onDrop:k,onClick:j,children:[o.jsx("input",{ref:x,type:"file",accept:t,onChange:v=>S(v.target.files),className:"hidden"}),o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{className:"flex items-center justify-center",children:[o.jsx(rt,{className:"h-12 w-12 text-gray-400"}),!p&&o.jsx("div",{className:"absolute -top-1 -right-1 bg-red-500 text-white rounded-full p-1",children:o.jsx(fn,{className:"h-3 w-3"})})]}),o.jsxs("div",{children:[o.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:p?"Drop files here or click to upload":"Offline - Files will upload when online"}),o.jsx("p",{className:"text-sm text-gray-600",children:"Supports resumable uploads with automatic retry on network reconnection"}),o.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Images, PDFs, and documents up to 10MB"})]})]})]}),o.jsx("div",{className:`absolute top-2 right-2 flex items-center space-x-1 px-2 py-1 rounded-full text-xs ${p?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:p?o.jsxs(o.Fragment,{children:[o.jsx(Ah,{className:"h-3 w-3"}),o.jsx("span",{children:"Online"})]}):o.jsxs(o.Fragment,{children:[o.jsx(fn,{className:"h-3 w-3"}),o.jsx("span",{children:"Offline"})]})})]})},DE=({children:r,...e})=>o.jsx(Bm,{...e,children:r}),Ol=({onUploadComplete:r,onUploadError:e,accept:t="image/*,.pdf,.txt,.doc,.docx",folder:s="articles",className:n="",children:i,useResumable:a=!0,articleId:l})=>{const{userProfile:c}=ve(),[d,u]=b.useState(!1),[h,f]=b.useState(0),[p,m]=b.useState(!1),[g,y]=b.useState(null),[x,S]=b.useState(new Set),C=b.useRef(null);if(a)return o.jsx(Bm,{onUploadComplete:w=>{const v={url:w.url,path:w.path,name:w.name,size:w.size,type:w.type};r(v)},onUploadError:e,accept:t,folder:s,className:n,articleId:l,children:i});const k=async w=>{if(!w||w.length===0)return;if(!c){const I="Please login to upload files";K.error(I),e==null||e(I);return}if(d)return;const v=w[0],M=`${v.name}-${v.size}-${v.lastModified}`,E=`${v.name}_${v.size}_${v.type}`;if(g===M){K.error("This file was just uploaded. Please wait before uploading again.");return}if(x.has(E)){K.error("A file with the same name, size, and type has already been uploaded.");return}const L=Lo(v);if(!L.isValid){const I=L.error||"Invalid file";console.error("File validation failed:",I),K.error(I),e==null||e(I);return}u(!0),f(0);try{const I=await ql(v,c.uid,s,W=>{f(W)},l);y(M),S(W=>new Set([...W,E])),setTimeout(()=>{y(null)},5e3),K.success("File uploaded successfully!"),r(I)}catch(I){const W=I instanceof Error?I.message:"Upload failed";console.error("Upload error:",W),K.error(W),e==null||e(W)}finally{u(!1),f(0),C.current&&(C.current.value="")}},j=w=>{w.preventDefault(),w.stopPropagation(),w.type==="dragenter"||w.type==="dragover"?m(!0):w.type==="dragleave"&&m(!1)},O=w=>{w.preventDefault(),w.stopPropagation(),m(!1),w.dataTransfer.files&&w.dataTransfer.files[0]&&k(w.dataTransfer.files)},N=()=>{var w;(w=C.current)==null||w.click()};return i?o.jsxs(o.Fragment,{children:[o.jsx("div",{onClick:N,className:"cursor-pointer",children:i}),o.jsx("input",{ref:C,type:"file",accept:t,onChange:w=>k(w.target.files),className:"hidden",disabled:d}),d&&o.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:o.jsx("div",{className:"bg-white rounded-lg p-6 max-w-sm w-full mx-4",children:o.jsxs("div",{className:"text-center",children:[o.jsx(rt,{className:"h-8 w-8 text-blue-600 mx-auto mb-4 animate-pulse"}),o.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Uploading File"}),o.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 mb-4",children:o.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${h}%`}})}),o.jsxs("p",{className:"text-sm text-gray-600",children:[h,"% complete"]})]})})})]}):o.jsx("div",{className:`relative ${n}`,children:o.jsxs("div",{className:`border-2 border-dashed rounded-lg p-6 text-center transition-all ${p?"border-blue-500 bg-blue-50":d?"border-gray-300 bg-gray-50":"border-gray-300 hover:border-blue-400 hover:bg-blue-50"}`,onDragEnter:j,onDragLeave:j,onDragOver:j,onDrop:O,onClick:d?void 0:N,children:[o.jsx("input",{ref:C,type:"file",accept:t,onChange:w=>k(w.target.files),className:"hidden",disabled:d}),d?o.jsxs("div",{className:"space-y-4",children:[o.jsx(rt,{className:"h-12 w-12 text-blue-600 mx-auto animate-pulse"}),o.jsxs("div",{children:[o.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Uploading..."}),o.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 mb-2",children:o.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${h}%`}})}),o.jsxs("p",{className:"text-sm text-gray-600",children:[h,"% complete"]})]})]}):o.jsxs("div",{className:"space-y-4",children:[o.jsx(rt,{className:"h-12 w-12 text-gray-400 mx-auto"}),o.jsxs("div",{children:[o.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Drop files here or click to upload"}),o.jsx("p",{className:"text-sm text-gray-600",children:"Supports images, PDFs, and documents up to 10MB"})]})]})]})})},TE=({children:r,...e})=>{const{useResumable:t=!0,...s}=e;return t?o.jsx(DE,{...s,children:r}):o.jsx(Ol,{useResumable:!1,...s,children:r})},OE=({layout:r,onLayoutChange:e})=>{const t=[{id:"full-column",label:"Full Column",icon:E0,description:"Standard width within content column"},{id:"outset",label:"Outset",icon:P0,description:"Extends beyond column boundaries"},{id:"full-screen",label:"Full Width",icon:F0,description:"Spans entire article view width"}];return o.jsxs("div",{className:"absolute -top-12 left-1/2 transform -translate-x-1/2 z-50",children:[o.jsx("div",{className:"bg-white border border-gray-200 rounded-lg shadow-lg p-2 flex items-center space-x-1",children:o.jsx("div",{className:"flex items-center space-x-1 pr-2 border-r border-gray-200",children:t.map(s=>{const n=s.icon,i=r===s.id;return o.jsxs("button",{onClick:()=>e(s.id),className:`
                  p-2 rounded-md transition-colors text-xs font-medium flex flex-col items-center min-w-[60px]
                  ${i?"bg-blue-100 text-blue-700 border border-blue-200":"text-gray-600 hover:bg-gray-100 hover:text-gray-800"}
                `,title:s.description,children:[o.jsx(n,{className:"h-4 w-4 mb-1"}),o.jsx("span",{className:"text-[10px] leading-none",children:s.label})]},s.id)})})}),o.jsxs("div",{className:"absolute top-full left-1/2 transform -translate-x-1/2",children:[o.jsx("div",{className:"w-0 h-0 border-l-4 border-r-4 border-t-4 border-l-transparent border-r-transparent border-t-gray-200"}),o.jsx("div",{className:"w-0 h-0 border-l-4 border-r-4 border-t-4 border-l-transparent border-r-transparent border-t-white absolute -top-1 left-0"})]})]})},RE=({node:r,updateAttributes:e,selected:t,editor:s,getPos:n})=>{const[i,a]=b.useState(!1),[l,c]=b.useState(!1),[d,u]=b.useState(r.attrs.caption||""),h=b.useRef(null),f=b.useRef(null),{src:p,title:m,layout:g,caption:y}=r.attrs;b.useEffect(()=>{a(t),t?c(!0):(c(!1),d!==(r.attrs.caption||"")&&e({caption:d.trim()||null}))},[t,d,r.attrs.caption,e]),b.useEffect(()=>{u(r.attrs.caption||"")},[r.attrs.caption]),b.useEffect(()=>{l&&f.current&&t&&setTimeout(()=>{var O;(O=f.current)==null||O.focus()},100)},[l,t]);const x=O=>{e({layout:O})},S=O=>{u(O.target.value)},C=O=>{var N,w;O.key==="Enter"?(O.preventDefault(),e({caption:d.trim()||null}),(N=f.current)==null||N.blur()):O.key==="Escape"&&(O.preventDefault(),u(r.attrs.caption||""),(w=f.current)==null||w.blur())},k=()=>{e({caption:d.trim()||null})},j=()=>{const O="custom-image transition-all duration-200 rounded-lg",N={"full-column":"image-full-column max-w-full mx-auto block",outset:"image-outset max-w-none mx-auto block","full-screen":"image-full-screen w-screen max-w-none mx-auto block"},w=t?"ring-2 ring-blue-500 ring-opacity-50 shadow-lg":"hover:shadow-md";return`${O} ${N[g]||N["full-column"]} ${w}`};return o.jsxs(ik,{className:"relative group",children:[i&&o.jsx(OE,{layout:g,onLayoutChange:x}),o.jsxs("div",{className:"relative",children:[o.jsx("img",{ref:h,src:p,title:m||"",className:j(),draggable:!1,onLoad:()=>{},onError:O=>{console.error("Image failed to load:",p)}}),t&&o.jsx("div",{className:"absolute inset-0 bg-blue-500 bg-opacity-10 rounded-lg pointer-events-none"})]}),l&&t&&o.jsx("div",{className:"mt-2 text-center",children:o.jsx("input",{ref:f,type:"text",value:d,onChange:S,onKeyDown:C,onBlur:k,placeholder:"Add a caption...",className:"w-full max-w-md px-3 py-2 text-sm text-center text-gray-700 bg-transparent border-b border-gray-300 focus:outline-none focus:border-blue-500 focus:bg-white rounded-none",style:{fontStyle:"italic"}})}),!t&&y&&o.jsx("div",{className:"mt-2 text-center",children:o.jsx("p",{className:"text-sm text-gray-600 italic max-w-md mx-auto px-4",children:y})})]})},IE=ut.create({name:"customImage",addOptions(){return{inline:!1,allowBase64:!0,HTMLAttributes:{}}},inline(){return this.options.inline},group(){return this.options.inline?"inline":"block"},draggable:!0,addAttributes(){return{src:{default:null},title:{default:null},caption:{default:null,parseHTML:r=>r.getAttribute("data-caption")||null},layout:{default:"full-column",parseHTML:r=>r.getAttribute("data-layout")||"full-column"},width:{default:null,renderHTML:r=>r.width?{width:r.width}:{},parseHTML:r=>r.getAttribute("width")},height:{default:null,renderHTML:r=>r.height?{height:r.height}:{},parseHTML:r=>r.getAttribute("height")}}},parseHTML(){return[{tag:"img[src]"}]},renderHTML({HTMLAttributes:r}){const{layout:e,caption:t,...s}=r,n={"full-column":"image-full-column",outset:"image-outset","full-screen":"image-full-screen"},a={class:["custom-image",n[e]||n["full-column"]].filter(Boolean).join(" "),"data-layout":e||"full-column",style:e==="full-column"?"display: block; margin: 16px auto; text-align: center;":void 0};return t&&t.trim()&&(a["data-caption"]=t.trim()),["img",We(this.options.HTMLAttributes,s,a)]},addNodeView(){return uk(RE)},addCommands(){return{setImage:r=>({commands:e})=>e.insertContent({type:this.name,attrs:r}),updateImageLayout:r=>({tr:e,state:t})=>{const{selection:s}=t,{from:n}=s,i=t.doc.nodeAt(n);return i&&i.type.name===this.name?(e.setNodeMarkup(n,void 0,{...i.attrs,layout:r}),!0):!1}}}});class PE{constructor(e,t={}){Me(this,"editor");Me(this,"options");this.editor=e,this.options={maxColumns:4,spacing:8,responsive:!0,...t}}createGrid(e){if(e.length<2)return!1;const t=`grid-${Date.now()}`,s=e.map(n=>({type:"customImage",attrs:{...n,layout:"grid",gridId:t}}));return this.editor.chain().focus().insertContent([{type:"paragraph",attrs:{class:"image-grid-container","data-grid-id":t},content:s}]).run()}convertSelectionToGrid(){const{selection:e}=this.editor.state,t=[];return this.editor.state.doc.nodesBetween(e.from,e.to,s=>{s.type.name==="customImage"&&t.push({src:s.attrs.src,alt:s.attrs.alt,title:s.attrs.title})}),t.length<2?!1:(this.editor.chain().focus().deleteSelection().run(),this.createGrid(t))}addToGrid(e,t){const{state:s}=this.editor;let n=!1,i=-1;return s.doc.descendants((a,l)=>{if(a.type.name==="paragraph"&&a.attrs["data-grid-id"]===e)return n=!0,i=l+a.nodeSize-1,!1}),!n||i===-1?!1:this.editor.chain().focus().insertContentAt(i,{type:"customImage",attrs:{...t,layout:"grid",gridId:e}}).run()}removeFromGrid(e,t){const{state:s}=this.editor;let n=null;const i=[];if(s.doc.descendants((a,l)=>{if(a.type.name==="paragraph"&&a.attrs["data-grid-id"]===e)return n={node:a,pos:l},a.descendants((c,d)=>{c.type.name==="customImage"&&c.attrs.gridId===e&&i.push({node:c,pos:l+d+1})}),!1}),!n||i.length===0)return!1;if(t>=0&&t<i.length){const a=i[t];return this.editor.chain().focus().deleteRange({from:a.pos,to:a.pos+a.node.nodeSize}).run(),i.length===2&&i.find((c,d)=>d!==t)&&this.convertGridToSingleImage(e),!0}return!1}convertGridToSingleImage(e){const{state:t}=this.editor;let s=null;const n=[];if(t.doc.descendants((a,l)=>{if(a.type.name==="paragraph"&&a.attrs["data-grid-id"]===e)return s={node:a,pos:l},a.descendants((c,d)=>{c.type.name==="customImage"&&c.attrs.gridId===e&&n.push({node:c,pos:l+d+1})}),!1}),!s||n.length===0)return!1;const i=n.map(({node:a})=>({type:"customImage",attrs:{...a.attrs,layout:"full-column",gridId:null}}));return this.editor.chain().focus().deleteRange({from:s.pos,to:s.pos+s.node.nodeSize}).insertContent(i.map(a=>({type:"paragraph",content:[a]}))).run()}getOptimalLayout(e){const t=this.options.maxColumns||4;if(e<=1)return{columns:1,rows:1};if(e===2)return{columns:2,rows:1};if(e===3)return{columns:3,rows:1};if(e===4)return{columns:2,rows:2};const s=Math.min(t,Math.ceil(Math.sqrt(e))),n=Math.ceil(e/s);return{columns:s,rows:n}}updateResponsiveLayout(e){if(!this.options.responsive)return;window.matchMedia("(max-width: 768px)").matches?this.updateGridColumns(e,2):this.updateGridColumns(e,this.options.maxColumns||4)}updateGridColumns(e,t){const s=document.querySelector(`[data-grid-id="${e}"]`);s&&s.style.setProperty("--grid-columns",t.toString())}}const LE=CE(),$E=({content:r,onChange:e,placeholder:t="Start writing your article...",articleId:s})=>{ve();const[n,i]=b.useState(!1),[a,l]=b.useState(!1),c=b.useRef(null),d=[{name:"Black",value:"#000000"},{name:"Dark Gray",value:"#404040"},{name:"Gray",value:"#808080"},{name:"Light Gray",value:"#C0C0C0"},{name:"Red",value:"#FF0000"},{name:"Orange",value:"#FFA500"},{name:"Yellow",value:"#FFFF00"},{name:"Green",value:"#008000"},{name:"Blue",value:"#0000FF"},{name:"Purple",value:"#800080"},{name:"Dark Red",value:"#8B0000"},{name:"Dark Orange",value:"#FF8C00"},{name:"Dark Yellow",value:"#B8860B"},{name:"Dark Green",value:"#006400"},{name:"Dark Blue",value:"#000080"},{name:"Dark Purple",value:"#4B0082"}],u=rk({extensions:[a2.configure({bulletList:!1,orderedList:!1,listItem:!1,codeBlock:!1}),Fu,OS.configure({types:[Fu.name,jl.name]}),jl.configure({HTMLAttributes:{class:"list-item"},keepMarks:!0,keepAttributes:!0}),Qp.configure({HTMLAttributes:{class:"bullet-list"},keepMarks:!0,keepAttributes:!0}),nm.configure({HTMLAttributes:{class:"ordered-list"},keepMarks:!0,keepAttributes:!0}),IE.configure({inline:!1,allowBase64:!0,HTMLAttributes:{class:"custom-image"}}),D2.configure({openOnClick:!1,HTMLAttributes:{class:"text-blue-600 hover:text-blue-800 underline"}}),DS.configure({lowlight:LE,HTMLAttributes:{class:"bg-gray-100 rounded-lg p-4 font-mono text-sm"}})],content:r,onUpdate:({editor:x})=>{e(x.getHTML())},onCreate:({editor:x})=>{c.current=new PE(x)},editorProps:{attributes:{class:"prose prose-lg max-w-none focus:outline-none min-h-[400px] p-6"},handleKeyDown:(x,S)=>{const{state:C}=x,{selection:k}=C;if(S.key==="Tab"&&!S.shiftKey&&(u!=null&&u.isActive("bulletList")||u!=null&&u.isActive("orderedList")))return S.preventDefault(),S.stopPropagation(),C.tr,u.can().sinkListItem("listItem")?u.chain().focus().sinkListItem("listItem").run():!0;if(S.key==="Tab"&&S.shiftKey&&(u!=null&&u.isActive("bulletList")||u!=null&&u.isActive("orderedList")))return S.preventDefault(),S.stopPropagation(),C.tr,u.can().liftListItem("listItem")?u.chain().focus().liftListItem("listItem").run():!0;if(S.key==="Enter"&&!S.shiftKey&&(u!=null&&u.isActive("bulletList")||u!=null&&u.isActive("orderedList")))return u.can().splitListItem("listItem")?(S.preventDefault(),u.chain().focus().splitListItem("listItem").run()):!1;if(S.key==="Backspace"&&(u!=null&&u.isActive("bulletList")||u!=null&&u.isActive("orderedList"))){const{$from:j}=k;if(j.parentOffset===0&&u.can().liftListItem("listItem"))return S.preventDefault(),u.chain().focus().liftListItem("listItem").run()}return!1}}});if(!u)return null;const h=()=>{const x=window.prompt("Enter image URL:");x&&u.commands.setImage({src:x,alt:"",layout:"full-column"})},f=()=>{const x=window.prompt("Enter URL:");x&&u.chain().focus().setLink({href:x}).run()},p=x=>{if(x.type.startsWith("image/"))u.commands.setImage({src:x.url,alt:x.name||"",title:x.name||"",layout:"full-column"});else{const S=x.type==="application/pdf"?"PDF":"Document",C=`📄 ${x.name} (${S})`;u.chain().focus().setLink({href:x.url,target:"_blank"}).insertContent(C).run()}},m=x=>{K.error(x)},g=x=>{u.chain().focus().setColor(x).run(),l(!1)},y=()=>{u.chain().focus().unsetColor().run(),l(!1)};return o.jsxs("div",{className:"border border-gray-200 rounded-xl bg-white relative flex flex-col max-h-[600px]",children:[o.jsx("style",{children:`
        /* Typography styles for both editor and preview */
        .ProseMirror h1, .article-content h1, h1 {
          font-size: 32px !important;
          font-weight: bold !important;
          margin: 16px 0 8px 0 !important;
          line-height: 48px !important;
        }
        .ProseMirror h3, .article-content h3, h3 {
          font-size: 24px !important;
          font-weight: 600 !important;
          margin: 12px 0 6px 0 !important;
          line-height: 27.6px !important;
        }
        .ProseMirror p, .article-content p, p {
          font-size: 16px !important;
          line-height: 18.4px !important;
          margin: 8px 0 !important;
        }
        .ProseMirror, .article-content {
          font-size: 16px !important;
          line-height: 18.4px !important;
        }
        /* Custom Image Layout Styles */
        .custom-image {
          cursor: pointer;
          border-radius: 8px;
          transition: all 0.2s ease;
          height: auto;
        }

        /* Full Column Width Layout */
        .image-full-column {
          max-width: 100%;
          width: auto;
          display: block;
          margin: 16px auto;
          text-align: center;
        }

        /* Outset Layout - extends beyond column boundaries */
        .image-outset {
          max-width: 120%;
          width: auto;
          display: block;
          margin: 16px auto;
          margin-left: -10%;
          margin-right: -10%;
        }

        /* Full Screen Width Layout */
        .image-full-screen {
          width: calc(100% + 2rem);
          max-width: none;
          display: block;
          margin: 16px 0;
          margin-left: -1rem;
          margin-right: -1rem;
          object-fit: cover;
        }

        /* Image Grid Layouts */
        .image-grid-item {
          display: inline-block;
          margin: 4px;
          border-radius: 8px;
          vertical-align: top;
        }

        /* 2-image grid */
        .image-grid-item:nth-child(2n) {
          width: calc(50% - 8px);
        }

        /* 3-image grid */
        .image-grid-item:nth-child(3n) {
          width: calc(33.333% - 8px);
        }

        /* 4+ image grid */
        .image-grid-item:nth-child(4n) {
          width: calc(25% - 8px);
        }

        /* Grid container */
        .image-grid-container {
          display: flex;
          flex-wrap: wrap;
          gap: 8px;
          margin: 16px 0;
          justify-content: center;
        }

        /* Responsive grid adjustments */
        @media (max-width: 768px) {
          .image-outset {
            max-width: 100%;
            margin-left: 0;
            margin-right: 0;
          }

          .image-full-screen {
            width: 100%;
            margin-left: 0;
            margin-right: 0;
            padding: 0;
          }

          .image-grid-item:nth-child(n) {
            width: calc(50% - 8px);
          }
        }

        @media (max-width: 480px) {
          .image-grid-item:nth-child(n) {
            width: 100%;
            margin: 4px 0;
          }
        }

        /* Hover and selection states */
        .custom-image:hover {
          outline: 2px solid #3b82f6;
          box-shadow: 0 4px 12px rgba(59, 130, 246, 0.15);
        }

        .ProseMirror .custom-image.ProseMirror-selectednode {
          outline: 2px solid #3b82f6;
          box-shadow: 0 4px 12px rgba(59, 130, 246, 0.15);
        }

        /* Legacy image styles for backward compatibility */
        .ProseMirror img:not(.custom-image), .article-content img:not(.custom-image) {
          cursor: pointer;
          border-radius: 8px;
          transition: all 0.2s ease;
          max-width: 100%;
          height: auto;
          display: block;
          margin: 8px auto;
        }

        .ProseMirror img:not(.custom-image):hover, .article-content img:not(.custom-image):hover {
          outline: 2px solid #3b82f6;
          box-shadow: 0 4px 12px rgba(59, 130, 246, 0.15);
        }

        .ProseMirror img:not(.custom-image).ProseMirror-selectednode {
          outline: 2px solid #3b82f6;
          box-shadow: 0 4px 12px rgba(59, 130, 246, 0.15);
        }

        /* Float left images (legacy) */
        .ProseMirror img[style*="float: left"], .article-content img[style*="float: left"] {
          float: left !important;
          margin: 0 16px 8px 0 !important;
          max-width: 50% !important;
          display: inline !important;
        }

        /* Float right images (legacy) */
        .ProseMirror img[style*="float: right"], .article-content img[style*="float: right"] {
          float: right !important;
          margin: 0 0 8px 16px !important;
          max-width: 50% !important;
          display: inline !important;
        }

        /* Centered images (legacy) */
        .ProseMirror img[style*="margin: 16px auto"], .article-content img[style*="margin: 16px auto"] {
          display: block !important;
          margin: 16px auto !important;
          max-width: 100% !important;
          float: none !important;
        }

        /* Resizable images (legacy) */
        .ProseMirror img[style*="resize: both"], .article-content img[style*="resize: both"] {
          resize: both !important;
          overflow: auto !important;
        }
        .ProseMirror ul, .ProseMirror ol {
          font-size: 16px !important;
          line-height: 18.4px !important;
          margin: 8px 0 !important;
          padding-left: 24px !important;
          position: relative !important;
          display: block !important;
          box-sizing: border-box !important;
        }
        .ProseMirror ul li, .ProseMirror ol li {
          font-size: 16px !important;
          line-height: 18.4px !important;
          margin: 2px 0 !important;
          padding-left: 4px !important;
          position: relative !important;
          display: list-item !important;
          box-sizing: border-box !important;
          min-height: 1.2em !important;
        }
        .ProseMirror ul {
          list-style-type: disc !important;
        }
        .ProseMirror ol {
          list-style-type: decimal !important;
        }
        .ProseMirror ul ul {
          list-style-type: circle !important;
          margin-top: 4px !important;
          margin-bottom: 4px !important;
        }
        .ProseMirror ul ul ul {
          list-style-type: square !important;
        }
        .ProseMirror ol ol {
          list-style-type: lower-alpha !important;
          margin-top: 4px !important;
          margin-bottom: 4px !important;
        }
        .ProseMirror ol ol ol {
          list-style-type: lower-roman !important;
        }
        /* Prevent list jumping and ensure stable positioning */
        .ProseMirror ul, .ProseMirror ol {
          transform: translateZ(0) !important;
          backface-visibility: hidden !important;
          will-change: auto !important;
        }
        .ProseMirror li {
          transform: translateZ(0) !important;
          backface-visibility: hidden !important;
        }
        /* Ensure consistent list marker positioning */
        .ProseMirror ul li::marker, .ProseMirror ol li::marker {
          content: normal !important;
        }
        /* Stable list item content */
        .ProseMirror li p {
          margin: 0 !important;
          padding: 0 !important;
          display: inline !important;
        }
        /* Smooth scrolling and stable positioning during scroll */
        .ProseMirror {
          scroll-behavior: smooth !important;
          -webkit-overflow-scrolling: touch !important;
        }
        /* Prevent layout shifts during scrolling */
        .ProseMirror ul, .ProseMirror ol {
          contain: layout style !important;
          isolation: isolate !important;
        }
        .ProseMirror li {
          contain: layout !important;
        }
        /* Medium-style smooth editing experience */
        .ProseMirror * {
          transition: none !important;
        }
        /* Stable focus states during scrolling */
        .ProseMirror:focus-within {
          outline: none !important;
        }
      `}),o.jsxs("div",{className:"border-b border-gray-200 p-3 flex flex-wrap gap-1 sticky top-0 z-10 bg-white flex-shrink-0",children:[o.jsxs("select",{onChange:x=>{const S=parseInt(x.target.value),{selection:C}=u.state,{$from:k}=C,j=k.pos;if(S===0?u.chain().focus().setParagraph().run():u.chain().focus().toggleHeading({level:S}).run(),k.nodeBefore||k.start()>1){const O=k.start(k.depth);if(O>1){const N=O-1,w=u.state.doc.resolve(N),v=w.start(w.depth);u.chain().focus().setTextSelection({from:v,to:N}).run(),S===0?u.chain().focus().setParagraph().run():u.chain().focus().toggleHeading({level:S}).run(),u.chain().focus().setTextSelection(j).run()}}},value:u.isActive("heading",{level:1})?"1":u.isActive("heading",{level:2})?"2":u.isActive("heading",{level:3})?"3":"0",className:"px-3 py-1 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[o.jsx("option",{value:"0",children:"Content (16px)"}),o.jsx("option",{value:"3",children:"Subheading (24px)"}),o.jsx("option",{value:"1",children:"Heading (32px)"})]}),o.jsx("div",{className:"w-px h-6 bg-gray-300 mx-1"}),o.jsx("button",{onClick:()=>u.chain().focus().toggleBold().run(),className:`p-2 rounded-lg hover:bg-gray-100 ${u.isActive("bold")?"bg-blue-100 text-blue-700":"text-gray-600"}`,title:"Bold",children:o.jsx(C0,{className:"h-4 w-4"})}),o.jsx("button",{onClick:()=>u.chain().focus().toggleItalic().run(),className:`p-2 rounded-lg hover:bg-gray-100 ${u.isActive("italic")?"bg-blue-100 text-blue-700":"text-gray-600"}`,title:"Italic",children:o.jsx(U0,{className:"h-4 w-4"})}),o.jsxs("div",{className:"relative",children:[o.jsx("button",{onClick:()=>l(!a),className:`p-2 rounded-lg hover:bg-gray-100 ${a?"bg-blue-100 text-blue-700":"text-gray-600"}`,title:"Text Color",children:o.jsx(G0,{className:"h-4 w-4"})}),a&&o.jsxs("div",{className:"absolute top-full left-0 mt-1 bg-white border border-gray-200 rounded-lg shadow-lg p-3 z-20",children:[o.jsx("div",{className:"grid grid-cols-4 gap-1 mb-2",children:d.map(x=>o.jsx("button",{onClick:()=>g(x.value),className:"w-6 h-6 rounded border border-gray-300 hover:scale-110 transition-transform",style:{backgroundColor:x.value},title:x.name},x.value))}),o.jsx("button",{onClick:y,className:"w-full text-xs text-gray-600 hover:text-gray-800 py-1 border-t border-gray-200",children:"Remove Color"})]})]}),o.jsx("div",{className:"w-px h-6 bg-gray-300 mx-1"}),o.jsx("button",{onClick:()=>u.chain().focus().toggleBulletList().run(),className:`p-2 rounded-lg hover:bg-gray-100 ${u.isActive("bulletList")?"bg-blue-100 text-blue-700":"text-gray-600"}`,title:"Bullet List",children:o.jsx(H0,{className:"h-4 w-4"})}),o.jsx("button",{onClick:()=>u.chain().focus().toggleOrderedList().run(),className:`p-2 rounded-lg hover:bg-gray-100 ${u.isActive("orderedList")?"bg-blue-100 text-blue-700":"text-gray-600"}`,title:"Numbered List",children:o.jsx(W0,{className:"h-4 w-4"})}),(u.isActive("bulletList")||u.isActive("orderedList"))&&o.jsxs(o.Fragment,{children:[o.jsx("button",{onClick:()=>u.chain().focus().sinkListItem("listItem").run(),disabled:!u.can().sinkListItem("listItem"),className:`p-2 rounded-lg hover:bg-gray-100 text-gray-600 ${u.can().sinkListItem("listItem")?"":"opacity-50 cursor-not-allowed"}`,title:"Indent List Item (Tab)",children:"→"}),o.jsx("button",{onClick:()=>u.chain().focus().liftListItem("listItem").run(),disabled:!u.can().liftListItem("listItem"),className:`p-2 rounded-lg hover:bg-gray-100 text-gray-600 ${u.can().liftListItem("listItem")?"":"opacity-50 cursor-not-allowed"}`,title:"Outdent List Item (Shift+Tab)",children:"←"})]}),o.jsx("button",{onClick:()=>u.chain().focus().toggleBlockquote().run(),className:`p-2 rounded-lg hover:bg-gray-100 ${u.isActive("blockquote")?"bg-blue-100 text-blue-700":"text-gray-600"}`,title:"Quote",children:o.jsx(J0,{className:"h-4 w-4"})}),o.jsx("button",{onClick:()=>u.chain().focus().toggleCodeBlock().run(),className:`p-2 rounded-lg hover:bg-gray-100 ${u.isActive("codeBlock")?"bg-blue-100 text-blue-700":"text-gray-600"}`,title:"Code Block",children:o.jsx(R0,{className:"h-4 w-4"})}),o.jsx("div",{className:"w-px h-6 bg-gray-300 mx-1"}),o.jsx("button",{onClick:f,className:"p-2 rounded-lg hover:bg-gray-100 text-gray-600",title:"Add Link",children:o.jsx(z0,{className:"h-4 w-4"})}),o.jsx("button",{onClick:h,className:"p-2 rounded-lg hover:bg-gray-100 text-gray-600",title:"Add Image",children:o.jsx(_s,{className:"h-4 w-4"})}),o.jsx("div",{className:"w-px h-6 bg-gray-300 mx-1"}),o.jsx(TE,{onUploadComplete:p,onUploadError:m,accept:"image/*,.pdf,.txt,.doc,.docx",folder:"articles",className:"p-2 rounded-lg hover:bg-gray-100 text-gray-600",useResumable:!0,articleId:s,children:o.jsx(rt,{className:"h-4 w-4",title:"Upload File"})}),o.jsx("div",{className:"w-px h-6 bg-gray-300 mx-1"}),o.jsx("button",{onClick:()=>u.chain().focus().undo().run(),disabled:!u.can().undo(),className:"p-2 rounded-lg hover:bg-gray-100 text-gray-600 disabled:opacity-50",title:"Undo",children:o.jsx(tx,{className:"h-4 w-4"})}),o.jsx("button",{onClick:()=>u.chain().focus().redo().run(),disabled:!u.can().redo(),className:"p-2 rounded-lg hover:bg-gray-100 text-gray-600 disabled:opacity-50",title:"Redo",children:o.jsx(X0,{className:"h-4 w-4"})})]}),o.jsx("div",{className:"flex-1 overflow-y-auto p-4",style:{scrollBehavior:"smooth"},children:o.jsx(qj,{editor:u,className:"prose prose-lg max-w-none focus:outline-none min-h-[300px]",style:{fontSize:"16px",lineHeight:"18.4px"}})})]})};function _E(r){if(!r)return r;const e=of(r);return e.querySelectorAll("img[data-caption]").forEach(s=>{const n=s.getAttribute("data-caption");if(n&&n.trim()){const i=document.createElement("figure");i.className="image-figure-container",i.style.cssText="margin: 16px auto; text-align: center; display: block;";const a=document.createElement("figcaption");a.className="image-caption-text",a.style.cssText=`
        margin-top: 12px;
        margin-bottom: 16px;
        font-size: 0.875rem;
        color: #6b7280;
        font-style: italic;
        line-height: 1.5;
        text-align: center;
        max-width: 600px;
        margin-left: auto;
        margin-right: auto;
        padding: 0 20px;
        box-sizing: border-box;
        font-family: inherit;
      `.replace(/\s+/g," ").trim(),a.textContent=n.trim();const l=s.cloneNode(!0);l.removeAttribute("data-caption"),s.parentNode&&(i.appendChild(l),i.appendChild(a),s.parentNode.replaceChild(i,s))}}),e.innerHTML}function Um(r){const e=_E(r),t=of(e);return t.querySelectorAll("figure.image-figure-container").forEach(n=>{const i=n.querySelector("img"),a=n.querySelector("figcaption");if(i&&a){const l=i.getAttribute("data-layout");l==="outset"?a.style.maxWidth="500px":l==="full-screen"&&(a.style.maxWidth="800px")}}),t.innerHTML}const Gu=r=>{try{let n=(decodeURIComponent(r).split("/").pop()||"").split("?")[0].replace(/^temp_/,"");const i=n.split("_");if(i.length>=2){const a=i[i.length-1];if(/^\d{13,}\.[\w]+$/.test(a)){let d=i.slice(0,-1).join("_");const u=a.split(".").pop();return d=d.replace(/_/g," ").replace(/\s+/g," ").trim(),`${d}.${u}`}}return n.replace(/_/g," ").replace(/\s+/g," ").trim()||"Download"}catch(e){return console.error("Error extracting filename:",e),"Download"}},Yu=()=>{var at,pt;const{id:r}=Il(),e=Tt(),{userProfile:t,isInfoWriter:s,isAdmin:n}=ve(),i=r!=="new",[a,l]=b.useState(!1),[c,d]=b.useState(!1),[u,h]=b.useState(!1),[f,p]=b.useState({title:"",content:"",excerpt:"",status:"draft",categories:[],tags:[],coverImage:"",attachments:[]}),[m,g]=b.useState(!1),[y,x]=b.useState(0),[S,C]=b.useState(!1),[k,j]=b.useState(""),[O,N]=b.useState(!1),[w,v]=b.useState(""),[M,E]=b.useState(""),[L,I]=b.useState(""),[W,H]=b.useState("upload"),[R,A]=b.useState(""),[F,U]=b.useState(!1),[P,_]=b.useState(!1),[Y,Z]=b.useState(!1),[J,te]=b.useState({title:"",content:"",category:"",tags:""}),be=["Technology","Programming","Web Development","Mobile Development","Data Science","AI & Machine Learning","DevOps","Cybersecurity","UI/UX Design","Business","Tutorials","News & Updates","Other"];b.useEffect(()=>{i||setTimeout(()=>{la.getAllDrafts().some(B=>{const q=!r||B.id!==r,re=B.content.trim().length>50,ye=Date.now()-B.lastModified.getTime()<7*24*60*60*1e3;return q&&re&&ye})&&!i&&g(!0)},1e3)},[i,r]),b.useEffect(()=>{var D,B;if(!t)return;const T=JSON.stringify({title:f.title||"",content:f.content||"",excerpt:f.excerpt||"",categories:f.categories||[],tags:f.tags||[],coverImage:f.coverImage||""})!==k&&(((D=f.title)==null?void 0:D.trim())||((B=f.content)==null?void 0:B.trim()));C(T)},[f,k,t]),b.useEffect(()=>{if(!t||!f.title&&!f.content)return;const $={title:f.title||"",content:f.content||"",excerpt:f.excerpt||"",categories:f.categories||[],tags:f.tags||[],coverImage:f.coverImage||""};($.title.trim()||$.content.trim())&&la.saveDraft(r==="new"?null:r,$)},[f,t,r]),b.useEffect(()=>{const $=T=>{if(S)return T.preventDefault(),T.returnValue="You have unsaved changes. Are you sure you want to leave?",T.returnValue};return window.addEventListener("beforeunload",$),()=>window.removeEventListener("beforeunload",$)},[S]);const ht=async $=>{if(Y)return K.error("Please wait for all file uploads to complete before leaving this page."),!1;if(S)return N(!0),!1;if(r==="new"&&t)try{await ge.cleanupTempFiles(t.uid),console.log("🧹 Cleaned up temp files on navigation")}catch(T){console.error("Error cleaning up temp files:",T)}return e($||-1),!0},_r=$=>{var T;p({title:$.title||"",content:$.content||"",excerpt:$.excerpt||"",status:"draft",categories:$.categories||[],tags:$.tags||[],coverImage:$.coverImage||"",attachments:[]}),v(((T=$.categories)==null?void 0:T[0])||""),g(!1),K.success("Draft recovered successfully!")},Fr=()=>{if(M.trim()&&f.tags&&f.tags.length<4){const $=M.trim();f.tags.includes($)||p(T=>({...T,tags:[...T.tags||[],$]})),E("")}else f.tags&&f.tags.length>=4&&K.error("Maximum 4 tags allowed")},en=$=>{p(T=>{var D;return{...T,tags:((D=T.tags)==null?void 0:D.filter(B=>B!==$))||[]}})},Es=$=>{v($),p(T=>({...T,categories:$==="Other"?[]:$?[$]:[]})),$!=="Other"&&I("")},tn=async $=>{p(T=>({...T,coverImage:$.url})),U(!1),K.success("Cover image uploaded successfully")};b.useEffect(()=>{const $=setInterval(()=>{const D=ge.getActiveUploads().length>0;Z(D),D&&!P&&_(!0)},1e3);return()=>clearInterval($)},[P]),b.useEffect(()=>{const $=D=>{const{url:B,context:q}=D.detail;(q==null?void 0:q.type)==="cover"&&(q==null?void 0:q.articleId)===r&&(p(re=>({...re,coverImage:B})),K.success("Cover image uploaded successfully"))};return(()=>{var B;const D=localStorage.getItem("completed_cover_upload");if(D)try{const q=JSON.parse(D);((B=q.context)==null?void 0:B.articleId)===r&&Date.now()-q.timestamp<3e5&&(p(re=>({...re,coverImage:q.url})),K.success("Cover image uploaded successfully"),localStorage.removeItem("completed_cover_upload"))}catch(q){console.error("Error processing completed cover upload:",q)}})(),window.addEventListener("coverUploadCompleted",$),()=>{window.removeEventListener("coverUploadCompleted",$)}},[r]);const lr=()=>{const $=R.trim();if(!$){K.error("Please enter an image URL");return}try{const T=new URL($);if(!["http:","https:"].includes(T.protocol)){K.error("Please enter a valid HTTP or HTTPS URL");return}}catch{K.error("Please enter a valid URL");return}p(T=>({...T,coverImage:$})),A(""),K.success("Cover image URL added successfully")},Gt=async()=>{const $=f.coverImage;if(p(T=>({...T,coverImage:""})),A(""),$)try{const T=Yl($);T&&T.startsWith("articles/")&&(await Kl(T),console.log("✅ Deleted removed cover image:",T))}catch(T){console.error("⚠️ Failed to delete removed cover image:",T)}},ot=$=>{p(T=>({...T,attachments:[...T.attachments||[],$.url]})),K.success("File attached successfully")},ft=async($,T)=>{if(t)try{await ge.updatePendingUploadsWithArticleId($),await ge.cleanupUnusedFiles(t.uid,$,T.content||"",T.coverImage,T.attachments),console.log(`✅ File organization completed for article: ${$}`)}catch(D){console.error("Error handling file uploads for new article:",D)}};b.useEffect(()=>{if(t){if(!s&&!n){K.error("You need InfoWriter or Admin privileges to create or edit articles"),e("/dashboard");return}i&&r&&Br(r)}},[r,i,s,n,e,t]);const Br=async $=>{var T;l(!0);try{const D=await _o($);if(D){if(D.authorId!==(t==null?void 0:t.uid)){K.error("You can only edit your own articles"),e("/my-articles");return}if(D.status==="archive"){K.error("Archived articles cannot be edited"),e("/my-articles");return}p(D),v(((T=D.categories)==null?void 0:T[0])||"")}else K.error("Article not found"),e("/my-articles")}catch{K.error("Error loading article"),e("/my-articles")}finally{l(!1)}},ne=$=>{const D=$i($).split(/\s+/).filter(q=>q.length>0),B=70;return D.length<=B?D.join(" "):D.slice(0,B).join(" ")+"..."},ie=()=>{r&&r!=="new"&&la.deleteDraft(r)},Re=()=>{p({title:"",content:"",excerpt:"",status:"draft",categories:[],tags:[],coverImage:"",attachments:[]}),v(""),I(""),E(""),A(""),x($=>$+1),te({title:"",content:"",category:"",tags:""}),j(""),C(!1)},oe=async($="draft")=>{var B,q,re;if(!t){K.error("User authentication error. Please refresh and try again.");return}if(Y){K.error("Please wait for all file uploads to complete before saving.");return}if(!((B=f.title)!=null&&B.trim())){K.error("Article title is required");return}te({title:"",content:"",category:"",tags:""});const T={title:"",content:"",category:"",tags:""};let D=!1;if((q=f.title)!=null&&q.trim()||(T.title="This field is required",D=!0),(re=f.content)!=null&&re.trim()||(T.content="This field is required",D=!0),w?w==="Other"&&!L.trim()&&(T.category="Please enter your custom category",D=!0):(T.category="Please select a category",D=!0),(!f.tags||f.tags.length===0)&&(T.tags="At least one tag is required",D=!0),D){te(T),K.error("Please fill in all required fields");return}if(!t.uid){K.error("User authentication error. Please refresh and try again.");return}if(!t.displayName&&!t.email){K.error("User profile incomplete. Please update your profile.");return}d(!0);try{const ye=new Date,je={...f,status:$,excerpt:f.excerpt||ne(f.content),authorId:t.uid,authorName:t.displayName||t.email,publishedAt:$==="published"&&!f.publishedAt?ye:f.publishedAt,updatedAt:ye};if(i&&r){if(await $o(r,je),t)try{await ge.cleanupUnusedFiles(t.uid,r,je.content||"",je.coverImage,je.attachments),console.log("🧹 Cleaned up unused files after article update")}catch(Yt){console.error("Error cleaning up unused files:",Yt)}if(K.success(`Article ${$==="published"?"published":$==="archive"?"archived":"saved"} successfully`),j(JSON.stringify({title:je.title||"",content:je.content||"",excerpt:je.excerpt||"",categories:je.categories||[],tags:je.tags||[],coverImage:je.coverImage||""})),$==="published"){ie(),Re(),e(n?"/personal-dashboard":"/dashboard");return}if($==="archive"){e("/my-articles?status=archive");return}if($==="draft"){e(n?"/personal-dashboard":"/dashboard");return}}else{const Yt=await Oh(je);await ft(Yt,je),K.success(`Article ${$==="published"?"published":$==="archive"?"archived":"created"} successfully`),j(JSON.stringify({title:je.title||"",content:je.content||"",excerpt:je.excerpt||"",categories:je.categories||[],tags:je.tags||[],coverImage:je.coverImage||""})),$==="published"&&ie(),Re(),e($==="draft"?n?"/personal-dashboard":"/dashboard":$==="archive"?"/my-articles?status=archive":"/article/new")}p(Yt=>({...Yt,status:$}))}catch(ye){console.error("Error saving article:",ye),K.error("Error saving article. Please try again.")}finally{d(!1)}};if(a||!t)return o.jsx("div",{className:"flex items-center justify-center min-h-64",children:o.jsx("div",{className:"animate-spin h-8 w-8 border-2 border-blue-500 border-t-transparent rounded-full"})});const we=()=>o.jsxs(o.Fragment,{children:[o.jsx("style",{children:`
        /* Typography styles for preview mode */
        .article-content h1 {
          font-size: 32px !important;
          font-weight: bold !important;
          margin: 16px 0 8px 0 !important;
          line-height: 48px !important;
        }
        .article-content h3 {
          font-size: 24px !important;
          font-weight: 600 !important;
          margin: 12px 0 6px 0 !important;
          line-height: 27.6px !important;
        }
        .article-content p {
          font-size: 16px !important;
          line-height: 18.4px !important;
          margin: 8px 0 !important;
        }
        .article-content {
          font-size: 16px !important;
          line-height: 18.4px !important;
        }
        /* List styles for preview mode */
        .article-content ul, .article-content ol {
          font-size: 16px !important;
          line-height: 18.4px !important;
          margin: 8px 0 !important;
          padding-left: 24px !important;
        }
        .article-content ul li, .article-content ol li {
          font-size: 16px !important;
          line-height: 18.4px !important;
          margin: 2px 0 !important;
          padding-left: 4px !important;
          position: relative !important;
          display: list-item !important;
          box-sizing: border-box !important;
          min-height: 1.2em !important;
        }
        .article-content ul {
          list-style-type: disc !important;
          position: relative !important;
          display: block !important;
          box-sizing: border-box !important;
        }
        .article-content ol {
          list-style-type: decimal !important;
          position: relative !important;
          display: block !important;
          box-sizing: border-box !important;
        }
        /* Stable list positioning for preview */
        .article-content ul, .article-content ol {
          transform: translateZ(0) !important;
          backface-visibility: hidden !important;
        }
        .article-content li {
          transform: translateZ(0) !important;
          backface-visibility: hidden !important;
        }
        .article-content li p {
          margin: 0 !important;
          padding: 0 !important;
          display: inline !important;
        }
        /* Custom Image Layout Styles for Preview */
        .article-content .custom-image {
          cursor: pointer;
          border-radius: 8px;
          transition: all 0.2s ease;
          height: auto;
        }

        /* Full Column Width Layout */
        .article-content .image-full-column {
          max-width: 100%;
          width: auto;
          display: block;
          margin: 16px auto;
        }

        /* Outset Layout - extends beyond column boundaries */
        .article-content .image-outset {
          max-width: 120%;
          width: auto;
          display: block;
          margin: 16px auto;
          margin-left: -10%;
          margin-right: -10%;
        }

        /* Full Screen Width Layout */
        .article-content .image-full-screen {
          width: 100vw;
          max-width: none;
          display: block;
          margin: 16px 0;
          margin-left: calc(-50vw + 50%);
          margin-right: calc(-50vw + 50%);
          padding: 0 20px;
          box-sizing: border-box;
        }

        /* Image Grid Layouts */
        .article-content .image-grid-item {
          display: inline-block;
          margin: 4px;
          border-radius: 8px;
          vertical-align: top;
        }

        /* 2-image grid */
        .article-content .image-grid-item:nth-child(2n) {
          width: calc(50% - 8px);
        }

        /* 3-image grid */
        .article-content .image-grid-item:nth-child(3n) {
          width: calc(33.333% - 8px);
        }

        /* 4+ image grid */
        .article-content .image-grid-item:nth-child(4n) {
          width: calc(25% - 8px);
        }

        /* Grid container */
        .article-content .image-grid-container {
          display: flex;
          flex-wrap: wrap;
          gap: 8px;
          margin: 16px 0;
          justify-content: center;
        }

        /* Responsive grid adjustments */
        @media (max-width: 768px) {
          .article-content .image-outset {
            max-width: 100%;
            margin-left: 0;
            margin-right: 0;
          }

          .article-content .image-full-screen {
            width: 100%;
            margin-left: 0;
            margin-right: 0;
            padding: 0;
          }

          .article-content .image-grid-item:nth-child(n) {
            width: calc(50% - 8px);
          }
        }

        @media (max-width: 480px) {
          .article-content .image-grid-item:nth-child(n) {
            width: 100%;
            margin: 4px 0;
          }
        }

        /* Image Caption Styles for Preview - now handled by JavaScript processor */
        .article-content .image-figure-container {
          margin: 16px auto !important;
          text-align: center !important;
          display: block !important;
        }

        .article-content .image-caption-text {
          margin-top: 12px !important;
          margin-bottom: 16px !important;
          font-size: 0.875rem !important;
          color: #6b7280 !important;
          font-style: italic !important;
          line-height: 1.5 !important;
          text-align: center !important;
          max-width: 600px !important;
          margin-left: auto !important;
          margin-right: auto !important;
          padding: 0 20px !important;
          box-sizing: border-box !important;
          font-family: inherit !important;
        }

        /* Enhanced text content styling for preview */
        .article-content {
          color: #374151;
          line-height: 1.75;
          max-width: none;
          margin: 0 auto;
        }

        .article-content p {
          margin-top: 1.25em !important;
          margin-bottom: 1.25em !important;
          color: #374151 !important;
          text-align: left !important;
          font-size: 16px !important;
          line-height: 1.75 !important;
        }

        .article-content h1, .article-content h2, .article-content h3, .article-content h4, .article-content h5, .article-content h6 {
          color: #111827 !important;
          font-weight: 600 !important;
          line-height: 1.25 !important;
          margin-top: 2em !important;
          margin-bottom: 1em !important;
        }

        .article-content ul, .article-content ol {
          margin-top: 1.25em !important;
          margin-bottom: 1.25em !important;
          padding-left: 1.625em !important;
          color: #374151 !important;
        }

        .article-content li {
          margin-top: 0.5em !important;
          margin-bottom: 0.5em !important;
        }

        .article-content blockquote {
          font-style: italic !important;
          border-left: 4px solid #e5e7eb !important;
          padding-left: 1em !important;
          margin: 1.6em 0 !important;
          color: #6b7280 !important;
        }

        .article-content code {
          background-color: #f3f4f6 !important;
          padding: 0.125em 0.25em !important;
          border-radius: 0.25em !important;
          font-size: 0.875em !important;
          color: #dc2626 !important;
        }

        .article-content pre {
          background-color: #1f2937 !important;
          color: #f9fafb !important;
          padding: 1em !important;
          border-radius: 0.5em !important;
          overflow-x: auto !important;
          margin: 1.5em 0 !important;
        }

        .article-content pre code {
          background-color: transparent !important;
          color: inherit !important;
          padding: 0 !important;
        }

        .article-content a {
          color: #2563eb !important;
          text-decoration: underline !important;
        }

        .article-content a:hover {
          color: #1d4ed8 !important;
        }

        .article-content strong {
          font-weight: 600 !important;
          color: #111827 !important;
        }

        .article-content em {
          font-style: italic !important;
        }

        /* Legacy image styles for backward compatibility */
        .article-content img:not(.custom-image) {
          border-radius: 8px;
          max-width: 100%;
          height: auto;
          display: block;
          margin: 8px auto;
        }
        .article-content img[style*="float: left"] {
          float: left !important;
          margin: 0 16px 8px 0 !important;
          max-width: 50% !important;
          display: inline !important;
        }
        .article-content img[style*="float: right"] {
          float: right !important;
          margin: 0 0 8px 16px !important;
          max-width: 50% !important;
          display: inline !important;
        }
        .article-content img[style*="margin: 16px auto"] {
          display: block !important;
          margin: 16px auto !important;
          max-width: 100% !important;
          float: none !important;
        }
        /* Clear floats after images */
        .article-content::after {
          content: "";
          display: table;
          clear: both;
        }
      `}),o.jsxs("div",{className:"max-w-4xl mx-auto bg-white rounded-2xl shadow-lg overflow-hidden",children:[f.coverImage&&o.jsx("div",{className:"w-full h-64 md:h-80 overflow-hidden",children:o.jsx("img",{src:f.coverImage,alt:"Cover",className:"w-full h-full object-cover"})}),o.jsx(af,{isOpen:P,onClose:()=>_(!1),articleId:r!=="new"?r:void 0}),Y&&o.jsx("div",{className:"bg-yellow-50 border-l-4 border-yellow-400 p-4 mx-8 mt-4",children:o.jsxs("div",{className:"flex items-center",children:[o.jsx("div",{className:"flex-shrink-0",children:o.jsx(rt,{className:"h-5 w-5 text-yellow-400 animate-pulse"})}),o.jsx("div",{className:"ml-3",children:o.jsxs("p",{className:"text-sm text-yellow-700",children:[o.jsx("strong",{children:"Files are uploading..."})," Please wait for all uploads to complete before saving or leaving this page."]})})]})}),o.jsxs("div",{className:"p-8",children:[o.jsx("h1",{className:"text-4xl font-bold text-gray-900 mb-4",children:f.title||"Untitled Article"}),o.jsxs("div",{className:"flex flex-wrap items-center gap-4 mb-6",children:[w&&o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx(Ci,{className:"h-4 w-4 text-blue-600"}),o.jsx("span",{className:"bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-medium",children:w})]}),f.tags&&f.tags.length>0&&o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx(hs,{className:"h-4 w-4 text-purple-600"}),o.jsx("div",{className:"flex flex-wrap gap-2",children:f.tags.map(($,T)=>o.jsx("span",{className:"bg-purple-100 text-purple-800 px-2 py-1 rounded-full text-xs font-medium",children:$},T))})]})]}),o.jsx("div",{className:"max-w-4xl mx-auto px-6",children:o.jsx("div",{className:"prose prose-lg max-w-none article-content",dangerouslySetInnerHTML:{__html:Um(f.content||"<p>Start writing your article...</p>")}})}),f.tags&&f.tags.length>0&&o.jsx("div",{className:"mt-8 pt-6 border-t border-gray-200",children:o.jsx("div",{className:"flex flex-wrap gap-2",children:f.tags.map(($,T)=>o.jsxs("span",{className:"bg-gray-100 text-gray-700 px-3 py-1 rounded-full text-sm hover:bg-gray-200 transition-colors",children:["#",$]},T))})}),f.attachments&&f.attachments.length>0&&o.jsxs("div",{className:"mt-8 pt-6 border-t border-gray-200",children:[o.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[o.jsx(Yc,{className:"h-5 w-5 mr-2"}),"Attachments"]}),o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:f.attachments.map(($,T)=>o.jsxs("a",{href:$,target:"_blank",rel:"noopener noreferrer",className:"flex items-center p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",children:[o.jsx(gt,{className:"h-5 w-5 text-gray-600 mr-3"}),o.jsx("span",{className:"text-sm text-gray-700 truncate",children:Gu($)||`Attachment ${T+1}`})]},T))})]})]})]})]});return o.jsxs("div",{className:"max-w-6xl mx-auto space-y-6",children:[m&&o.jsx(Fb,{onRecover:_r,onDismiss:()=>g(!1),currentArticleId:r==="new"?void 0:r}),o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{className:"flex items-center space-x-3",children:[o.jsx("button",{onClick:()=>ht("/dashboard"),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",title:"Back to Dashboard",children:o.jsx(Lt,{className:"h-5 w-5 text-gray-600"})}),o.jsxs("button",{onClick:()=>ht("/my-articles"),className:"flex items-center space-x-2 text-gray-600 hover:text-gray-900 transition-colors",children:[o.jsx(gt,{className:"h-4 w-4"}),o.jsx("span",{children:"Back to Articles"})]})]}),o.jsxs("div",{className:"flex items-center space-x-3",children:[o.jsxs("button",{onClick:()=>h(!u),className:`flex items-center space-x-2 px-4 py-2 rounded-lg transition-colors ${u?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-100 hover:bg-gray-200 text-gray-700"}`,children:[u?o.jsx(zs,{className:"h-4 w-4"}):o.jsx(us,{className:"h-4 w-4"}),o.jsx("span",{children:u?"Edit Mode":"Preview"})]}),o.jsxs("button",{onClick:()=>oe("draft"),disabled:c||Y,className:"flex items-center space-x-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors disabled:opacity-50",title:Y?"Please wait for uploads to complete":"",children:[o.jsx(Sh,{className:"h-4 w-4"}),o.jsx("span",{children:c?"Saving...":"Save Draft"})]}),o.jsxs("button",{onClick:()=>oe("archive"),disabled:c||Y,className:"flex items-center space-x-2 px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition-colors disabled:opacity-50",title:Y?"Please wait for uploads to complete":"",children:[o.jsx(gt,{className:"h-4 w-4"}),o.jsx("span",{children:"Archive"})]}),o.jsxs("button",{onClick:()=>oe("published"),disabled:c||Y,className:"flex items-center space-x-2 px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors disabled:opacity-50",title:Y?"Please wait for uploads to complete":"",children:[o.jsx(Sn,{className:"h-4 w-4"}),o.jsx("span",{children:"Publish"})]})]})]}),u?o.jsx(we,{}):o.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[o.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[o.jsxs("div",{className:"bg-white rounded-2xl p-6 border border-gray-200",children:[o.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[o.jsx(_s,{className:"h-5 w-5 mr-2"}),"Cover Image (Optional)"]}),f.coverImage?o.jsxs("div",{className:"relative",children:[o.jsx("img",{src:f.coverImage,alt:"Cover",className:"w-full h-48 object-cover rounded-lg"}),o.jsx("button",{onClick:Gt,className:"absolute top-2 right-2 p-1 bg-red-600 text-white rounded-full hover:bg-red-700 transition-colors",children:o.jsx(et,{className:"h-4 w-4"})})]}):o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{className:"flex space-x-1 bg-gray-100 rounded-lg p-1",children:[o.jsx("button",{onClick:()=>H("upload"),className:`flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors ${W==="upload"?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:"📁 Upload File"}),o.jsx("button",{onClick:()=>H("url"),className:`flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors ${W==="url"?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:"🔗 Image URL"})]}),W==="upload"&&o.jsx(Ol,{onUploadComplete:tn,onUploadError:$=>K.error($),accept:"image/*",useResumable:!0,articleId:r==="new"?void 0:r,className:"border-2 border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-blue-400 transition-colors",children:o.jsxs("div",{className:"flex flex-col items-center",children:[o.jsx(_s,{className:"h-12 w-12 text-gray-400 mb-4"}),o.jsx("p",{className:"text-gray-600 mb-2",children:"Click to upload cover image"}),o.jsx("p",{className:"text-sm text-gray-500",children:"PNG, JPG, GIF up to 10MB"})]})}),W==="url"&&o.jsxs("div",{className:"space-y-3",children:[o.jsxs("div",{className:"flex space-x-2",children:[o.jsx("input",{type:"url",value:R,onChange:$=>A($.target.value),placeholder:"Enter image URL (https://...)",className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),o.jsx("button",{onClick:lr,disabled:!R.trim(),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Add"})]}),R.trim()&&o.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[o.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Preview:"}),o.jsx("img",{src:R,alt:"Preview",className:"w-full h-32 object-cover rounded-lg",onError:$=>{$.currentTarget.style.display="none",$.currentTarget.nextElementSibling.style.display="block"}}),o.jsxs("div",{className:"hidden text-center py-8 text-gray-500",children:[o.jsx(_s,{className:"h-8 w-8 mx-auto mb-2 text-gray-400"}),o.jsx("p",{className:"text-sm",children:"Invalid image URL"})]})]})]})]})]}),o.jsxs("div",{className:"bg-white rounded-2xl p-6 border border-gray-200",children:[o.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Article Title"," ",o.jsx("span",{className:"text-s text-red-500 mr-0",children:"*"})]}),o.jsx("input",{type:"text",value:f.title||"",onChange:$=>p(T=>({...T,title:$.target.value})),onFocus:()=>te($=>({...$,title:""})),placeholder:"Article title...",className:`w-full text-3xl font-bold border-none outline-none bg-transparent placeholder-gray-400 resize-none ${J.title?"border-b-2 border-red-500":""}`,style:{minHeight:"1.2em"}}),J.title&&o.jsxs("p",{className:"text-red-500 text-sm mt-1 flex items-center",children:[o.jsx("span",{className:"mr-1",children:"⚠️"}),J.title]})]}),o.jsxs("div",{className:`bg-white rounded-2xl border overflow-hidden ${J.content?"border-red-500":"border-gray-200"}`,children:[o.jsxs("div",{className:"p-4 border-b border-gray-200",children:[o.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[o.jsx(gt,{className:"h-5 w-5 mr-2"}),"Article Content"," ",o.jsx("span",{className:"text-s text-red-500 mr-0",children:"*"})]}),J.content&&o.jsxs("p",{className:"text-red-500 text-sm mt-1 flex items-center",children:[o.jsx("span",{className:"mr-1",children:"⚠️"}),J.content]})]}),o.jsx("div",{className:"p-6",children:o.jsx($E,{content:f.content||"",onChange:$=>{p(T=>({...T,content:$})),J.content&&te(T=>({...T,content:""}))},placeholder:"Start writing your article...",articleId:r!=="new"?r:void 0},y)})]})]}),o.jsxs("div",{className:"space-y-6",children:[o.jsxs("div",{className:`bg-white rounded-2xl p-6 border ${J.category?"border-red-500":"border-gray-200"}`,children:[o.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[o.jsx(Ci,{className:"h-5 w-5 mr-2"}),"Category ",o.jsx("span",{className:"text-s text-red-500 mr-0",children:"*"})]}),o.jsxs("select",{value:w,onChange:$=>{Es($.target.value),J.category&&te(T=>({...T,category:""}))},className:`w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${J.category?"border-red-500":"border-gray-300"}`,children:[o.jsx("option",{value:"",children:"Select a category..."}),be.map($=>o.jsx("option",{value:$,children:$},$))]}),w==="Other"&&o.jsxs("div",{className:"mt-3",children:[o.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Enter Custom Category"," ",o.jsx("span",{className:"text-red-500",children:"*"})]}),o.jsx("input",{type:"text",value:L,onChange:$=>{I($.target.value),J.category&&te(T=>({...T,category:""})),p(T=>({...T,categories:[$.target.value]}))},placeholder:"Type your custom category...",className:`w-full p-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${J.category?"border-red-500":"border-gray-300"}`})]}),J.category&&o.jsxs("p",{className:"text-red-500 text-sm mt-2 flex items-center",children:[o.jsx("span",{className:"mr-1",children:"⚠️"}),J.category]}),w&&o.jsx("div",{className:"mt-3",children:o.jsxs("span",{className:"inline-flex items-center gap-1 px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm",children:[w==="Other"?L||"Other":w,o.jsx("button",{onClick:()=>Es(""),className:"hover:text-blue-600",children:o.jsx(et,{className:"h-3 w-3"})})]})})]}),o.jsxs("div",{className:`bg-white rounded-2xl p-6 border ${J.tags?"border-red-500":"border-gray-200"}`,children:[o.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[o.jsx(hs,{className:"h-5 w-5 mr-2"}),"Tags",o.jsx("span",{className:"text-s text-red-500 mr-0",children:"*"})]}),J.tags&&o.jsx("div",{className:"mb-3",children:o.jsxs("p",{className:"text-red-500 text-sm flex items-center",children:[o.jsx("span",{className:"mr-1",children:"⚠️"}),J.tags]})}),o.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:(at=f.tags)==null?void 0:at.map($=>o.jsxs("span",{className:"inline-flex items-center gap-1 px-3 py-1 bg-purple-100 text-purple-800 rounded-full text-sm",children:[$,o.jsx("button",{onClick:()=>en($),className:"hover:text-purple-600",children:o.jsx(et,{className:"h-3 w-3"})})]},$))}),o.jsxs("div",{className:"flex gap-2",children:[o.jsx("input",{type:"text",value:M,onChange:$=>{E($.target.value),J.tags&&f.tags&&f.tags.length>0&&te(T=>({...T,tags:""}))},onKeyPress:$=>{$.key==="Enter"&&($.preventDefault(),Fr())},placeholder:"Add a tag...",className:`flex-1 p-2 border rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent ${J.tags?"border-red-500":"border-gray-300"}`,disabled:f.tags&&f.tags.length>=4}),o.jsx("button",{onClick:()=>{Fr(),J.tags&&M.trim()&&te($=>({...$,tags:""}))},disabled:!M.trim()||f.tags&&f.tags.length>=4,className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:o.jsx(za,{className:"h-4 w-4"})})]}),o.jsxs("p",{className:"text-xs text-gray-500 mt-2 flex items-center",children:[o.jsx("span",{className:"text-red-500 mr-1",children:"*"}),((pt=f.tags)==null?void 0:pt.length)||0,"/4 tags used",f.tags&&f.tags.length===0&&" - At least one tag is required"]})]}),o.jsxs("div",{className:"bg-white rounded-2xl p-6 border border-gray-200",children:[o.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[o.jsx(Yc,{className:"h-5 w-5 mr-2"}),"Attachments"]}),r==="new"?o.jsx("div",{className:"border-2 border-dashed border-yellow-300 rounded-lg p-4 text-center bg-yellow-50",children:o.jsxs("div",{className:"flex flex-col items-center",children:[o.jsx(rt,{className:"h-8 w-8 text-yellow-400 mb-2"}),o.jsx("p",{className:"text-sm text-yellow-700 mb-1 font-medium",children:"Save Article First"}),o.jsx("p",{className:"text-xs text-yellow-600",children:"Please save the article to enable file uploads"})]})}):o.jsx(Ol,{onUploadComplete:ot,onUploadError:$=>K.error($),accept:".pdf,.doc,.docx,.txt,.xls,.xlsx,.ppt,.pptx",useResumable:!0,articleId:r==="new"?void 0:r,className:"border-2 border-dashed border-gray-300 rounded-lg p-4 text-center hover:border-blue-400 transition-colors",children:o.jsxs("div",{className:"flex flex-col items-center",children:[o.jsx(rt,{className:"h-8 w-8 text-gray-400 mb-2"}),o.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Upload files"}),o.jsx("p",{className:"text-xs text-gray-500",children:"PDF, DOC, TXT, etc."})]})}),f.attachments&&f.attachments.length>0&&o.jsx("div",{className:"mt-4 space-y-2",children:f.attachments.map(($,T)=>o.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded-lg",children:[o.jsxs("div",{className:"flex items-center",children:[o.jsx(gt,{className:"h-4 w-4 text-gray-600 mr-2"}),o.jsx("span",{className:"text-sm text-gray-700 truncate",children:Gu($)||`Attachment ${T+1}`})]}),o.jsx("button",{onClick:()=>{var B;const D=((B=f.attachments)==null?void 0:B.filter((q,re)=>re!==T))||[];p(q=>({...q,attachments:D}))},className:"text-red-600 hover:text-red-800 transition-colors",children:o.jsx(Tr,{className:"h-4 w-4"})})]},T))})]})]})]}),O&&o.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:o.jsxs("div",{className:"bg-white rounded-lg max-w-md w-full p-6",children:[o.jsxs("div",{className:"flex items-center mb-4",children:[o.jsx(St,{className:"h-6 w-6 text-yellow-600 mr-3"}),o.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Unsaved Changes"})]}),o.jsx("p",{className:"text-gray-600 mb-6",children:"You have unsaved changes. Would you like to save them as a draft before leaving?"}),o.jsxs("div",{className:"flex items-center justify-end space-x-3",children:[o.jsx("button",{onClick:()=>N(!1),className:"px-4 py-2 text-gray-700 bg-gray-200 rounded-lg hover:bg-gray-300 transition-colors",children:"Cancel"}),o.jsx("button",{onClick:async()=>{if(N(!1),C(!1),r==="new"&&t)try{await ge.cleanupTempFiles(t.uid),console.log("🧹 Cleaned up temp files on leave without saving")}catch($){console.error("Error cleaning up temp files:",$)}e(-1)},className:"px-4 py-2 text-red-700 bg-red-100 rounded-lg hover:bg-red-200 transition-colors",children:"Leave Without Saving"}),o.jsx("button",{onClick:async()=>{N(!1),await oe("draft")},className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Save as Draft"})]})]})})]})},FE=({articleId:r,articleTitle:e,articleUrl:t,className:s="",showLabel:n=!1,size:i="md"})=>{const{userProfile:a}=ve(),[l,c]=b.useState(!1),[d,u]=b.useState(!1),h=t||`${window.location.origin}/article/${r}`,f=async g=>{try{switch(g){case"copy":{await Hh(h)?(u(!0),setTimeout(()=>u(!1),2e3),Ne.success("Link copied to clipboard!")):Ne.error("Failed to copy link");break}case"twitter":Bh(h,e);break;case"facebook":Uh(h);break;case"linkedin":zh(h,e);break;case"email":Wh(h,e);break}Fh(r,g,a==null?void 0:a.uid).catch(()=>{}),c(!1)}catch(y){console.error("Error sharing article:",y),Ne.error("Failed to share article")}},p={sm:"h-4 w-4",md:"h-5 w-5",lg:"h-6 w-6"},m={sm:"p-1.5",md:"p-2",lg:"p-3"};return o.jsxs("div",{className:"relative",children:[o.jsxs("button",{onClick:()=>c(!l),className:`${m[i]} text-gray-600 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors flex items-center space-x-1 ${s}`,title:"Share Article",children:[o.jsx(Z0,{className:p[i]}),n&&o.jsx("span",{className:"text-sm",children:"Share"})]}),l&&o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>c(!1)}),o.jsx("div",{className:"absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-gray-200 z-20",children:o.jsxs("div",{className:"py-1",children:[o.jsxs("button",{onClick:()=>f("copy"),className:"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 flex items-center space-x-2",children:[d?o.jsx(_l,{className:"h-4 w-4 text-green-600"}):o.jsx(I0,{className:"h-4 w-4"}),o.jsx("span",{children:d?"Copied!":"Copy Link"})]}),o.jsxs("button",{onClick:()=>f("twitter"),className:"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-blue-50 hover:text-blue-700 flex items-center space-x-2",children:[o.jsx(Hl,{className:"h-4 w-4"}),o.jsx("span",{children:"Share on Twitter"})]}),o.jsxs("button",{onClick:()=>f("facebook"),className:"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-blue-50 hover:text-blue-700 flex items-center space-x-2",children:[o.jsx($0,{className:"h-4 w-4"}),o.jsx("span",{children:"Share on Facebook"})]}),o.jsxs("button",{onClick:()=>f("linkedin"),className:"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-blue-50 hover:text-blue-700 flex items-center space-x-2",children:[o.jsx(Bl,{className:"h-4 w-4"}),o.jsx("span",{children:"Share on LinkedIn"})]}),o.jsxs("button",{onClick:()=>f("email"),className:"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 flex items-center space-x-2",children:[o.jsx(Wt,{className:"h-4 w-4"}),o.jsx("span",{children:"Share via Email"})]})]})})]})]})},BE=async(r,e,t,s,n)=>{try{const i=pe(X,"articles",r,"comments"),a=new Date,l={articleId:r,userId:e,userName:t,userProfilePicture:s||null,content:n.trim(),createdAt:Le.fromDate(a),updatedAt:Le.fromDate(a),replyCount:0};console.log("Creating comment with data:",l);const c=await Pl(i,l);return console.log("Comment created successfully with ID:",c.id),c.id}catch(i){throw console.error("Error creating comment:",i),i}},UE=async(r,e,t,s,n,i)=>{try{const a=pe(X,"articles",r,"comments",e,"replies"),l={commentId:e,articleId:r,userId:t,userName:s,userProfilePicture:n||null,content:i.trim(),createdAt:Le.fromDate(new Date),updatedAt:Le.fromDate(new Date)},c=await Pl(a,l),d=he(X,"articles",r,"comments",e);return await qe(d,{replyCount:rs(1)}),c.id}catch(a){throw a}},zE=async(r,e)=>{try{const t=pe(X,"articles",r,"comments",e,"replies"),n=(await vt(t)).docs.map(a=>Rt(a.ref));await Promise.all(n);const i=he(X,"articles",r,"comments",e);await Rt(i)}catch(t){throw console.error("Error deleting comment:",t),t}},WE=async(r,e,t)=>{try{const s=he(X,"articles",r,"comments",e,"replies",t);await Rt(s);const n=he(X,"articles",r,"comments",e);await qe(n,{replyCount:rs(-1)})}catch(s){throw s}},zm=(r,e)=>{const t=pe(X,"articles",r,"comments"),s=xe(t,Wn("createdAt","desc"));return Ee(s,n=>{const i=[];n.docs.forEach(a=>{const l=a.data();i.push({id:a.id,articleId:l.articleId,userId:l.userId,userName:l.userName,userProfilePicture:l.userProfilePicture,content:l.content,createdAt:l.createdAt.toDate(),updatedAt:l.updatedAt.toDate(),replyCount:l.replyCount||0})}),e(i)},n=>{if(n.code==="permission-denied"){e([]);return}console.error("Error in comments subscription:",n),e([])})},HE=(r,e,t)=>{const s=pe(X,"articles",r,"comments",e,"replies"),n=xe(s,Wn("createdAt","asc"));return Ee(n,i=>{const a=[];i.docs.forEach(l=>{const c=l.data();a.push({id:l.id,commentId:c.commentId,articleId:c.articleId,userId:c.userId,userName:c.userName,userProfilePicture:c.userProfilePicture,content:c.content,createdAt:c.createdAt.toDate(),updatedAt:c.updatedAt.toDate()})}),t(a)})},VE=({articleId:r,onCommentAdded:e,placeholder:t="Add a comment...",autoFocus:s=!1,className:n=""})=>{const{userProfile:i}=ve(),[a,l]=b.useState(""),[c,d]=b.useState(!1),u=b.useRef(null);b.useEffect(()=>{const p=u.current;p&&(p.style.height="auto",p.style.height=`${Math.min(p.scrollHeight,120)}px`)},[a]),b.useEffect(()=>{s&&u.current&&u.current.focus()},[s]);const h=async p=>{if(p.preventDefault(),!i){K.error("Please log in to comment");return}if(a.trim()){console.log("Submitting comment:",{articleId:r,userId:i.uid,userName:i.displayName||"Anonymous",userProfilePicture:i.profilePicture,content:a.trim()}),d(!0);try{await BE(r,i.uid,i.displayName||"Anonymous",i.profilePicture,a),l(""),K.success("Comment added!"),e==null||e()}catch(m){console.error("Error adding comment:",m),K.error("Failed to add comment")}finally{d(!1)}}},f=p=>{p.key==="Enter"&&!p.shiftKey&&(p.preventDefault(),h(p))};return i?o.jsxs("form",{onSubmit:h,className:`flex items-start space-x-3 ${n}`,children:[o.jsx("div",{className:"flex-shrink-0",children:i.profilePicture?o.jsx("img",{src:i.profilePicture,alt:i.displayName||"User",className:"w-8 h-8 rounded-full object-cover border-2 border-gray-200 hover:border-blue-300 transition-colors"}):o.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-r from-blue-500 to-purple-600 flex items-center justify-center shadow-md",children:o.jsx(_e,{className:"h-4 w-4 text-white"})})}),o.jsxs("div",{className:"flex-1 relative",children:[o.jsx("textarea",{ref:u,value:a,onChange:p=>l(p.target.value),onKeyDown:f,placeholder:t,disabled:c,className:"w-full px-4 py-3 pr-12 border border-gray-200 rounded-2xl resize-none focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-blue-300 disabled:opacity-50 disabled:cursor-not-allowed text-sm bg-gray-50/50 hover:bg-white transition-all duration-200 shadow-sm",style:{minHeight:"44px",maxHeight:"120px"}}),a.trim()&&o.jsx("button",{type:"submit",disabled:c,className:"absolute right-3 top-1/2 transform -translate-y-1/2 p-2 text-blue-600 hover:text-blue-700 hover:bg-blue-50 rounded-full disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 hover:scale-110",children:c?o.jsx("div",{className:"w-4 h-4 border-2 border-current border-t-transparent rounded-full animate-spin"}):o.jsx(Sn,{className:"h-4 w-4"})})]})]}):o.jsx("div",{className:`flex items-center justify-center p-4 bg-gray-50 rounded-lg ${n}`,children:o.jsx("p",{className:"text-gray-600 text-sm",children:"Please log in to comment"})})},qE=({articleId:r,commentId:e,onReplyAdded:t,onCancel:s,placeholder:n="Write a reply...",autoFocus:i=!0,className:a=""})=>{const{userProfile:l}=ve(),[c,d]=b.useState(""),[u,h]=b.useState(!1),f=b.useRef(null);b.useEffect(()=>{const g=f.current;g&&(g.style.height="auto",g.style.height=`${Math.min(g.scrollHeight,120)}px`)},[c]),b.useEffect(()=>{i&&f.current&&f.current.focus()},[i]);const p=async g=>{if(g.preventDefault(),!l){K.error("Please log in to reply");return}if(c.trim()){h(!0);try{await UE(r,e,l.uid,l.displayName||"Anonymous",l.profilePicture,c),d(""),K.success("Reply added!"),t==null||t()}catch{K.error("Failed to add reply")}finally{h(!1)}}},m=g=>{g.key==="Enter"&&!g.shiftKey?(g.preventDefault(),p(g)):g.key==="Escape"&&(s==null||s())};return l?o.jsx("div",{className:`mt-3 ${a}`,children:o.jsxs("form",{onSubmit:p,className:"flex items-start space-x-3",children:[o.jsx("div",{className:"flex-shrink-0",children:l.profilePicture?o.jsx("img",{src:l.profilePicture,alt:l.displayName||"User",className:"w-6 h-6 rounded-full object-cover border border-gray-200"}):o.jsx("div",{className:"w-6 h-6 rounded-full bg-gradient-to-r from-blue-500 to-purple-600 flex items-center justify-center",children:o.jsx(_e,{className:"h-3 w-3 text-white"})})}),o.jsxs("div",{className:"flex-1",children:[o.jsx("textarea",{ref:f,value:c,onChange:g=>d(g.target.value),onKeyDown:m,placeholder:n,disabled:u,className:"w-full px-3 py-2 border border-gray-200 rounded-lg resize-none focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:opacity-50 disabled:cursor-not-allowed text-sm",style:{minHeight:"36px",maxHeight:"120px"}}),o.jsxs("div",{className:"flex items-center justify-end space-x-2 mt-2",children:[o.jsx("button",{type:"button",onClick:s,className:"px-3 py-1 text-sm text-gray-600 hover:text-gray-800 transition-colors",children:"Cancel"}),o.jsx("button",{type:"submit",disabled:!c.trim()||u,className:"px-3 py-1 bg-blue-600 text-white text-sm rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:u?"Replying...":"Reply"})]})]})]})}):null},KE=({reply:r,articleId:e,onReplyDeleted:t})=>{const{userProfile:s,isAdmin:n}=ve(),[i,a]=b.useState(!1),l=s&&(s.uid===r.userId||n),c=async()=>{if(l&&window.confirm("Are you sure you want to delete this reply?")){a(!0);try{await WE(e,r.commentId,r.id),K.success("Reply deleted"),t==null||t()}catch{K.error("Failed to delete reply")}finally{a(!1)}}};return o.jsxs("div",{className:"flex items-start space-x-3 py-3 hover:bg-gray-50/50 rounded-lg px-2 -mx-2 transition-colors duration-200",children:[o.jsx("div",{className:"flex-shrink-0",children:r.userProfilePicture?o.jsx("img",{src:r.userProfilePicture,alt:r.userName,className:"w-6 h-6 rounded-full object-cover border border-gray-200 hover:border-blue-300 transition-colors"}):o.jsx("div",{className:"w-6 h-6 rounded-full bg-gradient-to-r from-blue-500 to-purple-600 flex items-center justify-center shadow-sm",children:o.jsx(_e,{className:"h-3 w-3 text-white"})})}),o.jsxs("div",{className:"flex-1 min-w-0",children:[o.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[o.jsx("span",{className:"font-semibold text-sm text-gray-900 hover:text-blue-600 transition-colors cursor-pointer",children:r.userName}),o.jsxs("span",{className:"text-xs text-gray-500 bg-gray-100 px-2 py-0.5 rounded-full",children:[Ht(r.createdAt)," ago"]})]}),o.jsx("p",{className:"text-sm text-gray-800 break-words leading-relaxed",children:r.content})]}),l&&o.jsx("button",{onClick:c,disabled:i,className:"flex-shrink-0 p-1.5 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded-full transition-all duration-200 disabled:opacity-50 hover:scale-110",title:"Delete reply",children:i?o.jsx("div",{className:"w-3 h-3 border border-current border-t-transparent rounded-full animate-spin"}):o.jsx(Tr,{className:"h-3 w-3"})})]})},GE=({comment:r,articleId:e,onCommentDeleted:t})=>{const{userProfile:s,isAdmin:n}=ve(),[i,a]=b.useState([]),[l,c]=b.useState(!1),[d,u]=b.useState(!1),[h,f]=b.useState(!1),[p,m]=b.useState(!1),g=s&&(s.uid===r.userId||n);b.useEffect(()=>l?(m(!0),HE(e,r.id,k=>{a(k),m(!1)})):void 0,[l,e,r.id]);const y=async()=>{if(g&&window.confirm("Are you sure you want to delete this comment and all its replies?")){f(!0);try{await zE(e,r.id),K.success("Comment deleted"),t==null||t()}catch{K.error("Failed to delete comment")}finally{f(!1)}}},x=()=>{u(!1),l||c(!0)},S=()=>{c(!l)};return o.jsxs("div",{className:"py-4 border-b border-gray-100/60 last:border-b-0 hover:bg-gradient-to-r hover:from-blue-50/30 hover:to-purple-50/20 rounded-xl px-3 -mx-3 transition-all duration-300",children:[o.jsxs("div",{className:"flex items-start space-x-3",children:[o.jsx("div",{className:"flex-shrink-0",children:r.userProfilePicture?o.jsx("img",{src:r.userProfilePicture,alt:r.userName,className:"w-8 h-8 rounded-full object-cover border-2 border-gray-200 hover:border-blue-300 transition-colors shadow-sm"}):o.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-r from-blue-500 to-purple-600 flex items-center justify-center shadow-md hover:shadow-lg transition-shadow",children:o.jsx(_e,{className:"h-4 w-4 text-white"})})}),o.jsxs("div",{className:"flex-1 min-w-0",children:[o.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[o.jsx("span",{className:"font-semibold text-gray-900 hover:text-blue-600 transition-colors cursor-pointer",children:r.userName}),o.jsxs("span",{className:"text-sm text-gray-500 bg-gray-100 px-2 py-1 rounded-full",children:[Ht(r.createdAt)," ago"]})]}),o.jsx("p",{className:"text-gray-800 break-words mb-3 leading-relaxed",children:r.content}),o.jsxs("div",{className:"flex items-center space-x-4 text-sm",children:[o.jsx("button",{onClick:()=>u(!d),className:"text-gray-600 hover:text-blue-600 font-medium transition-colors hover:scale-105 transform",children:"Reply"}),r.replyCount>0&&o.jsxs("button",{onClick:S,className:"flex items-center space-x-1 text-gray-600 hover:text-blue-600 font-medium transition-all duration-200 hover:scale-105 transform",children:[o.jsx(Io,{className:"h-3 w-3"}),o.jsxs("span",{children:[r.replyCount," ",r.replyCount===1?"reply":"replies"]}),l?o.jsx(O0,{className:"h-3 w-3"}):o.jsx(Ro,{className:"h-3 w-3"})]})]})]}),g&&o.jsx("button",{onClick:y,disabled:h,className:"flex-shrink-0 p-2 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded-full transition-all duration-200 disabled:opacity-50 hover:scale-110",title:"Delete comment",children:h?o.jsx("div",{className:"w-4 h-4 border border-current border-t-transparent rounded-full animate-spin"}):o.jsx(Tr,{className:"h-4 w-4"})})]}),d&&o.jsx("div",{className:"ml-11 mt-3",children:o.jsx(qE,{articleId:e,commentId:r.id,onReplyAdded:x,onCancel:()=>u(!1)})}),l&&o.jsx("div",{className:"ml-11 mt-3 space-y-2",children:p?o.jsx("div",{className:"flex items-center justify-center py-4",children:o.jsx("div",{className:"w-5 h-5 border-2 border-blue-600 border-t-transparent rounded-full animate-spin"})}):i.length>0?i.map(C=>o.jsx(KE,{reply:C,articleId:e,onReplyDeleted:()=>{}},C.id)):o.jsx("p",{className:"text-sm text-gray-500 py-2",children:"No replies yet"})})]})},YE=({comments:r,articleId:e,loading:t=!1,onCommentDeleted:s})=>t?o.jsx("div",{className:"space-y-4",children:[...Array(3)].map((n,i)=>o.jsx("div",{className:"animate-pulse",children:o.jsxs("div",{className:"flex items-start space-x-3",children:[o.jsx("div",{className:"w-8 h-8 bg-gray-200 rounded-full"}),o.jsxs("div",{className:"flex-1 space-y-2",children:[o.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/4"}),o.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"})]})]})},i))}):r.length===0?o.jsxs("div",{className:"text-center py-8",children:[o.jsx(Io,{className:"h-12 w-12 text-gray-300 mx-auto mb-4"}),o.jsx("p",{className:"text-gray-500",children:"No comments yet. Be the first to comment!"})]}):o.jsx("div",{className:"space-y-0",children:r.map(n=>o.jsx(GE,{comment:n,articleId:e,onCommentDeleted:s},n.id))}),JE=({articleId:r,isOpen:e,onToggle:t,className:s=""})=>{const[n,i]=b.useState([]),[a,l]=b.useState(!0),[c,d]=b.useState(0),u=b.useRef(null);b.useEffect(()=>r?(l(!0),zm(r,m=>{i(m),d(m.length),l(!1)})):void 0,[r]),b.useEffect(()=>{if(e&&u.current){const g=u.current.getBoundingClientRect().top+window.pageYOffset-100;window.scrollTo({top:g,behavior:"smooth"})}},[e]);const h=()=>{},f=()=>{};return o.jsx("div",{ref:u,className:`transition-all duration-500 ease-out transform ${e?"opacity-100 max-h-screen translate-y-0 scale-100":"opacity-0 max-h-0 overflow-hidden translate-y-4 scale-95"} ${s}`,children:o.jsxs("div",{className:"bg-white/95 backdrop-blur-sm rounded-2xl border border-gray-200/50 shadow-lg shadow-gray-200/20",children:[o.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-100/80 bg-gradient-to-r from-blue-50/30 to-purple-50/30",children:[o.jsxs("div",{className:"flex items-center space-x-3",children:[o.jsx("div",{className:"p-2 bg-gradient-to-r from-blue-500 to-purple-600 rounded-lg",children:o.jsx(Io,{className:"h-4 w-4 text-white"})}),o.jsxs("h3",{className:"text-lg font-semibold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:["Comments",c>0&&o.jsxs("span",{className:"ml-2 text-sm font-normal text-gray-500",children:["(",c,")"]})]})]}),o.jsx("button",{onClick:t,className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-white/60 rounded-lg transition-all duration-200 hover:scale-105",title:"Close comments",children:o.jsx(et,{className:"h-5 w-5"})})]}),o.jsx("div",{className:"p-6 border-b border-gray-100/80 bg-gradient-to-r from-gray-50/30 to-blue-50/20",children:o.jsx(VE,{articleId:r,onCommentAdded:h,placeholder:"Add a comment..."})}),o.jsx("div",{className:"p-6 max-h-96 overflow-y-auto scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100",children:o.jsx(YE,{comments:n,articleId:r,loading:a,onCommentDeleted:f})})]})})},XE=({commentCount:r,onClick:e,className:t=""})=>o.jsxs("button",{onClick:e,className:`group flex items-center space-x-2 px-3 py-2 text-gray-600 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-all duration-200 hover:scale-105 ${t}`,"data-comment-button":!0,children:[o.jsx(Io,{className:"h-4 w-4 group-hover:animate-pulse"}),o.jsx("span",{className:"text-sm font-medium",children:r>0?`${r} Comment${r!==1?"s":""}`:"Comment"})]}),QE=r=>{const[e,t]=b.useState(!1),[s,n]=b.useState(0);b.useEffect(()=>r?zm(r,d=>{n(d.length)}):void 0,[r]);const i=()=>{t(!e)},a=()=>{t(!0)},l=()=>{t(!1)};return b.useEffect(()=>{const c=d=>{const u=d.target;e&&!u.closest("[data-comment-section]")&&(u.closest("button[data-comment-button]")||l())};if(e)return document.addEventListener("mousedown",c),()=>document.removeEventListener("mousedown",c)},[e]),{isOpen:e,commentCount:s,toggle:i,open:a,close:l}},ZE=r=>{try{let n=(decodeURIComponent(r).split("/").pop()||"").split("?")[0].replace(/^temp_/,"");const i=n.split("_");if(i.length>=2){const a=i[i.length-1];if(/^\d{13,}\.[\w]+$/.test(a)){let d=i.slice(0,-1).join("_");const u=a.split(".").pop();return d=d.replace(/_/g," ").replace(/\s+/g," ").trim(),`${d}.${u}`}}return n.replace(/_/g," ").replace(/\s+/g," ").trim()||"Download"}catch(e){return console.error("Error extracting filename:",e),"Download"}},eA=()=>{var F,U,P;const{id:r}=Il(),e=Tt();zn();const{userProfile:t,canEditArticle:s,canReadArticle:n,loading:i}=ve(),[a,l]=b.useState(null),[c,d]=b.useState(null),[u,h]=b.useState(!0),[f,p]=b.useState(!1),[m,g]=b.useState(!1),[y,x]=b.useState(0),[S,C]=b.useState(!1),[k,j]=b.useState(!1),[O,N]=b.useState(!1),[w,v]=b.useState(!1),[M,E]=b.useState(""),L=QE((a==null?void 0:a.id)||"");b.useEffect(()=>{r&&!i&&I(r)},[r,i]);const I=async _=>{var Y;h(!0);try{const Z=await _o(_);if(Z){if(Z.status!=="published"){if(!t&&!i){K.error("Authentication required to view this article"),e("/dashboard");return}if(t&&!n(Z.status,Z.authorId)){K.error("Article not found or not accessible"),e("/dashboard");return}}if(l(Z),x(Z.likes||0),g(((Y=Z.likedBy)==null?void 0:Y.includes((t==null?void 0:t.uid)||""))||!1),!f&&Z.status==="published")try{const J=he(X,"articles",_);await qe(J,{views:rs(1)}),p(!0)}catch(J){console.error("Error incrementing views:",J)}}else K.error("Article not found"),e("/dashboard")}catch{K.error("Error loading article"),e("/dashboard")}finally{h(!1)}};b.useEffect(()=>{if(!r)return;const _=he(X,"articles",r),Y=Ee(_,Z=>{var J,te;if(Z.exists()){const be=Z.data(),ht={...be,createdAt:be.createdAt.toDate(),updatedAt:be.updatedAt.toDate(),publishedAt:(J=be.publishedAt)==null?void 0:J.toDate()};l(ht),x(ht.likes||0),g(((te=ht.likedBy)==null?void 0:te.includes((t==null?void 0:t.uid)||""))||!1)}else K.error("This article has been removed"),e("/dashboard")},Z=>{if(Z.code==="permission-denied"){e("/dashboard");return}console.error("Error in article subscription:",Z),K.error("Error loading article"),e("/dashboard")});return()=>Y()},[r,t==null?void 0:t.uid]),b.useEffect(()=>{if(!(a!=null&&a.authorId))return;const _=he(X,"users",a.authorId),Y=Ee(_,Z=>{var J,te;if(Z.exists()){const be=Z.data(),ht={uid:a.authorId,email:be.email||"",displayName:be.displayName||"",role:be.role||"user",emailVerified:be.emailVerified||!1,profilePicture:be.profilePicture||"",createdAt:(J=be.createdAt)==null?void 0:J.toDate(),updatedAt:(te=be.updatedAt)==null?void 0:te.toDate(),requestedWriterAccess:be.requestedWriterAccess||!1};d(ht)}else d(null)},Z=>{Z.code!=="permission-denied"&&console.error(`Error subscribing to author profile ${a.authorId}:`,Z),d(null)});return()=>Y()},[a==null?void 0:a.authorId]);const W=_=>t?s(_.authorId,_.status):!1,H=_=>t?t.role==="admin"||t.role==="infowriter"&&t.uid===_.authorId:!1,R=async()=>{if(!(!a||!t||!H(a))){v(!0);try{const Y=t.uid===a.authorId?"Article deleted by author":M.trim()||"Article removed by administrator",{deleteArticleByRole:Z}=await Ue(async()=>{const{deleteArticleByRole:J}=await Promise.resolve().then(()=>Xl);return{deleteArticleByRole:J}},void 0);await Z(a.id,t.role,t.uid,a.authorId,c==null?void 0:c.role,Y),K.success("Article deleted successfully"),N(!1),E(""),t.role==="admin"?e("/admin"):e("/my-articles")}catch(_){console.error("Error deleting article:",_),K.error("Failed to delete article")}finally{v(!1)}}},A=async()=>{if(!t){K.error("Please log in to like articles");return}if(!(!a||S)){C(!0);try{const _=he(X,"articles",a.id),Y=t.uid,Z=a.likedBy||[];m?await qe(_,{likes:rs(-1),likedBy:Z.filter(J=>J!==Y)}):await qe(_,{likes:rs(1),likedBy:[...Z,Y]})}catch(_){console.error("Error toggling like:",_),K.error("Failed to update like")}finally{C(!1)}}};return u?o.jsx("div",{className:"flex items-center justify-center min-h-64",children:o.jsx("div",{className:"animate-spin h-8 w-8 border-2 border-blue-500 border-t-transparent rounded-full"})}):a?o.jsxs(o.Fragment,{children:[o.jsx("style",{children:`
        /* Custom Image Layout Styles for Article View */
        .prose .custom-image {
          cursor: pointer;
          border-radius: 8px;
          transition: all 0.2s ease;
          height: auto;
          box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .prose .custom-image:hover {
          transform: translateY(-2px);
          box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        /* Enhanced prose styling */
        .prose h2 {
          margin-top: 2.5rem;
          margin-bottom: 1.5rem;
          position: relative;
        }

        .prose h2::before {
          content: '';
          position: absolute;
          left: -1rem;
          top: 50%;
          transform: translateY(-50%);
          width: 4px;
          height: 1.5rem;
          background: linear-gradient(to bottom, #3b82f6, #8b5cf6);
          border-radius: 2px;
        }

        .prose p {
          margin-bottom: 1.5rem;
        }

        .prose ul, .prose ol {
          margin-bottom: 1.5rem;
        }

        .prose li {
          margin-bottom: 0.5rem;
        }

        /* Full Column Width Layout */
        .prose .image-full-column {
          max-width: calc(100% + 32px);
          width: auto;
          display: block;
          margin: 16px -16px;
          border-radius: 8px;
        }

        /* Outset Layout - extends beyond column boundaries */
        .prose .image-outset {
          max-width: 120%;
          width: auto;
          display: block;
          margin: 16px auto;
          margin-left: -10%;
          margin-right: -10%;
        }

        /* Full Screen Width Layout - Constrained to content area */
        .prose .image-full-screen {
          width: calc(100% + 32px);
          max-width: calc(100% + 32px);
          display: block;
          margin: 16px -16px;
          border-radius: 8px;
          box-sizing: border-box;
        }

        /* Image Grid Layouts */
        .prose .image-grid-item {
          display: inline-block;
          margin: 4px;
          border-radius: 8px;
          vertical-align: top;
        }

        /* 2-image grid */
        .prose .image-grid-item:nth-child(2n) {
          width: calc(50% - 8px);
        }

        /* 3-image grid */
        .prose .image-grid-item:nth-child(3n) {
          width: calc(33.333% - 8px);
        }

        /* 4+ image grid */
        .prose .image-grid-item:nth-child(4n) {
          width: calc(25% - 8px);
        }

        /* Grid container */
        .prose .image-grid-container {
          display: flex;
          flex-wrap: wrap;
          gap: 8px;
          margin: 16px 0;
          justify-content: center;
        }

        /* Responsive grid adjustments */
        @media (max-width: 768px) {
          .prose .image-outset {
            max-width: 100%;
            margin-left: 0;
            margin-right: 0;
          }

          .prose .image-full-screen {
            width: 100%;
            margin-left: 0;
            margin-right: 0;
            padding: 0;
          }

          .prose .image-grid-item:nth-child(n) {
            width: calc(50% - 8px);
          }
        }

        @media (max-width: 480px) {
          .prose .image-grid-item:nth-child(n) {
            width: 100%;
            margin: 4px 0;
          }
        }

        /* Professional Document Styling */
        .prose {
          font-family: 'Georgia', 'Times New Roman', serif;
          color: #1a1a1a;
          max-width: none;
          overflow-wrap: break-word;
          word-wrap: break-word;
          word-break: break-word;
        }

        .prose p {
          margin-bottom: 1.5em;
          text-align: left;
          line-height: 1.8;
          font-size: 18px;
        }

        .prose h1, .prose h2, .prose h3, .prose h4, .prose h5, .prose h6 {
          font-family: 'Helvetica Neue', 'Arial', sans-serif;
          font-weight: 600;
          color: #111827;
          margin-top: 2.5em;
          margin-bottom: 1em;
          line-height: 1.3;
        }

        .prose h1 {
          font-size: 2.25rem;
          border-bottom: 2px solid #e5e7eb;
          padding-bottom: 0.5rem;
        }

        .prose h2 {
          font-size: 1.875rem;
        }

        .prose h3 {
          font-size: 1.5rem;
        }

        .prose blockquote {
          border-left: 4px solid #3b82f6;
          padding-left: 1.5rem;
          margin: 2rem 0;
          font-style: italic;
          color: #4b5563;
          background-color: #f8fafc;
          padding: 1.5rem;
          border-radius: 0.5rem;
        }

        .prose ul, .prose ol {
          margin: 1.5rem 0;
          padding-left: 2rem;
        }

        .prose li {
          margin: 0.75rem 0;
          line-height: 1.7;
        }

        /* Image Caption Styles - now handled by JavaScript processor */
        .prose .image-figure-container {
          margin: 24px auto;
          text-align: center;
          display: block;
        }

        .prose .image-caption-text {
          margin-top: 16px;
          margin-bottom: 24px;
          font-size: 0.9rem;
          color: #6b7280;
          font-style: italic;
          line-height: 1.5;
          text-align: center;
          max-width: 700px;
          margin-left: auto;
          margin-right: auto;
          padding: 0 24px;
          box-sizing: border-box;
          font-family: 'Helvetica Neue', 'Arial', sans-serif;
        }

        /* Prose content styling for text visibility and alignment */
        .prose {
          color: #374151;
          line-height: 1.75;
          max-width: none;
          margin: 0 auto;
        }

        .prose p {
          margin-top: 1.25em;
          margin-bottom: 1.25em;
          color: #374151;
          text-align: left;
        }

        .prose h1, .prose h2, .prose h3, .prose h4, .prose h5, .prose h6 {
          color: #111827;
          font-weight: 600;
          line-height: 1.25;
          margin-top: 2em;
          margin-bottom: 1em;
        }

        .prose h1 { font-size: 2.25em; }
        .prose h2 { font-size: 1.875em; }
        .prose h3 { font-size: 1.5em; }
        .prose h4 { font-size: 1.25em; }

        .prose ul, .prose ol {
          margin-top: 1.25em;
          margin-bottom: 1.25em;
          padding-left: 1.625em;
          color: #374151;
        }

        .prose li {
          margin-top: 0.5em;
          margin-bottom: 0.5em;
        }

        .prose blockquote {
          font-style: italic;
          border-left: 4px solid #e5e7eb;
          padding-left: 1em;
          margin: 1.6em 0;
          color: #6b7280;
        }

        .prose code {
          background-color: #f3f4f6;
          padding: 0.125em 0.25em;
          border-radius: 0.25em;
          font-size: 0.875em;
          color: #dc2626;
        }

        .prose pre {
          background-color: #1f2937;
          color: #f9fafb;
          padding: 1em;
          border-radius: 0.5em;
          overflow-x: auto;
          margin: 1.5em 0;
        }

        .prose pre code {
          background-color: transparent;
          color: inherit;
          padding: 0;
        }

        .prose a {
          color: #2563eb;
          text-decoration: underline;
        }

        .prose a:hover {
          color: #1d4ed8;
        }

        .prose strong {
          font-weight: 600;
          color: #111827;
        }

        .prose em {
          font-style: italic;
        }

        /* Content Overflow Prevention */
        .prose * {
          max-width: 100%;
          overflow-wrap: break-word;
          word-wrap: break-word;
        }

        .prose img {
          max-width: 100% !important;
          height: auto !important;
          object-fit: contain;
        }

        .prose table {
          width: 100%;
          max-width: 100%;
          overflow-x: auto;
          display: block;
          white-space: nowrap;
        }

        .prose table tbody {
          display: table;
          width: 100%;
        }

        .prose pre {
          max-width: 100%;
          overflow-x: auto;
          white-space: pre-wrap;
          word-wrap: break-word;
        }

        .prose code {
          word-break: break-all;
          white-space: pre-wrap;
        }

        .prose iframe,
        .prose video,
        .prose embed,
        .prose object {
          max-width: 100% !important;
          height: auto !important;
        }

        /* Long URLs and links */
        .prose a {
          word-break: break-all;
          overflow-wrap: break-word;
        }

        /* Figure and image containers */
        .prose figure {
          max-width: 100%;
          overflow: hidden;
        }

        .prose figure img {
          max-width: 100%;
          height: auto;
        }

        /* Responsive Design for Mobile Devices */
        @media (max-width: 768px) {
          .prose {
            font-size: 16px;
            line-height: 1.7;
            overflow-x: hidden;
          }

          .prose h1 {
            font-size: 1.875rem;
          }

          .prose h2 {
            font-size: 1.5rem;
          }

          .prose h3 {
            font-size: 1.25rem;
          }

          .prose p {
            text-align: left;
            margin-bottom: 1.25em;
          }

          .prose blockquote {
            padding: 1rem;
            margin: 1.5rem 0;
          }

          .prose .image-caption-text {
            padding: 0 16px;
            font-size: 0.85rem;
          }

          .prose table {
            font-size: 14px;
            display: block;
            overflow-x: auto;
            white-space: nowrap;
            max-width: 100%;
          }

          .prose pre {
            font-size: 14px;
            padding: 0.75rem;
            overflow-x: auto;
            max-width: 100%;
          }

          .prose code {
            font-size: 13px;
            word-break: break-all;
          }
        }

        @media (max-width: 480px) {
          .prose {
            font-size: 15px;
            overflow-x: hidden;
            max-width: 100vw;
          }

          .prose h1 {
            font-size: 1.5rem;
            word-break: break-word;
          }

          .prose h2 {
            font-size: 1.25rem;
            word-break: break-word;
          }

          .prose .image-caption-text {
            padding: 0 12px;
          }

          .prose table {
            font-size: 12px;
            max-width: calc(100vw - 2rem);
          }

          .prose pre {
            font-size: 12px;
            max-width: calc(100vw - 2rem);
            padding: 0.5rem;
          }

          .prose img {
            max-width: calc(100vw - 2rem) !important;
          }

          .prose a {
            word-break: break-all;
            hyphens: auto;
          }
        }

        /* Legacy image styles for backward compatibility */
        .prose img:not(.custom-image) {
          border-radius: 8px;
          max-width: 100%;
          height: auto;
          display: block;
          margin: 12px auto;
        }
      `}),o.jsxs("div",{className:"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8",children:[o.jsxs("div",{className:"flex items-center justify-between mb-8",children:[o.jsxs("button",{onClick:()=>{window.history.length>1?e(-1):e("/")},className:"flex items-center space-x-2 text-gray-600 hover:text-gray-900 transition-colors hover:bg-gray-50 px-3 py-2 rounded-lg",children:[o.jsx(Lt,{className:"h-4 w-4"}),o.jsx("span",{children:"Back"})]}),o.jsxs("div",{className:"flex items-center space-x-3",children:[o.jsx(cf,{article:a}),o.jsx(FE,{articleId:a.id,articleTitle:a.title,showLabel:!0}),W(a)&&o.jsxs(le,{to:`/article/edit/${a.id}`,className:"flex items-center space-x-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors",children:[o.jsx(Wl,{className:"h-4 w-4"}),o.jsx("span",{children:"Edit"})]}),H(a)&&o.jsxs("button",{onClick:()=>N(!0),className:"flex items-center space-x-2 px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg transition-colors",children:[o.jsx(Tr,{className:"h-4 w-4"}),o.jsx("span",{children:"Delete"})]})]})]}),o.jsxs("article",{className:"bg-white/90 backdrop-blur-sm rounded-2xl overflow-hidden border border-gray-200 shadow-xl hover:shadow-2xl transition-shadow duration-300",children:[a.coverImage&&o.jsx("div",{className:"aspect-video bg-gray-100 overflow-hidden",children:o.jsx("img",{src:a.coverImage,alt:a.title,className:"w-full h-full object-cover"})}),o.jsxs("div",{className:"p-8 lg:p-12",children:[a.status!=="published"&&o.jsx("div",{className:"mb-6",children:o.jsx("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${a.status==="draft"?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:a.status==="draft"?"Draft":"Unpublished"})}),o.jsx("h1",{className:"text-5xl lg:text-6xl font-bold bg-gradient-to-r from-[#1D4ED8] via-[#7C3AED] to-[#EC4899] bg-clip-text text-transparent mb-8 leading-tight tracking-tight",children:a.title}),o.jsxs("div",{className:"flex items-start justify-between mb-8",children:[o.jsx("div",{className:"flex items-center space-x-4",children:o.jsxs(le,{to:`/author/${a.authorId}`,className:"flex items-center space-x-3 hover:bg-gray-50 rounded-lg p-2 -m-2 transition-colors group",children:[c!=null&&c.profilePicture?o.jsx("img",{src:c.profilePicture,alt:c.displayName||a.authorName,className:"w-12 h-12 rounded-full object-cover border-2 border-gray-200 group-hover:border-blue-300 transition-colors"}):o.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-r from-blue-500 to-purple-600 flex items-center justify-center group-hover:from-blue-600 group-hover:to-purple-700 transition-all",children:o.jsx(_e,{className:"h-6 w-6 text-white"})}),o.jsxs("div",{children:[o.jsx("p",{className:"font-medium text-gray-900 group-hover:text-blue-600 transition-colors",children:(c==null?void 0:c.displayName)||a.authorName}),o.jsx("p",{className:"text-sm text-gray-600 capitalize",children:c!=null&&c.role?c.role==="infowriter"||c.role==="admin"?"InfoWriter":c.role:"Author"})]})]})}),o.jsxs("div",{className:"flex items-center space-x-3",children:[o.jsx(XE,{commentCount:L.commentCount,onClick:L.toggle,className:"data-comment-button"}),o.jsxs("button",{onClick:A,disabled:S,className:`flex items-center space-x-2 px-3 py-2 rounded-lg transition-colors ${m?"text-red-600 hover:text-red-700 hover:bg-red-50":"text-gray-600 hover:text-red-600 hover:bg-red-50"}`,children:[o.jsx(vh,{className:`h-4 w-4 ${m?"fill-current":""}`}),o.jsx("span",{className:"text-sm",children:y})]})]})]}),o.jsxs("div",{className:"flex flex-wrap items-center gap-6 mb-8 text-sm text-gray-600 bg-gray-50 rounded-lg p-4",children:[o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx(Us,{className:"h-4 w-4"}),o.jsxs("span",{children:["Updated: ",Ii(a.updatedAt,"dd/MM/yyyy")]})]}),o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx(us,{className:"h-4 w-4"}),o.jsxs("span",{children:[a.views||0," views"]})]})]}),(a.categories.length>0||a.tags.length>0)&&o.jsx("div",{className:"mb-6",children:o.jsxs("div",{className:"flex flex-wrap items-center gap-6",children:[a.categories.length>0&&o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx(Ci,{className:"h-4 w-4 text-gray-500"}),o.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Categories:"})]}),o.jsx("div",{className:"flex flex-wrap gap-2",children:a.categories.map(_=>o.jsx("span",{className:"px-3 py-1 border border-[#1D4ED8] text-[#1D4ED8] rounded-full text-sm font-medium hover:text-[#1D4ED8]/80 transition-colors",children:_},_))})]}),a.tags.length>0&&o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx(hs,{className:"h-4 w-4 text-gray-500"}),o.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Tags:"})]}),o.jsx("div",{className:"flex flex-wrap gap-2",children:a.tags.map(_=>o.jsxs("span",{className:"px-3 py-1 border border-[#7C3AED] text-[#7C3AED] rounded-full text-sm hover:text-[#7C3AED]/80 transition-colors",children:["#",_]},_))})]})]})}),o.jsx("div",{className:"w-full pt-4 pb-8 px-4 overflow-hidden",children:o.jsx("div",{className:"prose prose-lg max-w-none mx-auto prose-headings:text-gray-900 prose-p:text-gray-700 prose-strong:text-gray-900 prose-code:text-purple-600 prose-code:bg-purple-50 prose-pre:bg-gray-900 prose-blockquote:border-blue-500 prose-blockquote:bg-blue-50",style:{fontSize:"18px",lineHeight:"1.8",letterSpacing:"0.01em",overflowWrap:"break-word",wordWrap:"break-word",maxWidth:"100%"},dangerouslySetInnerHTML:{__html:Um(a.content)}})}),(a.attachments&&a.attachments.length>0||a.attachmentMetadata&&a.attachmentMetadata.length>0)&&o.jsxs("div",{className:"mt-8 pt-6 border-t border-gray-200",children:[o.jsxs("button",{onClick:()=>j(!k),className:"flex items-center justify-between w-full mb-4 p-2 -m-2 rounded-lg hover:bg-gray-50 focus:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 transition-all duration-200 group","aria-expanded":k,"aria-controls":"attachments-content","aria-label":`${k?"Collapse":"Expand"} attachments section`,children:[o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx(gi,{className:"h-5 w-5 text-blue-600"}),o.jsxs("h3",{className:"text-lg font-semibold text-gray-900 group-hover:text-blue-700 transition-colors",children:["Attachments (",((F=a.attachmentMetadata)==null?void 0:F.length)||((U=a.attachments)==null?void 0:U.length)||0,")"]})]}),o.jsx(Ro,{className:`h-5 w-5 text-gray-500 transition-transform duration-300 ease-in-out ${k?"rotate-180":"rotate-0"}`})]}),o.jsx("div",{id:"attachments-content",className:`overflow-hidden transition-all duration-300 ease-in-out ${k?"max-h-screen opacity-100":"max-h-0 opacity-0"}`,style:{transitionProperty:"max-height, opacity, margin",marginTop:"0"},children:o.jsx("div",{className:`space-y-3 transition-all duration-300 ease-in-out ${k?"pb-2 pt-1":"pb-0 pt-0"}`,children:a.attachmentMetadata&&a.attachmentMetadata.length>0?a.attachmentMetadata.map((_,Y)=>o.jsxs("a",{href:_.url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center space-x-3 p-4 bg-gradient-to-r from-blue-50 to-purple-50 hover:from-blue-100 hover:to-purple-100 rounded-xl border border-blue-100 hover:border-blue-200 transition-all duration-200 group",children:[o.jsx("div",{className:"flex-shrink-0 w-10 h-10 bg-gradient-to-r from-blue-500 to-purple-600 rounded-lg flex items-center justify-center group-hover:from-blue-600 group-hover:to-purple-700 transition-all",children:o.jsx(gi,{className:"h-5 w-5 text-white"})}),o.jsxs("div",{className:"flex-1 min-w-0",children:[o.jsx("span",{className:"text-sm font-medium text-gray-900 group-hover:text-blue-700 transition-colors block truncate",children:_.originalName}),o.jsxs("span",{className:"text-xs text-gray-500",children:[_.size?`${(_.size/1024/1024).toFixed(2)} MB • `:"","Click to download"]})]})]},Y)):(P=a.attachments)==null?void 0:P.map((_,Y)=>o.jsxs("a",{href:_,target:"_blank",rel:"noopener noreferrer",className:"flex items-center space-x-3 p-4 bg-gradient-to-r from-blue-50 to-purple-50 hover:from-blue-100 hover:to-purple-100 rounded-xl border border-blue-100 hover:border-blue-200 transition-all duration-200 group",children:[o.jsx("div",{className:"flex-shrink-0 w-10 h-10 bg-gradient-to-r from-blue-500 to-purple-600 rounded-lg flex items-center justify-center group-hover:from-blue-600 group-hover:to-purple-700 transition-all",children:o.jsx(gi,{className:"h-5 w-5 text-white"})}),o.jsxs("div",{className:"flex-1 min-w-0",children:[o.jsx("span",{className:"text-sm font-medium text-gray-900 group-hover:text-blue-700 transition-colors block truncate",children:ZE(_)}),o.jsx("span",{className:"text-xs text-gray-500",children:"Click to download"})]})]},Y))})})]})]})]}),a&&o.jsx("div",{className:"mt-8","data-comment-section":!0,children:o.jsx(JE,{articleId:a.id,isOpen:L.isOpen,onToggle:L.toggle})})]}),O&&o.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:o.jsxs("div",{className:"bg-white rounded-lg max-w-md w-full p-6",children:[o.jsxs("div",{className:"flex items-center mb-4",children:[o.jsx(Ai,{className:"h-6 w-6 text-red-600 mr-3"}),o.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Delete Article"})]}),o.jsxs("p",{className:"text-gray-600 mb-4",children:['Are you sure you want to delete "',a==null?void 0:a.title,'"? This action cannot be undone.']}),(t==null?void 0:t.role)==="admin"&&t.uid!==(a==null?void 0:a.authorId)&&o.jsxs("div",{className:"mb-4",children:[o.jsx("label",{htmlFor:"deleteNote",className:"block text-sm font-medium text-gray-700 mb-2",children:"Deletion Note (optional)"}),o.jsx("textarea",{id:"deleteNote",value:M,onChange:_=>E(_.target.value),placeholder:"Provide a reason for deletion (will be sent to the author)...",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500 resize-none",rows:3,maxLength:500}),o.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[M.length,"/500 characters"]})]}),o.jsxs("div",{className:"flex justify-end space-x-3",children:[o.jsx("button",{onClick:()=>{N(!1),E("")},disabled:w,className:"px-4 py-2 text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors disabled:opacity-50",children:"Cancel"}),o.jsxs("button",{onClick:R,disabled:w,className:"px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg transition-colors disabled:opacity-50 flex items-center space-x-2",children:[w?o.jsx("div",{className:"h-4 w-4 animate-spin border-2 border-white border-t-transparent rounded-full"}):o.jsx(Ai,{className:"h-4 w-4"}),o.jsx("span",{children:"Delete Article"})]})]})]})})]}):o.jsxs("div",{className:"text-center py-12",children:[o.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Article not found"}),o.jsx(le,{to:"/dashboard",className:"text-blue-600 hover:text-blue-700 font-medium",children:"Return to Dashboard"})]})},tA=()=>{const{userProfile:r,isInfoWriter:e,isAdmin:t,loading:s,canCreateArticles:n}=ve(),[i,a]=Qu(),l=Tt(),[c,d]=b.useState([]),[u,h]=b.useState([]),[f,p]=b.useState(!1),[m,g]=b.useState(""),[y,x]=b.useState("all"),[S,C]=b.useState(null),[k,j]=b.useState(null);b.useEffect(()=>{const I=i.get("status");I&&["draft","published","unpublished","archive"].includes(I)?x(I):x("all")},[i]);const O=s||!r&&!s,N=r&&!s&&n===!1,w=r&&!s&&n===!0;b.useEffect(()=>{if(!w||!(r!=null&&r.uid))return;p(!0);const I=xe(pe(X,"articles"),Oe("authorId","==",r.uid)),W=Ee(I,H=>{const R=[];H.forEach(A=>{var U,P,_;const F=A.data();R.push({id:A.id,...F,createdAt:((U=F.createdAt)==null?void 0:U.toDate())||new Date,updatedAt:((P=F.updatedAt)==null?void 0:P.toDate())||new Date,publishedAt:(_=F.publishedAt)==null?void 0:_.toDate()})}),R.sort((A,F)=>F.createdAt.getTime()-A.createdAt.getTime()),d(R),p(!1)},H=>{console.error("Error loading articles:",H),K.error("Error loading articles"),p(!1)});return()=>W()},[w,r==null?void 0:r.uid]),b.useEffect(()=>{v()},[c,m,y]),b.useEffect(()=>{const I=W=>{if(S){const H=W.target,R=document.querySelector(`[data-dropdown-id="${S}"]`),A=document.querySelector(`[data-dropdown-button="${S}"]`);R&&!R.contains(H)&&A&&!A.contains(H)&&C(null)}};return document.addEventListener("mousedown",I),()=>{document.removeEventListener("mousedown",I)}},[S]);const v=()=>{let I=c;if(y!=="all"&&(I=I.filter(W=>W.status===y)),m.trim()){const W=m.toLowerCase();I=I.filter(H=>H.title.toLowerCase().includes(W)||H.excerpt.toLowerCase().includes(W)||H.categories.some(R=>R.toLowerCase().includes(W))||H.tags.some(R=>R.toLowerCase().includes(W)))}h(I)},M=I=>{a(I==="all"?{}:{status:I})},E=async(I,W)=>{if(console.log(`Changing article ${I} status to ${W}`),!(r!=null&&r.uid)){K.error("You must be logged in to update articles");return}if(!n){K.error("You don't have permission to update articles");return}j(I);try{const H={status:W};W==="published"&&(H.publishedAt=new Date),console.log("Calling updateArticle with:",{id:I,updateData:H}),await $o(I,H),console.log("Article updated successfully, updating local state"),d(A=>A.map(F=>F.id===I?{...F,status:W,publishedAt:W==="published"?new Date:F.publishedAt}:F));const R=W==="published"?"published":W==="unpublished"?"marked as unpublished":W==="archive"?"archived":"saved as draft";K.success(`Article ${R} successfully`)}catch(H){console.error("Error updating article status:",H),K.error(`Error updating article status: ${H instanceof Error?H.message:"Unknown error"}`)}finally{j(null),C(null)}},L=I=>{C(S===I?null:I)};return O?o.jsx("div",{className:"min-h-screen flex items-center justify-center",children:o.jsxs("div",{className:"text-center",children:[o.jsxs("div",{className:"relative",children:[o.jsx(Ve,{className:"h-16 w-16 text-blue-600 animate-spin mx-auto mb-6"}),o.jsx(Sr,{className:"h-6 w-6 text-blue-400 absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2"})]}),o.jsx("h2",{className:"text-2xl font-semibold text-gray-900 mb-2",children:"Verifying Access"}),o.jsx("p",{className:"text-gray-600 max-w-md mx-auto",children:"Checking your InfoWriter permissions and loading your articles..."}),o.jsxs("div",{className:"mt-4 flex items-center justify-center space-x-2",children:[o.jsx("div",{className:"h-2 w-2 bg-blue-600 rounded-full animate-bounce",style:{animationDelay:"0ms"}}),o.jsx("div",{className:"h-2 w-2 bg-blue-600 rounded-full animate-bounce",style:{animationDelay:"150ms"}}),o.jsx("div",{className:"h-2 w-2 bg-blue-600 rounded-full animate-bounce",style:{animationDelay:"300ms"}})]})]})}):N?o.jsx("div",{className:"min-h-screen flex items-center justify-center",children:o.jsxs("div",{className:"text-center max-w-md mx-auto p-8",children:[o.jsx("div",{className:"bg-red-100 p-6 rounded-full w-20 h-20 mx-auto mb-6 flex items-center justify-center",children:o.jsx(St,{className:"h-10 w-10 text-red-600"})}),o.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"InfoWriter Access Required"}),o.jsxs("p",{className:"text-gray-600 mb-6",children:["You need InfoWriter privileges to create and manage articles.",(r==null?void 0:r.role)==="user"&&" Apply for InfoWriter access to get started."]}),o.jsxs("div",{className:"space-y-3",children:[(r==null?void 0:r.role)==="user"&&o.jsx(le,{to:"/writer-request",className:"block w-full px-6 py-3 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-xl font-medium hover:from-blue-700 hover:to-purple-700 transition-all",children:"Apply for InfoWriter Access"}),o.jsx(le,{to:"/dashboard",className:"block w-full px-6 py-3 bg-gray-100 text-gray-700 rounded-xl font-medium hover:bg-gray-200 transition-colors",children:"Return to Dashboard"})]})]})}):w?o.jsxs("div",{className:"space-y-6",children:[o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{children:[o.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[o.jsx("button",{onClick:()=>l(e&&!t?"/":"/dashboard"),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",title:e&&!t?"Back to Home":"Back to Dashboard",children:o.jsx(Lt,{className:"h-5 w-5 text-gray-600"})}),o.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"My Articles"})]}),o.jsx("p",{className:"text-gray-600",children:"Create, edit, and manage your documentation"})]}),o.jsxs(le,{to:"/article/new",className:"flex items-center space-x-2 bg-gradient-to-r from-blue-600 to-purple-600 text-white px-6 py-3 rounded-xl font-medium hover:from-blue-700 hover:to-purple-700 transition-all shadow-lg hover:shadow-xl",children:[o.jsx(za,{className:"h-4 w-4"}),o.jsx("span",{children:"New Article"})]})]}),o.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl p-6 border border-gray-200",children:o.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[o.jsx("div",{className:"flex-1",children:o.jsx(vs,{variant:"minimal",placeholder:"Search my articles...",onResultClick:()=>{},filterByCurrentUser:!0})}),o.jsxs("div",{className:"relative",children:[o.jsx(_0,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),o.jsxs("select",{value:y,onChange:I=>x(I.target.value),className:"pl-10 pr-8 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent appearance-none bg-white",children:[o.jsx("option",{value:"all",children:"All Status"}),o.jsx("option",{value:"draft",children:"Draft"}),o.jsx("option",{value:"published",children:"Published"}),o.jsx("option",{value:"unpublished",children:"Unpublished"}),o.jsx("option",{value:"archive",children:"Archive"})]})]})]})}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[o.jsxs("button",{onClick:()=>M("all"),className:`bg-white/80 backdrop-blur-sm rounded-xl p-4 border transition-all duration-200 text-left hover:shadow-md hover:scale-105 ${y==="all"?"border-blue-300 bg-blue-50":"border-gray-200"}`,children:[o.jsx("div",{className:"text-2xl font-bold text-gray-900",children:c.length}),o.jsx("div",{className:"text-sm text-gray-600",children:"Total Articles"})]}),o.jsxs("button",{onClick:()=>M("published"),className:`bg-white/80 backdrop-blur-sm rounded-xl p-4 border transition-all duration-200 text-left hover:shadow-md hover:scale-105 ${y==="published"?"border-green-300 bg-green-50":"border-green-200"}`,children:[o.jsx("div",{className:"text-2xl font-bold text-green-700",children:c.filter(I=>I.status==="published").length}),o.jsx("div",{className:"text-sm text-green-600",children:"Published"})]}),o.jsxs("button",{onClick:()=>M("draft"),className:`bg-white/80 backdrop-blur-sm rounded-xl p-4 border transition-all duration-200 text-left hover:shadow-md hover:scale-105 ${y==="draft"?"border-yellow-300 bg-yellow-50":"border-yellow-200"}`,children:[o.jsx("div",{className:"text-2xl font-bold text-yellow-700",children:c.filter(I=>I.status==="draft").length}),o.jsx("div",{className:"text-sm text-yellow-600",children:"Drafts"})]}),o.jsxs("button",{onClick:()=>M("unpublished"),className:`bg-white/80 backdrop-blur-sm rounded-xl p-4 border transition-all duration-200 text-left hover:shadow-md hover:scale-105 ${y==="unpublished"?"border-red-300 bg-red-50":"border-red-200"}`,children:[o.jsx("div",{className:"text-2xl font-bold text-red-700",children:c.filter(I=>I.status==="unpublished").length}),o.jsx("div",{className:"text-sm text-red-600",children:"Unpublished"})]}),o.jsxs("button",{onClick:()=>M("archive"),className:`bg-white/80 backdrop-blur-sm rounded-xl p-4 border transition-all duration-200 text-left hover:shadow-md hover:scale-105 ${y==="archive"?"border-purple-300 bg-purple-50":"border-purple-200"}`,children:[o.jsx("div",{className:"text-2xl font-bold text-purple-700",children:c.filter(I=>I.status==="archive").length}),o.jsx("div",{className:"text-sm text-purple-600",children:"Archive"})]})]}),f?o.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl p-12 border border-gray-200",children:o.jsxs("div",{className:"text-center",children:[o.jsx(Ve,{className:"h-12 w-12 text-blue-600 animate-spin mx-auto mb-4"}),o.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Loading Your Articles"}),o.jsx("p",{className:"text-gray-600",children:"Fetching your latest articles and drafts..."})]})}):u.length===0?o.jsxs("div",{className:"text-center py-12 bg-white/80 backdrop-blur-sm rounded-2xl border border-gray-200",children:[o.jsx("div",{className:"text-6xl mb-4",children:"📝"}),o.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:c.length===0?"No articles yet":"No articles match your filters"}),o.jsx("p",{className:"text-gray-600 mb-6",children:c.length===0?"Start creating your first article to share knowledge with your team.":"Try adjusting your search or filter criteria."}),c.length===0&&o.jsxs(le,{to:"/article/new",className:"inline-flex items-center space-x-2 bg-gradient-to-r from-blue-600 to-purple-600 text-white px-6 py-3 rounded-xl font-medium hover:from-blue-700 hover:to-purple-700 transition-all",children:[o.jsx(za,{className:"h-4 w-4"}),o.jsx("span",{children:"Create First Article"})]})]}):o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:u.map(I=>o.jsxs("div",{className:"relative",children:[o.jsx(Ns,{article:I,variant:"default",showStatus:!0,showActions:!0,showEditButton:!0}),o.jsxs("div",{className:"absolute top-4 right-4 flex items-center space-x-2",children:[I.status==="draft"&&o.jsx("button",{onClick:()=>E(I.id,"published"),disabled:k===I.id,className:"p-2 text-gray-600 hover:text-green-600 hover:bg-green-50 rounded-lg transition-colors disabled:opacity-50 bg-white/90 backdrop-blur-sm shadow-sm",title:"Publish Article",children:k===I.id?o.jsx(jt,{className:"h-4 w-4 animate-spin"}):o.jsx(Sn,{className:"h-4 w-4"})}),o.jsxs("div",{className:"relative",children:[o.jsx("button",{onClick:()=>L(I.id),"data-dropdown-button":I.id,className:"p-2 text-gray-600 hover:text-gray-800 hover:bg-gray-50 rounded-lg transition-colors bg-white/90 backdrop-blur-sm shadow-sm",title:"More Actions",children:o.jsx(jh,{className:"h-4 w-4"})}),S===I.id&&o.jsx("div",{"data-dropdown-id":I.id,className:"absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-gray-200 z-10",children:o.jsxs("div",{className:"py-1",children:[I.status!=="published"&&o.jsxs("button",{onClick:W=>{W.stopPropagation(),E(I.id,"published")},disabled:k===I.id,className:"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-green-50 hover:text-green-700 flex items-center space-x-2 disabled:opacity-50",children:[o.jsx(Sn,{className:"h-4 w-4"}),o.jsx("span",{children:"Publish"})]}),I.status!=="draft"&&o.jsxs("button",{onClick:W=>{W.stopPropagation(),E(I.id,"draft")},disabled:k===I.id,className:"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-yellow-50 hover:text-yellow-700 flex items-center space-x-2 disabled:opacity-50",children:[o.jsx(gt,{className:"h-4 w-4"}),o.jsx("span",{children:"Save as Draft"})]}),I.status==="published"&&o.jsxs("button",{onClick:W=>{W.stopPropagation(),E(I.id,"unpublished")},disabled:k===I.id,className:"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-red-50 hover:text-red-700 flex items-center space-x-2 disabled:opacity-50",children:[o.jsx(zs,{className:"h-4 w-4"}),o.jsx("span",{children:"Unpublish"})]}),(I.status==="published"||I.status==="unpublished"||I.status==="draft")&&o.jsxs("button",{onClick:W=>{W.stopPropagation(),E(I.id,"archive")},disabled:k===I.id,className:"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-purple-50 hover:text-purple-700 flex items-center space-x-2 disabled:opacity-50",children:[o.jsx(gt,{className:"h-4 w-4"}),o.jsx("span",{children:"Archive"})]})]})})]})]})]},I.id))})]}):null},rA=()=>{const{isUser:r,isInfoWriter:e,isAdmin:t,loading:s}=ve(),n=Tt(),[i,a]=b.useState(null),[l,c]=b.useState([]),[d,u]=b.useState(!0),[h,f]=b.useState(""),[p,m]=b.useState(""),g=()=>{u(!0);const x=xe(pe(X,"articles"),Oe("status","==","published"));return Ee(x,C=>{try{const k=[];C.forEach(N=>{var M,E,L;const w=N.data(),v={id:N.id,...w,createdAt:((M=w.createdAt)==null?void 0:M.toDate())||new Date,updatedAt:(E=w.updatedAt)==null?void 0:E.toDate(),publishedAt:(L=w.publishedAt)==null?void 0:L.toDate()};k.push(v)});const j=new Set,O=new Set;k.forEach(N=>{N.categories.forEach(w=>j.add(w)),N.tags.forEach(w=>O.add(w))}),a({articles:k,categories:Array.from(j).sort(),tags:Array.from(O).sort()}),u(!1)}catch(k){console.error("Error loading articles:",k),K.error("Error loading articles"),u(!1)}})};b.useEffect(()=>{if(s)return;const x=g();return()=>x()},[s]),b.useEffect(()=>{if(!i)return;let x=i.articles;h&&(x=x.filter(S=>S.categories.includes(h))),p&&(x=x.filter(S=>S.tags.includes(p))),c(x)},[i,h,p]);const y=()=>{f(""),m("")};return d||s?o.jsx("div",{className:"flex items-center justify-center min-h-screen",children:o.jsxs("div",{className:"text-center",children:[o.jsx(Ve,{className:"h-12 w-12 text-blue-600 animate-spin mx-auto mb-4"}),o.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Loading Knowledge Base"}),o.jsx("p",{className:"text-gray-600",children:s?"Authenticating...":"Loading articles and categories..."})]})}):i?o.jsxs("div",{className:"space-y-8",children:[o.jsxs("div",{className:"text-center",children:[(e||t)&&o.jsx("div",{className:"flex justify-start mb-6",children:o.jsx("button",{onClick:()=>n(t?"/my-articles":"/dashboard"),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",title:"Back to Dashboard",children:o.jsx(Lt,{className:"h-5 w-5 text-gray-600"})})}),o.jsx("h1",{className:"text-4xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent mb-4",children:"Knowledge Base"}),o.jsx("p",{className:"text-xl text-gray-600 max-w-2xl mx-auto",children:"Search and discover documentation, guides, and knowledge articles."})]}),o.jsx("div",{className:"max-w-2xl mx-auto",children:o.jsx(vs,{variant:"default",placeholder:"Search articles, categories, tags...",onResultClick:()=>{}})}),!r&&o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[o.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl p-6 border border-blue-100",children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{children:[o.jsx("p",{className:"text-sm font-medium text-blue-600",children:"Total Articles"}),o.jsx("p",{className:"text-2xl font-bold text-gray-900",children:i.articles.length})]}),o.jsx("div",{className:"bg-blue-100 p-3 rounded-xl",children:o.jsx(zt,{className:"h-6 w-6 text-blue-600"})})]})}),o.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl p-6 border border-purple-100",children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{children:[o.jsx("p",{className:"text-sm font-medium text-purple-600",children:"Categories"}),o.jsx("p",{className:"text-2xl font-bold text-gray-900",children:i.categories.length})]}),o.jsx("div",{className:"bg-purple-100 p-3 rounded-xl",children:o.jsx(Folder,{className:"h-6 w-6 text-purple-600"})})]})}),o.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl p-6 border border-green-100",children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{children:[o.jsx("p",{className:"text-sm font-medium text-green-600",children:"Tags"}),o.jsx("p",{className:"text-2xl font-bold text-gray-900",children:i.tags.length})]}),o.jsx("div",{className:"bg-green-100 p-3 rounded-xl",children:o.jsx(Tag,{className:"h-6 w-6 text-green-600"})})]})})]}),o.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl p-6 border border-gray-200",children:[o.jsxs("div",{className:"flex flex-col lg:flex-row gap-6",children:[o.jsxs("div",{className:"flex-1",children:[o.jsxs("h3",{className:"text-sm font-medium text-gray-700 mb-3 flex items-center",children:[o.jsx(Folder,{className:"h-4 w-4 mr-2"}),"Categories"]}),o.jsx("div",{className:"flex flex-wrap gap-2",children:i.categories.slice(0,10).map(x=>o.jsx("button",{onClick:()=>f(h===x?"":x),className:`px-3 py-1 rounded-full text-sm font-medium transition-colors ${h===x?"bg-blue-600 text-white":"bg-blue-100 text-blue-700 hover:bg-blue-200"}`,children:x},x))})]}),o.jsxs("div",{className:"flex-1",children:[o.jsxs("h3",{className:"text-sm font-medium text-gray-700 mb-3 flex items-center",children:[o.jsx(Tag,{className:"h-4 w-4 mr-2"}),"Tags"]}),o.jsx("div",{className:"flex flex-wrap gap-2",children:i.tags.slice(0,10).map(x=>o.jsxs("button",{onClick:()=>m(p===x?"":x),className:`px-3 py-1 rounded-full text-sm font-medium transition-colors ${p===x?"bg-gray-700 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:["#",x]},x))})]})]}),(h||p)&&o.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200",children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-600",children:[o.jsx("span",{children:"Filtering by:"}),h&&o.jsx("span",{className:"px-2 py-1 bg-blue-600 text-white rounded-full text-xs",children:h}),p&&o.jsxs("span",{className:"px-2 py-1 bg-gray-700 text-white rounded-full text-xs",children:["#",p]})]}),o.jsx("button",{onClick:y,className:"text-blue-600 hover:text-blue-700 text-sm font-medium",children:"Clear filters"})]})})]}),l.length===0?o.jsxs("div",{className:"text-center py-12 bg-white/80 backdrop-blur-sm rounded-2xl border border-gray-200",children:[o.jsx(zt,{className:"h-12 w-12 text-gray-300 mx-auto mb-4"}),o.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:i.articles.length===0?"No articles published yet":"No articles match your filters"}),o.jsx("p",{className:"text-gray-600",children:i.articles.length===0?"Check back later for new content.":"Try adjusting your filter criteria."}),(h||p)&&o.jsx("button",{onClick:y,className:"mt-4 text-blue-600 hover:text-blue-700 font-medium",children:"Clear all filters"})]}):o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:l.map(x=>o.jsx(Ns,{article:x,variant:"default",showActions:!0},x.id))})]}):o.jsx("div",{className:"flex items-center justify-center min-h-64",children:o.jsxs("div",{className:"text-center",children:[o.jsx(Ve,{className:"h-8 w-8 text-blue-600 animate-spin mx-auto mb-4"}),o.jsx("p",{className:"text-gray-600",children:"Loading search data..."})]})})},sA=()=>{const r=Date.now().toString(36),e=Math.random().toString(36).substring(2,8);return`WR-${r}-${e}`.toUpperCase()},fi=r=>r.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"").replace(/<[^>]*>/g,"").trim(),nA=async r=>{const e=xe(pe(X,"writerRequests"),Oe("userId","==",r.userId),Oe("status","==","pending"));if(!(await vt(e)).empty)throw new Error("You already have a pending InfoWriter request. Please wait for admin review.");const s=he(pe(X,"writerRequests")),n=sA(),i={...r,id:s.id,fullName:fi(r.fullName),qualifications:fi(r.qualifications),proposedTitle:fi(r.proposedTitle),briefDescription:fi(r.briefDescription),status:"pending",submittedAt:new Date,requestId:n};return await bs(s,{...i,submittedAt:Le.fromDate(i.submittedAt)}),n},iA=async r=>{let e=xe(pe(X,"writerRequests"));return e=xe(e,Wn("submittedAt","desc")),(await vt(e)).docs.map(n=>{var a;const i=n.data();return{...i,submittedAt:i.submittedAt.toDate(),processedAt:(a=i.processedAt)==null?void 0:a.toDate()}})},oA=async(r,e,t,s)=>{const n=he(X,"writerRequests",r),i=await It(n);if(!i.exists())throw new Error("Request not found");const l=i.data().userId;await qe(n,{status:e,processedAt:Le.fromDate(new Date),processedBy:t,adminNotes:s||""});try{const{createInfoWriterStatusNotification:c}=await Ue(async()=>{const{createInfoWriterStatusNotification:d}=await Promise.resolve().then(()=>$l);return{createInfoWriterStatusNotification:d}},void 0);await c(l,e,s)}catch{}},Wm=async r=>{const e=xe(pe(X,"writerRequests"),Oe("userId","==",r)),t=await vt(e);if(!t.empty){const s=t.docs.map(n=>{var a;const i=n.data();return{...i,submittedAt:i.submittedAt.toDate(),processedAt:(a=i.processedAt)==null?void 0:a.toDate()}});return s.sort((n,i)=>i.submittedAt.getTime()-n.submittedAt.getTime()),s[0]}return null},aA=["Technology & Software","Business & Management","Marketing & Sales","Finance & Accounting","Human Resources","Operations & Logistics","Customer Service","Legal & Compliance","Healthcare","Education & Training","Research & Development","Quality Assurance","Project Management","Data Analysis","Design & Creative","Other"],lA=[{value:"beginners",label:"Beginners (New to topic)"},{value:"intermediate",label:"Intermediate (Some experience)"},{value:"advanced",label:"Advanced (Expert level)"},{value:"all-levels",label:"All Levels"}],cA=({onClose:r})=>{const{userProfile:e}=ve(),[t,s]=b.useState(!1),[n,i]=b.useState(null),[a,l]=b.useState(!1),[c,d]=b.useState(null),[u,h]=b.useState({fullName:(e==null?void 0:e.displayName)||"",email:(e==null?void 0:e.email)||"",qualifications:"",areasOfInterest:[],proposedTitle:"",briefDescription:"",targetAudience:"all-levels"}),[f,p]=b.useState({}),[m,g]=b.useState(!1);b.useEffect(()=>{if(e){y();const j=e.displayName||e.email.split("@")[0]||"";h(O=>O.fullName!==j||O.email!==e.email?(console.log("🔄 Syncing profile data to request form"),O.fullName!==j&&O.fullName!==""&&(g(!0),setTimeout(()=>g(!1),2e3)),{...O,email:e.email,fullName:j}):O)}},[e]);const y=async()=>{if(e)try{const j=await Wm(e.uid);i(j),(!j||j.status!=="pending")&&l(!0)}catch(j){console.error("Error checking existing request:",j),l(!0)}},x=()=>{const j={};return u.qualifications.trim()||(j.qualifications="Qualifications are required"),u.areasOfInterest.length===0&&(j.areasOfInterest="Please select at least one area of interest"),u.proposedTitle.trim()||(j.proposedTitle="Proposed title is required"),u.briefDescription.trim()?u.briefDescription.length<250?j.briefDescription="Description must be at least 250 characters":u.briefDescription.length>500&&(j.briefDescription="Description must not exceed 500 characters"):j.briefDescription="Brief description is required",p(j),Object.keys(j).length===0},S=async j=>{if(j.preventDefault(),!(!e||!x())){s(!0);try{const O=await nA({...u,userId:e.uid});d(O),K.success("InfoWriter request submitted successfully!")}catch(O){K.error(O.message||"Error submitting request")}finally{s(!1)}}},C=j=>{h(O=>({...O,areasOfInterest:O.areasOfInterest.includes(j)?O.areasOfInterest.filter(N=>N!==j):[...O.areasOfInterest,j]}))},k=(j,O)=>{j==="fullName"||j==="email"||(h(N=>({...N,[j]:O})),f[j]&&p(N=>({...N,[j]:""})))};return c?o.jsx("div",{className:"max-w-2xl mx-auto bg-white/90 backdrop-blur-sm rounded-2xl p-8 border border-gray-200",children:o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"bg-green-100 p-4 rounded-full w-16 h-16 mx-auto mb-6 flex items-center justify-center",children:o.jsx(sr,{className:"h-8 w-8 text-green-600"})}),o.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Request Submitted Successfully!"}),o.jsx("p",{className:"text-gray-600 mb-4",children:"Your InfoWriter request has been submitted and is now under review."}),o.jsxs("div",{className:"bg-blue-50 rounded-lg p-4 mb-6",children:[o.jsxs("p",{className:"text-sm text-blue-800",children:[o.jsx("strong",{children:"Request ID:"})," ",c]}),o.jsx("p",{className:"text-sm text-blue-600 mt-1",children:"Please save this ID for tracking your request status."})]}),o.jsx("button",{onClick:r,className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white px-6 py-3 rounded-xl font-medium hover:from-blue-700 hover:to-purple-700 transition-all",children:"Close"})]})}):n&&n.status==="pending"&&(e==null?void 0:e.role)!=="infowriter"?o.jsx("div",{className:"max-w-2xl mx-auto bg-white/90 backdrop-blur-sm rounded-2xl p-8 border border-gray-200",children:o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"bg-yellow-100 p-4 rounded-full w-16 h-16 mx-auto mb-6 flex items-center justify-center",children:o.jsx(jt,{className:"h-8 w-8 text-yellow-600"})}),o.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Request Under Review"}),o.jsx("p",{className:"text-gray-600 mb-4",children:"You already have a pending InfoWriter request that is currently being reviewed by our admin team."}),o.jsxs("div",{className:"bg-yellow-50 rounded-lg p-4 mb-6",children:[o.jsxs("p",{className:"text-sm text-yellow-800",children:[o.jsx("strong",{children:"Request ID:"})," ",n.requestId]}),o.jsxs("p",{className:"text-sm text-yellow-600 mt-1",children:["Submitted on ",n.submittedAt.toLocaleDateString()]})]}),o.jsx("button",{onClick:r,className:"bg-gray-600 text-white px-6 py-3 rounded-xl font-medium hover:bg-gray-700 transition-all",children:"Close"})]})}):(e==null?void 0:e.role)==="infowriter"?o.jsx("div",{className:"max-w-2xl mx-auto bg-white/90 backdrop-blur-sm rounded-2xl p-8 border border-gray-200",children:o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"bg-green-100 p-4 rounded-full w-16 h-16 mx-auto mb-6 flex items-center justify-center",children:o.jsx(sr,{className:"h-8 w-8 text-green-600"})}),o.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Already an InfoWriter"}),o.jsx("p",{className:"text-gray-600 mb-4",children:"You already have InfoWriter privileges and can create articles."}),o.jsx("button",{onClick:r,className:"bg-blue-600 text-white px-6 py-3 rounded-xl font-medium hover:bg-blue-700 transition-all",children:"Go to Dashboard"})]})}):a?o.jsxs("div",{className:"max-w-4xl mx-auto bg-white/90 backdrop-blur-sm rounded-2xl p-8 border border-gray-200",children:[o.jsxs("div",{className:"flex items-center justify-between mb-8",children:[o.jsxs("div",{children:[o.jsx("h2",{className:"text-3xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"InfoWriter Application"}),o.jsx("p",{className:"text-gray-600 mt-2",children:"Apply to become an InfoWriter and contribute to our knowledge base"})]}),r&&o.jsx("button",{onClick:r,className:"p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-lg transition-colors",children:o.jsx(et,{className:"h-5 w-5"})})]}),o.jsxs("form",{onSubmit:S,className:"space-y-8",children:[o.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-xl p-4 mb-6",children:o.jsxs("div",{className:"flex items-start space-x-3",children:[o.jsx("div",{className:"bg-blue-100 p-2 rounded-lg",children:o.jsx(Wr,{className:"h-5 w-5 text-blue-600"})}),o.jsxs("div",{children:[o.jsx("h4",{className:"text-sm font-semibold text-blue-900 mb-1",children:"Identity Verification"}),o.jsx("p",{className:"text-sm text-blue-800",children:"Your name and email address are automatically verified through your authenticated account. This ensures the integrity of the InfoWriter application process and prevents identity fraud."}),o.jsx("p",{className:"text-xs text-blue-600 mt-2",children:"💡 You can edit your display name in your Profile settings - changes will update here automatically in real-time."})]})]})}),o.jsxs("div",{className:"space-y-6",children:[o.jsxs("h3",{className:"text-xl font-semibold text-gray-900 flex items-center",children:[o.jsx(_e,{className:"h-5 w-5 mr-2 text-blue-600"}),"Personal Information"]}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[o.jsxs("div",{children:[o.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2 flex items-center",children:[o.jsx(_e,{className:"h-4 w-4 mr-1.5 text-gray-500"}),"Full Name *",o.jsxs("div",{className:"group relative ml-2",children:[o.jsx(Gc,{className:"h-4 w-4 text-gray-400 cursor-help"}),o.jsx("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-900 text-white text-xs rounded-lg opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none whitespace-nowrap z-10",children:"Automatically taken from your account"})]})]}),o.jsxs("div",{className:"relative",children:[o.jsx(Wr,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),o.jsx("input",{type:"text",value:u.fullName,readOnly:!0,disabled:!0,className:`w-full pl-10 pr-4 py-3 border border-gray-200 rounded-xl bg-gray-50 text-gray-600 cursor-not-allowed transition-all duration-300 ${m?"ring-2 ring-green-300 bg-green-50":""}`,placeholder:"Name from your account"}),m&&o.jsx("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:o.jsx("div",{className:"bg-green-100 text-green-600 text-xs px-2 py-1 rounded-full animate-pulse",children:"Updated"})})]}),o.jsxs("p",{className:"text-xs text-gray-500 mt-1 flex items-center",children:[o.jsx(Wr,{className:"h-3 w-3 mr-1"}),"This field is automatically populated from your authenticated account",m&&o.jsx("span",{className:"ml-2 text-green-600 font-medium",children:"• Name updated from profile"})]})]}),o.jsxs("div",{children:[o.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2 flex items-center",children:[o.jsx(Wt,{className:"h-4 w-4 mr-1.5 text-gray-500"}),"Email Address *",o.jsxs("div",{className:"group relative ml-2",children:[o.jsx(Gc,{className:"h-4 w-4 text-gray-400 cursor-help"}),o.jsx("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-900 text-white text-xs rounded-lg opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none whitespace-nowrap z-10",children:"Automatically taken from your account"})]})]}),o.jsxs("div",{className:"relative",children:[o.jsx(Wr,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),o.jsx("input",{type:"email",value:u.email,readOnly:!0,disabled:!0,className:"w-full pl-10 pr-4 py-3 border border-gray-200 rounded-xl bg-gray-50 text-gray-600 cursor-not-allowed",placeholder:"Email from your account"})]}),o.jsxs("p",{className:"text-xs text-gray-500 mt-1 flex items-center",children:[o.jsx(Wr,{className:"h-3 w-3 mr-1"}),"This field is automatically populated from your authenticated account"]})]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Academic/Professional Qualifications *"}),o.jsxs("div",{className:"relative",children:[o.jsx(B0,{className:"absolute left-3 top-3 h-5 w-5 text-gray-400"}),o.jsx("textarea",{value:u.qualifications,onChange:j=>k("qualifications",j.target.value),rows:4,className:`w-full pl-10 pr-4 py-3 border rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all resize-none ${f.qualifications?"border-red-300 bg-red-50":"border-gray-300"}`,placeholder:"Describe your educational background, certifications, work experience, and relevant qualifications..."})]}),f.qualifications&&o.jsx("p",{className:"text-red-600 text-sm mt-1",children:f.qualifications})]})]}),o.jsxs("div",{className:"space-y-6",children:[o.jsxs("h3",{className:"text-xl font-semibold text-gray-900 flex items-center",children:[o.jsx(hs,{className:"h-5 w-5 mr-2 text-purple-600"}),"Areas of Interest/Expertise *"]}),o.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:aA.map(j=>o.jsx("button",{type:"button",onClick:()=>C(j),className:`p-3 text-sm rounded-lg border transition-all ${u.areasOfInterest.includes(j)?"bg-blue-100 border-blue-300 text-blue-700":"bg-white border-gray-300 text-gray-700 hover:border-blue-300 hover:bg-blue-50"}`,children:j},j))}),f.areasOfInterest&&o.jsx("p",{className:"text-red-600 text-sm",children:f.areasOfInterest})]}),o.jsxs("div",{className:"space-y-6",children:[o.jsxs("h3",{className:"text-xl font-semibold text-gray-900 flex items-center",children:[o.jsx(zt,{className:"h-5 w-5 mr-2 text-green-600"}),"Article Proposal"]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Proposed Article Title *"}),o.jsxs("div",{className:"relative",children:[o.jsx(gt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),o.jsx("input",{type:"text",value:u.proposedTitle,onChange:j=>k("proposedTitle",j.target.value),className:`w-full pl-10 pr-4 py-3 border rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all ${f.proposedTitle?"border-red-300 bg-red-50":"border-gray-300"}`,placeholder:"Enter your proposed article title"})]}),f.proposedTitle&&o.jsx("p",{className:"text-red-600 text-sm mt-1",children:f.proposedTitle})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Brief Description * (250-500 words)"}),o.jsx("textarea",{value:u.briefDescription,onChange:j=>k("briefDescription",j.target.value),rows:6,className:`w-full px-4 py-3 border rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all resize-none ${f.briefDescription?"border-red-300 bg-red-50":"border-gray-300"}`,placeholder:"Provide a detailed description of your proposed article, including key topics, objectives, and value it will bring to readers..."}),o.jsxs("div",{className:"flex justify-between items-center mt-2",children:[f.briefDescription&&o.jsx("p",{className:"text-red-600 text-sm",children:f.briefDescription}),o.jsxs("p",{className:`text-sm ml-auto ${u.briefDescription.length<250||u.briefDescription.length>500?"text-red-500":"text-green-600"}`,children:[u.briefDescription.length,"/500 words"]})]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Target Audience *"}),o.jsxs("div",{className:"relative",children:[o.jsx(Eh,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),o.jsx("select",{value:u.targetAudience,onChange:j=>k("targetAudience",j.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all appearance-none bg-white",children:lA.map(j=>o.jsx("option",{value:j.value,children:j.label},j.value))})]})]})]}),o.jsx("div",{className:"pt-6 border-t border-gray-200",children:o.jsx("button",{type:"submit",disabled:t,className:"w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white py-4 rounded-xl font-semibold text-lg hover:from-blue-700 hover:to-purple-700 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:t?o.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[o.jsx("div",{className:"animate-spin h-5 w-5 border-2 border-white border-t-transparent rounded-full"}),o.jsx("span",{children:"Submitting Request..."})]}):"Submit InfoWriter Request"})})]})]}):o.jsx("div",{className:"flex items-center justify-center min-h-64",children:o.jsx("div",{className:"animate-spin h-8 w-8 border-2 border-blue-500 border-t-transparent rounded-full"})})},Ju=()=>{const{userProfile:r,isAuthenticated:e,isAdmin:t,loading:s}=ve(),n=Tt(),[i,a]=b.useState(null),[l,c]=b.useState([]),[d,u]=b.useState(!0),[h,f]=b.useState(null),[p,m]=b.useState(null),[g,y]=b.useState("");if(b.useEffect(()=>{if(s){u(!0);return}if(!e){u(!1);return}if(!r){u(!0);return}(async()=>{u(!0);try{await x(),t&&await S()}catch(w){console.error("Error loading requests:",w),K.error("Failed to load requests")}finally{u(!1)}})()},[e,r,t,s]),b.useEffect(()=>{if(!r)return;const N=xe(pe(X,"users"),Oe("uid","==",r.uid)),w=Ee(N,v=>{v.forEach(M=>{var L,I;const E=M.data();if(E.requestedWriterAccess){const W={id:M.id,userId:E.uid||M.id,displayName:E.displayName||"Unknown User",email:E.email||"",profilePicture:E.profilePicture,requestedAt:((L=E.requestedWriterAccessAt)==null?void 0:L.toDate())||new Date,status:E.role==="infowriter"?"approved":E.writerRequestRejected?"rejected":"pending",adminNote:E.adminNote,processedAt:(I=E.writerRequestProcessedAt)==null?void 0:I.toDate(),processedBy:E.writerRequestProcessedBy,source:"legacy"};a(W)}})},v=>{v.code!=="permission-denied"&&console.error("Error in legacy writer request subscription:",v)});return()=>w()},[r]),b.useEffect(()=>{if(!t)return;const N=xe(pe(X,"writerRequests")),w=Ee(N,async E=>{await S()},E=>{if(E.code==="permission-denied"){console.warn("Permission denied for new writer requests subscription - user may not be admin");return}console.error("Error in new writer requests subscription:",E)}),v=xe(pe(X,"users"),Oe("requestedWriterAccess","==",!0)),M=Ee(v,async E=>{await S()},E=>{E.code!=="permission-denied"&&console.error("Error in legacy writer requests subscription:",E)});return()=>{w(),M()}},[t]),b.useEffect(()=>{!s&&!e&&n("/auth")},[e,n,s]),!s&&!e)return null;const x=async()=>{var N,w;if(r)try{const v=await Wm(r.uid);if(v){const L={id:v.id,userId:v.userId,displayName:v.fullName,email:v.email,requestedAt:v.submittedAt,status:v.status,adminNote:v.adminNotes,processedAt:v.processedAt,processedBy:v.processedBy,qualifications:v.qualifications,areasOfInterest:v.areasOfInterest,proposedTitle:v.proposedTitle,briefDescription:v.briefDescription,targetAudience:v.targetAudience,requestId:v.requestId,source:"new"};a(L);return}const M=he(X,"users",r.uid),E=await It(M);if(E.exists()){const L=E.data();if(L.requestedWriterAccess){const I={id:E.id,userId:L.uid||E.id,displayName:L.displayName||"Unknown User",email:L.email||"",profilePicture:L.profilePicture,requestedAt:((N=L.requestedWriterAccessAt)==null?void 0:N.toDate())||new Date,status:L.role==="infowriter"?"approved":L.writerRequestRejected?"rejected":"pending",adminNote:L.adminNote,processedAt:(w=L.writerRequestProcessedAt)==null?void 0:w.toDate(),processedBy:L.writerRequestProcessedBy,source:"legacy"};a(I)}}}catch(v){console.error("Error loading current user request:",v)}},S=async()=>{if(t)try{const N=[];(await iA()).forEach(E=>{N.push({id:E.id,userId:E.userId,displayName:E.fullName,email:E.email,requestedAt:E.submittedAt,status:E.status,adminNote:E.adminNotes,processedAt:E.processedAt,processedBy:E.processedBy,qualifications:E.qualifications,areasOfInterest:E.areasOfInterest,proposedTitle:E.proposedTitle,briefDescription:E.briefDescription,targetAudience:E.targetAudience,requestId:E.requestId,source:"new"})});const v=xe(pe(X,"users"),Oe("requestedWriterAccess","==",!0));(await vt(v)).forEach(E=>{var W,H;const L=E.data();N.some(R=>R.userId===(L.uid||E.id))||N.push({id:E.id,userId:L.uid||E.id,displayName:L.displayName||"Unknown User",email:L.email||"",profilePicture:L.profilePicture,requestedAt:((W=L.requestedWriterAccessAt)==null?void 0:W.toDate())||new Date,status:L.role==="infowriter"?"approved":L.writerRequestRejected?"rejected":"pending",adminNote:L.adminNote,processedAt:(H=L.writerRequestProcessedAt)==null?void 0:H.toDate(),processedBy:L.writerRequestProcessedBy,source:"legacy"})}),N.sort((E,L)=>L.requestedAt.getTime()-E.requestedAt.getTime()),c(N)}catch(N){console.error("Error loading all requests:",N),K.error("Failed to load requests")}},C=async(N,w)=>{if(!(!r||!t)){f(N.id);try{if(N.source==="new")await oA(N.id,w==="approve"?"approved":"rejected",r.uid,g),w==="approve"&&await m0(N.userId);else{const v=he(X,"users",N.id);w==="approve"?await qe(v,{role:"infowriter",writerRequestProcessedAt:kn(),writerRequestProcessedBy:r.uid,adminNote:g,requestedWriterAccess:!1}):await qe(v,{writerRequestRejected:!0,writerRequestProcessedAt:kn(),writerRequestProcessedBy:r.uid,adminNote:g,requestedWriterAccess:!1})}await S(),await x(),m(null),y(""),K.success(`Request ${w}d successfully!`),window.dispatchEvent(new CustomEvent("writerRequestProcessed",{detail:{requestId:N.id,action:w,userId:N.userId}}))}catch{K.error(`Failed to ${w} request`)}finally{f(null)}}},k=N=>{switch(N){case"pending":return o.jsx(jt,{className:"h-5 w-5 text-yellow-500"});case"approved":return o.jsx(sr,{className:"h-5 w-5 text-green-500"});case"rejected":return o.jsx(xi,{className:"h-5 w-5 text-red-500"});default:return o.jsx(St,{className:"h-5 w-5 text-gray-500"})}},j=N=>{switch(N){case"pending":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"approved":return"bg-green-100 text-green-800 border-green-200";case"rejected":return"bg-red-100 text-red-800 border-red-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},O=l.filter(N=>N.status==="pending");return d?o.jsx("div",{className:"min-h-screen py-8 px-4 sm:px-6 lg:px-8",style:{backgroundColor:"#EFEDFA"},children:o.jsx("div",{className:"max-w-7xl mx-auto",children:o.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:o.jsxs("div",{className:"text-center",children:[o.jsx(Ve,{className:"h-8 w-8 animate-spin text-blue-600 mx-auto mb-4"}),o.jsx("p",{className:"text-gray-600",children:"Loading requests..."})]})})})}):o.jsx("div",{className:"min-h-screen py-8 px-4 sm:px-6 lg:px-8",style:{backgroundColor:"#EFEDFA"},children:o.jsxs("div",{className:"max-w-7xl mx-auto",children:[o.jsxs("div",{className:"mb-8",children:[o.jsxs("button",{onClick:()=>n("/dashboard"),className:"flex items-center space-x-2 text-gray-600 hover:text-gray-900 transition-colors mb-4",children:[o.jsx(Lt,{className:"h-4 w-4"}),o.jsx("span",{children:"Back to Dashboard"})]}),o.jsx("div",{children:o.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:t?"InfoWriter Requests":"InfoWriter Application"})})]}),!t&&o.jsx("div",{className:"mb-8",children:o.jsx(cA,{onClose:()=>n("/dashboard")})}),t&&o.jsx("div",{className:"space-y-6",children:o.jsx("div",{className:"space-y-4",children:O.length===0?o.jsxs("div",{className:"bg-white/90 backdrop-blur-sm rounded-2xl p-8 border border-gray-200 text-center",children:[o.jsx(St,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),o.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No pending requests"}),o.jsx("p",{className:"text-gray-600",children:"All requests have been processed."})]}):O.map(N=>o.jsx("div",{className:"bg-white/90 backdrop-blur-sm rounded-2xl p-6 border border-gray-200",children:o.jsxs("div",{className:"flex items-start justify-between",children:[o.jsxs("div",{className:"flex items-start space-x-4 flex-1",children:[o.jsx("div",{className:"flex-shrink-0",children:N.profilePicture?o.jsx("img",{className:"h-12 w-12 rounded-full object-cover",src:N.profilePicture,alt:N.displayName}):o.jsx("div",{className:"h-12 w-12 rounded-full bg-blue-100 flex items-center justify-center",children:o.jsx(_e,{className:"h-6 w-6 text-blue-600"})})}),o.jsxs("div",{className:"flex-1",children:[o.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:N.displayName}),o.jsxs("div",{className:`flex items-center space-x-1 px-2 py-1 rounded-full border text-xs ${j(N.status)}`,children:[k(N.status),o.jsx("span",{className:"font-medium capitalize",children:N.status})]}),o.jsx("span",{className:"text-xs text-gray-500 bg-gray-100 px-2 py-1 rounded",children:N.source==="new"?"New System":"Legacy"})]}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3 text-sm text-gray-600 mb-3",children:[o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx(Wt,{className:"h-4 w-4"}),o.jsx("span",{children:N.email})]}),o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx(Us,{className:"h-4 w-4"}),o.jsxs("span",{children:["Submitted"," ",Ht(N.requestedAt)," ago"]})]}),N.processedAt&&o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx(jt,{className:"h-4 w-4"}),o.jsxs("span",{children:["Processed"," ",Ht(N.processedAt)," ago"]})]})]}),N.source==="new"&&o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm text-gray-600 mb-3",children:[N.proposedTitle&&o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx(gt,{className:"h-4 w-4"}),o.jsx("span",{className:"truncate",children:N.proposedTitle})]}),N.targetAudience&&o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx(Eh,{className:"h-4 w-4"}),o.jsx("span",{className:"capitalize",children:N.targetAudience.replace("-"," ")})]})]}),N.adminNote&&o.jsx("div",{className:"mt-3 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:o.jsxs("div",{className:"flex items-start space-x-2",children:[o.jsx(Nh,{className:"h-4 w-4 text-yellow-600 mt-0.5"}),o.jsxs("div",{children:[o.jsx("p",{className:"text-sm font-medium text-yellow-900",children:"Admin Note"}),o.jsx("p",{className:"text-sm text-yellow-800 mt-1",children:N.adminNote})]})]})})]})]}),o.jsxs("div",{className:"flex items-center space-x-2 ml-4",children:[o.jsxs("button",{onClick:()=>m(N),className:"flex items-center space-x-1 px-3 py-2 text-blue-600 hover:text-blue-800 hover:bg-blue-50 rounded-lg transition-colors",children:[o.jsx(us,{className:"h-4 w-4"}),o.jsx("span",{className:"text-sm",children:"View"})]}),N.status==="pending"&&o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsxs("button",{onClick:()=>C(N,"approve"),disabled:h===N.id,className:"flex items-center space-x-1 px-3 py-2 bg-green-600 text-white hover:bg-green-700 rounded-lg transition-colors disabled:opacity-50",children:[h===N.id?o.jsx(Ve,{className:"h-4 w-4 animate-spin"}):o.jsx(sr,{className:"h-4 w-4"}),o.jsx("span",{className:"text-sm",children:"Approve"})]}),o.jsxs("button",{onClick:()=>C(N,"reject"),disabled:h===N.id,className:"flex items-center space-x-1 px-3 py-2 bg-red-600 text-white hover:bg-red-700 rounded-lg transition-colors disabled:opacity-50",children:[h===N.id?o.jsx(Ve,{className:"h-4 w-4 animate-spin"}):o.jsx(xi,{className:"h-4 w-4"}),o.jsx("span",{className:"text-sm",children:"Reject"})]})]})]})]})},`${N.source}-${N.id}`))})}),p&&o.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:o.jsx("div",{className:"bg-white rounded-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:o.jsxs("div",{className:"p-6",children:[o.jsxs("div",{className:"flex items-center justify-between mb-6",children:[o.jsx("h3",{className:"text-2xl font-bold text-gray-900",children:"Request Details"}),o.jsx("button",{onClick:()=>m(null),className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",children:o.jsx(et,{className:"h-6 w-6"})})]}),o.jsxs("div",{className:"space-y-6",children:[o.jsxs("div",{className:"flex items-center space-x-4 p-4 bg-gray-50 rounded-xl",children:[p.profilePicture?o.jsx("img",{className:"h-16 w-16 rounded-full object-cover",src:p.profilePicture,alt:p.displayName}):o.jsx("div",{className:"h-16 w-16 rounded-full bg-blue-100 flex items-center justify-center",children:o.jsx(_e,{className:"h-8 w-8 text-blue-600"})}),o.jsxs("div",{children:[o.jsx("h4",{className:"text-xl font-semibold text-gray-900",children:p.displayName}),o.jsx("p",{className:"text-gray-600",children:p.email}),o.jsxs("div",{className:"flex items-center space-x-3 mt-2",children:[o.jsxs("div",{className:`flex items-center space-x-1 px-2 py-1 rounded-full border text-sm ${j(p.status)}`,children:[k(p.status),o.jsx("span",{className:"font-medium capitalize",children:p.status})]}),o.jsx("span",{className:"text-sm text-gray-500 bg-gray-200 px-2 py-1 rounded",children:p.source==="new"?"New System":"Legacy System"})]})]})]}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[o.jsxs("div",{children:[o.jsx("h5",{className:"font-semibold text-gray-900 mb-3",children:"Request Information"}),o.jsxs("div",{className:"space-y-3 text-sm",children:[o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx(Us,{className:"h-4 w-4 text-gray-500"}),o.jsxs("span",{children:["Submitted:"," ",Ii(p.requestedAt,"PPP")]})]}),p.processedAt&&o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx(jt,{className:"h-4 w-4 text-gray-500"}),o.jsxs("span",{children:["Processed:"," ",Ii(p.processedAt,"PPP")]})]}),p.requestId&&o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx(hs,{className:"h-4 w-4 text-gray-500"}),o.jsxs("span",{children:["Request ID: ",p.requestId]})]})]})]}),p.source==="new"&&o.jsxs("div",{children:[o.jsx("h5",{className:"font-semibold text-gray-900 mb-3",children:"Application Details"}),o.jsxs("div",{className:"space-y-3 text-sm",children:[p.qualifications&&o.jsxs("div",{children:[o.jsx("span",{className:"font-medium text-gray-700",children:"Qualifications:"}),o.jsx("div",{className:"mt-2 p-3 bg-gray-50 rounded-lg border border-gray-200",children:o.jsx("div",{className:"text-gray-600 text-sm leading-relaxed whitespace-pre-wrap overflow-y-auto max-h-32 prose prose-sm max-w-none",style:{wordWrap:"break-word",overflowWrap:"break-word",hyphens:"auto"},children:p.qualifications})})]}),p.proposedTitle&&o.jsxs("div",{children:[o.jsx("span",{className:"font-medium text-gray-700",children:"Proposed Title:"}),o.jsx("p",{className:"text-gray-600 mt-1",children:p.proposedTitle})]}),p.targetAudience&&o.jsxs("div",{children:[o.jsx("span",{className:"font-medium text-gray-700",children:"Target Audience:"}),o.jsx("p",{className:"text-gray-600 mt-1 capitalize",children:p.targetAudience.replace("-"," ")})]})]})]})]}),p.areasOfInterest&&p.areasOfInterest.length>0&&o.jsxs("div",{children:[o.jsx("h5",{className:"font-semibold text-gray-900 mb-3",children:"Areas of Interest"}),o.jsx("div",{className:"flex flex-wrap gap-2",children:p.areasOfInterest.map((N,w)=>o.jsx("span",{className:"px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm",children:N},w))})]}),p.briefDescription&&o.jsxs("div",{children:[o.jsx("h5",{className:"font-semibold text-gray-900 mb-3",children:"Brief Description"}),o.jsx("div",{className:"p-4 bg-gray-50 rounded-lg border border-gray-200",children:o.jsx("div",{className:"text-gray-700 text-sm leading-relaxed whitespace-pre-wrap overflow-y-auto max-h-48 prose prose-sm max-w-none",style:{wordWrap:"break-word",overflowWrap:"break-word",hyphens:"auto"},children:p.briefDescription})})]}),p.adminNote&&o.jsxs("div",{children:[o.jsx("h5",{className:"font-semibold text-gray-900 mb-3",children:"Admin Note"}),o.jsx("div",{className:"p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:o.jsx("div",{className:"text-yellow-800 text-sm leading-relaxed whitespace-pre-wrap overflow-y-auto max-h-32 prose prose-sm max-w-none",style:{wordWrap:"break-word",overflowWrap:"break-word",hyphens:"auto"},children:p.adminNote})})]}),p.status==="pending"&&o.jsxs("div",{className:"border-t pt-6",children:[o.jsx("h5",{className:"font-semibold text-gray-900 mb-3",children:"Admin Actions"}),o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Admin Notes (Optional)"}),o.jsx("textarea",{value:g,onChange:N=>y(N.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Add notes about your decision..."})]}),o.jsxs("div",{className:"flex items-center space-x-4",children:[o.jsxs("button",{onClick:()=>C(p,"approve"),disabled:h===p.id,className:"flex items-center space-x-2 px-6 py-3 bg-green-600 text-white hover:bg-green-700 rounded-lg transition-colors disabled:opacity-50",children:[h===p.id?o.jsx(Ve,{className:"h-5 w-5 animate-spin"}):o.jsx(sr,{className:"h-5 w-5"}),o.jsx("span",{children:"Approve Request"})]}),o.jsxs("button",{onClick:()=>C(p,"reject"),disabled:h===p.id,className:"flex items-center space-x-2 px-6 py-3 bg-red-600 text-white hover:bg-red-700 rounded-lg transition-colors disabled:opacity-50",children:[h===p.id?o.jsx(Ve,{className:"h-5 w-5 animate-spin"}):o.jsx(xi,{className:"h-5 w-5"}),o.jsx("span",{children:"Reject Request"})]})]})]})]})]})]})})})]})})},dA=r=>({id:r.articleId,title:r.articleTitle,content:"",excerpt:r.articleExcerpt||"",status:"published",authorId:r.articleAuthorId||"",authorName:r.articleAuthor,categories:r.articleCategories||[],tags:r.articleTags||[],createdAt:r.articleUpdatedAt||r.savedAt,updatedAt:r.articleUpdatedAt||r.savedAt,publishedAt:r.articlePublishedAt||r.articleUpdatedAt||r.savedAt,slug:"",coverImage:r.articleCoverImage,views:0,shareCount:0,attachments:[]}),uA=()=>{const{userProfile:r,loading:e}=ve();Tt();const[t,s]=b.useState([]),[n,i]=b.useState([]),[a,l]=b.useState(!0),[c,d]=b.useState(null),[u,h]=b.useState("");b.useEffect(()=>{if(e)return;if(!(r!=null&&r.uid)){l(!1);return}return Rb(r.uid,m=>{s(m),i(m),l(!1)})},[r==null?void 0:r.uid,e]),b.useEffect(()=>{if(!u.trim())i(t);else{const p=t.filter(m=>m.articleTitle.toLowerCase().includes(u.toLowerCase())||m.articleAuthor.toLowerCase().includes(u.toLowerCase())||(m.articleExcerpt||"").toLowerCase().includes(u.toLowerCase())||(m.articleCategories||[]).some(g=>g.toLowerCase().includes(u.toLowerCase()))||(m.articleTags||[]).some(g=>g.toLowerCase().includes(u.toLowerCase())));i(p)}},[u,t]);const f=async p=>{if(r!=null&&r.uid){d(p);try{await lf(r.uid,p),K.success("Article removed from saved articles")}catch{K.error("Failed to remove article")}finally{d(null)}}};return e||a?o.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50 flex items-center justify-center",children:o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),o.jsx("p",{className:"mt-4 text-gray-600",children:e?"Loading...":"Loading saved articles..."})]})}):r?o.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50",children:o.jsx("div",{className:"max-w-6xl mx-auto px-4 py-8",children:o.jsxs("div",{className:"space-y-6",children:[o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{children:[o.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[o.jsx(le,{to:"/dashboard",className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:o.jsx(Lt,{className:"h-5 w-5 text-gray-600"})}),o.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"Saved Articles"})]}),o.jsx("p",{className:"text-gray-600",children:"Your personal collection of saved articles"})]}),o.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl p-4 border border-purple-100",children:o.jsxs("div",{className:"flex items-center space-x-3",children:[o.jsx("div",{className:"bg-purple-100 p-2 rounded-lg",children:o.jsx(br,{className:"h-5 w-5 text-purple-600"})}),o.jsxs("div",{children:[o.jsx("p",{className:"text-sm text-gray-600",children:"Total Saved"}),o.jsx("p",{className:"text-xl font-bold text-gray-900",children:t.length})]})]})})]}),t.length>0&&o.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl p-4 border border-gray-200",children:o.jsx(vs,{variant:"default",placeholder:"Search saved articles by title, author, category, or tag...",onResultClick:()=>{}})}),t.length===0?o.jsxs("div",{className:"text-center py-12 bg-white/80 backdrop-blur-sm rounded-2xl border border-gray-200",children:[o.jsx(br,{className:"h-12 w-12 text-gray-300 mx-auto mb-4"}),o.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No saved articles yet"}),o.jsx("p",{className:"text-gray-600 mb-4",children:"Start saving articles you want to read later or reference again."}),o.jsxs(le,{to:"/",className:"inline-flex items-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[o.jsx(zt,{className:"h-4 w-4"}),o.jsx("span",{children:"Browse Articles"})]})]}):n.length===0?o.jsxs("div",{className:"text-center py-12 bg-white/80 backdrop-blur-sm rounded-2xl border border-gray-200",children:[o.jsx(Di,{className:"h-12 w-12 text-gray-300 mx-auto mb-4"}),o.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No articles found"}),o.jsx("p",{className:"text-gray-600 mb-4",children:"Try adjusting your search terms or browse all saved articles."}),o.jsxs("button",{onClick:()=>h(""),className:"inline-flex items-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[o.jsx(br,{className:"h-4 w-4"}),o.jsx("span",{children:"Show All Saved"})]})]}):o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:n.map(p=>o.jsxs("div",{className:"relative group",children:[o.jsx(Ns,{article:dA(p),variant:"default",showActions:!0,className:"hover:border-purple-200 pb-12"}),o.jsx("button",{onClick:()=>f(p.articleId),disabled:c===p.articleId,className:"absolute top-3 right-3 p-2 text-purple-600 hover:text-red-600 hover:bg-red-50 rounded-lg transition-all duration-200 disabled:opacity-50 bg-white/95 backdrop-blur-sm shadow-md border border-purple-200 hover:border-red-200 opacity-0 group-hover:opacity-100",title:"Remove from saved articles",children:c===p.articleId?o.jsx("div",{className:"h-4 w-4 border-2 border-red-600 border-t-transparent rounded-full animate-spin"}):o.jsx(M0,{className:"h-4 w-4"})}),o.jsx("div",{className:"absolute bottom-3 left-3 right-3",children:o.jsxs("div",{className:"bg-gradient-to-r from-purple-100 to-purple-200 text-purple-800 px-3 py-1.5 rounded-lg text-xs font-medium shadow-sm border border-purple-200 flex items-center justify-center",children:[o.jsx(br,{className:"h-3 w-3 mr-1.5"}),"Saved ",Ht(p.savedAt)," ago"]})})]},p.id))})]})})}):o.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50 flex items-center justify-center",children:o.jsxs("div",{className:"text-center",children:[o.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Access Denied"}),o.jsx("p",{className:"text-gray-600 mb-6",children:"Please log in to view your saved articles."}),o.jsx(le,{to:"/login",className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Go to Login"})]})})},hA=()=>{var W,H,R,A,F;const{userProfile:r,refreshProfile:e,loading:t}=ve(),[s,n]=b.useState({displayName:"",profilePicture:"",bio:"",socialLinks:{twitter:"",linkedin:"",github:"",website:""}}),[i,a]=b.useState(!1),[l,c]=b.useState(!1),[d,u]=b.useState(0),[h,f]=b.useState(null),[p,m]=b.useState(""),[g,y]=b.useState(!1),[x,S]=b.useState(""),[C,k]=b.useState(""),[j,O]=b.useState(!1);b.useEffect(()=>{if(!r)return;const U=Y=>{var Z,J,te,be;n({displayName:Y.displayName||"",profilePicture:Y.profilePicture||"",bio:Y.bio||"",socialLinks:{twitter:((Z=Y.socialLinks)==null?void 0:Z.twitter)||"",linkedin:((J=Y.socialLinks)==null?void 0:J.linkedin)||"",github:((te=Y.socialLinks)==null?void 0:te.github)||"",website:((be=Y.socialLinks)==null?void 0:be.website)||""}}),m(Y.profilePicture||""),S(Y.displayName||"")};U(r);const P=he(X,"users",r.uid),_=Ee(P,Y=>{var Z;if(Y.exists()){const J=Y.data(),te={...r,displayName:J.displayName||"",profilePicture:J.profilePicture||"",bio:J.bio||"",socialLinks:J.socialLinks||{},updatedAt:(Z=J.updatedAt)==null?void 0:Z.toDate()};O(!0),setTimeout(()=>O(!1),2e3),!g&&!i?(U(te),console.log("📡 Real-time profile update received and applied")):console.log("📡 Real-time profile update received but not applied (user is editing)")}},Y=>{if(Y.code==="permission-denied"){console.warn("Permission denied for profile subscription - user may not be authenticated");return}console.error("Error in profile subscription:",Y)});return()=>_()},[r==null?void 0:r.uid]);const N=U=>{var Y;const P=(Y=U.target.files)==null?void 0:Y[0];if(!P||!P.type.startsWith("image/")||P.size>5*1024*1024)return;f(P);const _=new FileReader;_.onload=Z=>{var J;m((J=Z.target)==null?void 0:J.result)},_.readAsDataURL(P)},w=async()=>{if(!h||!r)return null;c(!0),u(0);try{return(await ql(h,r.uid,"profiles",P=>u(P))).url}catch(U){return console.error("Error uploading profile picture:",U),null}finally{c(!1),u(0)}},v=async U=>{var P;if(U.preventDefault(),!!r&&s.displayName.trim()){a(!0);try{let _=s.profilePicture;const Y=r.profilePicture;if(h){const te=await w();if(te)_=te;else{a(!1);return}}console.log("🔄 Updating profile:",{userId:r.uid,displayName:s.displayName,bio:s.bio,socialLinks:s.socialLinks});const Z=he(X,"users",r.uid),J={displayName:s.displayName.trim(),profilePicture:_,bio:((P=s.bio)==null?void 0:P.trim())||"",socialLinks:s.socialLinks,updatedAt:new Date};if(await qe(Z,J),console.log("✅ Profile updated successfully in Firestore"),await e(),console.log("✅ Profile refresh completed"),h&&Y&&Y!==_)try{const te=Yl(Y);te&&te.startsWith("profiles/")&&(await Kl(te),console.log("✅ Deleted old profile picture:",te))}catch(te){console.error("⚠️ Failed to delete old profile picture:",te)}n(te=>({...te,profilePicture:_})),f(null),m("")}catch(_){console.error("❌ Error updating profile:",_)}finally{a(!1)}}},M=U=>{const P=U.trim();return P?P.length<2?"Display name must be at least 2 characters long":P.length>50?"Display name cannot exceed 50 characters":/^[a-zA-Z0-9\s\-_.]+$/.test(P)?"":"Display name can only contain letters, numbers, spaces, hyphens, underscores, and periods":"Display name cannot be empty"},E=()=>{if(!r){k("User not authenticated");return}const U=M(x);if(U){k(U);return}n(P=>({...P,displayName:x.trim()})),k(""),y(!1),console.log("✅ Display name updated locally, will save when 'Save Changes' is clicked")},L=()=>{S(s.displayName||""),y(!1),k("")},I=U=>{switch(U){case"admin":return"bg-red-100 text-red-800 border-red-200";case"infowriter":return"bg-purple-100 text-purple-800 border-purple-200";default:return"bg-blue-100 text-blue-800 border-blue-200"}};return t?o.jsx("div",{className:"flex items-center justify-center min-h-64",children:o.jsx("div",{className:"animate-spin h-8 w-8 border-2 border-blue-500 border-t-transparent rounded-full"})}):r?o.jsxs("div",{className:"max-w-4xl mx-auto",children:[o.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[o.jsxs(le,{to:"/",className:"flex items-center space-x-2 text-gray-600 hover:text-blue-600 transition-colors group",children:[o.jsx(Lt,{className:"h-5 w-5 group-hover:-translate-x-1 transition-transform"}),o.jsx("span",{className:"font-medium",children:"Back to Homepage"})]}),o.jsxs(le,{to:"/",className:"flex items-center space-x-2 text-gray-600 hover:text-blue-600 transition-colors group",children:[o.jsx(Fl,{className:"h-5 w-5"}),o.jsx("span",{className:"font-medium",children:"Home"})]})]}),o.jsxs("div",{className:"bg-white/80 backdrop-blur-md rounded-2xl shadow-xl border border-gray-100 overflow-hidden",children:[o.jsxs("div",{className:"bg-gradient-to-r from-[#1D4ED8] via-[#7C3AED] to-[#EC4899] px-8 py-6",children:[o.jsx("h1",{className:"text-2xl font-bold text-white",children:"My Profile"}),o.jsx("p",{className:"text-blue-100 mt-1",children:"Manage your account information and preferences"})]}),o.jsxs("div",{className:"p-8",children:[j&&o.jsxs("div",{className:"mb-6 p-3 bg-green-50 border border-green-200 rounded-lg flex items-center space-x-2 animate-pulse",children:[o.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-ping"}),o.jsx("span",{className:"text-green-700 text-sm font-medium",children:"Profile updated in real-time"})]}),o.jsxs("form",{onSubmit:v,className:"space-y-8",children:[o.jsxs("div",{className:"flex items-start space-x-6",children:[o.jsx("div",{className:"flex-shrink-0",children:o.jsxs("div",{className:"relative",children:[o.jsx("div",{className:"w-24 h-24 rounded-full overflow-hidden bg-gray-200 border-4 border-white shadow-lg",children:p||r!=null&&r.profilePicture?o.jsx("img",{src:p||(r==null?void 0:r.profilePicture)||"",alt:"Profile",className:"w-full h-full object-cover"}):o.jsx("div",{className:"w-full h-full flex items-center justify-center bg-gradient-to-r from-blue-500 to-purple-600",children:o.jsx(_e,{className:"h-10 w-10 text-white"})})}),o.jsxs("label",{className:"absolute bottom-0 right-0 bg-blue-600 hover:bg-blue-700 text-white p-2 rounded-full cursor-pointer transition-colors shadow-lg",children:[o.jsx(D0,{className:"h-4 w-4"}),o.jsx("input",{type:"file",accept:"image/*",onChange:N,className:"hidden"})]})]})}),o.jsxs("div",{className:"flex-1",children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Profile Picture"}),o.jsx("p",{className:"text-gray-600 text-sm mb-4",children:"Upload a profile picture to personalize your account. Supported formats: JPG, PNG, GIF, WebP (max 5MB)"}),l&&o.jsxs("div",{className:"mb-4",children:[o.jsxs("div",{className:"flex items-center space-x-2 text-sm text-blue-600",children:[o.jsx(Ve,{className:"h-4 w-4 animate-spin"}),o.jsxs("span",{children:["Uploading... ",d,"%"]})]}),o.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 mt-2",children:o.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${d}%`}})})]})]})]}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Display Name *"}),o.jsxs("div",{className:"relative",children:[o.jsx(_e,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),g?o.jsxs("div",{className:"space-y-2",children:[o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx("input",{type:"text",value:x,onChange:U=>{S(U.target.value),C&&k("")},className:`flex-1 pl-10 pr-4 py-3 border rounded-xl focus:ring-2 focus:border-transparent transition-all ${C?"border-red-300 focus:ring-red-500 bg-red-50":"border-blue-300 focus:ring-blue-500"}`,placeholder:"Enter your display name",autoFocus:!0,disabled:!1,maxLength:50}),o.jsx("button",{type:"button",onClick:E,disabled:!x.trim(),className:"p-2 text-green-600 hover:bg-green-50 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:o.jsx(_l,{className:"h-4 w-4"})}),o.jsx("button",{type:"button",onClick:L,disabled:!1,className:"p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:o.jsx(et,{className:"h-4 w-4"})})]}),C&&o.jsxs("p",{className:"text-red-600 text-sm pl-10 flex items-center",children:[o.jsx(St,{className:"h-4 w-4 mr-1"}),C]}),o.jsxs("p",{className:"text-xs text-gray-500 pl-10",children:[x.length,"/50 characters"]})]}):o.jsxs("div",{className:"space-y-2",children:[o.jsxs("div",{className:"flex items-center",children:[o.jsx("input",{type:"text",value:s.displayName||"Not set",className:"flex-1 pl-10 pr-12 py-3 border border-gray-200 rounded-xl bg-gray-50 text-gray-700 cursor-not-allowed",disabled:!0}),o.jsx("button",{type:"button",onClick:()=>{S(s.displayName||""),y(!0)},className:"absolute right-3 p-1 text-gray-400 hover:text-blue-600 transition-colors",title:"Click to edit your display name",children:o.jsx(Y0,{className:"h-4 w-4"})})]}),o.jsx("p",{className:"text-xs text-gray-500 pl-10",children:"💡 Click the edit icon to change your display name. Changes will update across the entire application in real-time."})]})]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email Address"}),o.jsxs("div",{className:"relative",children:[o.jsx(Wt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),o.jsx("input",{type:"email",value:r.email,className:"w-full pl-10 pr-4 py-3 border border-gray-200 rounded-xl bg-gray-50 text-gray-500 cursor-not-allowed",disabled:!0})]}),o.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Email cannot be changed"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Role"}),o.jsxs("div",{className:"relative",children:[o.jsx(Sr,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),o.jsx("div",{className:"w-full pl-10 pr-4 py-3 border border-gray-200 rounded-xl bg-gray-50 flex items-center",children:o.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium border ${I(r.role)}`,children:r.role.charAt(0).toUpperCase()+r.role.slice(1)})})]}),o.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Role is managed by administrators"})]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Bio"}),o.jsxs("div",{className:"relative",children:[o.jsx(Nh,{className:"absolute left-3 top-3 h-5 w-5 text-gray-400"}),o.jsx("textarea",{value:s.bio,onChange:U=>n({...s,bio:U.target.value}),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all resize-none",placeholder:"Tell others about yourself...",rows:3,maxLength:100})]}),o.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[((W=s.bio)==null?void 0:W.length)||0,"/100 characters"]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-4",children:"Social Links"}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Twitter"}),o.jsxs("div",{className:"relative",children:[o.jsx(Hl,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),o.jsx("input",{type:"url",value:((H=s.socialLinks)==null?void 0:H.twitter)||"",onChange:U=>n({...s,socialLinks:{...s.socialLinks,twitter:U.target.value}}),className:"w-full pl-10 pr-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all",placeholder:"https://twitter.com/username"})]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"LinkedIn"}),o.jsxs("div",{className:"relative",children:[o.jsx(Bl,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),o.jsx("input",{type:"url",value:((R=s.socialLinks)==null?void 0:R.linkedin)||"",onChange:U=>n({...s,socialLinks:{...s.socialLinks,linkedin:U.target.value}}),className:"w-full pl-10 pr-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all",placeholder:"https://linkedin.com/in/username"})]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"GitHub"}),o.jsxs("div",{className:"relative",children:[o.jsx(bh,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),o.jsx("input",{type:"url",value:((A=s.socialLinks)==null?void 0:A.github)||"",onChange:U=>n({...s,socialLinks:{...s.socialLinks,github:U.target.value}}),className:"w-full pl-10 pr-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all",placeholder:"https://github.com/username"})]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Website"}),o.jsxs("div",{className:"relative",children:[o.jsx(wh,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),o.jsx("input",{type:"url",value:((F=s.socialLinks)==null?void 0:F.website)||"",onChange:U=>n({...s,socialLinks:{...s.socialLinks,website:U.target.value}}),className:"w-full pl-10 pr-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all",placeholder:"https://yourwebsite.com"})]})]})]}),o.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Add your social media profiles and website (optional)"})]}),o.jsx("div",{className:"flex justify-end pt-6 border-t border-gray-200",children:o.jsx("button",{type:"submit",disabled:i||l,className:"flex items-center space-x-2 bg-gradient-to-r from-blue-600 to-purple-600 text-white px-6 py-3 rounded-xl font-medium hover:from-blue-700 hover:to-purple-700 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:i?o.jsxs(o.Fragment,{children:[o.jsx(Ve,{className:"h-4 w-4 animate-spin"}),o.jsx("span",{children:"Updating..."})]}):o.jsxs(o.Fragment,{children:[o.jsx(Sh,{className:"h-4 w-4"}),o.jsx("span",{children:"Save Changes"})]})})})]})]})]})]}):o.jsxs("div",{className:"text-center py-12",children:[o.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Profile not found"}),o.jsx("p",{className:"text-gray-600",children:"Unable to load your profile information."})]})},fA=()=>{const{authorId:r}=Il(),{userProfile:e}=ve(),t=j0(r),[s,n]=b.useState([]),[i,a]=b.useState(!0),[l,c]=b.useState(!0);b.useEffect(()=>{t&&a(!1)},[t]),b.useEffect(()=>{if(!r)return;c(!0);const u=xe(pe(X,"articles"),Oe("authorId","==",r),Oe("status","==","published")),h=Ee(u,f=>{const p=[];f.forEach(m=>{var y,x,S;const g=m.data();p.push({id:m.id,...g,createdAt:((y=g.createdAt)==null?void 0:y.toDate())||new Date,updatedAt:(x=g.updatedAt)==null?void 0:x.toDate(),publishedAt:(S=g.publishedAt)==null?void 0:S.toDate()})}),p.sort((m,g)=>{const y=m.publishedAt||m.createdAt||new Date(0);return(g.publishedAt||g.createdAt||new Date(0)).getTime()-y.getTime()}),n(p),c(!1)},f=>{console.error("Error loading author articles:",f),n([]),c(!1)});return()=>h()},[r]);const d=u=>{switch(u){case"twitter":return o.jsx(Hl,{className:"h-4 w-4"});case"linkedin":return o.jsx(Bl,{className:"h-4 w-4"});case"github":return o.jsx(bh,{className:"h-4 w-4"});case"website":return o.jsx(wh,{className:"h-4 w-4"});default:return null}};return i?o.jsx("div",{className:"flex items-center justify-center min-h-64",children:o.jsx("div",{className:"animate-spin h-8 w-8 border-2 border-blue-500 border-t-transparent rounded-full"})}):t?o.jsxs("div",{className:"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8",children:[o.jsx("div",{className:"mb-6",children:o.jsxs("button",{onClick:()=>window.history.back(),className:"flex items-center space-x-2 text-gray-600 hover:text-gray-900 transition-colors",children:[o.jsx(Lt,{className:"h-4 w-4"}),o.jsx("span",{children:"Back"})]})}),o.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl border border-gray-200 overflow-hidden mb-8",children:o.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 px-8 py-12",children:o.jsxs("div",{className:"flex flex-col md:flex-row items-center md:items-start space-y-4 md:space-y-0 md:space-x-6",children:[o.jsx("div",{className:"flex-shrink-0",children:o.jsx("div",{className:"w-24 h-24 rounded-full overflow-hidden border-4 border-white shadow-lg",children:t.profilePicture?o.jsx("img",{src:t.profilePicture,alt:t.displayName,className:"w-full h-full object-cover"}):o.jsx("div",{className:"w-full h-full bg-gradient-to-r from-blue-500 to-purple-600 flex items-center justify-center",children:o.jsx(_e,{className:"h-12 w-12 text-white"})})})}),o.jsxs("div",{className:"flex-1 text-center md:text-left",children:[o.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:t.displayName||"Unknown Author"}),o.jsx("div",{className:"flex flex-wrap items-center justify-center md:justify-start gap-3 mb-4",children:o.jsx("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium border ${t.role==="admin"||t.role==="infowriter"?"bg-blue-100 text-blue-800 border-blue-200":"bg-gray-100 text-gray-800 border-gray-200"} bg-white/90`,children:t.role==="infowriter"||t.role==="admin"?"InfoWriter":t.role})}),t.bio&&o.jsx("p",{className:"text-blue-100 text-lg mb-4 max-w-2xl",children:t.bio}),t.socialLinks&&Object.entries(t.socialLinks).some(([u,h])=>h)&&o.jsx("div",{className:"flex items-center justify-center md:justify-start space-x-3",children:Object.entries(t.socialLinks).map(([u,h])=>h?o.jsx("a",{href:h,target:"_blank",rel:"noopener noreferrer",className:"p-2 bg-white/20 hover:bg-white/30 rounded-lg transition-colors",title:`${u.charAt(0).toUpperCase()+u.slice(1)}`,children:d(u)},u):null)})]})]})})}),o.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl border border-gray-200 p-8",children:[o.jsx("div",{className:"flex items-center justify-between mb-6",children:o.jsxs("h2",{className:"text-2xl font-bold text-gray-900 flex items-center",children:[o.jsx(zt,{className:"h-6 w-6 mr-2"}),"Published Articles",o.jsxs("span",{className:"ml-2 text-lg font-normal text-gray-500",children:["(",s.length,")"]})]})}),l?o.jsxs("div",{className:"flex items-center justify-center py-12",children:[o.jsx("div",{className:"animate-spin h-8 w-8 border-2 border-blue-500 border-t-transparent rounded-full"}),o.jsx("p",{className:"ml-4 text-gray-600",children:"Loading articles..."})]}):s.length===0?o.jsxs("div",{className:"text-center py-12",children:[o.jsx(zt,{className:"h-12 w-12 text-gray-300 mx-auto mb-4"}),o.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No articles yet"}),o.jsx("p",{className:"text-gray-600",children:"This author hasn't published any articles yet."})]}):o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:s.map(u=>o.jsx(Ns,{article:u,variant:"default",showActions:!!e},u.id))}),!e&&s.length>0&&o.jsx("div",{className:"mt-6 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:o.jsxs("p",{className:"text-sm text-blue-700 text-center",children:[o.jsx(le,{to:"/auth",className:"font-medium hover:underline",children:"Sign in"})," ","to like and save articles"]})})]})]})]}):o.jsxs("div",{className:"text-center py-12",children:[o.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Author not found"}),o.jsx(le,{to:"/dashboard",className:"text-blue-600 hover:text-blue-700 font-medium",children:"Return to Dashboard"})]})},pA=()=>{const{userProfile:r,isAdmin:e}=ve(),[t,s]=b.useState([]),[n,i]=b.useState(!0),[a,l]=b.useState(null),[c,d]=b.useState(null),[u,h]=b.useState(null),[f,p]=b.useState(""),[m,g]=b.useState(null);b.useEffect(()=>{if(!r||!e)return;const x=[];let S={},C={};const k=xe(pe(X,"users"),Oe("role","==","infowriter")),j=Ee(k,v=>{S={},v.forEach(M=>{var L,I;const E=M.data();S[E.uid||M.id]={id:M.id,uid:E.uid||M.id,displayName:E.displayName||"Unknown Writer",email:E.email||"",profilePicture:E.profilePicture,joinedAt:((L=E.createdAt)==null?void 0:L.toDate())||new Date,lastActive:(I=E.lastActive)==null?void 0:I.toDate()}}),w()},v=>{if(v.code==="permission-denied"){i(!1);return}console.error("Error in ActiveWriters subscription:",v),i(!1)}),O=xe(pe(X,"articles"),Oe("status","==","published")),N=Ee(O,v=>{console.log(`📊 Real-time published articles update: ${v.docs.length} published articles found`),C={},v.forEach(M=>{const E=M.data();E.authorId&&(C[E.authorId]=(C[E.authorId]||0)+1)}),w()},v=>{v.code!=="permission-denied"&&console.error("Error in articles subscription:",v)}),w=()=>{const v=[];Object.values(S).forEach(M=>{const E=C[M.uid]||0;v.push({...M,articleCount:E})}),v.sort((M,E)=>M.articleCount!==E.articleCount?E.articleCount-M.articleCount:E.joinedAt.getTime()-M.joinedAt.getTime()),console.log(`🔄 Updated writers list: ${v.length} writers with real-time published article counts`),s(v),i(!1)};return x.push(j,N),()=>{x.forEach(v=>v())}},[r,e]);const y=async(x,S)=>{if(!r){Ne.error("You must be logged in to perform this action");return}if(!S.trim()){Ne.error("Please provide a reason for removing writer privileges");return}l(x.id);try{const C=await g0(x.uid,r.uid,S.trim()),k=C.deletedArticlesCount>0?`InfoWriter privileges removed for ${x.displayName}. ${C.deletedArticlesCount} articles deleted.`:`InfoWriter privileges removed for ${x.displayName}. No articles to delete.`;Ne.success(k),g(null),p("")}catch(C){console.error("Error removing writer privileges:",C);const k=C instanceof Error?C.message:"An unexpected error occurred";Ne.error(`Failed to remove writer privileges: ${k}`)}finally{l(null)}};return e?n?o.jsx("div",{className:"min-h-screen bg-gradient-to-br from-green-50 to-emerald-50 flex items-center justify-center",children:o.jsxs("div",{className:"text-center",children:[o.jsx(Ve,{className:"h-8 w-8 animate-spin text-green-600 mx-auto mb-4"}),o.jsx("p",{className:"text-gray-600",children:"Loading active writers..."})]})}):o.jsx("div",{className:"min-h-screen bg-gradient-to-br from-green-50 to-emerald-50 py-8",children:o.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[o.jsxs("div",{className:"mb-8",children:[o.jsx("div",{className:"flex items-center space-x-4 mb-4",children:o.jsxs(le,{to:"/admin/dashboard",className:"flex items-center space-x-2 text-gray-600 hover:text-gray-900 transition-colors",children:[o.jsx(Lt,{className:"h-5 w-5"}),o.jsx("span",{children:"Back to Dashboard"})]})}),o.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Active InfoWriters"}),o.jsx("p",{className:"text-gray-600",children:"Manage users with InfoWriter privileges and their published content."})]}),t.length===0?o.jsxs("div",{className:"bg-white rounded-lg p-8 text-center",children:[o.jsx(Wa,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),o.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Active Writers"}),o.jsx("p",{className:"text-gray-600",children:"There are currently no users with InfoWriter privileges."})]}):o.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[o.jsx("div",{className:"px-6 py-4 border-b border-gray-200 bg-gray-50",children:o.jsxs("h2",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[o.jsx(Wa,{className:"h-5 w-5 mr-2 text-green-600"}),"Active Writers (",t.length,")"]})}),o.jsx("div",{className:"overflow-x-auto",children:o.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[o.jsx("thead",{className:"bg-gray-50",children:o.jsxs("tr",{children:[o.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Writer"}),o.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Email"}),o.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Articles"}),o.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Joined"}),o.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),o.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:t.map(x=>o.jsxs("tr",{className:"hover:bg-gray-50",children:[o.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:o.jsxs("div",{className:"flex items-center",children:[o.jsx("div",{className:"flex-shrink-0 h-10 w-10",children:x.profilePicture?o.jsx("img",{className:"h-10 w-10 rounded-full object-cover",src:x.profilePicture,alt:x.displayName}):o.jsx("div",{className:"h-10 w-10 rounded-full bg-blue-100 flex items-center justify-center",children:o.jsx(_e,{className:"h-5 w-5 text-blue-600"})})}),o.jsxs("div",{className:"ml-4",children:[o.jsx("div",{className:"text-sm font-medium text-gray-900",children:x.displayName}),o.jsxs("div",{className:"text-sm text-gray-500",children:["ID: ",x.uid.slice(0,8),"..."]})]})]})}),o.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:o.jsxs("div",{className:"flex items-center text-sm text-gray-900",children:[o.jsx(Wt,{className:"h-4 w-4 mr-2 text-gray-400"}),x.email]})}),o.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:o.jsxs("div",{className:"flex items-center",children:[o.jsx(gt,{className:"h-4 w-4 mr-2 text-blue-600"}),x.articleCount>0?o.jsx(le,{to:`/author/${x.uid}`,className:"text-sm font-medium text-blue-600 hover:text-blue-800 hover:underline transition-colors cursor-pointer",title:`View ${x.articleCount} published articles by ${x.displayName}`,children:x.articleCount}):o.jsx("span",{className:"text-sm font-medium text-gray-500",children:x.articleCount})]})}),o.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:o.jsxs("div",{className:"flex items-center text-sm text-gray-900",children:[o.jsx(Us,{className:"h-4 w-4 mr-2 text-gray-400"}),x.joinedAt.toLocaleDateString()]})}),o.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx("button",{onClick:()=>h(x),className:"flex items-center space-x-1 text-blue-600 hover:text-blue-800",title:"View Writer Details",children:o.jsx(us,{className:"h-4 w-4"})}),o.jsxs("button",{onClick:()=>g(x),className:"flex items-center space-x-1 text-red-600 hover:text-red-800",children:[o.jsx(ra,{className:"h-4 w-4"}),o.jsx("span",{children:"Remove Privileges"})]})]})})]},x.id))})]})})]}),u&&o.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:o.jsx("div",{className:"bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:o.jsxs("div",{className:"p-6",children:[o.jsxs("div",{className:"flex items-center justify-between mb-6",children:[o.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:"Writer Details"}),o.jsx("button",{onClick:()=>h(null),className:"text-gray-400 hover:text-gray-600",children:o.jsx(et,{className:"h-6 w-6"})})]}),o.jsxs("div",{className:"space-y-6",children:[o.jsxs("div",{className:"flex items-center space-x-4",children:[o.jsx("div",{className:"flex-shrink-0",children:u.profilePicture?o.jsx("img",{className:"h-16 w-16 rounded-full object-cover",src:u.profilePicture,alt:u.displayName}):o.jsx("div",{className:"h-16 w-16 rounded-full bg-blue-100 flex items-center justify-center",children:o.jsx(_e,{className:"h-8 w-8 text-blue-600"})})}),o.jsxs("div",{children:[o.jsx("h4",{className:"text-lg font-medium text-gray-900",children:u.displayName}),o.jsx("p",{className:"text-gray-600",children:u.email}),o.jsxs("p",{className:"text-sm text-gray-500",children:["ID: ",u.uid]})]})]}),o.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[o.jsx("div",{className:"bg-blue-50 p-4 rounded-lg",children:o.jsxs("div",{className:"flex items-center",children:[o.jsx(gt,{className:"h-5 w-5 text-blue-600 mr-2"}),o.jsxs("div",{children:[u.articleCount>0?o.jsx(le,{to:`/author/${u.uid}`,className:"text-2xl font-bold text-blue-900 hover:text-blue-700 hover:underline transition-colors cursor-pointer",title:`View all ${u.articleCount} articles by ${u.displayName}`,onClick:()=>h(null),children:u.articleCount}):o.jsx("p",{className:"text-2xl font-bold text-gray-500",children:u.articleCount}),o.jsx("p",{className:"text-sm text-blue-600",children:"Published Articles"})]})]})}),o.jsx("div",{className:"bg-green-50 p-4 rounded-lg",children:o.jsxs("div",{className:"flex items-center",children:[o.jsx(Us,{className:"h-5 w-5 text-green-600 mr-2"}),o.jsxs("div",{children:[o.jsx("p",{className:"text-sm font-bold text-green-900",children:u.joinedAt.toLocaleDateString()}),o.jsx("p",{className:"text-sm text-green-600",children:"Member Since"})]})]})})]}),o.jsxs("div",{className:"flex items-center space-x-4 pt-4 border-t",children:[u.articleCount>0&&o.jsxs(le,{to:`/author/${u.uid}`,className:"flex items-center space-x-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",onClick:()=>h(null),children:[o.jsx(L0,{className:"h-4 w-4"}),o.jsx("span",{children:"View Articles"})]}),o.jsxs("button",{onClick:()=>{h(null),g(u)},className:"flex items-center space-x-2 bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition-colors",children:[o.jsx(ra,{className:"h-4 w-4"}),o.jsx("span",{children:"Remove Privileges"})]})]})]})]})})}),m&&o.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:o.jsxs("div",{className:"bg-white rounded-lg max-w-md w-full p-6",children:[o.jsxs("div",{className:"flex items-center mb-4",children:[o.jsx(St,{className:"h-6 w-6 text-red-600 mr-3"}),o.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Remove Writer Privileges"})]}),o.jsxs("div",{className:"mb-4",children:[o.jsxs("p",{className:"text-gray-600 mb-2",children:["You are about to remove InfoWriter privileges for"," ",o.jsx("span",{className:"font-semibold",children:m.displayName}),"."]}),o.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3 mb-4",children:[o.jsx("p",{className:"text-red-800 text-sm font-medium",children:"⚠️ Warning: This action will:"}),o.jsxs("ul",{className:"text-red-700 text-sm mt-1 list-disc list-inside",children:[o.jsx("li",{children:"Remove their InfoWriter privileges"}),o.jsxs("li",{children:["Permanently delete ALL ",m.articleCount," of their articles"]}),o.jsx("li",{children:"Send them a notification with your reason"})]})]})]}),o.jsxs("div",{className:"mb-4",children:[o.jsx("label",{htmlFor:"adminNote",className:"block text-sm font-medium text-gray-700 mb-2",children:"Admin Note (Reason for removal) *"}),o.jsx("textarea",{id:"adminNote",value:f,onChange:x=>p(x.target.value),placeholder:"Please provide a reason for removing this writer's privileges...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500 resize-none",rows:3,required:!0})]}),o.jsxs("div",{className:"flex items-center justify-end space-x-3",children:[o.jsx("button",{onClick:()=>{g(null),p("")},className:"px-4 py-2 text-gray-700 bg-gray-200 rounded-lg hover:bg-gray-300 transition-colors",children:"Cancel"}),o.jsx("button",{onClick:()=>y(m,f),disabled:a===m.id||!f.trim(),className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center space-x-2",children:a===m.id?o.jsxs(o.Fragment,{children:[o.jsx(Ve,{className:"h-4 w-4 animate-spin"}),o.jsx("span",{children:"Removing..."})]}):o.jsxs(o.Fragment,{children:[o.jsx(ra,{className:"h-4 w-4"}),o.jsx("span",{children:"Remove Privileges"})]})})]})]})})]})}):o.jsx("div",{className:"min-h-screen bg-gradient-to-br from-red-50 to-pink-50 flex items-center justify-center",children:o.jsxs("div",{className:"text-center",children:[o.jsx(St,{className:"h-16 w-16 text-red-500 mx-auto mb-4"}),o.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Access Denied"}),o.jsx("p",{className:"text-gray-600",children:"You don't have permission to access this page."})]})})},mA=()=>{const{userProfile:r,isAdmin:e}=ve(),[t,s]=b.useState([]),[n,i]=b.useState(!0),[a,l]=b.useState(null),[c,d]=b.useState(null);b.useEffect(()=>{if(!r||!e)return;const h=[],f=xe(pe(X,"users")),p=Ee(f,async m=>{const g=[],y=xe(pe(X,"articles")),x=Ee(y,S=>{const C={};S.forEach(k=>{var O;const j=k.data();(O=j.author)!=null&&O.uid&&(C[j.author.uid]=(C[j.author.uid]||0)+1)}),m.forEach(k=>{var O,N,w;const j=k.data();j.previousRoles&&j.previousRoles.includes(j.uid||k.id)&&j.role!=="infowriter"&&j.privilegesRemovedAt&&g.push({id:k.id,uid:j.uid||k.id,displayName:j.displayName||"Unknown Writer",email:j.email||"",profilePicture:j.profilePicture,joinedAt:((O=j.createdAt)==null?void 0:O.toDate())||new Date,removedAt:((N=j.privilegesRemovedAt)==null?void 0:N.toDate())||new Date,removedBy:j.privilegesRemovedBy||"Unknown",articleCount:j.articleCountAtRemoval||0,lastActive:(w=j.lastActive)==null?void 0:w.toDate(),adminNote:j.adminNote||"No reason provided"})}),g.sort((k,j)=>j.removedAt.getTime()-k.removedAt.getTime()),s(g),i(!1)});h.push(x)});return h.push(p),()=>{h.forEach(m=>m())}},[r,e]);const u=async h=>{if(!r){Ne.error("You must be logged in to perform this action");return}l(h.id);try{const f=he(X,"users",h.id);await qe(f,{role:"infowriter",privilegesRestoredAt:kn(),privilegesRestoredBy:r.uid,privilegesRemovedAt:null,privilegesRemovedBy:null}),await Pl(pe(X,"notifications"),{userId:h.uid,type:"writer_privileges_restored",title:"InfoWriter Privileges Restored! 🎉",message:`Your InfoWriter privileges have been restored by an administrator. You can now create and publish articles again. Note: ${h.articleCount} previously deleted articles cannot be recovered.`,read:!1,createdAt:kn(),actionUrl:"/dashboard"}),Ne.success(`InfoWriter privileges restored for ${h.displayName}. Note: ${h.articleCount} previously deleted articles cannot be recovered.`),d(null)}catch(f){console.error("Error restoring writer privileges:",f);const p=f instanceof Error?f.message:"An unexpected error occurred";Ne.error(`Failed to restore writer privileges: ${p}`)}finally{l(null)}};return e?n?o.jsx("div",{className:"min-h-screen bg-gradient-to-br from-red-50 to-pink-50 flex items-center justify-center",children:o.jsxs("div",{className:"text-center",children:[o.jsx(Ve,{className:"h-8 w-8 animate-spin text-red-600 mx-auto mb-4"}),o.jsx("p",{className:"text-gray-600",children:"Loading removed writers..."})]})}):o.jsx("div",{className:"min-h-screen bg-gradient-to-br from-red-50 to-pink-50 py-8",children:o.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[o.jsxs("div",{className:"mb-8",children:[o.jsx("div",{className:"flex items-center space-x-4 mb-4",children:o.jsxs(le,{to:"/admin/dashboard",className:"flex items-center space-x-2 text-gray-600 hover:text-gray-900 transition-colors",children:[o.jsx(Lt,{className:"h-5 w-5"}),o.jsx("span",{children:"Back to Dashboard"})]})}),o.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Removed InfoWriters"}),o.jsx("p",{className:"text-gray-600",children:"Users who previously had InfoWriter privileges but have been demoted to regular users."})]}),t.length===0?o.jsxs("div",{className:"bg-white rounded-lg p-8 text-center",children:[o.jsx(Ha,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),o.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Removed Writers"}),o.jsx("p",{className:"text-gray-600",children:"No InfoWriter privileges have been removed yet."})]}):o.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[o.jsx("div",{className:"px-6 py-4 border-b border-gray-200 bg-gray-50",children:o.jsxs("h2",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[o.jsx(Ha,{className:"h-5 w-5 mr-2 text-red-600"}),"Removed Writers (",t.length,")"]})}),o.jsx("div",{className:"overflow-x-auto",children:o.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[o.jsx("thead",{className:"bg-gray-50",children:o.jsxs("tr",{children:[o.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Writer"}),o.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Email"}),o.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Articles"}),o.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Admin Note"}),o.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Removed"}),o.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),o.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:t.map(h=>o.jsxs("tr",{className:"hover:bg-gray-50",children:[o.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:o.jsxs("div",{className:"flex items-center",children:[o.jsx("div",{className:"flex-shrink-0 h-10 w-10",children:h.profilePicture?o.jsx("img",{className:"h-10 w-10 rounded-full object-cover opacity-75",src:h.profilePicture,alt:h.displayName}):o.jsx("div",{className:"h-10 w-10 rounded-full bg-red-100 flex items-center justify-center",children:o.jsx(_e,{className:"h-5 w-5 text-red-600"})})}),o.jsxs("div",{className:"ml-4",children:[o.jsx("div",{className:"text-sm font-medium text-gray-900",children:h.displayName}),o.jsxs("div",{className:"text-sm text-gray-500",children:["ID: ",h.uid.slice(0,8),"..."]})]})]})}),o.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:o.jsxs("div",{className:"flex items-center text-sm text-gray-900",children:[o.jsx(Wt,{className:"h-4 w-4 mr-2 text-gray-400"}),h.email]})}),o.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:o.jsxs("div",{className:"flex items-center",children:[o.jsx(gt,{className:"h-4 w-4 mr-2 text-gray-600"}),o.jsx("span",{className:"text-sm font-medium text-gray-900",children:h.articleCount}),o.jsx("span",{className:"ml-1 text-xs text-gray-500",children:"(deleted)"})]})}),o.jsx("td",{className:"px-6 py-4",children:o.jsx("div",{className:"max-w-xs",children:o.jsx("p",{className:"text-sm text-gray-900 truncate",title:h.adminNote,children:h.adminNote})})}),o.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:o.jsxs("div",{className:"flex items-center text-sm text-gray-900",children:[o.jsx(Us,{className:"h-4 w-4 mr-2 text-gray-400"}),h.removedAt.toLocaleDateString()]})}),o.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:c===h.id?o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx("button",{onClick:()=>u(h),disabled:a===h.id,className:"bg-green-600 text-white px-3 py-1 rounded text-xs hover:bg-green-700 disabled:opacity-50",children:a===h.id?o.jsx(Ve,{className:"h-3 w-3 animate-spin"}):"Confirm"}),o.jsx("button",{onClick:()=>d(null),className:"bg-gray-300 text-gray-700 px-3 py-1 rounded text-xs hover:bg-gray-400",children:"Cancel"})]}):o.jsxs("button",{onClick:()=>d(h.id),className:"flex items-center space-x-1 text-green-600 hover:text-green-800",children:[o.jsx(Po,{className:"h-4 w-4"}),o.jsx("span",{children:"Restore Privileges"})]})})]},h.id))})]})})]})]})}):o.jsx("div",{className:"min-h-screen bg-gradient-to-br from-red-50 to-pink-50 flex items-center justify-center",children:o.jsxs("div",{className:"text-center",children:[o.jsx(St,{className:"h-16 w-16 text-red-500 mx-auto mb-4"}),o.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Access Denied"}),o.jsx("p",{className:"text-gray-600",children:"You don't have permission to access this page."})]})})},Jr=class Jr{constructor(){Me(this,"pendingActions",new Map);Me(this,"STORAGE_KEY","infonest_offline_actions");Me(this,"MAX_RETRIES",3);Me(this,"isProcessing",!1);this.loadPendingActions(),this.setupNetworkListeners(),this.startSyncProcessor()}static getInstance(){return Jr.instance||(Jr.instance=new Jr),Jr.instance}setupNetworkListeners(){window.addEventListener("online",()=>{console.log("🔄 Network restored, starting offline sync"),this.processPendingActions()})}loadPendingActions(){try{const e=localStorage.getItem(this.STORAGE_KEY);e&&JSON.parse(e).forEach(s=>{this.pendingActions.set(s.id,s)})}catch(e){console.error("Failed to load pending actions:",e)}}persistActions(){try{const e=Array.from(this.pendingActions.values());localStorage.setItem(this.STORAGE_KEY,JSON.stringify(e))}catch(e){console.error("Failed to persist offline actions:",e)}}startSyncProcessor(){setInterval(()=>{navigator.onLine&&!this.isProcessing&&this.processPendingActions()},3e4)}addAction(e,t){const s=`action_${Date.now()}_${Math.random().toString(36).substring(2)}`,n={id:s,type:e,data:t,timestamp:Date.now(),retryCount:0};return this.pendingActions.set(s,n),this.persistActions(),navigator.onLine&&this.processPendingActions(),s}async processPendingActions(){if(this.isProcessing||!navigator.onLine)return;this.isProcessing=!0;const e=Array.from(this.pendingActions.values()).sort((t,s)=>t.timestamp-s.timestamp);for(const t of e)try{await this.processAction(t),this.pendingActions.delete(t.id)}catch(s){console.error("Failed to process action:",s),t.retryCount++,t.retryCount>=this.MAX_RETRIES&&this.pendingActions.delete(t.id)}this.persistActions(),this.isProcessing=!1}async processAction(e){switch(e.type){case"upload":await this.processUploadAction(e);break;case"article_save":await this.processArticleSaveAction(e);break;case"article_publish":await this.processArticlePublishAction(e);break;default:console.warn(`Unknown action type: ${e.type}`)}}async processUploadAction(e){const{uploadId:t}=e.data;t&&ge.resumeUpload(t)}async processArticleSaveAction(e){const{articleData:t}=e.data}async processArticlePublishAction(e){const{articleId:t}=e.data}getPendingActionsCount(){return this.pendingActions.size}getPendingActions(){return Array.from(this.pendingActions.values())}clearCompletedActions(){this.pendingActions.clear(),this.persistActions()}};Me(Jr,"instance");let Rl=Jr;const gA=Rl.getInstance(),xA=()=>{const[r,e]=b.useState(navigator.onLine),[t,s]=b.useState(0),[n,i]=b.useState(0);return b.useEffect(()=>{const a=()=>e(!0),l=()=>e(!1);window.addEventListener("online",a),window.addEventListener("offline",l);const c=setInterval(()=>{s(gA.getPendingActionsCount()),i(ge.getActiveUploads().length)},2e3);return()=>{window.removeEventListener("online",a),window.removeEventListener("offline",l),clearInterval(c)}},[]),r&&t===0&&n===0?null:o.jsx("div",{className:"fixed bottom-4 left-4 z-50",children:o.jsxs("div",{className:`flex items-center space-x-2 px-3 py-2 rounded-lg shadow-lg border text-sm ${r?"bg-yellow-50 text-yellow-800 border-yellow-200":"bg-red-50 text-red-800 border-red-200"}`,children:[r?o.jsxs(o.Fragment,{children:[o.jsx(Ah,{className:"h-4 w-4"}),o.jsx("span",{className:"font-medium",children:t>0||n>0?"Syncing...":"Online"})]}):o.jsxs(o.Fragment,{children:[o.jsx(fn,{className:"h-4 w-4"}),o.jsx("span",{className:"font-medium",children:"Offline"})]}),(t>0||n>0)&&o.jsx("span",{className:"text-xs bg-white/20 px-2 py-1 rounded",children:t+n})]})})},yA=()=>{const[r,e]=b.useState([]),[t,s]=b.useState([]);b.useEffect(()=>{const a=()=>{const u=ge.getUploadNotifications();e(u.slice(-3))},l=()=>{const u=ge.getActiveUploads();s(u)};a(),l();const c=u=>{const h=u.detail;e(f=>[...f.slice(-2),h]),Ne.success(h.message)};window.addEventListener("globalUploadComplete",c);const d=setInterval(()=>{l()},2e3);return()=>{window.removeEventListener("globalUploadComplete",c),clearInterval(d)}},[]);const n=a=>{e(d=>d.filter(u=>u.id!==a));const c=ge.getUploadNotifications().filter(d=>d.id!==a);localStorage.setItem("upload_notifications",JSON.stringify(c))},i=()=>{e([]),ge.clearUploadNotifications()};return r.length===0&&t.length===0?null:o.jsxs("div",{className:"fixed bottom-4 right-4 z-50 space-y-2 max-w-sm",children:[t.map(a=>o.jsx("div",{className:"bg-white border border-blue-200 rounded-lg shadow-lg p-4 animate-slide-up",children:o.jsxs("div",{className:"flex items-start space-x-3",children:[o.jsx("div",{className:"flex-shrink-0",children:o.jsx(rt,{className:"h-5 w-5 text-blue-600 animate-pulse"})}),o.jsxs("div",{className:"flex-1 min-w-0",children:[o.jsxs("p",{className:"text-sm font-medium text-gray-900 truncate",children:["Uploading ",a.fileName]}),o.jsxs("div",{className:"mt-1",children:[o.jsx("div",{className:"bg-gray-200 rounded-full h-2",children:o.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${a.percentage||0}%`}})}),o.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[Math.round(a.percentage||0),"% • ",a.speed?ge.formatSpeed(a.speed):"Calculating..."]})]})]})]})},a.id)),r.map(a=>{var l;return o.jsx("div",{className:"bg-white border border-green-200 rounded-lg shadow-lg p-4 animate-slide-up",children:o.jsxs("div",{className:"flex items-start space-x-3",children:[o.jsx("div",{className:"flex-shrink-0",children:o.jsx(sr,{className:"h-5 w-5 text-green-600"})}),o.jsxs("div",{className:"flex-1 min-w-0",children:[o.jsx("p",{className:"text-sm font-medium text-gray-900",children:a.title}),o.jsx("p",{className:"text-sm text-gray-600 truncate",children:a.message}),((l=a.context)==null?void 0:l.type)==="article"&&o.jsx("div",{className:"mt-2",children:o.jsxs("button",{onClick:()=>{var c;(c=a.context)!=null&&c.articleId&&(window.location.href=`/article/edit/${a.context.articleId}`)},className:"text-xs text-blue-600 hover:text-blue-800 flex items-center space-x-1",children:[o.jsx(gt,{className:"h-3 w-3"}),o.jsx("span",{children:"Go to Article"})]})})]}),o.jsx("button",{onClick:()=>n(a.id),className:"flex-shrink-0 text-gray-400 hover:text-gray-600",children:o.jsx(et,{className:"h-4 w-4"})})]})},a.id)}),r.length>1&&o.jsx("div",{className:"text-center",children:o.jsx("button",{onClick:i,className:"text-xs text-gray-500 hover:text-gray-700 underline",children:"Clear all notifications"})})]})},bA=()=>{ze.useEffect(()=>{const r=e=>{if((e.metaKey||e.ctrlKey)&&e.key==="k"){e.preventDefault();const t=new CustomEvent("openGlobalSearch");window.dispatchEvent(t)}};return document.addEventListener("keydown",r),()=>document.removeEventListener("keydown",r)},[])};function wA(){return bA(),o.jsx(Ym,{children:o.jsx(v0,{children:o.jsx(vA,{})})})}function vA(){const{loading:r,isAuthenticated:e,emailVerified:t}=ve();return o.jsx(w0,{children:r?o.jsx("div",{className:"min-h-screen flex items-center justify-center",style:{backgroundColor:"#EFEDFA"},children:o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"animate-spin h-8 w-8 border-2 border-blue-500 border-t-transparent rounded-full mx-auto mb-4"}),o.jsx("p",{className:"text-gray-600",children:"Loading..."})]})}):o.jsx(NA,{isAuthenticated:e,emailVerified:t})})}function NA({isAuthenticated:r,emailVerified:e}){return o.jsxs("div",{className:"App",style:{backgroundColor:"#EFEDFA",minHeight:"100vh"},children:[o.jsx(a0,{position:"top-right",toastOptions:{duration:4e3,style:{background:"#fff",color:"#374151",borderRadius:"12px",border:"1px solid #e5e7eb",boxShadow:"0 10px 15px -3px rgba(0, 0, 0, 0.1)"}}}),o.jsx(xA,{}),o.jsx(yA,{}),o.jsxs(Jm,{children:[o.jsx(me,{path:"/",element:o.jsx(Pb,{})}),o.jsx(me,{path:"/verify-email",element:o.jsx(Tb,{})}),o.jsx(me,{path:"/auth",element:r?o.jsx($e,{to:"/",replace:!0}):o.jsx(Cb,{})}),o.jsx(me,{path:"/email-verify",element:o.jsx(Db,{})}),o.jsx(me,{path:"/author/:authorId",element:o.jsx(fA,{})}),r&&e?o.jsxs(me,{path:"/*",element:o.jsx(mb,{}),children:[o.jsx(me,{path:"dashboard",element:o.jsx(rn,{children:o.jsx(_b,{})})}),o.jsx(me,{path:"article/:id",element:o.jsx(rn,{children:o.jsx(eA,{})})}),o.jsx(me,{path:"writer-request",element:o.jsx(rn,{children:o.jsx(Ju,{})})}),o.jsx(me,{path:"saved-articles",element:o.jsx(rn,{children:o.jsx(uA,{})})}),o.jsx(me,{path:"profile",element:o.jsx(rn,{children:o.jsx(hA,{})})}),o.jsx(me,{path:"search",element:o.jsx(Ps,{requiredRoles:["infowriter","admin"],children:o.jsx(rA,{})})}),o.jsx(me,{path:"article/new",element:o.jsx(Ps,{requiredRoles:["infowriter","admin"],children:o.jsx(Yu,{})})}),o.jsx(me,{path:"article/edit/:id",element:o.jsx(Ps,{requiredRoles:["infowriter","admin"],children:o.jsx(Yu,{})})}),o.jsx(me,{path:"my-articles",element:o.jsx(Ps,{requiredRoles:["infowriter","admin"],children:o.jsx(tA,{})})}),o.jsx(me,{path:"admin",element:o.jsx($e,{to:"/dashboard",replace:!0})}),o.jsx(me,{path:"admin/writer-requests",element:o.jsx(sa,{children:o.jsx(Ju,{})})}),o.jsx(me,{path:"admin/active-writers",element:o.jsx(sa,{children:o.jsx(pA,{})})}),o.jsx(me,{path:"admin/removed-writers",element:o.jsx(sa,{children:o.jsx(mA,{})})}),o.jsx(me,{path:"*",element:o.jsx($e,{to:"/dashboard",replace:!0})})]}):r&&!e?o.jsxs(o.Fragment,{children:[o.jsx(me,{path:"/dashboard",element:o.jsx($e,{to:"/email-verify",replace:!0})}),o.jsx(me,{path:"/article/*",element:o.jsx($e,{to:"/email-verify",replace:!0})}),o.jsx(me,{path:"/profile",element:o.jsx($e,{to:"/email-verify",replace:!0})}),o.jsx(me,{path:"/saved-articles",element:o.jsx($e,{to:"/email-verify",replace:!0})}),o.jsx(me,{path:"/writer-request",element:o.jsx($e,{to:"/email-verify",replace:!0})}),o.jsx(me,{path:"/search",element:o.jsx($e,{to:"/email-verify",replace:!0})}),o.jsx(me,{path:"/my-articles",element:o.jsx($e,{to:"/email-verify",replace:!0})}),o.jsx(me,{path:"/admin/*",element:o.jsx($e,{to:"/email-verify",replace:!0})})]}):o.jsxs(o.Fragment,{children:[o.jsx(me,{path:"/dashboard",element:o.jsx($e,{to:"/auth",replace:!0})}),o.jsx(me,{path:"/article/*",element:o.jsx($e,{to:"/auth",replace:!0})}),o.jsx(me,{path:"/profile",element:o.jsx($e,{to:"/auth",replace:!0})}),o.jsx(me,{path:"/saved-articles",element:o.jsx($e,{to:"/auth",replace:!0})}),o.jsx(me,{path:"/writer-request",element:o.jsx($e,{to:"/auth",replace:!0})}),o.jsx(me,{path:"/search",element:o.jsx($e,{to:"/auth",replace:!0})}),o.jsx(me,{path:"/my-articles",element:o.jsx($e,{to:"/auth",replace:!0})}),o.jsx(me,{path:"/admin/*",element:o.jsx($e,{to:"/auth",replace:!0})})]})]})]})}sh(document.getElementById("root")).render(o.jsx(b.StrictMode,{children:o.jsx(wA,{})}));
